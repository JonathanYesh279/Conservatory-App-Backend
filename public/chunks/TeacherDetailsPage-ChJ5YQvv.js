import{j as e,V as ke}from"../assets/index-CVVLhZwk.js";import{r as x,c as Ie,b as Ae,N as Me}from"./vendor-B2j9q2e_.js";import{U as te,f as J,b as ee,M as xe,c as Le,A as we,O as ae,S as Te,X as de,Z as _e,a3 as $e,e as se,o as Se,P as oe,m as Oe,a as Pe,B as Ee,T as ce,d as Z,D as Fe,ac as Re,a9 as me,ap as pe}from"./ui-ypR0-hKN.js";import{t as We}from"./teacherDetailsApi-BGs4ypj_.js";import{a as P,h as q}from"./cascade-deletion-DAN0Gkem.js";import{b as ue,a as le,d as He,e as ie,s as Ue,g as qe,h as ze,f as G,i as Ve,j as fe,k as be,l as Be}from"./utils-x1PSU_OZ.js";import"./query-BI61muSV.js";const ye={personal:{label:"מידע אישי",icon:te},students:{label:"ניהול תלמידים",icon:J},schedule:{label:"לוח זמנים",icon:ee},conducting:{label:"ניצוח",icon:xe}},Ye=({activeTab:i,onTabChange:t,tabs:r=[]})=>!r||r.length===0?null:e.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm w-full overflow-hidden teacher-tab-navigation",children:[e.jsx("div",{className:"hidden md:flex w-full overflow-x-auto desktop-tab-nav",children:e.jsx("nav",{className:"flex gap-8 px-6 relative min-w-full","aria-label":"Tabs",children:r.map((n,a)=>{const g=ye[n.id],u=g?.icon||te,w=i===n.id;return e.jsxs("button",{onClick:()=>t(n.id),className:`
                  group inline-flex items-center gap-3 py-4 px-2 border-b-2 font-medium text-sm transition-all duration-300 relative tab-button
                  ${w?"border-primary-500 text-primary-600 bg-primary-50/50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50/50"}
                `,"aria-current":w?"page":void 0,style:{minHeight:"44px"},children:[e.jsx(u,{className:`w-5 h-5 transition-all duration-300 ${w?"text-primary-500 scale-110":"text-gray-400 group-hover:text-gray-500 group-hover:scale-105"}`}),e.jsx("span",{className:"whitespace-nowrap",children:g?.label||n.label}),w&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-primary-400 to-primary-600 rounded-full animate-scale-in"})]},n.id)})})}),e.jsxs("div",{className:"md:hidden w-full overflow-hidden mobile-tab-nav",children:[e.jsx("div",{className:"overflow-x-auto scrollbar-hide w-full",children:e.jsx("nav",{className:"flex gap-3 px-4 py-3 min-w-max","aria-label":"Tabs",style:{width:"max-content"},children:r.map((n,a)=>{const g=ye[n.id],u=g?.icon||te,w=i===n.id;return e.jsxs("button",{onClick:()=>t(n.id),className:`
                    flex flex-col items-center gap-1 px-4 py-3 rounded-xl font-medium text-xs transition-all duration-300 whitespace-nowrap transform tab-button
                    ${w?"bg-primary-100 text-primary-700 border-2 border-primary-200 scale-105 shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50 hover:scale-102 border-2 border-transparent"}
                  `,"aria-current":w?"page":void 0,style:{minWidth:"80px",minHeight:"44px"},children:[e.jsx(u,{className:`w-5 h-5 transition-all duration-300 ${w?"text-primary-600":"text-gray-500"}`}),e.jsx("span",{className:"leading-tight",children:g?.label||n.label})]},n.id)})})}),e.jsx("div",{className:"flex justify-center py-1",children:e.jsx("div",{className:"w-8 h-1 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-full bg-primary-400 rounded-full transition-all duration-300",style:{width:`${r?.length>0?(r.findIndex(n=>n.id===i)+1)/r.length*100:0}%`}})})})]})]}),Xe=({teacher:i,teacherId:t})=>{const[r,n]=x.useState(!1),[a,g]=x.useState(!1),[u,w]=x.useState(null),[y,f]=x.useState(!1),[T,S]=x.useState({fullName:i.personalInfo?.fullName||"",phone:i.personalInfo?.phone||"",email:i.personalInfo?.email||"",address:i.personalInfo?.address||""}),A=async()=>{try{g(!0),w(null),f(!1),await We.updateTeacherPersonalInfo(t,T),i.personalInfo.fullName=T.fullName,i.personalInfo.phone=T.phone,i.personalInfo.email=T.email,i.personalInfo.address=T.address,f(!0),n(!1),setTimeout(()=>f(!1),3e3)}catch(N){console.error("Error saving teacher personal info:",N),w(N.message||"שגיאה בשמירת הנתונים")}finally{g(!1)}},E=()=>{S({fullName:i.personalInfo?.fullName||"",phone:i.personalInfo?.phone||"",email:i.personalInfo?.email||"",address:i.personalInfo?.address||""}),w(null),n(!1)};return e.jsxs("div",{className:"p-6 space-y-6",children:[y&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:[e.jsx(Le,{className:"w-5 h-5"}),e.jsx("span",{children:"הנתונים נשמרו בהצלחה!"})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{children:u})]}),e.jsx("div",{className:"flex justify-end",children:r?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:A,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),"שמור"]})}),e.jsxs("button",{onClick:E,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(de,{className:"w-4 h-4"}),"בטל"]})]}):e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),"ערוך"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 border-b pb-2",children:"פרטים בסיסיים"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(te,{className:"w-4 h-4"}),"שם מלא"]}),r?e.jsx("input",{type:"text",value:T.fullName,onChange:N=>S({...T,fullName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"הכנס שם מלא"}):e.jsx("p",{className:"text-gray-900",children:i.personalInfo?.fullName||"לא צוין"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(_e,{className:"w-4 h-4"}),"טלפון"]}),r?e.jsx("input",{type:"tel",value:T.phone,onChange:N=>S({...T,phone:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"הכנס מספר טלפון"}):e.jsx("p",{className:"text-gray-900",children:i.personalInfo?.phone||"לא צוין"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx($e,{className:"w-4 h-4"}),'דוא"ל']}),r?e.jsx("input",{type:"email",value:T.email,onChange:N=>S({...T,email:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"הכנס כתובת דוא״ל"}):e.jsx("p",{className:"text-gray-900",children:i.personalInfo?.email||"לא צוין"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(se,{className:"w-4 h-4"}),"כתובת"]}),r?e.jsx("textarea",{value:T.address,onChange:N=>S({...T,address:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"הכנס כתובת מגורים",rows:2}):e.jsx("p",{className:"text-gray-900",children:i.personalInfo?.address||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 border-b pb-2",children:"מידע מקצועי"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(Se,{className:"w-4 h-4"}),"כלי נגינה"]}),e.jsx("p",{className:"text-gray-900",children:i.professionalInfo?.instrument||"לא צוין"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"תפקידים"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.roles?.map((N,M)=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:N},M))||e.jsx("span",{className:"text-gray-500",children:"אין תפקידים"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"סטטוס"}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${i.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.isActive?"פעיל":"לא פעיל"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(ee,{className:"w-4 h-4"}),"תאריך הצטרפות"]}),e.jsx("p",{className:"text-gray-900",children:i.createdAt?new Date(i.createdAt).toLocaleDateString("he-IL"):"לא ידוע"})]}),i.credentials?.lastLogin&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"כניסה אחרונה"}),e.jsx("p",{className:"text-gray-900",children:new Date(i.credentials.lastLogin).toLocaleDateString("he-IL")})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"סיכום תלמידים"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:i.teaching?.studentIds?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"סך התלמידים"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.teaching?.timeBlocks?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"בלוקי זמן"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round((i.teaching?.timeBlocks?.reduce((N,M)=>N+(M.totalDuration||0),0)||0)/60)}),e.jsx("div",{className:"text-sm text-gray-600",children:"שעות שבועיות"})]})]})]})]})},Ke=({teacher:i,teacherId:t})=>{const[r,n]=x.useState([]),[a,g]=x.useState({}),[u,w]=x.useState([]),[y,f]=x.useState(!0),[T,S]=x.useState(!1),[A,E]=x.useState(""),[N,M]=x.useState(""),[R,h]=x.useState(!1),[C,L]=x.useState(-1),[B,d]=x.useState(!1),[v,D]=x.useState(null),[O,Y]=x.useState({day:"",startTime:"",duration:30}),X=x.useRef(null),o=x.useRef(null),m=l=>{try{return l.teacherAssignments?.some(j=>j.teacherId===t&&j.isActive===!0)||!1}catch(b){return console.error(`Error checking lessons for student ${l._id}:`,b),!1}};x.useEffect(()=>{(async()=>{try{if(f(!0),i.teaching?.studentIds?.length>0){const j=i.teaching.studentIds.map(H=>P.students.getStudentById(H)),p=await Promise.all(j);n(p);const F={};p.forEach(H=>{const Q=m(H);F[H._id]=Q}),g(F)}const b=await P.students.getStudents();w(b)}catch(b){console.error("Error fetching students:",b)}finally{f(!1)}})()},[i.teaching?.studentIds,t]);const I=l=>{E(l._id),M(l.personalInfo?.fullName||""),h(!1),L(-1)},k=l=>{M(l),E(""),h(!0),L(-1)},_=()=>{M(""),E(""),h(!1),L(-1),o.current?.focus()},s=l=>{if(!R&&(l.key==="ArrowDown"||l.key==="Enter")){h(!0);return}switch(l.key){case"ArrowDown":l.preventDefault(),L(b=>b<V.length-1?b+1:0);break;case"ArrowUp":l.preventDefault(),L(b=>b>0?b-1:V.length-1);break;case"Enter":l.preventDefault(),C>=0&&V[C]&&I(V[C]);break;case"Escape":h(!1),L(-1),o.current?.blur();break}},c=async()=>{if(A)try{await P.teachers.addStudentToTeacher(t,A);const l=await P.students.getStudentById(A);n(b=>[...b,l]),S(!1),E(""),M("")}catch(l){console.error("Error adding student:",l)}},W=async l=>{const j=r.find(F=>F._id===l)?.personalInfo?.fullName||"התלמיד",p=i.personalInfo?.fullName||"המורה";if(confirm(`האם אתה בטוח שברצונך להסיר את ${j} מרשימת התלמידים של ${p}?

פעולה זו תנתק את הקשר בין התלמיד למורה אך לא תמחק את פרטי התלמיד מהמערכת.`))try{await P.teachers.removeStudentFromTeacher(t,l),n(F=>F.filter(H=>H._id!==l))}catch(F){console.error("Error removing student:",F)}},U=l=>{D(l),d(!0),Y({day:"",startTime:"",duration:30})},z=async()=>{if(!v||!O.day||!O.startTime){alert("אנא מלא את כל השדות הנדרשים");return}try{console.log("🔄 Creating lesson for student:",v.personalInfo?.fullName);const l=($,re)=>{const[ne,he]=$.split(":").map(Number),ge=ne*60+he+re,Ce=Math.floor(ge/60),De=ge%60;return`${Ce.toString().padStart(2,"0")}:${De.toString().padStart(2,"0")}`},b=await P.students.getStudentById(v._id);console.log("📋 Current student data loaded:",b.personalInfo?.fullName);const j=b.academicInfo?.instrumentProgress?.find($=>$.isPrimary)?.instrumentName||"כלי נגינה",p={teacherId:t,day:O.day,time:O.startTime,duration:O.duration,location:"",isActive:!0},F=[...b.teacherAssignments||[],p];console.log("📤 Adding new teacher assignment:",p),console.log("📝 All assignments to be saved:",F);const H={teacherAssignments:F};console.log("📤 Sending update data:",H);const Q=await P.students.updateStudent(v._id,H);console.log("✅ Student updated with new lesson assignment"),g($=>({...$,[v._id]:!0})),d(!1),D(null),Y({day:"",startTime:"",duration:30})}catch(l){console.error("❌ Failed to schedule lesson:",l);let b="שגיאה בקביעת השיעור. אנא נסה שוב.";l.message.includes("Authentication failed")?b="פג תוקף הפנייה. אנא התחבר מחדש.":l.message.includes("validation")?b="שגיאה בנתונים שהוזנו. אנא בדוק את פרטי השיעור.":l.message.includes("not found")?b="התלמיד לא נמצא במערכת.":l.message.includes("Network")?b="שגיאת רשת. אנא בדוק את החיבור לאינטרנט.":l.message.includes("שגיאה בשמירת הנתונים")&&(b="שגיאה בשמירת הנתונים במסד הנתונים. אנא נסה שוב."),alert(b),console.error("Error details:",{message:l.message,stack:l.stack,studentId:v._id,teacherId:t,lessonData:O})}},V=u.filter(l=>!i.teaching?.studentIds?.includes(l._id)).filter(l=>{const b=l.personalInfo?.fullName||"",j=l.academicInfo?.class||"",p=N.toLowerCase();return b.toLowerCase().includes(p)||j.toLowerCase().includes(p)});return x.useEffect(()=>{const l=b=>{X.current&&!X.current.contains(b.target)&&(h(!1),L(-1))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),x.useEffect(()=>{T||(M(""),E(""),h(!1),L(-1))},[T]),y?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded animate-pulse w-1/3"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(l=>e.jsx("div",{className:"h-16 bg-gray-200 rounded animate-pulse"},l))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all shadow-sm font-medium",children:[e.jsx(oe,{className:"w-4 h-4"}),"הוסף תלמיד"]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 teacher-modal-backdrop",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all teacher-modal-container",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6 text-center",children:"הוסף תלמיד חדש"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 teacher-modal-label",children:"חפש ובחר תלמיד"}),e.jsx("div",{className:"text-xs text-gray-500",children:"↑↓ לניווט • Enter לבחירה • Esc לסגירה"})]}),e.jsxs("div",{className:"relative",ref:X,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx(Oe,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{ref:o,type:"text",value:N,onChange:l=>k(l.target.value),onKeyDown:s,onFocus:()=>h(!0),placeholder:"הקלד שם תלמיד או כיתה...",className:"w-full pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white teacher-search-input",style:{paddingLeft:"2.5rem"}}),N?e.jsx("button",{onClick:_,className:"absolute inset-y-0 left-0 pl-3 flex items-center hover:bg-gray-50 rounded-r-lg",children:e.jsx(de,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})}):e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Pe,{className:`h-4 w-4 text-gray-400 transition-transform ${R?"rotate-180":""}`})})]}),R&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto teacher-search-dropdown teacher-dropdown-enter",children:V.length>0?e.jsx(e.Fragment,{children:V.map((l,b)=>e.jsx("button",{onClick:()=>I(l),className:`w-full text-right px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 teacher-search-option ${b===C?"bg-primary-50 text-primary-700 highlighted":"text-gray-900"} ${A===l._id?"bg-primary-100 text-primary-700 font-medium":""}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:l.personalInfo?.fullName}),e.jsxs("span",{className:"text-sm text-gray-500",children:["כיתה ",l.academicInfo?.class||"לא צוין"]})]})},l._id))}):e.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:N?"לא נמצאו תלמידים":"אין תלמידים זמינים"})})]})]}),e.jsxs("div",{className:"flex gap-3 teacher-modal-buttons",children:[e.jsx("button",{onClick:c,disabled:!A,className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed shadow-sm font-medium teacher-modal-button",children:"הוסף"}),e.jsx("button",{onClick:()=>{S(!1),E("")},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all shadow-sm font-medium teacher-modal-button",children:"בטל"})]})]})]})}),B&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6 text-center",children:"קביעת שיעור שבועי"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"פרטי התלמיד"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"שם:"})," ",v.personalInfo?.fullName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"כיתה:"})," ",v.academicInfo?.class||"לא צוין"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"כלי נגינה:"})," ",v.primaryInstrument||"לא צוין"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יום השבוע"}),e.jsxs("select",{value:O.day,onChange:l=>Y(b=>({...b,day:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),e.jsx("option",{value:"ראשון",children:"ראשון"}),e.jsx("option",{value:"שני",children:"שני"}),e.jsx("option",{value:"שלישי",children:"שלישי"}),e.jsx("option",{value:"רביעי",children:"רביעי"}),e.jsx("option",{value:"חמישי",children:"חמישי"}),e.jsx("option",{value:"שישי",children:"שישי"}),e.jsx("option",{value:"שבת",children:"שבת"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"זמן התחלה"}),e.jsx("input",{type:"time",value:O.startTime,onChange:l=>Y(b=>({...b,startTime:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"משך (דקות)"}),e.jsxs("select",{value:O.duration,onChange:l=>Y(b=>({...b,duration:Number(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:30,children:"30 דקות"}),e.jsx("option",{value:45,children:"45 דקות"}),e.jsx("option",{value:60,children:"60 דקות"}),e.jsx("option",{value:90,children:"90 דקות"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{onClick:z,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"קבע שיעור"}),e.jsx("button",{onClick:()=>{d(!1),D(null),Y({day:"",startTime:"",duration:30})},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"ביטול"})]})]})]})}),r.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(J,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תלמידים משויכים"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"עדיין לא שויכו תלמידים למורה זה"}),e.jsx("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all shadow-sm font-medium",children:"הוסף תלמיד ראשון"})]}):e.jsx("div",{className:"grid gap-4",children:r.map(l=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:l.personalInfo?.fullName||"ללא שם"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["כיתה ",l.academicInfo?.class||"לא צוין"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:l.primaryInstrument||"ללא כלי"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a[l._id]&&e.jsxs("button",{onClick:()=>U(l),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-1 transition-all shadow-sm font-medium flex items-center gap-1",children:[e.jsx(Ee,{className:"w-4 h-4"}),"קבע שיעור"]}),e.jsx("button",{onClick:()=>window.location.href=`/students/${l._id}`,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-all shadow-sm font-medium",children:"צפה בפרטים"}),e.jsxs("button",{onClick:()=>W(l._id),className:"px-3 py-1 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-1 transition-all shadow-sm font-medium flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"הסר"]})]})]})},l._id))}),r.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"סקירת לוח זמנים"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.timeBlocks?.map((l,b)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:l.day}),e.jsxs("span",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),Math.round(l.totalDuration/60)," שעות"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.startTime," - ",l.endTime]}),l.location&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["📍 ",l.location]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[l.assignedLessons?.length||0," שיעורים מתוכננים"]})]},l._id||b))}),(!i.timeBlocks||i.timeBlocks.length===0)&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"אין בלוקי זמן מוגדרים עדיין"})]})]})};var Qe={lessThanXSeconds:{one:"פחות משנייה",two:"פחות משתי שניות",other:"פחות מ־{{count}} שניות"},xSeconds:{one:"שנייה",two:"שתי שניות",other:"{{count}} שניות"},halfAMinute:"חצי דקה",lessThanXMinutes:{one:"פחות מדקה",two:"פחות משתי דקות",other:"פחות מ־{{count}} דקות"},xMinutes:{one:"דקה",two:"שתי דקות",other:"{{count}} דקות"},aboutXHours:{one:"כשעה",two:"כשעתיים",other:"כ־{{count}} שעות"},xHours:{one:"שעה",two:"שעתיים",other:"{{count}} שעות"},xDays:{one:"יום",two:"יומיים",other:"{{count}} ימים"},aboutXWeeks:{one:"כשבוע",two:"כשבועיים",other:"כ־{{count}} שבועות"},xWeeks:{one:"שבוע",two:"שבועיים",other:"{{count}} שבועות"},aboutXMonths:{one:"כחודש",two:"כחודשיים",other:"כ־{{count}} חודשים"},xMonths:{one:"חודש",two:"חודשיים",other:"{{count}} חודשים"},aboutXYears:{one:"כשנה",two:"כשנתיים",other:"כ־{{count}} שנים"},xYears:{one:"שנה",two:"שנתיים",other:"{{count}} שנים"},overXYears:{one:"יותר משנה",two:"יותר משנתיים",other:"יותר מ־{{count}} שנים"},almostXYears:{one:"כמעט שנה",two:"כמעט שנתיים",other:"כמעט {{count}} שנים"}},Ge=function(t,r,n){if(t==="xDays"&&n!==null&&n!==void 0&&n.addSuffix&&r<=2)return n.comparison&&n.comparison>0?r===1?"מחר":"מחרתיים":r===1?"אתמול":"שלשום";var a,g=Qe[t];return typeof g=="string"?a=g:r===1?a=g.one:r===2?a=g.two:a=g.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"בעוד "+a:"לפני "+a:a},Je={full:"EEEE, d בMMMM y",long:"d בMMMM y",medium:"d בMMM y",short:"d.M.y"},Ze={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},es={full:"{{date}} 'בשעה' {{time}}",long:"{{date}} 'בשעה' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ss={date:ue({formats:Je,defaultWidth:"full"}),time:ue({formats:Ze,defaultWidth:"full"}),dateTime:ue({formats:es,defaultWidth:"full"})},ts={lastWeek:"eeee 'שעבר בשעה' p",yesterday:"'אתמול בשעה' p",today:"'היום בשעה' p",tomorrow:"'מחר בשעה' p",nextWeek:"eeee 'בשעה' p",other:"P"},as=function(t,r,n,a){return ts[t]},rs={narrow:["לפנה״ס","לספירה"],abbreviated:["לפנה״ס","לספירה"],wide:["לפני הספירה","לספירה"]},ns={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["רבעון 1","רבעון 2","רבעון 3","רבעון 4"]},ls={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["ינו׳","פבר׳","מרץ","אפר׳","מאי","יוני","יולי","אוג׳","ספט׳","אוק׳","נוב׳","דצמ׳"],wide:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"]},is={narrow:["א׳","ב׳","ג׳","ד׳","ה׳","ו׳","ש׳"],short:["א׳","ב׳","ג׳","ד׳","ה׳","ו׳","ש׳"],abbreviated:["יום א׳","יום ב׳","יום ג׳","יום ד׳","יום ה׳","יום ו׳","שבת"],wide:["יום ראשון","יום שני","יום שלישי","יום רביעי","יום חמישי","יום שישי","יום שבת"]},os={narrow:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בוקר",afternoon:"אחר הצהריים",evening:"ערב",night:"לילה"},abbreviated:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בוקר",afternoon:"אחר הצהריים",evening:"ערב",night:"לילה"},wide:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בוקר",afternoon:"אחר הצהריים",evening:"ערב",night:"לילה"}},cs={narrow:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בבוקר",afternoon:"בצהריים",evening:"בערב",night:"בלילה"},abbreviated:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בבוקר",afternoon:"אחר הצהריים",evening:"בערב",night:"בלילה"},wide:{am:"לפנה״צ",pm:"אחה״צ",midnight:"חצות",noon:"צהריים",morning:"בבוקר",afternoon:"אחר הצהריים",evening:"בערב",night:"בלילה"}},ds=function(t,r){var n=Number(t);if(n<=0||n>10)return String(n);var a=String(r?.unit),g=["year","hour","minute","second"].indexOf(a)>=0,u=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שביעי","שמיני","תשיעי","עשירי"],w=["ראשונה","שנייה","שלישית","רביעית","חמישית","שישית","שביעית","שמינית","תשיעית","עשירית"],y=n-1;return g?w[y]:u[y]},ms={ordinalNumber:ds,era:le({values:rs,defaultWidth:"wide"}),quarter:le({values:ns,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:le({values:ls,defaultWidth:"wide"}),day:le({values:is,defaultWidth:"wide"}),dayPeriod:le({values:os,defaultWidth:"wide",formattingValues:cs,defaultFormattingWidth:"wide"})},us=/^(\d+|(ראשון|שני|שלישי|רביעי|חמישי|שישי|שביעי|שמיני|תשיעי|עשירי|ראשונה|שנייה|שלישית|רביעית|חמישית|שישית|שביעית|שמינית|תשיעית|עשירית))/i,xs=/^(\d+|רא|שנ|של|רב|ח|שי|שב|שמ|ת|ע)/i,hs={narrow:/^ל(ספירה|פנה״ס)/i,abbreviated:/^ל(ספירה|פנה״ס)/i,wide:/^ל(פני ה)?ספירה/i},gs={any:[/^לפ/i,/^לס/i]},ps={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^רבעון [1234]/i},fs={any:[/1/i,/2/i,/3/i,/4/i]},bs={narrow:/^\d+/i,abbreviated:/^(ינו|פבר|מרץ|אפר|מאי|יוני|יולי|אוג|ספט|אוק|נוב|דצמ)׳?/i,wide:/^(ינואר|פברואר|מרץ|אפריל|מאי|יוני|יולי|אוגוסט|ספטמבר|אוקטובר|נובמבר|דצמבר)/i},ys={narrow:[/^1$/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^7/i,/^8/i,/^9/i,/^10/i,/^11/i,/^12/i],any:[/^ינ/i,/^פ/i,/^מר/i,/^אפ/i,/^מא/i,/^יונ/i,/^יול/i,/^אוג/i,/^ס/i,/^אוק/i,/^נ/i,/^ד/i]},js={narrow:/^[אבגדהוש]׳/i,short:/^[אבגדהוש]׳/i,abbreviated:/^(שבת|יום (א|ב|ג|ד|ה|ו)׳)/i,wide:/^יום (ראשון|שני|שלישי|רביעי|חמישי|שישי|שבת)/i},Ns={abbreviated:[/א׳$/i,/ב׳$/i,/ג׳$/i,/ד׳$/i,/ה׳$/i,/ו׳$/i,/^ש/i],wide:[/ן$/i,/ני$/i,/לישי$/i,/עי$/i,/מישי$/i,/שישי$/i,/ת$/i],any:[/^א/i,/^ב/i,/^ג/i,/^ד/i,/^ה/i,/^ו/i,/^ש/i]},vs={any:/^(אחר ה|ב)?(חצות|צהריים|בוקר|ערב|לילה|אחה״צ|לפנה״צ)/i},ws={any:{am:/^לפ/i,pm:/^אחה/i,midnight:/^ח/i,noon:/^צ/i,morning:/בוקר/i,afternoon:/בצ|אחר/i,evening:/ערב/i,night:/לילה/i}},Ts=["רא","שנ","של","רב","ח","שי","שב","שמ","ת","ע"],Ss={ordinalNumber:He({matchPattern:us,parsePattern:xs,valueCallback:function(t){var r=parseInt(t,10);return isNaN(r)?Ts.indexOf(t)+1:r}}),era:ie({matchPatterns:hs,defaultMatchWidth:"wide",parsePatterns:gs,defaultParseWidth:"any"}),quarter:ie({matchPatterns:ps,defaultMatchWidth:"wide",parsePatterns:fs,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:ie({matchPatterns:bs,defaultMatchWidth:"wide",parsePatterns:ys,defaultParseWidth:"any"}),day:ie({matchPatterns:js,defaultMatchWidth:"wide",parsePatterns:Ns,defaultParseWidth:"any"}),dayPeriod:ie({matchPatterns:vs,defaultMatchWidth:"any",parsePatterns:ws,defaultParseWidth:"any"})},je={code:"he",formatDistance:Ge,formatLong:ss,formatRelative:as,localize:ms,match:Ss,options:{weekStartsOn:0,firstWeekContainsDate:1}};const Es={ראשון:0,שני:1,שלישי:2,רביעי:3,חמישי:4,שישי:5,שבת:6},Ne=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],Cs=({teacher:i,timeBlocks:t=[],lessons:r=[],orchestraActivities:n=[],className:a="",showNavigation:g=!0,onLessonUpdate:u})=>{const[w,y]=x.useState(new Date),[f,T]=x.useState(null),[S,A]=x.useState(!1),E=x.useMemo(()=>Ue(w,{weekStartsOn:0}),[w]),N=x.useMemo(()=>qe(w,{weekStartsOn:0}),[w]),M=x.useMemo(()=>ze({start:E,end:N}),[E,N]),R=o=>{const m=Es[o];return m===void 0?null:be(E,m)},h=x.useMemo(()=>{const o=[];return r.forEach((m,I)=>{const k=R(m.day);if(!k)return;const _=m.startTime||m.time||m.scheduleInfo?.startTime,s=m.duration||m.scheduleInfo?.duration||45,c=m.endTime||m.scheduleInfo?.endTime||X(_,s);if(!_){console.warn("Lesson missing time data:",m);return}o.push({id:`lesson-${m._id||I}`,date:k,startTime:_,endTime:c,title:m.lessonType==="group"?"שיעור קבוצתי":"שיעור פרטי",subtitle:m.studentName||"תלמיד",studentName:m.studentName,instrumentName:m.instrumentName||m.instrument?.instrumentName,type:"lesson",location:m.location||m.scheduleInfo?.location,color:m.lessonType==="group"?"bg-green-100 border-green-300 text-green-800":"bg-blue-100 border-blue-300 text-blue-800",details:m})}),n.forEach(m=>{const I=R(m.day);if(I){if(!m.startTime||!m.endTime){console.warn("Orchestra activity missing time data:",m);return}o.push({id:`orchestra-${m._id}`,date:I,startTime:m.startTime,endTime:m.endTime,title:m.name,subtitle:m.type==="orchestra"?"תזמורת":"אנסמבל",type:m.type,location:m.location,participants:[`${m.participants||0} נגנים`],color:m.type==="orchestra"?"bg-purple-100 border-purple-300 text-purple-800":"bg-green-100 border-green-300 text-green-800",details:m})}}),o.sort((m,I)=>{const k=m.date.getTime()-I.date.getTime();if(k!==0)return k;const _=m.startTime||"00:00",s=I.startTime||"00:00";return _.localeCompare(s)})},[t,r,n,i,E]),C=x.useMemo(()=>{const o={};return M.forEach(m=>{const I=G(m,"yyyy-MM-dd");o[I]=h.filter(k=>Ve(k.date,m))}),o},[h,M]),L=()=>y(o=>Be(o,7)),B=()=>y(o=>be(o,7)),d=()=>y(new Date),v=o=>{switch(o){case"lesson":return e.jsx(te,{className:"w-4 h-4"});case"orchestra":return e.jsx(xe,{className:"w-4 h-4"});case"ensemble":return e.jsx(J,{className:"w-4 h-4"});default:return e.jsx(Ee,{className:"w-4 h-4"})}},D=o=>{o.type==="lesson"&&o.details&&(console.log("🎯 Opening lesson for editing:",o.details),console.log("🆔 Activity ID:",o.id),console.log("📋 Full activity object:",o),T(o.details))},O=async o=>{if(f){A(!0);try{u&&await u({...f,...o}),T(null)}catch(m){console.error("Error updating lesson:",m),alert("שגיאה בעדכון השיעור. אנא נסה שוב.")}finally{A(!1)}}},Y=(o,m)=>{const[I,k]=o.split(":").map(Number),[_,s]=m.split(":").map(Number),c=I*60+k;return _*60+s-c},X=(o,m)=>{if(!o||!m)return o||"00:00";const[I,k]=o.split(":").map(Number),_=I*60+k+m,s=Math.floor(_/60),c=_%60;return`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`};return e.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 ${a}`,children:[g&&e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:L,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["לוח זמנים - ",G(E,"dd/MM",{locale:je})," - ",G(N,"dd/MM/yyyy",{locale:je})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," פעילויות השבוע"]})]}),e.jsx("button",{onClick:B,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:d,className:"px-3 py-1 text-sm bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"השבוע הנוכחי"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"grid grid-cols-7 gap-3",children:M.map((o,m)=>{const I=G(o,"yyyy-MM-dd"),k=C[I]||[],_=fe(o);return e.jsxs("div",{className:`border rounded-lg ${_?"border-primary-400 bg-primary-50/30":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:`p-3 text-center border-b ${_?"bg-primary-100 text-primary-800 border-primary-200":k.length>0?"bg-blue-50 text-blue-700 border-blue-100":"bg-gray-50 text-gray-600 border-gray-200"}`,children:[e.jsx("div",{className:"font-semibold",children:Ne[m]}),e.jsx("div",{className:"text-sm mt-1",children:G(o,"dd/MM")}),k.length>0&&e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:[k.length," פעילויות"]})]}),e.jsx("div",{className:"p-2 space-y-2 min-h-[400px]",children:k.length===0?e.jsx("div",{className:"text-center text-sm text-gray-400 mt-8",children:"אין פעילויות"}):k.map(s=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${s.color} shadow-sm hover:shadow-md transition-shadow ${s.type==="lesson"?"cursor-pointer":"cursor-default"}`,onClick:()=>s.type==="lesson"&&D(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.type),e.jsx("span",{className:"font-semibold text-sm",children:s.title})]}),s.type==="lesson"&&e.jsx(ae,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 transition-colors"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs mb-1",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[s.startTime," - ",s.endTime]})]}),s.subtitle&&e.jsxs("div",{className:"text-xs opacity-90 mb-1",children:[s.type==="lesson"&&s.studentName&&e.jsxs("div",{className:"font-medium",children:["תלמיד: ",s.studentName]}),s.type!=="lesson"&&e.jsx("div",{children:s.subtitle})]}),s.type==="lesson"&&s.instrumentName&&e.jsxs("div",{className:"text-xs opacity-75 mb-1",children:["כלי: ",s.instrumentName]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-75",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:s.location})]}),s.participants&&e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-75 mt-1",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{children:s.participants.join(", ")})]})]},s.id))})]},I)})})}),e.jsx("div",{className:"lg:hidden",children:e.jsx("div",{className:"space-y-4 pb-safe",children:M.map((o,m)=>{const I=G(o,"yyyy-MM-dd"),k=C[I]||[],_=fe(o);return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${_?"border-primary-400":"border-gray-200"}`,children:[e.jsx("div",{className:`p-3 font-semibold ${_?"bg-primary-100 text-primary-800":k.length>0?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[Ne[m]," - ",G(o,"dd/MM")]}),k.length>0&&e.jsxs("span",{className:"text-sm opacity-75",children:[k.length," פעילויות"]})]})}),e.jsx("div",{className:"p-3",children:k.length===0?e.jsx("div",{className:"text-center text-sm text-gray-400 py-4",children:"אין פעילויות"}):e.jsx("div",{className:"space-y-2",children:k.map(s=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${s.color} ${s.type==="lesson"?"cursor-pointer active:bg-opacity-80 touch-manipulation select-none":"cursor-default"} transition-all duration-200`,onClick:()=>s.type==="lesson"&&D(s),onTouchStart:c=>{s.type==="lesson"&&(c.currentTarget.style.transform="scale(0.98)")},onTouchEnd:c=>{s.type==="lesson"&&(c.currentTarget.style.transform="scale(1)")},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.type),e.jsx("h4",{className:"font-semibold text-sm",children:s.title})]}),s.type==="lesson"&&e.jsx(ae,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 transition-colors"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[s.startTime," - ",s.endTime]})]}),s.type==="lesson"&&s.studentName&&e.jsxs("div",{className:"font-medium",children:["תלמיד: ",s.studentName]}),s.instrumentName&&e.jsxs("div",{className:"opacity-75",children:["כלי: ",s.instrumentName]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:s.location})]}),s.participants&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{children:s.participants.join(", ")})]})]})]},s.id))})})]},I)})})}),h.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"סיכום השבוע"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.filter(o=>o.type==="lesson").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"שיעורים"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h.filter(o=>o.type==="orchestra").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"תזמורות"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.filter(o=>o.type==="ensemble").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"אנסמבלים"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:M.filter(o=>{const m=G(o,"yyyy-MM-dd");return(C[m]||[]).length>0}).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ימים פעילים"})]})]})]}),t.length>0&&e.jsxs("div",{className:"mt-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"ימי לימוד - זמינות למערכת"}),e.jsxs("span",{className:"text-sm text-gray-600 bg-white px-2 py-1 rounded-full",children:[t.length," בלוקי זמן"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(o=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:o.day}),o.isActive&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:"פעיל"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[o.startTime," - ",o.endTime]})]}),o.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:o.location})]}),o.notes&&e.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded-md mt-2",children:o.notes})]}),e.jsxs("div",{className:"text-center ml-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.floor(o.totalDuration/60)}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"שעות"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:o.totalDuration%60!==0&&`+${o.totalDuration%60}ד'`})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:[o.assignedLessons?.length||0," שיעורים מתוכננים"]}),e.jsx("span",{className:"text-blue-600 font-medium",children:"זמין למערכת"})]})})]},o._id))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-100 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"הסבר:"})," ימי הלימוד מציגים את הזמנים בהם המורה זמין ללמד. רק שיעורים בפועל עם תלמידים ופעילויות הניצוח מוצגים בלוח הזמנים למעלה."]})})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"עריכת שיעור פרטי"}),e.jsx("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsxs("form",{className:"space-y-4",onSubmit:async o=>{o.preventDefault();const m=o.target,I=new FormData(m),k=I.get("day"),_=I.get("startTime"),s=I.get("endTime");if(!k||!_||!s){alert("אנא מלא את כל השדות הנדרשים");return}const c=Y(_,s);if(c<=0){alert("זמן הסיום חייב להיות לאחר זמן ההתחלה");return}await O({day:k,startTime:_,endTime:s,duration:c})},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יום השבוע"}),e.jsxs("select",{name:"day",defaultValue:f.day,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),e.jsx("option",{value:"ראשון",children:"ראשון"}),e.jsx("option",{value:"שני",children:"שני"}),e.jsx("option",{value:"שלישי",children:"שלישי"}),e.jsx("option",{value:"רביעי",children:"רביעי"}),e.jsx("option",{value:"חמישי",children:"חמישי"}),e.jsx("option",{value:"שישי",children:"שישי"}),e.jsx("option",{value:"שבת",children:"שבת"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"זמן התחלה"}),e.jsx("input",{type:"time",name:"startTime",defaultValue:f.startTime||f.time,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"זמן סיום"}),e.jsx("input",{type:"time",name:"endTime",defaultValue:f.endTime||X(f.startTime||f.time||"00:00",f.duration||45),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"פרטי השיעור"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"תלמיד:"})," ",f.studentName||"לא צוין"]}),f.instrumentName&&e.jsxs("div",{children:[e.jsx("strong",{children:"כלי נגינה:"})," ",f.instrumentName]}),f.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"מיקום:"})," ",f.location]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:S,className:"flex-1 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium disabled:opacity-50",children:S?"שומר...":"שמור שינויים"}),e.jsx("button",{type:"button",onClick:()=>T(null),className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"ביטול"})]})]})]})})]})};class Ds{async getCurrentOrchestraEnrollments(t){if(!t||t.length===0)return[];try{const r=t.map(async a=>{try{return await q.getOrchestra(a)}catch(g){return console.warn(`Failed to fetch orchestra ${a}:`,g),null}});return(await Promise.allSettled(r)).filter(a=>a.status==="fulfilled"&&a.value!==null).map(a=>a.value)}catch(r){throw console.error("Error fetching orchestra enrollments:",r),{code:"FETCH_ORCHESTRAS_FAILED",message:"שגיאה בטעינת נתוני התזמורות",details:r}}}async getCurrentEnsembleEnrollments(t){if(!t||t.length===0)return[];try{const r=t.map(async a=>{try{return await q.request(`/ensemble/${a}`)}catch(g){return console.warn(`Failed to fetch ensemble ${a}:`,g),null}});return(await Promise.allSettled(r)).filter(a=>a.status==="fulfilled"&&a.value!==null).map(a=>a.value)}catch(r){throw console.error("Error fetching ensemble enrollments:",r),{code:"FETCH_ENSEMBLES_FAILED",message:"שגיאה בטעינת נתוני ההרכבים",details:r}}}async getAllAvailableOrchestras(){try{return(await q.request("/orchestra")).filter(r=>r.isActive)}catch(t){throw console.error("Error fetching available orchestras:",t),{code:"FETCH_ALL_ORCHESTRAS_FAILED",message:"שגיאה בטעינת רשימת התזמורות הזמינות",details:t}}}async getAllAvailableEnsembles(){try{return(await q.request("/ensemble")).filter(r=>r.isActive)}catch(t){throw console.error("Error fetching available ensembles:",t),{code:"FETCH_ALL_ENSEMBLES_FAILED",message:"שגיאה בטעינת רשימת ההרכבים הזמינים",details:t}}}async checkOrchestraEligibility(t,r,n){try{const a=await q.getOrchestra(r),g=n||await q.getStudentDetails(t),u={canEnroll:!0,reasons:[],conflicts:[],instrumentCompatible:!1,hasSpace:!1,meetsRequirements:!1},w=g.instrumentProgress?.map(f=>f.instrumentName)||[];u.instrumentCompatible=a.instruments.some(f=>w.includes(f)),u.instrumentCompatible||(u.canEnroll=!1,u.reasons.push(`הכלי שלך (${w.join(", ")}) לא מתאים לתזמורת זו`)),a.maxMembers&&a.currentMembers?(u.hasSpace=a.currentMembers<a.maxMembers,u.hasSpace||(u.canEnroll=!1,u.reasons.push("התזמורת מלאה - אין מקומות זמינים"))):u.hasSpace=!0;const y=await this.detectScheduleConflicts(g,a.rehearsalTimes);return u.conflicts=y,y.length>0&&y.some(T=>T.severity==="overlap")&&(u.canEnroll=!1,u.reasons.push("יש התנגשות עם השיעורים הקיימים שלך")),u.meetsRequirements=!0,u.estimatedCost=a.yearlyFee||0,u}catch(a){throw console.error("Error checking orchestra eligibility:",a),{code:"ELIGIBILITY_CHECK_FAILED",message:"שגיאה בבדיקת זכאות לתזמורת",details:a}}}async checkEnsembleEligibility(t,r,n){try{const a=await q.request(`/ensemble/${r}`),g=n||await q.getStudentDetails(t),u={canEnroll:!0,reasons:[],conflicts:[],instrumentCompatible:!1,hasSpace:!1,meetsRequirements:!1},w=g.instrumentProgress?.map(f=>f.instrumentName)||[];u.instrumentCompatible=a.instruments.some(f=>w.includes(f)),u.instrumentCompatible||(u.canEnroll=!1,u.reasons.push(`הכלי שלך (${w.join(", ")}) לא מתאים להרכב זה`)),a.maxMembers&&a.currentMembers?(u.hasSpace=a.currentMembers<a.maxMembers,u.hasSpace||(u.canEnroll=!1,u.reasons.push("ההרכב מלא - אין מקומות זמינים"))):u.hasSpace=!0;const y=await this.detectScheduleConflicts(g,a.rehearsalTimes);return u.conflicts=y,y.length>0&&y.some(T=>T.severity==="overlap")&&(u.canEnroll=!1,u.reasons.push("יש התנגשות עם השיעורים הקיימים שלך")),u.meetsRequirements=!0,u.estimatedCost=a.yearlyFee||0,u}catch(a){throw console.error("Error checking ensemble eligibility:",a),{code:"ELIGIBILITY_CHECK_FAILED",message:"שגיאה בבדיקת זכאות להרכב",details:a}}}async detectScheduleConflicts(t,r){const n=[];try{const a=t.teacherAssignments||[],g={ראשון:0,שני:1,שלישי:2,רביעי:3,חמישי:4,שישי:5,שבת:6};for(const u of r){const w=g[u.day];for(const y of a){const f=g[y.day];if(w===f){const T=this.timeToMinutes(u.startTime),S=this.timeToMinutes(u.endTime),A=this.timeToMinutes(y.startTime),E=A+(y.duration||45);T<E&&A<S?n.push({type:"lesson",conflictWith:`שיעור ${y.instrumentName||"כלי נגינה"} עם ${y.teacherName||"המורה"}`,day:y.day,startTime:y.startTime,endTime:this.minutesToTime(E),severity:"overlap"}):(Math.abs(T-E)<30||Math.abs(A-S)<30)&&n.push({type:"lesson",conflictWith:`שיעור ${y.instrumentName||"כלי נגינה"} עם ${y.teacherName||"המורה"}`,day:y.day,startTime:y.startTime,endTime:this.minutesToTime(E),severity:"adjacent"})}}}}catch(a){console.error("Error detecting conflicts:",a)}return n}async addOrchestraEnrollment(t,r){try{const n=await this.checkOrchestraEligibility(t,r);if(!n.canEnroll)throw{code:"ENROLLMENT_NOT_ELIGIBLE",message:`לא ניתן להרשם: ${n.reasons.join(", ")}`,details:{eligibility:n}};const a=await q.getStudentDetails(t);if(a.orchestraIds?.includes(r))throw{code:"ALREADY_ENROLLED",message:"התלמיד כבר רשום לתזמורת זו",details:{orchestraId:r}};const g=[...a.orchestraIds||[],r];await q.request(`/student/${t}`,{method:"PUT",body:JSON.stringify({orchestraIds:g})})}catch(n){throw n.code?n:(console.error("Error adding orchestra enrollment:",n),{code:"ENROLLMENT_FAILED",message:"שגיאה ברישום לתזמורת",details:n})}}async removeOrchestraEnrollment(t,r){try{const n=await q.getStudentDetails(t);if(!n.orchestraIds?.includes(r))throw{code:"NOT_ENROLLED",message:"התלמיד אינו רשום לתזמורת זו",details:{orchestraId:r}};const a=n.orchestraIds.filter(g=>g!==r);await q.request(`/student/${t}`,{method:"PUT",body:JSON.stringify({orchestraIds:a})})}catch(n){throw n.code?n:(console.error("Error removing orchestra enrollment:",n),{code:"UNENROLLMENT_FAILED",message:"שגיאה בביטול רישום מהתזמורת",details:n})}}async addEnsembleEnrollment(t,r){try{const n=await this.checkEnsembleEligibility(t,r);if(!n.canEnroll)throw{code:"ENROLLMENT_NOT_ELIGIBLE",message:`לא ניתן להרשם: ${n.reasons.join(", ")}`,details:{eligibility:n}};const a=await q.getStudentDetails(t);if(a.ensembleIds?.includes(r))throw{code:"ALREADY_ENROLLED",message:"התלמיד כבר רשום להרכב זה",details:{ensembleId:r}};const g=[...a.ensembleIds||[],r];await q.request(`/student/${t}`,{method:"PUT",body:JSON.stringify({ensembleIds:g})})}catch(n){throw n.code?n:(console.error("Error adding ensemble enrollment:",n),{code:"ENROLLMENT_FAILED",message:"שגיאה ברישום להרכב",details:n})}}async removeEnsembleEnrollment(t,r){try{const n=await q.getStudentDetails(t);if(!n.ensembleIds?.includes(r))throw{code:"NOT_ENROLLED",message:"התלמיד אינו רשום להרכב זה",details:{ensembleId:r}};const a=n.ensembleIds.filter(g=>g!==r);await q.request(`/student/${t}`,{method:"PUT",body:JSON.stringify({ensembleIds:a})})}catch(n){throw n.code?n:(console.error("Error removing ensemble enrollment:",n),{code:"UNENROLLMENT_FAILED",message:"שגיאה בביטול רישום מההרכב",details:n})}}timeToMinutes(t){const[r,n]=t.split(":").map(Number);return r*60+n}minutesToTime(t){const r=Math.floor(t/60),n=t%60;return`${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}}const ve=new Ds,ks=({teacherId:i,timeBlock:t,onSave:r,onCancel:n})=>{const[a,g]=x.useState(()=>t?{day:t.day,startTime:t.startTime,endTime:t.endTime,location:t.location,notes:t.notes||"",isActive:t.isActive,isRecurring:t.recurring?.isRecurring||!0}:{day:"ראשון",startTime:"14:00",endTime:"18:00",location:"חדר 25",notes:"",isActive:!0,isRecurring:!0}),[u,w]=x.useState(!1),[y,f]=x.useState(null),T=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],S=(h,C)=>{const[L,B]=h.split(":").map(Number),[d,v]=C.split(":").map(Number),D=L*60+B;return d*60+v-D},A=h=>{const C=Math.floor(h/60),L=h%60;return L>0?`${C} שעות ו-${L} דקות`:`${C} שעות`},E=(h,C)=>{g(L=>({...L,[h]:C})),f(null)},N=()=>{const h=S(a.startTime,a.endTime);return h<=0?(f("שעת סיום חייבת להיות אחרי שעת התחלה"),!1):h<30?(f("זמינות חייבת להיות לפחות 30 דקות"),!1):a.location.trim()?!0:(f("יש לבחור מיקום"),!1)},M=async h=>{if(h.preventDefault(),!!N()){w(!0),f(null);try{const C=S(a.startTime,a.endTime),L={day:a.day,startTime:a.startTime,endTime:a.endTime,totalDuration:C,location:a.location,notes:a.notes.trim()||null,isActive:a.isActive,recurring:{isRecurring:a.isRecurring,excludeDates:t?.recurring?.excludeDates||[]}};t?._id?await P.teacherSchedule.updateTimeBlock(i,t._id,L):await P.teacherSchedule.createTimeBlock(i,L),r()}catch(C){console.error("Error saving time block:",C),f("שגיאה בשמירת הזמינות: "+(C.message||"שגיאה לא ידועה"))}finally{w(!1)}}},R=S(a.startTime,a.endTime);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t?"עריכת זמינות":"הוספת זמינות חדשה"}),e.jsx("button",{type:"button",onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-6",children:[y&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:y})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"יום בשבוע *"]}),e.jsx("select",{value:a.day,onChange:h=>E("day",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",required:!0,children:T.map(h=>e.jsx("option",{value:h,children:h},h))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"שעת התחלה *"]}),e.jsx("input",{type:"time",value:a.startTime,onChange:h=>E("startTime",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:a.endTime,onChange:h=>E("endTime",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",required:!0})]})]}),R>0&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-blue-700",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"font-medium",children:["משך זמן: ",A(R)]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"מיקום *"]}),e.jsx("select",{value:a.location,onChange:h=>E("location",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",required:!0,children:ke.map(h=>e.jsx("option",{value:h,children:h},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"הערות"}),e.jsx("textarea",{value:a.notes,onChange:h=>E("notes",h.target.value),placeholder:"הערות אופציונליות...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isRecurring,onChange:h=>E("isRecurring",h.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 mr-3",children:"חוזר שבועית"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isActive,onChange:h=>E("isActive",h.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 mr-3",children:"פעיל"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"submit",disabled:u,className:"flex-1 flex items-center justify-center px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),t?"עדכן":"צור"," זמינות"]})}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 font-medium",children:"ביטול"})]})]})]})})},Is=({teacher:i,teacherId:t})=>{const[r,n]=x.useState(null),[a,g]=x.useState(!1),[u,w]=x.useState([]),[y,f]=x.useState([]),[T,S]=x.useState([]),[A,E]=x.useState(!1),[N,M]=x.useState(!1),[R,h]=x.useState(!1),[C,L]=x.useState(i),[B,d]=x.useState(null);x.useEffect(()=>{(async()=>{if(i.conducting){E(!0);try{const c=(i.conducting.orchestraIds||[]).map(async j=>{try{const p=await ve.getCurrentOrchestraEnrollments([j]);return p[0]?{_id:p[0]._id,name:p[0].name,type:"orchestra",rehearsalTimes:p[0].rehearsalTimes||[],location:"אולם התזמורת",participants:p[0].currentMembers||0}:null}catch(p){return console.warn(`Failed to load orchestra ${j}:`,p),null}}),W=(i.conducting.ensemblesIds||[]).map(async j=>{try{const p=await ve.getCurrentEnsembleEnrollments([j]);return p[0]?{_id:p[0]._id,name:p[0].name,type:"ensemble",rehearsalTimes:p[0].rehearsalTimes||[],location:"חדר האנסמבל",participants:p[0].currentMembers||0}:null}catch(p){return console.warn(`Failed to load ensemble ${j}:`,p),null}}),[U,z]=await Promise.all([Promise.allSettled(c),Promise.allSettled(W)]),K=U.filter(j=>j.status==="fulfilled"&&j.value!==null).map(j=>j.value),V=z.filter(j=>j.status==="fulfilled"&&j.value!==null).map(j=>j.value),l=K.flatMap(j=>j.rehearsalTimes.map(p=>({_id:`${j._id}-${p.day}-${p.startTime}`,name:j.name,day:p.day,startTime:p.startTime,endTime:p.endTime,location:p.location||j.location,participants:j.participants,type:"orchestra"}))),b=V.flatMap(j=>j.rehearsalTimes.map(p=>({_id:`${j._id}-${p.day}-${p.startTime}`,name:j.name,day:p.day,startTime:p.startTime,endTime:p.endTime,location:p.location||j.location,participants:j.participants,type:"ensemble"})));w(l),f(b)}catch(c){console.error("Failed to load conducting activities:",c)}finally{E(!1)}}})()},[i.conducting]),x.useEffect(()=>{(async()=>{if(t)try{console.log("🔄 Loading teacher lessons for ID:",t);const c=await P.teachers.getTeacherLessons(t);console.log("✅ Teacher lessons loaded:",c);const W=c?.lessons||c?.data?.lessons||[];S(W),console.log(`📚 Set ${W.length} lessons for teacher`)}catch(c){console.error("❌ Failed to load teacher lessons:",c),S([])}})()},[t]);const v=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],D=async()=>{try{const s=await P.teachers.getTeacher(t);L(s)}catch(s){console.error("Failed to refresh teacher data:",s)}},O=x.useMemo(()=>{const s=[];return C.teaching?.timeBlocks&&s.push(...C.teaching.timeBlocks),C.teaching?.schedule&&C.teaching.schedule.forEach(c=>{c.studentId||s.push({_id:c._id,day:c.day,startTime:c.startTime,endTime:c.endTime,totalDuration:c.duration||0,location:c.location,notes:c.notes,isActive:c.isAvailable!==!1,assignedLessons:[],isFromSchedule:!0})}),s},[C.teaching?.timeBlocks,C.teaching?.schedule]);v.reduce((s,c)=>(s[c]=O.filter(W=>W.day===c)||[],s),{});const Y=()=>O.reduce((s,c)=>s+(c.totalDuration||0),0)/60||0,X=()=>{const s=new Set;return C.teaching?.schedule?.forEach(c=>{c.studentId&&s.add(c.studentId)}),s.size},o=async s=>{try{if(console.log("🔄 Updating lesson via student record:",s),console.log("🆔 Student ID:",s.studentId),console.log("👨‍🏫 Teacher ID:",s.teacherId||t),console.log("📝 Update data:",{day:s.day,startTime:s.startTime,endTime:s.endTime,duration:s.duration}),!s.studentId)throw new Error("Student ID is missing");const c=await P.students.getStudentById(s.studentId);if(console.log("📋 Current student data loaded:",c.personalInfo?.fullName),!c.teacherAssignments||c.teacherAssignments.length===0)throw new Error("No teacher assignments found for this student");const W=s.teacherId||t,U=c.teacherAssignments.findIndex(p=>p.teacherId===W&&p.isActive);if(U===-1)throw new Error(`No active assignment found for teacher ${W}`);console.log(`🎯 Found teacher assignment at index ${U}`);const z=[...c.teacherAssignments],K=z[U],V=(p,F)=>{const[H,Q]=p.split(":").map(Number),$=H*60+Q+F,re=Math.floor($/60),ne=$%60;return`${re.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`};z[U]={...K,day:s.day,time:s.startTime,duration:s.duration,scheduleInfo:{...K.scheduleInfo,day:s.day,startTime:s.startTime,endTime:V(s.startTime,s.duration),duration:s.duration,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()},console.log("📤 Updating student record with new assignment:",z[U]);const l=await P.students.updateStudent(s.studentId,{teacherAssignments:z});console.log("✅ Student updated successfully:",l.personalInfo?.fullName);const b=await P.teachers.getTeacherLessons(t),j=b?.lessons||b?.data?.lessons||[];S(j),console.log("✅ Teacher lessons refreshed - new count:",j.length)}catch(c){throw console.error("❌ Failed to update lesson:",c),console.error("❌ Error details:",c.message),c}},m=u.length+y.length,I=Y(),k=O.length||0,_=X();return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-end items-start",children:[A&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 mr-4",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"טוען פעילויות הניצוח..."]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:Math.round(I)}),e.jsx("div",{className:"text-gray-600",children:"שעות שבועיות"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k}),e.jsx("div",{className:"text-gray-600",children:"ימי לימוד"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:_}),e.jsx("div",{className:"text-gray-600",children:"תלמידים"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m}),e.jsx("div",{className:"text-gray-600",children:"הרכבים"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>M(!1),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${N?"bg-white text-gray-600 hover:bg-gray-100":"bg-primary-500 text-white"}`,children:"לוח זמנים שבועי"}),e.jsx("button",{onClick:()=>M(!0),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${N?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"ניהול ימי לימוד"})]}),m>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:["מנצח על ",m," הרכבים"]})]}),N?e.jsxs("div",{className:"space-y-6",children:[O.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map((s,c)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s.day})]}),s.isActive&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:"פעיל"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[s.startTime," - ",s.endTime]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{className:"text-sm",children:"משך:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[Math.floor(s.totalDuration/60)," שעות",s.totalDuration%60!==0&&` ו-${s.totalDuration%60} דקות`]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[s.assignedLessons?.length||0," שיעורים מתוכננים"]})]})]}),s.notes&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>n(s),className:"flex-1 px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors font-medium",children:[e.jsx(ae,{className:"w-4 h-4 inline-block ml-1"}),"ערוך"]}),e.jsxs("button",{onClick:()=>d({timeBlock:s}),disabled:R,className:"flex-1 px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium disabled:opacity-50",children:[e.jsx(ce,{className:"w-4 h-4 inline-block ml-1"}),R?"מוחק...":"מחק"]})]})]},s._id||c))}):e.jsxs("div",{className:"bg-white rounded-xl border-2 border-dashed border-gray-200 p-12 text-center",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"אין ימי לימוד מוגדרים"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"טרם הוגדרו ימי לימוד עבור מורה זה. הגדר ימי לימוד כדי לאפשר תזמון שיעורים."}),e.jsx("button",{onClick:()=>g(!0),className:"px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium",children:"הוסף יום לימוד ראשון"})]}),O.length>0&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium shadow-sm",children:[e.jsx(oe,{className:"w-5 h-5"}),"הוסף יום לימוד חדש"]})})]}):e.jsx(Cs,{teacher:C,timeBlocks:O,lessons:T,orchestraActivities:u,className:"",showNavigation:!0,onLessonUpdate:o}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["ערוך יום לימוד - ",r.day]}),e.jsx("button",{onClick:()=>n(null),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"זמן התחלה"}),e.jsx("input",{type:"time",defaultValue:r.startTime,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"זמן סיום"}),e.jsx("input",{type:"time",defaultValue:r.endTime,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"מיקום"}),e.jsx("input",{type:"text",defaultValue:r.location,placeholder:"חדר, אולם, או מיקום אחר",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות"}),e.jsx("textarea",{defaultValue:r.notes,placeholder:"הערות נוספות על יום הלימוד...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",defaultChecked:r.isActive,className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"יום לימוד פעיל (זמין לקביעת שיעורים)"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium disabled:opacity-50",disabled:R,onClick:async s=>{s.preventDefault();const c=s.target.closest("form");new FormData(c);const W=c.querySelectorAll('input[type="time"]'),U=W[0].value,z=W[1].value,K=c.querySelector('input[type="text"]').value,V=c.querySelector("textarea").value,l=c.querySelector('input[type="checkbox"]').checked,j=((p,F)=>{const[H,Q]=p.split(":").map(Number),[$,re]=F.split(":").map(Number),ne=H*60+Q;return $*60+re-ne})(U,z);try{if(h(!0),r.isFromSchedule){const p=C.teaching.schedule.map($=>$._id===r._id?{_id:$._id,day:$.day,startTime:U,endTime:z,duration:j,location:K,notes:V||null,isAvailable:l,studentId:$.studentId,recurring:$.recurring}:$);console.log("🔄 Simplified update approach"),console.log("🔄 Updated schedule entry:",p.find($=>$._id===r._id));const F=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!F)throw new Error("No authentication token found");console.log("🔑 Using token:",F?"Token exists":"No token found"),console.log("📊 Duration calculated:",j,"minutes"),console.log("📝 Time range:",U,"-",z);const H=await fetch(`http://localhost:3001/api/teacher/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${F}`},body:JSON.stringify({teaching:{...C.teaching,schedule:p}})});if(!H.ok){const $=await H.text();throw console.error("❌ Server response:",$),new Error(`HTTP ${H.status}: ${$}`)}const Q=await H.json();console.log("✅ Update successful:",Q)}else await P.teachers.updateTimeBlock(t,r._id,{startTime:U,endTime:z,totalDuration:j,location:K,notes:V,isActive:l});await D(),n(null),console.log("✅ Successfully updated teaching day")}catch(p){console.error("❌ Failed to update teaching day:",p),console.error("Error details:",p.response?.data||p.message),alert("שגיאה בעדכון יום הלימוד. אנא נסה שוב.")}finally{h(!1)}},children:R?"שומר...":"שמור שינויים"}),e.jsx("button",{type:"button",onClick:()=>n(null),className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"ביטול"})]})]})]})}),!N&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"מקרא"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"שיעורים פרטיים"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-100 border border-purple-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"תזמורות"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"אנסמבלים"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 border border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-700",children:"זמן פנוי"})]})]})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 rounded-full",children:e.jsx(we,{className:"w-6 h-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"מחיקת יום לימוד"}),e.jsxs("p",{className:"text-gray-600 text-center mb-6",children:["האם אתה בטוח שברצונך למחוק את יום הלימוד ביום ",B.timeBlock.day,"?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(null),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"ביטול"}),e.jsx("button",{onClick:async()=>{const s=B.timeBlock;d(null);try{if(h(!0),s.isFromSchedule){const c=C.teaching.schedule.filter(U=>U._id!==s._id),W={teaching:{...C.teaching,schedule:c}};console.log("🗑️ Deleting teaching day with data:",W),await P.teachers.updateTeacher(t,W)}else await P.teacherSchedule.deleteTimeBlock(t,s._id);await D(),console.log("✅ Successfully deleted teaching day:",s.day)}catch(c){console.error("❌ Failed to delete teaching day:",c),console.error("Error details:",c.response?.data||c.message),alert("שגיאה במחיקת יום הלימוד. אנא נסה שוב.")}finally{h(!1)}},disabled:R,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50",children:R?"מוחק...":"מחק"})]})]})}),a&&e.jsx(ks,{teacherId:t,timeBlock:null,onSave:async()=>{await D(),g(!1)},onCancel:()=>g(!1)})]})},As=({teacher:i,teacherId:t})=>{const[r,n]=x.useState([]),[a,g]=x.useState([]),[u,w]=x.useState(!0),[y,f]=x.useState(!1),[T,S]=x.useState(!1),[A,E]=x.useState({name:"",description:""}),[N,M]=x.useState({name:"",description:"",type:""});x.useEffect(()=>{(async()=>{try{if(w(!0),i.conducting?.orchestraIds?.length>0){const v=i.conducting.orchestraIds.map(D=>P.orchestras?.getOrchestraById(D));if(v.length>0)try{const D=await Promise.all(v);n(D.filter(Boolean))}catch(D){console.warn("Error fetching orchestras:",D),n([])}}if(i.conducting?.ensemblesIds?.length>0){const v=i.conducting.ensemblesIds.map(D=>P.ensembles?.getEnsembleById(D));if(v.length>0)try{const D=await Promise.all(v);g(D.filter(Boolean))}catch(D){console.warn("Error fetching ensembles:",D),g([])}}}catch(v){console.error("Error fetching conducting data:",v)}finally{w(!1)}})()},[i.conducting]);const R=async()=>{if(A.name.trim())try{const d={...A,conductorId:t,memberIds:[],isActive:!0,createdAt:new Date};console.log("Creating orchestra:",d);const v={_id:`temp-${Date.now()}`,...d};n(D=>[...D,v]),E({name:"",description:""}),f(!1)}catch(d){console.error("Error creating orchestra:",d)}},h=async()=>{if(N.name.trim())try{const d={...N,conductorId:t,memberIds:[],isActive:!0,createdAt:new Date};console.log("Creating ensemble:",d);const v={_id:`temp-${Date.now()}`,...d};g(D=>[...D,v]),M({name:"",description:"",type:""}),S(!1)}catch(d){console.error("Error creating ensemble:",d)}},C=async d=>{if(confirm("האם אתה בטוח שברצונך למחוק את התזמורת?"))try{console.log("Deleting orchestra:",d),n(v=>v.filter(D=>D._id!==d))}catch(v){console.error("Error deleting orchestra:",v)}},L=async d=>{if(confirm("האם אתה בטוח שברצונך למחוק את האנסמבל?"))try{console.log("Deleting ensemble:",d),g(v=>v.filter(D=>D._id!==d))}catch(v){console.error("Error deleting ensemble:",v)}};if(u)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded animate-pulse w-1/3"}),e.jsx("div",{className:"space-y-3",children:[1,2].map(d=>e.jsx("div",{className:"h-24 bg-gray-200 rounded animate-pulse"},d))})]});const B=r.reduce((d,v)=>d+(v.memberIds?.length||0),0)+a.reduce((d,v)=>d+(v.memberIds?.length||0),0);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.length}),e.jsx("div",{className:"text-gray-600",children:"תזמורות"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.length}),e.jsx("div",{className:"text-gray-600",children:"אנסמבלים"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:B}),e.jsx("div",{className:"text-gray-600",children:"סך חברים"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"תזמורות"}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"צור תזמורת"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-8 bg-purple-50 rounded-lg",children:[e.jsx(xe,{className:"w-12 h-12 text-purple-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תזמורות"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"עדיין לא נוצרו תזמורות תחת ניצוחו של המורה"}),e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"צור תזמורת ראשונה"})]}):e.jsx("div",{className:"grid gap-4",children:r.map(d=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:d.name}),d.description&&e.jsx("p",{className:"text-gray-600 mb-3",children:d.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),d.memberIds?.length||0," חברים"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),d.rehearsalSchedule?.length||0," חזרות"]}),e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${d.isActive!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.isActive!==!1?"פעיל":"לא פעיל"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(d._id),className:"px-3 py-2 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]})]})},d._id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"אנסמבלים"}),e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"צור אנסמבל"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8 bg-blue-50 rounded-lg",children:[e.jsx(Se,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין אנסמבלים"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"עדיין לא נוצרו אנסמבלים תחת ניצוחו של המורה"}),e.jsx("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"צור אנסמבל ראשון"})]}):e.jsx("div",{className:"grid gap-4",children:a.map(d=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:d.name}),d.description&&e.jsx("p",{className:"text-gray-600 mb-3",children:d.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),d.memberIds?.length||0," חברים"]}),d.type&&e.jsx("div",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs",children:d.type}),e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${d.isActive!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.isActive!==!1?"פעיל":"לא פעיל"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(d._id),className:"px-3 py-2 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]})]})},d._id))})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"צור תזמורת חדשה"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שם התזמורת"}),e.jsx("input",{type:"text",value:A.name,onChange:d=>E({...A,name:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"הכנס שם תזמורת..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תיאור"}),e.jsx("textarea",{value:A.description,onChange:d=>E({...A,description:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"תיאור התזמורת...",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:R,disabled:!A.name.trim(),className:"flex-1 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors disabled:bg-gray-300",children:"צור תזמורת"}),e.jsx("button",{onClick:()=>{f(!1),E({name:"",description:""})},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"בטל"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"צור אנסמבל חדש"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שם האנסמבל"}),e.jsx("input",{type:"text",value:N.name,onChange:d=>M({...N,name:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"הכנס שם אנסמבל..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"סוג האנסמבל"}),e.jsxs("select",{value:N.type,onChange:d=>M({...N,type:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"בחר סוג..."}),e.jsx("option",{value:"קלאסי",children:"קלאסי"}),e.jsx("option",{value:"ג'אז",children:"ג'אז"}),e.jsx("option",{value:"כלי נשיפה",children:"כלי נשיפה"}),e.jsx("option",{value:"כלי מיתר",children:"כלי מיתר"}),e.jsx("option",{value:"מעורב",children:"מעורב"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תיאור"}),e.jsx("textarea",{value:N.description,onChange:d=>M({...N,description:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"תיאור האנסמבל...",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,disabled:!N.name.trim(),className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300",children:"צור אנסמבל"}),e.jsx("button",{onClick:()=>{S(!1),M({name:"",description:"",type:""})},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"בטל"})]})]})]})})]})},Ms=({activeTab:i,teacherId:t,teacher:r,isLoading:n})=>{if(n||!r)return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded animate-pulse w-1/3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-2/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})]})]});switch(i){case"personal":return e.jsx(Xe,{teacher:r,teacherId:t});case"students":return e.jsx(Ke,{teacher:r,teacherId:t});case"schedule":return e.jsx(Is,{teacher:r,teacherId:t});case"conducting":return e.jsx(As,{teacher:r,teacherId:t});default:return e.jsx("div",{className:"p-6 text-center text-gray-500",children:e.jsx("p",{children:"תוכן הכרטיסייה לא נמצא"})})}},Ws=()=>{const{teacherId:i}=Ie(),t=Ae(),[r,n]=x.useState("personal"),[a,g]=x.useState(null),[u,w]=x.useState(!0),[y,f]=x.useState(null);if(!i||i.trim()==="")return e.jsx(Me,{to:"/teachers",replace:!0});const T=x.useCallback(async()=>{if(i)try{w(!0),f(null),console.log("🔄 Fetching teacher data for ID:",i);const S=await P.teachers.getTeacherById(i);console.log("✅ Teacher data loaded:",S?.personalInfo?.fullName),g(S)}catch(S){console.error("❌ Error fetching teacher:",S),f({code:S.status===404?"NOT_FOUND":S.status===401?"UNAUTHORIZED":S.status===403?"FORBIDDEN":"SERVER_ERROR",message:S.message||"שגיאה בטעינת נתוני המורה"})}finally{w(!1)}},[i]);return x.useEffect(()=>{T()},[T]),y?.code==="NOT_FOUND"?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"מורה לא נמצא"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"המורה שביקשת לא נמצא במערכת או שאין לך הרשאה לצפות בו"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>t("/teachers"),className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(me,{className:"w-4 h-4 ml-2"}),"חזור לרשימת מורים"]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(pe,{className:"w-4 h-4 ml-2"}),"נסה שוב"]})]})]}):y?.code==="UNAUTHORIZED"||y?.code==="FORBIDDEN"?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔒"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"אין הרשאה"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"אין לך הרשאה לצפות בפרטי מורה זה"}),e.jsxs("button",{onClick:()=>t("/teachers"),className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(me,{className:"w-4 h-4 ml-2"}),"חזור לרשימת מורים"]})]}):y&&!["NOT_FOUND","UNAUTHORIZED","FORBIDDEN"].includes(y.code)?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-gray-600 mb-6",children:y.message}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(pe,{className:"w-4 h-4 ml-2"}),"נסה שוב"]}),e.jsxs("button",{onClick:()=>t("/teachers"),className:"flex items-center px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(me,{className:"w-4 h-4 ml-2"}),"חזור לרשימת מורים"]})]})]}):u?e.jsx("div",{className:"space-y-6 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען פרטי מורה..."})]})}):e.jsxs("div",{className:"space-y-6 bg-white min-h-screen teacher-details-container teacher-content-area",children:[e.jsxs("nav",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>t("/teachers"),className:"hover:text-primary-600 transition-colors",children:"מורים"}),e.jsx("span",{children:">"}),e.jsx("span",{className:"text-gray-900",children:a?.personalInfo?.fullName||"פרטי מורה"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xl text-primary-600",children:"👨‍🏫"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?.personalInfo?.fullName||"טוען..."}),e.jsxs("p",{className:"text-gray-600",children:[a?.professionalInfo?.instrument||"ללא כלי"," | ",a?.roles?.join(", ")||"מורה"]})]}),a?.conducting?.orchestraIds?.length>0&&e.jsx("div",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"מנצח"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 w-full overflow-hidden",children:[e.jsx(Ye,{activeTab:r,onTabChange:n,tabs:[{id:"personal",label:"מידע אישי",component:()=>null},{id:"students",label:"ניהול תלמידים",component:()=>null},{id:"schedule",label:"לוח זמנים",component:()=>null},...a?.conducting?.orchestraIds?.length>0||a?.conducting?.ensemblesIds?.length>0||a?.roles?.includes("מנצח")?[{id:"conducting",label:"ניצוח",component:()=>null}]:[]]}),e.jsx(Ms,{activeTab:r,teacherId:i,teacher:a,isLoading:u})]})]})};export{Ws as default};
