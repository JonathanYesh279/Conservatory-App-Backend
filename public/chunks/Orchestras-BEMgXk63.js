import{V as P,j as e,u as fe}from"../assets/index-fAwKGW-W.js";import{r as m,b as ye}from"./vendor-B2j9q2e_.js";import{C as J}from"./Card-CI5oVQ9E.js";import{T as je}from"./Table-BIUy4-lp.js";import{X as re,M as q,e as Z,U,f as V,S as Ne,O as ae,T as le,b as ne,d as ie,A as ce,q as Y,m as H,F as oe,aa as ve,G as we,Z as Ce,a3 as Ie,ab as Se,P as te,J as ke,a2 as Me,a1 as Oe}from"./ui-ypR0-hKN.js";import{S as X}from"./StatsCard-BkEjrc6n.js";import{o as L,f as de,t as me,r as Ae}from"./cascade-deletion-DAN0Gkem.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";const K=["הרכב","תזמורת"],ee=s=>{switch(s){case"תזמורת":return{text:"תזמורת",colorClass:"bg-blue-100 text-blue-800",icon:""};case"הרכב":return{text:"הרכב",colorClass:"bg-green-100 text-green-800",icon:""};default:return{text:s,colorClass:"bg-gray-100 text-gray-800",icon:""}}},se=s=>{if(!s.isActive)return{text:"לא פעיל",colorClass:"bg-gray-100 text-gray-800"};const l=s.memberIds?.length||0;return l===0?{text:"ללא חברים",colorClass:"bg-yellow-100 text-yellow-800"}:l<5?{text:"הרכב קטן",colorClass:"bg-orange-100 text-orange-800"}:l>=15?{text:"הרכב גדול",colorClass:"bg-purple-100 text-purple-800"}:{text:"פעיל",colorClass:"bg-green-100 text-green-800"}},xe=s=>{const l=s.memberIds?.length||0,c=s.rehearsalIds?.length||0,o=!!s.conductorId;let i=0;if(s.rehearsals&&s.rehearsals.length>0){const x=s.rehearsals.slice(-5).map(b=>{const d=b.attendance?.present?.length||0,N=l;return N>0?d/N*100:0});i=x.length>0?Math.round(x.reduce((b,d)=>b+d,0)/x.length):0}return{memberCount:l,rehearsalCount:c,hasConductor:o,averageAttendance:i,isFullyConfigured:o&&l>0,orchestraSize:l>=15?"גדול":l>=5?"בינוני":"קטן"}},De=(s,l)=>s.filter(c=>{if(l.searchQuery){const o=l.searchQuery.toLowerCase(),i=G(c);if(!(c.name?.toLowerCase().includes(o)||i.toLowerCase().includes(o)||c.location?.toLowerCase().includes(o)))return!1}return!(l.type&&c.type!==l.type||l.conductorId&&c.conductorId!==l.conductorId||l.location&&c.location!==l.location||l.isActive!==void 0&&c.isActive!==l.isActive||l.hasMembers!==void 0&&(c.memberIds?.length||0)>0!==l.hasMembers)}),_e=(s,l="name",c="asc")=>[...s].sort((i,u)=>{let x=0;switch(l){case"name":x=i.name.localeCompare(u.name,"he");break;case"type":x=i.type.localeCompare(u.type,"he");break;case"conductor":const b=G(i),d=G(u);x=b.localeCompare(d,"he");break;case"memberCount":x=(i.memberIds?.length||0)-(u.memberIds?.length||0);break;case"location":x=i.location.localeCompare(u.location,"he");break;case"rehearsalCount":x=(i.rehearsalIds?.length||0)-(u.rehearsalIds?.length||0);break;default:x=0}return c==="desc"?-x:x}),ue=s=>s===0?"אין חברים":s===1?"חבר אחד":s===2?"שני חברים":`${s} חברים`,he=s=>s===0?"אין חזרות":s===1?"חזרה אחת":s===2?"שתי חזרות":`${s} חזרות`,G=s=>s.conductor?.personalInfo?.fullName?s.conductor.personalInfo.fullName:s.conductorInfo?.name?s.conductorInfo.name:s.conductorDetails?.personalInfo?.fullName?s.conductorDetails.personalInfo.fullName:s.conductorId?"טוען נתוני מנצח...":"לא הוקצה מנצח",Ee=s=>{const l={};return s.name?.trim()?s.name.length<2?l.name="שם התזמורת חייב להכיל לפחות 2 תווים":s.name.length>100&&(l.name="שם התזמורת לא יכול לעלות על 100 תווים"):l.name="שם התזמורת נדרש",s.type?K.includes(s.type)||(l.type="סוג הרכב לא תקין"):l.type="סוג הרכב נדרש",s.location?P.includes(s.location)||(l.location="מיקום לא תקין"):l.location="מיקום נדרש",s.conductorId?.trim()||(l.conductorId="מנצח נדרש"),{isValid:Object.keys(l).length===0,errors:l}},ge=s=>{const l={},c=[];return!s||s.length===0?{instrumentCounts:l,totalInstruments:0,primaryInstruments:c}:(s.forEach(o=>{o.academicInfo?.instrumentProgress&&o.academicInfo.instrumentProgress.forEach(i=>{const u=i.instrumentName;l[u]=(l[u]||0)+1,i.isPrimary&&!c.includes(u)&&c.push(u)})}),{instrumentCounts:l,totalInstruments:Object.keys(l).length,primaryInstruments:c.sort()})},$e=s=>{const l=[],c=[];let o=0;s.conductorId?(o+=25,c.push("יש מנצח מוקצה")):l.push("אין מנצח מוקצה");const i=s.memberIds?.length||0;i>=8?(o+=25,c.push(`${i} חברים בהרכב`)):i>=4?(o+=15,c.push(`${i} חברים בהרכב`)):i>0?(o+=5,l.push("מעט חברים בהרכב")):l.push("אין חברים בהרכב"),s.location&&s.location!=="חדר 1"?(o+=10,c.push(`מיקום מוגדר: ${s.location}`)):(o+=5,l.push("מיקום ברירת מחדל"));const u=s.rehearsalIds?.length||0;return u>=3?(o+=25,c.push(`${u} חזרות מתוכננות`)):u>=1?(o+=15,c.push(`${u} חזרות מתוכננות`)):l.push("אין חזרות מתוכננות"),s.isActive?(o+=15,c.push("הרכב פעיל")):l.push("הרכב לא פעיל"),{isReady:o>=75,score:Math.min(100,o),issues:l,strengths:c}};function Pe({orchestra:s,teachers:l,onSubmit:c,onCancel:o}){const[i,u]=m.useState({name:"",type:"תזמורת",conductorId:"",memberIds:[],location:"חדר 1",isActive:!0}),[x,b]=m.useState(!1),[d,N]=m.useState({});m.useEffect(()=>{s&&u({name:s.name||"",type:s.type||"תזמורת",conductorId:s.conductorId||"",memberIds:s.memberIds||[],location:s.location||"חדר 1",isActive:s.isActive!==void 0?s.isActive:!0})},[s]);const p=(t,g)=>{u(a=>({...a,[t]:g})),d[t]&&N(a=>{const f={...a};return delete f[t],f})},j=async t=>{t.preventDefault();const g=Ee(i);if(!g.isValid){N(g.errors);return}b(!0);try{await c(i)}catch(a){console.error("Error submitting orchestra form:",a),N({general:a.message||"שגיאה בשמירת התזמורת"})}finally{b(!1)}},A=l.filter(t=>t.roles?.includes("מנצח")||t.professionalInfo?.instrument==="מנהיגות מוזיקלית"||t.conducting?.orchestraIds?.length>0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s?"עריכת תזמורת":"תזמורת חדשה"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[d.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:d.general})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(q,{className:"w-4 h-4 inline ml-1"}),"שם התזמורת *"]}),e.jsx("input",{type:"text",value:i.name,onChange:t=>p("name",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.name?"border-red-300":"border-gray-300"}`,placeholder:"הזן שם לתזמורת",required:!0}),d.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"סוג הרכב *"}),e.jsx("select",{value:i.type,onChange:t=>p("type",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.type?"border-red-300":"border-gray-300"}`,required:!0,children:K.map(t=>e.jsx("option",{value:t,children:t},t))}),d.type&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.type}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"תזמורת: הרכב גדול עם כלים שונים | הרכב: קבוצה קטנה יותר"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 inline ml-1"}),"מיקום חזרות *"]}),e.jsxs("select",{value:i.location,onChange:t=>p("location",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("optgroup",{label:"אולמות",children:P.filter(t=>t.includes("אולם")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"סטודיואים",children:P.filter(t=>t.includes("סטודיו")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"חדרי חזרות",children:P.filter(t=>t.includes("חדר חזרות")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"חדרי לימוד",children:P.filter(t=>t.startsWith("חדר")&&!t.includes("חזרות")&&!t.includes("תאוריה")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"חדרי תיאוריה",children:P.filter(t=>t.includes("תאוריה")).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"אחר",children:P.filter(t=>!t.includes("אולם")&&!t.includes("סטודיו")&&!t.includes("חדר")).map(t=>e.jsx("option",{value:t,children:t},t))})]}),d.location&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.location})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(U,{className:"w-4 h-4 inline ml-1"}),"מנצח *"]}),e.jsxs("select",{value:i.conductorId,onChange:t=>p("conductorId",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.conductorId?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:"בחר מנצח"}),A.map(t=>e.jsxs("option",{value:t._id,children:[t.personalInfo?.fullName,t.professionalInfo?.instrument&&e.jsxs("span",{className:"text-gray-500",children:[" - ",t.professionalInfo.instrument]})]},t._id))]}),d.conductorId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.conductorId}),A.length===0&&e.jsx("p",{className:"text-orange-600 text-xs mt-1",children:"⚠️ לא נמצאו מורים עם תפקיד מנצח. ניתן להוסיף מורים חדשים בעמוד המורים."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(V,{className:"w-4 h-4 inline ml-1"}),"חברי התזמורת"]}),i.memberIds.length>0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[i.memberIds.length," חברים בתזמורת"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"ניהול חברים יהיה זמין בעמוד הפרטים של התזמורת"})]}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"📝 לאחר יצירת התזמורת, תוכל להוסיף חברים בעמוד הפרטים"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:t=>p("isActive",t.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"תזמורת פעילה"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"תזמורות לא פעילות לא יוצגו ברשימות הראשיות"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:x,children:"ביטול"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(Ne,{className:"w-4 h-4 ml-2"}),s?"עדכן תזמורת":"צור תזמורת"]})]})]})]})})}function Le({orchestra:s,onEdit:l,onDelete:c,onViewDetails:o}){const i=ee(s.type),u=se(s),x=xe(s),b=ge(s.members),d=()=>{o&&o(s._id)},N=()=>{l&&l(s)},p=()=>{c&&c(s._id)};return e.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 group hover:border-blue-300 ${o?"cursor-pointer":""}`,onClick:o?d:void 0,children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-blue-50 group-hover:text-blue-700 transition-colors",children:i.text}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-blue-50 group-hover:text-blue-700 transition-colors",children:u.text})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 leading-tight group-hover:text-blue-900 transition-colors",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center group-hover:text-blue-600 transition-colors",children:[e.jsx(U,{className:"w-3 h-3 ml-1"}),G(s)]})]}),e.jsxs("div",{className:"flex items-center gap-1 mr-2",children:[l&&e.jsx("button",{onClick:j=>{j.stopPropagation(),N()},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"ערוך תזמורת",children:e.jsx(ae,{className:"w-4 h-4"})}),c&&e.jsx("button",{onClick:j=>{j.stopPropagation(),p()},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"מחק תזמורת",children:e.jsx(le,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Z,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"מיקום:"}),s.location]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(V,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"חברים:"}),ue(x.memberCount)]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"חזרות:"}),he(x.rehearsalCount)]})]}),b.totalInstruments>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[e.jsx(q,{className:"w-4 h-4 inline ml-1"}),"כלי נגינה"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[b.totalInstruments," סוגים"]})]}),b.primaryInstruments.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[b.primaryInstruments.slice(0,4).map(j=>e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:[j,e.jsxs("span",{className:"mr-1 text-gray-600",children:["(",b.instrumentCounts[j],")"]})]},j)),b.primaryInstruments.length>4&&e.jsxs("span",{className:"text-xs text-gray-500 px-2 py-1",children:["+",b.primaryInstruments.length-4," נוספים"]})]})]}),x.averageAttendance>0&&e.jsx("div",{className:"flex items-center bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ie,{className:"w-4 h-4 ml-2 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:"נוכחות ממוצעת:"}),e.jsxs("span",{className:"text-gray-600",children:[x.averageAttendance,"%"]})]})}),e.jsxs("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-100 flex justify-between",children:[e.jsxs("span",{children:["הרכב ",x.orchestraSize]}),e.jsx("span",{children:x.isFullyConfigured?"מוגדר במלואו":"דורש השלמה"})]})]})]})}function Re({onViewDetails:s,onEditOrchestra:l,onManageMembers:c,onDeleteOrchestra:o}){const[i,u]=m.useState([]),[x,b]=m.useState(!0),[d,N]=m.useState(null),[p,j]=m.useState("all");m.useEffect(()=>{A()},[]);const A=async()=>{try{b(!0),N(null);const a=await L.getOrchestras(),[f,D]=await Promise.all([de.getStudents(),me.getTeachers()]),S=await Promise.all(a.map(async y=>{try{const _=f.filter(v=>y.memberIds?.includes(v._id)),R=D.find(v=>v._id===y.conductorId);let F=0,$=[];try{const v=await Ae.getOrchestraRehearsals(y._id);F=v.length;const B=new Date;$=v.filter(C=>new Date(C.date)>=B).slice(0,3).sort((C,k)=>new Date(C.date).getTime()-new Date(k.date).getTime())}catch(v){console.warn(`Could not load rehearsals for orchestra ${y._id}:`,v)}return{...y,memberDetails:_,conductorDetails:R,rehearsalCount:F,upcomingRehearsals:$}}catch(_){return console.warn(`Error enriching orchestra ${y._id}:`,_),y}}));u(S)}catch(a){console.error("Error loading orchestra data:",a),N("שגיאה בטעינת נתוני תזמורות")}finally{b(!1)}},t=i.filter(a=>{switch(p){case"active":return a.isActive;case"inactive":return!a.isActive;case"תזמורת":case"הרכב":return a.type===p;default:return!0}}),g={total:i.length,active:i.filter(a=>a.isActive).length,totalMembers:i.reduce((a,f)=>a+(f.memberIds?.length||0),0),withConductor:i.filter(a=>a.conductorId).length,avgMembersPerOrchestra:i.length>0?Math.round(i.reduce((a,f)=>a+(f.memberIds?.length||0),0)/i.length):0,typeDistribution:{תזמורת:i.filter(a=>a.type==="תזמורת").length,הרכב:i.filter(a=>a.type==="הרכב").length}};return x?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((a,f)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6",children:[d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-red-600 ml-2"}),e.jsx("span",{className:"text-red-800",children:d})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(X,{title:"סה״כ תזמורות",value:g.total.toString(),subtitle:`${g.active} פעילות`,icon:e.jsx(q,{}),color:"blue",trend:{value:g.typeDistribution.תזמורת,label:"תזמורות",direction:"up"}}),e.jsx(X,{title:"סה״כ מבצעים",value:g.totalMembers.toString(),subtitle:`ממוצע ${g.avgMembersPerOrchestra} לתזמורת`,icon:e.jsx(V,{}),color:"green",trend:{value:g.typeDistribution.הרכב,label:"הרכבים",direction:"up"}}),e.jsx(X,{title:"מנצחים מוקצים",value:`${g.withConductor}/${g.total}`,subtitle:`${Math.round(g.withConductor/Math.max(g.total,1)*100)}% הקצאה`,icon:e.jsx(U,{}),color:"purple"})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-gray-200",children:[{key:"all",label:"הכל",count:g.total},{key:"active",label:"פעילות",count:g.active},{key:"inactive",label:"לא פעילות",count:g.total-g.active},{key:"תזמורת",label:"תזמורות",count:g.typeDistribution.תזמורת},{key:"הרכב",label:"הרכבים",count:g.typeDistribution.הרכב}].map(a=>e.jsxs("button",{onClick:()=>j(a.key),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${p===a.key?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[a.label," (",a.count,")"]},a.key))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:t.map(a=>{const f=ee(a.type),D=se(a),S=ge(a.memberDetails||[]);return $e(a),e.jsx(J,{className:"hover:shadow-lg transition-shadow cursor-pointer hover:border-primary-300 p-5",onClick:()=>s?.(a._id),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg mb-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:f.text}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:D.text})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),a.conductorDetails?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:a.conductorDetails.personalInfo.fullName}),a.conductorDetails.professionalInfo?.instrument&&e.jsx("span",{className:"text-gray-500 text-xs block",children:a.conductorDetails.professionalInfo.instrument})]}):e.jsx("span",{className:"text-gray-500",children:"לא הוקצה מנצח"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:a.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[a.memberDetails?.length||0," חברים",S.totalInstruments>0&&e.jsxs("span",{className:"text-gray-500 text-xs",children:[" ","• ",S.totalInstruments," כלי נגינה"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[a.rehearsalCount||0," חזרות",a.upcomingRehearsals&&a.upcomingRehearsals.length>0&&e.jsxs("span",{className:"text-green-600 text-xs",children:[" ","• ",a.upcomingRehearsals.length," עתידות"]})]})]})]}),a.upcomingRehearsals&&a.upcomingRehearsals.length>0&&e.jsxs("div",{className:"border-t border-gray-100 pt-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"חזרות קרובות:"}),e.jsx("div",{className:"space-y-1",children:a.upcomingRehearsals.slice(0,2).map(y=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-2",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsxs("span",{children:[new Date(y.date).toLocaleDateString("he-IL")," • ",y.startTime]})]},y._id))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:y=>{y.stopPropagation(),c?.(a._id)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx(Y,{className:"w-3 h-3"}),"חברים"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),l?.(a)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(ae,{className:"w-3 h-3"}),"עריכה"]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),o?.(a._id)},className:"flex items-center gap-1 px-3 py-2 text-xs bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors",children:e.jsx(le,{className:"w-3 h-3"})})]})]})},a._id)})}),t.length===0&&!x&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:p==="all"?"אין תזמורות":`אין תזמורות ${p==="active"?"פעילות":p==="inactive"?"לא פעילות":p==="תזמורת"?"מסוג תזמורת":p==="הרכב"?"מסוג הרכב":""}`}),e.jsx("p",{className:"text-gray-600",children:p==="all"?"התחל על ידי יצירת התזמורת הראשונה":"שנה את המסנן לראות תזמורות אחרות"})]})]})}function Fe({orchestraId:s,isOpen:l,onClose:c,onUpdate:o}){const[i,u]=m.useState(null),[x,b]=m.useState([]),[d,N]=m.useState([]),[p,j]=m.useState([]),[A,t]=m.useState(!0),[g,a]=m.useState(null),[f,D]=m.useState(""),[S,y]=m.useState(""),[_,R]=m.useState(""),[F,$]=m.useState(null);m.useEffect(()=>{l&&s&&v()},[l,s]);const v=async()=>{try{t(!0),a(null);const[n,w]=await Promise.all([L.getOrchestra(s),de.getStudents()]);u(n),b(w);const O=new Set(n.memberIds||[]),I=w.filter(h=>O.has(h._id)),r=w.filter(h=>!O.has(h._id)&&h.isActive);N(I),j(r)}catch(n){console.error("Error loading data:",n),a("שגיאה בטעינת הנתונים")}finally{t(!1)}},B=async n=>{try{$(n),await L.addMember(s,n),await v(),o?.()}catch(w){console.error("Error adding member:",w),a("שגיאה בהוספת חבר לתזמורת")}finally{$(null)}},C=async n=>{if(window.confirm("האם אתה בטוח שברצונך להסיר את החבר מהתזמורת?"))try{$(n),await L.removeMember(s,n),await v(),o?.()}catch(w){console.error("Error removing member:",w),a("שגיאה בהסרת חבר מהתזמורת")}finally{$(null)}},k=n=>n.filter(w=>{if(f){const O=f.toLowerCase();if(!w.personalInfo.fullName.toLowerCase().includes(O))return!1}return!(S&&w.academicInfo?.class!==S||_&&!w.academicInfo?.instrumentProgress?.some(I=>I.instrumentName===_))}),M=k(d),E=k(p),W=[...new Set(x.map(n=>n.academicInfo?.class).filter(Boolean))].sort(),z=[...new Set(x.flatMap(n=>n.academicInfo?.instrumentProgress?.map(w=>w.instrumentName)||[]).filter(Boolean))].sort();if(!l)return null;const Q=n=>{n.target===n.currentTarget&&c()};if(A)return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Q,children:e.jsx("div",{className:"bg-white rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-gray-700",children:"טוען נתוני חברים..."})]})})});if(g||!i)return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Q,children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ce,{className:"w-6 h-6 text-red-600 ml-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"שגיאה"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:g||"לא ניתן לטעון נתוני התזמורת"}),e.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"סגור"})]})});const T=({student:n,isMember:w})=>{const O=n.academicInfo?.instrumentProgress?.find(r=>r.isPrimary),I=F===n._id;return e.jsx(J,{className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:n.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[n.academicInfo?.class&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsxs("span",{children:["כיתה ",n.academicInfo.class]})]}),O&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:O.instrumentName}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(שלב ",O.currentStage,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[n.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:n.personalInfo.phone})]}),n.personalInfo.studentEmail&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:n.personalInfo.studentEmail})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:w?e.jsxs("button",{onClick:()=>C(n._id),disabled:I,className:`flex items-center gap-1 px-3 py-2 text-xs rounded-lg transition-colors ${I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[I?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-400 border-t-transparent"}):e.jsx(Se,{className:"w-3 h-3"}),"הסר"]}):e.jsxs("button",{onClick:()=>B(n._id),disabled:I,className:`flex items-center gap-1 px-3 py-2 text-xs rounded-lg transition-colors ${I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-50 text-green-700 hover:bg-green-100"}`,children:[I?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-400 border-t-transparent"}):e.jsx(Y,{className:"w-3 h-3"}),"הוסף"]})})]})},n._id)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:Q,children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] m-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"ניהול חברי התזמורת"}),e.jsx("p",{className:"text-gray-600 mt-1",children:i.name})]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:f,onChange:n=>D(n.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"w-32",children:e.jsxs("select",{value:S,onChange:n=>y(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"כל הכיתות"}),W.map(n=>e.jsxs("option",{value:n,children:["כיתה ",n]},n))]})}),e.jsx("div",{className:"w-40",children:e.jsxs("select",{value:_,onChange:n=>R(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"כל הכלים"}),z.map(n=>e.jsx("option",{value:n,children:n},n))]})}),e.jsx("button",{onClick:()=>{D(""),y(""),R("")},className:"px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 border-b md:border-b-0 md:border-l border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"חברים נוכחיים"}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:M.length})]}),d.length!==M.length&&e.jsxs("p",{className:"text-sm text-gray-600",children:["מציג ",M.length," מתוך ",d.length," חברים"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:M.length>0?e.jsx("div",{className:"space-y-3",children:M.map(n=>e.jsx(T,{student:n,isMember:!0},n._id))}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין חברים בתזמורת"}),e.jsx("p",{className:"text-gray-600",children:"התחל על ידי הוספת תלמידים מהרשימה הזמינה"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תוצאות"}),e.jsx("p",{className:"text-gray-600",children:"נסה לשנות את קריטריוני החיפוש"})]})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"תלמידים זמינים"}),e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full",children:E.length})]}),p.length!==E.length&&e.jsxs("p",{className:"text-sm text-gray-600",children:["מציג ",E.length," מתוך ",p.length," תלמידים"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:E.length>0?e.jsx("div",{className:"space-y-3",children:E.map(n=>e.jsx(T,{student:n,isMember:!1},n._id))}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"כל התלמידים כבר חברים"}),e.jsx("p",{className:"text-gray-600",children:"כל התלמידים הפעילים כבר חברים בתזמורת"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תוצאות"}),e.jsx("p",{className:"text-gray-600",children:"נסה לשנות את קריטריוני החיפוש"})]})})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["סך הכל: ",d.length," חברים • ",p.length," תלמידים זמינים"]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"סגור"})]})})]})})}function He(){const s=ye(),{user:l}=fe(),[c,o]=m.useState([]),[i,u]=m.useState([]),[x,b]=m.useState(!0),[d,N]=m.useState(null),[p,j]=m.useState(!1),[A,t]=m.useState(null),[g,a]=m.useState(""),[f,D]=m.useState("dashboard"),[S,y]=m.useState(!1),[_,R]=m.useState(null),[F,$]=m.useState("name"),[v,B]=m.useState("asc"),[C,k]=m.useState({type:"",conductorId:"",location:"",isActive:!0,hasMembers:void 0});m.useEffect(()=>{M()},[]);const M=async()=>{try{b(!0),N(null);const[r,h]=await Promise.all([L.getOrchestras(),me.getTeachers({roles:"מנצח"})]);o(r);const pe=h.filter(be=>be._id!==l?._id);u(pe)}catch(r){console.error("Error loading data:",r),N("שגיאה בטעינת הנתונים")}finally{b(!1)}},E=_e(De(c,{searchQuery:g,type:C.type,conductorId:C.conductorId,location:C.location,isActive:C.isActive,hasMembers:C.hasMembers}),F,v);c.length,c.filter(r=>r.isActive).length,c.reduce((r,h)=>r+(h.memberIds?.length||0),0),c.filter(r=>r.conductorId).length,c.filter(r=>xe(r).isFullyConfigured).length,c.filter(r=>r.type==="תזמורת").length,c.filter(r=>r.type==="הרכב").length;const W=()=>{t(null),j(!0)},z=r=>{t(r),j(!0)},Q=async r=>{try{A?await L.updateOrchestra(A._id,r):await L.createOrchestra(r),j(!1),t(null),await M()}catch(h){throw console.error("Error saving orchestra:",h),h}},T=async r=>{if(window.confirm("האם אתה בטוח שברצונך למחוק את התזמורת?"))try{await L.deleteOrchestra(r),await M()}catch(h){console.error("Error deleting orchestra:",h),N("שגיאה במחיקת התזמורת")}},n=r=>{s(`/orchestras/${r}`)},w=r=>{R(r),y(!0)},O=()=>{y(!1),R(null)},I=[{key:"name",label:"שם",render:r=>{const h=ee(r.type);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg ml-2",children:h.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:h.text})]})]})}},{key:"conductor",label:"מנצח",render:r=>G(r)},{key:"members",label:"חברים",render:r=>ue(r.memberIds?.length||0)},{key:"rehearsals",label:"חזרות",render:r=>he(r.rehearsalIds?.length||0)},{key:"location",label:"מיקום",render:r=>r.location},{key:"status",label:"סטטוס",render:r=>{const h=se(r);return e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700",children:h.text})}}];return x?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען תזמורות..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsxs("button",{onClick:W,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"תזמורת חדשה"]})}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:d})}),f!=="dashboard"&&e.jsx(J,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש תזמורות...",value:g,onChange:r=>a(r.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.type,onChange:r=>k(h=>({...h,type:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"כל הסוגים"}),K.map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.conductorId,onChange:r=>k(h=>({...h,conductorId:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"כל המנצחים"}),i.map(r=>e.jsx("option",{value:r._id,children:r.personalInfo?.fullName},r._id))]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:C.location,onChange:r=>k(h=>({...h,location:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"כל המיקומים"}),P.map(r=>e.jsx("option",{value:r,children:r},r))]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.isActive===!0,onChange:r=>k(h=>({...h,isActive:r.target.checked?!0:void 0})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"רק פעילות"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.hasMembers===!0,onChange:r=>k(h=>({...h,hasMembers:r.target.checked?!0:void 0})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"mr-2 text-sm text-gray-700",children:"עם חברים"})]}),e.jsxs("button",{onClick:()=>{k({type:"",conductorId:"",location:"",isActive:void 0,hasMembers:void 0}),a("")},className:"px-3 py-1 text-sm text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"נקה מסננים"]})]})]})}),f!=="dashboard"&&e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["תזמורות והרכבים (",E.length,")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>D("dashboard"),className:`p-2 ${f==="dashboard"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"לוח בקרה",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D("grid"),className:`p-2 ${f==="grid"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"תצוגת כרטיסים",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D("table"),className:`p-2 ${f==="table"?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,title:"תצוגת טבלה",children:e.jsx(Oe,{className:"w-4 h-4"})})]}),e.jsxs("select",{value:F,onChange:r=>$(r.target.value),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"name",children:"מיון לפי שם"}),e.jsx("option",{value:"type",children:"מיון לפי סוג"}),e.jsx("option",{value:"conductor",children:"מיון לפי מנצח"}),e.jsx("option",{value:"memberCount",children:"מיון לפי מספר חברים"}),e.jsx("option",{value:"location",children:"מיון לפי מיקום"}),e.jsx("option",{value:"rehearsalCount",children:"מיון לפי חזרות"})]}),e.jsx("button",{onClick:()=>B(v==="asc"?"desc":"asc"),className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",title:v==="asc"?"מיון יורד":"מיון עולה",children:v==="asc"?"↑":"↓"}),e.jsx("button",{onClick:M,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"רענן"})]})]}),E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תזמורות"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"התחל על ידי יצירת התזמורת הראשונה"}),e.jsxs("button",{onClick:W,className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"צור תזמורת ראשונה"]})]}):f==="table"?e.jsx(je,{data:E,columns:I,onEdit:z,onDelete:r=>T(r._id),onView:r=>n(r._id),actions:!0}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(r=>e.jsx(Le,{orchestra:r,onEdit:z,onDelete:T,onViewDetails:n},r._id))})]}),f==="dashboard"&&e.jsx(Re,{onViewDetails:n,onEditOrchestra:z,onManageMembers:w,onDeleteOrchestra:T}),p&&e.jsx(Pe,{orchestra:A,teachers:i,onSubmit:Q,onCancel:()=>{j(!1),t(null)}}),S&&_&&e.jsx(Fe,{orchestraId:_,isOpen:S,onClose:O,onUpdate:M})]})}export{He as default};
