import{j as e,u as Le,V as Ue}from"../assets/index-BuDUjaWC.js";import{R as Mt,r as i,u as At,b as Et}from"./vendor-B2j9q2e_.js";import{a as W,t as st}from"./cascade-deletion-DIn3jFLV.js";import{M as Ce,I as at,O as Ge,T as Qe,U as Ae,e as Ie,Z as gt,b as he,d as fe,s as Be,r as xt,c as Ve,A as _e,X as Ne,an as _t,D as ht,ac as ft,S as pt,u as Ye,q as be,m as ke,f as pe,P as Ee,ab as yt,i as Re,B as Fe,g as Ot,G as dt,W as ct,ao as Pt,j as Rt,a6 as tt,aa as Pe,Y as Bt,ah as Ft,a3 as Ht,K as zt}from"./ui-ypR0-hKN.js";import{C as Wt}from"./ConfirmationModal-DfeYQfBS.js";import{t as mt}from"./theoryEnrollmentService-NWFKR1y3.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";function qt({student:t,onEdit:n,onDelete:o,onViewDetails:c,onScheduleLesson:u,onUpdateLesson:l,onMarkAttendance:s,onAddNote:a,className:p=""}){const b=t.academicInfo?.instrumentProgress?.find(N=>N.isPrimary)||t.academicInfo?.instrumentProgress?.[0],L=b?.instrumentName||"לא הוגדר",f=b?.currentStage||0,k=t.scheduleInfo||t.teacherAssignments?.[0],q=k?`${k.day} ${k.startTime||k.time}`:null,d=k?.duration||60,j=!!k,O=t.academicInfo?.isActive!==!1&&t.status!=="inactive",y=O?"text-green-800 bg-green-100":"text-red-800 bg-red-100",g=O?"פעיל":"לא פעיל",w=O?Ve:_e,R=j?"border-2 border-green-400 shadow-sm shadow-green-200":"border border-gray-200";return e.jsxs("div",{className:`bg-white ${R} rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${p}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan text-lg",children:t.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${y}`,children:[Mt.createElement(w,{className:"w-3 h-3"}),g]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ce,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-yonatan font-medium",children:L}),f>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-yonatan",children:["שלב ",f]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>c(t.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"צפה בפרטים מלאים",children:e.jsx(at,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>n(t),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"עריכת תלמיד",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תלמיד",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[t.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ae,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["גיל: ",t.personalInfo.age]})]}),t.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["כיתה: ",t.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:t.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:t.personalInfo.phone})]})})]}),q&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-yonatan",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"שיעור קבוע:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-yonatan text-blue-700",children:q}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsxs("span",{children:[d," דק'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>c(t.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(at,{className:"w-4 h-4"}),"פרטים מלאים"]}),j&&l?e.jsxs("button",{onClick:()=>l(t),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"עדכן שיעור קבוע"]}):u&&!j?e.jsxs("button",{onClick:()=>u(t.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"תזמן שיעור"]}):null,s&&e.jsxs("button",{onClick:()=>s(t.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4"}),"נוכחות"]}),a&&e.jsxs("button",{onClick:()=>a(t.id),className:"text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(xt,{className:"w-4 h-4"}),"הערה"]})]})})]})}function Ut({student:t,teacherId:n,onClose:o,onSave:c}){const[u,l]=i.useState(new Date().toISOString().split("T")[0]),[s,a]=i.useState(null),[p,b]=i.useState(""),[L,f]=i.useState(!1),[k,q]=i.useState(!1),[d,j]=i.useState(!1),[O,y]=i.useState(null),[g,w]=i.useState([]),[R,N]=i.useState(!1),[_,x]=i.useState(!1),$=t.personalInfo?.fullName||t.fullName||`${t.firstName} ${t.lastName}`.trim(),B=t.academicInfo?.instrumentProgress?.find(T=>T.isPrimary)?.instrumentName||"לא צוין",P=t.scheduleInfo;i.useEffect(()=>{Q(u)},[u]),i.useEffect(()=>{R&&g.length===0&&te()},[R]);const Q=async T=>{f(!0),y(null);try{const X=await W.attendance.getIndividualLessonAttendance({studentId:t.id,teacherId:n,date:T});X?(a(X.status),b(X.notes||"")):(a(null),b(""))}catch(X){console.error("Error loading attendance:",X),a(null),b("")}finally{f(!1)}},te=async()=>{x(!0);try{const T=await W.attendance.getStudentAttendanceHistory({studentId:t.id,teacherId:n,lessonType:"individual",limit:20});w(T)}catch(T){console.error("Error loading attendance history:",T),w([])}finally{x(!1)}},C=async()=>{if(!s){y("יש לבחור סטטוס נוכחות");return}q(!0),y(null);try{const T={studentId:t.id,teacherId:n,date:u,status:s,notes:p.trim(),lessonType:"individual",duration:P?.duration||45};await W.attendance.saveIndividualLessonAttendance(T),w(X=>{const se=X.filter(ce=>ce.date!==u);return[{...T,_id:Date.now().toString(),createdAt:new Date().toISOString()},...se]}),j(!0),setTimeout(()=>{j(!1),c&&c(),o()},1500)}catch(T){console.error("Error saving attendance:",T),y(T.message||"שגיאה בשמירת הנוכחות")}finally{q(!1)}},D=T=>{switch(T){case"present":return"bg-green-100 border-green-300 text-green-800 hover:bg-green-200";case"absent":return"bg-red-100 border-red-300 text-red-800 hover:bg-red-200"}},G=T=>{switch(T){case"present":return e.jsx(Ye,{className:"w-5 h-5"});case"absent":return e.jsx(Ne,{className:"w-5 h-5"})}},V=T=>{switch(T){case"present":return"נוכח";case"absent":return"נעדר"}},ee=T=>{const X=new Date(u);X.setDate(X.getDate()+T),l(X.toISOString().split("T")[0])},J=i.useMemo(()=>{const T=g.length,X=g.filter(le=>le.status==="present").length,se=g.filter(le=>le.status==="absent").length,ce=T>0?Math.round(X/T*100):0;return{total:T,present:X,absent:se,attendanceRate:ce}},[g]);return d?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes scaleIn {
            0% {
              transform: scale(0.7);
              opacity: 0;
            }
            50% {
              transform: scale(1.05);
            }
            100% {
              transform: scale(1);
              opacity: 1;
            }
          }
          @keyframes checkMark {
            0% {
              transform: scale(0) rotate(-45deg);
            }
            50% {
              transform: scale(1.2) rotate(-45deg);
            }
            100% {
              transform: scale(1) rotate(0deg);
            }
          }
          .animate-scale-in {
            animation: scaleIn 0.4s ease-out forwards;
          }
          .animate-check {
            animation: checkMark 0.6s ease-out 0.2s forwards;
          }
        `}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center animate-scale-in",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4 animate-check",children:e.jsx(Ve,{className:"h-10 w-10 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"הנוכחות נשמרה בהצלחה!"}),e.jsxs("p",{className:"text-gray-600",children:[$," סומן כ",V(s)," ב-",new Date(u).toLocaleDateString("he-IL")]})]})})]}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:o,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"סגור",children:e.jsx(Ne,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"רישום נוכחות - שיעור אישי"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:$}),P&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[P.day," ",P.startTime]})]})]})]}),e.jsx("button",{onClick:()=>N(!R),className:`p-2 rounded-lg transition-colors ${R?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"היסטוריה",title:"היסטוריית נוכחות",children:e.jsx(_t,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:B}),e.jsx("div",{className:"text-sm text-gray-600",children:t.personalInfo?.class&&`כיתה ${t.personalInfo.class}`})]}),g.length>0&&e.jsxs("div",{className:"text-center px-3 py-1 bg-white rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:[J.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"נוכחות"})]})]})})]}),e.jsx("div",{className:"p-6",children:R?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"היסטוריית נוכחות"}),e.jsx("button",{onClick:()=>N(!1),className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"חזור לרישום"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:J.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:J.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"נוכח"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:J.absent}),e.jsx("div",{className:"text-xs text-gray-600",children:"נעדר"})]})]}),_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-3"}),e.jsx("div",{className:"text-gray-600",children:"טוען היסטוריה..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h4",{className:"text-gray-900 font-medium mb-2",children:"אין היסטוריית נוכחות"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"התחל לרשום נוכחות כדי לראות היסטוריה"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:g.map(T=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${T.status==="present"?"bg-green-100":T.status==="absent"?"bg-red-100":T.status==="excused"?"bg-yellow-100":"bg-orange-100"}`,children:G(T.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:new Date(T.date).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),T.notes&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:T.notes})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${T.status==="present"?"bg-green-100 text-green-800":T.status==="absent"?"bg-red-100 text-red-800":T.status==="excused"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:V(T.status)})]},T._id))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"תאריך השיעור"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>ee(-7),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"שבוע קודם",children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsx("input",{type:"date",value:u,onChange:T=>l(T.target.value),max:new Date().toISOString().split("T")[0],className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-center font-medium"}),e.jsx("button",{onClick:()=>ee(7),disabled:u>=new Date().toISOString().split("T")[0],className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"שבוע הבא",children:e.jsx(ft,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"text-center mt-2 text-sm text-gray-600",children:new Date(u).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"סטטוס נוכחות *"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["present","absent"].map(T=>e.jsxs("button",{onClick:()=>a(T),className:`flex items-center justify-center gap-3 p-5 rounded-xl border-2 transition-all transform ${s===T?D(T)+" scale-105 shadow-lg ring-2 ring-offset-2 "+(T==="present"?"ring-green-500":"ring-red-500"):"bg-white border-gray-200 hover:border-gray-300 hover:shadow-md"}`,children:[G(T),e.jsx("span",{className:"font-semibold text-lg",children:V(T)})]},T))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות (אופציונלי)"}),e.jsx("textarea",{value:p,onChange:T=>b(T.target.value),placeholder:"הוסף הערות על השיעור, ההתקדמות או נושאים לתרגול...",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),O&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(_e,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-900",children:"שגיאה"}),e.jsx("div",{className:"text-red-700 text-sm",children:O})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:C,disabled:!s||k||L,className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold transition-all ${!s||k||L?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700 hover:shadow-lg transform hover:scale-105"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"שומר..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{children:"שמור נוכחות"})]})}),e.jsx("button",{onClick:o,disabled:k,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"ביטול"})]})]})})]})})}const Gt=[30,45,60];function Qt({action:t}={}){const{user:n}=Le(),[o,c]=i.useState([]),[u,l]=i.useState(!0),[s,a]=i.useState("");i.useState(!1),i.useState(null);const[p,b]=i.useState(null),[L,f]=i.useState(0);i.useState(!1);const[k,q]=i.useState({status:"all",instrument:"all",hasSchedule:"all",bagrutStatus:"all"});i.useState("cards"),i.useState(new Set),i.useState(!1);const[d,j]=i.useState(!1),[O,y]=i.useState([]),[g,w]=i.useState(!1),[R,N]=i.useState(!1),[_,x]=i.useState(!1),[$,B]=i.useState(null),[P,Q]=i.useState([]),[te,C]=i.useState(!1),[D,G]=i.useState(null);i.useEffect(()=>{V()},[n]),i.useEffect(()=>{t==="addStudent"&&!u&&(j(!0),ee())},[t,u]);const V=async(v=!0)=>{if(n?._id)try{v&&l(!0),b(null);const H=n._id,M=await W.teachers.getTeacher(H);if(!M)throw new Error("לא נמצא פרופיל מורה");const E=M?.teaching?.studentIds||[];try{const S=await W.teacherSchedule.getTimeBlocks(H);let Z=[];Array.isArray(S)?Z=S:S?.data&&Array.isArray(S.data)&&(Z=S.data),Q(Z.filter(Y=>Y._id&&Y._id!=="undefined"))}catch(S){console.warn("Failed to load teaching days:",S),Q([])}if(E.length===0){console.log("No students assigned to teacher"),c([]),f(0);return}const r=await W.students.getBatchStudents(E);if(!Array.isArray(r))throw new Error("תגובה לא תקינה מהשרת");const A=r.filter(S=>E.includes(S._id)||E.includes(S.id));A.length!==r.length&&console.warn(`🔧 Component-level filtering: ${A.length}/${r.length} students match teacher's student IDs`);const z=A.map(S=>{const Z=S.personalInfo?.fullName||"",Y=Z.split(" ");return{id:S._id,firstName:S.personalInfo?.firstName||Y[0]||"",lastName:S.personalInfo?.lastName||Y.slice(1).join(" ")||"",fullName:Z,email:S.personalInfo?.email||S.contactInfo?.email||"",phone:S.personalInfo?.phone||S.contactInfo?.phone||"",instrument:S.academicInfo?.primaryInstrument||S.primaryInstrument||"",grade:S.academicInfo?.gradeLevel||"",status:S.academicInfo?.isActive!==!1?"active":"inactive",joinDate:S.createdAt,personalInfo:{fullName:Z,phone:S.personalInfo?.phone||S.contactInfo?.phone,age:S.personalInfo?.age,class:S.personalInfo?.class||S.academicInfo?.class},academicInfo:{instrumentProgress:S.academicInfo?.instrumentProgress||[],isActive:S.academicInfo?.isActive!==!1},teacherAssignments:S.teacherAssignments||[],scheduleInfo:S.scheduleInfo}});c(z),f(0)}catch(H){console.error("Error loading teacher students:",H),b("שגיאה בטעינת רשימת התלמידים. בדוק את החיבור לאינטרנט ונסה שוב."),f(M=>M+1)}finally{v&&l(!1)}},ee=async()=>{try{w(!0);const v=await W.students.getStudents();if(!v||!Array.isArray(v)){console.error("Invalid response from getStudents"),y([]);return}const H=n?._id,E=(await W.teachers.getTeacher(H))?.teaching?.studentIds||[],r=v.filter(A=>!E.includes(A._id)&&!E.includes(A.id));y(r)}catch(v){console.error("Error loading all students:",v),y([])}finally{w(!1)}},J=o.filter(v=>{const H=s===""||`${v.firstName} ${v.lastName}`.toLowerCase().includes(s.toLowerCase())||v.instrument?.toLowerCase().includes(s.toLowerCase())||v.email?.toLowerCase().includes(s.toLowerCase()),M=k.status==="all"||v.status===k.status,E=k.instrument==="all"||v.instrument===k.instrument,r=v.scheduleInfo||v.teacherAssignments?.length>0,A=k.hasSchedule==="all"||k.hasSchedule==="yes"&&r||k.hasSchedule==="no"&&!r,z=v.academicInfo?.isBagrutStudent||v.academicInfo?.instrumentProgress?.some(Z=>Z.currentStage>=4),S=k.bagrutStatus==="all"||k.bagrutStatus==="yes"&&z||k.bagrutStatus==="no"&&!z;return H&&M&&E&&A&&S}),T=async v=>{const H=o.find(E=>E.id===v),M=H?.personalInfo?.fullName||H?.fullName||"התלמיד";if(window.confirm(`האם אתה בטוח שברצונך למחוק את ${M}?

פעולה זו תמחק את כל הנתונים הקשורים לתלמיד ולא ניתנת לביטול.`))try{await W.students.deleteStudent(v),c(r=>r.filter(A=>A.id!==v));const E=document.createElement("div");E.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",E.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${M} נמחק בהצלחה</div>`,document.body.appendChild(E),setTimeout(()=>E.remove(),3e3)}catch(E){console.error("Error deleting student:",E);const r=document.createElement("div");r.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>שגיאה במחיקת ${M}</div>`,document.body.appendChild(r),setTimeout(()=>r.remove(),5e3)}},X=v=>{window.location.href=`/students/${v}`},se=v=>{const H=o.find(M=>M.id===v);H&&(B(H),N(!0))},ce=v=>{B(v),x(!0)},le=v=>{const H=o.find(M=>M.id===v);H&&(G(H),C(!0))},ue=v=>{const H=o.find(M=>M.id===v);if(H){const M=prompt(`הוסף הערה עבור ${H.personalInfo?.fullName}:`);M&&M.trim()&&oe(`הערה נוספה עבור ${H.personalInfo?.fullName}`,"success")}},oe=(v,H)=>{const M=document.createElement("div");M.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${H==="success"?"bg-green-500 text-white":H==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,M.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${H==="success"?"✅":H==="error"?"❌":"ℹ️"} ${v}
    </div>`,document.body.appendChild(M),setTimeout(()=>M.remove(),3e3)},m=async(v,H)=>{try{const M=n?._id,E=await W.students.getStudent(v._id),r=(E.teacherAssignments||[]).findIndex(S=>S.teacherId===M),A={teacherId:M,day:H.lessonDay,time:H.lessonTime,duration:H.lessonDuration||45,location:H.lessonLocation||"",isActive:!0};let z;r>=0?(z=[...E.teacherAssignments||[]],z[r]={...z[r],...A}):z=[...E.teacherAssignments||[],A],await W.students.updateStudent(v._id,{teacherAssignments:z}),await V(),oe(`${v.personalInfo?.fullName} הוקצה בהצלחה`,"success"),j(!1)}catch(M){console.error("Error assigning student:",M),oe("שגיאה בהקצאת התלמיד","error")}};return u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תלמידים..."})]})}):p?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-yonatan",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-yonatan mt-1",children:p})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>V(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-yonatan",children:"נסה שוב"}),L>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-yonatan",children:"רענן דף"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"התלמידים שלי"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[o.length," תלמידים רשומים"]})]}),e.jsxs("button",{onClick:()=>{j(!0),ee()},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף תלמיד"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:s,onChange:v=>a(v.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),J.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:s?"לא נמצאו תלמידים":"אין תלמידים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:s?"נסה מילות חיפוש אחרות":"התחל בהוספת התלמיד הראשון שלך"}),!s&&e.jsxs("button",{onClick:()=>{j(!0),ee()},className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"הוסף תלמיד ראשון"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"סה״כ תלמידים"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:o.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"פעילים"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:o.filter(v=>v.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"עם שיעורים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:o.filter(v=>v.scheduleInfo||v.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:J.map(v=>e.jsx(qt,{student:v,onEdit:H=>{alert("עריכת תלמיד זמינה רק למנהלים")},onDelete:T,onViewDetails:X,onScheduleLesson:se,onUpdateLesson:ce,onMarkAttendance:le,onAddNote:ue},v.id))})]}),d&&e.jsx(Vt,{allStudents:O,loading:g,onClose:()=>{j(!1),y([])},onSubmit:m}),R&&$&&e.jsx(Yt,{student:$,teacherId:n?._id||"",teachingDays:P,onClose:()=>{N(!1),B(null)},onSave:()=>{N(!1),B(null),V(!1)},showNotification:oe}),_&&$&&e.jsx(Zt,{student:$,teacherId:n?._id||"",teachingDays:P,onClose:()=>{x(!1),B(null)},onSave:()=>{x(!1),B(null),V(!1)},showNotification:oe}),te&&D&&e.jsx(Ut,{student:D,teacherId:n?._id||"",onClose:()=>{C(!1),G(null)},onSave:()=>{V(!1)}})]})}function Vt({allStudents:t,loading:n,onClose:o,onSubmit:c}){const{user:u}=Le(),[l,s]=i.useState(""),[a,p]=i.useState(null),[b,L]=i.useState({lessonDay:"",lessonTime:"",lessonDuration:45,lessonLocation:"",instrument:""}),[f,k]=i.useState(!1),[q,d]=i.useState([]),[j,O]=i.useState(!1),[y,g]=i.useState(null),w=t.filter(x=>{const $=l.toLowerCase().trim();if(!$)return!0;const B=x.personalInfo?.fullName||`${x.personalInfo?.firstName||""} ${x.personalInfo?.lastName||""}`.trim(),P=x.personalInfo?.class||x.academicInfo?.class||"",Q=[x.academicInfo?.primaryInstrument,...x.academicInfo?.instrumentProgress?.map(D=>D.instrumentName)||[]].filter(Boolean).join(" "),te=`${B} ${P} ${Q}`.toLowerCase();return $.split(/\s+/).filter(D=>D.length>0).every(D=>te.includes(D))});i.useEffect(()=>{a&&u?._id&&R()},[a,u?._id]);const R=async()=>{if(u?._id){O(!0);try{const x=await W.teachers.getTeacher(u._id);console.log("Teacher data for slots:",x);const $=x.teaching?.timeBlocks?.filter(P=>P.isActive!==!1)||[];console.log("Time blocks found:",$);const B=[];$.forEach(P=>{const Q=P.startTime,te=P.endTime,C=P.day,[D,G]=Q.split(":").map(Number),[V,ee]=te.split(":").map(Number),J=D*60+G,X=V*60+ee-J;Gt.forEach(se=>{const ce=Math.floor(X/se);for(let le=0;le<ce;le++){const ue=J+le*se,oe=ue+se,m=Math.floor(ue/60),v=ue%60,H=Math.floor(oe/60),M=oe%60,E=`${m.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`,r=`${H.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`;x.teaching?.schedule?.some(z=>z.day===C&&z.time===E&&z.duration===se)||!1||B.push({_id:`${P._id||P.day}-${se}-${le}`,day:C,startTime:E,endTime:r,duration:se,isAvailable:!0,location:P.location,teacherName:x.personalInfo?.fullName,teacherId:x._id,instrument:x.professionalInfo?.instrument||x.teaching?.instrument})}})}),console.log("Generated available slots:",B),d(B)}catch(x){console.error("Error fetching teacher slots:",x),d([])}finally{O(!1)}}},N=x=>{g(x),L({lessonDay:x.day,lessonTime:x.startTime,lessonDuration:x.duration,lessonLocation:x.location||"",instrument:x.instrument||""})},_=async x=>{if(x.preventDefault(),!a){alert("אנא בחר תלמיד");return}if(!y){alert("אנא בחר זמן שיעור");return}k(!0);try{await c(a,b)}catch($){console.error("Error submitting assignment:",$)}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto flex flex-col",dir:"rtl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"הוסף תלמיד"}),n?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען רשימת תלמידים..."})]}):e.jsxs("form",{onSubmit:_,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"חפש תלמיד במערכת"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חפש לפי שם, כיתה או כלי נגינה...",value:l,onChange:x=>s(x.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 border border-gray-200 rounded-lg",children:w.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:l?"לא נמצאו תלמידים התואמים את החיפוש":"אין תלמידים זמינים להקצאה"}):e.jsx("div",{className:"divide-y divide-gray-200",children:w.map(x=>{const $=x.personalInfo?.fullName||`${x.personalInfo?.firstName||""} ${x.personalInfo?.lastName||""}`.trim(),B=x.personalInfo?.class||x.academicInfo?.class||"",P=x.academicInfo?.primaryInstrument||"",Q=a?._id===x._id;return e.jsx("div",{onClick:()=>p(x),className:`p-3 cursor-pointer transition-colors ${Q?"bg-indigo-50 border-r-4 border-indigo-600":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:$}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[B&&e.jsxs("span",{children:["כיתה ",B]}),P&&e.jsxs(e.Fragment,{children:[B&&" • ",e.jsx("span",{children:P})]})]})]}),Q&&e.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-4 h-4 text-white"})})]})},x._id)})})}),a&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:["בחר זמן שיעור עבור ",a.personalInfo?.fullName]}),y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-50 px-3 py-1 rounded-lg",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsxs("span",{children:["נבחר: ",y.day," ",y.startTime]})]})]}),j?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען זמנים פנויים..."})]}):q.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"בחר זמן ומשך שיעור מהאפשרויות הזמינות:"}),(()=>{const x=q.reduce(($,B)=>($[B.day]||($[B.day]=[]),$[B.day].push(B),$),{});return Object.entries(x).map(([$,B])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"יום ",$]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pr-1",children:B.sort((P,Q)=>P.startTime.localeCompare(Q.startTime)).map(P=>{const Q=y?._id===P._id;return e.jsx("button",{type:"button",onClick:()=>N(P),className:`p-3 border rounded-lg transition-all text-right ${Q?"border-indigo-600 bg-indigo-50 ring-2 ring-indigo-600":P.duration===30?"border-green-300 bg-green-50 hover:border-green-500 hover:bg-green-100":P.duration===45?"border-blue-300 bg-blue-50 hover:border-blue-500 hover:bg-blue-100":"border-purple-300 bg-purple-50 hover:border-purple-500 hover:bg-purple-100"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[P.startTime,"-",P.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${P.duration===30?"bg-green-100 text-green-800":P.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[P.duration," דק׳"]})]}),P.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Ie,{className:"w-3 h-3"}),P.location]}),P.instrument&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Ce,{className:"w-3 h-3"}),P.instrument]}),Q&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(Be,{className:"w-5 h-5 text-indigo-600"})})]})},P._id)})})]},$))})()]}):e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"אין זמנים פנויים"}),e.jsx("p",{className:"text-xs text-gray-400",children:"ייתכן שכל הזמנים הפנויים כבר תפוסים או שלא הוגדרו זמני הוראה"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{type:"submit",disabled:!a||!y||f,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"מקצה..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"הוסף תלמיד"]})}),e.jsxs("button",{type:"button",onClick:o,disabled:f,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"ביטול"]})]})]})]})})}function Yt({student:t,teacherId:n,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const[s,a]=i.useState({day:"",startTime:"",endTime:"",duration:45,location:"",notes:""}),[p,b]=i.useState(!1),L=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],f=[30,45,60],k=d=>{if(!s.startTime)return;const[j,O]=s.startTime.split(":").map(Number),y=j*60+O+d,g=Math.floor(y/60),w=y%60;a(R=>({...R,duration:d,endTime:`${String(g).padStart(2,"0")}:${String(w).padStart(2,"0")}`}))},q=async d=>{if(d.preventDefault(),!s.day||!s.startTime||!s.endTime){l("יש למלא את כל השדות הנדרשים","error");return}try{b(!0);const j={day:s.day,startTime:s.startTime,endTime:s.endTime,location:s.location||"חדר מוזיקה",duration:s.duration,notes:s.notes,studentId:t.id,studentName:t.personalInfo?.fullName||t.fullName,teacherId:n,recurring:{isRecurring:!0,excludeDates:[]}};await W.teacherSchedule.createTimeBlock(n,j),l("השיעור הקבוע נוצר בהצלחה","success"),u()}catch(j){console.error("Error creating lesson:",j),l(j.message||"שגיאה ביצירת השיעור","error")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["תזמן שיעור קבוע - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"יום"}),e.jsxs("select",{value:s.day,onChange:d=>a(j=>({...j,day:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),L.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:s.startTime,onChange:d=>{a(j=>({...j,startTime:d.target.value})),s.duration&&k(s.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"משך (דקות)"}),e.jsx("select",{value:s.duration,onChange:d=>k(Number(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:f.map(d=>e.jsxs("option",{value:d,children:[d," דק'"]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"מיקום"}),e.jsxs("select",{value:s.location,onChange:d=>a(j=>({...j,location:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),Ue.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:s.notes,onChange:d=>a(j=>({...j,notes:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"הערות נוספות..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:p,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:p?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:c,disabled:p,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"ביטול"})]})]})]})})}function Zt({student:t,teacherId:n,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const s=t.scheduleInfo||t.teacherAssignments?.[0],[a,p]=i.useState({day:s?.day||"",startTime:s?.startTime||s?.time||"",duration:s?.duration||45,endTime:s?.endTime||"",location:"",notes:""}),[b,L]=i.useState(!1),[f,k]=i.useState(null),q=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],d=[30,45,60];i.useEffect(()=>{j()},[]);const j=async()=>{try{const g=await W.teacherSchedule.getTimeBlocks(n);let w=[];Array.isArray(g)?w=g:g?.data&&Array.isArray(g.data)&&(w=g.data);const R=w.find(N=>N.studentId===t.id);R&&(k(R._id),p({day:R.day,startTime:R.startTime,endTime:R.endTime,duration:R.duration||45,location:R.location||"",notes:R.notes||""}))}catch(g){console.error("Error loading time block:",g)}},O=g=>{if(!a.startTime)return;const[w,R]=a.startTime.split(":").map(Number),N=w*60+R+g,_=Math.floor(N/60),x=N%60;p($=>({...$,duration:g,endTime:`${String(_).padStart(2,"0")}:${String(x).padStart(2,"0")}`}))},y=async g=>{if(g.preventDefault(),!f){l("לא נמצא שיעור קבוע לעדכון","error");return}if(!a.day||!a.startTime||!a.endTime){l("יש למלא את כל השדות הנדרשים","error");return}try{L(!0);const w={day:a.day,startTime:a.startTime,endTime:a.endTime,location:a.location||"חדר מוזיקה",duration:a.duration,notes:a.notes};await W.teacherSchedule.updateTimeBlock(n,f,w),l("השיעור הקבוע עודכן בהצלחה","success"),u()}catch(w){console.error("Error updating lesson:",w),l(w.message||"שגיאה בעדכון השיעור","error")}finally{L(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["עדכן שיעור קבוע - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"יום"}),e.jsxs("select",{value:a.day,onChange:g=>p(w=>({...w,day:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),q.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:a.startTime,onChange:g=>{p(w=>({...w,startTime:g.target.value})),a.duration&&O(a.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"משך (דקות)"}),e.jsx("select",{value:a.duration,onChange:g=>O(Number(g.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:d.map(g=>e.jsxs("option",{value:g,children:[g," דק'"]},g))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"מיקום"}),e.jsxs("select",{value:a.location,onChange:g=>p(w=>({...w,location:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),Ue.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:a.notes,onChange:g=>p(w=>({...w,notes:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"הערות נוספות..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:b,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:b?"מעדכן...":"עדכן"}),e.jsx("button",{type:"button",onClick:c,disabled:b,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"ביטול"})]})]})]})})}function Xt({isOpen:t,onClose:n,orchestraId:o,orchestraName:c,onSave:u}){const[l,s]=i.useState({date:"",startTime:"19:00",endTime:"21:00",location:"אולם מוזיקה",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""}),[a,p]=i.useState({}),[b,L]=i.useState(!1);i.useEffect(()=>{if(t){const d=new Date;d.setDate(d.getDate()+1),s(j=>({...j,date:d.toISOString().split("T")[0]}))}},[t]);const f=()=>{const d={};if(!l.date)d.date="יש לבחור תאריך";else{const j=new Date(l.date),O=new Date;O.setHours(0,0,0,0),j<O&&(d.date="לא ניתן לקבוע חזרה בעבר")}if(l.startTime||(d.startTime="יש לבחור שעת התחלה"),l.endTime||(d.endTime="יש לבחור שעת סיום"),l.startTime&&l.endTime){const j=new Date(`2000-01-01T${l.startTime}`);new Date(`2000-01-01T${l.endTime}`)<=j&&(d.endTime="שעת הסיום חייבת להיות אחרי שעת ההתחלה")}return l.location.trim()||(d.location="יש לציין מקום"),l.recurring&&!l.endRecurrence&&(d.endRecurrence="יש לציין תאריך סיום לחזרות קבועות"),p(d),Object.keys(d).length===0},k=async d=>{if(d.preventDefault(),!!f()){L(!0);try{await u(l),n(),s({date:"",startTime:"19:00",endTime:"21:00",location:"אולם מוזיקה",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""})}catch(j){console.error("Error saving rehearsal:",j)}finally{L(!1)}}},q=()=>{if(!l.startTime||!l.endTime)return"";const d=new Date(`2000-01-01T${l.startTime}`),O=(new Date(`2000-01-01T${l.endTime}`).getTime()-d.getTime())/(1e3*60);if(O<=0)return"";const y=Math.floor(O/60),g=O%60;return y===0?`${g} דקות`:g===0?`${y} שעות`:`${y} שעות ו-${g} דקות`};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"קביעת חזרה חדשה"}),e.jsx("button",{onClick:n,className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium font-reisinger-yonatan",children:["תזמורת: ",c]})]})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תאריך החזרה *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",required:!0,value:l.date,onChange:d=>s(j=>({...j,date:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.date?"border-red-300":"border-gray-300"}`})]}),a.date&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.startTime,onChange:d=>s(j=>({...j,startTime:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.startTime?"border-red-300":"border-gray-300"}`})]}),a.startTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.endTime,onChange:d=>s(j=>({...j,endTime:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.endTime?"border-red-300":"border-gray-300"}`})]}),a.endTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.endTime})]})]}),q()&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded font-reisinger-yonatan",children:["משך החזרה: ",q()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום החזרה *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",required:!0,value:l.location,onChange:d=>s(j=>({...j,location:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.location?"border-red-300":"border-gray-300"}`,placeholder:"למשל: אולם מוזיקה, חדר 101"})]}),a.location&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:l.notes,onChange:d=>s(j=>({...j,notes:d.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"הערות נוספות על החזרה (אופציונלי)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"recurring",type:"checkbox",checked:l.recurring,onChange:d=>s(j=>({...j,recurring:d.target.checked})),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring",className:"mr-2 text-sm text-gray-700 font-reisinger-yonatan",children:"חזרה קבועה (חוזרת)"})]}),l.recurring&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תדירות"}),e.jsxs("select",{value:l.recurrencePattern,onChange:d=>s(j=>({...j,recurrencePattern:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"weekly",children:"שבועי"}),e.jsx("option",{value:"biweekly",children:"דו-שבועי"}),e.jsx("option",{value:"monthly",children:"חודשי"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תאריך סיום החזרות הקבועות *"}),e.jsx("input",{type:"date",required:l.recurring,value:l.endRecurrence,onChange:d=>s(j=>({...j,endRecurrence:d.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.endRecurrence?"border-red-300":"border-gray-300"}`}),a.endRecurrence&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.endRecurrence})]}),e.jsxs("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded flex items-start gap-2",children:[e.jsx(_e,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"חזרות קבועות ייווצרו אוטומטית עד התאריך שצוין"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:b,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors font-reisinger-yonatan",children:b?"קובע חזרה...":"קבע חזרה"}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})}):null}function Kt(){const{user:t}=Le(),[n,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(""),[a,p]=i.useState(!1),[b,L]=i.useState(null),[f,k]=i.useState(null),[q,d]=i.useState([]),[j,O]=i.useState(null),[y,g]=i.useState("members");i.useState(!1);const[w,R]=i.useState(!1),[N,_]=i.useState([]),[x,$]=i.useState([]),[B,P]=i.useState(""),[Q,te]=i.useState(""),[C,D]=i.useState(null),[G,V]=i.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});i.useEffect(()=>{ee()},[t]);const ee=async()=>{if(t?._id)try{u(!0);const r=t._id,A=await W.teachers.getTeacher(r);if(!A)throw new Error("לא נמצא פרופיל מנצח");const z=A?.conducting?.orchestraIds||[];if(z.length===0){console.log("No orchestras assigned to conductor"),o([]);return}const S=await W.orchestras.getBatchOrchestras(z);if(!Array.isArray(S))throw new Error("תגובה לא תקינה מהשרת");const Z=S.map(Y=>({id:Y._id,name:Y.name,description:Y.description,type:Y.type,level:Y.level,memberCount:Y.memberCount||0,status:Y.status||"active",rehearsalDay:Y.rehearsalSchedule?.day,rehearsalTime:Y.rehearsalSchedule?.time,venue:Y.venue}));o(Z)}catch(r){console.error("Error loading conductor orchestras:",r),O("שגיאה בטעינת רשימת התזמורות")}finally{u(!1)}},J=async r=>{try{const S=((await W.orchestras.getOrchestra(r)).memberDetails||[]).map(Z=>{const Y=Z.personalInfo?.fullName||"",je=Y.trim().split(/\s+/),Xe=je[0]||"",Ke=je.slice(1).join(" ")||"",h=Z.academicInfo?.instrumentProgress?.find(ae=>ae.isPrimary),I=h?.instrumentName||Z.primaryInstrument||"לא צוין",F=h?.currentStage||0;return{id:Z._id,fullName:Y,firstName:Xe,lastName:Ke,instrument:I,currentStage:F,section:Z.section||"כללי",status:Z.status||"active",enrollmentDate:Z.enrollmentDate||new Date().toISOString(),performanceLevel:Z.performanceLevel||"intermediate",attendanceRate:Z.attendanceRate||null}});d(S)}catch(A){console.error("Error loading orchestra members:",A)}},T=async()=>{try{const r=await W.students.getStudents({status:"active",limit:200}),A=q.map(S=>S.id),z=r.filter(S=>!A.includes(S._id));_(z)}catch(r){console.error("Error loading available students:",r)}},X=async r=>{try{const z=(await W.rehearsals.getRehearsals({groupId:r,limit:20})).map(S=>{const Z=S.scheduledDate||S.date||S.rehearsalDate;let Y="תאריך לא זמין";if(Z)try{const je=new Date(Z);isNaN(je.getTime())||(Y=je.toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"}))}catch{console.warn("Failed to parse rehearsal date:",Z)}return{id:S._id,date:Y,time:S.startTime||"19:00",location:S.location||"אולם מוזיקה",duration:S.duration||120,status:S.status||"scheduled",attendanceCount:S.attendanceList?.length||0,totalMembers:q.length}});$(z)}catch(A){console.error("Error loading orchestra rehearsals:",A),$([])}},se=async r=>{if(f)try{await W.orchestras.addMember(f,r),await J(f),await T(),D({type:"success",message:"התלמיד נוסף בהצלחה לתזמורת"}),setTimeout(()=>D(null),3e3)}catch(A){console.error("Error adding member:",A),D({type:"error",message:"שגיאה בהוספת התלמיד לתזמורת"}),setTimeout(()=>D(null),3e3)}},ce=async r=>{f&&V({isOpen:!0,title:"הסרת תלמיד מהתזמורת",message:"האם אתה בטוח שברצונך להסיר את התלמיד מהתזמורת?",onConfirm:async()=>{V({...G,isOpen:!1});try{await W.orchestras.removeMember(f,r),await J(f),await T(),D({type:"success",message:"התלמיד הוסר בהצלחה מהתזמורת"}),setTimeout(()=>D(null),3e3)}catch(A){console.error("Error removing member:",A),D({type:"error",message:"שגיאה בהסרת התלמיד מהתזמורת"}),setTimeout(()=>D(null),3e3)}}})},le=async r=>{if(f)try{const A={groupId:f,groupType:"orchestra",scheduledDate:new Date(r.date).toISOString(),startTime:r.startTime,endTime:r.endTime,duration:ue(r.startTime,r.endTime),location:r.location,notes:r.notes,status:"scheduled"};if(r.recurring){const z=oe(A,r);await Promise.all(z.map(S=>W.rehearsals.createRehearsal(S))),D({type:"success",message:`${z.length} חזרות נוצרו בהצלחה`})}else await W.rehearsals.createRehearsal(A),D({type:"success",message:"חזרה נוצרה בהצלחה"});await X(f),R(!1),setTimeout(()=>D(null),3e3)}catch(A){console.error("Error scheduling rehearsal:",A),D({type:"error",message:"שגיאה ביצירת החזרה"}),setTimeout(()=>D(null),3e3)}},ue=(r,A)=>{const z=new Date(`2000-01-01T${r}`),S=new Date(`2000-01-01T${A}`);return Math.round((S.getTime()-z.getTime())/(1e3*60))},oe=(r,A)=>{const z=[],S=new Date(A.date),Z=new Date(A.endRecurrence);let Y=new Date(S);for(;Y<=Z;)switch(z.push({...r,scheduledDate:new Date(Y).toISOString()}),A.recurrencePattern){case"weekly":Y.setDate(Y.getDate()+7);break;case"biweekly":Y.setDate(Y.getDate()+14);break;case"monthly":Y.setMonth(Y.getMonth()+1);break}return z},m=n.filter(r=>l===""||r.name.toLowerCase().includes(l.toLowerCase())||r.type.toLowerCase().includes(l.toLowerCase())||r.description?.toLowerCase().includes(l.toLowerCase())),v=async r=>{V({isOpen:!0,title:"מחיקת תזמורת",message:"האם אתה בטוח שברצונך למחוק תזמורת זו? פעולה זו אינה ניתנת לביטול.",onConfirm:async()=>{V({...G,isOpen:!1});try{await W.orchestras.deleteOrchestra(r),o(A=>A.filter(z=>z.id!==r)),f===r&&(k(null),d([])),D({type:"success",message:"התזמורת נמחקה בהצלחה"}),setTimeout(()=>D(null),3e3)}catch(A){console.error("Error deleting orchestra:",A),D({type:"error",message:"שגיאה במחיקת התזמורת"}),setTimeout(()=>D(null),3e3)}}})},H=async r=>{try{if(b){const A={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue},z=await W.orchestras.updateOrchestra(b.id,A),S={id:z._id,name:z.name,description:z.description,type:z.type,level:z.level,memberCount:z.memberCount||0,status:z.status||"active",rehearsalDay:z.rehearsalSchedule?.day,rehearsalTime:z.rehearsalSchedule?.time,venue:z.venue};o(Z=>Z.map(Y=>Y.id===b.id?S:Y))}else{const A=t?._id,z={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue,conductorId:A},S=await W.orchestras.createOrchestra(z),Z={id:S._id,name:S.name,description:S.description,type:S.type,level:S.level,memberCount:S.memberCount||0,status:S.status||"active",rehearsalDay:S.rehearsalSchedule?.day,rehearsalTime:S.rehearsalSchedule?.time,venue:S.venue};o(Y=>[...Y,Z])}p(!1),L(null),D({type:"success",message:b?"התזמורת עודכנה בהצלחה":"התזמורת נוצרה בהצלחה"}),setTimeout(()=>D(null),3e3)}catch(A){console.error("Error saving orchestra:",A),D({type:"error",message:"שגיאה בשמירת פרטי התזמורת"}),setTimeout(()=>D(null),3e3)}},M=r=>{switch(r){case"youth":return"תזמורת נוער";case"adult":return"תזמורת מבוגרים";case"chamber":return"תזמורת קאמרית";case"symphony":return"תזמורת סימפונית";default:return r}},E=r=>{switch(r){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return r}};return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תזמורות..."})]})}):j?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:j})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"תזמורות שאני מנצח"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[n.length," תזמורות"]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף תזמורת"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תזמורות...",value:l,onChange:r=>s(r.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"לא נמצאו תזמורות":"אין תזמורות רשומות"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת התזמורת הראשונה שלך"})]}):m.map(r=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${f===r.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{k(r.id),J(r.id),X(r.id),g("members")},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[M(r.type)," • ",E(r.level)]}),r.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:r.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),L(r),p(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"עריכת תזמורת",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),v(r.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תזמורת",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.memberCount||0," חברים"]})]}),r.rehearsalDay&&e.jsxs("span",{children:["חזרות: ",r.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"פעיל":"לא פעיל"})]})]},r.id))}),f&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-1 p-1",children:[e.jsxs("button",{onClick:()=>g("members"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="members"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(pe,{className:"w-4 h-4 inline mr-2"}),"חברי התזמורת"]}),e.jsxs("button",{onClick:()=>{g("enrollment"),T()},className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="enrollment"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(be,{className:"w-4 h-4 inline mr-2"}),"רישום חברים"]}),e.jsxs("button",{onClick:()=>g("rehearsals"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="rehearsals"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(he,{className:"w-4 h-4 inline mr-2"}),"חזרות"]})]})}),e.jsxs("div",{className:"p-4",children:[y==="members"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["חברי התזמורת (",q.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש חברים...",value:Q,onChange:r=>te(r.target.value),className:"pl-4 pr-10 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})})]}),q.filter(r=>Q===""||`${r.firstName} ${r.lastName}`.toLowerCase().includes(Q.toLowerCase())||r.instrument.toLowerCase().includes(Q.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:Q?"לא נמצאו חברים":"אין חברים רשומים בתזמורת"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.filter(r=>Q===""||`${r.firstName} ${r.lastName}`.toLowerCase().includes(Q.toLowerCase())||r.instrument.toLowerCase().includes(Q.toLowerCase())).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r.status==="active"?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:r.fullName||`${r.firstName} ${r.lastName}`.trim()}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[r.instrument,r.currentStage?` - שלב ${r.currentStage}`:""]}),r.attendanceRate!==null&&r.attendanceRate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["נוכחות: ",r.attendanceRate,"%"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>ce(r.id),className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"הסר מהתזמורת",children:e.jsx(yt,{className:"w-4 h-4"})})})]},r.id))})]}),y==="enrollment"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"הוסף חברים חדשים"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:B,onChange:r=>P(r.target.value),className:"pl-4 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})]}),N.filter(r=>B===""||r.personalInfo?.fullName?.toLowerCase().includes(B.toLowerCase())||r.academicInfo?.primaryInstrument?.toLowerCase().includes(B.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:B?"לא נמצאו תלמידים":"אין תלמידים זמינים"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.filter(r=>B===""||r.personalInfo?.fullName?.toLowerCase().includes(B.toLowerCase())||r.academicInfo?.primaryInstrument?.toLowerCase().includes(B.toLowerCase())).map(r=>{const A=r.academicInfo?.instrumentProgress?.find(Z=>Z.isPrimary),z=A?.instrumentName||r.academicInfo?.primaryInstrument||"לא צוין כלי",S=A?.currentStage;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:r.personalInfo?.fullName}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[z,S?` - שלב ${S}`:""]})]}),e.jsxs("button",{onClick:()=>se(r._id),className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),"הוסף"]})]},r._id)})})]}),y==="rehearsals"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"חזרות התזמורת"}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),"קבע חזרה"]})]}),x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"אין חזרות מתוכננות"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:x.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[r.date," • ",r.time]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan flex items-center gap-2 mt-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),r.location,e.jsx(fe,{className:"w-3 h-3 mr-1"}),r.duration," דקות"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.attendanceCount,"/",r.totalMembers]}),e.jsx("div",{className:"text-xs text-gray-500",children:"נוכחות"})]})]},r.id))})]})]})]})]}),a&&e.jsx(Jt,{orchestra:b,onClose:()=>{p(!1),L(null)},onSubmit:H}),w&&f&&e.jsx(Xt,{isOpen:w,onClose:()=>R(!1),orchestraId:f,orchestraName:n.find(r=>r.id===f)?.name||"",onSave:le}),e.jsx(Wt,{isOpen:G.isOpen,title:G.title,message:G.message,onConfirm:G.onConfirm,onCancel:()=>V({...G,isOpen:!1}),variant:"danger",confirmText:"אישור",cancelText:"ביטול"}),C&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in",dir:"rtl",children:e.jsxs("div",{className:`flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg ${C.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[C.type==="success"?e.jsx(Ve,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(Re,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("span",{className:`font-medium font-reisinger-yonatan ${C.type==="success"?"text-green-800":"text-red-800"}`,children:C.message})]})})]})}function Jt({orchestra:t,onClose:n,onSubmit:o}){const[c,u]=i.useState({name:t?.name||"",description:t?.description||"",type:t?.type||"youth",level:t?.level||"beginner",status:t?.status||"active",rehearsalDay:t?.rehearsalDay||"",rehearsalTime:t?.rehearsalTime||"",venue:t?.venue||""}),l=s=>{s.preventDefault(),o(c)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"עריכת תזמורת":"הוספת תזמורת חדשה"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שם התזמורת *"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:s=>u(a=>({...a,name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תיאור"}),e.jsx("textarea",{value:c.description,onChange:s=>u(a=>({...a,description:s.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סוג תזמורת *"}),e.jsxs("select",{required:!0,value:c.type,onChange:s=>u(a=>({...a,type:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"תזמורת נוער"}),e.jsx("option",{value:"adult",children:"תזמורת מבוגרים"}),e.jsx("option",{value:"chamber",children:"תזמורת קאמרית"}),e.jsx("option",{value:"symphony",children:"תזמורת סימפונית"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"רמה *"}),e.jsxs("select",{required:!0,value:c.level,onChange:s=>u(a=>({...a,level:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום חזרות"}),e.jsx("input",{type:"text",value:c.rehearsalDay,onChange:s=>u(a=>({...a,rehearsalDay:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"כלומר: יום ראשון"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת חזרות"}),e.jsx("input",{type:"time",value:c.rehearsalTime,onChange:s=>u(a=>({...a,rehearsalTime:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום חזרות"}),e.jsx("input",{type:"text",value:c.venue,onChange:s=>u(a=>({...a,venue:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סטטוס"}),e.jsxs("select",{value:c.status,onChange:s=>u(a=>({...a,status:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function es(){const{user:t}=Le(),[n,o]=i.useState(new Date),[c,u]=i.useState(null),[l,s]=i.useState([]),[a,p]=i.useState([]),[b,L]=i.useState(!0),[f,k]=i.useState(null),[q,d]=i.useState(!1),[j,O]=i.useState(null),[y,g]=i.useState(""),[w,R]=i.useState(!1),[N,_]=i.useState(null),[x,$]=i.useState(!1),[B,P]=i.useState(null),[Q,te]=i.useState(!1),[C,D]=i.useState(null),[G,V]=i.useState(!1),[ee,J]=i.useState("");i.useEffect(()=>{T()},[n,t]);const T=async()=>{if(t?._id)try{L(!0);const h=t._id,I=await W.teacherSchedule.getTimeBlocks(h);console.log("Raw API Response:",I);let F=[];try{if(Array.isArray(I))F=I;else if(I?.data&&Array.isArray(I.data))F=I.data;else if(I?.timeBlocks&&Array.isArray(I.timeBlocks))F=I.timeBlocks;else if(I&&typeof I=="object"){const U=Object.values(I).find(ie=>Array.isArray(ie));U?F=U:(console.warn("No array found in response, using empty array"),F=[])}else console.warn("Unexpected timeBlocks format:",I),F=[]}catch(U){console.error("Error parsing timeBlocks response:",U),F=[]}console.log("Parsed timeBlocks:",F),console.log("Time block IDs:",F.map(U=>({_id:U._id,day:U.day,time:`${U.startTime}-${U.endTime}`,location:U.location})));const ae=F.filter(U=>U._id&&U._id!=="undefined");console.log("Valid timeBlocks after filtering:",ae),p(ae);const xe=await W.teachers.getTeacher(h);console.log("Teacher profile:",xe);let ne=[];if(xe?.teaching?.studentIds?.length>0)try{ne=await W.students.getBatchStudents(xe.teaching.studentIds),console.log("Students loaded:",ne)}catch(U){console.warn("Failed to load students:",U)}else console.log("No student IDs found in teacher profile");console.log("Creating lesson blocks from student assignments...");const K=[];ne.forEach(U=>{console.log("Processing student:",U.personalInfo?.fullName),console.log("Student assignments:",U.teacherAssignments),U.teacherAssignments&&U.teacherAssignments.forEach(ie=>{if(ie.teacherId===h){console.log("Creating lesson from assignment:",ie);const De=ie.time||ie.startTime,Je=ie.duration||45,et=(Oe,Ct)=>{const[It,Lt]=Oe.split(":").map(Number),ot=It*60+Lt+Ct,$t=Math.floor(ot/60),Dt=ot%60;return`${$t.toString().padStart(2,"0")}:${Dt.toString().padStart(2,"0")}`},Se=ie.endTime||et(De,Je),Tt=a.find(Oe=>Oe.day===ie.day)?.location||"",kt={_id:`${U._id}-${ie.day}-${ie.time}`,day:ie.day,startTime:De,endTime:Se,totalDuration:Je,studentId:U._id,studentName:U.personalInfo?.fullName,teacherId:h,instrument:U.academicInfo?.instrumentProgress?.find(Oe=>Oe.isPrimary)?.instrumentName,location:ie.location||Tt,type:"lesson"};console.log(`Creating lesson: Student="${U.personalInfo?.fullName}", Day="${ie.day}", Time="${De}-${Se}"`),K.push(kt)}})}),console.log("Converted lessons from assignments:",K);const me=K.map(U=>{const ie=ne.find(Se=>Se.teacherAssignments?.some(We=>We.teacherId===h&&We.day===U.day&&We.time===U.startTime)),De=ie?.academicInfo?.instrumentProgress?.find(Se=>Se.isPrimary)||ie?.academicInfo?.instrumentProgress?.[0],et=a.find(Se=>Se.day===U.day)?.location||"";return{id:U._id||U.id||`${U.day}-${U.startTime}`,day:U.day,startTime:U.startTime,endTime:U.endTime,studentName:ie?ie.personalInfo?.fullName:U.studentName,studentId:ie?._id||U.studentId,instrument:De?.instrumentName||U.instrument,location:U.location||et,notes:U.notes,recurring:U.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:U.totalDuration||se(U.startTime,U.endTime),studentClass:ie?.personalInfo?.class||ie?.academicInfo?.class,studentPhone:ie?.personalInfo?.phone,studentStage:De?.currentStage}});s(me);const ge=ce(n),ye=le(n),ze=X(ge,me);console.log("Generated calendar days:",ze),console.log("Calendar week range:",{weekStart:ge,weekEnd:ye}),console.log("Mapped lesson days for calendar:",me),u({weekStart:ge,weekEnd:ye,days:ze})}catch(h){console.error("Error loading schedule:",h),k("שגיאה בטעינת לוח הזמנים")}finally{L(!1)}},X=(h,I)=>{const F=[],ae=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],xe=new Map;ae.forEach((K,de)=>{xe.set(K,de)}),console.log("=== GENERATING CALENDAR ==="),console.log("weekStart:",h,"Day:",h.getDay()),console.log("lessons input:",I),console.log("Day name mapping:",Array.from(xe.entries()));const ne=new Map;I.forEach(K=>{ne.has(K.day)||ne.set(K.day,[]),ne.get(K.day).push(K)}),console.log("Lessons grouped by day:",Array.from(ne.keys()));for(let K=0;K<7;K++){const de=new Date(h);de.setDate(h.getDate()+K);const me=ae[K],ge=ne.get(me)||[];console.log(`Day ${K} (${me}): found ${ge.length} lessons`,ge.map(ye=>({day:ye.day,time:ye.startTime,student:ye.studentName}))),F.push({date:de.toISOString().split("T")[0],dayName:me,lessons:ge})}return console.log("Generated calendar days with lessons:",F.map(K=>({dayName:K.dayName,lessonCount:K.lessons.length}))),F},se=(h,I)=>{const[F,ae]=h.split(":").map(Number),[xe,ne]=I.split(":").map(Number);return xe*60+ne-(F*60+ae)},ce=h=>{const I=new Date(h),F=I.getDay(),ae=I.getDate()-F;return I.setDate(ae),I.setHours(0,0,0,0),console.log("getWeekStart: input date:",h,"weekStart (Sunday):",I,"day:",I.getDay()),I},le=h=>{const I=ce(h);return I.setDate(I.getDate()+6),I},ue=h=>{const I=new Date(n);I.setDate(n.getDate()+(h==="next"?7:-7)),o(I)},oe=h=>h.slice(0,5),m=h=>new Date(h).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),v=()=>{O(null),d(!0)},H=h=>{console.log("handleEditLessonDay called with:",{studentId:h.studentId,studentName:h.studentName,id:h.id,_id:h._id,type:h.type}),h.studentId&&h.studentName?(console.log("Opening EditLessonModal for student lesson"),P(h),$(!0)):(console.log("Opening LessonDayModal for teaching day/availability block"),O(h),d(!0))},M=h=>{console.log("handleEditTeachingDay called with:",{_id:h._id,id:h.id,day:h.day,startTime:h.startTime,hasStudentId:!!h.studentId,fullData:h});const I={id:h._id||h.id,day:h.day,startTime:h.startTime,endTime:h.endTime,location:h.location||"חדר מוזיקה",notes:h.notes||"",recurring:h.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:se(h.startTime,h.endTime)};console.log("Opening LessonDayModal with lessonDay:",I),O(I),d(!0)},E=async h=>{D({message:"האם אתה בטוח שברצונך למחוק יום לימוד זה? פעולה זו תבטל את הזמינות שלך בזמן זה.",onConfirm:async()=>{try{await W.teacherSchedule.deleteTimeBlock(t?._id,h._id||h.id),r("יום הלימוד נמחק בהצלחה","success"),T()}catch(I){console.error("Error deleting teaching day:",I),r("שגיאה במחיקת יום הלימוד","error")}}}),te(!0)},r=(h,I)=>{const F=document.createElement("div");F.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${I==="success"?"bg-green-500 text-white":I==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,F.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${I==="success"?"✅":I==="error"?"❌":"ℹ️"} ${h}
    </div>`,document.body.appendChild(F),setTimeout(()=>F.remove(),3e3)},A=h=>{J(h),V(!0)},z=()=>{const h=[];for(let I=7;I<=21;I++)h.push(`${I.toString().padStart(2,"0")}:00`),h.push(`${I.toString().padStart(2,"0")}:30`);return h},S=(h,I)=>{const F=c?.days.find(ne=>ne.date===h),ae=ne=>{const[K,de]=ne.split(":").map(Number);return K*60+de};return F?.lessons.find(ne=>{const K=ae(I),de=K+30,me=ae(ne.startTime),ge=ae(ne.endTime),ye=me>=K&&me<de,ze=K>=me&&K<ge;return ye||ze})},Z=h=>{const I=se(h.startTime,h.endTime);return Math.ceil(I/30)*60},Y=(h,I)=>{const F=h.startTime,ae=I,xe=me=>{const[ge,ye]=me.split(":").map(Number);return ge*60+ye},ne=xe(F),K=xe(ae),de=K+30;return ne>=K&&ne<de},je=(h,I)=>{const F=de=>{const[me,ge]=de.split(":").map(Number);return me*60+ge},ae=F(I),xe=ae+30;return a.some(de=>{if(de.day!==h)return!1;const me=F(de.startTime),ge=F(de.endTime);return ae>=me&&xe<=ge})?!l.some(de=>{if(de.day!==h)return!1;const me=F(de.startTime),ge=F(de.endTime);return ae<ge&&xe>me}):!1},Xe=(h,I,F)=>{je(F,I)&&(_({date:h,time:I,dayName:F}),R(!0))};if(l.filter(h=>{if(!y)return!0;const I=y.toLowerCase();return h.studentName?.toLowerCase().includes(I)||h.instrument?.toLowerCase().includes(I)||h.location?.toLowerCase().includes(I)||h.day.toLowerCase().includes(I)}),b)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען לוח זמנים..."})]})});if(f&&!c)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:f})});const Ke=z();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"לוח זמנים שבועי"}),e.jsx("p",{className:"text-gray-600 mt-1",children:c&&`${m(c.weekStart.toISOString().split("T")[0])} - ${m(c.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ue("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>o(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-yonatan",children:"השבוע"}),e.jsx("button",{onClick:()=>ue("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ft,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-yonatan",children:"שעה"}),c?.days.map(h=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-yonatan",children:m(h.date)})]},h.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto relative",children:Ke.map(h=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",style:{height:"60px"},children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-yonatan flex items-center",children:oe(h)}),c?.days.map(I=>{const F=S(I.date,h),ae=!F&&je(I.dayName,h);return e.jsxs("div",{className:`border-l border-gray-100 relative transition-all duration-300 group ${ae?"bg-blue-50/30 hover:bg-blue-100/50 cursor-pointer border-2 border-transparent hover:border-blue-200":"cursor-default"}`,style:{height:"60px"},onClick:()=>!F&&Xe(I.date,h,I.dayName),title:ae?"לחץ להוספת שיעור חדש":"",children:[ae&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center opacity-30 group-hover:opacity-100 transition-all duration-300 group-hover:scale-110",children:[e.jsx(Ee,{className:"w-6 h-6 text-blue-500"}),e.jsx("span",{className:"text-[10px] text-blue-600 font-medium mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:"הוסף שיעור"})]})}),F&&Y(F,h)&&e.jsx("div",{className:"absolute left-1 right-1 top-1 p-2.5 rounded text-xs font-reisinger-yonatan bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm cursor-pointer transition-all hover:scale-[1.02] z-10 overflow-hidden",style:{height:`${Z(F)-2}px`,minHeight:"82px"},onClick:()=>H(F),title:`${F.studentName||"תלמיד"} - ${F.instrument||""}`,children:e.jsx("div",{className:"flex flex-col h-full justify-between",children:e.jsxs("div",{className:"flex-shrink-0 space-y-1",children:[e.jsxs("div",{className:"font-medium truncate flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3 opacity-60"}),F.studentName||"תלמיד"]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[oe(F.startTime),"-",oe(F.endTime)]}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-80 h-4",children:F.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:F.instrument})]}):e.jsx("span",{className:"invisible",children:"placeholder"})}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-70 h-4",children:F.location?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:F.location})]}):e.jsx("span",{className:"invisible",children:"placeholder"})})]})})})]},`${I.date}-${h}`)})]},h))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"ימי לימוד - זמינות המורה"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"הגדר את הימים והשעות שבהם אתה זמין להוראה"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף יום לימוד"})]})})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(Fe,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan text-lg",children:"אין ימי לימוד מוגדרים"}),e.jsx("button",{onClick:v,className:"mt-4 text-indigo-600 hover:text-indigo-700 font-medium",children:"הוסף יום לימוד ראשון"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(h=>e.jsx(ts,{teachingDay:h,onEdit:()=>M(h),onDelete:()=>E(h)},h._id||h.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"ימי לימוד"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-yonatan",children:a.length}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"ימי זמינות להוראה"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"שעות זמינות"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-yonatan",children:(a.reduce((h,I)=>{const F=se(I.startTime,I.endTime);return h+F},0)/60).toFixed(1)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"שעות שבועיות זמינות"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"תלמידים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-yonatan",children:new Set(l.map(h=>h.studentId).filter(Boolean)).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"תלמידים פעילים"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900 font-reisinger-yonatan",children:"שיעורים"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900 mt-2 font-reisinger-yonatan",children:l.length}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"שיעורים קבועים"})]})]}),w&&N&&e.jsx(as,{timeSlot:N,teacherId:t?._id||"",teachingDays:a,onClose:()=>{R(!1),_(null)},onSave:()=>{R(!1),_(null),T()},showNotification:r}),q&&e.jsx(ss,{lessonDay:j,teacherId:t?._id||"",onClose:()=>{d(!1),O(null)},onSave:()=>{d(!1),O(null),T()},showAlert:A}),x&&B&&e.jsx(is,{lesson:B,teacherId:t?._id||"",teachingDays:a,onClose:()=>{$(!1),P(null)},onSave:()=>{$(!1),P(null),T()},showAlert:A}),Q&&C&&e.jsx(rs,{message:C.message,onConfirm:()=>{C.onConfirm(),te(!1),D(null)},onCancel:()=>{te(!1),D(null)}}),G&&e.jsx(ns,{message:ee,onClose:()=>{V(!1),J("")}})]})}function ts({teachingDay:t,onEdit:n,onDelete:o}){return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(he,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-gray-900 font-reisinger-yonatan",children:["יום ",t.day]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"זמינות להוראה"})]})]}),t.isRecurring!==!1&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full font-reisinger-yonatan",children:"שבועי"})]}),e.jsx("div",{className:"mb-3 pb-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]})}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{children:t.location})]}),e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:"זמין לקביעת שיעורים בזמן זה"})]})}),t.notes&&e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:t.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:n,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors text-sm",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"ערוך"})]}),e.jsx("button",{onClick:o,className:"flex items-center justify-center p-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"מחק יום לימוד",children:e.jsx(Qe,{className:"w-3.5 h-3.5"})})]})]})}function ss({lessonDay:t,teacherId:n,onClose:o,onSave:c,showAlert:u}){const[l,s]=i.useState({day:t?.day||"ראשון",startTime:t?.startTime||"14:00",endTime:t?.endTime||"18:00",location:t?.location||"חדר מוזיקה",notes:t?.notes||"",recurring:t?.recurring||{isRecurring:!0,excludeDates:[]}}),[a,p]=i.useState(!1),b=async f=>{if(f.preventDefault(),t?.studentId){u("לא ניתן לערוך שיעור תלמיד מכאן. אנא השתמש באפשרות העריכה בכרטיס השיעור.");return}if(!l.day||!l.startTime||!l.endTime){u("יש למלא את כל השדות הנדרשים");return}try{p(!0);const k={day:l.day,startTime:l.startTime,endTime:l.endTime,location:l.location||null,notes:l.notes||null,recurring:l.recurring||{isRecurring:!0,excludeDates:[]}};t?.id&&/^[0-9a-fA-F]{24}$/.test(t.id)?await W.teacherSchedule.updateTimeBlock(n,t.id,k):await W.teacherSchedule.createTimeBlock(n,k),c()}catch(k){console.error("Error saving lesson day:",k),k?.message?.includes("not found")||k?.message?.includes("Resource not found")?(u("יום הלימוד הזה כבר לא קיים במערכת. הוא יוסר מהתצוגה."),o(),c()):u("שגיאה בשמירת יום הלימוד")}finally{p(!1)}},L=()=>["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:t?"עריכת יום לימוד":"הוספת יום לימוד חדש"}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(Ne,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום בשבוע *"}),e.jsx("select",{value:l.day,onChange:f=>s(k=>({...k,day:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:L().map(f=>e.jsx("option",{value:f,children:f},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsx("input",{type:"time",value:l.startTime,onChange:f=>s(k=>({...k,startTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:l.endTime,onChange:f=>s(k=>({...k,endTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מיקום / חדר"}),e.jsxs("select",{value:l.location||"",onChange:f=>s(k=>({...k,location:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר חדר"}),Ue.map(f=>e.jsx("option",{value:f,children:f},f))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:l.notes||"",onChange:f=>s(k=>({...k,notes:f.target.value})),rows:3,placeholder:"הערות נוספות לגבי השיעור...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.recurring?.isRecurring!==!1,onChange:f=>s(k=>({...k,recurring:{isRecurring:f.target.checked,excludeDates:k.recurring?.excludeDates||[]}})),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"שיעור קבוע (חוזר שבועית)"})]}),l.recurring?.isRecurring&&e.jsx("p",{className:"text-xs text-gray-500 mr-6 mt-1",children:"השיעור יופיע באופן קבוע בכל שבוע ביום ובשעה שהוגדרו"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:a,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"שומר..."]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),"עדכן יום לימוד"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4"}),"הוסף יום לימוד"]})})}),e.jsx("button",{type:"button",onClick:o,disabled:a,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function as({timeSlot:t,teacherId:n,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const[s,a]=i.useState(""),[p,b]=i.useState(45),[L,f]=i.useState([]),[k,q]=i.useState(!1),[d,j]=i.useState(!1),[O,y]=i.useState(0),[g,w]=i.useState(""),[R,N]=i.useState(!1);i.useEffect(()=>{_()},[]),i.useEffect(()=>{const C=D=>{D.target.closest(".student-search-dropdown")||N(!1)};return R&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[R]);const _=async()=>{try{q(!0);const D=(await W.students.getStudents()).map(G=>{const V=G.academicInfo?.instrumentProgress?.find(ee=>ee.isPrimary)||G.academicInfo?.instrumentProgress?.[0];return{id:G._id,firstName:G.personalInfo?.firstName||G.personalInfo?.fullName?.split(" ")[0]||"",lastName:G.personalInfo?.lastName||G.personalInfo?.fullName?.split(" ").slice(1).join(" ")||"",instrument:V?.instrumentName||"",class:G.personalInfo?.class||G.academicInfo?.class,stage:V?.currentStage}});f(D)}catch(C){console.error("Error loading students:",C)}finally{q(!1)}},x=L.filter(C=>{if(!g)return!0;const D=g.toLowerCase();return`${C.firstName} ${C.lastName}`.toLowerCase().includes(D)||C.instrument?.toLowerCase().includes(D)||C.class?.toLowerCase().includes(D)}),$=(C,D)=>{const[G,V]=C.split(":").map(Number),ee=G*60+V+D,J=Math.floor(ee/60),T=ee%60;return`${J.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},B=()=>{const[C]=t.time.split(":").map(Number),D=O;return`${C.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`},P=[0,5,10,15,20,25,30,35,40,45,50,55],Q=async C=>{if(C.preventDefault(),!s){l("יש לבחור תלמיד","error");return}try{j(!0);const D=L.find(oe=>oe.id===s),G=B(),V=$(G,p);console.log("📝 Creating lesson for student:",D),console.log("📅 Lesson details:",{day:t.dayName,time:G,duration:p});const J=o.find(oe=>oe.day===t.dayName)?.location||"",T={teacherId:n,day:t.dayName,time:G,endTime:V,duration:p,location:J,isActive:!0,startDate:new Date().toISOString(),isRecurring:!0};console.log("📖 Fetching student data...");const se=[...(await W.students.getStudent(s)).teacherAssignments||[],T];console.log("💾 Updating student with teacher assignment..."),await W.students.updateStudent(s,{teacherAssignments:se}),console.log("👨‍🏫 Updating teacher student list...");const ce=await W.teachers.getTeacher(n),le=ce.teaching?.studentIds||[];le.includes(s)||await W.teachers.updateTeacher(n,{teaching:{...ce.teaching,studentIds:[...le,s]}});const ue={day:t.dayName,startTime:G,endTime:V,studentId:s,studentName:D?`${D.firstName} ${D.lastName}`:"",instrument:D?.instrument||"",location:J,notes:`שיעור קבוע שבועי - נוצר ב-${new Date().toLocaleDateString("he-IL")}`,recurring:{isRecurring:!0,excludeDates:[]},isRecurring:!0,totalDuration:p};console.log("📋 Creating time block for teacher schedule..."),await W.teacherSchedule.createTimeBlock(n,ue),console.log("✅ Lesson created successfully!"),l("השיעור נוצר בהצלחה!","success"),u()}catch(D){console.error("❌ Error creating weekly lesson assignment:",D),l(`שגיאה ביצירת השיעור השבועי: ${D.message||"שגיאה לא ידועה"}`,"error")}finally{j(!1)}},te=C=>C.slice(0,5);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"הוספת שיעור חדש"}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(Ne,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 mb-2",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["שיעור קבוע שבועי - יום ",t.dayName]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{children:[te(B())," - ",te($(B(),p))," (",p," דקות)"]})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["השיעור יתקיים כל שבוע ביום ",t.dayName," באותה שעה"]})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"בחר תלמיד *"}),k?e.jsx("div",{className:"text-center py-2 text-gray-500",children:"טוען רשימת תלמידים..."}):e.jsxs("div",{className:"relative student-search-dropdown",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:C=>{w(C.target.value),N(!0)},onFocus:()=>N(!0),placeholder:"חפש תלמיד לפי שם, כלי נגינה או כיתה...",className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),s&&!R&&e.jsx("div",{className:"mt-2 p-2 bg-indigo-50 border border-indigo-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-indigo-900",children:[L.find(C=>C.id===s)?.firstName," ",L.find(C=>C.id===s)?.lastName]}),L.find(C=>C.id===s)?.instrument&&e.jsxs("span",{className:"text-indigo-700",children:[" - ",L.find(C=>C.id===s)?.instrument]})]}),e.jsx("button",{type:"button",onClick:()=>{a(""),w(""),N(!0)},className:"text-indigo-600 hover:text-indigo-800",children:e.jsx(Ne,{className:"w-4 h-4"})})]})}),R&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.length>0?x.map(C=>e.jsxs("button",{type:"button",onClick:()=>{a(C.id),w(`${C.firstName} ${C.lastName}`),N(!1)},className:`w-full text-right px-3 py-2 hover:bg-indigo-50 transition-colors border-b border-gray-100 last:border-b-0 ${s===C.id?"bg-indigo-100":""}`,children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[C.firstName," ",C.lastName]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:[C.instrument&&`${C.instrument}`,C.class&&` • כיתה ${C.class}`,C.stage&&` • שלב ${C.stage}`]})]},C.id)):e.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"לא נמצאו תלמידים מתאימים"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:["זמן התחלה מדויק (שעה ",t.time.split(":")[0],":__)"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:P.map(C=>e.jsxs("button",{type:"button",onClick:()=>y(C),className:`px-3 py-2 rounded-lg border-2 transition-all font-medium ${O===C?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[":",C.toString().padStart(2,"0")]},C))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["שעת התחלה: ",B()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות)"}),e.jsxs("select",{value:p,onChange:C=>b(Number(C.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:30,children:"30 דקות"}),e.jsx("option",{value:45,children:"45 דקות"}),e.jsx("option",{value:60,children:"60 דקות"}),e.jsx("option",{value:90,children:"90 דקות"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:d||!s,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"יוצר שיעור שבועי..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),"צור שיעור שבועי"]})}),e.jsx("button",{type:"button",onClick:c,disabled:d,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function rs({message:t,onConfirm:n,onCancel:o}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(_e,{className:"w-8 h-8 text-orange-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-4 font-reisinger-yonatan",children:t}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,className:"flex-1 bg-red-600 text-white py-2.5 px-4 rounded-lg hover:bg-red-700 transition-colors font-reisinger-yonatan font-medium",children:"אישור"}),e.jsx("button",{onClick:o,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 transition-colors font-reisinger-yonatan font-medium",children:"ביטול"})]})]})})}function ns({message:t,onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(_e,{className:"w-8 h-8 text-blue-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-6 font-reisinger-yonatan",children:t}),e.jsx("button",{onClick:n,className:"w-full bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan font-medium",children:"הבנתי"})]})})}function is({lesson:t,teacherId:n,teachingDays:o,onClose:c,onSave:u,showAlert:l}){const s=(N,_)=>{const[x,$]=N.split(":").map(Number),[B,P]=_.split(":").map(Number);return B*60+P-(x*60+$)},p=o.find(N=>N.day===t.day)?.location||"",[b,L]=i.useState({day:t.day,startTime:t.startTime,endTime:t.endTime,location:t.location||p,notes:t.notes||""}),[f,k]=i.useState(!1),[q,d]=i.useState(s(t.startTime,t.endTime)),[j,O]=i.useState([]);i.useState(""),i.useEffect(()=>{if(!b.day||!q)return;const N=o.filter(x=>x.day===b.day),_=[];N.forEach(x=>{const[$,B]=x.startTime.split(":").map(Number),[P,Q]=x.endTime.split(":").map(Number),te=$*60+B,D=P*60+Q-te,G=Math.floor(D/q);for(let V=0;V<G;V++){const ee=te+V*q,J=ee+q,T=Math.floor(ee/60),X=ee%60,se=Math.floor(J/60),ce=J%60,le=`${T.toString().padStart(2,"0")}:${X.toString().padStart(2,"0")}`,ue=`${se.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`;_.push({id:`${x._id||x.id}-${q}-${V}`,startTime:le,endTime:ue,duration:q})}}),O(_)},[b.day,q,o]);const y=N=>{L(_=>({..._,startTime:N.startTime,endTime:N.endTime}))},g=async N=>{if(N.preventDefault(),!b.day||!b.startTime||!b.endTime){l("יש למלא את כל השדות הנדרשים");return}const _=s(b.startTime,b.endTime);if(_<=0){l("זמן הסיום חייב להיות לאחר זמן ההתחלה");return}try{if(k(!0),t.studentId){const x={teacherId:n,day:b.day,time:b.startTime,startTime:b.startTime,endTime:b.endTime,duration:_,location:b.location,isActive:!0};await W.students.updateTeacherAssignment(t.studentId,n,x)}w("השיעור עודכן בהצלחה","success"),u()}catch(x){console.error("Error updating lesson:",x),w("שגיאה בעדכון השיעור","error")}finally{k(!1)}},w=(N,_)=>{const x=document.createElement("div");x.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${_==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,x.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${_==="success"?"✅":"❌"} ${N}
    </div>`,document.body.appendChild(x),setTimeout(()=>x.remove(),3e3)},R=()=>{const N=Array.from(new Set(o.map(_=>_.day)));return N.length===0?["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"]:N};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"עריכת שיעור"}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(Ne,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 font-reisinger-yonatan",children:"פרטי התלמיד"}),e.jsxs("div",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("strong",{children:"תלמיד:"})," ",t.studentName||"לא צוין"]}),t.instrument&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("strong",{children:"כלי נגינה:"})," ",t.instrument]}),t.studentClass&&e.jsxs("div",{children:[e.jsx("strong",{children:"כיתה:"})," ",t.studentClass]}),t.studentStage&&e.jsxs("div",{children:[e.jsx("strong",{children:"שלב:"})," ",t.studentStage]})]})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום בשבוע *"}),e.jsx("select",{value:b.day,onChange:N=>{const _=N.target.value,x=o.find($=>$.day===_);L($=>({...$,day:_,location:(!$.location||$.location==="")&&x?.location?x.location:$.location}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:R().map(N=>e.jsx("option",{value:N,children:N},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות) *"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[30,45,60].map(N=>e.jsxs("button",{type:"button",onClick:()=>d(N),className:`px-4 py-2 rounded-lg border-2 transition-all ${q===N?"border-indigo-600 bg-indigo-50 text-indigo-700 font-semibold":"border-gray-300 bg-white text-gray-700 hover:border-indigo-300"}`,children:[N," דק׳"]},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"בחר זמן שיעור זמין *"}),j.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(fe,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"אין זמנים זמינים ליום ומשך שיעור שנבחרו"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200",children:j.map(N=>{const _=b.startTime===N.startTime&&b.endTime===N.endTime;return e.jsxs("button",{type:"button",onClick:()=>y(N),className:`p-3 rounded-lg border-2 transition-all text-sm ${_?"border-green-600 bg-green-50 text-green-800 font-semibold shadow-md":N.duration===30?"border-green-300 bg-green-50 text-green-800 hover:border-green-500":N.duration===45?"border-blue-300 bg-blue-50 text-blue-800 hover:border-blue-500":"border-purple-300 bg-purple-50 text-purple-800 hover:border-purple-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[N.startTime,"-",N.endTime]})]}),e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:[N.duration," דקות"]})]},N.id)})})]}),b.startTime&&b.endTime&&e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-indigo-800",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-reisinger-yonatan font-medium",children:["זמן שיעור נבחר: ",b.startTime," - ",b.endTime," (",s(b.startTime,b.endTime)," דקות)"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מיקום / חדר"}),e.jsxs("select",{value:b.location||"",onChange:N=>L(_=>({..._,location:N.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר חדר"}),Ue.map(N=>e.jsx("option",{value:N,children:N},N))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:b.notes,onChange:N=>L(_=>({..._,notes:N.target.value})),rows:3,placeholder:"הערות נוספות לגבי השיעור...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:f||!b.startTime||!b.endTime,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),"עדכן שיעור"]})}),e.jsx("button",{type:"button",onClick:c,disabled:f,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function ls(){const{user:t}=Le(),[n,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(""),[a,p]=i.useState(!1),[b,L]=i.useState(null),[f,k]=i.useState(null),[q,d]=i.useState([]),[j,O]=i.useState(null),[y,g]=i.useState(!1),[w,R]=i.useState(!1),[N,_]=i.useState(!1),[x,$]=i.useState([]),[B,P]=i.useState(null),[Q,te]=i.useState("lessons");i.useEffect(()=>{C()},[t]);const C=async()=>{if(t?._id)try{u(!0);const m=t._id,M=(await W.theory.getTheoryLessons()).filter(E=>E.teacherId===m).map(E=>({id:E._id,name:E.name,description:E.description,level:E.level,duration:E.duration,capacity:E.capacity,enrolledCount:E.enrolledStudentIds?.length||0,schedule:{dayOfWeek:E.dayOfWeek,startTime:E.startTime,endTime:E.endTime},status:E.isActive?"active":"inactive",venue:E.location,materials:E.materials||[]}));o(M)}catch(m){console.error("Error loading theory lessons:",m),O("שגיאה בטעינת רשימת שיעורי התיאוריה")}finally{u(!1)}},D=async m=>{try{const H=(await W.theory.getTheoryLesson(m)).enrolledStudentIds||[];if(H.length===0){d([]);return}const E=(await W.students.getStudents({ids:H.join(",")})).map(r=>({id:r._id,firstName:r.personalInfo?.firstName||"",lastName:r.personalInfo?.lastName||"",grade:r.academicInfo?.gradeLevel,instrument:r.primaryInstrument,enrollmentDate:r.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));d(E)}catch(v){console.error("Error loading lesson students:",v)}},G=n.filter(m=>l===""||m.name.toLowerCase().includes(l.toLowerCase())||m.level.toLowerCase().includes(l.toLowerCase())||m.description?.toLowerCase().includes(l.toLowerCase())),V=async m=>{if(window.confirm("האם אתה בטוח שברצונך למחוק שיעור זה?"))try{await W.theory.deleteTheoryLesson(m),o(v=>v.filter(H=>H.id!==m)),f===m&&(k(null),d([]))}catch(v){console.error("Error deleting lesson:",v),alert("שגיאה במחיקת השיעור")}},ee=async m=>{try{const v=await J(m);if(v.hasConflict){P(v),_(!0);return}if(b){const H={name:m.name,description:m.description,level:m.level,duration:m.duration,capacity:m.capacity,dayOfWeek:m.schedule?.dayOfWeek,startTime:m.schedule?.startTime,endTime:m.schedule?.endTime,isActive:m.status==="active",location:m.venue},M=await W.theory.updateTheoryLesson(b.id,H),E={id:M._id,name:M.name,description:M.description,level:M.level,duration:M.duration,capacity:M.capacity,enrolledCount:M.enrolledStudentIds?.length||0,schedule:{dayOfWeek:M.dayOfWeek,startTime:M.startTime,endTime:M.endTime},status:M.isActive?"active":"inactive",venue:M.location,materials:M.materials||[]};o(r=>r.map(A=>A.id===b.id?E:A))}else{const H=t?._id,M={name:m.name,description:m.description,level:m.level,duration:m.duration,capacity:m.capacity,dayOfWeek:m.schedule?.dayOfWeek,startTime:m.schedule?.startTime,endTime:m.schedule?.endTime,isActive:m.status==="active",location:m.venue,teacherId:H},E=await W.theory.createTheoryLesson(M),r={id:E._id,name:E.name,description:E.description,level:E.level,duration:E.duration,capacity:E.capacity,enrolledCount:E.enrolledStudentIds?.length||0,schedule:{dayOfWeek:E.dayOfWeek,startTime:E.startTime,endTime:E.endTime},status:E.isActive?"active":"inactive",venue:E.location,materials:E.materials||[]};o(A=>[...A,r])}p(!1),L(null)}catch(v){console.error("Error saving lesson:",v),alert("שגיאה בשמירת פרטי השיעור")}},J=async m=>{try{const v=n.filter(r=>r.id!==b?.id&&r.schedule.dayOfWeek===m.schedule?.dayOfWeek),H=m.schedule?.startTime,M=m.schedule?.endTime,E=v.filter(r=>{const A=r.schedule.startTime,z=r.schedule.endTime;return H&&M&&A&&z&&(H>=A&&H<z||M>A&&M<=z||H<=A&&M>=z)});return E.length>0?{hasConflict:!0,conflictDetails:`התנגשות עם ${E[0].name} ב${oe(E[0].schedule.dayOfWeek)} ${E[0].schedule.startTime}-${E[0].schedule.endTime}`,suggestions:["שנה את שעת השיעור","העבר ליום אחר","קצר את משך השיעור"]}:{hasConflict:!1}}catch(v){return console.error("Error checking conflicts:",v),{hasConflict:!1}}},T=async()=>{try{const m=await W.students.getStudents(),v=q.map(M=>M.id),H=m.filter(M=>!v.includes(M._id)).map(M=>({id:M._id,firstName:M.personalInfo?.firstName||"",lastName:M.personalInfo?.lastName||"",grade:M.academicInfo?.gradeLevel,instrument:M.primaryInstrument,enrollmentDate:new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));$(H)}catch(m){console.error("Error loading available students:",m)}},X=async m=>{if(f)try{await mt.enrollStudent(f,m,{method:"manual",performedBy:"teacher",reason:"Teacher enrollment"}),await D(f),await T()}catch(v){console.error("Error enrolling student:",v),alert("שגיאה ברישום התלמיד")}},se=async m=>{if(f)try{await mt.unenrollStudent(f,m,{reason:"Teacher unenrollment"}),await D(f),await T()}catch(v){console.error("Error unenrolling student:",v),alert("שגיאה בביטול רישום התלמיד")}},ce=async m=>{try{const v={...m,name:`${m.name} - עותק`,id:void 0};await ee(v)}catch(v){console.error("Error duplicating lesson:",v),alert("שגיאה בשכפול השיעור")}},le=m=>{switch(m){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return m}},ue=m=>m.substring(0,5),oe=m=>({sunday:"יום ראשון",monday:"יום שני",tuesday:"יום שלישי",wednesday:"יום רביעי",thursday:"יום חמישי",friday:"יום שישי",saturday:"יום שבת"})[m.toLowerCase()]||m;return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת שיעורים..."})]})}):j?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:j})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"ניהול תיאוריה מתקדם"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[n.length," שיעורים פעילים"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"נהל קבוצות"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף שיעור"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",dir:"rtl",children:[{id:"lessons",label:"שיעורים",icon:Fe},{id:"groups",label:"קבוצות",icon:pe},{id:"curriculum",label:"תכנית לימודים",icon:dt},{id:"grades",label:"ציונים",icon:ct}].map(m=>{const v=m.icon;return e.jsxs("button",{onClick:()=>te(m.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 font-reisinger-yonatan ${Q===m.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(v,{className:"w-4 h-4"}),m.label]},m.id)})})}),e.jsxs("div",{className:"p-6",children:[Q==="lessons"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש שיעורים...",value:l,onChange:m=>s(m.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:G.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"לא נמצאו שיעורים":"אין שיעורים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת השיעור הראשון שלך"})]}):G.map(m=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${f===m.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{k(m.id),D(m.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:m.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[le(m.level)," • ",m.duration," דקות"]}),m.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:m.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),ce(m)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"שכפל שיעור",children:e.jsx(Pt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),L(m),p(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",title:"ערוך שיעור",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),V(m.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"מחק שיעור",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:oe(m.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{children:[ue(m.schedule.startTime)," - ",ue(m.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[m.enrolledCount||0,"/",m.capacity]})]}),m.venue&&e.jsx("span",{children:m.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${m.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:m.status==="active"?"פעיל":"לא פעיל"})]})]},m.id))}),f&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"תלמידי השיעור"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{R(!0),T()},className:"flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"הוסף תלמיד"]})})]}),q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-yonatan",children:"אין תלמידים רשומים לשיעור"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[m.firstName," ",m.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[m.instrument&&`${m.instrument} • `,m.grade&&`כיתה ${m.grade} • `,"רישום: ",new Date(m.enrollmentDate).toLocaleDateString("he-IL")]}),m.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-yonatan",children:["נוכחות: ",m.attendance.present,"/",m.attendance.total," שיעורים",e.jsxs("span",{className:`ml-2 ${m.attendance.present/m.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(m.attendance.present/m.attendance.total*100),"%)"]})]})]}),e.jsx("button",{onClick:()=>se(m.id),className:"text-red-600 hover:text-red-800 p-1",title:"הסר תלמיד",children:e.jsx(yt,{className:"w-4 h-4"})})]},m.id))})]})]})]}),Q==="groups"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"ניהול קבוצות תיאוריה"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]}),Q==="curriculum"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(dt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"תכנית לימודים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]}),Q==="grades"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ct,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"ניהול ציונים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]})]})]}),a&&e.jsx(os,{lesson:b,onClose:()=>{p(!1),L(null)},onSubmit:ee}),w&&e.jsx(ds,{availableStudents:x,onClose:()=>R(!1),onEnroll:X}),N&&B&&e.jsx(cs,{conflict:B,onClose:()=>_(!1),onResolve:()=>{_(!1),p(!0)}})]})}function os({lesson:t,onClose:n,onSubmit:o}){const[c,u]=i.useState({name:t?.name||"",description:t?.description||"",level:t?.level||"beginner",duration:t?.duration||60,capacity:t?.capacity||15,status:t?.status||"active",venue:t?.venue||"",schedule:{dayOfWeek:t?.schedule?.dayOfWeek||"sunday",startTime:t?.schedule?.startTime||"09:00",endTime:t?.schedule?.endTime||"10:00"}}),l=a=>{a.preventDefault(),o(c)},s=(a,p)=>{u(b=>({...b,schedule:{...b.schedule,[a]:p}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"עריכת שיעור תיאוריה":"הוספת שיעור תיאוריה חדש"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שם השיעור *"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:a=>u(p=>({...p,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תיאור השיעור"}),e.jsx("textarea",{value:c.description,onChange:a=>u(p=>({...p,description:a.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"רמה *"}),e.jsxs("select",{required:!0,value:c.level,onChange:a=>u(p=>({...p,level:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:c.duration,onChange:a=>u(p=>({...p,duration:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"קיבולת תלמידים *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:c.capacity,onChange:a=>u(p=>({...p,capacity:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סטטוס"}),e.jsxs("select",{value:c.status,onChange:a=>u(p=>({...p,status:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום השיעור *"}),e.jsxs("select",{required:!0,value:c.schedule.dayOfWeek,onChange:a=>s("dayOfWeek",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"יום ראשון"}),e.jsx("option",{value:"monday",children:"יום שני"}),e.jsx("option",{value:"tuesday",children:"יום שלישי"}),e.jsx("option",{value:"wednesday",children:"יום רביעי"}),e.jsx("option",{value:"thursday",children:"יום חמישי"}),e.jsx("option",{value:"friday",children:"יום שישי"}),e.jsx("option",{value:"saturday",children:"יום שבת"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsx("input",{type:"time",required:!0,value:c.schedule.startTime,onChange:a=>s("startTime",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsx("input",{type:"time",required:!0,value:c.schedule.endTime,onChange:a=>s("endTime",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום השיעור"}),e.jsx("input",{type:"text",value:c.venue,onChange:a=>u(p=>({...p,venue:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function ds({availableStudents:t,onClose:n,onEnroll:o}){const[c,u]=i.useState(""),l=t.filter(s=>`${s.firstName} ${s.lastName}`.toLowerCase().includes(c.toLowerCase())||s.instrument?.toLowerCase().includes(c.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"הוסף תלמיד לשיעור"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:c,onChange:s=>u(s.target.value),className:"w-full pl-4 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין תלמידים זמינים"})]}):l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[s.instrument&&`${s.instrument} • `,s.grade&&`כיתה ${s.grade}`]})]}),e.jsxs("button",{onClick:()=>o(s.id),className:"flex items-center gap-1 px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-reisinger-yonatan",children:[e.jsx(be,{className:"w-4 h-4"}),"הוסף"]})]},s.id))}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"סגור"})})]})})}function cs({conflict:t,onClose:n,onResolve:o}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Rt,{className:"w-8 h-8 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"התנגשות בלוח הזמנים"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-reisinger-yonatan mb-3",children:t.conflictDetails}),t.suggestions&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"הצעות לפתרון:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:t.suggestions.map((c,u)=>e.jsx("li",{className:"font-reisinger-yonatan",children:c},u))})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:"ערוך שיעור"}),e.jsx("button",{onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})})}let ms={data:""},us=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||ms,gs=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,xs=/\/\*[^]*?\*\/|  +/g,ut=/\n+/g,Te=(t,n)=>{let o="",c="",u="";for(let l in t){let s=t[l];l[0]=="@"?l[1]=="i"?o=l+" "+s+";":c+=l[1]=="f"?Te(s,l):l+"{"+Te(s,l[1]=="k"?"":n)+"}":typeof s=="object"?c+=Te(s,n?n.replace(/([^,])+/g,a=>l.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,p=>/&/.test(p)?p.replace(/&/g,a):a?a+" "+p:p)):l):s!=null&&(l=/^--/.test(l)?l:l.replace(/[A-Z]/g,"-$&").toLowerCase(),u+=Te.p?Te.p(l,s):l+":"+s+";")}return o+(n&&u?n+"{"+u+"}":u)+c},ve={},bt=t=>{if(typeof t=="object"){let n="";for(let o in t)n+=o+bt(t[o]);return n}return t},hs=(t,n,o,c,u)=>{let l=bt(t),s=ve[l]||(ve[l]=(p=>{let b=0,L=11;for(;b<p.length;)L=101*L+p.charCodeAt(b++)>>>0;return"go"+L})(l));if(!ve[s]){let p=l!==t?t:(b=>{let L,f,k=[{}];for(;L=gs.exec(b.replace(xs,""));)L[4]?k.shift():L[3]?(f=L[3].replace(ut," ").trim(),k.unshift(k[0][f]=k[0][f]||{})):k[0][L[1]]=L[2].replace(ut," ").trim();return k[0]})(t);ve[s]=Te(u?{["@keyframes "+s]:p}:p,o?"":"."+s)}let a=o&&ve.g?ve.g:null;return o&&(ve.g=ve[s]),((p,b,L,f)=>{f?b.data=b.data.replace(f,p):b.data.indexOf(p)===-1&&(b.data=L?p+b.data:b.data+p)})(ve[s],n,c,a),s},fs=(t,n,o)=>t.reduce((c,u,l)=>{let s=n[l];if(s&&s.call){let a=s(o),p=a&&a.props&&a.props.className||/^go/.test(a)&&a;s=p?"."+p:a&&typeof a=="object"?a.props?"":Te(a,""):a===!1?"":a}return c+u+(s??"")},"");function Ze(t){let n=this||{},o=t.call?t(n.p):t;return hs(o.unshift?o.raw?fs(o,[].slice.call(arguments,1),n.p):o.reduce((c,u)=>Object.assign(c,u&&u.call?u(n.p):u),{}):o,us(n.target),n.g,n.o,n.k)}let jt,rt,nt;Ze.bind({g:1});let we=Ze.bind({k:1});function ps(t,n,o,c){Te.p=n,jt=t,rt=o,nt=c}function $e(t,n){let o=this||{};return function(){let c=arguments;function u(l,s){let a=Object.assign({},l),p=a.className||u.className;o.p=Object.assign({theme:rt&&rt()},a),o.o=/ *go\d+/.test(p),a.className=Ze.apply(o,c)+(p?" "+p:"");let b=t;return t[0]&&(b=a.as||t,delete a.as),nt&&b[0]&&nt(a),jt(b,a)}return u}}var ys=t=>typeof t=="function",it=(t,n)=>ys(t)?t(n):t,bs=(()=>{let t=0;return()=>(++t).toString()})(),js=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");t=!n||n.matches}return t}})(),vs=20,vt="default",Nt=(t,n)=>{let{toastLimit:o}=t.settings;switch(n.type){case 0:return{...t,toasts:[n.toast,...t.toasts].slice(0,o)};case 1:return{...t,toasts:t.toasts.map(s=>s.id===n.toast.id?{...s,...n.toast}:s)};case 2:let{toast:c}=n;return Nt(t,{type:t.toasts.find(s=>s.id===c.id)?1:0,toast:c});case 3:let{toastId:u}=n;return{...t,toasts:t.toasts.map(s=>s.id===u||u===void 0?{...s,dismissed:!0,visible:!1}:s)};case 4:return n.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==n.toastId)};case 5:return{...t,pausedAt:n.time};case 6:let l=n.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(s=>({...s,pauseDuration:s.pauseDuration+l}))}}},Ns=[],ws={toasts:[],pausedAt:void 0,settings:{toastLimit:vs}},Me={},wt=(t,n=vt)=>{Me[n]=Nt(Me[n]||ws,t),Ns.forEach(([o,c])=>{o===n&&c(Me[n])})},St=t=>Object.keys(Me).forEach(n=>wt(t,n)),Ss=t=>Object.keys(Me).find(n=>Me[n].toasts.some(o=>o.id===t)),lt=(t=vt)=>n=>{wt(n,t)},Ts=(t,n="blank",o)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...o,id:o?.id||bs()}),He=t=>(n,o)=>{let c=Ts(n,t,o);return lt(c.toasterId||Ss(c.id))({type:2,toast:c}),c.id},re=(t,n)=>He("blank")(t,n);re.error=He("error");re.success=He("success");re.loading=He("loading");re.custom=He("custom");re.dismiss=(t,n)=>{let o={type:3,toastId:t};n?lt(n)(o):St(o)};re.dismissAll=t=>re.dismiss(void 0,t);re.remove=(t,n)=>{let o={type:4,toastId:t};n?lt(n)(o):St(o)};re.removeAll=t=>re.remove(void 0,t);re.promise=(t,n,o)=>{let c=re.loading(n.loading,{...o,...o?.loading});return typeof t=="function"&&(t=t()),t.then(u=>{let l=n.success?it(n.success,u):void 0;return l?re.success(l,{id:c,...o,...o?.success}):re.dismiss(c),u}).catch(u=>{let l=n.error?it(n.error,u):void 0;l?re.error(l,{id:c,...o,...o?.error}):re.dismiss(c)}),t};var ks=we`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Cs=we`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Is=we`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Ls=$e("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ks} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Cs} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Is} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,$s=we`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ds=$e("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${$s} 1s linear infinite;
`,Ms=we`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,As=we`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Es=$e("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Ms} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${As} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,_s=$e("div")`
  position: absolute;
`,Os=$e("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Ps=we`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Rs=$e("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Ps} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bs=({toast:t})=>{let{icon:n,type:o,iconTheme:c}=t;return n!==void 0?typeof n=="string"?i.createElement(Rs,null,n):n:o==="blank"?null:i.createElement(Os,null,i.createElement(Ds,{...c}),o!=="loading"&&i.createElement(_s,null,o==="error"?i.createElement(Ls,{...c}):i.createElement(Es,{...c})))},Fs=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Hs=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,zs="0%{opacity:0;} 100%{opacity:1;}",Ws="0%{opacity:1;} 100%{opacity:0;}",qs=$e("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Us=$e("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Gs=(t,n)=>{let o=t.includes("top")?1:-1,[c,u]=js()?[zs,Ws]:[Fs(o),Hs(o)];return{animation:n?`${we(c)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${we(u)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};i.memo(({toast:t,position:n,style:o,children:c})=>{let u=t.height?Gs(t.position||n||"top-center",t.visible):{opacity:0},l=i.createElement(Bs,{toast:t}),s=i.createElement(Us,{...t.ariaProps},it(t.message,t));return i.createElement(qs,{className:t.className,style:{...u,...o,...t.style}},typeof c=="function"?c({icon:l,message:s}):i.createElement(i.Fragment,null,l,s))});ps(i.createElement);Ze`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;function Qs(){const{user:t}=Le(),[n,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(new Date().toISOString().split("T")[0]),[a,p]=i.useState({totalStudents:0,markedToday:0,presentToday:0,absentToday:0});i.useEffect(()=>{b()},[l]);const b=async()=>{try{u(!0);const d=t?._id||t?.teacherId||t?.id;if(!d){re.error("לא נמצא מזהה מורה");return}const j=t?.teaching?.studentIds||[];if(j.length===0){o([]),p({totalStudents:0,markedToday:0,presentToday:0,absentToday:0}),u(!1);return}const y=(await W.students.getBatchStudents(j)).map(async _=>{try{const x=await W.attendance.getIndividualLessonAttendance({studentId:_._id||_.id,teacherId:d,date:l});return{..._,attendanceStatus:x?.status||null,isMarking:!1}}catch{return{..._,attendanceStatus:null,isMarking:!1}}}),g=await Promise.all(y);o(g);const w=g.filter(_=>_.attendanceStatus!==null),R=g.filter(_=>_.attendanceStatus==="present"),N=g.filter(_=>_.attendanceStatus==="absent");p({totalStudents:g.length,markedToday:w.length,presentToday:R.length,absentToday:N.length})}catch(d){console.error("Error loading students and attendance:",d),re.error("שגיאה בטעינת נתוני נוכחות")}finally{u(!1)}},L=async(d,j)=>{const O=t?._id||t?.teacherId||t?.id;if(!O){re.error("לא נמצא מזהה מורה");return}o(y=>y.map(g=>(g._id||g.id)===d?{...g,isMarking:!0}:g));try{const y={studentId:d,teacherId:O,date:l,status:j,lessonType:"individual"};await W.attendance.saveIndividualLessonAttendance(y),o(w=>w.map(R=>(R._id||R.id)===d?{...R,attendanceStatus:j,isMarking:!1}:R)),p(w=>{const R=n.find(_=>(_._id||_.id)===d)?.attendanceStatus!==null,N=n.find(_=>(_._id||_.id)===d)?.attendanceStatus==="present";return{...w,markedToday:R?w.markedToday:w.markedToday+1,presentToday:j==="present"?N?w.presentToday:w.presentToday+1:N?w.presentToday-1:w.presentToday,absentToday:j==="absent"?!N&&R?w.absentToday:w.absentToday+1:R&&!N?w.absentToday-1:w.absentToday}});const g=n.find(w=>(w._id||w.id)===d)?.personalInfo?.fullName||"התלמיד";re.success(j==="present"?`${g} סומן כנוכח ✓`:`${g} סומן כנעדר`,{duration:2e3})}catch(y){console.error("Error marking attendance:",y),re.error("שגיאה בסימון נוכחות"),o(g=>g.map(w=>(w._id||w.id)===d?{...w,isMarking:!1}:w))}},f=async d=>{const j=n.filter(g=>g.attendanceStatus===null);if(j.length===0){re("כל התלמידים כבר סומנו",{icon:"ℹ️"});return}o(g=>g.map(w=>w.attendanceStatus===null?{...w,isMarking:!0}:w));const O=d==="present"?"נוכחים":"נעדרים",y=re.loading(`מסמן ${j.length} תלמידים כ${O}...`);try{const g=j.map(w=>L(w._id||w.id,d));await Promise.all(g),re.success(`כל התלמידים סומנו כ${O} ✓`,{id:y})}catch{re.error("שגיאה בסימון נוכחות המונית",{id:y}),o(w=>w.map(R=>({...R,isMarking:!1})))}},k=()=>new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),q=l===new Date().toISOString().split("T")[0];return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(tt,{className:"w-8 h-8 text-indigo-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"טוען נתוני נוכחות..."})]})}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תלמידים"}),e.jsx("p",{className:"text-gray-600",children:"טרם הוקצו לך תלמידים"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך"}),e.jsx("input",{type:"date",value:l,onChange:d=>s(d.target.value),max:new Date().toISOString().split("T")[0],className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),q&&e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:k()})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"סה״כ תלמידים"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 mt-1",children:a.totalStudents})]}),e.jsx(pe,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"נוכחים"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 mt-1",children:a.presentToday})]}),e.jsx(Pe,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"נעדרים"}),e.jsx("p",{className:"text-2xl font-bold text-red-700 mt-1",children:a.absentToday})]}),e.jsx(Re,{className:"w-8 h-8 text-red-400"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg border border-purple-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"אחוז נוכחות"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 mt-1",children:[a.markedToday>0?Math.round(a.presentToday/a.markedToday*100):0,"%"]})]}),e.jsx(Bt,{className:"w-8 h-8 text-purple-400"})]})})]}),a.markedToday<a.totalStudents&&e.jsx("div",{className:"bg-indigo-50 rounded-lg border border-indigo-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"סמן את כל התלמידים שטרם סומנו:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f("present"),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[e.jsx(Pe,{className:"w-4 h-4"}),"סמן הכל כנוכחים"]}),e.jsxs("button",{onClick:()=>f("absent"),className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:[e.jsx(Re,{className:"w-4 h-4"}),"סמן הכל כנעדרים"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"רשימת תלמידים"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(d=>{const j=d._id||d.id;return e.jsx("div",{className:`px-6 py-4 hover:bg-gray-50 transition-colors ${d.isMarking?"opacity-60":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:d.personalInfo.fullName.split(" ").map(O=>O[0]).join("")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:d.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[d.instrument&&e.jsx("span",{children:d.instrument}),d.academicInfo?.grade&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["כיתה ",d.academicInfo.grade]})]})]})]})]})}),e.jsxs("div",{className:"flex-shrink-0",children:[d.attendanceStatus==="present"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm font-medium",children:[e.jsx(Pe,{className:"w-4 h-4"}),"נוכח"]}),d.attendanceStatus==="absent"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium",children:[e.jsx(Re,{className:"w-4 h-4"}),"נעדר"]}),d.attendanceStatus===null&&e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm font-medium",children:"לא סומן"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>L(j,"present"),disabled:d.isMarking||d.attendanceStatus==="present",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${d.attendanceStatus==="present"?"bg-green-100 text-green-700 cursor-default":"bg-green-600 text-white hover:bg-green-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.isMarking?e.jsx(tt,{className:"w-4 h-4 animate-spin"}):e.jsx(Pe,{className:"w-4 h-4"}),"נוכח"]}),e.jsxs("button",{onClick:()=>L(j,"absent"),disabled:d.isMarking||d.attendanceStatus==="absent",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${d.attendanceStatus==="absent"?"bg-red-100 text-red-700 cursor-default":"bg-red-600 text-white hover:bg-red-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.isMarking?e.jsx(tt,{className:"w-4 h-4 animate-spin"}):e.jsx(Re,{className:"w-4 h-4"}),"נעדר"]})]})]})},j)})})]}),a.markedToday===a.totalStudents&&a.totalStudents>0&&e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"כל התלמידים סומנו! ✓"}),e.jsxs("p",{className:"text-sm text-green-700",children:[a.presentToday," נוכחים • ",a.absentToday," נעדרים"]})]})]})})]})}function Vs(){const{user:t,checkAuthStatus:n}=Le(),[o,c]=i.useState(!1),[u,l]=i.useState(!1),[s,a]=i.useState({type:null,message:""}),[p,b]=i.useState(null),[L,f]=i.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});i.useEffect(()=>{k()},[]);const k=async()=>{try{l(!0);const y=await st.getMyProfile();b(y),f({fullName:y?.personalInfo?.fullName||"",email:y?.personalInfo?.email||"",phone:y?.personalInfo?.phone||"",address:y?.personalInfo?.address||"",birthDate:y?.personalInfo?.birthDate||""})}catch(y){console.error("Error fetching profile data:",y),a({type:"error",message:"שגיאה בטעינת פרטי הפרופיל"}),t&&f({fullName:t?.personalInfo?.fullName||"",email:t?.personalInfo?.email||t?.email||"",phone:t?.personalInfo?.phone||t?.phone||"",address:t?.personalInfo?.address||t?.address||"",birthDate:t?.personalInfo?.birthDate||t?.birthDate||""})}finally{l(!1)}},q=async()=>{try{l(!0),a({type:null,message:""});const y=await st.updateMyProfile(L);b(y),n&&await n(!0),c(!1),a({type:"success",message:"הפרופיל עודכן בהצלחה"}),setTimeout(()=>{a({type:null,message:""})},3e3)}catch(y){console.error("Error updating profile:",y),a({type:"error",message:"שגיאה בעדכון הפרופיל. אנא נסה שוב."})}finally{l(!1)}},d=()=>{const y=p||t;f({fullName:y?.personalInfo?.fullName||"",email:y?.personalInfo?.email||y?.email||"",phone:y?.personalInfo?.phone||y?.phone||"",address:y?.personalInfo?.address||y?.address||"",birthDate:y?.personalInfo?.birthDate||y?.birthDate||""}),c(!1),a({type:null,message:""})},j=y=>y?new Date(y).toLocaleDateString("he-IL"):"",O=p||t;return u&&!O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-yonatan",children:"טוען פרטי פרופיל..."})]})}):e.jsxs("div",{className:"space-y-6",children:[s.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${s.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[s.type==="success"?e.jsx(Ve,{className:"w-5 h-5"}):e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:s.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"פרטים אישיים"}),o?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:q,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[u?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"שמירה"})]}),e.jsxs("button",{onClick:d,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"ביטול"})]})]}):e.jsxs("button",{onClick:()=>c(!0),disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"עריכה"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"שם מלא"}),o?e.jsx("input",{type:"text",value:L.fullName,onChange:y=>f(g=>({...g,fullName:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן שם מלא"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-yonatan",children:L.fullName||"לא צוין"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:'דוא"ל'}),o?e.jsx("input",{type:"email",value:L.email,onChange:y=>f(g=>({...g,email:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ht,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:L.email||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"טלפון"}),o?e.jsx("input",{type:"tel",value:L.phone,onChange:y=>f(g=>({...g,phone:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:L.phone||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"כתובת"}),o?e.jsx("input",{type:"text",value:L.address,onChange:y=>f(g=>({...g,address:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן כתובת"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:L.address||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"תאריך לידה"}),o?e.jsx("input",{type:"date",value:L.birthDate,onChange:y=>f(g=>({...g,birthDate:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(he,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:j(L.birthDate)||"לא צוין"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-yonatan",children:"מידע תפקיד"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"תפקיד:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:(()=>{const y=O?.roles||[];if(y.length>0)return y.join(", ");const g=O?.role||"";switch(g){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return g||"לא צוין"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"מזהה משתמש:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan font-mono text-sm",children:O?.teacherId||O?._id||O?.id||"לא צוין"})]}),O?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"סטטוס:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:O.isActive?"פעיל":"לא פעיל"})]}),O?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"כלי נגינה:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:O.professionalInfo.instrument})]})]})]})]})}function aa(){const{user:t}=Le(),n=At();Et();const[o,c]=i.useState("general"),[u,l]=i.useState(null),[s,a]=i.useState(!0),[p,b]=i.useState(null);i.useEffect(()=>{const x=n.state;if(x?.activeTab){c(x.activeTab),window.history.replaceState(null,"",window.location.pathname);return}const $=new URLSearchParams(n.search),B=$.get("tab"),P=$.get("action");B&&c(B),P&&b(P),(B||P)&&window.history.replaceState(null,"",window.location.pathname)},[n]),i.useEffect(()=>{t&&L()},[t]);const L=async()=>{try{if(a(!0),!(t?._id||t?.teacherId||t?.id)){console.warn("No user ID available for loading profile statistics");return}const $=await st.getMyProfile();if(!$){console.warn("No teacher profile found"),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const B=$?.teaching?.studentIds||[],P=$?.conducting?.orchestraIds||[],Q=$?.teaching?.timeBlocks||[],[te,C]=await Promise.allSettled([B.length>0?W.students.getBatchStudents(B):Promise.resolve([]),P.length>0?W.orchestras.getBatchOrchestras(P):Promise.resolve([])]),D=te.status==="fulfilled"?te.value:[];te.status==="rejected"&&console.error("Failed to load student data:",te.reason);const G=C.status==="fulfilled"?C.value:[];C.status==="rejected"&&console.error("Failed to load orchestra data:",C.reason);const V=Array.isArray(D)?D.filter(T=>T.academicInfo?.isActive!==!1):[],ee=Array.isArray(Q)?Q.reduce((T,X)=>T+(parseInt(X.totalDuration)||0),0):0,J=Math.round(ee/60*10)/10;l({studentsCount:Array.isArray(D)?D.length:0,activeStudents:V.length,weeklyHours:J,orchestrasCount:Array.isArray(G)?G.length:0,theoryLessonsCount:0})}catch(x){console.error("Error loading profile statistics:",x),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{a(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען פרטי משתמש..."})]})});const f=()=>t?.roles?.includes("conductor")||t?.roles?.includes("מנצח")||t?.conducting?.orchestraIds&&t.conducting.orchestraIds.length>0,k=()=>t?.roles?.includes("teacher")||t?.roles?.includes("מורה")||t?.teaching?.studentIds&&t.teaching.studentIds.length>0,q=()=>t?.roles?.includes("theory_teacher")||t?.roles?.includes("מורה תאוריה"),j=(()=>{const $=[...[{id:"general",label:"פרטים כלליים",icon:Ae,component:Vs}]];return k()&&($.push({id:"students",label:"התלמידים שלי",icon:pe,component:Qt}),$.push({id:"schedule",label:"לוח זמנים שבועי",icon:he,component:es}),t?.teaching?.studentIds&&t.teaching.studentIds.length>0&&$.push({id:"attendance",label:"נוכחות",icon:Be,component:Qs})),f()&&$.push({id:"orchestras",label:"התזמורות שלי",icon:Ce,component:Kt}),q()&&$.push({id:"lessons",label:"שיעורי התיאוריה שלי",icon:Fe,component:ls}),$})(),y=(j.find(x=>x.id===o)||j[0]).component,g={};o==="students"&&p&&(g.action=p);const w=()=>{const x=t?.role||t?.roles?.[0]||"";switch(x){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return x||"משתמש"}},R=()=>t?.personalInfo?.fullName||t?.fullName||t?.name||"משתמש",N=()=>{const x=R();if(!x||x==="משתמש")return"מ";const $=x.trim().split(" ");return $.length>=2?$[0][0]+$[1][0]:$[0][0]||"מ"},_=()=>t?.personalInfo?.email||t?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-yonatan",children:N()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:R()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[w()," • ",_()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(qe,{title:"סה״כ תלמידים",value:s?"...":u?.studentsCount?.toString()||"0",icon:pe,color:"blue",loading:s}),e.jsx(qe,{title:"תלמידים פעילים",value:s?"...":u?.activeStudents?.toString()||"0",icon:zt,color:"green",loading:s}),e.jsx(qe,{title:"שעות שבועיות",value:s?"...":u?.weeklyHours?.toString()||"0",icon:fe,color:"purple",loading:s}),e.jsx(qe,{title:f()?"תזמורות":"שיעורי תיאוריה",value:s?"...":(u?.orchestrasCount||u?.theoryLessonsCount)?.toString()||"0",icon:f()?Ce:Fe,color:"indigo",loading:s})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:j.map(x=>{const $=x.icon;return e.jsxs("button",{onClick:()=>c(x.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${o===x.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:x.label})]},x.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(y,{...g})})]})]})}function qe({title:t,value:n,icon:o,color:c,loading:u}){const s={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[c];return e.jsx("div",{className:`bg-white rounded-lg border ${s.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-yonatan truncate",children:t}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-yonatan",children:u?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):n})]}),e.jsx("div",{className:`${s.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(o,{className:`w-4 h-4 sm:w-6 sm:h-6 ${s.text}`})})]})})}export{aa as default};
