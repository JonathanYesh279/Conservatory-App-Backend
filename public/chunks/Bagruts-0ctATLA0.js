import{j as e,a as Le,u as Pe}from"../assets/index-DOPb2QBz.js";import{r as n,b as _e}from"./vendor-B2j9q2e_.js";import{C as K}from"./Card-iUXie6Y4.js";import{T as De,S as Ce}from"./Table-CXSp2z4Q.js";import{S as ge}from"./StatsCard-Ckza2SwS.js";import{U as ne,u as oe,M as Ne,c as pe,b as Ve,O as Se,a7 as ke,T as ve,J as Ie,X as $e,A as Te,E as Ge,S as Ue,ac as Ee,aa as be,a9 as Re,m as je,P as Fe,_ as Me,d as Ae,o as Oe,a1 as ze,a2 as He}from"./ui-26XYoSED.js";import{C as Ke}from"./ConfirmationModal-oNBHBs2Q.js";import{u as Ye}from"./useBagrut-B_VVY438.js";import{a as he}from"./cascade-deletion-CG57WmIj.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";const qe=({bagrut:m,studentName:Y,teacherName:u,onClick:b,onEdit:q,onDelete:G,onExport:i,className:B=""})=>{const o=m.presentations?.filter(g=>g.completed).length||0,N=4,y=m.magenBagrut?.completed?1:0,I=m.program?.length||0,x=N+1,L=o+y,P=Math.round(L/x*100),_=()=>m.isCompleted?"bg-green-100 text-green-800":P>=50?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800",v=g=>g>=90?"text-green-600":g>=80?"text-blue-600":g>=70?"text-yellow-600":"text-red-600";return e.jsxs(K,{className:`hover:shadow-card-hover transition-shadow cursor-pointer ${B}`,onClick:b,padding:"md",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:Y}),e.jsx("p",{className:"text-sm text-gray-600",children:u})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${_()}`,children:m.isCompleted?"הושלם":"בתהליך"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"התקדמות"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[P,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${P>=100?"bg-green-500":P>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${P}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:[o,"/",N," מצגות"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ne,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:[I," יצירות"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(pe,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["מגן: ",y?"הושלם":"בתהליך"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ve,{className:"w-4 h-4 ml-1 text-gray-400"}),e.jsx("span",{children:m.testDate?new Date(m.testDate).toLocaleDateString("he-IL",{month:"short",day:"numeric"}):"לא נקבע"})]})]}),m.finalGrade&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg mb-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ציון סופי"}),e.jsx("div",{className:`text-2xl font-bold ${v(m.finalGrade)}`,children:m.finalGrade}),m.finalGradeLevel&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:m.finalGradeLevel})]}),m.conservatoryName&&e.jsx("div",{className:"text-sm text-gray-600 mb-4 text-center",children:m.conservatoryName}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),q?.()},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"ערוך",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),i?.()},className:"p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded-lg transition-colors",title:"ייצא PDF",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),G?.()},className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-lg transition-colors",title:"מחק",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),b?.()},className:"flex items-center px-3 py-1.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 ml-1"}),"פרטים"]})]})]})},Je=qe,k=[{id:"basic",name:"מידע בסיסי",icon:ne},{id:"recital",name:"הגדרת רסיטל",icon:Ne},{id:"program",name:"תוכנית בסיסית",icon:oe}],We=({students:m,teachers:Y,initialData:u,isEdit:b=!1,onSubmit:q,onCancel:G})=>{const[i,B]=n.useState(0),[o,N]=n.useState({studentId:"",teacherId:"",conservatoryName:"מרכז המוסיקה רעננה",testDate:void 0,notes:"",recitalUnits:5,recitalField:"קלאסי",program:[{pieceTitle:"",composer:"",duration:""},{pieceTitle:"",composer:"",duration:""}],accompaniment:{type:"נגן מלווה",accompanists:[{name:"",instrument:"פסנתר"}]}}),[y,I]=n.useState({}),[x,L]=n.useState(!1),[P,_]=n.useState(!1),[v,g]=n.useState([]),[we,J]=n.useState({}),[D,U]=n.useState(""),[E,R]=n.useState(""),[se,M]=n.useState(!1),[ie,W]=n.useState(!1),[X,te]=n.useState(!1),[A,re]=n.useState(!1),Q=n.useRef([]),O=n.useRef([]);n.useEffect(()=>{u&&N(t=>({...t,studentId:u.studentId||"",teacherId:u.teacherId||"",conservatoryName:u.conservatoryName||"מרכז המוסיקה רעננה",testDate:u.testDate?new Date(u.testDate):void 0,notes:u.notes||"",recitalUnits:u.recitalUnits||5,recitalField:u.recitalField||"קלאסי",program:u.program?.slice(0,3)||t.program,accompaniment:{type:u.accompaniment?.type||"נגן מלווה",accompanists:u.accompaniment?.accompanists?.map(r=>({name:r.name||"",instrument:r.instrument||"פסנתר"}))||[{name:"",instrument:"פסנתר"}]}})),Z()},[u]),n.useEffect(()=>{Z()},[o]);const T=n.useCallback((t,r)=>{switch(t){case"studentId":return r?{isValid:!0}:{isValid:!1,error:"יש לבחור תלמיד"};case"teacherId":return r?{isValid:!0}:{isValid:!1,error:"יש לבחור מורה מנחה"};case"conservatoryName":return r&&r.length<2?{isValid:!1,error:"שם הקונסרבטוריון קצר מדי"}:{isValid:!0};case"recitalUnits":return!r||r!==3&&r!==5?{isValid:!1,error:"יש לבחור 3 או 5 יחידות"}:{isValid:!0};case"recitalField":return r?{isValid:!0}:{isValid:!1,error:"יש לבחור תחום רסיטל"};default:return{isValid:!0}}},[]),Z=n.useCallback(()=>{const t=[],r=["studentId","teacherId"],a=r.filter(S=>T(S,o[S]).isValid);t.push({isValid:a.length===r.length,isComplete:a.length===r.length,completedFields:a.length,totalFields:r.length});const d=["recitalUnits","recitalField"],h=d.filter(S=>T(S,o[S]).isValid);t.push({isValid:h.length===d.length,isComplete:h.length===d.length,completedFields:h.length,totalFields:d.length});const F=o.program?.filter(S=>S.pieceTitle.trim()&&S.composer.trim())||[];t.push({isValid:F.length>=1,isComplete:F.length>=1,completedFields:F.length,totalFields:Math.max(1,o.program?.length||2)}),g(t)},[o,T]),ae=n.useCallback((t,r,a=!0)=>{const d=T(t,r);J(h=>({...h,[t]:{value:r,isValid:d.isValid,error:d.error,touched:a,isValidating:!1}}))},[T]),V=n.useCallback(t=>v.length>t?v[t].isValid:!1,[v]),ee=n.useCallback(()=>V(i)&&i<k.length-1,[i,V]),le=n.useCallback(()=>i>0,[i]),ce=n.useCallback(async()=>{if(ee()){te(!0),await new Promise(r=>setTimeout(r,150));const t=i+1;B(t),te(!1),setTimeout(()=>{const r=O.current[t];r&&r.focus()},100)}},[ee,i]),fe=n.useCallback(()=>{if(le()){const t=i-1;B(t),setTimeout(()=>{const r=O.current[t];r&&r.focus()},100)}},[le,i]),w=n.useCallback((t,r)=>{N(a=>({...a,[t]:r})),ae(t,r),y.general&&I(a=>({...a,general:""})),y[t]&&I(a=>({...a,[t]:""}))},[y,ae]),$=n.useCallback((t,r,a)=>{N(d=>({...d,program:d.program?.map((h,F)=>F===t?{...h,[r]:a}:h)||[]}))},[]),z=n.useCallback(()=>{N(t=>({...t,program:[...t.program||[],{pieceTitle:"",composer:"",duration:""}]}))},[]),de=n.useCallback(t=>{N(r=>({...r,program:r.program?.filter((a,d)=>d!==t)||[]}))},[]),me=n.useCallback((t,r)=>{N(a=>({...a,accompaniment:{...a.accompaniment,accompanists:[{...a.accompaniment.accompanists[0],[t]:r}]}}))},[]),ye=async t=>{t.preventDefault(),_(!0);for(let r=0;r<k.length;r++)if(!V(r)){let a="";switch(r){case 0:a="יש לבחור תלמיד ומורה";break;case 1:a="יש להשלים את הגדרת הרסיטל";break;case 2:a="יש להזין לפחות יצירה אחת בתוכנית";break}B(r),I({general:a}),setTimeout(()=>{const d=Q.current[r];d&&d.scrollIntoView({behavior:"smooth",block:"center"})},100);return}L(!0);try{const r={studentId:o.studentId,teacherId:o.teacherId,conservatoryName:o.conservatoryName||"מרכז המוסיקה רעננה",testDate:o.testDate||null,notes:o.notes||"",recitalUnits:o.recitalUnits||5,recitalField:o.recitalField||"קלאסי",program:o.program?.filter(a=>a.pieceTitle&&a.composer).map((a,d)=>({pieceNumber:d+1,pieceTitle:a.pieceTitle,composer:a.composer,duration:a.duration||"לא צוין",movement:a.movement||""}))||[],accompaniment:{type:o.accompaniment?.type||"נגן מלווה",accompanists:o.accompaniment?.accompanists?.filter(a=>a.name&&a.name.trim()!==""&&a.instrument&&a.instrument.trim()!=="").map(a=>({name:a.name.trim(),instrument:a.instrument.trim(),phone:"0500000000"}))||[]},presentations:[{completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,notes:"",recordingLinks:[]},{completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null,recordingLinks:[],detailedGrading:{playingSkills:{grade:"לא הוערך",points:null,maxPoints:40,comments:"אין הערות"},musicalUnderstanding:{grade:"לא הוערך",points:null,maxPoints:30,comments:"אין הערות"},textKnowledge:{grade:"לא הוערך",points:null,maxPoints:20,comments:"אין הערות"},playingByHeart:{grade:"לא הוערך",points:null,maxPoints:10,comments:"אין הערות"}}}],magenBagrut:{completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null,recordingLinks:[],detailedGrading:{playingSkills:{grade:"לא הוערך",points:null,maxPoints:40,comments:"אין הערות"},musicalUnderstanding:{grade:"לא הוערך",points:null,maxPoints:30,comments:"אין הערות"},textKnowledge:{grade:"לא הוערך",points:null,maxPoints:20,comments:"אין הערות"},playingByHeart:{grade:"לא הוערך",points:null,maxPoints:10,comments:"אין הערות"}}},finalGrade:null,finalGradeLevel:null,isCompleted:!1};console.log("Submitting bagrut data:",r),await q(r),re(!0)}catch(r){console.error("Error submitting form:",r),I({general:"שגיאה בשמירת הנתונים. אנא נסה שוב."})}finally{L(!1)}},ue=m.filter(t=>{if(!D)return!0;const r=t.personalInfo?.fullName||"",a=t.academicInfo?.class||"";return r.toLowerCase().includes(D.toLowerCase())||a.toLowerCase().includes(D.toLowerCase())}),s=Y.filter(t=>{if(!E)return!0;const r=t.personalInfo?.fullName||"",a=t.personalInfo?.email||"";return r.toLowerCase().includes(E.toLowerCase())||a.toLowerCase().includes(E.toLowerCase())}),l=m.find(t=>t._id===o.studentId),c=Y.find(t=>t._id===o.teacherId),p=()=>e.jsxs("div",{className:"px-6 py-6 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"התקדמות"}),e.jsxs("span",{children:[Math.round((i+(v[i]?.isValid?1:0))/k.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${(i+(v[i]?.isValid?1:0))/k.length*100}%`}})})]}),e.jsx("div",{className:"flex items-center justify-between",children:k.map((t,r)=>{const a=r<i,d=r===i,h=v[r],F=h?.isValid||!1,S=h?Math.round(h.completedFields/h.totalFields*100):0;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:`relative flex items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300 ${a?"bg-success-500 border-success-500 text-white shadow-lg scale-105":d?F?"bg-primary-500 border-primary-500 text-white shadow-md":"bg-white border-primary-500 text-primary-500 shadow-md":F?"bg-success-100 border-success-300 text-success-600":"bg-gray-100 border-gray-300 text-gray-400"}`,children:[a?e.jsx(be,{className:"w-6 h-6"}):d&&X?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}):e.jsx(t.icon,{className:"w-5 h-5"}),d&&!a&&h&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-white rounded-full border border-gray-200 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[h.completedFields,"/",h.totalFields]})})]}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:`text-xs font-medium transition-colors ${d?"text-primary-600":a?"text-success-600":"text-gray-500"}`,children:t.name}),d&&h&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:F?e.jsxs("span",{className:"flex items-center justify-center gap-1 text-success-600",children:[e.jsx(be,{className:"w-3 h-3"}),"מוכן"]}):e.jsxs("span",{className:"text-orange-600",children:[S,"% מושלם"]})})]})]}),r<k.length-1&&e.jsx("div",{className:`w-16 h-1 mx-4 rounded-full transition-all duration-500 ${a?"bg-success-300":"bg-gray-200"}`})]},t.id)})})]}),j=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-600"}),"בחירת תלמיד"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמיד לפי שם או כיתה...",value:D,onChange:t=>{U(t.target.value),M(!0)},onFocus:()=>M(!0),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),l&&e.jsx("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:l.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["כיתה: ",l.academicInfo?.class]}),e.jsxs("p",{children:["טלפון: ",l.personalInfo?.phone]})]})]}),e.jsx(pe,{className:"w-6 h-6 text-green-600"})]})}),se&&!l&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:ue.length>0?ue.map(t=>e.jsxs("button",{type:"button",onClick:()=>{w("studentId",t._id),U(""),M(!1)},className:`w-full p-3 text-right hover:bg-gray-50 border-b border-gray-100 last:border-b-0 ${o.studentId===t._id?"bg-primary-50":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["כיתה ",t.academicInfo?.class]})]},t._id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"לא נמצאו תלמידים"})})]})]}),e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-600"}),"בחירת מורה מנחה"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש מורה לפי שם...",value:E,onChange:t=>{R(t.target.value),W(!0)},onFocus:()=>W(!0),className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),c&&e.jsx("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:c.personalInfo?.fullName}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["אימייל: ",c.personalInfo?.email]}),e.jsxs("p",{children:["טלפון: ",c.personalInfo?.phone]})]})]}),e.jsx(pe,{className:"w-6 h-6 text-green-600"})]})}),ie&&!c&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:s.length>0?s.map(t=>e.jsxs("button",{type:"button",onClick:()=>{w("teacherId",t._id),R(""),W(!1)},className:`w-full p-3 text-right hover:bg-gray-50 border-b border-gray-100 last:border-b-0 ${o.teacherId===t._id?"bg-primary-50":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.personalInfo?.fullName}),e.jsx("div",{className:"text-sm text-gray-600",children:t.personalInfo?.email})]},t._id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"לא נמצאו מורים"})})]})]}),e.jsxs(K,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטים נוספים"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שם הקונסרבטוריון"}),e.jsx("input",{type:"text",value:o.conservatoryName||"",onChange:t=>w("conservatoryName",t.target.value),placeholder:"לדוגמה: קונסרבטוריון ירושלים",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך מבחן משוער"}),e.jsx("input",{type:"date",value:o.testDate?o.testDate.toISOString().split("T")[0]:"",onChange:t=>w("testDate",t.target.value?new Date(t.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות ראשוניות"}),e.jsx("textarea",{value:o.notes||"",onChange:t=>w("notes",t.target.value),placeholder:"הערות כלליות על התלמיד או הבגרות...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-vertical"})]})]})]}),C=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-gray-600"}),"הגדרת רסיטל"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יחידות רסיטל"}),e.jsxs("select",{value:o.recitalUnits||5,onChange:t=>w("recitalUnits",Number(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:3,children:"3 יחידות"}),e.jsx("option",{value:5,children:"5 יחידות"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תחום רסיטל"}),e.jsxs("select",{value:o.recitalField||"קלאסי",onChange:t=>w("recitalField",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"קלאסי",children:"קלאסי"}),e.jsx("option",{value:"ג'אז",children:"ג'אז"}),e.jsx("option",{value:"שירה",children:"שירה"}),e.jsx("option",{value:"מוסיקה ישראלית",children:"מוסיקה ישראלית"}),e.jsx("option",{value:"מוסיקה עולמית",children:"מוסיקה עולמית"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"מלווה ראשי"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שם המלווה"}),e.jsx("input",{type:"text",value:o.accompaniment?.accompanists[0]?.name||"",onChange:t=>me("name",t.target.value),placeholder:"שם המלווה (אופציונלי)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"כלי נגינה"}),e.jsx("input",{type:"text",value:o.accompaniment?.accompanists[0]?.instrument||"",onChange:t=>me("instrument",t.target.value),placeholder:"לדוגמה: פסנתר",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})]})]})}),H=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs(K,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-600"}),"תוכנית בסיסית"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"הזן לפחות יצירה אחת. ניתן להוסיף יצירות נוספות ופרטים מלאים בדף הבגרות לאחר היצירה."}),e.jsxs("div",{className:"space-y-4",children:[o.program?.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["יצירה ",r+1]}),o.program&&o.program.length>1&&e.jsx("button",{type:"button",onClick:()=>de(r),className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שם היצירה *"}),e.jsx("input",{type:"text",value:t.pieceTitle,onChange:a=>$(r,"pieceTitle",a.target.value),placeholder:"לדוגמה: סונטה מס' 14",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מלחין *"}),e.jsx("input",{type:"text",value:t.composer,onChange:a=>$(r,"composer",a.target.value),placeholder:"לדוגמה: בטהובן",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"משך זמן"}),e.jsx("input",{type:"text",value:t.duration||"",onChange:a=>$(r,"duration",a.target.value),placeholder:"לדוגמה: 8 דקות",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]})]},r)),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs("button",{type:"button",onClick:z,className:"flex items-center px-4 py-2 text-primary-600 border border-primary-300 rounded-lg hover:bg-primary-50 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-1"}),"הוסף יצירה"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"שים לב:"})," לאחר יצירת הבגרות, תוכל להוסיף בדף הפרטים:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 list-disc list-inside",children:[e.jsx("li",{children:"פרטי מצגות ותאריכים"}),e.jsx("li",{children:"מגן בגרות"}),e.jsx("li",{children:"ציונים והערכות"}),e.jsx("li",{children:"מסמכים וקבצים"}),e.jsx("li",{children:"קישורי יוטיוב והקלטות"}),e.jsx("li",{children:"פרטי מלווים נוספים"})]})]})]})}),f=()=>{switch(i){case 0:return j();case 1:return C();case 2:return H();default:return null}},xe=()=>A?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"success-title",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl animate-scale-in",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-success-100 mb-4",children:e.jsx(be,{className:"w-8 h-8 text-success-600","aria-hidden":"true"})}),e.jsx("h3",{id:"success-title",className:"text-xl font-bold text-gray-900 mb-2",children:"בגרות נוצרה בהצלחה!"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-6 space-y-2",children:[e.jsxs("p",{children:["הבגרות עבור ",l?.personalInfo?.fullName," נוצרה."]}),e.jsx("p",{className:"text-success-700 font-medium",children:"עכשיו תוכל להשלים פרטים נוספים"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>{re(!1),G()},className:"w-full px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4","aria-hidden":"true"}),"עבור לדף הבגרות"]})}),e.jsx("button",{onClick:()=>{re(!1),N({studentId:"",teacherId:"",conservatoryName:"מרכז המוסיקה רעננה",testDate:void 0,notes:"",recitalUnits:5,recitalField:"קלאסי",program:[{pieceTitle:"",composer:"",duration:""},{pieceTitle:"",composer:"",duration:""}],accompaniment:{type:"נגן מלווה",accompanists:[{name:"",instrument:"פסנתר"}]}}),B(0),I({}),_(!1),J({}),U(""),R("")},className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"צור בגרות אחרת"})]})]})})}):null;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:b?"עריכת בגרות":"יצירת בגרות חדשה"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["שלב ",i+1," מתוך ",k.length,": ",k[i].name]})]}),e.jsx("button",{onClick:G,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx($e,{className:"w-6 h-6"})})]}),p(),e.jsxs("form",{onSubmit:ye,className:"p-6",children:[y.general&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:y.general})]}),e.jsx("div",{className:"mb-8",children:f()}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:fe,disabled:!le()||x,className:"flex items-center px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 min-w-[120px] justify-center","aria-label":"חזר לשלב הקודם",children:[e.jsx(Ge,{className:"w-4 h-4 ml-2","aria-hidden":"true"}),"הקודם"]}),e.jsx("div",{className:"flex md:hidden items-center gap-1",children:k.map((t,r)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-200 ${r<=i?"bg-primary-500":"bg-gray-300"}`,"aria-hidden":"true"},r))}),i===k.length-1?e.jsx("button",{type:"submit",disabled:x||!V(i),className:`flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-200 min-w-[160px] justify-center ${x||!V(i)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md"}`,"aria-label":b?"עדכן בגרות":"צור בגרות חדשה",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2","aria-hidden":"true"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 ml-2","aria-hidden":"true"}),b?"עדכן בגרות":"צור בגרות"]})}):e.jsx("button",{type:"button",onClick:ce,disabled:!ee()||X,className:`flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-200 min-w-[120px] justify-center ${!ee()||X?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md"}`,"aria-label":"עבור לשלב הבא",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2","aria-hidden":"true"}),"בודק..."]}):e.jsxs(e.Fragment,{children:["הבא",e.jsx(Ee,{className:"w-4 h-4 mr-2","aria-hidden":"true"})]})})]})]}),xe()]})},Xe=We;function cs(){const m=_e(),{currentSchoolYear:Y}=Le(),{user:u}=Pe(),{bagruts:b,loading:q,error:G,fetchAllBagruts:i,createBagrut:B,deleteBagrut:o,clearError:N}=Ye(),[y,I]=n.useState(""),[x,L]=n.useState({status:"",teacherId:"",conservatory:"",isCompleted:""}),[P,_]=n.useState(!1),[v,g]=n.useState("table"),[we,J]=n.useState(!1),[D,U]=n.useState(null),[E,R]=n.useState([]),[se,M]=n.useState([]),[ie,W]=n.useState(!1),[X,te]=n.useState([]),[A,re]=n.useState(!1);n.useEffect(()=>{Q()},[Y]),n.useEffect(()=>{console.log("🎭 Bagruts state updated:",b.length,"bagruts loaded"),b.length>0&&console.log("🎭 First bagrut sample:",b[0])},[b]);const Q=async(s=!1)=>{try{W(!0),console.log("🔄 Loading bagrut data...",s?"(forced refresh)":""),console.log("👤 Current user:",u?._id,"Role:",u?.roles?.[0]);const l=u?.roles?.includes("מורה")||u?.roles?.includes("teacher");if(re(l),l){console.log("🎓 Teacher role detected, loading student bagruts...");const c=await he.teachers.getTeacher(u._id),p=c.teaching?.studentIds||[];if(console.log("👥 Teacher has",p.length,"students"),p.length===0){te([]),R([]),M([]);return}const j=await he.students.getBatchStudents(p);console.log("📚 Loaded",j.length,"students");const C=j.filter(f=>f.academicInfo?.bagrutTracking&&Object.keys(f.academicInfo.bagrutTracking).length>0);console.log("🎯",C.length,"students have bagrut data");const H=C.map(f=>({_id:`${f._id}-bagrut`,studentId:f._id,studentName:f.personalInfo?.fullName||"לא צוין",bagrutTracking:f.academicInfo?.bagrutTracking||{},class:f.personalInfo?.class||f.academicInfo?.class,hasActiveBagrut:f.academicInfo?.bagrutTracking&&Object.values(f.academicInfo.bagrutTracking).some(xe=>xe.status!=="completed"&&xe.status!=="cancelled")}));te(H),R(j),M([c])}else{await i({showInactive:!1,sortBy:"createdAt",order:"desc"});const[c,p]=await Promise.all([he.students.getStudents(),he.teachers.getTeachers()]);console.log("🎓 Loaded students data:",c?.length,"students"),console.log("👨‍🏫 Loaded teachers data:",p?.length,"teachers"),R(c),M(p)}}catch(l){console.error("Error loading data:",l)}finally{W(!1)}},O=s=>{const l=E.find(c=>c._id===s);return console.log("🔍 Looking for student:",s,"Found:",l?.personalInfo?.fullName||"NOT FOUND"),l?.personalInfo?.fullName||"תלמיד לא ידוע"},T=s=>se.find(c=>c._id===s)?.personalInfo?.fullName||"מורה לא ידוע",Z=s=>{m(`/bagruts/${s}`)},ae=s=>{m(`/bagruts/${s}/edit`)},V=(s,l)=>{const c=O(l);U({id:s,studentName:c}),J(!0)},ee=async()=>{D&&(await o(D.id)&&await Q(),U(null)),J(!1)},le=()=>{U(null),J(!1)},ce=async s=>{try{const l=await fetch(`/api/bagrut/${s}/export/pdf`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(l.ok){const c=await l.blob(),p=window.URL.createObjectURL(c),j=document.createElement("a");j.href=p,j.download=`bagrut-${s}.pdf`,j.click(),window.URL.revokeObjectURL(p)}}catch(l){console.error("Error exporting PDF:",l),alert("שגיאה בייצוא המסמך")}},fe=async s=>{try{console.log("🚀 Creating bagrut with data:",s);const l=await B(s);l?(console.log("✅ Bagrut created successfully:",l._id),_(!1),setTimeout(async()=>{console.log("🔄 Refreshing bagrut data..."),await Promise.all([Q(!0),i({showInactive:!1,sortBy:"createdAt",order:"desc"})]),console.log("🔗 Navigating to bagrut details:",l._id),m(`/bagruts/${l._id}`)},200)):console.error("❌ Failed to create bagrut - no bagrut returned")}catch(l){console.error("❌ Error in form submission:",l)}},w=A?X:b,$=w.filter(s=>{const l=s.studentName||O(s.studentId),c=T(s.teacherId),p=!y||l.toLowerCase().includes(y.toLowerCase())||c.toLowerCase().includes(y.toLowerCase())||s.conservatoryName?.toLowerCase().includes(y.toLowerCase()),j=!x.status||x.status==="completed"&&s.isCompleted||x.status==="pending"&&!s.isCompleted,C=!x.teacherId||s.teacherId===x.teacherId,H=!x.conservatory||s.conservatoryName===x.conservatory,f=x.isCompleted===""||x.isCompleted==="true"&&s.isCompleted||x.isCompleted==="false"&&!s.isCompleted;return p&&j&&C&&H&&f}),z=w.length,de=w.filter(s=>s.isCompleted).length,me=z-de,ye=w.filter(s=>s.finalGrade&&s.finalGrade>=90).length,ue=[{key:"student",header:"תלמיד",render:s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:O(s.studentId)})]})},{key:"teacher",header:"מורה",render:s=>T(s.teacherId)},{key:"conservatory",header:"קונסרבטוריון",render:s=>s.conservatoryName||"לא צוין"},{key:"progress",header:"התקדמות",align:"center",render:s=>{const l=s.presentations?.filter(H=>H.isCompleted).length||0,c=s.magenBagrut?.isCompleted?1:0;s.program?.length;const p=5,j=l+c,C=Math.round(j/p*100);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[C,"%"]}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${C>=80?"bg-green-500":C>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${C}%`}})})]})}},{key:"grade",header:"ציון סופי",align:"center",render:s=>{if(!s.finalGrade)return e.jsx("span",{className:"text-gray-400",children:"-"});let l="text-gray-700";return s.finalGrade>=90?l="text-green-600 font-bold":s.finalGrade>=80?l="text-blue-600":s.finalGrade>=70?l="text-yellow-600":s.finalGrade<60&&(l="text-red-600"),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-lg ${l}`,children:s.finalGrade}),s.finalGradeLevel&&e.jsx("span",{className:"text-xs text-gray-500",children:s.finalGradeLevel})]})}},{key:"status",header:"סטטוס",align:"center",render:s=>s.isCompleted?e.jsx(Ce,{status:"completed",children:"הושלם"}):e.jsx(Ce,{status:"pending",children:"בתהליך"})},{key:"actions",header:"פעולות",align:"center",render:s=>e.jsxs("div",{className:"flex space-x-2 space-x-reverse justify-center",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),Z(s._id)},className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",title:"צפה בפרטים",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ae(s._id)},className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",title:"ערוך",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ce(s._id)},className:"p-1.5 text-blue-600 hover:text-blue-900 hover:bg-blue-100 rounded transition-colors",title:"ייצא PDF",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),V(s._id,s.studentId)},className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded transition-colors",title:"מחק",children:e.jsx(ve,{className:"w-4 h-4"})})]})}];return q||ie?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"טוען נתוני בגרויות..."})]})}):G?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"שגיאה בטעינת הנתונים"}),e.jsx("div",{className:"text-gray-600 mb-6",children:G}),e.jsx("button",{onClick:()=>{N(),Q()},className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"נסה שוב"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ניהול בגרויות"}),e.jsx("p",{className:"text-gray-600 mt-1",children:A?"מעקב אחר בגרויות התלמידים שלך":"מעקב אחר תהליכי בגרות, ציונים ומסמכים"})]}),!A&&e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-2"}),"בגרות חדשה"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(ge,{title:"סה״כ בגרויות",value:z.toString(),subtitle:"בגרויות רשומות במערכת",icon:e.jsx(oe,{}),color:"blue"}),e.jsx(ge,{title:"הושלמו",value:de.toString(),subtitle:"בגרויות שהושלמו",icon:e.jsx(pe,{}),color:"green"}),e.jsx(ge,{title:"בתהליך",value:me.toString(),subtitle:"בגרויות פעילות",icon:e.jsx(Ae,{}),color:"orange"}),e.jsx(ge,{title:"מצטיינים",value:ye.toString(),subtitle:"ציון 90 ומעלה",icon:e.jsx(Oe,{}),color:"purple"})]}),e.jsx(K,{padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לפי שם תלמיד, מורה או קונסרבטוריון...",value:y,onChange:s=>I(s.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:x.status,onChange:s=>L(l=>({...l,status:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"כל הסטטוסים"}),e.jsx("option",{value:"completed",children:"הושלם"}),e.jsx("option",{value:"pending",children:"בתהליך"})]}),e.jsxs("select",{value:x.teacherId,onChange:s=>L(l=>({...l,teacherId:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"כל המורים"}),se.map(s=>e.jsx("option",{value:s._id,children:s.personalInfo?.fullName},s._id))]}),e.jsxs("select",{value:x.conservatory,onChange:s=>L(l=>({...l,conservatory:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"כל הקונסרבטוריונים"}),[...new Set(b.map(s=>s.conservatoryName).filter(Boolean))].map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["מציג ",$.length," מתוך ",z," בגרויות"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>g("table"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${v==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(ze,{className:"w-4 h-4"}),"טבלה"]}),e.jsxs("button",{onClick:()=>g("grid"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${v==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(He,{className:"w-4 h-4"}),"רשת"]})]})]}),v==="table"?e.jsx(De,{columns:ue,data:$,onRowClick:s=>Z(s._id),rowClassName:"hover:bg-gray-50 cursor-pointer transition-colors"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:$.map(s=>e.jsx(Je,{bagrut:s,studentName:O(s.studentId),teacherName:T(s.teacherId),onClick:()=>Z(s._id),onEdit:()=>ae(s._id),onDelete:()=>V(s._id,s.studentId),onExport:()=>ce(s._id)},s._id))}),$.length===0&&!q&&!ie&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-500 text-lg",children:A&&z===0?"אין לך תלמידים עם תהליכי בגרות פעילים כרגע":"לא נמצאו בגרויות התואמות לחיפוש"}),A&&z===0&&e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"כאשר תלמידיך יירשמו לבגרויות, הן יופיעו כאן"})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto mr-64",children:e.jsx(Xe,{students:E,teachers:se,onSubmit:fe,onCancel:()=>_(!1)})})}),e.jsx(Ke,{isOpen:we,title:"מחיקת בגרות",message:`האם אתה בטוח שברצונך למחוק את הבגרות של ${D?.studentName}? פעולה זו לא ניתנת לביטול.`,confirmText:"מחק",cancelText:"ביטול",onConfirm:ee,onCancel:le,variant:"danger"})]})}export{cs as default};
