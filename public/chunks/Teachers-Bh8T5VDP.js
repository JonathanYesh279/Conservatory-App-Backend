import{j as e,u as te,a as ae,A as re}from"../assets/index-aJiiupPj.js";import{b as ne,r as i}from"./vendor-B2j9q2e_.js";import{C as m}from"./Card-BGhuT3RM.js";import{S as le,T as ie}from"./Table-CZif58Gh.js";import{f as oe,b as ce,Z as de,a3 as me,J as xe,O as he,_ as B,m as ue,X as ge,P as pe,a1 as fe,a2 as ye}from"./ui-26XYoSED.js";import{a as je}from"./cascade-deletion-C7j5aisD.js";import"./query-BI61muSV.js";import"./utils-Cgyyg58q.js";const ve=({teacher:t,showStudentCount:u=!0,showSchedule:g=!1,showContact:p=!1,onClick:o,className:N=""})=>{const w=n=>n.split(" ").map(d=>d[0]).join("").slice(0,2),C=n=>({מורה:"bg-blue-100 text-blue-800",מנצח:"bg-purple-100 text-purple-800","מדריך הרכב":"bg-green-100 text-green-800",מנהל:"bg-red-100 text-red-800","מורה תאוריה":"bg-yellow-100 text-yellow-800",מגמה:"bg-indigo-100 text-indigo-800"})[n]||"bg-gray-100 text-gray-800",T=()=>{const n=["מנהל","מנצח","מדריך הרכב","מורה תאוריה","מגמה","מורה"],d=t.roles||[];return d.find(h=>n.includes(h))||d[0]||"מורה"},S=n=>({מורה:"bg-blue-500",מנצח:"bg-purple-500","מדריך הרכב":"bg-green-500",מנהל:"bg-red-500","מורה תאוריה":"bg-yellow-500",מגמה:"bg-indigo-500"})[n]||"bg-blue-500",f=()=>{if(!t.teaching?.schedule)return{lessons:0,hours:0};const n=t.teaching.schedule.reduce((d,h)=>d+h.duration,0);return{lessons:t.teaching.schedule.length,hours:Math.round(n/60*10)/10}},k=T(),c=t.teaching?.studentIds?.length||0,x=f();return e.jsx(m,{className:`transition-all duration-200 hover:shadow-md ${o?"cursor-pointer hover:shadow-lg":""} ${N}`,onClick:o,padding:"md",children:e.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[e.jsx("div",{className:`
          w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm
          ${S(k)}
        `,children:w(t.personalInfo.fullName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:t.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.isActive?"bg-green-400":"bg-gray-300"}`}),!t.professionalInfo?.isActive&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:"לא פעיל מקצועית"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(t.roles||[]).map((n,d)=>e.jsx("span",{className:`
                    inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                    ${C(n)}
                  `,children:n},d))})}),t.professionalInfo?.instrument&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"התמחות:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.professionalInfo.instrument})]})}),u&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[c," ",c===1?"תלמיד":"תלמידים"]})]})}),g&&x.lessons>0&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:[x.lessons," שיעורים (",x.hours," שעות בשבוע)"]})]})}),p&&e.jsxs("div",{className:"border-t border-gray-100 pt-3 mt-3 space-y-2",children:[t.personalInfo.phone&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(de,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:t.personalInfo.phone})]}),t.personalInfo.email&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(me,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:t.personalInfo.email})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:t.isActive?"פעיל במערכת":"לא פעיל במערכת"}),t.professionalInfo?.isActive&&e.jsx("span",{className:"text-green-600",children:"פעיל מקצועית"})]})})]})]})})},be=ve,H=t=>{if(!t)return!1;const u=t?.roles?.includes("מנהל"),g=t?.roles?.includes("admin"),p=t?.role==="admin",o=t?.role==="מנהל";return u||g||p||o};function De(){const t=ne(),{user:u}=te(),{currentSchoolYear:g,isLoading:p}=ae(),[o,N]=i.useState([]),[w,C]=i.useState(!0),[T,S]=i.useState(null),[f,k]=i.useState(""),[c,x]=i.useState({instrument:"",role:""}),[n,d]=i.useState(null),[h,F]=i.useState(null),[Y,Ne]=i.useState(!1),[I,R]=i.useState(""),[O,j]=i.useState(!1),[y,M]=i.useState("table"),[U,P]=i.useState(!1);i.useEffect(()=>{p||L()},[g,p]);const L=async()=>{try{C(!0),S(null);const s=g?{schoolYearId:g._id}:{},b=(await je.teachers.getTeachers(s)).filter(a=>a._id!==u?._id).map(a=>({id:a._id,name:a.personalInfo?.fullName||"לא צוין",specialization:a.professionalInfo?.instrument||"לא צוין",roles:a.allRoles||a.roles||[],primaryRole:a.primaryRole||"לא מוגדר",studentCount:a.studentCount||0,email:a.personalInfo?.email||"",phone:a.personalInfo?.phone||"",isActive:a.isTeacherActive,hasTimeBlocks:a.hasTimeBlocks||!1,timeBlockCount:a.timeBlockCount||0,orchestraCount:a.orchestraCount||0,ensembleCount:a.ensembleCount||0,availabilityDays:a.availabilityDays||[],totalTeachingHours:Math.round(a.totalTeachingHours/60*10)/10||0,rawData:a,rolesDisplay:a.allRoles?.length>0?a.allRoles.join(", "):"לא מוגדר",status:e.jsx(le,{status:a.isTeacherActive?"active":"inactive",children:a.isTeacherActive?"פעיל":"לא פעיל"}),actions:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("button",{className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",onClick:$=>{$.stopPropagation(),D(a._id)},title:"צפה בפרטי המורה",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",onClick:$=>{$.stopPropagation(),q(a._id)},title:"ערוך פרטי המורה",children:e.jsx(he,{className:"w-4 h-4"})})]})}));N(b)}catch(s){console.error("Error loading teachers:",s),S(s.message)}finally{C(!1)}},V=()=>{d(null),F(null)},D=s=>{const r=`/teachers/${s}`;try{t(r)}catch{window.location.href=r}},q=s=>{window.location.href=`/teacher-management/${s}`},G=()=>{H(u)?P(!0):alert("רק מנהלים יכולים להוסיף מורים")},J=s=>{p||L()},z=["חלילית","חליל צד","אבוב","בסון","סקסופון","קלרינט","חצוצרה","קרן יער","טרומבון","טובה/בריטון","שירה","כינור","ויולה","צ'לו","קונטרבס","פסנתר","גיטרה","גיטרה בס","תופים"].filter(s=>s.toLowerCase().includes(I.toLowerCase())),E=(s,r)=>{x(l=>({...l,instrument:s})),R(r),j(!1)},W=s=>{R(s),j(!0),s===""&&x(r=>({...r,instrument:""}))},A=o.filter(s=>{const r=!f||s.name.toLowerCase().includes(f.toLowerCase())||s.specialization.toLowerCase().includes(f.toLowerCase()),l=!c.instrument||s.specialization.includes(c.instrument),b=!c.role||s.roles&&s.roles.includes(c.role);return r&&l&&b}),v=o.length,X=o.filter(s=>s.isActive).length,_=o.reduce((s,r)=>s+r.studentCount,0),Z=v>0?(_/v).toFixed(1):0,K=o.filter(s=>s.hasTimeBlocks).length,Q=o.reduce((s,r)=>s+r.totalTeachingHours,0);o.filter(s=>s.orchestraCount>0).length;const ee=[{key:"name",header:"שם המורה"},{key:"specialization",header:"התמחות"},{key:"rolesDisplay",header:"תפקידים"},{key:"studentCount",header:"מס' תלמידים",align:"center"},{key:"status",header:"סטטוס",align:"center"},{key:"actions",header:"פעולות",align:"center",width:"100px"}],se=()=>{if(!n||!h)return null;const s=["ראשון","שני","שלישי","רביעי","חמישי","שישי"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",style:{position:"fixed !important",top:"0 !important",left:"0 !important",right:"0 !important",bottom:"0 !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",zIndex:9999},children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["לוח זמנים - ",n.name]}),e.jsx("button",{onClick:V,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),Y?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(B,{className:"w-8 h-8 animate-spin text-primary-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען לוח זמנים..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(r=>e.jsxs(m,{padding:"md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 text-center",children:r}),e.jsx("div",{className:"space-y-3",children:h[r]&&h[r].length>0?h[r].map((l,b)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:[l.time,"-",l.endTime]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[l.studentName," | ",l.instrument," | שלב ",l.currentStage]}),l.location&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["מיקום: ",l.location]})]},l.lessonId||b)):e.jsxs("div",{className:"text-center text-gray-500 py-6",children:["אין שיעורים ביום ",r]})})]},r))})]})})})};return w?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"טוען מורים..."})]})}):T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"❌ שגיאה בטעינת הנתונים"}),e.jsx("div",{className:"text-gray-600 mb-6",children:T}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"נסה שוב"})]}):e.jsxs("div",{children:[se(),e.jsx(m,{className:"mb-6",padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש מורים...",value:f,onChange:s=>k(s.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"חפש כלי נגינה...",value:I,onChange:s=>W(s.target.value),onFocus:()=>j(!0),onBlur:()=>{setTimeout(()=>j(!1),200)},className:"w-48 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500"}),I&&e.jsx("button",{onClick:()=>{R(""),x(s=>({...s,instrument:""})),j(!1)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ge,{className:"w-4 h-4"})}),O&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50 direction-rtl",children:[e.jsx("button",{onClick:()=>E("","כל הכלים"),className:`w-full text-right px-3 py-2 hover:bg-gray-50 border-b border-gray-100 direction-rtl ${c.instrument===""?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:"כל הכלים"}),z.map(s=>e.jsx("button",{onClick:()=>E(s,s),className:`w-full text-right px-3 py-2 hover:bg-gray-50 direction-rtl ${c.instrument===s?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:s},s)),z.length===0&&I&&e.jsx("div",{className:"px-3 py-2 text-gray-500 text-center",children:"לא נמצאו כלים"})]})]}),e.jsxs("select",{value:c.role,onChange:s=>x(r=>({...r,role:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"כל התפקידים"}),e.jsx("option",{value:"מורה",children:"מורה"}),e.jsx("option",{value:"מנצח",children:"מנצח"}),e.jsx("option",{value:"מדריך הרכב",children:"מדריך הרכב"}),e.jsx("option",{value:"מנהל",children:"מנהל"}),e.jsx("option",{value:"מורה תאוריה",children:"מורה תאוריה"}),e.jsx("option",{value:"מגמה",children:"מגמה"})]}),H(u)&&e.jsxs("button",{onClick:G,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",title:"Add Teacher",children:[e.jsx(pe,{className:"w-4 h-4 ml-2"}),"הוסף מורה"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600 mb-1",children:v}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ מורים"})]})}),e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success-600 mb-1",children:X}),e.jsx("div",{className:"text-xs text-gray-600",children:"פעילים"})]})}),e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:_}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ תלמידים"})]})}),e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:Z}),e.jsx("div",{className:"text-xs text-gray-600",children:"ממוצע תלמידים"})]})}),e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-1",children:K}),e.jsx("div",{className:"text-xs text-gray-600",children:"עם זמינות"})]})}),e.jsx(m,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-teal-600 mb-1",children:Math.round(Q)}),e.jsx("div",{className:"text-xs text-gray-600",children:"שעות זמינות"})]})})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:f||c.instrument||c.role?e.jsxs("span",{children:["מציג ",A.length," מתוך ",v," מורים"]}):e.jsxs("span",{children:['סה"כ ',v," מורים"]})}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>M("table"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${y==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":y==="table","aria-label":"תצוגת טבלה",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"טבלה"}),y==="table"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>M("grid"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${y==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":y==="grid","aria-label":"תצוגת רשת",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"רשת"}),y==="grid"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]})]})]}),y==="table"?e.jsx(ie,{columns:ee,data:A,onRowClick:s=>{D(s.id)},rowClassName:"hover:bg-gray-50 cursor-pointer transition-colors"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:A.map(s=>{const r={_id:s.id,personalInfo:{fullName:s.name,phone:s.phone,email:s.email},roles:s.roles||[],professionalInfo:{instrument:s.specialization,isActive:s.isActive},teaching:{studentIds:Array(s.studentCount).fill(""),schedule:[]},isActive:s.isActive};return e.jsx(be,{teacher:r,showStudentCount:!0,showSchedule:!1,showContact:!1,onClick:()=>D(s.id),className:"h-full hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1"},s.id)})}),A.length===0&&!w&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"לא נמצאו מורים התואמים לחיפוש"}),e.jsx(re,{isOpen:U,onClose:()=>P(!1),onTeacherAdded:J})]})}export{De as default};
