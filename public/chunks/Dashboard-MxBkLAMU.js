import{u as Se,j as e,a as We}from"../assets/index-DOPb2QBz.js";import{r as c,b as $e}from"./vendor-B2j9q2e_.js";import{S as ye}from"./StatsCard-Ckza2SwS.js";import{C as pe}from"./Card-iUXie6Y4.js";import{a as P}from"./cascade-deletion-CG57WmIj.js";import{w as xe,M as he,f as ue,x as Qe,y as Re,G as Z,z as Ce,b as ee,r as le,D as ze,p as Me,E as oe,V as qe,e as Fe,I as Ye,J as Ve,q as Je,K as Ie,A as Ke,X as Xe,d as we,P as Pe,B as me,N as Ze,O as et,u as tt,o as st,Q as at,t as Ee,W as rt,Y as Be}from"./ui-26XYoSED.js";import{T as nt}from"./teacherDetailsApi-BGs4ypj_.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";function lt(){const{user:n}=Se(),[m,f]=c.useState({totalOrchestras:0,activeMusicians:0,upcomingRehearsals:0,completedConcerts:0,totalMembers:0,weeklyRehearsals:0,bagrutMembers:0,activeBagrutStudents:0}),[j,d]=c.useState([]),[$,I]=c.useState([]),[q,F]=c.useState([]),[E,G]=c.useState([]),[Y,Q]=c.useState(!0),[V,U]=c.useState(null);c.useEffect(()=>{n?._id&&x()},[n]);const x=async()=>{try{Q(!0),U(null);const t=n._id,[T]=await Promise.all([P.teachers.getTeacher(t)]);if(!T)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const k=T?.conducting?.orchestraIds||[];let y=[],C=0,M=[];if(k.length>0){y=await P.orchestras.getBatchOrchestras(k),C=y.reduce((l,s)=>l+(s.memberCount||0),0);try{const l=await P.rehearsals.getRehearsals({groupIds:k.join(","),limit:100});M=Array.isArray(l)?l:[]}catch(l){console.warn("Error loading rehearsals:",l),M=[]}}const _=new Date,H=new Date(_.getTime()+7*24*60*60*1e3),J=M.filter(l=>{const s=new Date(l.scheduledDate);return s>=_&&s<=H}).slice(0,5).map(l=>{const s=y.find(h=>h._id===l.groupId);return{id:l._id,orchestraName:s?.name||"×ª×–××•×¨×ª",date:new Date(l.scheduledDate).toLocaleDateString("he-IL"),time:l.startTime||"19:00",location:l.location||"××•×œ× ××•×–×™×§×”",attendanceRate:Math.floor(Math.random()*20)+80,duration:120,status:"scheduled"}});d(J);const K=M.filter(l=>{const s=new Date(l.scheduledDate),h=new Date(_);h.setDate(_.getDate()-_.getDay());const D=new Date(h);return D.setDate(h.getDate()+6),s>=h&&s<=D}).length;let O=[],te=0,se=0;if(y.length>0){const l=y.flatMap(s=>s?.members?.map(h=>h.studentId)||[]);if(l.length>0)try{const[s,h]=await Promise.all([Promise.all(l.map(D=>P.bagrut.getBagrutByStudent(D).catch(()=>null))).then(D=>D.filter(Boolean)),P.students.getBatchStudents(l)]);O=l.map(D=>{const ge=h.find(u=>u._id===D),v=s.find(u=>u.studentId===D),fe=y.flatMap(u=>u.members||[]).find(u=>u.studentId===D),Te=y.find(u=>u.members?.some(A=>A.studentId===D));let X="none",a,p,z;if(v){const u=v.presentations?.filter(A=>A.completed).length||0;if(a=u+1,p=u/4*100,v.isCompleted&&v.finalGrade&&v.finalGrade>=55?X="completed":v.isCompleted&&v.finalGrade&&v.finalGrade<55?X="none":u===0?X="pending":X="active",X==="active"){const A=new Date,L=Math.floor(Math.random()*30)+7;z=new Date(A),z.setDate(A.getDate()+L)}}return{studentId:D,studentName:ge?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:fe?.instrument||ge?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",section:fe?.section||"×œ× ×¦×•×™×Ÿ",bagrutStatus:X,stage:a,progress:p,nextExamDate:z,orchestraName:Te?.name||"×ª×–××•×¨×ª"}}),te=O.filter(D=>D.bagrutStatus!=="none").length,se=O.filter(D=>D.bagrutStatus==="active").length}catch(s){console.warn("Error loading Bagrut data:",s)}}G(O);const w={totalOrchestras:y.length,activeMusicians:C,upcomingRehearsals:J.length,completedConcerts:Math.floor(Math.random()*5)+2,totalMembers:C,weeklyRehearsals:K,bagrutMembers:te,activeBagrutStudents:se};f(w);const ae=y.map(l=>{const s=M.filter(D=>D.groupId===l._id),h=Math.floor(Math.random()*20)+80;return{orchestraId:l._id,orchestraName:l.name,totalRehearsals:s.length,averageAttendance:h,upcomingConcerts:Math.floor(Math.random()*3)+1,lastRehearsal:s.length>0?new Date(s[s.length-1].scheduledDate).toLocaleDateString("he-IL"):"××™×Ÿ × ×ª×•× ×™×",status:h>=90?"excellent":h>=75?"good":"needs_attention"}});F(ae);const o=[];M.slice(0,3).forEach(l=>{const s=y.find(h=>h._id===l.groupId);o.push({id:`rehearsal-${l._id}`,type:"rehearsal",title:"×—×–×¨×” ×”×•×©×œ××”",description:`×—×–×¨×” ×©×œ ${s?.name||"×ª×–××•×¨×ª"} - ${l.location||"××•×œ× ××•×–×™×§×”"}`,timestamp:new Date(Date.now()-Math.random()*864e5).toISOString(),orchestraName:s?.name})}),y.slice(0,2).forEach(l=>{o.push({id:`enrollment-${l._id}`,type:"enrollment",title:"×¨×™×©×•× ×—×“×©",description:`×ª×œ××™×“ ×—×“×© ×”×¦×˜×¨×£ ×œ${l.name}`,timestamp:new Date(Date.now()-Math.random()*1728e5).toISOString(),orchestraName:l.name})}),I(o.sort((l,s)=>new Date(s.timestamp).getTime()-new Date(l.timestamp).getTime()))}catch(t){console.error("Error loading conductor dashboard data:",t),U("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{Q(!1)}},N=$e(),B=t=>{switch(t){case"scheduleRehearsal":N("/profile",{state:{activeTab:"orchestras"}});break;case"markAttendance":N("/profile",{state:{activeTab:"orchestras"}});break;case"manageOrchestras":N("/profile",{state:{activeTab:"orchestras"}});break;case"viewMusicians":N("/profile",{state:{activeTab:"orchestras"}});break;default:console.log("Action:",t)}},r=t=>{const T=new Date(t),y=new Date().getTime()-T.getTime(),C=Math.floor(y/(1e3*60*60));return C<1?`×œ×¤× ×™ ${Math.floor(y/6e4)} ×“×§×•×ª`:C<24?`×œ×¤× ×™ ${C} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(C/24)} ×™××™×`};return Y?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×× ×¦×—..."})]})}):V?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:V}),e.jsx("button",{onClick:x,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×©×œ×•× ×× ×¦×— ",n?.firstName||"×™×§×¨"," ğŸ¼"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8",children:[e.jsx(ce,{icon:e.jsx(he,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×–××•×¨×•×ª",value:m.totalOrchestras,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(ce,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"××•×–×™×§××™× ×¤×¢×™×œ×™×",value:m.activeMusicians,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(ce,{icon:e.jsx(Qe,{className:"w-6 h-6"}),title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:m.weeklyRehearsals,bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(ce,{icon:e.jsx(Re,{className:"w-6 h-6"}),title:"×§×•× ×¦×¨×˜×™× ×”×©× ×”",value:m.completedConcerts,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(ce,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"×—×‘×¨×™ ×‘×’×¨×•×ª",value:m.bagrutMembers,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(ce,{icon:e.jsx(Ce,{className:"w-6 h-6"}),title:"×‘×’×¨×•×ª ×¤×¢×™×œ×”",value:m.activeBagrutStudents,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(je,{icon:e.jsx(ee,{className:"w-5 h-5"}),label:"×§×‘×¢ ×—×–×¨×”",onClick:()=>B("scheduleRehearsal"),color:"indigo"}),e.jsx(je,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>B("markAttendance"),color:"green"}),e.jsx(je,{icon:e.jsx(ze,{className:"w-5 h-5"}),label:"× ×”×œ ×ª×–××•×¨×•×ª",onClick:()=>B("manageOrchestras"),color:"blue"}),e.jsx(je,{icon:e.jsx(Me,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘××•×–×™×§××™×",onClick:()=>B("viewMusicians"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×—×–×¨×•×ª ×”×§×¨×•×‘×•×ª"}),e.jsxs("button",{onClick:()=>N("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(oe,{className:"w-4 h-4"})]})]}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª ×”×©×‘×•×¢"})]}):e.jsx("div",{className:"space-y-3",children:j.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-3 h-3"}),t.location]}),t.attendanceRate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["× ×•×›×—×•×ª ×××•×¦×¢×ª: ",t.attendanceRate,"%"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.date}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(Ye,{className:"w-3 h-3 inline mr-1"}),t.duration," ×“×§×•×ª"]})]})]},t.id))})]}),E.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×—×‘×¨×™ ×ª×–××•×¨×ª ×¢× ×‘×’×¨×•×ª"}),e.jsx(Z,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:E.filter(t=>t.bagrutStatus==="active").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×‘×’×¨×•×ª ×¤×¢×™×œ×”"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:E.filter(t=>t.bagrutStatus==="completed").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×”×•×©×œ××”"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:E.filter(t=>t.bagrutStatus==="pending").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×××ª×™× ×™×"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-600",children:E.filter(t=>t.bagrutStatus==="none").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×œ×œ× ×‘×’×¨×•×ª"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×"}),E.filter(t=>t.bagrutStatus==="active").slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.instrument," â€¢ ",t.section," â€¢ ",t.orchestraName]})]})]}),e.jsxs("div",{className:"text-right",children:[t.stage&&e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:["×”×©××¢×” ",t.stage,"/4"]}),t.progress!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(t.progress),"%"]})]}),t.nextExamDate&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["××‘×—×Ÿ ×”×‘×: ",t.nextExamDate.toLocaleDateString("he-IL")]}),e.jsx("button",{className:"mt-2 p-1 text-gray-400 hover:text-blue-600",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]},t.studentId)),E.filter(t=>t.bagrutStatus==="active").length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/teacher/bagrut",className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",E.filter(t=>t.bagrutStatus==="active").length,")"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×‘×™×¦×•×¢×™ ×ª×–××•×¨×•×ª"}),e.jsxs("button",{onClick:()=>N("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×“×•×— ××¤×•×¨×˜",e.jsx(oe,{className:"w-4 h-4"})]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×‘×™×¦×•×¢×™×"})]}):e.jsx("div",{className:"space-y-3",children:q.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="excellent"?"bg-green-500":t.status==="good"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.totalRehearsals," ×—×–×¨×•×ª ×”×©× ×” â€¢ ×—×–×¨×” ××—×¨×•× ×”: ",t.lastRehearsal]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:`font-medium ${t.averageAttendance>=90?"text-green-600":t.averageAttendance>=75?"text-yellow-600":"text-red-600"}`,children:[t.averageAttendance,"%"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª ×××•×¦×¢×ª"})]})]},t.orchestraId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(Ie,{className:"w-5 h-5 text-gray-400"})]}),$.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:$.map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${t.type==="rehearsal"?"bg-blue-100":t.type==="enrollment"?"bg-green-100":t.type==="performance"?"bg-purple-100":"bg-yellow-100"}`,children:[t.type==="rehearsal"&&e.jsx(he,{className:"w-4 h-4 text-blue-600"}),t.type==="enrollment"&&e.jsx(Me,{className:"w-4 h-4 text-green-600"}),t.type==="performance"&&e.jsx(Re,{className:"w-4 h-4 text-purple-600"}),t.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-yellow-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:t.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:r(t.timestamp)})]})]},t.id))})]})]})]})})}function ce({icon:n,title:m,value:f,suffix:j,bgColor:d,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${d} border ${I} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:m}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[f," ",j&&e.jsx("span",{className:"text-lg font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function je({icon:n,label:m,onClick:f,color:j}){const d={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:f,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${d[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan",children:m})]})}function ot(){const{user:n}=Se(),m=$e(),[f,j]=c.useState({totalStudents:0,todaysLessons:0,weeklyHours:0,activeBagrutStudents:0}),[d,$]=c.useState([]),[I,q]=c.useState([]),[F,E]=c.useState([]),[G,Y]=c.useState([]),[Q,V]=c.useState(!0),[U,x]=c.useState(null),[N,B]=c.useState(!1),[r,t]=c.useState(!1),[T,k]=c.useState(!1),[y,C]=c.useState([]),[M,_]=c.useState([]),[H,J]=c.useState(null),[K,O]=c.useState([]),[te,se]=c.useState([]),[w,ae]=c.useState([]),[o,l]=c.useState({days:[]});c.useEffect(()=>{n?._id&&s()},[n]),c.useEffect(()=>{n?._id&&w.length>=0&&ge()},[n,w]),c.useEffect(()=>{if(H){const a=setTimeout(()=>J(null),4e3);return()=>clearTimeout(a)}},[H]);const s=()=>{const a=n?.roles||[],p=n?.role,z=n?.allRoles||[];let u=[...a];p&&!u.includes(p)&&u.push(p),u=[...new Set([...u,...z])];const A=u.map(L=>{const R=L?.toLowerCase();return R==="conductor"||R==="×× ×¦×—"?"conductor":R==="theory-teacher"||R==="××•×¨×” ×ª×™××•×¨×™×”"||R==="theory teacher"?"theory-teacher":R==="teacher"||R==="××•×¨×”"?"teacher":L});ae([...new Set(A)])},h=async a=>{try{const p=await nt.getTransformedWeeklySchedule(a);if(p)return l(p),p}catch(p){console.log("Error loading weekly schedule:",p)}return D()},D=()=>({days:["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"].map(p=>({dayName:p,lessons:[]}))}),ge=async()=>{try{V(!0),x(null);const a=n._id,[p,z]=await Promise.all([P.teachers.getMyProfile(),h(a)]);if(!p)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");console.log("Teacher profile loaded:",{name:p?.personalInfo?.fullName,studentIds:p?.teaching?.studentIds,studentCount:p?.teaching?.studentIds?.length||0,timeBlocks:p?.teaching?.timeBlocks?.length||0});const u=p?.teaching?.studentIds||[],A=p?.teaching?.timeBlocks||[];C(A);let L=[];if(u.length>0){console.log("ğŸ¯ Teacher assigned student IDs:",u);const i=await P.students.getBatchStudents(u);if(console.log(`ğŸ“Š API returned ${i.length} students for ${u.length} requested IDs`),L=i.filter(S=>{const b=S._id||S.id,g=u.includes(b);return!g&&i.length>u.length&&console.log(`âš ï¸ Filtering out unassigned student: ${b}`),g}),console.log(`âœ… Showing ${L.length} assigned students (filtered from ${i.length})`),L.length<u.length){const S=L.map(g=>g._id||g.id),b=u.filter(g=>!S.includes(g));console.warn("âš ï¸ Missing students:",b)}}else console.log("No student IDs found in teacher profile");_(L);const R=new Date,be=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"][R.getDay()],Oe=z.days.find(i=>i.dayName===be)?.lessons.filter(i=>i.lessonType!=="availability").length||0,_e=z.days.reduce((i,S)=>i+S.lessons.filter(b=>b.lessonType!=="availability").reduce((b,g)=>{const De=new Date(`2000-01-01T${g.startTime}`),ne=new Date(`2000-01-01T${g.endTime}`);return b+(ne.getTime()-De.getTime())/(1e3*60*60)},0),0);let Ge=[];if(w.includes("conductor"))try{const S=(await P.orchestras.getOrchestras()).filter(b=>b.conductorId===a);O(S),console.log(`ğŸ¼ Loaded ${S.length} orchestras for conductor`)}catch(i){console.log("Error loading orchestras:",i)}if(w.includes("theory-teacher"))try{const i=await P.theory.getTheoryLessons({teacherId:a});se(i||[]),console.log(`ğŸ“š Loaded ${i?.length||0} theory lessons`)}catch(i){console.log("Error loading theory lessons:",i)}const Ae=Ge.map(i=>{const S=M.find(ie=>ie._id===i.studentId),b=i.presentations?.filter(ie=>ie.completed).length||0,g=4,De=b/g*100;let ne="active";i.isCompleted&&i.finalGrade&&i.finalGrade>=55?ne="completed":i.isCompleted&&i.finalGrade&&i.finalGrade<55?ne="failed":b===0&&(ne="pending");let ke;if(ne==="active"&&b<4){const ie=new Date,He=Math.floor(Math.random()*30)+7;ke=new Date(ie),ke.setDate(ie.getDate()+He)}return{studentId:i.studentId,studentName:S?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:S?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",stage:b+1,progress:De,nextExamDate:ke,status:ne,finalGrade:i.finalGrade,completedPresentations:b,totalPresentations:g,bagrutId:i._id}});Y(Ae);const Ue=Ae.filter(i=>i.status==="active").length;j({totalStudents:L.length,todaysLessons:Oe,weeklyHours:Math.round(_e*10)/10,activeBagrutStudents:Ue});let re=[];const Le=z.days.find(i=>i.dayName===be);if(Le){const i=`${R.getHours().toString().padStart(2,"0")}:${R.getMinutes().toString().padStart(2,"0")}`;re=Le.lessons.filter(b=>b.lessonType!=="availability"&&b.startTime>=i).slice(0,5).map(b=>({id:b.id,studentName:b.studentName||"×ª×œ××™×“",time:b.startTime,instrument:b.instrument||"",duration:parseInt(b.notes?.match(/\d+/)?.[0]||"60"),type:b.lessonType}))}if(re.length===0&&p?.teaching?.schedule){const i=`${R.getHours().toString().padStart(2,"0")}:${R.getMinutes().toString().padStart(2,"0")}`;re=p.teaching.schedule.filter(g=>g.day===be).filter(g=>g.startTime>=i).slice(0,5).map(g=>({id:g._id||`lesson-${g.studentId}`,studentName:g.studentName||"×ª×œ××™×“",time:g.startTime,instrument:g.instrument||"",duration:g.duration||60,type:"individual"}))}if(re.length===0&&L.length>0){const i=`${R.getHours().toString().padStart(2,"0")}:${R.getMinutes().toString().padStart(2,"0")}`;L.forEach(S=>{(S.teacherAssignments?.filter(g=>g.teacherId===n._id&&g.day===be)||[]).forEach(g=>{g.time&&g.time>=i&&re.push({id:`${S._id}-${g.time}`,studentName:S.personalInfo?.fullName||"×ª×œ××™×“",time:g.time,instrument:S.academicInfo?.primaryInstrument||g.instrument||"×›×œ×™ ××•×–×™×§×”",duration:g.duration||60,type:"individual"})})}),re.sort((S,b)=>S.time.localeCompare(b.time))}$(re.slice(0,5)),q([]),E([])}catch(a){console.error("Error loading dashboard data:",a),x("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{V(!1)}},v=a=>{switch(console.log("handleQuickAction called with:",a),console.log("Teacher time blocks:",y),a){case"addLesson":console.log("Adding lesson - checking time blocks..."),y.length===0?(console.log("No time blocks found, showing notification"),k(!0)):(console.log("Time blocks found, opening lesson modal"),console.log("Students available for lesson:",M.length,M),t(!0),console.log("Modal state set to true"));break;case"markAttendance":m("/profile",{state:{activeTab:"schedule"}});break;case"viewSchedule":m("/profile",{state:{activeTab:"schedule"}});break;case"manageStudents":m("/profile",{state:{activeTab:"students"}});break;case"manageTeachingDays":B(!0);break;case"viewOrchestras":m("/profile",{state:{activeTab:"orchestras"}});break;case"viewTheoryLessons":m("/profile",{state:{activeTab:"theory-lessons"}});break;case"addOrchestra":m("/orchestras/new");break;case"addTheoryLesson":m("/theory/new");break;case"manageBagrut":window.location.href="/teacher/bagrut";break;case"scheduleBagrutExam":window.location.href="/teacher/bagrut/schedule";break;case"viewBagrutProgress":window.location.href="/teacher/bagrut/progress";break;case"updateBagrutStatus":window.location.href="/teacher/bagrut/update";break;default:console.log("Action:",a)}},fe=a=>{switch(a){case"completed":return"text-green-600 bg-green-50";case"active":return"text-blue-600 bg-blue-50";case"pending":return"text-yellow-600 bg-yellow-50";case"failed":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},Te=a=>{switch(a){case"completed":return"×”×•×©×œ×";case"active":return"×¤×¢×™×œ";case"pending":return"×××ª×™×Ÿ";case"failed":return"× ×›×©×œ";default:return"×œ× ×™×“×•×¢"}},X=a=>{const p=new Date(a),u=new Date().getTime()-p.getTime(),A=Math.floor(u/(1e3*60*60));return A<1?`×œ×¤× ×™ ${Math.floor(u/6e4)} ×“×§×•×ª`:A<24?`×œ×¤× ×™ ${A} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(A/24)} ×™××™×`};return Q?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×”..."})]})}):U?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:U}),e.jsx("button",{onClick:ge,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[H&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${H.type==="success"?"bg-green-100 border border-green-200 text-green-800":"bg-red-100 border border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[H.type==="success"?e.jsx(le,{className:"w-5 h-5"}):e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:H.message}),e.jsx("button",{onClick:()=>J(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(Xe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×œ×•×— ×‘×§×¨×” - ",n?.personalInfo?.fullName||n?.fullName||"××•×¨×”"]})}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",n?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(Ne,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×œ××™×“×™×",value:f.totalStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(Ne,{icon:e.jsx(ee,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:f.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(Ne,{icon:e.jsx(we,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:f.weeklyHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(Ne,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×",value:f.activeBagrutStudents,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(W,{icon:e.jsx(Pe,{className:"w-5 h-5"}),label:"×”×•×¡×£ ×©×™×¢×•×¨",onClick:()=>v("addLesson"),color:"indigo"}),e.jsx(W,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>v("markAttendance"),color:"green"}),e.jsx(W,{icon:e.jsx(ee,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘×œ×•×´×–",onClick:()=>v("viewSchedule"),color:"blue"}),e.jsx(W,{icon:e.jsx(Me,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×ª×œ××™×“×™×",onClick:()=>v("manageStudents"),color:"purple"}),w.includes("teacher")&&e.jsx(W,{icon:e.jsx(we,{className:"w-5 h-5"}),label:"×™××™ ×œ×™××•×“",onClick:()=>v("manageTeachingDays"),color:"orange"}),w.includes("conductor")&&e.jsx(W,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"×”×ª×–××•×¨×•×ª ×©×œ×™",onClick:()=>v("viewOrchestras"),color:"rose"}),w.includes("theory-teacher")&&e.jsx(W,{icon:e.jsx(me,{className:"w-5 h-5"}),label:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",onClick:()=>v("viewTheoryLessons"),color:"amber"}),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(W,{icon:e.jsx(Z,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×‘×’×¨×•×ª",onClick:()=>v("manageBagrut"),color:"emerald"}),e.jsx(W,{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"×ª×–××•×Ÿ ××‘×—×Ÿ",onClick:()=>v("scheduleBagrutExam"),color:"orange"}),e.jsx(W,{icon:e.jsx(Ce,{className:"w-5 h-5"}),label:"××¢×§×‘ ×”×ª×§×“××•×ª",onClick:()=>v("viewBagrutProgress"),color:"cyan"}),e.jsx(W,{icon:e.jsx(et,{className:"w-5 h-5"}),label:"×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡",onClick:()=>v("updateBagrutStatus"),color:"pink"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™×"}),e.jsxs("button",{onClick:()=>v("viewSchedule"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(oe,{className:"w-4 h-4"})]})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™× ××ª×•×›× × ×™× ×”×™×•×"})]}):e.jsx("div",{className:"space-y-3",children:d.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:a.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:a.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.duration," ×“×§×•×ª â€¢ ",a.type==="individual"?"×¤×¨×˜× ×™":"×§×‘×•×¦×ª×™"]})]})]},a.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¡×§×™×¨×ª × ×•×›×—×•×ª"}),e.jsxs("button",{onClick:()=>v("manageStudents"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(oe,{className:"w-4 h-4"})]})]}),F.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ × ×•×›×—×•×ª"})]}):e.jsx("div",{className:"space-y-3",children:F.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.status==="present"?"bg-green-500":a.status==="late"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:a.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["×©×™×¢×•×¨ ××—×¨×•×Ÿ: ",a.lastLesson]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-medium ${a.attendanceRate>=90?"text-green-600":a.attendanceRate>=75?"text-yellow-600":"text-red-600"}`,children:[a.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª"})]})]},a.studentId))})]}),G.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×‘×’×¨×•×ª"}),e.jsxs("button",{onClick:()=>v("manageBagrut"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1 mx-auto",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",G.length,")",e.jsx(oe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:G.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:a.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:a.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${fe(a.status)}`,children:Te(a.status)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a.progress>=75?"bg-green-500":a.progress>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(a.progress),"%"]})]})]})]},a.studentId))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(Ie,{className:"w-5 h-5 text-gray-400"})]}),I.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:I.map(a=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${a.type==="lesson"?"bg-blue-100":a.type==="attendance"?"bg-green-100":a.type==="note"?"bg-yellow-100":"bg-purple-100"}`,children:[a.type==="lesson"&&e.jsx(me,{className:"w-4 h-4 text-blue-600"}),a.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-green-600"}),a.type==="note"&&e.jsx(tt,{className:"w-4 h-4 text-yellow-600"}),a.type==="grade"&&e.jsx(st,{className:"w-4 h-4 text-purple-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:a.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:X(a.timestamp)})]})]},a.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"× ×ª×•× ×™× ××”×™×¨×™×"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"}),e.jsx("span",{className:"font-bold text-indigo-600",children:M.filter(a=>a.academicInfo?.isActive!==!1).length})]}),w.includes("conductor")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×–××•×¨×•×ª"}),e.jsx("span",{className:"font-bold text-purple-600",children:K.length})]}),w.includes("theory-teacher")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"}),e.jsx("span",{className:"font-bold text-blue-600",children:te.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×¢×•×ª ×”×©×‘×•×¢"}),e.jsxs("span",{className:"font-bold text-green-600",children:[f.weeklyHours," ×©×¢×•×ª"]})]})]})]})]})]})]})})}function Ne({icon:n,title:m,value:f,suffix:j,bgColor:d,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${d} border ${I} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:m}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[f," ",j&&e.jsx("span",{className:"text-lg font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function W({icon:n,label:m,onClick:f,color:j}){const d={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100 border-orange-200",rose:"bg-rose-50 text-rose-600 hover:bg-rose-100 border-rose-200",amber:"bg-amber-50 text-amber-600 hover:bg-amber-100 border-amber-200",emerald:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border-emerald-200",cyan:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100 border-cyan-200",pink:"bg-pink-50 text-pink-600 hover:bg-pink-100 border-pink-200"};return e.jsxs("button",{onClick:f,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${d[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:m})]})}function it(){const{user:n}=Se(),[m,f]=c.useState({totalTheoryStudents:0,todaysLessons:0,weeklyTheoryHours:0,upcomingExams:0,activeTheoryGroups:0,pendingGrades:0}),[j,d]=c.useState([]),[$,I]=c.useState([]),[q,F]=c.useState([]),[E,G]=c.useState(!0),[Y,Q]=c.useState(null);c.useEffect(()=>{n?._id&&V()},[n]);const V=async()=>{try{G(!0),Q(null);const r=n._id,T=(await P.theory.getTheoryLessons()).filter(s=>s.teacherId===r),k=new Date,y=k.toISOString().split("T")[0],C=T.filter(s=>new Date(s.date).toISOString().split("T")[0]===y),M=U(new Date),_=new Date(M);_.setDate(M.getDate()+7);const J=T.filter(s=>{const h=new Date(s.date);return h>=M&&h<_}).reduce((s,h)=>s+(h.duration||90),0)/60,K=new Set;T.forEach(s=>{s.studentIds&&s.studentIds.length>0&&s.studentIds.forEach(h=>K.add(h))});const O=T.filter(s=>s.isActive&&s.studentIds&&s.studentIds.length>0).length,te=new Date(k.getTime()+24*60*60*1e3).toISOString().split("T")[0],se=T.filter(s=>{const h=s.date.split("T")[0];return h===y||h===te}).slice(0,5).map(s=>({id:s._id,name:s.title||s.category,time:s.startTime,duration:s.duration||90,enrolledCount:s.studentIds?.length||0,capacity:s.maxStudents||15,level:s.category||"×ª×™××•×¨×™×”",venue:s.location}));f({totalTheoryStudents:K.size,todaysLessons:C.length,weeklyTheoryHours:Math.round(J*10)/10,upcomingExams:Math.floor(Math.random()*5)+1,activeTheoryGroups:O,pendingGrades:Math.floor(Math.random()*10)+2}),d(se);const w=[];T.slice(0,5).forEach((s,h)=>{w.push({id:`activity-${s._id}-${h}`,type:"lesson",title:"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×”×•×©×œ×",description:`×©×™×¢×•×¨ ${s.title||s.category} - ${s.studentIds?.length||0} ×ª×œ××™×“×™×`,timestamp:new Date(Date.now()-Math.random()*864e5*3).toISOString(),groupName:s.title||s.category})}),w.push({id:"attendance-1",type:"attendance",title:"× ×•×›×—×•×ª ×¢×•×“×›× ×”",description:"× ×•×›×—×•×ª ×œ×©×™×¢×•×¨ ××’××” ××ª×§×“××ª",timestamp:new Date(Date.now()-2*60*60*1e3).toISOString(),groupName:"××’××” ××ª×§×“××ª"}),I(w.sort((s,h)=>new Date(h.timestamp).getTime()-new Date(s.timestamp).getTime()));const ae=[],o=["××’××” ××ª×—×™×œ×™×","××’××” ×‘×™× ×•× ×™×™×","××’××” ××ª×§×“××™×","×”×¨××•× ×™×”","×§×•××¤×•×–×™×¦×™×”"],l=["×“× ×™××œ ×›×”×Ÿ","×¨×—×œ ×œ×•×™","×™×•×¡×£ ×’×¨×™×Ÿ","×©×¨×” ××‘×¨×”×","××™×›×œ ×“×•×“"];for(let s=0;s<Math.min(5,K.size);s++)ae.push({studentId:`student-${s}`,studentName:l[s%l.length],theoryGroup:o[s%o.length],currentLevel:Math.random()>.5?"×‘×™× ×•× ×™":"××ª×§×“×",progressPercentage:Math.floor(Math.random()*30)+70,lastActivity:new Date(Date.now()-Math.random()*6048e5).toLocaleDateString("he-IL"),attendanceRate:Math.floor(Math.random()*20)+80});F(ae)}catch(r){console.error("Error loading theory dashboard data:",r),Q("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×” ×œ×ª×™××•×¨×™×”")}finally{G(!1)}},U=r=>{const t=new Date(r),T=t.getDay(),k=t.getDate()-T;return new Date(t.setDate(k))},x=$e(),N=r=>{switch(r){case"scheduleTheoryLesson":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"markTheoryAttendance":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"manageTheoryGroups":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"gradeStudents":window.location.href="/teacher/theory-grades";break;default:console.log("Action:",r)}},B=r=>{const t=new Date(r),k=new Date().getTime()-t.getTime(),y=Math.floor(k/(1e3*60*60));return y<1?`×œ×¤× ×™ ${Math.floor(k/6e4)} ×“×§×•×ª`:y<24?`×œ×¤× ×™ ${y} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(y/24)} ×™××™×`};return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×ª×™××•×¨×™×”..."})]})}):Y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:Y}),e.jsx("button",{onClick:V,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:"×œ×•×— ×‘×§×¨×” - ××•×¨×” ×ª×™××•×¨×™×” ğŸ¼"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",n?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8",children:[e.jsx(de,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×ª×™××•×¨×™×”",value:m.totalTheoryStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(de,{icon:e.jsx(ee,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:m.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(de,{icon:e.jsx(we,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:m.weeklyTheoryHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(de,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª",value:m.upcomingExams,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(de,{icon:e.jsx(me,{className:"w-6 h-6"}),title:"×§×‘×•×¦×•×ª ×¤×¢×™×œ×•×ª",value:m.activeTheoryGroups,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(de,{icon:e.jsx(at,{className:"w-6 h-6"}),title:"×¦×™×•× ×™× ×××ª×™× ×™×",value:m.pendingGrades,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª - ×ª×™××•×¨×™×”"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ve,{icon:e.jsx(Pe,{className:"w-5 h-5"}),label:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",onClick:()=>N("scheduleTheoryLesson"),color:"indigo"}),e.jsx(ve,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª ×ª×™××•×¨×™×”",onClick:()=>N("markTheoryAttendance"),color:"green"}),e.jsx(ve,{icon:e.jsx(Ee,{className:"w-5 h-5"}),label:"× ×”×œ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",onClick:()=>N("manageTheoryGroups"),color:"blue"}),e.jsx(ve,{icon:e.jsx(rt,{className:"w-5 h-5"}),label:"×“×¨×’ ×ª×œ××™×“×™×",onClick:()=>N("gradeStudents"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™× - ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>x("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(oe,{className:"w-4 h-4"})]})]}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ××ª×•×›× × ×™×"})]}):e.jsx("div",{className:"space-y-3",children:j.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[r.level," â€¢ ",r.enrolledCount,"/",r.capacity," ×ª×œ××™×“×™×"]}),r.venue&&e.jsx("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:r.venue})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r.duration," ×“×§×•×ª"]})]})]},r.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>x("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(oe,{className:"w-4 h-4"})]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Be,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×”×ª×§×“××•×ª"})]}):e.jsx("div",{className:"space-y-3",children:q.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:r.studentName}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[r.theoryGroup," â€¢ ×¨××”: ",r.currentLevel]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["×¤×¢×™×œ×•×ª ××—×¨×•× ×”: ",r.lastActivity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.progressPercentage>=90?"bg-green-500":r.progressPercentage>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.progressPercentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[r.progressPercentage,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["× ×•×›×—×•×ª: ",r.attendanceRate,"%"]})]})]},r.studentId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×” - ×ª×™××•×¨×™×”"}),e.jsx(Ie,{className:"w-5 h-5 text-gray-400"})]}),$.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:$.map(r=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${r.type==="lesson"?"bg-blue-100":r.type==="attendance"?"bg-green-100":r.type==="grade"?"bg-purple-100":r.type==="enrollment"?"bg-yellow-100":"bg-indigo-100"}`,children:[r.type==="lesson"&&e.jsx(me,{className:"w-4 h-4 text-blue-600"}),r.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-green-600"}),r.type==="grade"&&e.jsx(Be,{className:"w-4 h-4 text-purple-600"}),r.type==="enrollment"&&e.jsx(Ee,{className:"w-4 h-4 text-yellow-600"}),r.type==="exam"&&e.jsx(Z,{className:"w-4 h-4 text-indigo-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:r.description}),r.groupName&&e.jsx("p",{className:"text-xs text-indigo-600 font-reisinger-yonatan",children:r.groupName}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:B(r.timestamp)})]})]},r.id))})]})]})]})})}function de({icon:n,title:m,value:f,suffix:j,bgColor:d,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${d} border ${I} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:m}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[f," ",j&&e.jsx("span",{className:"text-sm font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function ve({icon:n,label:m,onClick:f,color:j}){const d={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:f,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${d[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:m})]})}function yt(){const{user:n}=Se(),{currentSchoolYear:m}=We(),[f,j]=c.useState(!0),[d,$]=c.useState({activeStudents:0,staffMembers:0,activeOrchestras:0,weeklyRehearsals:0,studentsTrend:0,staffTrend:0,rehearsalsTrend:0}),[I,q]=c.useState([]),[F,E]=c.useState([]);c.useEffect(()=>{G()},[m]);const G=async()=>{try{j(!0);const x=m?{schoolYearId:m._id}:{},[N,B,r,t]=await Promise.all([P.students.getStudents(x),P.teachers.getTeachers(x),P.orchestras.getOrchestras(x),P.rehearsals.getRehearsals(x)]),T=N.filter(o=>o.isActive!==!1).length,k=B.filter(o=>o.isActive!==!1).length,y=r.filter(o=>o.isActive!==!1).length,C=new Date,M=new Date(C.getTime()+7*24*60*60*1e3),_=t.filter(o=>{const l=new Date(o.date);return l>=C&&l<=M}).length,H=Math.floor(Math.random()*20)-10,J=Math.floor(Math.random()*5)-2,K=Math.floor(Math.random()*8)-4;$({activeStudents:T,staffMembers:k,activeOrchestras:y,weeklyRehearsals:_,studentsTrend:H,staffTrend:J,rehearsalsTrend:K});const O=[];N.sort((o,l)=>new Date(l.createdAt||0)-new Date(o.createdAt||0)).slice(0,2).forEach(o=>{O.push({type:"student",title:"×¨×™×©×•× ×ª×œ××™×“ ×—×“×©",description:`${o.personalInfo?.fullName||"×ª×œ××™×“"} × ×¨×©× ×œ×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ`,time:Y(o.createdAt),color:"primary"})}),t.filter(o=>new Date(o.date)>=C).sort((o,l)=>new Date(o.date)-new Date(l.date)).slice(0,2).forEach(o=>{O.push({type:"rehearsal",title:"×—×–×¨×” × ×§×‘×¢×”",description:`${o.orchestraId?.name||"×ª×–××•×¨×ª"} - ${Q(o.date)} ${o.startTime||""}`,time:Y(o.createdAt),color:"success"})}),B.length>0&&B.filter(l=>l.studentCount>0).slice(0,1).forEach(l=>{O.push({type:"assignment",title:"×©×™×‘×•×¥ ××•×¨×”",description:`${l.personalInfo?.fullName||"××•×¨×”"} - ${l.studentCount} ×ª×œ××™×“×™×`,time:"×”×©×‘×•×¢",color:"orange"})}),q(O.slice(0,5));const w=[];t.filter(o=>new Date(o.date)>=C).sort((o,l)=>new Date(o.date)-new Date(l.date)).slice(0,2).forEach(o=>{w.push({title:o.orchestraId?.name||"×—×–×¨×ª ×ª×–××•×¨×ª",date:Q(o.date),description:`${o.type||"×—×–×¨×”"} - ${o.location||"××•×œ× ×¨××©×™"}`,isPrimary:o.type==="concert"})}),w.push({title:"×§×•× ×¦×¨×˜ ×—×•×¨×£",date:"15 ×‘×“×¦××‘×¨",description:"×›×œ ×”×ª×–××•×¨×•×ª ××‘×¦×¢×•×ª",isPrimary:!0}),w.length<3&&w.push({title:"××¡×¤×ª ×¡×’×œ",date:"8 ×‘×“×¦××‘×¨",description:"×™×©×™×‘×ª ×ª×›× ×•×Ÿ ×—×•×“×©×™×ª",isPrimary:!1}),E(w.slice(0,3))}catch(x){console.error("Failed to load dashboard data:",x)}finally{j(!1)}},Y=x=>{if(!x)return"×œ××—×¨×•× ×”";const N=new Date,B=new Date(x),r=N-B,t=Math.floor(r/6e4),T=Math.floor(r/36e5),k=Math.floor(r/864e5);return t<60?`×œ×¤× ×™ ${t} ×“×§×•×ª`:T<24?`×œ×¤× ×™ ${T} ×©×¢×•×ª`:k<7?`×œ×¤× ×™ ${k} ×™××™×`:"×”×©×‘×•×¢"},Q=x=>{if(!x)return"";const N=new Date(x);return`${N.getDate()}/${N.getMonth()+1}`},U=!n||n.role==="admin"||n.roles?.includes("admin")||n.role==="×× ×”×œ"||n.roles?.includes("×× ×”×œ")?"admin":n.role==="theory-teacher"||n.roles?.includes("theory-teacher")||n.roles?.includes("theory_teacher")||n.role==="××•×¨×” ×ª×™××•×¨×™×”"||n.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")?"theory-teacher":n.role==="conductor"||n.roles?.includes("conductor")||n.role==="×× ×¦×—"||n.roles?.includes("×× ×¦×—")||n.conducting?.orchestraIds?.length>0?"conductor":n.role==="teacher"||n.roles?.includes("teacher")||n.role==="××•×¨×”"||n.roles?.includes("××•×¨×”")||n.teaching?.studentIds?.length>0?"teacher":"admin";return U==="theory-teacher"?e.jsx(it,{}):U==="conductor"?e.jsx(lt,{}):U==="teacher"?e.jsx(ot,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(ye,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:f?"...":d.activeStudents.toString(),subtitle:"×ª×œ××™×“×™× ×¨×©×•××™×",icon:e.jsx(ue,{}),color:"blue",trend:d.studentsTrend!==0?{value:Math.abs(d.studentsTrend),label:"××”×—×•×“×© ×©×¢×‘×¨",direction:d.studentsTrend>0?"up":"down"}:void 0}),e.jsx(ye,{title:"×—×‘×¨×™ ×¡×’×œ",value:f?"...":d.staffMembers.toString(),subtitle:"××•×¨×™× ×•××“×¨×™×›×™×",icon:e.jsx(Z,{}),color:"green",trend:d.staffTrend!==0?{value:Math.abs(d.staffTrend),label:"××”×¨×‘×¢×•×Ÿ ×©×¢×‘×¨",direction:d.staffTrend>0?"up":"down"}:void 0}),e.jsx(ye,{title:"×”×¨×›×‘×™× ×¤×¢×™×œ×™×",value:f?"...":d.activeOrchestras.toString(),subtitle:"×ª×–××•×¨×•×ª ×•×§×‘×•×¦×•×ª",icon:e.jsx(he,{}),color:"purple"}),e.jsx(ye,{title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:f?"...":d.weeklyRehearsals.toString(),subtitle:"××¤×’×©×™× ××ª×•×›× × ×™×",icon:e.jsx(ee,{}),color:"orange",trend:d.rehearsalsTrend!==0?{value:Math.abs(d.rehearsalsTrend),label:"××”×©×‘×•×¢ ×©×¢×‘×¨",direction:d.rehearsalsTrend>0?"up":"down"}:void 0})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(pe,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"×¦×¤×” ×‘×”×›×œ"})]}),e.jsx("div",{className:"space-y-4",children:f?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):I.length>0?I.map((x,N)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-2 h-2 bg-${x.color}-500 rounded-full mt-2 ml-4`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:x.title}),e.jsx("span",{className:"text-xs text-gray-500",children:x.time})]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]})]},N)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”"})})]})}),e.jsx("div",{children:e.jsxs(pe,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××™×¨×•×¢×™× ×§×¨×•×‘×™×"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"×™×¦×™×¨×ª ××™×¨×•×¢"})]}),e.jsx("div",{className:"space-y-4",children:f?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):F.length>0?F.map((x,N)=>e.jsxs("div",{className:`p-4 rounded-lg ${x.isPrimary?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:`text-sm font-medium ${x.isPrimary?"text-primary-900":"text-gray-900"}`,children:x.title}),e.jsx("span",{className:`text-xs ${x.isPrimary?"text-primary-600":"text-gray-500"}`,children:x.date})]}),e.jsx("p",{className:`text-sm ${x.isPrimary?"text-primary-700":"text-gray-600"}`,children:x.description})]},N)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™×"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(pe,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×§×“××•×ª ×—×•×“×©×™×ª"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×—×•×“×©"}),!f&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary-600",children:d.activeStudents}),e.jsx("p",{className:"text-sm text-gray-600",children:"×ª×œ××™×“×™×"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-success-600",children:d.weeklyRehearsals}),e.jsx("p",{className:"text-sm text-gray-600",children:"×—×–×¨×•×ª"})]})]})]})})]}),e.jsxs(pe,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×ª×œ××™×“×™×"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×”×¨×›×‘×™×"}),!f&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:d.activeOrchestras}),e.jsx("p",{className:"text-sm text-gray-600",children:"×”×¨×›×‘×™× ×¤×¢×™×œ×™×"}),e.jsxs("p",{className:"text-lg mt-2 text-gray-700",children:["×××•×¦×¢: ",d.activeOrchestras>0?Math.floor(d.activeStudents/d.activeOrchestras):0," ×ª×œ××™×“×™× ×œ×”×¨×›×‘"]})]})]})})]})]})]})}export{yt as default};
