import{j as e,u as je,V as Ee}from"../assets/index-Y6gcqfIP.js";import{R as tt,r as o,u as st,b as at}from"./vendor-E-WBaSU9.js";import{a as R,t as De}from"./cascade-deletion-MikTgWpr.js";import{M as ue,J as Me,O as ke,T as Ie,U as we,e as xe,Z as ze,b as ae,d as re,r as Ue,u as rt,c as Ge,A as Ae,t as le,m as ge,X as ve,f as se,P as be,ab as Ve,V as nt,E as it,ac as lt,B as ye,v as Oe,g as ot,G as Pe,W as Re,an as ct,j as dt,ah as mt,S as ut,a3 as gt,K as xt}from"./ui-DIGiJ8tL.js";import{t as Be}from"./theoryEnrollmentService-Bw4SayZ7.js";import"./query-CMzvnXZ6.js";import"./utils-Cgyyg58q.js";function ht({student:t,onEdit:S,onDelete:T,onViewDetails:y,onScheduleLesson:h,onMarkAttendance:c,onAddNote:m,className:l=""}){const g=t.academicInfo?.instrumentProgress?.find(b=>b.isPrimary)||t.academicInfo?.instrumentProgress?.[0],D=g?.instrumentName||"×œ× ×”×•×’×“×¨",p=g?.currentStage||0,u=t.scheduleInfo||t.teacherAssignments?.[0],F=u?`${u.day} ${u.startTime||u.time}`:null,q=u?.duration||60,i=!!u,v=t.academicInfo?.isActive!==!1&&t.status!=="inactive",I=v?"text-green-800 bg-green-100":"text-red-800 bg-red-100",d=v?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ",C=v?Ge:Ae,H=i?"border-2 border-green-400 shadow-sm shadow-green-200":"border border-gray-200";return e.jsxs("div",{className:`bg-white ${H} rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${l}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan text-lg",children:t.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${I}`,children:[tt.createElement(C,{className:"w-3 h-3"}),d]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ue,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-yonatan font-medium",children:D}),p>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-yonatan",children:["×©×œ×‘ ",p]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>y(t.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¦×¤×” ×‘×¤×¨×˜×™× ××œ××™×",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(t),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×œ××™×“",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(t.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×œ××™×“",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[t.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["×’×™×œ: ",t.personalInfo.age]})]}),t.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["×›×™×ª×”: ",t.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:t.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:t.personalInfo.phone})]})})]}),F&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-yonatan",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"×©×™×¢×•×¨ ×§×‘×•×¢:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-yonatan text-blue-700",children:F}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(re,{className:"w-3 h-3"}),e.jsxs("span",{children:[q," ×“×§'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>y(t.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"×¤×¨×˜×™× ××œ××™×"]}),h&&e.jsxs("button",{onClick:()=>h(t.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"×§×‘×¢ ×©×™×¢×•×¨"]}),c&&e.jsxs("button",{onClick:()=>c(t.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),"× ×•×›×—×•×ª"]}),m&&e.jsxs("button",{onClick:()=>m(t.id),className:"text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(rt,{className:"w-4 h-4"}),"×”×¢×¨×”"]})]})})]})}function Fe(){const{user:t}=je(),[S,T]=o.useState([]),[y,h]=o.useState(!0),[c,m]=o.useState("");o.useState(!1),o.useState(null);const[l,g]=o.useState(null),[D,p]=o.useState(0);o.useState(!1);const[u,F]=o.useState({status:"all",instrument:"all",hasSchedule:"all",bagrutStatus:"all"});o.useState("cards"),o.useState(new Set),o.useState(!1);const[q,i]=o.useState(!1),[v,I]=o.useState([]),[d,C]=o.useState(!1);o.useEffect(()=>{H()},[t]);const H=async(f=!0)=>{if(t?._id)try{f&&h(!0),g(null);const B=t._id,M=await R.teachers.getTeacher(B);if(!M)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");const A=M?.teaching?.studentIds||[];if(A.length===0){console.log("No students assigned to teacher"),T([]),p(0);return}const P=await R.students.getBatchStudents(A);if(!Array.isArray(P))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const U=P.filter(O=>A.includes(O._id)||A.includes(O.id));U.length!==P.length&&console.warn(`ğŸ”§ Component-level filtering: ${U.length}/${P.length} students match teacher's student IDs`);const J=U.map(O=>{const ee=O.personalInfo?.fullName||"",ne=ee.split(" ");return{id:O._id,firstName:O.personalInfo?.firstName||ne[0]||"",lastName:O.personalInfo?.lastName||ne.slice(1).join(" ")||"",fullName:ee,email:O.personalInfo?.email||O.contactInfo?.email||"",phone:O.personalInfo?.phone||O.contactInfo?.phone||"",instrument:O.academicInfo?.primaryInstrument||O.primaryInstrument||"",grade:O.academicInfo?.gradeLevel||"",status:O.academicInfo?.isActive!==!1?"active":"inactive",joinDate:O.createdAt,personalInfo:{fullName:ee,phone:O.personalInfo?.phone||O.contactInfo?.phone,age:O.personalInfo?.age,class:O.personalInfo?.class||O.academicInfo?.class},academicInfo:{instrumentProgress:O.academicInfo?.instrumentProgress||[],isActive:O.academicInfo?.isActive!==!1},teacherAssignments:O.teacherAssignments||[],scheduleInfo:O.scheduleInfo}});T(J),p(0)}catch(B){console.error("Error loading teacher students:",B),g("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×œ××™×“×™×. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×” ×©×•×‘."),p(M=>M+1)}finally{f&&h(!1)}},b=async()=>{try{C(!0);const f=await R.students.getStudents();if(!f||!Array.isArray(f)){console.error("Invalid response from getStudents"),I([]);return}const B=t?._id,A=(await R.teachers.getTeacher(B))?.teaching?.studentIds||[],P=f.filter(U=>!A.includes(U._id)&&!A.includes(U.id));I(P)}catch(f){console.error("Error loading all students:",f),I([])}finally{C(!1)}},L=S.filter(f=>{const B=c===""||`${f.firstName} ${f.lastName}`.toLowerCase().includes(c.toLowerCase())||f.instrument?.toLowerCase().includes(c.toLowerCase())||f.email?.toLowerCase().includes(c.toLowerCase()),M=u.status==="all"||f.status===u.status,A=u.instrument==="all"||f.instrument===u.instrument,P=f.scheduleInfo||f.teacherAssignments?.length>0,U=u.hasSchedule==="all"||u.hasSchedule==="yes"&&P||u.hasSchedule==="no"&&!P,J=f.academicInfo?.isBagrutStudent||f.academicInfo?.instrumentProgress?.some(ee=>ee.currentStage>=4),O=u.bagrutStatus==="all"||u.bagrutStatus==="yes"&&J||u.bagrutStatus==="no"&&!J;return B&&M&&A&&U&&O}),E=async f=>{const B=S.find(A=>A.id===f),M=B?.personalInfo?.fullName||B?.fullName||"×”×ª×œ××™×“";if(window.confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ${M}?

×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×©×•×¨×™× ×œ×ª×œ××™×“ ×•×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`))try{await R.students.deleteStudent(f),T(P=>P.filter(U=>U.id!==f));const A=document.createElement("div");A.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",A.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${M} × ××—×§ ×‘×”×¦×œ×—×”</div>`,document.body.appendChild(A),setTimeout(()=>A.remove(),3e3)}catch(A){console.error("Error deleting student:",A);const P=document.createElement("div");P.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",P.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>×©×’×™××” ×‘××—×™×§×ª ${M}</div>`,document.body.appendChild(P),setTimeout(()=>P.remove(),5e3)}},k=f=>{window.location.href=`/students/${f}`},W=f=>{S.find(M=>M.id===f)&&(window.location.href=`/teacher/schedule?student=${f}`)},_=(f,B)=>{const M=document.createElement("div");M.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${B==="success"?"bg-green-500 text-white":B==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,M.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${B==="success"?"âœ…":B==="error"?"âŒ":"â„¹ï¸"} ${f}
    </div>`,document.body.appendChild(M),setTimeout(()=>M.remove(),3e3)},K=async(f,B)=>{try{const M=t?._id,A=await R.students.getStudent(f._id),P=(A.teacherAssignments||[]).findIndex(O=>O.teacherId===M),U={teacherId:M,day:B.lessonDay,time:B.lessonTime,duration:B.lessonDuration||45,location:B.lessonLocation||"",isActive:!0};let J;P>=0?(J=[...A.teacherAssignments||[]],J[P]={...J[P],...U}):J=[...A.teacherAssignments||[],U],await R.students.updateStudent(f._id,{teacherAssignments:J}),await H(),_(`${f.personalInfo?.fullName} ×”×•×§×¦×” ×‘×”×¦×œ×—×”`,"success"),i(!1)}catch(M){console.error("Error assigning student:",M),_("×©×’×™××” ×‘×”×§×¦××ª ×”×ª×œ××™×“","error")}};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]})}):l?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-yonatan",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-yonatan mt-1",children:l})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>H(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-yonatan",children:"× ×¡×” ×©×•×‘"}),D>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-yonatan",children:"×¨×¢× ×Ÿ ×“×£"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×œ××™×“×™× ×©×œ×™"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×ª×œ××™×“×™× ×¨×©×•××™×"]})]}),e.jsxs("button",{onClick:()=>{i(!0),b()},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×§×¦×” ×ª×œ××™×“"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:c,onChange:f=>m(f.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:c?"×œ× × ××¦××• ×ª×œ××™×“×™×":"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:c?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×œ××™×“ ×”×¨××©×•×Ÿ ×©×œ×š"}),!c&&e.jsxs("button",{onClick:()=>{i(!0),b()},className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:[e.jsx(le,{className:"w-4 h-4"}),"×”×§×¦×” ×ª×œ××™×“ ×¨××©×•×Ÿ"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"×¡×”×´×› ×ª×œ××™×“×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:S.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:S.filter(f=>f.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"×¢× ×©×™×¢×•×¨×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:S.filter(f=>f.scheduleInfo||f.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:L.map(f=>e.jsx(ht,{student:f,onEdit:B=>{alert("×¢×¨×™×›×ª ×ª×œ××™×“ ×–××™× ×” ×¨×§ ×œ×× ×”×œ×™×")},onDelete:E,onViewDetails:k,onScheduleLesson:W},f.id))})]}),q&&e.jsx(ft,{allStudents:v,loading:d,onClose:()=>{i(!1),I([])},onSubmit:K})]})}function ft({allStudents:t,loading:S,onClose:T,onSubmit:y}){const[h,c]=o.useState(""),[m,l]=o.useState(null),[g,D]=o.useState({instrument:"",lessonDay:"",lessonTime:"",lessonDuration:45,lessonLocation:""}),[p,u]=o.useState(!1),F=t.filter(i=>{const v=h.toLowerCase().trim();if(!v)return!0;const I=i.personalInfo?.fullName||`${i.personalInfo?.firstName||""} ${i.personalInfo?.lastName||""}`.trim(),d=i.personalInfo?.class||i.academicInfo?.class||"",C=[i.academicInfo?.primaryInstrument,...i.academicInfo?.instrumentProgress?.map(L=>L.instrumentName)||[]].filter(Boolean).join(" "),H=`${I} ${d} ${C}`.toLowerCase();return v.split(/\s+/).filter(L=>L.length>0).every(L=>H.includes(L))}),q=async i=>{if(i.preventDefault(),!m){alert("×× × ×‘×—×¨ ×ª×œ××™×“");return}if(!g.instrument){alert("×× × ×‘×—×¨ ×›×œ×™ × ×’×™× ×”");return}u(!0);try{await y(m,g)}catch(v){console.error("Error submitting assignment:",v)}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",dir:"rtl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×”×§×¦××ª ×ª×œ××™×“ ×§×™×™×"}),S?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]}):e.jsxs("form",{onSubmit:q,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×—×¤×© ×ª×œ××™×“ ×‘××¢×¨×›×ª"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×¤×© ×œ×¤×™ ×©×, ×›×™×ª×” ××• ×›×œ×™ × ×’×™× ×”...",value:h,onChange:i=>c(i.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 border border-gray-200 rounded-lg",children:F.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:h?"×œ× × ××¦××• ×ª×œ××™×“×™× ×”×ª×•×××™× ××ª ×”×—×™×¤×•×©":"××™×Ÿ ×ª×œ××™×“×™× ×–××™× ×™× ×œ×”×§×¦××”"}):e.jsx("div",{className:"divide-y divide-gray-200",children:F.map(i=>{const v=i.personalInfo?.fullName||`${i.personalInfo?.firstName||""} ${i.personalInfo?.lastName||""}`.trim(),I=i.personalInfo?.class||i.academicInfo?.class||"",d=i.academicInfo?.primaryInstrument||"",C=m?._id===i._id;return e.jsx("div",{onClick:()=>l(i),className:`p-3 cursor-pointer transition-colors ${C?"bg-indigo-50 border-r-4 border-indigo-600":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:v}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[I&&e.jsxs("span",{children:["×›×™×ª×” ",I]}),d&&e.jsxs(e.Fragment,{children:[I&&" â€¢ ",e.jsx("span",{children:d})]})]})]}),C&&e.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Ue,{className:"w-4 h-4 text-white"})})]})},i._id)})})}),m&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:["×¤×¨×˜×™ ×”×©×™×¢×•×¨ ×¢×‘×•×¨ ",m.personalInfo?.fullName]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×›×œ×™ × ×’×™× ×” ×œ×©×™×¢×•×¨ *"}),e.jsxs("select",{value:g.instrument,onChange:i=>D(v=>({...v,instrument:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),e.jsx("option",{value:"×¤×¡× ×ª×¨",children:"×¤×¡× ×ª×¨"}),e.jsx("option",{value:"×›×™× ×•×¨",children:"×›×™× ×•×¨"}),e.jsx("option",{value:"×¦'×œ×•",children:"×¦'×œ×•"}),e.jsx("option",{value:"×•×™×•×œ×”",children:"×•×™×•×œ×”"}),e.jsx("option",{value:"×—×¦×•×¦×¨×”",children:"×—×¦×•×¦×¨×”"}),e.jsx("option",{value:"×˜×¨×•××‘×•×Ÿ",children:"×˜×¨×•××‘×•×Ÿ"}),e.jsx("option",{value:"×§×œ×¨×™× ×˜",children:"×§×œ×¨×™× ×˜"}),e.jsx("option",{value:"×—×œ×™×œ",children:"×—×œ×™×œ"}),e.jsx("option",{value:"×¡×§×¡×•×¤×•×Ÿ",children:"×¡×§×¡×•×¤×•×Ÿ"}),e.jsx("option",{value:"×”×•×¨×Ÿ",children:"×”×•×¨×Ÿ"}),e.jsx("option",{value:"×˜×•×‘×”",children:"×˜×•×‘×”"}),e.jsx("option",{value:"×›×œ×™ ×”×§×©×”",children:"×›×œ×™ ×”×§×©×”"}),e.jsx("option",{value:"×’×™×˜×¨×”",children:"×’×™×˜×¨×”"}),e.jsx("option",{value:"×§×•× ×˜×¨×‘×¡",children:"×§×•× ×˜×¨×‘×¡"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsxs("select",{value:g.lessonDay,onChange:i=>D(v=>({...v,lessonDay:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×™×•×"}),e.jsx("option",{value:"×¨××©×•×Ÿ",children:"×™×•× ×¨××©×•×Ÿ"}),e.jsx("option",{value:"×©× ×™",children:"×™×•× ×©× ×™"}),e.jsx("option",{value:"×©×œ×™×©×™",children:"×™×•× ×©×œ×™×©×™"}),e.jsx("option",{value:"×¨×‘×™×¢×™",children:"×™×•× ×¨×‘×™×¢×™"}),e.jsx("option",{value:"×—××™×©×™",children:"×™×•× ×—××™×©×™"}),e.jsx("option",{value:"×©×™×©×™",children:"×™×•× ×©×™×©×™"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:g.lessonTime,onChange:i=>D(v=>({...v,lessonTime:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š (×“×§×•×ª)"}),e.jsx("input",{type:"number",min:"15",max:"120",step:"15",value:g.lessonDuration,onChange:i=>D(v=>({...v,lessonDuration:parseInt(i.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××™×§×•×"}),e.jsxs("select",{value:g.lessonLocation,onChange:i=>D(v=>({...v,lessonLocation:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×—×“×¨"}),Ee.map(i=>e.jsx("option",{value:i,children:i},i))]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{type:"submit",disabled:!m||!g.instrument||p,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"××§×¦×”..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"×”×§×¦×” ×ª×œ××™×“"]})}),e.jsxs("button",{type:"button",onClick:T,disabled:p,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]})]})]})})}function pt({isOpen:t,onClose:S,orchestraId:T,orchestraName:y,onSave:h}){const[c,m]=o.useState({date:"",startTime:"19:00",endTime:"21:00",location:"××•×œ× ××•×–×™×§×”",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""}),[l,g]=o.useState({}),[D,p]=o.useState(!1);o.useEffect(()=>{if(t){const i=new Date;i.setDate(i.getDate()+1),m(v=>({...v,date:i.toISOString().split("T")[0]}))}},[t]);const u=()=>{const i={};if(!c.date)i.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const v=new Date(c.date),I=new Date;I.setHours(0,0,0,0),v<I&&(i.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(c.startTime||(i.startTime="×™×© ×œ×‘×—×•×¨ ×©×¢×ª ×”×ª×—×œ×”"),c.endTime||(i.endTime="×™×© ×œ×‘×—×•×¨ ×©×¢×ª ×¡×™×•×"),c.startTime&&c.endTime){const v=new Date(`2000-01-01T${c.startTime}`);new Date(`2000-01-01T${c.endTime}`)<=v&&(i.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”")}return c.location.trim()||(i.location="×™×© ×œ×¦×™×™×Ÿ ××§×•×"),c.recurring&&!c.endRecurrence&&(i.endRecurrence="×™×© ×œ×¦×™×™×Ÿ ×ª××¨×™×š ×¡×™×•× ×œ×—×–×¨×•×ª ×§×‘×•×¢×•×ª"),g(i),Object.keys(i).length===0},F=async i=>{if(i.preventDefault(),!!u()){p(!0);try{await h(c),S(),m({date:"",startTime:"19:00",endTime:"21:00",location:"××•×œ× ××•×–×™×§×”",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""})}catch(v){console.error("Error saving rehearsal:",v)}finally{p(!1)}}},q=()=>{if(!c.startTime||!c.endTime)return"";const i=new Date(`2000-01-01T${c.startTime}`),I=(new Date(`2000-01-01T${c.endTime}`).getTime()-i.getTime())/(1e3*60);if(I<=0)return"";const d=Math.floor(I/60),C=I%60;return d===0?`${C} ×“×§×•×ª`:C===0?`${d} ×©×¢×•×ª`:`${d} ×©×¢×•×ª ×•-${C} ×“×§×•×ª`};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×§×‘×™×¢×ª ×—×–×¨×” ×—×“×©×”"}),e.jsx("button",{onClick:S,className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium font-reisinger-yonatan",children:["×ª×–××•×¨×ª: ",y]})]})}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª××¨×™×š ×”×—×–×¨×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",required:!0,value:c.date,onChange:i=>m(v=>({...v,date:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${l.date?"border-red-300":"border-gray-300"}`})]}),l.date&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:l.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:c.startTime,onChange:i=>m(v=>({...v,startTime:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${l.startTime?"border-red-300":"border-gray-300"}`})]}),l.startTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:l.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:c.endTime,onChange:i=>m(v=>({...v,endTime:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${l.endTime?"border-red-300":"border-gray-300"}`})]}),l.endTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:l.endTime})]})]}),q()&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded font-reisinger-yonatan",children:["××©×š ×”×—×–×¨×”: ",q()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×”×—×–×¨×” *"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",required:!0,value:c.location,onChange:i=>m(v=>({...v,location:i.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${l.location?"border-red-300":"border-gray-300"}`,placeholder:"×œ××©×œ: ××•×œ× ××•×–×™×§×”, ×—×“×¨ 101"})]}),l.location&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:l.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:c.notes,onChange:i=>m(v=>({...v,notes:i.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×œ ×”×—×–×¨×” (××•×¤×¦×™×•× ×œ×™)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"recurring",type:"checkbox",checked:c.recurring,onChange:i=>m(v=>({...v,recurring:i.target.checked})),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring",className:"mr-2 text-sm text-gray-700 font-reisinger-yonatan",children:"×—×–×¨×” ×§×‘×•×¢×” (×—×•×–×¨×ª)"})]}),c.recurring&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×“×™×¨×•×ª"}),e.jsxs("select",{value:c.recurrencePattern,onChange:i=>m(v=>({...v,recurrencePattern:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"weekly",children:"×©×‘×•×¢×™"}),e.jsx("option",{value:"biweekly",children:"×“×•-×©×‘×•×¢×™"}),e.jsx("option",{value:"monthly",children:"×—×•×“×©×™"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª××¨×™×š ×¡×™×•× ×”×—×–×¨×•×ª ×”×§×‘×•×¢×•×ª *"}),e.jsx("input",{type:"date",required:c.recurring,value:c.endRecurrence,onChange:i=>m(v=>({...v,endRecurrence:i.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${l.endRecurrence?"border-red-300":"border-gray-300"}`}),l.endRecurrence&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:l.endRecurrence})]}),e.jsxs("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded flex items-start gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×—×–×¨×•×ª ×§×‘×•×¢×•×ª ×™×™×•×•×¦×¨×• ××•×˜×•××˜×™×ª ×¢×“ ×”×ª××¨×™×š ×©×¦×•×™×Ÿ"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:D,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors font-reisinger-yonatan",children:D?"×§×•×‘×¢ ×—×–×¨×”...":"×§×‘×¢ ×—×–×¨×”"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})}):null}function We(){const{user:t}=je(),[S,T]=o.useState([]),[y,h]=o.useState(!0),[c,m]=o.useState(""),[l,g]=o.useState(!1),[D,p]=o.useState(null),[u,F]=o.useState(null),[q,i]=o.useState([]),[v,I]=o.useState(null),[d,C]=o.useState("members");o.useState(!1);const[H,b]=o.useState(!1),[L,E]=o.useState([]),[k,W]=o.useState([]),[_,K]=o.useState(""),[f,B]=o.useState("");o.useEffect(()=>{M()},[t]);const M=async()=>{if(t?._id)try{h(!0);const s=t._id,w=await R.teachers.getTeacher(s);if(!w)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const j=w?.conducting?.orchestraIds||[];if(j.length===0){console.log("No orchestras assigned to conductor"),T([]);return}const x=await R.orchestras.getBatchOrchestras(j);if(!Array.isArray(x))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const a=x.map(n=>({id:n._id,name:n.name,description:n.description,type:n.type,level:n.level,memberCount:n.memberCount||0,status:n.status||"active",rehearsalDay:n.rehearsalSchedule?.day,rehearsalTime:n.rehearsalSchedule?.time,venue:n.venue}));T(a)}catch(s){console.error("Error loading conductor orchestras:",s),I("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×–××•×¨×•×ª")}finally{h(!1)}},A=async s=>{try{const x=((await R.orchestras.getOrchestra(s)).memberDetails||[]).map(a=>({id:a._id,firstName:a.personalInfo?.firstName||"",lastName:a.personalInfo?.lastName||"",instrument:a.academicInfo?.instrumentProgress?.find(n=>n.isPrimary)?.instrumentName||a.primaryInstrument||"",section:a.section||"×›×œ×œ×™",status:a.status||"active",enrollmentDate:a.enrollmentDate||new Date().toISOString(),performanceLevel:a.performanceLevel||"intermediate",attendanceRate:Math.floor(Math.random()*20)+80}));i(x)}catch(w){console.error("Error loading orchestra members:",w)}},P=async()=>{try{const s=await R.students.getStudents({status:"active",limit:200}),w=q.map(x=>x.id),j=s.filter(x=>!w.includes(x._id));E(j)}catch(s){console.error("Error loading available students:",s)}},U=async s=>{try{const j=(await R.rehearsals.getRehearsals({groupId:s,limit:20})).map(x=>({id:x._id,date:new Date(x.scheduledDate).toLocaleDateString("he-IL"),time:x.startTime||"19:00",location:x.location||"××•×œ× ××•×–×™×§×”",duration:x.duration||120,status:x.status||"scheduled",attendanceCount:x.attendanceList?.length||0,totalMembers:q.length}));W(j)}catch(w){console.error("Error loading orchestra rehearsals:",w),W([])}},J=async s=>{if(u)try{await R.orchestras.addMember(u,s),await A(u),await P(),alert("×”×ª×œ××™×“ × ×•×¡×£ ×‘×”×¦×œ×—×” ×œ×ª×–××•×¨×ª")}catch(w){console.error("Error adding member:",w),alert("×©×’×™××” ×‘×”×•×¡×¤×ª ×”×ª×œ××™×“ ×œ×ª×–××•×¨×ª")}},O=async s=>{if(u&&window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¡×™×¨ ××ª ×”×ª×œ××™×“ ××”×ª×–××•×¨×ª?"))try{await R.orchestras.removeMember(u,s),await A(u),await P(),alert("×”×ª×œ××™×“ ×”×•×¡×¨ ×‘×”×¦×œ×—×” ××”×ª×–××•×¨×ª")}catch(w){console.error("Error removing member:",w),alert("×©×’×™××” ×‘×”×¡×¨×ª ×”×ª×œ××™×“ ××”×ª×–××•×¨×ª")}},ee=async s=>{if(u)try{const w={groupId:u,groupType:"orchestra",scheduledDate:new Date(s.date).toISOString(),startTime:s.startTime,endTime:s.endTime,duration:ne(s.startTime,s.endTime),location:s.location,notes:s.notes,status:"scheduled"};if(s.recurring){const j=me(w,s);await Promise.all(j.map(x=>R.rehearsals.createRehearsal(x))),alert(`${j.length} ×—×–×¨×•×ª × ×•×¦×¨×• ×‘×”×¦×œ×—×”`)}else await R.rehearsals.createRehearsal(w),alert("×—×–×¨×” × ×•×¦×¨×” ×‘×”×¦×œ×—×”");await U(u),b(!1)}catch(w){console.error("Error scheduling rehearsal:",w),alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×”×—×–×¨×”")}},ne=(s,w)=>{const j=new Date(`2000-01-01T${s}`),x=new Date(`2000-01-01T${w}`);return Math.round((x.getTime()-j.getTime())/(1e3*60))},me=(s,w)=>{const j=[],x=new Date(w.date),a=new Date(w.endRecurrence);let n=new Date(x);for(;n<=a;)switch(j.push({...s,scheduledDate:new Date(n).toISOString()}),w.recurrencePattern){case"weekly":n.setDate(n.getDate()+7);break;case"biweekly":n.setDate(n.getDate()+14);break;case"monthly":n.setMonth(n.getMonth()+1);break}return j},oe=S.filter(s=>c===""||s.name.toLowerCase().includes(c.toLowerCase())||s.type.toLowerCase().includes(c.toLowerCase())||s.description?.toLowerCase().includes(c.toLowerCase())),ce=async s=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×ª×–××•×¨×ª ×–×•?"))try{await R.orchestras.deleteOrchestra(s),T(w=>w.filter(j=>j.id!==s)),u===s&&(F(null),i([]))}catch(w){console.error("Error deleting orchestra:",w),alert("×©×’×™××” ×‘××—×™×§×ª ×”×ª×–××•×¨×ª")}},he=async s=>{try{if(D){const w={name:s.name,description:s.description,type:s.type,level:s.level,status:s.status,rehearsalSchedule:{day:s.rehearsalDay,time:s.rehearsalTime},venue:s.venue},j=await R.orchestras.updateOrchestra(D.id,w),x={id:j._id,name:j.name,description:j.description,type:j.type,level:j.level,memberCount:j.memberCount||0,status:j.status||"active",rehearsalDay:j.rehearsalSchedule?.day,rehearsalTime:j.rehearsalSchedule?.time,venue:j.venue};T(a=>a.map(n=>n.id===D.id?x:n))}else{const w=t?._id,j={name:s.name,description:s.description,type:s.type,level:s.level,status:s.status,rehearsalSchedule:{day:s.rehearsalDay,time:s.rehearsalTime},venue:s.venue,conductorId:w},x=await R.orchestras.createOrchestra(j),a={id:x._id,name:x.name,description:x.description,type:x.type,level:x.level,memberCount:x.memberCount||0,status:x.status||"active",rehearsalDay:x.rehearsalSchedule?.day,rehearsalTime:x.rehearsalSchedule?.time,venue:x.venue};T(n=>[...n,a])}g(!1),p(null)}catch(w){console.error("Error saving orchestra:",w),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×ª×–××•×¨×ª")}},fe=s=>{switch(s){case"youth":return"×ª×–××•×¨×ª × ×•×¢×¨";case"adult":return"×ª×–××•×¨×ª ××‘×•×’×¨×™×";case"chamber":return"×ª×–××•×¨×ª ×§×××¨×™×ª";case"symphony":return"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª";default:return s}},r=s=>{switch(s){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return s}};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×–××•×¨×•×ª..."})]})}):v?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:v})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×ª×–××•×¨×•×ª"]})]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×–××•×¨×ª"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×–××•×¨×•×ª...",value:c,onChange:s=>m(s.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:oe.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:c?"×œ× × ××¦××• ×ª×–××•×¨×•×ª":"××™×Ÿ ×ª×–××•×¨×•×ª ×¨×©×•××•×ª"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:c?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×–××•×¨×ª ×”×¨××©×•× ×” ×©×œ×š"})]}):oe.map(s=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${u===s.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{F(s.id),A(s.id),U(s.id),C("members")},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[fe(s.type)," â€¢ ",r(s.level)]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),p(s),g(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×–××•×¨×ª",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),ce(s.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×–××•×¨×ª",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.memberCount||0," ×—×‘×¨×™×"]})]}),s.rehearsalDay&&e.jsxs("span",{children:["×—×–×¨×•×ª: ",s.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},s.id))}),u&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-1 p-1",children:[e.jsxs("button",{onClick:()=>C("members"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${d==="members"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(se,{className:"w-4 h-4 inline mr-2"}),"×—×‘×¨×™ ×”×ª×–××•×¨×ª"]}),e.jsxs("button",{onClick:()=>{C("enrollment"),P()},className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${d==="enrollment"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(le,{className:"w-4 h-4 inline mr-2"}),"×¨×™×©×•× ×—×‘×¨×™×"]}),e.jsxs("button",{onClick:()=>C("rehearsals"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${d==="rehearsals"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ae,{className:"w-4 h-4 inline mr-2"}),"×—×–×¨×•×ª"]})]})}),e.jsxs("div",{className:"p-4",children:[d==="members"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["×—×‘×¨×™ ×”×ª×–××•×¨×ª (",q.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×—×‘×¨×™×...",value:f,onChange:s=>B(s.target.value),className:"pl-4 pr-10 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})})]}),q.filter(s=>f===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(f.toLowerCase())||s.instrument.toLowerCase().includes(f.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:f?"×œ× × ××¦××• ×—×‘×¨×™×":"××™×Ÿ ×—×‘×¨×™× ×¨×©×•××™× ×‘×ª×–××•×¨×ª"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.filter(s=>f===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(f.toLowerCase())||s.instrument.toLowerCase().includes(f.toLowerCase())).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="active"?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[s.instrument," â€¢ ",s.section]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["× ×•×›×—×•×ª: ",s.attendanceRate,"% â€¢ ×¨××”: ",r(s.performanceLevel||"intermediate")]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>O(s.id),className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"×”×¡×¨ ××”×ª×–××•×¨×ª",children:e.jsx(Ve,{className:"w-4 h-4"})})})]},s.id))})]}),d==="enrollment"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"×”×•×¡×£ ×—×‘×¨×™× ×—×“×©×™×"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:_,onChange:s=>K(s.target.value),className:"pl-4 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})]}),L.filter(s=>_===""||s.personalInfo?.fullName?.toLowerCase().includes(_.toLowerCase())||s.academicInfo?.primaryInstrument?.toLowerCase().includes(_.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:_?"×œ× × ××¦××• ×ª×œ××™×“×™×":"××™×Ÿ ×ª×œ××™×“×™× ×–××™× ×™×"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:L.filter(s=>_===""||s.personalInfo?.fullName?.toLowerCase().includes(_.toLowerCase())||s.academicInfo?.primaryInstrument?.toLowerCase().includes(_.toLowerCase())).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:s.personalInfo?.fullName}),e.jsx("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:s.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ ×›×œ×™"})]}),e.jsxs("button",{onClick:()=>J(s._id),className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"×”×•×¡×£"]})]},s._id))})]}),d==="rehearsals"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"×—×–×¨×•×ª ×”×ª×–××•×¨×ª"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),"×§×‘×¢ ×—×–×¨×”"]})]}),k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:k.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.status==="completed"?"bg-green-100":s.status==="cancelled"?"bg-red-100":"bg-blue-100"}`,children:e.jsx(nt,{className:`w-4 h-4 ${s.status==="completed"?"text-green-600":s.status==="cancelled"?"text-red-600":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[s.date," â€¢ ",s.time]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan flex items-center gap-2",children:[e.jsx(xe,{className:"w-3 h-3"}),s.location,e.jsx(re,{className:"w-3 h-3 mr-1"}),s.duration," ×“×§×•×ª"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.attendanceCount,"/",s.totalMembers]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª"})]})]},s.id))})]})]})]})]}),l&&e.jsx(yt,{orchestra:D,onClose:()=>{g(!1),p(null)},onSubmit:he}),H&&u&&e.jsx(pt,{isOpen:H,onClose:()=>b(!1),orchestraId:u,orchestraName:S.find(s=>s.id===u)?.name||"",onSave:ee})]})}function yt({orchestra:t,onClose:S,onSubmit:T}){const[y,h]=o.useState({name:t?.name||"",description:t?.description||"",type:t?.type||"youth",level:t?.level||"beginner",status:t?.status||"active",rehearsalDay:t?.rehearsalDay||"",rehearsalTime:t?.rehearsalTime||"",venue:t?.venue||""}),c=m=>{m.preventDefault(),T(y)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×ª×–××•×¨×ª":"×”×•×¡×¤×ª ×ª×–××•×¨×ª ×—×“×©×”"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©× ×”×ª×–××•×¨×ª *"}),e.jsx("input",{type:"text",required:!0,value:y.name,onChange:m=>h(l=>({...l,name:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×™××•×¨"}),e.jsx("textarea",{value:y.description,onChange:m=>h(l=>({...l,description:m.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×•×’ ×ª×–××•×¨×ª *"}),e.jsxs("select",{required:!0,value:y.type,onChange:m=>h(l=>({...l,type:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"×ª×–××•×¨×ª × ×•×¢×¨"}),e.jsx("option",{value:"adult",children:"×ª×–××•×¨×ª ××‘×•×’×¨×™×"}),e.jsx("option",{value:"chamber",children:"×ª×–××•×¨×ª ×§×××¨×™×ª"}),e.jsx("option",{value:"symphony",children:"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:y.level,onChange:m=>h(l=>({...l,level:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:y.rehearsalDay,onChange:m=>h(l=>({...l,rehearsalDay:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×›×œ×•××¨: ×™×•× ×¨××©×•×Ÿ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×—×–×¨×•×ª"}),e.jsx("input",{type:"time",value:y.rehearsalTime,onChange:m=>h(l=>({...l,rehearsalTime:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:y.venue,onChange:m=>h(l=>({...l,venue:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:y.status,onChange:m=>h(l=>({...l,status:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function qe(){const{user:t}=je(),[S,T]=o.useState(new Date),[y,h]=o.useState(null),[c,m]=o.useState([]),[l,g]=o.useState([]),[D,p]=o.useState(!0),[u,F]=o.useState(null),[q,i]=o.useState(!1),[v,I]=o.useState(null),[d,C]=o.useState(""),[H,b]=o.useState(!1),[L,E]=o.useState(null),[k,W]=o.useState(!1),[_,K]=o.useState(null);o.useEffect(()=>{f()},[S,t]);const f=async()=>{if(t?._id)try{p(!0);const a=t._id,n=await R.teacherSchedule.getTimeBlocks(a);console.log("Raw API Response:",n);let N=[];try{if(Array.isArray(n))N=n;else if(n?.data&&Array.isArray(n.data))N=n.data;else if(n?.timeBlocks&&Array.isArray(n.timeBlocks))N=n.timeBlocks;else if(n&&typeof n=="object"){const $=Object.values(n).find(Q=>Array.isArray(Q));$?N=$:(console.warn("No array found in response, using empty array"),N=[])}else console.warn("Unexpected timeBlocks format:",n),N=[]}catch($){console.error("Error parsing timeBlocks response:",$),N=[]}console.log("Parsed timeBlocks:",N),console.log("Time block IDs:",N.map($=>({_id:$._id,day:$.day,time:`${$.startTime}-${$.endTime}`,location:$.location})));const G=N.filter($=>$._id&&$._id!=="undefined");console.log("Valid timeBlocks after filtering:",G),g(G);const te=await R.teachers.getTeacher(a);console.log("Teacher profile:",te);let V=[];if(te?.teaching?.studentIds?.length>0)try{V=await R.students.getBatchStudents(te.teaching.studentIds),console.log("Students loaded:",V)}catch($){console.warn("Failed to load students:",$)}else console.log("No student IDs found in teacher profile");console.log("Creating lesson blocks from student assignments...");const z=[];V.forEach($=>{console.log("Processing student:",$.personalInfo?.fullName),console.log("Student assignments:",$.teacherAssignments),$.teacherAssignments&&$.teacherAssignments.forEach(Q=>{if(Q.teacherId===a){console.log("Creating lesson from assignment:",Q);const pe=Q.time||Q.startTime,Le=Q.duration||45,$e=(Ne,Ke)=>{const[Xe,Ze]=Ne.split(":").map(Number),_e=Xe*60+Ze+Ke,Ye=Math.floor(_e/60),et=_e%60;return`${Ye.toString().padStart(2,"0")}:${et.toString().padStart(2,"0")}`},de=Q.endTime||$e(pe,Le),Qe=l.find(Ne=>Ne.day===Q.day)?.location||"",Je={_id:`${$._id}-${Q.day}-${Q.time}`,day:Q.day,startTime:pe,endTime:de,totalDuration:Le,studentId:$._id,studentName:$.personalInfo?.fullName,teacherId:a,instrument:$.academicInfo?.instrumentProgress?.find(Ne=>Ne.isPrimary)?.instrumentName,location:Q.location||Qe,type:"lesson"};console.log(`Creating lesson: Student="${$.personalInfo?.fullName}", Day="${Q.day}", Time="${pe}-${de}"`),z.push(Je)}})}),console.log("Converted lessons from assignments:",z);const Z=z.map($=>{const Q=V.find(de=>de.teacherAssignments?.some(Te=>Te.teacherId===a&&Te.day===$.day&&Te.time===$.startTime)),pe=Q?.academicInfo?.instrumentProgress?.find(de=>de.isPrimary)||Q?.academicInfo?.instrumentProgress?.[0],$e=l.find(de=>de.day===$.day)?.location||"";return{id:$._id||$.id||`${$.day}-${$.startTime}`,day:$.day,startTime:$.startTime,endTime:$.endTime,studentName:Q?Q.personalInfo?.fullName:$.studentName,studentId:Q?._id||$.studentId,instrument:pe?.instrumentName||$.instrument,location:$.location||$e,notes:$.notes,recurring:$.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:$.totalDuration||M($.startTime,$.endTime),studentClass:Q?.personalInfo?.class||Q?.academicInfo?.class,studentPhone:Q?.personalInfo?.phone,studentStage:pe?.currentStage}});m(Z);const Y=A(S),ie=P(S),Se=B(Y,Z);console.log("Generated calendar days:",Se),console.log("Calendar week range:",{weekStart:Y,weekEnd:ie}),console.log("Mapped lesson days for calendar:",Z),h({weekStart:Y,weekEnd:ie,days:Se})}catch(a){console.error("Error loading schedule:",a),F("×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×— ×”×–×× ×™×")}finally{p(!1)}},B=(a,n)=>{const N=[],G=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"],te=new Map;G.forEach((z,X)=>{te.set(z,X)}),console.log("=== GENERATING CALENDAR ==="),console.log("weekStart:",a,"Day:",a.getDay()),console.log("lessons input:",n),console.log("Day name mapping:",Array.from(te.entries()));const V=new Map;n.forEach(z=>{V.has(z.day)||V.set(z.day,[]),V.get(z.day).push(z)}),console.log("Lessons grouped by day:",Array.from(V.keys()));for(let z=0;z<7;z++){const X=new Date(a);X.setDate(a.getDate()+z);const Z=G[z],Y=V.get(Z)||[];console.log(`Day ${z} (${Z}): found ${Y.length} lessons`,Y.map(ie=>({day:ie.day,time:ie.startTime,student:ie.studentName}))),N.push({date:X.toISOString().split("T")[0],dayName:Z,lessons:Y})}return console.log("Generated calendar days with lessons:",N.map(z=>({dayName:z.dayName,lessonCount:z.lessons.length}))),N},M=(a,n)=>{const[N,G]=a.split(":").map(Number),[te,V]=n.split(":").map(Number);return te*60+V-(N*60+G)},A=a=>{const n=new Date(a),N=n.getDay(),G=n.getDate()-N;return n.setDate(G),n.setHours(0,0,0,0),console.log("getWeekStart: input date:",a,"weekStart (Sunday):",n,"day:",n.getDay()),n},P=a=>{const n=A(a);return n.setDate(n.getDate()+6),n},U=a=>{const n=new Date(S);n.setDate(S.getDate()+(a==="next"?7:-7)),T(n)},J=a=>a.slice(0,5),O=a=>new Date(a).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),ee=()=>{I(null),i(!0)},ne=a=>{console.log("handleEditLessonDay called with:",{studentId:a.studentId,studentName:a.studentName,id:a.id,_id:a._id,type:a.type}),a.studentId&&a.studentName?(console.log("Opening EditLessonModal for student lesson"),K(a),W(!0)):(console.log("Opening LessonDayModal for teaching day/availability block"),I(a),i(!0))},me=a=>{console.log("handleEditTeachingDay called with:",{_id:a._id,id:a.id,day:a.day,startTime:a.startTime,hasStudentId:!!a.studentId,fullData:a});const n={id:a._id||a.id,day:a.day,startTime:a.startTime,endTime:a.endTime,location:a.location||"×—×“×¨ ××•×–×™×§×”",notes:a.notes||"",recurring:a.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:M(a.startTime,a.endTime)};console.log("Opening LessonDayModal with lessonDay:",n),I(n),i(!0)},oe=async a=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×™×•× ×œ×™××•×“ ×–×”? ×¤×¢×•×œ×” ×–×• ×ª×‘×˜×œ ××ª ×”×–××™× ×•×ª ×©×œ×š ×‘×–××Ÿ ×–×”."))try{await R.teacherSchedule.deleteTimeBlock(t?._id,a._id||a.id),ce("×™×•× ×”×œ×™××•×“ × ××—×§ ×‘×”×¦×œ×—×”","success"),f()}catch(N){console.error("Error deleting teaching day:",N),ce("×©×’×™××” ×‘××—×™×§×ª ×™×•× ×”×œ×™××•×“","error")}},ce=(a,n)=>{const N=document.createElement("div");N.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${n==="success"?"bg-green-500 text-white":n==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,N.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${n==="success"?"âœ…":n==="error"?"âŒ":"â„¹ï¸"} ${a}
    </div>`,document.body.appendChild(N),setTimeout(()=>N.remove(),3e3)},he=()=>{const a=[];for(let n=7;n<=21;n++)a.push(`${n.toString().padStart(2,"0")}:00`),a.push(`${n.toString().padStart(2,"0")}:30`);return a},fe=(a,n)=>{const N=y?.days.find(V=>V.date===a),G=V=>{const[z,X]=V.split(":").map(Number);return z*60+X};return N?.lessons.find(V=>{const z=G(n),X=z+30,Z=G(V.startTime),Y=G(V.endTime),ie=Z>=z&&Z<X,Se=z>=Z&&z<Y;return ie||Se})},r=a=>{const n=M(a.startTime,a.endTime);return Math.ceil(n/30)*60},s=(a,n)=>{const N=a.startTime,G=n,te=Z=>{const[Y,ie]=Z.split(":").map(Number);return Y*60+ie},V=te(N),z=te(G),X=z+30;return V>=z&&V<X},w=(a,n)=>{const N=X=>{const[Z,Y]=X.split(":").map(Number);return Z*60+Y},G=N(n),te=G+30;return l.some(X=>{if(X.day!==a)return!1;const Z=N(X.startTime),Y=N(X.endTime);return G>=Z&&te<=Y})?!c.some(X=>{if(X.day!==a)return!1;const Z=N(X.startTime),Y=N(X.endTime);return G<Y&&te>Z}):!1},j=(a,n,N)=>{w(N,n)&&(E({date:a,time:n,dayName:N}),b(!0))};if(c.filter(a=>{if(!d)return!0;const n=d.toLowerCase();return a.studentName?.toLowerCase().includes(n)||a.instrument?.toLowerCase().includes(n)||a.location?.toLowerCase().includes(n)||a.day.toLowerCase().includes(n)}),D)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×œ×•×— ×–×× ×™×..."})]})});if(u&&!y)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:u})});const x=he();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™"}),e.jsx("p",{className:"text-gray-600 mt-1",children:y&&`${O(y.weekStart.toISOString().split("T")[0])} - ${O(y.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>U("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-yonatan",children:"×”×©×‘×•×¢"}),e.jsx("button",{onClick:()=>U("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(lt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-yonatan",children:"×©×¢×”"}),y?.days.map(a=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:a.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-yonatan",children:O(a.date)})]},a.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto relative",children:x.map(a=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",style:{height:"60px"},children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-yonatan flex items-center",children:J(a)}),y?.days.map(n=>{const N=fe(n.date,a),G=!N&&w(n.dayName,a);return e.jsxs("div",{className:`border-l border-gray-100 relative transition-all duration-200 cursor-pointer group ${G?"hover:bg-blue-50":""}`,style:{height:"60px"},onClick:()=>!N&&j(n.date,a,n.dayName),title:G?"×œ×—×¥ ×œ×”×•×¡×¤×ª ×©×™×¢×•×¨ ×—×“×©":"",children:[G&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(be,{className:"w-6 h-6 text-blue-500 drop-shadow-lg"})}),N&&s(N,a)&&e.jsx("div",{className:"absolute left-1 right-1 top-1 p-2.5 rounded text-xs font-reisinger-yonatan bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm cursor-pointer transition-all hover:scale-[1.02] z-10 overflow-hidden",style:{height:`${r(N)-2}px`,minHeight:"82px"},onClick:()=>ne(N),title:`${N.studentName||"×ª×œ××™×“"} - ${N.instrument||""}`,children:e.jsx("div",{className:"flex flex-col h-full justify-between",children:e.jsxs("div",{className:"flex-shrink-0 space-y-1",children:[e.jsxs("div",{className:"font-medium truncate flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3 opacity-60"}),N.studentName||"×ª×œ××™×“"]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[J(N.startTime),"-",J(N.endTime)]}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-80 h-4",children:N.instrument?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:N.instrument})]}):e.jsx("span",{className:"invisible",children:"placeholder"})}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-70 h-4",children:N.location?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:N.location})]}):e.jsx("span",{className:"invisible",children:"placeholder"})})]})})})]},`${n.date}-${a}`)})]},a))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×™××™ ×œ×™××•×“ - ×–××™× ×•×ª ×”××•×¨×”"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"×”×’×“×¨ ××ª ×”×™××™× ×•×”×©×¢×•×ª ×©×‘×”× ××ª×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×™×•× ×œ×™××•×“"})]})})]}),l.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan text-lg",children:"××™×Ÿ ×™××™ ×œ×™××•×“ ××•×’×“×¨×™×"}),e.jsx("button",{onClick:ee,className:"mt-4 text-indigo-600 hover:text-indigo-700 font-medium",children:"×”×•×¡×£ ×™×•× ×œ×™××•×“ ×¨××©×•×Ÿ"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(a=>e.jsx(bt,{teachingDay:a,onEdit:()=>me(a),onDelete:()=>oe(a)},a._id||a.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"×™××™ ×œ×™××•×“"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-yonatan",children:l.length}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"×™××™ ×–××™× ×•×ª ×œ×”×•×¨××”"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"×©×¢×•×ª ×–××™× ×•×ª"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-yonatan",children:(l.reduce((a,n)=>{const N=M(n.startTime,n.endTime);return a+N},0)/60).toFixed(1)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"×©×¢×•×ª ×©×‘×•×¢×™×•×ª ×–××™× ×•×ª"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"×ª×œ××™×“×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-yonatan",children:new Set(c.map(a=>a.studentId).filter(Boolean)).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900 font-reisinger-yonatan",children:"×©×™×¢×•×¨×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900 mt-2 font-reisinger-yonatan",children:c.length}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"×©×™×¢×•×¨×™× ×§×‘×•×¢×™×"})]})]}),H&&L&&e.jsx(vt,{timeSlot:L,teacherId:t?._id||"",teachingDays:l,onClose:()=>{b(!1),E(null)},onSave:()=>{b(!1),E(null),f()}}),q&&e.jsx(jt,{lessonDay:v,teacherId:t?._id||"",onClose:()=>{i(!1),I(null)},onSave:()=>{i(!1),I(null),f()}}),k&&_&&e.jsx(Nt,{lesson:_,teacherId:t?._id||"",teachingDays:l,onClose:()=>{W(!1),K(null)},onSave:()=>{W(!1),K(null),f()}})]})}function bt({teachingDay:t,onEdit:S,onDelete:T}){return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ae,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-gray-900 font-reisinger-yonatan",children:["×™×•× ",t.day]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"×–××™× ×•×ª ×œ×”×•×¨××”"})]})]}),t.isRecurring!==!1&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full font-reisinger-yonatan",children:"×©×‘×•×¢×™"})]}),e.jsx("div",{className:"mb-3 pb-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]})}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(xe,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{children:t.location})]}),e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:"×–××™×Ÿ ×œ×§×‘×™×¢×ª ×©×™×¢×•×¨×™× ×‘×–××Ÿ ×–×”"})]})}),t.notes&&e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:t.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:S,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors text-sm",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×¢×¨×•×š"})]}),e.jsx("button",{onClick:T,className:"flex items-center justify-center p-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"××—×§ ×™×•× ×œ×™××•×“",children:e.jsx(Ie,{className:"w-3.5 h-3.5"})})]})]})}function jt({lessonDay:t,teacherId:S,onClose:T,onSave:y}){const[h,c]=o.useState({day:t?.day||"×¨××©×•×Ÿ",startTime:t?.startTime||"14:00",endTime:t?.endTime||"18:00",location:t?.location||"×—×“×¨ ××•×–×™×§×”",notes:t?.notes||"",recurring:t?.recurring||{isRecurring:!0,excludeDates:[]}}),[m,l]=o.useState(!1),g=async p=>{if(p.preventDefault(),t?.studentId){alert("×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×©×™×¢×•×¨ ×ª×œ××™×“ ××›××Ÿ. ×× × ×”×©×ª××© ×‘××¤×©×¨×•×ª ×”×¢×¨×™×›×” ×‘×›×¨×˜×™×¡ ×”×©×™×¢×•×¨.");return}if(!h.day||!h.startTime||!h.endTime){alert("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×");return}try{l(!0);const u={day:h.day,startTime:h.startTime,endTime:h.endTime,location:h.location||null,notes:h.notes||null,recurring:h.recurring||{isRecurring:!0,excludeDates:[]}};t?.id&&/^[0-9a-fA-F]{24}$/.test(t.id)?await R.teacherSchedule.updateTimeBlock(S,t.id,u):await R.teacherSchedule.createTimeBlock(S,u),y()}catch(u){console.error("Error saving lesson day:",u),u?.message?.includes("not found")||u?.message?.includes("Resource not found")?(alert("×™×•× ×”×œ×™××•×“ ×”×–×” ×›×‘×¨ ×œ× ×§×™×™× ×‘××¢×¨×›×ª. ×”×•× ×™×•×¡×¨ ××”×ª×¦×•×’×”."),T(),y()):alert("×©×’×™××” ×‘×©××™×¨×ª ×™×•× ×”×œ×™××•×“")}finally{l(!1)}},D=()=>["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×™×•× ×œ×™××•×“":"×”×•×¡×¤×ª ×™×•× ×œ×™××•×“ ×—×“×©"}),e.jsx("button",{onClick:T,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:h.day,onChange:p=>c(u=>({...u,day:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:D().map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",value:h.startTime,onChange:p=>c(u=>({...u,startTime:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:h.endTime,onChange:p=>c(u=>({...u,endTime:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××™×§×•× / ×—×“×¨"}),e.jsxs("select",{value:h.location||"",onChange:p=>c(u=>({...u,location:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×—×“×¨"}),Ee.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:h.notes||"",onChange:p=>c(u=>({...u,notes:p.target.value})),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×”×©×™×¢×•×¨...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:h.recurring?.isRecurring!==!1,onChange:p=>c(u=>({...u,recurring:{isRecurring:p.target.checked,excludeDates:u.recurring?.excludeDates||[]}})),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×©×™×¢×•×¨ ×§×‘×•×¢ (×—×•×–×¨ ×©×‘×•×¢×™×ª)"})]}),h.recurring?.isRecurring&&e.jsx("p",{className:"text-xs text-gray-500 mr-6 mt-1",children:"×”×©×™×¢×•×¨ ×™×•×¤×™×¢ ×‘××•×¤×Ÿ ×§×‘×•×¢ ×‘×›×œ ×©×‘×•×¢ ×‘×™×•× ×•×‘×©×¢×” ×©×”×•×’×“×¨×•"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:m,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×©×•××¨..."]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×™×•× ×œ×™××•×“"]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"×”×•×¡×£ ×™×•× ×œ×™××•×“"]})})}),e.jsx("button",{type:"button",onClick:T,disabled:m,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function vt({timeSlot:t,teacherId:S,teachingDays:T,onClose:y,onSave:h}){const[c,m]=o.useState(""),[l,g]=o.useState(45),[D,p]=o.useState([]),[u,F]=o.useState(!1),[q,i]=o.useState(!1),[v,I]=o.useState(0);o.useEffect(()=>{d()},[S]);const d=async()=>{try{F(!0);const W=(await R.teachers.getTeacherStudents(S)).map(_=>{const K=_.academicInfo?.instrumentProgress?.find(f=>f.isPrimary)||_.academicInfo?.instrumentProgress?.[0];return{id:_._id,firstName:_.personalInfo?.firstName||"",lastName:_.personalInfo?.lastName||"",instrument:K?.instrumentName||"",class:_.personalInfo?.class||_.academicInfo?.class,stage:K?.currentStage}});p(W)}catch(k){console.error("Error loading students:",k)}finally{F(!1)}},C=(k,W)=>{const[_,K]=k.split(":").map(Number),f=_*60+K+W,B=Math.floor(f/60),M=f%60;return`${B.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`},H=()=>{const[k]=t.time.split(":").map(Number),W=v;return`${k.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`},b=[0,5,10,15,20,25,30,35,40,45,50,55],L=async k=>{if(k.preventDefault(),!c){alert("×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“");return}try{i(!0);const W=D.find(P=>P.id===c),_=H(),K=C(_,l),B=T.find(P=>P.day===t.dayName)?.location||"",M={teacherId:S,day:t.dayName,time:_,endTime:K,duration:l,location:B,isActive:!0};await R.students.addTeacherAssignment(c,M);const A={day:t.dayName,startTime:_,endTime:K,studentId:c,studentName:W?`${W.firstName} ${W.lastName}`:"",instrument:W?.instrument||"",location:B,notes:`×©×™×¢×•×¨ ×§×‘×•×¢ ×©×‘×•×¢×™ - × ×•×¦×¨ ×‘-${new Date().toLocaleDateString("he-IL")}`,recurring:{isRecurring:!0,excludeDates:[]},isRecurring:!0,totalDuration:l};await R.teacherSchedule.createTimeBlock(S,A),h()}catch(W){console.error("Error creating weekly lesson assignment:",W),alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×”×§×¦××ª ×”×©×™×¢×•×¨ ×”×©×‘×•×¢×™")}finally{i(!1)}},E=k=>k.slice(0,5);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×—×“×©"}),e.jsx("button",{onClick:y,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 mb-2",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["×©×™×¢×•×¨ ×§×‘×•×¢ ×©×‘×•×¢×™ - ×™×•× ",t.dayName]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[E(H())," - ",E(C(H(),l))," (",l," ×“×§×•×ª)"]})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["×”×©×™×¢×•×¨ ×™×ª×§×™×™× ×›×œ ×©×‘×•×¢ ×‘×™×•× ",t.dayName," ×‘××•×ª×” ×©×¢×”"]})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×‘×—×¨ ×ª×œ××™×“ *"}),u?e.jsx("div",{className:"text-center py-2 text-gray-500",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}):e.jsxs("select",{value:c,onChange:k=>m(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×œ××™×“"}),D.map(k=>e.jsxs("option",{value:k.id,children:[k.firstName," ",k.lastName,k.instrument&&` - ${k.instrument}`,k.class&&` (×›×™×ª×” ${k.class})`]},k.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:["×–××Ÿ ×”×ª×—×œ×” ××“×•×™×§ (×©×¢×” ",t.time.split(":")[0],":__)"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:b.map(k=>e.jsxs("button",{type:"button",onClick:()=>I(k),className:`px-3 py-2 rounded-lg border-2 transition-all font-medium ${v===k?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[":",k.toString().padStart(2,"0")]},k))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["×©×¢×ª ×”×ª×—×œ×”: ",H()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª)"}),e.jsxs("select",{value:l,onChange:k=>g(Number(k.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:30,children:"30 ×“×§×•×ª"}),e.jsx("option",{value:45,children:"45 ×“×§×•×ª"}),e.jsx("option",{value:60,children:"60 ×“×§×•×ª"}),e.jsx("option",{value:90,children:"90 ×“×§×•×ª"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:q||!c,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×™×•×¦×¨ ×©×™×¢×•×¨ ×©×‘×•×¢×™..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),"×¦×•×¨ ×©×™×¢×•×¨ ×©×‘×•×¢×™"]})}),e.jsx("button",{type:"button",onClick:y,disabled:q,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function Nt({lesson:t,teacherId:S,teachingDays:T,onClose:y,onSave:h}){const c=(b,L)=>{const[E,k]=b.split(":").map(Number),[W,_]=L.split(":").map(Number);return W*60+_-(E*60+k)},l=T.find(b=>b.day===t.day)?.location||"",[g,D]=o.useState({day:t.day,startTime:t.startTime,endTime:t.endTime,location:t.location||l,notes:t.notes||""}),[p,u]=o.useState(!1),[F,q]=o.useState(c(t.startTime,t.endTime)),[i,v]=o.useState([]);o.useState(""),o.useEffect(()=>{if(!g.day||!F)return;const b=T.filter(E=>E.day===g.day),L=[];b.forEach(E=>{const[k,W]=E.startTime.split(":").map(Number),[_,K]=E.endTime.split(":").map(Number),f=k*60+W,M=_*60+K-f,A=Math.floor(M/F);for(let P=0;P<A;P++){const U=f+P*F,J=U+F,O=Math.floor(U/60),ee=U%60,ne=Math.floor(J/60),me=J%60,oe=`${O.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`,ce=`${ne.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`;L.push({id:`${E._id||E.id}-${F}-${P}`,startTime:oe,endTime:ce,duration:F})}}),v(L)},[g.day,F,T]);const I=b=>{D(L=>({...L,startTime:b.startTime,endTime:b.endTime}))},d=async b=>{if(b.preventDefault(),!g.day||!g.startTime||!g.endTime){alert("×™×© ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×");return}const L=c(g.startTime,g.endTime);if(L<=0){alert("×–××Ÿ ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ×œ××—×¨ ×–××Ÿ ×”×”×ª×—×œ×”");return}try{if(u(!0),t.studentId){const E={teacherId:S,day:g.day,time:g.startTime,startTime:g.startTime,endTime:g.endTime,duration:L,location:g.location,isActive:!0};await R.students.updateTeacherAssignment(t.studentId,S,E)}C("×”×©×™×¢×•×¨ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”","success"),h()}catch(E){console.error("Error updating lesson:",E),C("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×©×™×¢×•×¨","error")}finally{u(!1)}},C=(b,L)=>{const E=document.createElement("div");E.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${L==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,E.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${L==="success"?"âœ…":"âŒ"} ${b}
    </div>`,document.body.appendChild(E),setTimeout(()=>E.remove(),3e3)},H=()=>{const b=Array.from(new Set(T.map(L=>L.day)));return b.length===0?["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"]:b};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×¢×¨×™×›×ª ×©×™×¢×•×¨"}),e.jsx("button",{onClick:y,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 font-reisinger-yonatan",children:"×¤×¨×˜×™ ×”×ª×œ××™×“"}),e.jsxs("div",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("strong",{children:"×ª×œ××™×“:"})," ",t.studentName||"×œ× ×¦×•×™×Ÿ"]}),t.instrument&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("strong",{children:"×›×œ×™ × ×’×™× ×”:"})," ",t.instrument]}),t.studentClass&&e.jsxs("div",{children:[e.jsx("strong",{children:"×›×™×ª×”:"})," ",t.studentClass]}),t.studentStage&&e.jsxs("div",{children:[e.jsx("strong",{children:"×©×œ×‘:"})," ",t.studentStage]})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:g.day,onChange:b=>{const L=b.target.value,E=T.find(k=>k.day===L);D(k=>({...k,day:L,location:(!k.location||k.location==="")&&E?.location?E.location:k.location}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:H().map(b=>e.jsx("option",{value:b,children:b},b))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª) *"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[30,45,60].map(b=>e.jsxs("button",{type:"button",onClick:()=>q(b),className:`px-4 py-2 rounded-lg border-2 transition-all ${F===b?"border-indigo-600 bg-indigo-50 text-indigo-700 font-semibold":"border-gray-300 bg-white text-gray-700 hover:border-indigo-300"}`,children:[b," ×“×§×³"]},b))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"×‘×—×¨ ×–××Ÿ ×©×™×¢×•×¨ ×–××™×Ÿ *"}),i.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"××™×Ÿ ×–×× ×™× ×–××™× ×™× ×œ×™×•× ×•××©×š ×©×™×¢×•×¨ ×©× ×‘×—×¨×•"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200",children:i.map(b=>{const L=g.startTime===b.startTime&&g.endTime===b.endTime;return e.jsxs("button",{type:"button",onClick:()=>I(b),className:`p-3 rounded-lg border-2 transition-all text-sm ${L?"border-green-600 bg-green-50 text-green-800 font-semibold shadow-md":b.duration===30?"border-green-300 bg-green-50 text-green-800 hover:border-green-500":b.duration===45?"border-blue-300 bg-blue-50 text-blue-800 hover:border-blue-500":"border-purple-300 bg-purple-50 text-purple-800 hover:border-purple-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[b.startTime,"-",b.endTime]})]}),e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:[b.duration," ×“×§×•×ª"]})]},b.id)})})]}),g.startTime&&g.endTime&&e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-indigo-800",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-reisinger-yonatan font-medium",children:["×–××Ÿ ×©×™×¢×•×¨ × ×‘×—×¨: ",g.startTime," - ",g.endTime," (",c(g.startTime,g.endTime)," ×“×§×•×ª)"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××™×§×•× / ×—×“×¨"}),e.jsxs("select",{value:g.location||"",onChange:b=>D(L=>({...L,location:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×—×“×¨"}),Ee.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:g.notes,onChange:b=>D(L=>({...L,notes:b.target.value})),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×”×©×™×¢×•×¨...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:p||!g.startTime||!g.endTime,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×©×™×¢×•×¨"]})}),e.jsx("button",{type:"button",onClick:y,disabled:p,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function He(){const{user:t}=je(),[S,T]=o.useState([]),[y,h]=o.useState(!0),[c,m]=o.useState(""),[l,g]=o.useState(!1),[D,p]=o.useState(null),[u,F]=o.useState(null),[q,i]=o.useState([]),[v,I]=o.useState(null),[d,C]=o.useState(!1),[H,b]=o.useState(!1),[L,E]=o.useState(!1),[k,W]=o.useState([]),[_,K]=o.useState(null),[f,B]=o.useState("lessons");o.useEffect(()=>{M()},[t]);const M=async()=>{if(t?._id)try{h(!0);const r=t._id,j=(await R.theory.getTheoryLessons()).filter(x=>x.teacherId===r).map(x=>({id:x._id,name:x.name,description:x.description,level:x.level,duration:x.duration,capacity:x.capacity,enrolledCount:x.enrolledStudentIds?.length||0,schedule:{dayOfWeek:x.dayOfWeek,startTime:x.startTime,endTime:x.endTime},status:x.isActive?"active":"inactive",venue:x.location,materials:x.materials||[]}));T(j)}catch(r){console.error("Error loading theory lessons:",r),I("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×”")}finally{h(!1)}},A=async r=>{try{const w=(await R.theory.getTheoryLesson(r)).enrolledStudentIds||[];if(w.length===0){i([]);return}const x=(await R.students.getStudents({ids:w.join(",")})).map(a=>({id:a._id,firstName:a.personalInfo?.firstName||"",lastName:a.personalInfo?.lastName||"",grade:a.academicInfo?.gradeLevel,instrument:a.primaryInstrument,enrollmentDate:a.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));i(x)}catch(s){console.error("Error loading lesson students:",s)}},P=S.filter(r=>c===""||r.name.toLowerCase().includes(c.toLowerCase())||r.level.toLowerCase().includes(c.toLowerCase())||r.description?.toLowerCase().includes(c.toLowerCase())),U=async r=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×©×™×¢×•×¨ ×–×”?"))try{await R.theory.deleteTheoryLesson(r),T(s=>s.filter(w=>w.id!==r)),u===r&&(F(null),i([]))}catch(s){console.error("Error deleting lesson:",s),alert("×©×’×™××” ×‘××—×™×§×ª ×”×©×™×¢×•×¨")}},J=async r=>{try{const s=await O(r);if(s.hasConflict){K(s),E(!0);return}if(D){const w={name:r.name,description:r.description,level:r.level,duration:r.duration,capacity:r.capacity,dayOfWeek:r.schedule?.dayOfWeek,startTime:r.schedule?.startTime,endTime:r.schedule?.endTime,isActive:r.status==="active",location:r.venue},j=await R.theory.updateTheoryLesson(D.id,w),x={id:j._id,name:j.name,description:j.description,level:j.level,duration:j.duration,capacity:j.capacity,enrolledCount:j.enrolledStudentIds?.length||0,schedule:{dayOfWeek:j.dayOfWeek,startTime:j.startTime,endTime:j.endTime},status:j.isActive?"active":"inactive",venue:j.location,materials:j.materials||[]};T(a=>a.map(n=>n.id===D.id?x:n))}else{const w=t?._id,j={name:r.name,description:r.description,level:r.level,duration:r.duration,capacity:r.capacity,dayOfWeek:r.schedule?.dayOfWeek,startTime:r.schedule?.startTime,endTime:r.schedule?.endTime,isActive:r.status==="active",location:r.venue,teacherId:w},x=await R.theory.createTheoryLesson(j),a={id:x._id,name:x.name,description:x.description,level:x.level,duration:x.duration,capacity:x.capacity,enrolledCount:x.enrolledStudentIds?.length||0,schedule:{dayOfWeek:x.dayOfWeek,startTime:x.startTime,endTime:x.endTime},status:x.isActive?"active":"inactive",venue:x.location,materials:x.materials||[]};T(n=>[...n,a])}g(!1),p(null)}catch(s){console.error("Error saving lesson:",s),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×©×™×¢×•×¨")}},O=async r=>{try{const s=S.filter(a=>a.id!==D?.id&&a.schedule.dayOfWeek===r.schedule?.dayOfWeek),w=r.schedule?.startTime,j=r.schedule?.endTime,x=s.filter(a=>{const n=a.schedule.startTime,N=a.schedule.endTime;return w&&j&&n&&N&&(w>=n&&w<N||j>n&&j<=N||w<=n&&j>=N)});return x.length>0?{hasConflict:!0,conflictDetails:`×”×ª× ×’×©×•×ª ×¢× ${x[0].name} ×‘${fe(x[0].schedule.dayOfWeek)} ${x[0].schedule.startTime}-${x[0].schedule.endTime}`,suggestions:["×©× ×” ××ª ×©×¢×ª ×”×©×™×¢×•×¨","×”×¢×‘×¨ ×œ×™×•× ××—×¨","×§×¦×¨ ××ª ××©×š ×”×©×™×¢×•×¨"]}:{hasConflict:!1}}catch(s){return console.error("Error checking conflicts:",s),{hasConflict:!1}}},ee=async()=>{try{const r=await R.students.getStudents(),s=q.map(j=>j.id),w=r.filter(j=>!s.includes(j._id)).map(j=>({id:j._id,firstName:j.personalInfo?.firstName||"",lastName:j.personalInfo?.lastName||"",grade:j.academicInfo?.gradeLevel,instrument:j.primaryInstrument,enrollmentDate:new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));W(w)}catch(r){console.error("Error loading available students:",r)}},ne=async r=>{if(u)try{await Be.enrollStudent(u,r,{method:"manual",performedBy:"teacher",reason:"Teacher enrollment"}),await A(u),await ee()}catch(s){console.error("Error enrolling student:",s),alert("×©×’×™××” ×‘×¨×™×©×•× ×”×ª×œ××™×“")}},me=async r=>{if(u)try{await Be.unenrollStudent(u,r,{reason:"Teacher unenrollment"}),await A(u),await ee()}catch(s){console.error("Error unenrolling student:",s),alert("×©×’×™××” ×‘×‘×™×˜×•×œ ×¨×™×©×•× ×”×ª×œ××™×“")}},oe=async r=>{try{const s={...r,name:`${r.name} - ×¢×•×ª×§`,id:void 0};await J(s)}catch(s){console.error("Error duplicating lesson:",s),alert("×©×’×™××” ×‘×©×›×¤×•×œ ×”×©×™×¢×•×¨")}},ce=r=>{switch(r){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return r}},he=r=>r.substring(0,5),fe=r=>({sunday:"×™×•× ×¨××©×•×Ÿ",monday:"×™×•× ×©× ×™",tuesday:"×™×•× ×©×œ×™×©×™",wednesday:"×™×•× ×¨×‘×™×¢×™",thursday:"×™×•× ×—××™×©×™",friday:"×™×•× ×©×™×©×™",saturday:"×™×•× ×©×‘×ª"})[r.toLowerCase()]||r;return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×©×™×¢×•×¨×™×..."})]})}):v?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:v})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"× ×™×”×•×œ ×ª×™××•×¨×™×” ××ª×§×“×"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×©×™×¢×•×¨×™× ×¤×¢×™×œ×™×"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"× ×”×œ ×§×‘×•×¦×•×ª"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×”×•×¡×£ ×©×™×¢×•×¨"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",dir:"rtl",children:[{id:"lessons",label:"×©×™×¢×•×¨×™×",icon:ye},{id:"groups",label:"×§×‘×•×¦×•×ª",icon:se},{id:"curriculum",label:"×ª×›× ×™×ª ×œ×™××•×“×™×",icon:Pe},{id:"grades",label:"×¦×™×•× ×™×",icon:Re}].map(r=>{const s=r.icon;return e.jsxs("button",{onClick:()=>B(r.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 font-reisinger-yonatan ${f===r.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(s,{className:"w-4 h-4"}),r.label]},r.id)})})}),e.jsxs("div",{className:"p-6",children:[f==="lessons"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×©×™×¢×•×¨×™×...",value:c,onChange:r=>m(r.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:c?"×œ× × ××¦××• ×©×™×¢×•×¨×™×":"××™×Ÿ ×©×™×¢×•×¨×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:c?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×©×™×¢×•×¨ ×”×¨××©×•×Ÿ ×©×œ×š"})]}):P.map(r=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${u===r.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{F(r.id),A(r.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[ce(r.level)," â€¢ ",r.duration," ×“×§×•×ª"]}),r.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:r.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),oe(r)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"×©×›×¤×œ ×©×™×¢×•×¨",children:e.jsx(ct,{className:"w-4 h-4"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),p(r),g(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",title:"×¢×¨×•×š ×©×™×¢×•×¨",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),U(r.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"××—×§ ×©×™×¢×•×¨",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:fe(r.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[he(r.schedule.startTime)," - ",he(r.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.enrolledCount||0,"/",r.capacity]})]}),r.venue&&e.jsx("span",{children:r.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},r.id))}),u&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"×ª×œ××™×“×™ ×”×©×™×¢×•×¨"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{b(!0),ee()},className:"flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-yonatan",children:[e.jsx(le,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“"]})})]}),q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-yonatan",children:"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™× ×œ×©×™×¢×•×¨"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[r.firstName," ",r.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[r.instrument&&`${r.instrument} â€¢ `,r.grade&&`×›×™×ª×” ${r.grade} â€¢ `,"×¨×™×©×•×: ",new Date(r.enrollmentDate).toLocaleDateString("he-IL")]}),r.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-yonatan",children:["× ×•×›×—×•×ª: ",r.attendance.present,"/",r.attendance.total," ×©×™×¢×•×¨×™×",e.jsxs("span",{className:`ml-2 ${r.attendance.present/r.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(r.attendance.present/r.attendance.total*100),"%)"]})]})]}),e.jsx("button",{onClick:()=>me(r.id),className:"text-red-600 hover:text-red-800 p-1",title:"×”×¡×¨ ×ª×œ××™×“",children:e.jsx(Ve,{className:"w-4 h-4"})})]},r.id))})]})]})]}),f==="groups"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"× ×™×”×•×œ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]}),f==="curriculum"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"×ª×›× ×™×ª ×œ×™××•×“×™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]}),f==="grades"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"× ×™×”×•×œ ×¦×™×•× ×™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘"})]})]})]}),l&&e.jsx(wt,{lesson:D,onClose:()=>{g(!1),p(null)},onSubmit:J}),H&&e.jsx(St,{availableStudents:k,onClose:()=>b(!1),onEnroll:ne}),L&&_&&e.jsx(Tt,{conflict:_,onClose:()=>E(!1),onResolve:()=>{E(!1),g(!0)}})]})}function wt({lesson:t,onClose:S,onSubmit:T}){const[y,h]=o.useState({name:t?.name||"",description:t?.description||"",level:t?.level||"beginner",duration:t?.duration||60,capacity:t?.capacity||15,status:t?.status||"active",venue:t?.venue||"",schedule:{dayOfWeek:t?.schedule?.dayOfWeek||"sunday",startTime:t?.schedule?.startTime||"09:00",endTime:t?.schedule?.endTime||"10:00"}}),c=l=>{l.preventDefault(),T(y)},m=(l,g)=>{h(D=>({...D,schedule:{...D.schedule,[l]:g}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©× ×”×©×™×¢×•×¨ *"}),e.jsx("input",{type:"text",required:!0,value:y.name,onChange:l=>h(g=>({...g,name:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×ª×™××•×¨ ×”×©×™×¢×•×¨"}),e.jsx("textarea",{value:y.description,onChange:l=>h(g=>({...g,description:l.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:y.level,onChange:l=>h(g=>({...g,level:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:y.duration,onChange:l=>h(g=>({...g,duration:parseInt(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×§×™×‘×•×œ×ª ×ª×œ××™×“×™× *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:y.capacity,onChange:l=>h(g=>({...g,capacity:parseInt(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:y.status,onChange:l=>h(g=>({...g,status:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×™×•× ×”×©×™×¢×•×¨ *"}),e.jsxs("select",{required:!0,value:y.schedule.dayOfWeek,onChange:l=>m("dayOfWeek",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"×™×•× ×¨××©×•×Ÿ"}),e.jsx("option",{value:"monday",children:"×™×•× ×©× ×™"}),e.jsx("option",{value:"tuesday",children:"×™×•× ×©×œ×™×©×™"}),e.jsx("option",{value:"wednesday",children:"×™×•× ×¨×‘×™×¢×™"}),e.jsx("option",{value:"thursday",children:"×™×•× ×—××™×©×™"}),e.jsx("option",{value:"friday",children:"×™×•× ×©×™×©×™"}),e.jsx("option",{value:"saturday",children:"×™×•× ×©×‘×ª"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",required:!0,value:y.schedule.startTime,onChange:l=>m("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",required:!0,value:y.schedule.endTime,onChange:l=>m("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"××§×•× ×”×©×™×¢×•×¨"}),e.jsx("input",{type:"text",value:y.venue,onChange:l=>h(g=>({...g,venue:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})]})})}function St({availableStudents:t,onClose:S,onEnroll:T}){const[y,h]=o.useState(""),c=t.filter(m=>`${m.firstName} ${m.lastName}`.toLowerCase().includes(y.toLowerCase())||m.instrument?.toLowerCase().includes(y.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×”×•×¡×£ ×ª×œ××™×“ ×œ×©×™×¢×•×¨"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:y,onChange:m=>h(m.target.value),className:"w-full pl-4 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(se,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×ª×œ××™×“×™× ×–××™× ×™×"})]}):c.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:[m.firstName," ",m.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[m.instrument&&`${m.instrument} â€¢ `,m.grade&&`×›×™×ª×” ${m.grade}`]})]}),e.jsxs("button",{onClick:()=>T(m.id),className:"flex items-center gap-1 px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-reisinger-yonatan",children:[e.jsx(le,{className:"w-4 h-4"}),"×”×•×¡×£"]})]},m.id))}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×¡×’×•×¨"})})]})})}function Tt({conflict:t,onClose:S,onResolve:T}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(dt,{className:"w-8 h-8 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª× ×’×©×•×ª ×‘×œ×•×— ×”×–×× ×™×"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-reisinger-yonatan mb-3",children:t.conflictDetails}),t.suggestions&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"×”×¦×¢×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:t.suggestions.map((y,h)=>e.jsx("li",{className:"font-reisinger-yonatan",children:y},h))})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:"×¢×¨×•×š ×©×™×¢×•×¨"}),e.jsx("button",{onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]})})}function Ct(){const{user:t,checkAuthStatus:S}=je(),[T,y]=o.useState(!1),[h,c]=o.useState(!1),[m,l]=o.useState({type:null,message:""}),[g,D]=o.useState(null),[p,u]=o.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});o.useEffect(()=>{F()},[]);const F=async()=>{try{c(!0);const d=await De.getMyProfile();D(d),u({fullName:d?.personalInfo?.fullName||"",email:d?.personalInfo?.email||"",phone:d?.personalInfo?.phone||"",address:d?.personalInfo?.address||"",birthDate:d?.personalInfo?.birthDate||""})}catch(d){console.error("Error fetching profile data:",d),l({type:"error",message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×¤×¨×•×¤×™×œ"}),t&&u({fullName:t?.personalInfo?.fullName||"",email:t?.personalInfo?.email||t?.email||"",phone:t?.personalInfo?.phone||t?.phone||"",address:t?.personalInfo?.address||t?.address||"",birthDate:t?.personalInfo?.birthDate||t?.birthDate||""})}finally{c(!1)}},q=async()=>{try{c(!0),l({type:null,message:""});const d=await De.updateMyProfile(p);D(d),S&&await S(!0),y(!1),l({type:"success",message:"×”×¤×¨×•×¤×™×œ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”"}),setTimeout(()=>{l({type:null,message:""})},3e3)}catch(d){console.error("Error updating profile:",d),l({type:"error",message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¤×¨×•×¤×™×œ. ×× × × ×¡×” ×©×•×‘."})}finally{c(!1)}},i=()=>{const d=g||t;u({fullName:d?.personalInfo?.fullName||"",email:d?.personalInfo?.email||d?.email||"",phone:d?.personalInfo?.phone||d?.phone||"",address:d?.personalInfo?.address||d?.address||"",birthDate:d?.personalInfo?.birthDate||d?.birthDate||""}),y(!1),l({type:null,message:""})},v=d=>d?new Date(d).toLocaleDateString("he-IL"):"",I=g||t;return h&&!I?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×¤×¨×•×¤×™×œ..."})]})}):e.jsxs("div",{className:"space-y-6",children:[m.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${m.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[m.type==="success"?e.jsx(Ge,{className:"w-5 h-5"}):e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:m.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¨×˜×™× ××™×©×™×™×"}),T?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:q,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[h?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×©××™×¨×”"})]}),e.jsxs("button",{onClick:i,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×‘×™×˜×•×œ"})]})]}):e.jsxs("button",{onClick:()=>y(!0),disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(mt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"×¢×¨×™×›×”"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×©× ××œ×"}),T?e.jsx("input",{type:"text",value:p.fullName,onChange:d=>u(C=>({...C,fullName:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×©× ××œ×"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-yonatan",children:p.fullName||"×œ× ×¦×•×™×Ÿ"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:'×“×•×"×œ'}),T?e.jsx("input",{type:"email",value:p.email,onChange:d=>u(C=>({...C,email:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:p.email||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×˜×œ×¤×•×Ÿ"}),T?e.jsx("input",{type:"tel",value:p.phone,onChange:d=>u(C=>({...C,phone:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:p.phone||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×›×ª×•×‘×ª"}),T?e.jsx("input",{type:"text",value:p.address,onChange:d=>u(C=>({...C,address:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×›×ª×•×‘×ª"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:p.address||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×ª××¨×™×š ×œ×™×“×”"}),T?e.jsx("input",{type:"date",value:p.birthDate,onChange:d=>u(C=>({...C,birthDate:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:v(p.birthDate)||"×œ× ×¦×•×™×Ÿ"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-yonatan",children:"××™×“×¢ ×ª×¤×§×™×“"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×ª×¤×§×™×“:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:(()=>{const d=I?.roles||[];if(d.length>0)return d.join(", ");const C=I?.role||"";switch(C){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return C||"×œ× ×¦×•×™×Ÿ"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"××–×”×” ××©×ª××©:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan font-mono text-sm",children:I?.teacherId||I?._id||I?.id||"×œ× ×¦×•×™×Ÿ"})]}),I?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×¡×˜×˜×•×¡:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:I.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]}),I?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"×›×œ×™ × ×’×™× ×”:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:I.professionalInfo.instrument})]})]})]})]})}function At(){const{user:t}=je(),S=st();at();const[T,y]=o.useState("general"),[h,c]=o.useState(null),[m,l]=o.useState(!0);o.useEffect(()=>{const d=S.state;d?.activeTab&&(y(d.activeTab),window.history.replaceState(null,"",window.location.pathname))},[S]),o.useEffect(()=>{t&&g()},[t]);const g=async()=>{try{if(l(!0),!(t?._id||t?.teacherId||t?.id)){console.warn("No user ID available for loading profile statistics");return}const C=await De.getMyProfile();if(!C){console.warn("No teacher profile found"),c({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const H=C?.teaching?.studentIds||[],b=C?.conducting?.orchestraIds||[],L=C?.teaching?.timeBlocks||[],[E,k]=await Promise.allSettled([H.length>0?R.students.getBatchStudents(H):Promise.resolve([]),b.length>0?R.orchestras.getBatchOrchestras(b):Promise.resolve([])]),W=E.status==="fulfilled"?E.value:[];E.status==="rejected"&&console.error("Failed to load student data:",E.reason);const _=k.status==="fulfilled"?k.value:[];k.status==="rejected"&&console.error("Failed to load orchestra data:",k.reason);const K=Array.isArray(W)?W.filter(M=>M.academicInfo?.isActive!==!1):[],f=Array.isArray(L)?L.reduce((M,A)=>M+(parseInt(A.totalDuration)||0),0):0,B=Math.round(f/60*10)/10;c({studentsCount:Array.isArray(W)?W.length:0,activeStudents:K.length,weeklyHours:B,orchestrasCount:Array.isArray(_)?_.length:0,theoryLessonsCount:0})}catch(d){console.error("Error loading profile statistics:",d),c({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{l(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××©×ª××©..."})]})});const p=(()=>{const d=[{id:"general",label:"×¤×¨×˜×™× ×›×œ×œ×™×™×",icon:we,component:Ct}];switch(t?.role||t?.roles?.[0]||""){case"teacher":case"××•×¨×”":return[...d,{id:"students",label:"×”×ª×œ××™×“×™× ×©×œ×™",icon:se,component:Fe},{id:"schedule",label:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™",icon:ae,component:qe}];case"conductor":case"×× ×¦×—":return[...d,{id:"orchestras",label:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—",icon:ue,component:We}];case"theory_teacher":case"××•×¨×” ×ª×™××•×¨×™×”":return[...d,{id:"lessons",label:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™",icon:ye,component:He}];default:const H=[...d];return(t?.roles?.includes("teacher")||t?.roles?.includes("××•×¨×”"))&&(H.push({id:"students",label:"×”×ª×œ××™×“×™× ×©×œ×™",icon:se,component:Fe}),H.push({id:"schedule",label:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™",icon:ae,component:qe})),(t?.roles?.includes("conductor")||t?.roles?.includes("×× ×¦×—"))&&H.push({id:"orchestras",label:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—",icon:ue,component:We}),(t?.roles?.includes("theory_teacher")||t?.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”"))&&H.push({id:"lessons",label:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™",icon:ye,component:He}),H}})(),F=(p.find(d=>d.id===T)||p[0]).component,q=()=>{const d=t?.role||t?.roles?.[0]||"";switch(d){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return d||"××©×ª××©"}},i=()=>t?.personalInfo?.fullName||t?.fullName||t?.name||"××©×ª××©",v=()=>{const d=i();if(!d||d==="××©×ª××©")return"×";const C=d.trim().split(" ");return C.length>=2?C[0][0]+C[1][0]:C[0][0]||"×"},I=()=>t?.personalInfo?.email||t?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-yonatan",children:v()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:i()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[q()," â€¢ ",I()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(Ce,{title:"×¡×”×´×› ×ª×œ××™×“×™×",value:m?"...":h?.studentsCount?.toString()||"0",icon:se,color:"blue",loading:m}),e.jsx(Ce,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:m?"...":h?.activeStudents?.toString()||"0",icon:xt,color:"green",loading:m}),e.jsx(Ce,{title:"×©×¢×•×ª ×©×‘×•×¢×™×•×ª",value:m?"...":h?.weeklyHours?.toString()||"0",icon:re,color:"purple",loading:m}),e.jsx(Ce,{title:t?.roles?.includes("conductor")||t?.roles?.includes("×× ×¦×—")?"×ª×–××•×¨×•×ª":"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",value:m?"...":(h?.orchestrasCount||h?.theoryLessonsCount)?.toString()||"0",icon:t?.roles?.includes("conductor")||t?.roles?.includes("×× ×¦×—")?ue:ye,color:"indigo",loading:m})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:p.map(d=>{const C=d.icon;return e.jsxs("button",{onClick:()=>y(d.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${T===d.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:d.label})]},d.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(F,{})})]})]})}function Ce({title:t,value:S,icon:T,color:y,loading:h}){const m={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[y];return e.jsx("div",{className:`bg-white rounded-lg border ${m.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-yonatan truncate",children:t}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-yonatan",children:h?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):S})]}),e.jsx("div",{className:`${m.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(T,{className:`w-4 h-4 sm:w-6 sm:h-6 ${m.text}`})})]})})}export{At as default};
