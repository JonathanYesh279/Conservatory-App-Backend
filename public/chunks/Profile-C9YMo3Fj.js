import{j as e,u as De,V as Qe}from"../assets/index-lC_h2POl.js";import{R as At,r as i,u as Mt,b as Et}from"./vendor-B2j9q2e_.js";import{a as H,t as st}from"./cascade-deletion-DAN0Gkem.js";import{M as Le,I as at,O as Ve,T as Ye,U as Oe,e as $e,Z as gt,b as pe,d as ye,s as He,r as xt,c as Ze,A as Pe,X as we,an as Ot,D as ht,ac as ft,S as pt,u as Xe,q as je,m as Ie,f as be,P as _e,ab as yt,i as Fe,B as ze,g as _t,G as dt,W as ct,ao as Pt,j as Rt,a6 as tt,aa as Be,Y as Bt,ah as Ft,a3 as Ht,K as zt}from"./ui-ypR0-hKN.js";import{C as Wt}from"./ConfirmationModal-BY4RC4mR.js";import{t as mt}from"./theoryEnrollmentService-Bgf_GhXN.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";function qt({student:t,onEdit:r,onDelete:o,onViewDetails:c,onScheduleLesson:u,onUpdateLesson:l,onMarkAttendance:s,onAddNote:a,className:p=""}){const b=t.academicInfo?.instrumentProgress?.find(w=>w.isPrimary)||t.academicInfo?.instrumentProgress?.[0],L=b?.instrumentName||"לא הוגדר",x=b?.currentStage||0,T=t.scheduleInfo||t.teacherAssignments?.[0],q=T?`${T.day} ${T.startTime||T.time}`:null,d=T?.duration||60,j=!!T,E=t.academicInfo?.isActive!==!1&&t.status!=="inactive",y=E?"text-green-800 bg-green-100":"text-red-800 bg-red-100",g=E?"פעיל":"לא פעיל",S=E?Ze:Pe,_=j?"border-2 border-green-400 shadow-sm shadow-green-200":"border border-gray-200";return e.jsxs("div",{className:`bg-white ${_} rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${p}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan text-lg",children:t.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${y}`,children:[At.createElement(S,{className:"w-3 h-3"}),g]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Le,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-yonatan font-medium",children:L}),x>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-yonatan",children:["שלב ",x]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>c(t.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"צפה בפרטים מלאים",children:e.jsx(at,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(t),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"עריכת תלמיד",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תלמיד",children:e.jsx(Ye,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[t.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Oe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["גיל: ",t.personalInfo.age]})]}),t.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-yonatan",children:["כיתה: ",t.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:t.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:t.personalInfo.phone})]})})]}),q&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-yonatan",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"שיעור קבוע:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-yonatan text-blue-700",children:q}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{children:[d," דק'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>c(t.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(at,{className:"w-4 h-4"}),"פרטים מלאים"]}),j&&l?e.jsxs("button",{onClick:()=>l(t),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),"עדכן שיעור קבוע"]}):u&&!j?e.jsxs("button",{onClick:()=>u(t.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),"תזמן שיעור"]}):null,s&&e.jsxs("button",{onClick:()=>s(t.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(He,{className:"w-4 h-4"}),"נוכחות"]}),a&&e.jsxs("button",{onClick:()=>a(t.id),className:"text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-yonatan transition-all duration-200 flex items-center gap-1",children:[e.jsx(xt,{className:"w-4 h-4"}),"הערה"]})]})})]})}function Ut({student:t,teacherId:r,onClose:o,onSave:c}){const[u,l]=i.useState(new Date().toISOString().split("T")[0]),[s,a]=i.useState(null),[p,b]=i.useState(""),[L,x]=i.useState(!1),[T,q]=i.useState(!1),[d,j]=i.useState(!1),[E,y]=i.useState(null),[g,S]=i.useState([]),[_,w]=i.useState(!1),[M,h]=i.useState(!1),$=t.personalInfo?.fullName||t.fullName||`${t.firstName} ${t.lastName}`.trim(),R=t.academicInfo?.instrumentProgress?.find(k=>k.isPrimary)?.instrumentName||"לא צוין",O=t.scheduleInfo;i.useEffect(()=>{Y(u)},[u]),i.useEffect(()=>{_&&g.length===0&&re()},[_]);const Y=async k=>{x(!0),y(null);try{const J=await H.attendance.getIndividualLessonAttendance({studentId:t.id,teacherId:r,date:k});J?(a(J.status),b(J.notes||"")):(a(null),b(""))}catch(J){console.error("Error loading attendance:",J),a(null),b("")}finally{x(!1)}},re=async()=>{h(!0);try{const k=await H.attendance.getStudentAttendanceHistory({studentId:t.id,teacherId:r,lessonType:"individual",limit:20});S(k)}catch(k){console.error("Error loading attendance history:",k),S([])}finally{h(!1)}},I=async()=>{if(!s){y("יש לבחור סטטוס נוכחות");return}q(!0),y(null);try{const k={studentId:t.id,teacherId:r,date:u,status:s,notes:p.trim(),lessonType:"individual",duration:O?.duration||45};await H.attendance.saveIndividualLessonAttendance(k),S(J=>{const ae=J.filter(ue=>ue.date!==u);return[{...k,_id:Date.now().toString(),createdAt:new Date().toISOString()},...ae]}),j(!0),setTimeout(()=>{j(!1),c&&c(),o()},1500)}catch(k){console.error("Error saving attendance:",k),y(k.message||"שגיאה בשמירת הנוכחות")}finally{q(!1)}},z=k=>{switch(k){case"present":return"bg-green-100 border-green-300 text-green-800 hover:bg-green-200";case"absent":return"bg-red-100 border-red-300 text-red-800 hover:bg-red-200"}},V=k=>{switch(k){case"present":return e.jsx(Xe,{className:"w-5 h-5"});case"absent":return e.jsx(we,{className:"w-5 h-5"})}},F=k=>{switch(k){case"present":return"נוכח";case"absent":return"נעדר"}},X=k=>{const J=new Date(u);J.setDate(J.getDate()+k),l(J.toISOString().split("T")[0])},K=i.useMemo(()=>{const k=g.length,J=g.filter(de=>de.status==="present").length,ae=g.filter(de=>de.status==="absent").length,ue=k>0?Math.round(J/k*100):0;return{total:k,present:J,absent:ae,attendanceRate:ue}},[g]);return d?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes scaleIn {
            0% {
              transform: scale(0.7);
              opacity: 0;
            }
            50% {
              transform: scale(1.05);
            }
            100% {
              transform: scale(1);
              opacity: 1;
            }
          }
          @keyframes checkMark {
            0% {
              transform: scale(0) rotate(-45deg);
            }
            50% {
              transform: scale(1.2) rotate(-45deg);
            }
            100% {
              transform: scale(1) rotate(0deg);
            }
          }
          .animate-scale-in {
            animation: scaleIn 0.4s ease-out forwards;
          }
          .animate-check {
            animation: checkMark 0.6s ease-out 0.2s forwards;
          }
        `}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center animate-scale-in",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4 animate-check",children:e.jsx(Ze,{className:"h-10 w-10 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"הנוכחות נשמרה בהצלחה!"}),e.jsxs("p",{className:"text-gray-600",children:[$," סומן כ",F(s)," ב-",new Date(u).toLocaleDateString("he-IL")]})]})})]}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:o,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"סגור",children:e.jsx(we,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"רישום נוכחות - שיעור אישי"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:$}),O&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[O.day," ",O.startTime]})]})]})]}),e.jsx("button",{onClick:()=>w(!_),className:`p-2 rounded-lg transition-colors ${_?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,"aria-label":"היסטוריה",title:"היסטוריית נוכחות",children:e.jsx(Ot,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:R}),e.jsx("div",{className:"text-sm text-gray-600",children:t.personalInfo?.class&&`כיתה ${t.personalInfo.class}`})]}),g.length>0&&e.jsxs("div",{className:"text-center px-3 py-1 bg-white rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:[K.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"נוכחות"})]})]})})]}),e.jsx("div",{className:"p-6",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"היסטוריית נוכחות"}),e.jsx("button",{onClick:()=>w(!1),className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"חזור לרישום"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:K.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:K.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"נוכח"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:K.absent}),e.jsx("div",{className:"text-xs text-gray-600",children:"נעדר"})]})]}),M?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-3"}),e.jsx("div",{className:"text-gray-600",children:"טוען היסטוריה..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h4",{className:"text-gray-900 font-medium mb-2",children:"אין היסטוריית נוכחות"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"התחל לרשום נוכחות כדי לראות היסטוריה"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:g.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${k.status==="present"?"bg-green-100":k.status==="absent"?"bg-red-100":k.status==="excused"?"bg-yellow-100":"bg-orange-100"}`,children:V(k.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:new Date(k.date).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),k.notes&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:k.notes})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${k.status==="present"?"bg-green-100 text-green-800":k.status==="absent"?"bg-red-100 text-red-800":k.status==="excused"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:F(k.status)})]},k._id))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"תאריך השיעור"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>X(-7),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"שבוע קודם",children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsx("input",{type:"date",value:u,onChange:k=>l(k.target.value),max:new Date().toISOString().split("T")[0],className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-center font-medium"}),e.jsx("button",{onClick:()=>X(7),disabled:u>=new Date().toISOString().split("T")[0],className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"שבוע הבא",children:e.jsx(ft,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"text-center mt-2 text-sm text-gray-600",children:new Date(u).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"סטטוס נוכחות *"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["present","absent"].map(k=>e.jsxs("button",{onClick:()=>a(k),className:`flex items-center justify-center gap-3 p-5 rounded-xl border-2 transition-all transform ${s===k?z(k)+" scale-105 shadow-lg ring-2 ring-offset-2 "+(k==="present"?"ring-green-500":"ring-red-500"):"bg-white border-gray-200 hover:border-gray-300 hover:shadow-md"}`,children:[V(k),e.jsx("span",{className:"font-semibold text-lg",children:F(k)})]},k))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות (אופציונלי)"}),e.jsx("textarea",{value:p,onChange:k=>b(k.target.value),placeholder:"הוסף הערות על השיעור, ההתקדמות או נושאים לתרגול...",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),E&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-900",children:"שגיאה"}),e.jsx("div",{className:"text-red-700 text-sm",children:E})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:I,disabled:!s||T||L,className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold transition-all ${!s||T||L?"opacity-50 cursor-not-allowed":"hover:bg-indigo-700 hover:shadow-lg transform hover:scale-105"}`,children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"שומר..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{children:"שמור נוכחות"})]})}),e.jsx("button",{onClick:o,disabled:T,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"ביטול"})]})]})})]})})}const Gt=[30,45,60];function Qt({action:t}={}){const{user:r}=De(),[o,c]=i.useState([]),[u,l]=i.useState(!0),[s,a]=i.useState("");i.useState(!1),i.useState(null);const[p,b]=i.useState(null),[L,x]=i.useState(0);i.useState(!1);const[T,q]=i.useState({status:"all",instrument:"all",hasSchedule:"all",bagrutStatus:"all"});i.useState("cards"),i.useState(new Set),i.useState(!1);const[d,j]=i.useState(!1),[E,y]=i.useState([]),[g,S]=i.useState(!1),[_,w]=i.useState(!1),[M,h]=i.useState(!1),[$,R]=i.useState(null),[O,Y]=i.useState([]),[re,I]=i.useState(!1),[z,V]=i.useState(null);i.useEffect(()=>{F()},[r]),i.useEffect(()=>{t==="addStudent"&&!u&&(j(!0),X())},[t,u]);const F=async(v=!0)=>{if(r?._id)try{v&&l(!0),b(null);const B=r._id,D=await H.teachers.getTeacher(B);if(!D)throw new Error("לא נמצא פרופיל מורה");const A=D?.teaching?.studentIds||[];try{const N=await H.teacherSchedule.getTimeBlocks(B);let Q=[];Array.isArray(N)?Q=N:N?.data&&Array.isArray(N.data)&&(Q=N.data),Y(Q.filter(W=>W._id&&W._id!=="undefined"))}catch(N){console.warn("Failed to load teaching days:",N),Y([])}if(A.length===0){console.log("No students assigned to teacher"),c([]),x(0);return}const U=await H.students.getBatchStudents(A);if(!Array.isArray(U))throw new Error("תגובה לא תקינה מהשרת");const te=U.filter(N=>A.includes(N._id)||A.includes(N.id));te.length!==U.length&&console.warn(`🔧 Component-level filtering: ${te.length}/${U.length} students match teacher's student IDs`);const n=te.map(N=>{const Q=N.personalInfo?.fullName||"",W=Q.split(" ");return{id:N._id,firstName:N.personalInfo?.firstName||W[0]||"",lastName:N.personalInfo?.lastName||W.slice(1).join(" ")||"",fullName:Q,email:N.personalInfo?.email||N.contactInfo?.email||"",phone:N.personalInfo?.phone||N.contactInfo?.phone||"",instrument:N.academicInfo?.primaryInstrument||N.primaryInstrument||"",grade:N.academicInfo?.gradeLevel||"",status:N.academicInfo?.isActive!==!1?"active":"inactive",joinDate:N.createdAt,personalInfo:{fullName:Q,phone:N.personalInfo?.phone||N.contactInfo?.phone,age:N.personalInfo?.age,class:N.personalInfo?.class||N.academicInfo?.class},academicInfo:{instrumentProgress:N.academicInfo?.instrumentProgress||[],isActive:N.academicInfo?.isActive!==!1},teacherAssignments:N.teacherAssignments||[],scheduleInfo:N.scheduleInfo}});c(n),x(0)}catch(B){console.error("Error loading teacher students:",B),b("שגיאה בטעינת רשימת התלמידים. בדוק את החיבור לאינטרנט ונסה שוב."),x(D=>D+1)}finally{v&&l(!1)}},X=async()=>{try{S(!0);const v=await H.students.getStudents();if(!v||!Array.isArray(v)){console.error("Invalid response from getStudents"),y([]);return}const B=r?._id,A=(await H.teachers.getTeacher(B))?.teaching?.studentIds||[],U=v.filter(te=>!A.includes(te._id)&&!A.includes(te.id));y(U)}catch(v){console.error("Error loading all students:",v),y([])}finally{S(!1)}},K=o.filter(v=>{const B=s===""||`${v.firstName} ${v.lastName}`.toLowerCase().includes(s.toLowerCase())||v.instrument?.toLowerCase().includes(s.toLowerCase())||v.email?.toLowerCase().includes(s.toLowerCase()),D=T.status==="all"||v.status===T.status,A=T.instrument==="all"||v.instrument===T.instrument,U=v.scheduleInfo||v.teacherAssignments?.length>0,te=T.hasSchedule==="all"||T.hasSchedule==="yes"&&U||T.hasSchedule==="no"&&!U,n=v.academicInfo?.isBagrutStudent||v.academicInfo?.instrumentProgress?.some(Q=>Q.currentStage>=4),N=T.bagrutStatus==="all"||T.bagrutStatus==="yes"&&n||T.bagrutStatus==="no"&&!n;return B&&D&&A&&te&&N}),k=async v=>{const B=o.find(A=>A.id===v),D=B?.personalInfo?.fullName||B?.fullName||"התלמיד";if(window.confirm(`האם אתה בטוח שברצונך למחוק את ${D}?

פעולה זו תמחק את כל הנתונים הקשורים לתלמיד ולא ניתנת לביטול.`))try{await H.students.deleteStudent(v),c(U=>U.filter(te=>te.id!==v));const A=document.createElement("div");A.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",A.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${D} נמחק בהצלחה</div>`,document.body.appendChild(A),setTimeout(()=>A.remove(),3e3)}catch(A){console.error("Error deleting student:",A);const U=document.createElement("div");U.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",U.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>שגיאה במחיקת ${D}</div>`,document.body.appendChild(U),setTimeout(()=>U.remove(),5e3)}},J=v=>{window.location.href=`/students/${v}`},ae=v=>{const B=o.find(D=>D.id===v);B&&(R(B),w(!0))},ue=v=>{R(v),h(!0)},de=v=>{const B=o.find(D=>D.id===v);B&&(V(B),I(!0))},xe=v=>{const B=o.find(D=>D.id===v);if(B){const D=prompt(`הוסף הערה עבור ${B.personalInfo?.fullName}:`);D&&D.trim()&&ce(`הערה נוספה עבור ${B.personalInfo?.fullName}`,"success")}},ce=(v,B)=>{const D=document.createElement("div");D.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${B==="success"?"bg-green-500 text-white":B==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,D.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${B==="success"?"✅":B==="error"?"❌":"ℹ️"} ${v}
    </div>`,document.body.appendChild(D),setTimeout(()=>D.remove(),3e3)},m=async(v,B)=>{try{const D=r?._id,A=await H.students.getStudent(v._id),U=(A.teacherAssignments||[]).findIndex(N=>N.teacherId===D),te={teacherId:D,day:B.lessonDay,time:B.lessonTime,duration:B.lessonDuration||45,location:B.lessonLocation||"",isActive:!0};let n;U>=0?(n=[...A.teacherAssignments||[]],n[U]={...n[U],...te}):n=[...A.teacherAssignments||[],te],await H.students.updateStudent(v._id,{teacherAssignments:n}),await F(),ce(`${v.personalInfo?.fullName} הוקצה בהצלחה`,"success"),j(!1)}catch(D){console.error("Error assigning student:",D),ce("שגיאה בהקצאת התלמיד","error")}};return u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תלמידים..."})]})}):p?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-yonatan",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-yonatan mt-1",children:p})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>F(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-yonatan",children:"נסה שוב"}),L>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-yonatan",children:"רענן דף"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"התלמידים שלי"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[o.length," תלמידים רשומים"]})]}),e.jsxs("button",{onClick:()=>{j(!0),X()},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף תלמיד"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:s,onChange:v=>a(v.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:s?"לא נמצאו תלמידים":"אין תלמידים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:s?"נסה מילות חיפוש אחרות":"התחל בהוספת התלמיד הראשון שלך"}),!s&&e.jsxs("button",{onClick:()=>{j(!0),X()},className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:[e.jsx(je,{className:"w-4 h-4"}),"הוסף תלמיד ראשון"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"סה״כ תלמידים"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:o.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"פעילים"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:o.filter(v=>v.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"עם שיעורים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:o.filter(v=>v.scheduleInfo||v.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:K.map(v=>e.jsx(qt,{student:v,onEdit:B=>{alert("עריכת תלמיד זמינה רק למנהלים")},onDelete:k,onViewDetails:J,onScheduleLesson:ae,onUpdateLesson:ue,onMarkAttendance:de,onAddNote:xe},v.id))})]}),d&&e.jsx(Vt,{allStudents:E,loading:g,onClose:()=>{j(!1),y([])},onSubmit:m}),_&&$&&e.jsx(Yt,{student:$,teacherId:r?._id||"",teachingDays:O,onClose:()=>{w(!1),R(null)},onSave:()=>{w(!1),R(null),F(!1)},showNotification:ce}),M&&$&&e.jsx(Zt,{student:$,teacherId:r?._id||"",teachingDays:O,onClose:()=>{h(!1),R(null)},onSave:()=>{h(!1),R(null),F(!1)},showNotification:ce}),re&&z&&e.jsx(Ut,{student:z,teacherId:r?._id||"",onClose:()=>{I(!1),V(null)},onSave:()=>{F(!1)}})]})}function Vt({allStudents:t,loading:r,onClose:o,onSubmit:c}){const{user:u}=De(),[l,s]=i.useState(""),[a,p]=i.useState(null),[b,L]=i.useState({lessonDay:"",lessonTime:"",lessonDuration:45,lessonLocation:"",instrument:""}),[x,T]=i.useState(!1),[q,d]=i.useState([]),[j,E]=i.useState(!1),[y,g]=i.useState(null),S=t.filter(h=>{const $=l.toLowerCase().trim();if(!$)return!0;const R=h.personalInfo?.fullName||`${h.personalInfo?.firstName||""} ${h.personalInfo?.lastName||""}`.trim(),O=h.personalInfo?.class||h.academicInfo?.class||"",Y=[h.academicInfo?.primaryInstrument,...h.academicInfo?.instrumentProgress?.map(z=>z.instrumentName)||[]].filter(Boolean).join(" "),re=`${R} ${O} ${Y}`.toLowerCase();return $.split(/\s+/).filter(z=>z.length>0).every(z=>re.includes(z))});i.useEffect(()=>{a&&u?._id&&_()},[a,u?._id]);const _=async()=>{if(u?._id){E(!0);try{const h=await H.teachers.getTeacher(u._id);console.log("Teacher data for slots:",h);const $=h.teaching?.timeBlocks?.filter(O=>O.isActive!==!1)||[];console.log("Time blocks found:",$);const R=[];$.forEach(O=>{const Y=O.startTime,re=O.endTime,I=O.day,[z,V]=Y.split(":").map(Number),[F,X]=re.split(":").map(Number),K=z*60+V,J=F*60+X-K;Gt.forEach(ae=>{const ue=Math.floor(J/ae);for(let de=0;de<ue;de++){const xe=K+de*ae,ce=xe+ae,m=Math.floor(xe/60),v=xe%60,B=Math.floor(ce/60),D=ce%60,A=`${m.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`,U=`${B.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`;h.teaching?.schedule?.some(n=>n.day===I&&n.time===A&&n.duration===ae)||!1||R.push({_id:`${O._id||O.day}-${ae}-${de}`,day:I,startTime:A,endTime:U,duration:ae,isAvailable:!0,location:O.location,teacherName:h.personalInfo?.fullName,teacherId:h._id,instrument:h.professionalInfo?.instrument||h.teaching?.instrument})}})}),console.log("Generated available slots:",R),d(R)}catch(h){console.error("Error fetching teacher slots:",h),d([])}finally{E(!1)}}},w=h=>{g(h),L({lessonDay:h.day,lessonTime:h.startTime,lessonDuration:h.duration,lessonLocation:h.location||"",instrument:h.instrument||""})},M=async h=>{if(h.preventDefault(),!a){alert("אנא בחר תלמיד");return}if(!y){alert("אנא בחר זמן שיעור");return}T(!0);try{await c(a,b)}catch($){console.error("Error submitting assignment:",$)}finally{T(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto flex flex-col",dir:"rtl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"הוסף תלמיד"}),r?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען רשימת תלמידים..."})]}):e.jsxs("form",{onSubmit:M,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"חפש תלמיד במערכת"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חפש לפי שם, כיתה או כלי נגינה...",value:l,onChange:h=>s(h.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 border border-gray-200 rounded-lg",children:S.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:l?"לא נמצאו תלמידים התואמים את החיפוש":"אין תלמידים זמינים להקצאה"}):e.jsx("div",{className:"divide-y divide-gray-200",children:S.map(h=>{const $=h.personalInfo?.fullName||`${h.personalInfo?.firstName||""} ${h.personalInfo?.lastName||""}`.trim(),R=h.personalInfo?.class||h.academicInfo?.class||"",O=h.academicInfo?.primaryInstrument||"",Y=a?._id===h._id;return e.jsx("div",{onClick:()=>p(h),className:`p-3 cursor-pointer transition-colors ${Y?"bg-indigo-50 border-r-4 border-indigo-600":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:$}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[R&&e.jsxs("span",{children:["כיתה ",R]}),O&&e.jsxs(e.Fragment,{children:[R&&" • ",e.jsx("span",{children:O})]})]})]}),Y&&e.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(He,{className:"w-4 h-4 text-white"})})]})},h._id)})})}),a&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:["בחר זמן שיעור עבור ",a.personalInfo?.fullName]}),y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-50 px-3 py-1 rounded-lg",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:["נבחר: ",y.day," ",y.startTime]})]})]}),j?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען זמנים פנויים..."})]}):q.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"בחר זמן ומשך שיעור מהאפשרויות הזמינות:"}),(()=>{const h=q.reduce(($,R)=>($[R.day]||($[R.day]=[]),$[R.day].push(R),$),{});return Object.entries(h).map(([$,R])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"יום ",$]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pr-1",children:R.sort((O,Y)=>O.startTime.localeCompare(Y.startTime)).map(O=>{const Y=y?._id===O._id;return e.jsx("button",{type:"button",onClick:()=>w(O),className:`p-3 border rounded-lg transition-all text-right ${Y?"border-indigo-600 bg-indigo-50 ring-2 ring-indigo-600":O.duration===30?"border-green-300 bg-green-50 hover:border-green-500 hover:bg-green-100":O.duration===45?"border-blue-300 bg-blue-50 hover:border-blue-500 hover:bg-blue-100":"border-purple-300 bg-purple-50 hover:border-purple-500 hover:bg-purple-100"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[O.startTime,"-",O.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${O.duration===30?"bg-green-100 text-green-800":O.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[O.duration," דק׳"]})]}),O.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx($e,{className:"w-3 h-3"}),O.location]}),O.instrument&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Le,{className:"w-3 h-3"}),O.instrument]}),Y&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(He,{className:"w-5 h-5 text-indigo-600"})})]})},O._id)})})]},$))})()]}):e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"אין זמנים פנויים"}),e.jsx("p",{className:"text-xs text-gray-400",children:"ייתכן שכל הזמנים הפנויים כבר תפוסים או שלא הוגדרו זמני הוראה"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{type:"submit",disabled:!a||!y||x,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"מקצה..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4"}),"הוסף תלמיד"]})}),e.jsxs("button",{type:"button",onClick:o,disabled:x,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"ביטול"]})]})]})]})})}function Yt({student:t,teacherId:r,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const[s,a]=i.useState({day:"",startTime:"",endTime:"",duration:45,location:"",notes:""}),[p,b]=i.useState(!1),L=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],x=[30,45,60],T=d=>{if(!s.startTime)return;const[j,E]=s.startTime.split(":").map(Number),y=j*60+E+d,g=Math.floor(y/60),S=y%60;a(_=>({..._,duration:d,endTime:`${String(g).padStart(2,"0")}:${String(S).padStart(2,"0")}`}))},q=async d=>{if(d.preventDefault(),!s.day||!s.startTime||!s.endTime){l("יש למלא את כל השדות הנדרשים","error");return}try{b(!0);const j={day:s.day,startTime:s.startTime,endTime:s.endTime,location:s.location||"חדר מוזיקה",duration:s.duration,notes:s.notes,studentId:t.id,studentName:t.personalInfo?.fullName||t.fullName,teacherId:r,recurring:{isRecurring:!0,excludeDates:[]}};await H.teacherSchedule.createTimeBlock(r,j),l("השיעור הקבוע נוצר בהצלחה","success"),u()}catch(j){console.error("Error creating lesson:",j),l(j.message||"שגיאה ביצירת השיעור","error")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["תזמן שיעור קבוע - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"יום"}),e.jsxs("select",{value:s.day,onChange:d=>a(j=>({...j,day:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),L.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:s.startTime,onChange:d=>{a(j=>({...j,startTime:d.target.value})),s.duration&&T(s.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"משך (דקות)"}),e.jsx("select",{value:s.duration,onChange:d=>T(Number(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:x.map(d=>e.jsxs("option",{value:d,children:[d," דק'"]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"מיקום"}),e.jsxs("select",{value:s.location,onChange:d=>a(j=>({...j,location:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),Qe.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:s.notes,onChange:d=>a(j=>({...j,notes:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"הערות נוספות..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:p,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:p?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:c,disabled:p,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"ביטול"})]})]})]})})}function Zt({student:t,teacherId:r,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const s=t.scheduleInfo||t.teacherAssignments?.[0],[a,p]=i.useState({day:s?.day||"",startTime:s?.startTime||s?.time||"",duration:s?.duration||45,endTime:s?.endTime||"",location:"",notes:""}),[b,L]=i.useState(!1),[x,T]=i.useState(null),q=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],d=[30,45,60];i.useEffect(()=>{j()},[]);const j=async()=>{try{const g=await H.teacherSchedule.getTimeBlocks(r);let S=[];Array.isArray(g)?S=g:g?.data&&Array.isArray(g.data)&&(S=g.data);const _=S.find(w=>w.studentId===t.id);_&&(T(_._id),p({day:_.day,startTime:_.startTime,endTime:_.endTime,duration:_.duration||45,location:_.location||"",notes:_.notes||""}))}catch(g){console.error("Error loading time block:",g)}},E=g=>{if(!a.startTime)return;const[S,_]=a.startTime.split(":").map(Number),w=S*60+_+g,M=Math.floor(w/60),h=w%60;p($=>({...$,duration:g,endTime:`${String(M).padStart(2,"0")}:${String(h).padStart(2,"0")}`}))},y=async g=>{if(g.preventDefault(),!x){l("לא נמצא שיעור קבוע לעדכון","error");return}if(!a.day||!a.startTime||!a.endTime){l("יש למלא את כל השדות הנדרשים","error");return}try{L(!0);const S={day:a.day,startTime:a.startTime,endTime:a.endTime,location:a.location||"חדר מוזיקה",duration:a.duration,notes:a.notes};await H.teacherSchedule.updateTimeBlock(r,x,S),l("השיעור הקבוע עודכן בהצלחה","success"),u()}catch(S){console.error("Error updating lesson:",S),l(S.message||"שגיאה בעדכון השיעור","error")}finally{L(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:["עדכן שיעור קבוע - ",t.personalInfo?.fullName||t.fullName]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"יום"}),e.jsxs("select",{value:a.day,onChange:g=>p(S=>({...S,day:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",required:!0,children:[e.jsx("option",{value:"",children:"בחר יום"}),q.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:a.startTime,onChange:g=>{p(S=>({...S,startTime:g.target.value})),a.duration&&E(a.duration)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"משך (דקות)"}),e.jsx("select",{value:a.duration,onChange:g=>E(Number(g.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:d.map(g=>e.jsxs("option",{value:g,children:[g," דק'"]},g))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"מיקום"}),e.jsxs("select",{value:a.location,onChange:g=>p(S=>({...S,location:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),Qe.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:a.notes,onChange:g=>p(S=>({...S,notes:g.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-reisinger-yonatan",rows:3,placeholder:"הערות נוספות..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:b,className:"flex-1 bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:b?"מעדכן...":"עדכן"}),e.jsx("button",{type:"button",onClick:c,disabled:b,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-yonatan font-medium",children:"ביטול"})]})]})]})})}function Xt({isOpen:t,onClose:r,orchestraId:o,orchestraName:c,onSave:u}){const[l,s]=i.useState({date:"",startTime:"19:00",endTime:"21:00",location:"אולם מוזיקה",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""}),[a,p]=i.useState({}),[b,L]=i.useState(!1);i.useEffect(()=>{if(t){const d=new Date;d.setDate(d.getDate()+1),s(j=>({...j,date:d.toISOString().split("T")[0]}))}},[t]);const x=()=>{const d={};if(!l.date)d.date="יש לבחור תאריך";else{const j=new Date(l.date),E=new Date;E.setHours(0,0,0,0),j<E&&(d.date="לא ניתן לקבוע חזרה בעבר")}if(l.startTime||(d.startTime="יש לבחור שעת התחלה"),l.endTime||(d.endTime="יש לבחור שעת סיום"),l.startTime&&l.endTime){const j=new Date(`2000-01-01T${l.startTime}`);new Date(`2000-01-01T${l.endTime}`)<=j&&(d.endTime="שעת הסיום חייבת להיות אחרי שעת ההתחלה")}return l.location.trim()||(d.location="יש לציין מקום"),l.recurring&&!l.endRecurrence&&(d.endRecurrence="יש לציין תאריך סיום לחזרות קבועות"),p(d),Object.keys(d).length===0},T=async d=>{if(d.preventDefault(),!!x()){L(!0);try{await u(l),r(),s({date:"",startTime:"19:00",endTime:"21:00",location:"אולם מוזיקה",notes:"",recurring:!1,recurrencePattern:"weekly",endRecurrence:""})}catch(j){console.error("Error saving rehearsal:",j)}finally{L(!1)}}},q=()=>{if(!l.startTime||!l.endTime)return"";const d=new Date(`2000-01-01T${l.startTime}`),E=(new Date(`2000-01-01T${l.endTime}`).getTime()-d.getTime())/(1e3*60);if(E<=0)return"";const y=Math.floor(E/60),g=E%60;return y===0?`${g} דקות`:g===0?`${y} שעות`:`${y} שעות ו-${g} דקות`};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"קביעת חזרה חדשה"}),e.jsx("button",{onClick:r,className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(we,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium font-reisinger-yonatan",children:["תזמורת: ",c]})]})}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תאריך החזרה *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"date",required:!0,value:l.date,onChange:d=>s(j=>({...j,date:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.date?"border-red-300":"border-gray-300"}`})]}),a.date&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.startTime,onChange:d=>s(j=>({...j,startTime:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.startTime?"border-red-300":"border-gray-300"}`})]}),a.startTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"time",required:!0,value:l.endTime,onChange:d=>s(j=>({...j,endTime:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.endTime?"border-red-300":"border-gray-300"}`})]}),a.endTime&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.endTime})]})]}),q()&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded font-reisinger-yonatan",children:["משך החזרה: ",q()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום החזרה *"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",required:!0,value:l.location,onChange:d=>s(j=>({...j,location:d.target.value})),className:`w-full pl-3 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.location?"border-red-300":"border-gray-300"}`,placeholder:"למשל: אולם מוזיקה, חדר 101"})]}),a.location&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:l.notes,onChange:d=>s(j=>({...j,notes:d.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"הערות נוספות על החזרה (אופציונלי)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"recurring",type:"checkbox",checked:l.recurring,onChange:d=>s(j=>({...j,recurring:d.target.checked})),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring",className:"mr-2 text-sm text-gray-700 font-reisinger-yonatan",children:"חזרה קבועה (חוזרת)"})]}),l.recurring&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תדירות"}),e.jsxs("select",{value:l.recurrencePattern,onChange:d=>s(j=>({...j,recurrencePattern:d.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"weekly",children:"שבועי"}),e.jsx("option",{value:"biweekly",children:"דו-שבועי"}),e.jsx("option",{value:"monthly",children:"חודשי"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תאריך סיום החזרות הקבועות *"}),e.jsx("input",{type:"date",required:l.recurring,value:l.endRecurrence,onChange:d=>s(j=>({...j,endRecurrence:d.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 ${a.endRecurrence?"border-red-300":"border-gray-300"}`}),a.endRecurrence&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-reisinger-yonatan",children:a.endRecurrence})]}),e.jsxs("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded flex items-start gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"חזרות קבועות ייווצרו אוטומטית עד התאריך שצוין"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:b,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors font-reisinger-yonatan",children:b?"קובע חזרה...":"קבע חזרה"}),e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})}):null}function Kt(){const{user:t}=De(),[r,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(""),[a,p]=i.useState(!1),[b,L]=i.useState(null),[x,T]=i.useState(null),[q,d]=i.useState([]),[j,E]=i.useState(null),[y,g]=i.useState("members");i.useState(!1);const[S,_]=i.useState(!1),[w,M]=i.useState([]),[h,$]=i.useState([]),[R,O]=i.useState(""),[Y,re]=i.useState(""),[I,z]=i.useState(!1),[V,F]=i.useState(null),[X,K]=i.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});i.useEffect(()=>{k()},[t]),i.useEffect(()=>{x&&y==="enrollment"&&ae()},[x,y]);const k=async()=>{if(t?._id)try{u(!0);const n=t._id,N=await H.teachers.getTeacher(n);if(!N)throw new Error("לא נמצא פרופיל מנצח");const Q=N?.conducting?.orchestraIds||[];if(Q.length===0){console.log("No orchestras assigned to conductor"),o([]);return}const W=await H.orchestras.getBatchOrchestras(Q);if(!Array.isArray(W))throw new Error("תגובה לא תקינה מהשרת");const se=W.map(Z=>({id:Z._id,name:Z.name,description:Z.description,type:Z.type,level:Z.level,memberCount:Z.memberCount||0,status:Z.status||"active",rehearsalDay:Z.rehearsalSchedule?.day,rehearsalTime:Z.rehearsalSchedule?.time,venue:Z.venue}));o(se)}catch(n){console.error("Error loading conductor orchestras:",n),E("שגיאה בטעינת רשימת התזמורות")}finally{u(!1)}},J=async n=>{try{const W=((await H.orchestras.getOrchestra(n)).memberDetails||[]).map(se=>{const Z=se.personalInfo?.fullName||"",Te=Z.trim().split(/\s+/),f=Te[0]||"",C=Te.slice(1).join(" ")||"",P=se.academicInfo?.instrumentProgress?.find(ie=>ie.isPrimary),ne=P?.instrumentName||se.primaryInstrument||"לא צוין",he=P?.currentStage||0;return{id:se._id,fullName:Z,firstName:f,lastName:C,instrument:ne,currentStage:he,section:se.section||"כללי",status:se.status||"active",enrollmentDate:se.enrollmentDate||new Date().toISOString(),performanceLevel:se.performanceLevel||"intermediate",attendanceRate:se.attendanceRate||null}});d(W)}catch(N){console.error("Error loading orchestra members:",N)}},ae=async()=>{if(x)try{z(!0),console.log("🔍 Loading available students for orchestra:",x);const n=await H.students.getStudents({status:"active",limit:500});console.log("📋 Raw API response:",n);let N=[];Array.isArray(n)?N=n:n&&Array.isArray(n.data)?N=n.data:n&&n.students&&Array.isArray(n.students)?N=n.students:(console.error("❌ Unexpected response structure:",n),N=[]),console.log("📋 Total active students fetched:",N.length);const W=(await H.orchestras.getOrchestra(x)).memberIds||[];console.log("👥 Current orchestra members:",W.length);const se=N.filter(Z=>!W.includes(Z._id)&&Z.isActive!==!1);console.log("✅ Available students for enrollment:",se.length),M(se)}catch(n){console.error("❌ Error loading available students:",n),M([])}finally{z(!1)}},ue=async n=>{try{const Q=(await H.rehearsals.getRehearsals({groupId:n,limit:20})).map(W=>{const se=W.scheduledDate||W.date||W.rehearsalDate;let Z="תאריך לא זמין";if(se)try{const Te=new Date(se);isNaN(Te.getTime())||(Z=Te.toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"}))}catch{console.warn("Failed to parse rehearsal date:",se)}return{id:W._id,date:Z,time:W.startTime||"19:00",location:W.location||"אולם מוזיקה",duration:W.duration||120,status:W.status||"scheduled",attendanceCount:W.attendanceList?.length||0,totalMembers:q.length}});$(Q)}catch(N){console.error("Error loading orchestra rehearsals:",N),$([])}},de=async n=>{if(x)try{await H.orchestras.addMember(x,n),await J(x),await ae(),F({type:"success",message:"התלמיד נוסף בהצלחה לתזמורת"}),setTimeout(()=>F(null),3e3)}catch(N){console.error("Error adding member:",N),F({type:"error",message:"שגיאה בהוספת התלמיד לתזמורת"}),setTimeout(()=>F(null),3e3)}},xe=async n=>{x&&K({isOpen:!0,title:"הסרת תלמיד מהתזמורת",message:"האם אתה בטוח שברצונך להסיר את התלמיד מהתזמורת?",onConfirm:async()=>{K({...X,isOpen:!1});try{await H.orchestras.removeMember(x,n),await J(x),await ae(),F({type:"success",message:"התלמיד הוסר בהצלחה מהתזמורת"}),setTimeout(()=>F(null),3e3)}catch(N){console.error("Error removing member:",N),F({type:"error",message:"שגיאה בהסרת התלמיד מהתזמורת"}),setTimeout(()=>F(null),3e3)}}})},ce=async n=>{if(x)try{const N={groupId:x,groupType:"orchestra",scheduledDate:new Date(n.date).toISOString(),startTime:n.startTime,endTime:n.endTime,duration:m(n.startTime,n.endTime),location:n.location,notes:n.notes,status:"scheduled"};if(n.recurring){const Q=v(N,n);await Promise.all(Q.map(W=>H.rehearsals.createRehearsal(W))),F({type:"success",message:`${Q.length} חזרות נוצרו בהצלחה`})}else await H.rehearsals.createRehearsal(N),F({type:"success",message:"חזרה נוצרה בהצלחה"});await ue(x),_(!1),setTimeout(()=>F(null),3e3)}catch(N){console.error("Error scheduling rehearsal:",N),F({type:"error",message:"שגיאה ביצירת החזרה"}),setTimeout(()=>F(null),3e3)}},m=(n,N)=>{const Q=new Date(`2000-01-01T${n}`),W=new Date(`2000-01-01T${N}`);return Math.round((W.getTime()-Q.getTime())/(1e3*60))},v=(n,N)=>{const Q=[],W=new Date(N.date),se=new Date(N.endRecurrence);let Z=new Date(W);for(;Z<=se;)switch(Q.push({...n,scheduledDate:new Date(Z).toISOString()}),N.recurrencePattern){case"weekly":Z.setDate(Z.getDate()+7);break;case"biweekly":Z.setDate(Z.getDate()+14);break;case"monthly":Z.setMonth(Z.getMonth()+1);break}return Q},B=r.filter(n=>l===""||n.name.toLowerCase().includes(l.toLowerCase())||n.type.toLowerCase().includes(l.toLowerCase())||n.description?.toLowerCase().includes(l.toLowerCase())),D=async n=>{K({isOpen:!0,title:"מחיקת תזמורת",message:"האם אתה בטוח שברצונך למחוק תזמורת זו? פעולה זו אינה ניתנת לביטול.",onConfirm:async()=>{K({...X,isOpen:!1});try{await H.orchestras.deleteOrchestra(n),o(N=>N.filter(Q=>Q.id!==n)),x===n&&(T(null),d([])),F({type:"success",message:"התזמורת נמחקה בהצלחה"}),setTimeout(()=>F(null),3e3)}catch(N){console.error("Error deleting orchestra:",N),F({type:"error",message:"שגיאה במחיקת התזמורת"}),setTimeout(()=>F(null),3e3)}}})},A=async n=>{try{if(b){const N={name:n.name,description:n.description,type:n.type,level:n.level,status:n.status,rehearsalSchedule:{day:n.rehearsalDay,time:n.rehearsalTime},venue:n.venue},Q=await H.orchestras.updateOrchestra(b.id,N),W={id:Q._id,name:Q.name,description:Q.description,type:Q.type,level:Q.level,memberCount:Q.memberCount||0,status:Q.status||"active",rehearsalDay:Q.rehearsalSchedule?.day,rehearsalTime:Q.rehearsalSchedule?.time,venue:Q.venue};o(se=>se.map(Z=>Z.id===b.id?W:Z))}else{const N=t?._id,Q={name:n.name,description:n.description,type:n.type,level:n.level,status:n.status,rehearsalSchedule:{day:n.rehearsalDay,time:n.rehearsalTime},venue:n.venue,conductorId:N},W=await H.orchestras.createOrchestra(Q),se={id:W._id,name:W.name,description:W.description,type:W.type,level:W.level,memberCount:W.memberCount||0,status:W.status||"active",rehearsalDay:W.rehearsalSchedule?.day,rehearsalTime:W.rehearsalSchedule?.time,venue:W.venue};o(Z=>[...Z,se])}p(!1),L(null),F({type:"success",message:b?"התזמורת עודכנה בהצלחה":"התזמורת נוצרה בהצלחה"}),setTimeout(()=>F(null),3e3)}catch(N){console.error("Error saving orchestra:",N),F({type:"error",message:"שגיאה בשמירת פרטי התזמורת"}),setTimeout(()=>F(null),3e3)}},U=n=>{switch(n){case"youth":return"תזמורת נוער";case"adult":return"תזמורת מבוגרים";case"chamber":return"תזמורת קאמרית";case"symphony":return"תזמורת סימפונית";default:return n}},te=n=>{switch(n){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return n}};return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תזמורות..."})]})}):j?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:j})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"תזמורות שאני מנצח"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[r.length," תזמורות"]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף תזמורת"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תזמורות...",value:l,onChange:n=>s(n.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"לא נמצאו תזמורות":"אין תזמורות רשומות"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת התזמורת הראשונה שלך"})]}):B.map(n=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${x===n.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{T(n.id),J(n.id),ue(n.id),g("members")},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[U(n.type)," • ",te(n.level)]}),n.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:n.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:N=>{N.stopPropagation(),L(n),p(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"עריכת תזמורת",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:N=>{N.stopPropagation(),D(n.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תזמורת",children:e.jsx(Ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:[n.memberCount||0," חברים"]})]}),n.rehearsalDay&&e.jsxs("span",{children:["חזרות: ",n.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:n.status==="active"?"פעיל":"לא פעיל"})]})]},n.id))}),x&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-1 p-1",children:[e.jsxs("button",{onClick:()=>g("members"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="members"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(be,{className:"w-4 h-4 inline mr-2"}),"חברי התזמורת"]}),e.jsxs("button",{onClick:()=>{g("enrollment"),ae()},className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="enrollment"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(je,{className:"w-4 h-4 inline mr-2"}),"רישום חברים"]}),e.jsxs("button",{onClick:()=>g("rehearsals"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="rehearsals"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(pe,{className:"w-4 h-4 inline mr-2"}),"חזרות"]})]})}),e.jsxs("div",{className:"p-4",children:[y==="members"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["חברי התזמורת (",q.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש חברים...",value:Y,onChange:n=>re(n.target.value),className:"pl-4 pr-10 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500",dir:"rtl"})]})})]}),q.filter(n=>Y===""||`${n.firstName} ${n.lastName}`.toLowerCase().includes(Y.toLowerCase())||n.instrument.toLowerCase().includes(Y.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:Y?"לא נמצאו חברים":"אין חברים רשומים בתזמורת"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.filter(n=>Y===""||`${n.firstName} ${n.lastName}`.toLowerCase().includes(Y.toLowerCase())||n.instrument.toLowerCase().includes(Y.toLowerCase())).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n.status==="active"?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:n.fullName||`${n.firstName} ${n.lastName}`.trim()}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[n.instrument,n.currentStage?` - שלב ${n.currentStage}`:""]}),n.attendanceRate!==null&&n.attendanceRate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["נוכחות: ",n.attendanceRate,"%"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>xe(n.id),className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"הסר מהתזמורת",children:e.jsx(yt,{className:"w-4 h-4"})})})]},n.id))})]}),y==="enrollment"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:["רישום חברים ",!I&&`(${w.length} זמינים)`]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:R,onChange:n=>O(n.target.value),className:"pl-4 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500",dir:"rtl",disabled:I})]})]}),I?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"טוען רשימת תלמידים..."})]}):w.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"כל התלמידים כבר רשומים לתזמורת"})]}):e.jsx("div",{children:w.filter(n=>R===""||n.personalInfo?.fullName?.toLowerCase().includes(R.toLowerCase())||n.academicInfo?.primaryInstrument?.toLowerCase().includes(R.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"לא נמצאו תלמידים תואמים"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:w.filter(n=>R===""||n.personalInfo?.fullName?.toLowerCase().includes(R.toLowerCase())||n.academicInfo?.primaryInstrument?.toLowerCase().includes(R.toLowerCase())).map(n=>{const N=n.academicInfo?.instrumentProgress?.find(se=>se.isPrimary),Q=N?.instrumentName||n.academicInfo?.primaryInstrument||"לא צוין כלי",W=N?.currentStage;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm font-reisinger-yonatan",children:n.personalInfo?.fullName}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[Q,W?` - שלב ${W}`:""]})]}),e.jsxs("button",{onClick:()=>de(n._id),className:"flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),"הוסף"]})]},n._id)})})})]}),y==="rehearsals"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"חזרות התזמורת"}),e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),"קבע חזרה"]})]}),h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan",children:"אין חזרות מתוכננות"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[n.date," • ",n.time]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan flex items-center gap-2 mt-1",children:[e.jsx($e,{className:"w-3 h-3"}),n.location,e.jsx(ye,{className:"w-3 h-3 mr-1"}),n.duration," דקות"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.attendanceCount,"/",n.totalMembers]}),e.jsx("div",{className:"text-xs text-gray-500",children:"נוכחות"})]})]},n.id))})]})]})]})]}),a&&e.jsx(Jt,{orchestra:b,onClose:()=>{p(!1),L(null)},onSubmit:A}),S&&x&&e.jsx(Xt,{isOpen:S,onClose:()=>_(!1),orchestraId:x,orchestraName:r.find(n=>n.id===x)?.name||"",onSave:ce}),e.jsx(Wt,{isOpen:X.isOpen,title:X.title,message:X.message,onConfirm:X.onConfirm,onCancel:()=>K({...X,isOpen:!1}),variant:"danger",confirmText:"אישור",cancelText:"ביטול"}),V&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in",dir:"rtl",children:e.jsxs("div",{className:`flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg ${V.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[V.type==="success"?e.jsx(Ze,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(Fe,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("span",{className:`font-medium font-reisinger-yonatan ${V.type==="success"?"text-green-800":"text-red-800"}`,children:V.message})]})})]})}function Jt({orchestra:t,onClose:r,onSubmit:o}){const[c,u]=i.useState({name:t?.name||"",description:t?.description||"",type:t?.type||"youth",level:t?.level||"beginner",status:t?.status||"active",rehearsalDay:t?.rehearsalDay||"",rehearsalTime:t?.rehearsalTime||"",venue:t?.venue||""}),l=s=>{s.preventDefault(),o(c)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"עריכת תזמורת":"הוספת תזמורת חדשה"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שם התזמורת *"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:s=>u(a=>({...a,name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תיאור"}),e.jsx("textarea",{value:c.description,onChange:s=>u(a=>({...a,description:s.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סוג תזמורת *"}),e.jsxs("select",{required:!0,value:c.type,onChange:s=>u(a=>({...a,type:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"תזמורת נוער"}),e.jsx("option",{value:"adult",children:"תזמורת מבוגרים"}),e.jsx("option",{value:"chamber",children:"תזמורת קאמרית"}),e.jsx("option",{value:"symphony",children:"תזמורת סימפונית"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"רמה *"}),e.jsxs("select",{required:!0,value:c.level,onChange:s=>u(a=>({...a,level:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום חזרות"}),e.jsx("input",{type:"text",value:c.rehearsalDay,onChange:s=>u(a=>({...a,rehearsalDay:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"כלומר: יום ראשון"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת חזרות"}),e.jsx("input",{type:"time",value:c.rehearsalTime,onChange:s=>u(a=>({...a,rehearsalTime:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום חזרות"}),e.jsx("input",{type:"text",value:c.venue,onChange:s=>u(a=>({...a,venue:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סטטוס"}),e.jsxs("select",{value:c.status,onChange:s=>u(a=>({...a,status:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function es(){const{user:t}=De(),[r,o]=i.useState(new Date),[c,u]=i.useState(null),[l,s]=i.useState([]),[a,p]=i.useState([]),[b,L]=i.useState(!0),[x,T]=i.useState(null),[q,d]=i.useState(!1),[j,E]=i.useState(null),[y,g]=i.useState(""),[S,_]=i.useState(!1),[w,M]=i.useState(null),[h,$]=i.useState(!1),[R,O]=i.useState(null),[Y,re]=i.useState(!1),[I,z]=i.useState(null),[V,F]=i.useState(!1),[X,K]=i.useState("");i.useEffect(()=>{k()},[r,t]);const k=async()=>{if(t?._id)try{L(!0);const f=t._id,C=await H.teacherSchedule.getTimeBlocks(f);console.log("Raw API Response:",C);let P=[];try{if(Array.isArray(C))P=C;else if(C?.data&&Array.isArray(C.data))P=C.data;else if(C?.timeBlocks&&Array.isArray(C.timeBlocks))P=C.timeBlocks;else if(C&&typeof C=="object"){const G=Object.values(C).find(oe=>Array.isArray(oe));G?P=G:(console.warn("No array found in response, using empty array"),P=[])}else console.warn("Unexpected timeBlocks format:",C),P=[]}catch(G){console.error("Error parsing timeBlocks response:",G),P=[]}console.log("Parsed timeBlocks:",P),console.log("Time block IDs:",P.map(G=>({_id:G._id,day:G.day,time:`${G.startTime}-${G.endTime}`,location:G.location})));const ne=P.filter(G=>G._id&&G._id!=="undefined");console.log("Valid timeBlocks after filtering:",ne),p(ne);const he=await H.teachers.getTeacher(f);console.log("Teacher profile:",he);let ie=[];if(he?.teaching?.studentIds?.length>0)try{ie=await H.students.getBatchStudents(he.teaching.studentIds),console.log("Students loaded:",ie)}catch(G){console.warn("Failed to load students:",G)}else console.log("No student IDs found in teacher profile");console.log("Creating lesson blocks from student assignments...");const ee=[];ie.forEach(G=>{console.log("Processing student:",G.personalInfo?.fullName),console.log("Student assignments:",G.teacherAssignments),G.teacherAssignments&&G.teacherAssignments.forEach(oe=>{if(oe.teacherId===f){console.log("Creating lesson from assignment:",oe);const Me=oe.time||oe.startTime,Je=oe.duration||45,et=(Re,Ct)=>{const[It,Lt]=Re.split(":").map(Number),ot=It*60+Lt+Ct,$t=Math.floor(ot/60),Dt=ot%60;return`${$t.toString().padStart(2,"0")}:${Dt.toString().padStart(2,"0")}`},ke=oe.endTime||et(Me,Je),Tt=a.find(Re=>Re.day===oe.day)?.location||"",kt={_id:`${G._id}-${oe.day}-${oe.time}`,day:oe.day,startTime:Me,endTime:ke,totalDuration:Je,studentId:G._id,studentName:G.personalInfo?.fullName,teacherId:f,instrument:G.academicInfo?.instrumentProgress?.find(Re=>Re.isPrimary)?.instrumentName,location:oe.location||Tt,type:"lesson"};console.log(`Creating lesson: Student="${G.personalInfo?.fullName}", Day="${oe.day}", Time="${Me}-${ke}"`),ee.push(kt)}})}),console.log("Converted lessons from assignments:",ee);const ge=ee.map(G=>{const oe=ie.find(ke=>ke.teacherAssignments?.some(Ue=>Ue.teacherId===f&&Ue.day===G.day&&Ue.time===G.startTime)),Me=oe?.academicInfo?.instrumentProgress?.find(ke=>ke.isPrimary)||oe?.academicInfo?.instrumentProgress?.[0],et=a.find(ke=>ke.day===G.day)?.location||"";return{id:G._id||G.id||`${G.day}-${G.startTime}`,day:G.day,startTime:G.startTime,endTime:G.endTime,studentName:oe?oe.personalInfo?.fullName:G.studentName,studentId:oe?._id||G.studentId,instrument:Me?.instrumentName||G.instrument,location:G.location||et,notes:G.notes,recurring:G.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:G.totalDuration||ae(G.startTime,G.endTime),studentClass:oe?.personalInfo?.class||oe?.academicInfo?.class,studentPhone:oe?.personalInfo?.phone,studentStage:Me?.currentStage}});s(ge);const fe=ue(r),ve=de(r),qe=J(fe,ge);console.log("Generated calendar days:",qe),console.log("Calendar week range:",{weekStart:fe,weekEnd:ve}),console.log("Mapped lesson days for calendar:",ge),u({weekStart:fe,weekEnd:ve,days:qe})}catch(f){console.error("Error loading schedule:",f),T("שגיאה בטעינת לוח הזמנים")}finally{L(!1)}},J=(f,C)=>{const P=[],ne=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],he=new Map;ne.forEach((ee,me)=>{he.set(ee,me)}),console.log("=== GENERATING CALENDAR ==="),console.log("weekStart:",f,"Day:",f.getDay()),console.log("lessons input:",C),console.log("Day name mapping:",Array.from(he.entries()));const ie=new Map;C.forEach(ee=>{ie.has(ee.day)||ie.set(ee.day,[]),ie.get(ee.day).push(ee)}),console.log("Lessons grouped by day:",Array.from(ie.keys()));for(let ee=0;ee<7;ee++){const me=new Date(f);me.setDate(f.getDate()+ee);const ge=ne[ee],fe=ie.get(ge)||[];console.log(`Day ${ee} (${ge}): found ${fe.length} lessons`,fe.map(ve=>({day:ve.day,time:ve.startTime,student:ve.studentName}))),P.push({date:me.toISOString().split("T")[0],dayName:ge,lessons:fe})}return console.log("Generated calendar days with lessons:",P.map(ee=>({dayName:ee.dayName,lessonCount:ee.lessons.length}))),P},ae=(f,C)=>{const[P,ne]=f.split(":").map(Number),[he,ie]=C.split(":").map(Number);return he*60+ie-(P*60+ne)},ue=f=>{const C=new Date(f),P=C.getDay(),ne=C.getDate()-P;return C.setDate(ne),C.setHours(0,0,0,0),console.log("getWeekStart: input date:",f,"weekStart (Sunday):",C,"day:",C.getDay()),C},de=f=>{const C=ue(f);return C.setDate(C.getDate()+6),C},xe=f=>{const C=new Date(r);C.setDate(r.getDate()+(f==="next"?7:-7)),o(C)},ce=f=>f.slice(0,5),m=f=>new Date(f).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),v=()=>{E(null),d(!0)},B=f=>{console.log("handleEditLessonDay called with:",{studentId:f.studentId,studentName:f.studentName,id:f.id,_id:f._id,type:f.type}),f.studentId&&f.studentName?(console.log("Opening EditLessonModal for student lesson"),O(f),$(!0)):(console.log("Opening LessonDayModal for teaching day/availability block"),E(f),d(!0))},D=f=>{console.log("handleEditTeachingDay called with:",{_id:f._id,id:f.id,day:f.day,startTime:f.startTime,hasStudentId:!!f.studentId,fullData:f});const C={id:f._id||f.id,day:f.day,startTime:f.startTime,endTime:f.endTime,location:f.location||"חדר מוזיקה",notes:f.notes||"",recurring:f.recurring||{isRecurring:!0,excludeDates:[]},totalDuration:ae(f.startTime,f.endTime)};console.log("Opening LessonDayModal with lessonDay:",C),E(C),d(!0)},A=async f=>{z({message:"האם אתה בטוח שברצונך למחוק יום לימוד זה? פעולה זו תבטל את הזמינות שלך בזמן זה.",onConfirm:async()=>{try{await H.teacherSchedule.deleteTimeBlock(t?._id,f._id||f.id),U("יום הלימוד נמחק בהצלחה","success"),k()}catch(C){console.error("Error deleting teaching day:",C),U("שגיאה במחיקת יום הלימוד","error")}}}),re(!0)},U=(f,C)=>{const P=document.createElement("div");P.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${C==="success"?"bg-green-500 text-white":C==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,P.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${C==="success"?"✅":C==="error"?"❌":"ℹ️"} ${f}
    </div>`,document.body.appendChild(P),setTimeout(()=>P.remove(),3e3)},te=f=>{K(f),F(!0)},n=()=>{const f=[];for(let C=7;C<=21;C++)f.push(`${C.toString().padStart(2,"0")}:00`),f.push(`${C.toString().padStart(2,"0")}:30`);return f},N=(f,C)=>{const P=c?.days.find(ie=>ie.date===f),ne=ie=>{const[ee,me]=ie.split(":").map(Number);return ee*60+me};return P?.lessons.find(ie=>{const ee=ne(C),me=ee+30,ge=ne(ie.startTime),fe=ne(ie.endTime),ve=ge>=ee&&ge<me,qe=ee>=ge&&ee<fe;return ve||qe})},Q=f=>{const C=ae(f.startTime,f.endTime);return Math.ceil(C/30)*60},W=(f,C)=>{const P=f.startTime,ne=C,he=ge=>{const[fe,ve]=ge.split(":").map(Number);return fe*60+ve},ie=he(P),ee=he(ne),me=ee+30;return ie>=ee&&ie<me},se=(f,C)=>{const P=me=>{const[ge,fe]=me.split(":").map(Number);return ge*60+fe},ne=P(C),he=ne+30;return a.some(me=>{if(me.day!==f)return!1;const ge=P(me.startTime),fe=P(me.endTime);return ne>=ge&&he<=fe})?!l.some(me=>{if(me.day!==f)return!1;const ge=P(me.startTime),fe=P(me.endTime);return ne<fe&&he>ge}):!1},Z=(f,C,P)=>{se(P,C)&&(M({date:f,time:C,dayName:P}),_(!0))};if(l.filter(f=>{if(!y)return!0;const C=y.toLowerCase();return f.studentName?.toLowerCase().includes(C)||f.instrument?.toLowerCase().includes(C)||f.location?.toLowerCase().includes(C)||f.day.toLowerCase().includes(C)}),b)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען לוח זמנים..."})]})});if(x&&!c)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:x})});const Te=n();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"לוח זמנים שבועי"}),e.jsx("p",{className:"text-gray-600 mt-1",children:c&&`${m(c.weekStart.toISOString().split("T")[0])} - ${m(c.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>xe("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>o(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-yonatan",children:"השבוע"}),e.jsx("button",{onClick:()=>xe("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ft,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-yonatan",children:"שעה"}),c?.days.map(f=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:f.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-yonatan",children:m(f.date)})]},f.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto relative",children:Te.map(f=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",style:{height:"60px"},children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-yonatan flex items-center",children:ce(f)}),c?.days.map(C=>{const P=N(C.date,f),ne=!P&&se(C.dayName,f);return e.jsxs("div",{className:`border-l border-gray-100 relative transition-all duration-300 group ${ne?"bg-blue-50/30 hover:bg-blue-100/50 cursor-pointer border-2 border-transparent hover:border-blue-200":"cursor-default"}`,style:{height:"60px"},onClick:()=>!P&&Z(C.date,f,C.dayName),title:ne?"לחץ להוספת שיעור חדש":"",children:[ne&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center opacity-30 group-hover:opacity-100 transition-all duration-300 group-hover:scale-110",children:[e.jsx(_e,{className:"w-6 h-6 text-blue-500"}),e.jsx("span",{className:"text-[10px] text-blue-600 font-medium mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:"הוסף שיעור"})]})}),P&&W(P,f)&&e.jsx("div",{className:"absolute left-1 right-1 top-1 p-2.5 rounded text-xs font-reisinger-yonatan bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm cursor-pointer transition-all hover:scale-[1.02] z-10 overflow-hidden",style:{height:`${Q(P)-2}px`,minHeight:"82px"},onClick:()=>B(P),title:`${P.studentName||"תלמיד"} - ${P.instrument||""}`,children:e.jsx("div",{className:"flex flex-col h-full justify-between",children:e.jsxs("div",{className:"flex-shrink-0 space-y-1",children:[e.jsxs("div",{className:"font-medium truncate flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3 opacity-60"}),P.studentName||"תלמיד"]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[ce(P.startTime),"-",ce(P.endTime)]}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-80 h-4",children:P.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:P.instrument})]}):e.jsx("span",{className:"invisible",children:"placeholder"})}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-70 h-4",children:P.location?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:P.location})]}):e.jsx("span",{className:"invisible",children:"placeholder"})})]})})})]},`${C.date}-${f}`)})]},f))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"ימי לימוד - זמינות המורה"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"הגדר את הימים והשעות שבהם אתה זמין להוראה"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף יום לימוד"})]})})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-reisinger-yonatan text-lg",children:"אין ימי לימוד מוגדרים"}),e.jsx("button",{onClick:v,className:"mt-4 text-indigo-600 hover:text-indigo-700 font-medium",children:"הוסף יום לימוד ראשון"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(f=>e.jsx(ts,{teachingDay:f,onEdit:()=>D(f),onDelete:()=>A(f)},f._id||f.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-yonatan",children:"ימי לימוד"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-yonatan",children:a.length}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"ימי זמינות להוראה"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-yonatan",children:"שעות זמינות"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-yonatan",children:(a.reduce((f,C)=>{const P=ae(C.startTime,C.endTime);return f+P},0)/60).toFixed(1)}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"שעות שבועיות זמינות"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-yonatan",children:"תלמידים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-yonatan",children:new Set(l.map(f=>f.studentId).filter(Boolean)).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"תלמידים פעילים"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900 font-reisinger-yonatan",children:"שיעורים"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900 mt-2 font-reisinger-yonatan",children:l.length}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"שיעורים קבועים"})]})]}),S&&w&&e.jsx(as,{timeSlot:w,teacherId:t?._id||"",teachingDays:a,onClose:()=>{_(!1),M(null)},onSave:()=>{_(!1),M(null),k()},showNotification:U}),q&&e.jsx(ss,{lessonDay:j,teacherId:t?._id||"",onClose:()=>{d(!1),E(null)},onSave:()=>{d(!1),E(null),k()},showAlert:te}),h&&R&&e.jsx(is,{lesson:R,teacherId:t?._id||"",teachingDays:a,onClose:()=>{$(!1),O(null)},onSave:()=>{$(!1),O(null),k()},showAlert:te}),Y&&I&&e.jsx(rs,{message:I.message,onConfirm:()=>{I.onConfirm(),re(!1),z(null)},onCancel:()=>{re(!1),z(null)}}),V&&e.jsx(ns,{message:X,onClose:()=>{F(!1),K("")}})]})}function ts({teachingDay:t,onEdit:r,onDelete:o}){return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(pe,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-gray-900 font-reisinger-yonatan",children:["יום ",t.day]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"זמינות להוראה"})]})]}),t.isRecurring!==!1&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full font-reisinger-yonatan",children:"שבועי"})]}),e.jsx("div",{className:"mb-3 pb-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:[t.startTime," - ",t.endTime]})]})}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx($e,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{children:t.location})]}),e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),e.jsx("span",{children:"זמין לקביעת שיעורים בזמן זה"})]})}),t.notes&&e.jsx("div",{className:"p-2 bg-gray-50 rounded text-xs text-gray-600 mb-3",children:t.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors text-sm",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"ערוך"})]}),e.jsx("button",{onClick:o,className:"flex items-center justify-center p-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"מחק יום לימוד",children:e.jsx(Ye,{className:"w-3.5 h-3.5"})})]})]})}function ss({lessonDay:t,teacherId:r,onClose:o,onSave:c,showAlert:u}){const[l,s]=i.useState({day:t?.day||"ראשון",startTime:t?.startTime||"14:00",endTime:t?.endTime||"18:00",location:t?.location||"חדר מוזיקה",notes:t?.notes||"",recurring:t?.recurring||{isRecurring:!0,excludeDates:[]}}),[a,p]=i.useState(!1),b=async x=>{if(x.preventDefault(),t?.studentId){u("לא ניתן לערוך שיעור תלמיד מכאן. אנא השתמש באפשרות העריכה בכרטיס השיעור.");return}if(!l.day||!l.startTime||!l.endTime){u("יש למלא את כל השדות הנדרשים");return}try{p(!0);const T={day:l.day,startTime:l.startTime,endTime:l.endTime,location:l.location||null,notes:l.notes||null,recurring:l.recurring||{isRecurring:!0,excludeDates:[]}};t?.id&&/^[0-9a-fA-F]{24}$/.test(t.id)?await H.teacherSchedule.updateTimeBlock(r,t.id,T):await H.teacherSchedule.createTimeBlock(r,T),c()}catch(T){console.error("Error saving lesson day:",T),T?.message?.includes("not found")||T?.message?.includes("Resource not found")?(u("יום הלימוד הזה כבר לא קיים במערכת. הוא יוסר מהתצוגה."),o(),c()):u("שגיאה בשמירת יום הלימוד")}finally{p(!1)}},L=()=>["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:t?"עריכת יום לימוד":"הוספת יום לימוד חדש"}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(we,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום בשבוע *"}),e.jsx("select",{value:l.day,onChange:x=>s(T=>({...T,day:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:L().map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsx("input",{type:"time",value:l.startTime,onChange:x=>s(T=>({...T,startTime:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:l.endTime,onChange:x=>s(T=>({...T,endTime:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מיקום / חדר"}),e.jsxs("select",{value:l.location||"",onChange:x=>s(T=>({...T,location:x.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר חדר"}),Qe.map(x=>e.jsx("option",{value:x,children:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:l.notes||"",onChange:x=>s(T=>({...T,notes:x.target.value})),rows:3,placeholder:"הערות נוספות לגבי השיעור...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.recurring?.isRecurring!==!1,onChange:x=>s(T=>({...T,recurring:{isRecurring:x.target.checked,excludeDates:T.recurring?.excludeDates||[]}})),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"שיעור קבוע (חוזר שבועית)"})]}),l.recurring?.isRecurring&&e.jsx("p",{className:"text-xs text-gray-500 mr-6 mt-1",children:"השיעור יופיע באופן קבוע בכל שבוע ביום ובשעה שהוגדרו"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:a,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"שומר..."]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"עדכן יום לימוד"]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"הוסף יום לימוד"]})})}),e.jsx("button",{type:"button",onClick:o,disabled:a,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function as({timeSlot:t,teacherId:r,teachingDays:o,onClose:c,onSave:u,showNotification:l}){const[s,a]=i.useState(""),[p,b]=i.useState(45),[L,x]=i.useState([]),[T,q]=i.useState(!1),[d,j]=i.useState(!1),[E,y]=i.useState(0),[g,S]=i.useState(""),[_,w]=i.useState(!1);i.useEffect(()=>{M()},[]),i.useEffect(()=>{const I=z=>{z.target.closest(".student-search-dropdown")||w(!1)};return _&&document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[_]);const M=async()=>{try{q(!0);const z=(await H.students.getStudents()).map(V=>{const F=V.academicInfo?.instrumentProgress?.find(X=>X.isPrimary)||V.academicInfo?.instrumentProgress?.[0];return{id:V._id,firstName:V.personalInfo?.firstName||V.personalInfo?.fullName?.split(" ")[0]||"",lastName:V.personalInfo?.lastName||V.personalInfo?.fullName?.split(" ").slice(1).join(" ")||"",instrument:F?.instrumentName||"",class:V.personalInfo?.class||V.academicInfo?.class,stage:F?.currentStage}});x(z)}catch(I){console.error("Error loading students:",I)}finally{q(!1)}},h=L.filter(I=>{if(!g)return!0;const z=g.toLowerCase();return`${I.firstName} ${I.lastName}`.toLowerCase().includes(z)||I.instrument?.toLowerCase().includes(z)||I.class?.toLowerCase().includes(z)}),$=(I,z)=>{const[V,F]=I.split(":").map(Number),X=V*60+F+z,K=Math.floor(X/60),k=X%60;return`${K.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`},R=()=>{const[I]=t.time.split(":").map(Number),z=E;return`${I.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`},O=[0,5,10,15,20,25,30,35,40,45,50,55],Y=async I=>{if(I.preventDefault(),!s){l("יש לבחור תלמיד","error");return}try{j(!0);const z=L.find(ce=>ce.id===s),V=R(),F=$(V,p);console.log("📝 Creating lesson for student:",z),console.log("📅 Lesson details:",{day:t.dayName,time:V,duration:p});const K=o.find(ce=>ce.day===t.dayName)?.location||"",k={teacherId:r,day:t.dayName,time:V,endTime:F,duration:p,location:K,isActive:!0,startDate:new Date().toISOString(),isRecurring:!0};console.log("📖 Fetching student data...");const ae=[...(await H.students.getStudent(s)).teacherAssignments||[],k];console.log("💾 Updating student with teacher assignment..."),await H.students.updateStudent(s,{teacherAssignments:ae}),console.log("👨‍🏫 Updating teacher student list...");const ue=await H.teachers.getTeacher(r),de=ue.teaching?.studentIds||[];de.includes(s)||await H.teachers.updateTeacher(r,{teaching:{...ue.teaching,studentIds:[...de,s]}});const xe={day:t.dayName,startTime:V,endTime:F,studentId:s,studentName:z?`${z.firstName} ${z.lastName}`:"",instrument:z?.instrument||"",location:K,notes:`שיעור קבוע שבועי - נוצר ב-${new Date().toLocaleDateString("he-IL")}`,recurring:{isRecurring:!0,excludeDates:[]},isRecurring:!0,totalDuration:p};console.log("📋 Creating time block for teacher schedule..."),await H.teacherSchedule.createTimeBlock(r,xe),console.log("✅ Lesson created successfully!"),l("השיעור נוצר בהצלחה!","success"),u()}catch(z){console.error("❌ Error creating weekly lesson assignment:",z),l(`שגיאה ביצירת השיעור השבועי: ${z.message||"שגיאה לא ידועה"}`,"error")}finally{j(!1)}},re=I=>I.slice(0,5);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"הוספת שיעור חדש"}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(we,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 mb-2",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["שיעור קבוע שבועי - יום ",t.dayName]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[re(R())," - ",re($(R(),p))," (",p," דקות)"]})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["השיעור יתקיים כל שבוע ביום ",t.dayName," באותה שעה"]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"בחר תלמיד *"}),T?e.jsx("div",{className:"text-center py-2 text-gray-500",children:"טוען רשימת תלמידים..."}):e.jsxs("div",{className:"relative student-search-dropdown",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:I=>{S(I.target.value),w(!0)},onFocus:()=>w(!0),placeholder:"חפש תלמיד לפי שם, כלי נגינה או כיתה...",className:"w-full pr-10 pl-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),s&&!_&&e.jsx("div",{className:"mt-2 p-2 bg-indigo-50 border border-indigo-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-indigo-900",children:[L.find(I=>I.id===s)?.firstName," ",L.find(I=>I.id===s)?.lastName]}),L.find(I=>I.id===s)?.instrument&&e.jsxs("span",{className:"text-indigo-700",children:[" - ",L.find(I=>I.id===s)?.instrument]})]}),e.jsx("button",{type:"button",onClick:()=>{a(""),S(""),w(!0)},className:"text-indigo-600 hover:text-indigo-800",children:e.jsx(we,{className:"w-4 h-4"})})]})}),_&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:h.length>0?h.map(I=>e.jsxs("button",{type:"button",onClick:()=>{a(I.id),S(`${I.firstName} ${I.lastName}`),w(!1)},className:`w-full text-right px-3 py-2 hover:bg-indigo-50 transition-colors border-b border-gray-100 last:border-b-0 ${s===I.id?"bg-indigo-100":""}`,children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[I.firstName," ",I.lastName]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:[I.instrument&&`${I.instrument}`,I.class&&` • כיתה ${I.class}`,I.stage&&` • שלב ${I.stage}`]})]},I.id)):e.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"לא נמצאו תלמידים מתאימים"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:["זמן התחלה מדויק (שעה ",t.time.split(":")[0],":__)"]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:O.map(I=>e.jsxs("button",{type:"button",onClick:()=>y(I),className:`px-3 py-2 rounded-lg border-2 transition-all font-medium ${E===I?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[":",I.toString().padStart(2,"0")]},I))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["שעת התחלה: ",R()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות)"}),e.jsxs("select",{value:p,onChange:I=>b(Number(I.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:30,children:"30 דקות"}),e.jsx("option",{value:45,children:"45 דקות"}),e.jsx("option",{value:60,children:"60 דקות"}),e.jsx("option",{value:90,children:"90 דקות"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:d||!s,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"יוצר שיעור שבועי..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"צור שיעור שבועי"]})}),e.jsx("button",{type:"button",onClick:c,disabled:d,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function rs({message:t,onConfirm:r,onCancel:o}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(Pe,{className:"w-8 h-8 text-orange-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-4 font-reisinger-yonatan",children:t}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:r,className:"flex-1 bg-red-600 text-white py-2.5 px-4 rounded-lg hover:bg-red-700 transition-colors font-reisinger-yonatan font-medium",children:"אישור"}),e.jsx("button",{onClick:o,className:"flex-1 bg-gray-200 text-gray-700 py-2.5 px-4 rounded-lg hover:bg-gray-300 transition-colors font-reisinger-yonatan font-medium",children:"ביטול"})]})]})})}function ns({message:t,onClose:r}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(Pe,{className:"w-8 h-8 text-blue-600"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-6 font-reisinger-yonatan",children:t}),e.jsx("button",{onClick:r,className:"w-full bg-indigo-600 text-white py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan font-medium",children:"הבנתי"})]})})}function is({lesson:t,teacherId:r,teachingDays:o,onClose:c,onSave:u,showAlert:l}){const s=(w,M)=>{const[h,$]=w.split(":").map(Number),[R,O]=M.split(":").map(Number);return R*60+O-(h*60+$)},p=o.find(w=>w.day===t.day)?.location||"",[b,L]=i.useState({day:t.day,startTime:t.startTime,endTime:t.endTime,location:t.location||p,notes:t.notes||""}),[x,T]=i.useState(!1),[q,d]=i.useState(s(t.startTime,t.endTime)),[j,E]=i.useState([]);i.useState(""),i.useEffect(()=>{if(!b.day||!q)return;const w=o.filter(h=>h.day===b.day),M=[];w.forEach(h=>{const[$,R]=h.startTime.split(":").map(Number),[O,Y]=h.endTime.split(":").map(Number),re=$*60+R,z=O*60+Y-re,V=Math.floor(z/q);for(let F=0;F<V;F++){const X=re+F*q,K=X+q,k=Math.floor(X/60),J=X%60,ae=Math.floor(K/60),ue=K%60,de=`${k.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}`,xe=`${ae.toString().padStart(2,"0")}:${ue.toString().padStart(2,"0")}`;M.push({id:`${h._id||h.id}-${q}-${F}`,startTime:de,endTime:xe,duration:q})}}),E(M)},[b.day,q,o]);const y=w=>{L(M=>({...M,startTime:w.startTime,endTime:w.endTime}))},g=async w=>{if(w.preventDefault(),!b.day||!b.startTime||!b.endTime){l("יש למלא את כל השדות הנדרשים");return}const M=s(b.startTime,b.endTime);if(M<=0){l("זמן הסיום חייב להיות לאחר זמן ההתחלה");return}try{if(T(!0),t.studentId){const h={teacherId:r,day:b.day,time:b.startTime,startTime:b.startTime,endTime:b.endTime,duration:M,location:b.location,isActive:!0};await H.students.updateTeacherAssignment(t.studentId,r,h)}S("השיעור עודכן בהצלחה","success"),u()}catch(h){console.error("Error updating lesson:",h),S("שגיאה בעדכון השיעור","error")}finally{T(!1)}},S=(w,M)=>{const h=document.createElement("div");h.className=`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${M==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,h.innerHTML=`<div class="flex items-center gap-2 font-reisinger-yonatan">
      ${M==="success"?"✅":"❌"} ${w}
    </div>`,document.body.appendChild(h),setTimeout(()=>h.remove(),3e3)},_=()=>{const w=Array.from(new Set(o.map(M=>M.day)));return w.length===0?["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"]:w};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"עריכת שיעור"}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(we,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2 font-reisinger-yonatan",children:"פרטי התלמיד"}),e.jsxs("div",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("strong",{children:"תלמיד:"})," ",t.studentName||"לא צוין"]}),t.instrument&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("strong",{children:"כלי נגינה:"})," ",t.instrument]}),t.studentClass&&e.jsxs("div",{children:[e.jsx("strong",{children:"כיתה:"})," ",t.studentClass]}),t.studentStage&&e.jsxs("div",{children:[e.jsx("strong",{children:"שלב:"})," ",t.studentStage]})]})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום בשבוע *"}),e.jsx("select",{value:b.day,onChange:w=>{const M=w.target.value,h=o.find($=>$.day===M);L($=>({...$,day:M,location:(!$.location||$.location==="")&&h?.location?h.location:$.location}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:_().map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות) *"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[30,45,60].map(w=>e.jsxs("button",{type:"button",onClick:()=>d(w),className:`px-4 py-2 rounded-lg border-2 transition-all ${q===w?"border-indigo-600 bg-indigo-50 text-indigo-700 font-semibold":"border-gray-300 bg-white text-gray-700 hover:border-indigo-300"}`,children:[w," דק׳"]},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-reisinger-yonatan",children:"בחר זמן שיעור זמין *"}),j.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(ye,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"אין זמנים זמינים ליום ומשך שיעור שנבחרו"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200",children:j.map(w=>{const M=b.startTime===w.startTime&&b.endTime===w.endTime;return e.jsxs("button",{type:"button",onClick:()=>y(w),className:`p-3 rounded-lg border-2 transition-all text-sm ${M?"border-green-600 bg-green-50 text-green-800 font-semibold shadow-md":w.duration===30?"border-green-300 bg-green-50 text-green-800 hover:border-green-500":w.duration===45?"border-blue-300 bg-blue-50 text-blue-800 hover:border-blue-500":"border-purple-300 bg-purple-50 text-purple-800 hover:border-purple-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-medium",children:[w.startTime,"-",w.endTime]})]}),e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:[w.duration," דקות"]})]},w.id)})})]}),b.startTime&&b.endTime&&e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-indigo-800",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-reisinger-yonatan font-medium",children:["זמן שיעור נבחר: ",b.startTime," - ",b.endTime," (",s(b.startTime,b.endTime)," דקות)"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מיקום / חדר"}),e.jsxs("select",{value:b.location||"",onChange:w=>L(M=>({...M,location:w.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר חדר"}),Qe.map(w=>e.jsx("option",{value:w,children:w},w))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"הערות"}),e.jsx("textarea",{value:b.notes,onChange:w=>L(M=>({...M,notes:w.target.value})),rows:3,placeholder:"הערות נוספות לגבי השיעור...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"submit",disabled:x||!b.startTime||!b.endTime,className:"flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"עדכן שיעור"]})}),e.jsx("button",{type:"button",onClick:c,disabled:x,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function ls(){const{user:t}=De(),[r,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(""),[a,p]=i.useState(!1),[b,L]=i.useState(null),[x,T]=i.useState(null),[q,d]=i.useState([]),[j,E]=i.useState(null),[y,g]=i.useState(!1),[S,_]=i.useState(!1),[w,M]=i.useState(!1),[h,$]=i.useState([]),[R,O]=i.useState(null),[Y,re]=i.useState("lessons");i.useEffect(()=>{I()},[t]);const I=async()=>{if(t?._id)try{u(!0);const m=t._id,D=(await H.theory.getTheoryLessons()).filter(A=>A.teacherId===m).map(A=>({id:A._id,name:A.name,description:A.description,level:A.level,duration:A.duration,capacity:A.capacity,enrolledCount:A.enrolledStudentIds?.length||0,schedule:{dayOfWeek:A.dayOfWeek,startTime:A.startTime,endTime:A.endTime},status:A.isActive?"active":"inactive",venue:A.location,materials:A.materials||[]}));o(D)}catch(m){console.error("Error loading theory lessons:",m),E("שגיאה בטעינת רשימת שיעורי התיאוריה")}finally{u(!1)}},z=async m=>{try{const B=(await H.theory.getTheoryLesson(m)).enrolledStudentIds||[];if(B.length===0){d([]);return}const A=(await H.students.getStudents({ids:B.join(",")})).map(U=>({id:U._id,firstName:U.personalInfo?.firstName||"",lastName:U.personalInfo?.lastName||"",grade:U.academicInfo?.gradeLevel,instrument:U.primaryInstrument,enrollmentDate:U.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));d(A)}catch(v){console.error("Error loading lesson students:",v)}},V=r.filter(m=>l===""||m.name.toLowerCase().includes(l.toLowerCase())||m.level.toLowerCase().includes(l.toLowerCase())||m.description?.toLowerCase().includes(l.toLowerCase())),F=async m=>{if(window.confirm("האם אתה בטוח שברצונך למחוק שיעור זה?"))try{await H.theory.deleteTheoryLesson(m),o(v=>v.filter(B=>B.id!==m)),x===m&&(T(null),d([]))}catch(v){console.error("Error deleting lesson:",v),alert("שגיאה במחיקת השיעור")}},X=async m=>{try{const v=await K(m);if(v.hasConflict){O(v),M(!0);return}if(b){const B={name:m.name,description:m.description,level:m.level,duration:m.duration,capacity:m.capacity,dayOfWeek:m.schedule?.dayOfWeek,startTime:m.schedule?.startTime,endTime:m.schedule?.endTime,isActive:m.status==="active",location:m.venue},D=await H.theory.updateTheoryLesson(b.id,B),A={id:D._id,name:D.name,description:D.description,level:D.level,duration:D.duration,capacity:D.capacity,enrolledCount:D.enrolledStudentIds?.length||0,schedule:{dayOfWeek:D.dayOfWeek,startTime:D.startTime,endTime:D.endTime},status:D.isActive?"active":"inactive",venue:D.location,materials:D.materials||[]};o(U=>U.map(te=>te.id===b.id?A:te))}else{const B=t?._id,D={name:m.name,description:m.description,level:m.level,duration:m.duration,capacity:m.capacity,dayOfWeek:m.schedule?.dayOfWeek,startTime:m.schedule?.startTime,endTime:m.schedule?.endTime,isActive:m.status==="active",location:m.venue,teacherId:B},A=await H.theory.createTheoryLesson(D),U={id:A._id,name:A.name,description:A.description,level:A.level,duration:A.duration,capacity:A.capacity,enrolledCount:A.enrolledStudentIds?.length||0,schedule:{dayOfWeek:A.dayOfWeek,startTime:A.startTime,endTime:A.endTime},status:A.isActive?"active":"inactive",venue:A.location,materials:A.materials||[]};o(te=>[...te,U])}p(!1),L(null)}catch(v){console.error("Error saving lesson:",v),alert("שגיאה בשמירת פרטי השיעור")}},K=async m=>{try{const v=r.filter(U=>U.id!==b?.id&&U.schedule.dayOfWeek===m.schedule?.dayOfWeek),B=m.schedule?.startTime,D=m.schedule?.endTime,A=v.filter(U=>{const te=U.schedule.startTime,n=U.schedule.endTime;return B&&D&&te&&n&&(B>=te&&B<n||D>te&&D<=n||B<=te&&D>=n)});return A.length>0?{hasConflict:!0,conflictDetails:`התנגשות עם ${A[0].name} ב${ce(A[0].schedule.dayOfWeek)} ${A[0].schedule.startTime}-${A[0].schedule.endTime}`,suggestions:["שנה את שעת השיעור","העבר ליום אחר","קצר את משך השיעור"]}:{hasConflict:!1}}catch(v){return console.error("Error checking conflicts:",v),{hasConflict:!1}}},k=async()=>{try{const m=await H.students.getStudents(),v=q.map(D=>D.id),B=m.filter(D=>!v.includes(D._id)).map(D=>({id:D._id,firstName:D.personalInfo?.firstName||"",lastName:D.personalInfo?.lastName||"",grade:D.academicInfo?.gradeLevel,instrument:D.primaryInstrument,enrollmentDate:new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));$(B)}catch(m){console.error("Error loading available students:",m)}},J=async m=>{if(x)try{await mt.enrollStudent(x,m,{method:"manual",performedBy:"teacher",reason:"Teacher enrollment"}),await z(x),await k()}catch(v){console.error("Error enrolling student:",v),alert("שגיאה ברישום התלמיד")}},ae=async m=>{if(x)try{await mt.unenrollStudent(x,m,{reason:"Teacher unenrollment"}),await z(x),await k()}catch(v){console.error("Error unenrolling student:",v),alert("שגיאה בביטול רישום התלמיד")}},ue=async m=>{try{const v={...m,name:`${m.name} - עותק`,id:void 0};await X(v)}catch(v){console.error("Error duplicating lesson:",v),alert("שגיאה בשכפול השיעור")}},de=m=>{switch(m){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return m}},xe=m=>m.substring(0,5),ce=m=>({sunday:"יום ראשון",monday:"יום שני",tuesday:"יום שלישי",wednesday:"יום רביעי",thursday:"יום חמישי",friday:"יום שישי",saturday:"יום שבת"})[m.toLowerCase()]||m;return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת שיעורים..."})]})}):j?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-yonatan",children:j})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"ניהול תיאוריה מתקדם"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[r.length," שיעורים פעילים"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"נהל קבוצות"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"הוסף שיעור"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",dir:"rtl",children:[{id:"lessons",label:"שיעורים",icon:ze},{id:"groups",label:"קבוצות",icon:be},{id:"curriculum",label:"תכנית לימודים",icon:dt},{id:"grades",label:"ציונים",icon:ct}].map(m=>{const v=m.icon;return e.jsxs("button",{onClick:()=>re(m.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 font-reisinger-yonatan ${Y===m.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(v,{className:"w-4 h-4"}),m.label]},m.id)})})}),e.jsxs("div",{className:"p-6",children:[Y==="lessons"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש שיעורים...",value:l,onChange:m=>s(m.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ze,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:l?"לא נמצאו שיעורים":"אין שיעורים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת השיעור הראשון שלך"})]}):V.map(m=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${x===m.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{T(m.id),z(m.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:m.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[de(m.level)," • ",m.duration," דקות"]}),m.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-yonatan",children:m.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),ue(m)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"שכפל שיעור",children:e.jsx(Pt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),L(m),p(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",title:"ערוך שיעור",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),F(m.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"מחק שיעור",children:e.jsx(Ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:ce(m.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[xe(m.schedule.startTime)," - ",xe(m.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:[m.enrolledCount||0,"/",m.capacity]})]}),m.venue&&e.jsx("span",{children:m.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${m.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:m.status==="active"?"פעיל":"לא פעיל"})]})]},m.id))}),x&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-yonatan",children:"תלמידי השיעור"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>{_(!0),k()},className:"flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-yonatan",children:[e.jsx(je,{className:"w-4 h-4"}),"הוסף תלמיד"]})})]}),q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-yonatan",children:"אין תלמידים רשומים לשיעור"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-yonatan",children:[m.firstName," ",m.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[m.instrument&&`${m.instrument} • `,m.grade&&`כיתה ${m.grade} • `,"רישום: ",new Date(m.enrollmentDate).toLocaleDateString("he-IL")]}),m.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-yonatan",children:["נוכחות: ",m.attendance.present,"/",m.attendance.total," שיעורים",e.jsxs("span",{className:`ml-2 ${m.attendance.present/m.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(m.attendance.present/m.attendance.total*100),"%)"]})]})]}),e.jsx("button",{onClick:()=>ae(m.id),className:"text-red-600 hover:text-red-800 p-1",title:"הסר תלמיד",children:e.jsx(yt,{className:"w-4 h-4"})})]},m.id))})]})]})]}),Y==="groups"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"ניהול קבוצות תיאוריה"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]}),Y==="curriculum"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(dt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"תכנית לימודים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]}),Y==="grades"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ct,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"ניהול ציונים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-yonatan",children:"תכונה זו תהיה זמינה בקרוב"})]})]})]}),a&&e.jsx(os,{lesson:b,onClose:()=>{p(!1),L(null)},onSubmit:X}),S&&e.jsx(ds,{availableStudents:h,onClose:()=>_(!1),onEnroll:J}),w&&R&&e.jsx(cs,{conflict:R,onClose:()=>M(!1),onResolve:()=>{M(!1),p(!0)}})]})}function os({lesson:t,onClose:r,onSubmit:o}){const[c,u]=i.useState({name:t?.name||"",description:t?.description||"",level:t?.level||"beginner",duration:t?.duration||60,capacity:t?.capacity||15,status:t?.status||"active",venue:t?.venue||"",schedule:{dayOfWeek:t?.schedule?.dayOfWeek||"sunday",startTime:t?.schedule?.startTime||"09:00",endTime:t?.schedule?.endTime||"10:00"}}),l=a=>{a.preventDefault(),o(c)},s=(a,p)=>{u(b=>({...b,schedule:{...b.schedule,[a]:p}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:t?"עריכת שיעור תיאוריה":"הוספת שיעור תיאוריה חדש"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שם השיעור *"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:a=>u(p=>({...p,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"תיאור השיעור"}),e.jsx("textarea",{value:c.description,onChange:a=>u(p=>({...p,description:a.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"רמה *"}),e.jsxs("select",{required:!0,value:c.level,onChange:a=>u(p=>({...p,level:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"משך השיעור (דקות) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:c.duration,onChange:a=>u(p=>({...p,duration:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"קיבולת תלמידים *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:c.capacity,onChange:a=>u(p=>({...p,capacity:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"סטטוס"}),e.jsxs("select",{value:c.status,onChange:a=>u(p=>({...p,status:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"יום השיעור *"}),e.jsxs("select",{required:!0,value:c.schedule.dayOfWeek,onChange:a=>s("dayOfWeek",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"יום ראשון"}),e.jsx("option",{value:"monday",children:"יום שני"}),e.jsx("option",{value:"tuesday",children:"יום שלישי"}),e.jsx("option",{value:"wednesday",children:"יום רביעי"}),e.jsx("option",{value:"thursday",children:"יום חמישי"}),e.jsx("option",{value:"friday",children:"יום שישי"}),e.jsx("option",{value:"saturday",children:"יום שבת"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת התחלה *"}),e.jsx("input",{type:"time",required:!0,value:c.schedule.startTime,onChange:a=>s("startTime",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"שעת סיום *"}),e.jsx("input",{type:"time",required:!0,value:c.schedule.endTime,onChange:a=>s("endTime",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-yonatan",children:"מקום השיעור"}),e.jsx("input",{type:"text",value:c.venue,onChange:a=>u(p=>({...p,venue:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:t?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})]})})}function ds({availableStudents:t,onClose:r,onEnroll:o}){const[c,u]=i.useState(""),l=t.filter(s=>`${s.firstName} ${s.lastName}`.toLowerCase().includes(c.toLowerCase())||s.instrument?.toLowerCase().includes(c.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"הוסף תלמיד לשיעור"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:c,onChange:s=>u(s.target.value),className:"w-full pl-4 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(be,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין תלמידים זמינים"})]}):l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[s.instrument&&`${s.instrument} • `,s.grade&&`כיתה ${s.grade}`]})]}),e.jsxs("button",{onClick:()=>o(s.id),className:"flex items-center gap-1 px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-reisinger-yonatan",children:[e.jsx(je,{className:"w-4 h-4"}),"הוסף"]})]},s.id))}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"סגור"})})]})})}function cs({conflict:t,onClose:r,onResolve:o}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Rt,{className:"w-8 h-8 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"התנגשות בלוח הזמנים"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-reisinger-yonatan mb-3",children:t.conflictDetails}),t.suggestions&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 font-reisinger-yonatan",children:"הצעות לפתרון:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:t.suggestions.map((c,u)=>e.jsx("li",{className:"font-reisinger-yonatan",children:c},u))})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-yonatan",children:"ערוך שיעור"}),e.jsx("button",{onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-yonatan",children:"ביטול"})]})]})})}let ms={data:""},us=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||ms,gs=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,xs=/\/\*[^]*?\*\/|  +/g,ut=/\n+/g,Ce=(t,r)=>{let o="",c="",u="";for(let l in t){let s=t[l];l[0]=="@"?l[1]=="i"?o=l+" "+s+";":c+=l[1]=="f"?Ce(s,l):l+"{"+Ce(s,l[1]=="k"?"":r)+"}":typeof s=="object"?c+=Ce(s,r?r.replace(/([^,])+/g,a=>l.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,p=>/&/.test(p)?p.replace(/&/g,a):a?a+" "+p:p)):l):s!=null&&(l=/^--/.test(l)?l:l.replace(/[A-Z]/g,"-$&").toLowerCase(),u+=Ce.p?Ce.p(l,s):l+":"+s+";")}return o+(r&&u?r+"{"+u+"}":u)+c},Ne={},bt=t=>{if(typeof t=="object"){let r="";for(let o in t)r+=o+bt(t[o]);return r}return t},hs=(t,r,o,c,u)=>{let l=bt(t),s=Ne[l]||(Ne[l]=(p=>{let b=0,L=11;for(;b<p.length;)L=101*L+p.charCodeAt(b++)>>>0;return"go"+L})(l));if(!Ne[s]){let p=l!==t?t:(b=>{let L,x,T=[{}];for(;L=gs.exec(b.replace(xs,""));)L[4]?T.shift():L[3]?(x=L[3].replace(ut," ").trim(),T.unshift(T[0][x]=T[0][x]||{})):T[0][L[1]]=L[2].replace(ut," ").trim();return T[0]})(t);Ne[s]=Ce(u?{["@keyframes "+s]:p}:p,o?"":"."+s)}let a=o&&Ne.g?Ne.g:null;return o&&(Ne.g=Ne[s]),((p,b,L,x)=>{x?b.data=b.data.replace(x,p):b.data.indexOf(p)===-1&&(b.data=L?p+b.data:b.data+p)})(Ne[s],r,c,a),s},fs=(t,r,o)=>t.reduce((c,u,l)=>{let s=r[l];if(s&&s.call){let a=s(o),p=a&&a.props&&a.props.className||/^go/.test(a)&&a;s=p?"."+p:a&&typeof a=="object"?a.props?"":Ce(a,""):a===!1?"":a}return c+u+(s??"")},"");function Ke(t){let r=this||{},o=t.call?t(r.p):t;return hs(o.unshift?o.raw?fs(o,[].slice.call(arguments,1),r.p):o.reduce((c,u)=>Object.assign(c,u&&u.call?u(r.p):u),{}):o,us(r.target),r.g,r.o,r.k)}let jt,rt,nt;Ke.bind({g:1});let Se=Ke.bind({k:1});function ps(t,r,o,c){Ce.p=r,jt=t,rt=o,nt=c}function Ae(t,r){let o=this||{};return function(){let c=arguments;function u(l,s){let a=Object.assign({},l),p=a.className||u.className;o.p=Object.assign({theme:rt&&rt()},a),o.o=/ *go\d+/.test(p),a.className=Ke.apply(o,c)+(p?" "+p:"");let b=t;return t[0]&&(b=a.as||t,delete a.as),nt&&b[0]&&nt(a),jt(b,a)}return u}}var ys=t=>typeof t=="function",it=(t,r)=>ys(t)?t(r):t,bs=(()=>{let t=0;return()=>(++t).toString()})(),js=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let r=matchMedia("(prefers-reduced-motion: reduce)");t=!r||r.matches}return t}})(),vs=20,vt="default",Nt=(t,r)=>{let{toastLimit:o}=t.settings;switch(r.type){case 0:return{...t,toasts:[r.toast,...t.toasts].slice(0,o)};case 1:return{...t,toasts:t.toasts.map(s=>s.id===r.toast.id?{...s,...r.toast}:s)};case 2:let{toast:c}=r;return Nt(t,{type:t.toasts.find(s=>s.id===c.id)?1:0,toast:c});case 3:let{toastId:u}=r;return{...t,toasts:t.toasts.map(s=>s.id===u||u===void 0?{...s,dismissed:!0,visible:!1}:s)};case 4:return r.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==r.toastId)};case 5:return{...t,pausedAt:r.time};case 6:let l=r.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(s=>({...s,pauseDuration:s.pauseDuration+l}))}}},Ns=[],ws={toasts:[],pausedAt:void 0,settings:{toastLimit:vs}},Ee={},wt=(t,r=vt)=>{Ee[r]=Nt(Ee[r]||ws,t),Ns.forEach(([o,c])=>{o===r&&c(Ee[r])})},St=t=>Object.keys(Ee).forEach(r=>wt(t,r)),Ss=t=>Object.keys(Ee).find(r=>Ee[r].toasts.some(o=>o.id===t)),lt=(t=vt)=>r=>{wt(r,t)},Ts=(t,r="blank",o)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:r,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...o,id:o?.id||bs()}),We=t=>(r,o)=>{let c=Ts(r,t,o);return lt(c.toasterId||Ss(c.id))({type:2,toast:c}),c.id},le=(t,r)=>We("blank")(t,r);le.error=We("error");le.success=We("success");le.loading=We("loading");le.custom=We("custom");le.dismiss=(t,r)=>{let o={type:3,toastId:t};r?lt(r)(o):St(o)};le.dismissAll=t=>le.dismiss(void 0,t);le.remove=(t,r)=>{let o={type:4,toastId:t};r?lt(r)(o):St(o)};le.removeAll=t=>le.remove(void 0,t);le.promise=(t,r,o)=>{let c=le.loading(r.loading,{...o,...o?.loading});return typeof t=="function"&&(t=t()),t.then(u=>{let l=r.success?it(r.success,u):void 0;return l?le.success(l,{id:c,...o,...o?.success}):le.dismiss(c),u}).catch(u=>{let l=r.error?it(r.error,u):void 0;l?le.error(l,{id:c,...o,...o?.error}):le.dismiss(c)}),t};var ks=Se`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Cs=Se`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Is=Se`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Ls=Ae("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ks} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Cs} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Is} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,$s=Se`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ds=Ae("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${$s} 1s linear infinite;
`,As=Se`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Ms=Se`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Es=Ae("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${As} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Ms} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Os=Ae("div")`
  position: absolute;
`,_s=Ae("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Ps=Se`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Rs=Ae("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Ps} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bs=({toast:t})=>{let{icon:r,type:o,iconTheme:c}=t;return r!==void 0?typeof r=="string"?i.createElement(Rs,null,r):r:o==="blank"?null:i.createElement(_s,null,i.createElement(Ds,{...c}),o!=="loading"&&i.createElement(Os,null,o==="error"?i.createElement(Ls,{...c}):i.createElement(Es,{...c})))},Fs=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Hs=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,zs="0%{opacity:0;} 100%{opacity:1;}",Ws="0%{opacity:1;} 100%{opacity:0;}",qs=Ae("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Us=Ae("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Gs=(t,r)=>{let o=t.includes("top")?1:-1,[c,u]=js()?[zs,Ws]:[Fs(o),Hs(o)];return{animation:r?`${Se(c)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Se(u)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};i.memo(({toast:t,position:r,style:o,children:c})=>{let u=t.height?Gs(t.position||r||"top-center",t.visible):{opacity:0},l=i.createElement(Bs,{toast:t}),s=i.createElement(Us,{...t.ariaProps},it(t.message,t));return i.createElement(qs,{className:t.className,style:{...u,...o,...t.style}},typeof c=="function"?c({icon:l,message:s}):i.createElement(i.Fragment,null,l,s))});ps(i.createElement);Ke`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;function Qs(){const{user:t}=De(),[r,o]=i.useState([]),[c,u]=i.useState(!0),[l,s]=i.useState(new Date().toISOString().split("T")[0]),[a,p]=i.useState({totalStudents:0,markedToday:0,presentToday:0,absentToday:0});i.useEffect(()=>{b()},[l]);const b=async()=>{try{u(!0);const d=t?._id||t?.teacherId||t?.id;if(!d){le.error("לא נמצא מזהה מורה");return}const j=t?.teaching?.studentIds||[];if(j.length===0){o([]),p({totalStudents:0,markedToday:0,presentToday:0,absentToday:0}),u(!1);return}const y=(await H.students.getBatchStudents(j)).map(async M=>{try{const h=await H.attendance.getIndividualLessonAttendance({studentId:M._id||M.id,teacherId:d,date:l});return{...M,attendanceStatus:h?.status||null,isMarking:!1}}catch{return{...M,attendanceStatus:null,isMarking:!1}}}),g=await Promise.all(y);o(g);const S=g.filter(M=>M.attendanceStatus!==null),_=g.filter(M=>M.attendanceStatus==="present"),w=g.filter(M=>M.attendanceStatus==="absent");p({totalStudents:g.length,markedToday:S.length,presentToday:_.length,absentToday:w.length})}catch(d){console.error("Error loading students and attendance:",d),le.error("שגיאה בטעינת נתוני נוכחות")}finally{u(!1)}},L=async(d,j)=>{const E=t?._id||t?.teacherId||t?.id;if(!E){le.error("לא נמצא מזהה מורה");return}o(y=>y.map(g=>(g._id||g.id)===d?{...g,isMarking:!0}:g));try{const y={studentId:d,teacherId:E,date:l,status:j,lessonType:"individual"};await H.attendance.saveIndividualLessonAttendance(y),o(S=>S.map(_=>(_._id||_.id)===d?{..._,attendanceStatus:j,isMarking:!1}:_)),p(S=>{const _=r.find(M=>(M._id||M.id)===d)?.attendanceStatus!==null,w=r.find(M=>(M._id||M.id)===d)?.attendanceStatus==="present";return{...S,markedToday:_?S.markedToday:S.markedToday+1,presentToday:j==="present"?w?S.presentToday:S.presentToday+1:w?S.presentToday-1:S.presentToday,absentToday:j==="absent"?!w&&_?S.absentToday:S.absentToday+1:_&&!w?S.absentToday-1:S.absentToday}});const g=r.find(S=>(S._id||S.id)===d)?.personalInfo?.fullName||"התלמיד";le.success(j==="present"?`${g} סומן כנוכח ✓`:`${g} סומן כנעדר`,{duration:2e3})}catch(y){console.error("Error marking attendance:",y),le.error("שגיאה בסימון נוכחות"),o(g=>g.map(S=>(S._id||S.id)===d?{...S,isMarking:!1}:S))}},x=async d=>{const j=r.filter(g=>g.attendanceStatus===null);if(j.length===0){le("כל התלמידים כבר סומנו",{icon:"ℹ️"});return}o(g=>g.map(S=>S.attendanceStatus===null?{...S,isMarking:!0}:S));const E=d==="present"?"נוכחים":"נעדרים",y=le.loading(`מסמן ${j.length} תלמידים כ${E}...`);try{const g=j.map(S=>L(S._id||S.id,d));await Promise.all(g),le.success(`כל התלמידים סומנו כ${E} ✓`,{id:y})}catch{le.error("שגיאה בסימון נוכחות המונית",{id:y}),o(S=>S.map(_=>({..._,isMarking:!1})))}},T=()=>new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),q=l===new Date().toISOString().split("T")[0];return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(tt,{className:"w-8 h-8 text-indigo-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"טוען נתוני נוכחות..."})]})}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין תלמידים"}),e.jsx("p",{className:"text-gray-600",children:"טרם הוקצו לך תלמידים"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך"}),e.jsx("input",{type:"date",value:l,onChange:d=>s(d.target.value),max:new Date().toISOString().split("T")[0],className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),q&&e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:T()})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"סה״כ תלמידים"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 mt-1",children:a.totalStudents})]}),e.jsx(be,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"נוכחים"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 mt-1",children:a.presentToday})]}),e.jsx(Be,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"נעדרים"}),e.jsx("p",{className:"text-2xl font-bold text-red-700 mt-1",children:a.absentToday})]}),e.jsx(Fe,{className:"w-8 h-8 text-red-400"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg border border-purple-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"אחוז נוכחות"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 mt-1",children:[a.markedToday>0?Math.round(a.presentToday/a.markedToday*100):0,"%"]})]}),e.jsx(Bt,{className:"w-8 h-8 text-purple-400"})]})})]}),a.markedToday<a.totalStudents&&e.jsx("div",{className:"bg-indigo-50 rounded-lg border border-indigo-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"סמן את כל התלמידים שטרם סומנו:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x("present"),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[e.jsx(Be,{className:"w-4 h-4"}),"סמן הכל כנוכחים"]}),e.jsxs("button",{onClick:()=>x("absent"),className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:[e.jsx(Fe,{className:"w-4 h-4"}),"סמן הכל כנעדרים"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"רשימת תלמידים"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:r.map(d=>{const j=d._id||d.id;return e.jsx("div",{className:`px-6 py-4 hover:bg-gray-50 transition-colors ${d.isMarking?"opacity-60":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:d.personalInfo.fullName.split(" ").map(E=>E[0]).join("")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:d.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[d.instrument&&e.jsx("span",{children:d.instrument}),d.academicInfo?.grade&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["כיתה ",d.academicInfo.grade]})]})]})]})]})}),e.jsxs("div",{className:"flex-shrink-0",children:[d.attendanceStatus==="present"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm font-medium",children:[e.jsx(Be,{className:"w-4 h-4"}),"נוכח"]}),d.attendanceStatus==="absent"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium",children:[e.jsx(Fe,{className:"w-4 h-4"}),"נעדר"]}),d.attendanceStatus===null&&e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm font-medium",children:"לא סומן"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>L(j,"present"),disabled:d.isMarking||d.attendanceStatus==="present",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${d.attendanceStatus==="present"?"bg-green-100 text-green-700 cursor-default":"bg-green-600 text-white hover:bg-green-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.isMarking?e.jsx(tt,{className:"w-4 h-4 animate-spin"}):e.jsx(Be,{className:"w-4 h-4"}),"נוכח"]}),e.jsxs("button",{onClick:()=>L(j,"absent"),disabled:d.isMarking||d.attendanceStatus==="absent",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${d.attendanceStatus==="absent"?"bg-red-100 text-red-700 cursor-default":"bg-red-600 text-white hover:bg-red-700 active:scale-95"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.isMarking?e.jsx(tt,{className:"w-4 h-4 animate-spin"}):e.jsx(Fe,{className:"w-4 h-4"}),"נעדר"]})]})]})},j)})})]}),a.markedToday===a.totalStudents&&a.totalStudents>0&&e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"כל התלמידים סומנו! ✓"}),e.jsxs("p",{className:"text-sm text-green-700",children:[a.presentToday," נוכחים • ",a.absentToday," נעדרים"]})]})]})})]})}function Vs(){const{user:t,checkAuthStatus:r}=De(),[o,c]=i.useState(!1),[u,l]=i.useState(!1),[s,a]=i.useState({type:null,message:""}),[p,b]=i.useState(null),[L,x]=i.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});i.useEffect(()=>{T()},[]);const T=async()=>{try{l(!0);const y=await st.getMyProfile();b(y),x({fullName:y?.personalInfo?.fullName||"",email:y?.personalInfo?.email||"",phone:y?.personalInfo?.phone||"",address:y?.personalInfo?.address||"",birthDate:y?.personalInfo?.birthDate||""})}catch(y){console.error("Error fetching profile data:",y),a({type:"error",message:"שגיאה בטעינת פרטי הפרופיל"}),t&&x({fullName:t?.personalInfo?.fullName||"",email:t?.personalInfo?.email||t?.email||"",phone:t?.personalInfo?.phone||t?.phone||"",address:t?.personalInfo?.address||t?.address||"",birthDate:t?.personalInfo?.birthDate||t?.birthDate||""})}finally{l(!1)}},q=async()=>{try{l(!0),a({type:null,message:""});const y=await st.updateMyProfile(L);b(y),r&&await r(!0),c(!1),a({type:"success",message:"הפרופיל עודכן בהצלחה"}),setTimeout(()=>{a({type:null,message:""})},3e3)}catch(y){console.error("Error updating profile:",y),a({type:"error",message:"שגיאה בעדכון הפרופיל. אנא נסה שוב."})}finally{l(!1)}},d=()=>{const y=p||t;x({fullName:y?.personalInfo?.fullName||"",email:y?.personalInfo?.email||y?.email||"",phone:y?.personalInfo?.phone||y?.phone||"",address:y?.personalInfo?.address||y?.address||"",birthDate:y?.personalInfo?.birthDate||y?.birthDate||""}),c(!1),a({type:null,message:""})},j=y=>y?new Date(y).toLocaleDateString("he-IL"):"",E=p||t;return u&&!E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-yonatan",children:"טוען פרטי פרופיל..."})]})}):e.jsxs("div",{className:"space-y-6",children:[s.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${s.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[s.type==="success"?e.jsx(Ze,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:s.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:"פרטים אישיים"}),o?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:q,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[u?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"שמירה"})]}),e.jsxs("button",{onClick:d,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"ביטול"})]})]}):e.jsxs("button",{onClick:()=>c(!0),disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-yonatan",children:"עריכה"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"שם מלא"}),o?e.jsx("input",{type:"text",value:L.fullName,onChange:y=>x(g=>({...g,fullName:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן שם מלא"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-yonatan",children:L.fullName||"לא צוין"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:'דוא"ל'}),o?e.jsx("input",{type:"email",value:L.email,onChange:y=>x(g=>({...g,email:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ht,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:L.email||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"טלפון"}),o?e.jsx("input",{type:"tel",value:L.phone,onChange:y=>x(g=>({...g,phone:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(gt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",dir:"ltr",children:L.phone||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"כתובת"}),o?e.jsx("input",{type:"text",value:L.address,onChange:y=>x(g=>({...g,address:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן כתובת"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx($e,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:L.address||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"תאריך לידה"}),o?e.jsx("input",{type:"date",value:L.birthDate,onChange:y=>x(g=>({...g,birthDate:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-yonatan",children:j(L.birthDate)||"לא צוין"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-yonatan",children:"מידע תפקיד"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"תפקיד:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:(()=>{const y=E?.roles||[];if(y.length>0)return y.join(", ");const g=E?.role||"";switch(g){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return g||"לא צוין"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"מזהה משתמש:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan font-mono text-sm",children:E?.teacherId||E?._id||E?.id||"לא צוין"})]}),E?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"סטטוס:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:E.isActive?"פעיל":"לא פעיל"})]}),E?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-yonatan",children:"כלי נגינה:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-yonatan",children:E.professionalInfo.instrument})]})]})]})]})}function aa(){const{user:t}=De(),r=Mt();Et();const[o,c]=i.useState("general"),[u,l]=i.useState(null),[s,a]=i.useState(!0),[p,b]=i.useState(null);i.useEffect(()=>{const h=r.state;if(h?.activeTab){c(h.activeTab),window.history.replaceState(null,"",window.location.pathname);return}const $=new URLSearchParams(r.search),R=$.get("tab"),O=$.get("action");R&&c(R),O&&b(O),(R||O)&&window.history.replaceState(null,"",window.location.pathname)},[r]),i.useEffect(()=>{t&&L()},[t]);const L=async()=>{try{if(a(!0),!(t?._id||t?.teacherId||t?.id)){console.warn("No user ID available for loading profile statistics");return}const $=await st.getMyProfile();if(!$){console.warn("No teacher profile found"),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const R=$?.teaching?.studentIds||[],O=$?.conducting?.orchestraIds||[],Y=$?.teaching?.timeBlocks||[],[re,I]=await Promise.allSettled([R.length>0?H.students.getBatchStudents(R):Promise.resolve([]),O.length>0?H.orchestras.getBatchOrchestras(O):Promise.resolve([])]),z=re.status==="fulfilled"?re.value:[];re.status==="rejected"&&console.error("Failed to load student data:",re.reason);const V=I.status==="fulfilled"?I.value:[];I.status==="rejected"&&console.error("Failed to load orchestra data:",I.reason);const F=Array.isArray(z)?z.filter(k=>k.academicInfo?.isActive!==!1):[],X=Array.isArray(Y)?Y.reduce((k,J)=>k+(parseInt(J.totalDuration)||0),0):0,K=Math.round(X/60*10)/10;l({studentsCount:Array.isArray(z)?z.length:0,activeStudents:F.length,weeklyHours:K,orchestrasCount:Array.isArray(V)?V.length:0,theoryLessonsCount:0})}catch(h){console.error("Error loading profile statistics:",h),l({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{a(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען פרטי משתמש..."})]})});const x=()=>t?.roles?.includes("conductor")||t?.roles?.includes("מנצח")||t?.conducting?.orchestraIds&&t.conducting.orchestraIds.length>0,T=()=>t?.roles?.includes("teacher")||t?.roles?.includes("מורה")||t?.teaching?.studentIds&&t.teaching.studentIds.length>0,q=()=>t?.roles?.includes("theory_teacher")||t?.roles?.includes("מורה תאוריה"),j=(()=>{const $=[...[{id:"general",label:"פרטים כלליים",icon:Oe,component:Vs}]];return T()&&($.push({id:"students",label:"התלמידים שלי",icon:be,component:Qt}),$.push({id:"schedule",label:"לוח זמנים שבועי",icon:pe,component:es}),t?.teaching?.studentIds&&t.teaching.studentIds.length>0&&$.push({id:"attendance",label:"נוכחות",icon:He,component:Qs})),x()&&$.push({id:"orchestras",label:"התזמורות שלי",icon:Le,component:Kt}),q()&&$.push({id:"lessons",label:"שיעורי התיאוריה שלי",icon:ze,component:ls}),$})(),y=(j.find(h=>h.id===o)||j[0]).component,g={};o==="students"&&p&&(g.action=p);const S=()=>{const h=t?.role||t?.roles?.[0]||"";switch(h){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return h||"משתמש"}},_=()=>t?.personalInfo?.fullName||t?.fullName||t?.name||"משתמש",w=()=>{const h=_();if(!h||h==="משתמש")return"מ";const $=h.trim().split(" ");return $.length>=2?$[0][0]+$[1][0]:$[0][0]||"מ"},M=()=>t?.personalInfo?.email||t?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-yonatan",children:w()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:_()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S()," • ",M()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(Ge,{title:"סה״כ תלמידים",value:s?"...":u?.studentsCount?.toString()||"0",icon:be,color:"blue",loading:s}),e.jsx(Ge,{title:"תלמידים פעילים",value:s?"...":u?.activeStudents?.toString()||"0",icon:zt,color:"green",loading:s}),e.jsx(Ge,{title:"שעות שבועיות",value:s?"...":u?.weeklyHours?.toString()||"0",icon:ye,color:"purple",loading:s}),e.jsx(Ge,{title:x()?"תזמורות":"שיעורי תיאוריה",value:s?"...":(u?.orchestrasCount||u?.theoryLessonsCount)?.toString()||"0",icon:x()?Le:ze,color:"indigo",loading:s})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:j.map(h=>{const $=h.icon;return e.jsxs("button",{onClick:()=>c(h.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${o===h.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:h.label})]},h.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(y,{...g})})]})]})}function Ge({title:t,value:r,icon:o,color:c,loading:u}){const s={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[c];return e.jsx("div",{className:`bg-white rounded-lg border ${s.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-yonatan truncate",children:t}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-yonatan",children:u?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):r})]}),e.jsx("div",{className:`${s.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(o,{className:`w-4 h-4 sm:w-6 sm:h-6 ${s.text}`})})]})})}export{aa as default};
