import{r as n}from"./vendor-B2j9q2e_.js";import{g as v}from"./cascade-deletion-DAN0Gkem.js";import{i as x,k as S}from"../assets/index-CVVLhZwk.js";const G="/bagrut",E={async getAllBagruts(t={}){try{console.log("🌐 BagrutService: Fetching bagruts with params:",t);const e=await v.get(G,t);console.log("📨 BagrutService: Raw API response:",e),console.log("📨 BagrutService: Response type:",typeof e),console.log("📨 BagrutService: Is array?",Array.isArray(e));let l=[];return Array.isArray(e)?l=e:e&&(console.warn("Unexpected response format (expected array):",e),l=[]),console.log("✅ BagrutService: Returning bagruts:",l.length,"items"),l}catch(e){throw console.error("❌ BagrutService: Error fetching bagruts:",e),new Error("שגיאה בטעינת רשימת בגרויות")}},async getBagrutById(t){try{console.log("🔍 BagrutService: Fetching bagrut by ID:",t);const e=await v.get(`${G}/${t}`);return console.log("📦 BagrutService: getBagrutById response:",e),e}catch(e){throw console.error("Error fetching bagrut:",e),new Error("שגיאה בטעינת בגרות")}},async getBagrutByStudentId(t){try{console.log("🔍 BagrutService: Fetching bagrut by student ID:",t);const e=await v.get(`${G}/student/${t}`);return console.log("📦 BagrutService: getBagrutByStudentId response:",e),e}catch(e){throw console.error("Error fetching student bagrut:",e),new Error("שגיאה בטעינת בגרות התלמיד")}},async createBagrut(t){try{this.validateBagrutData(t);const e=await v.post(G,t);if(console.log("🎓 Create Bagrut Response:",e),e&&e._id)return e;throw console.error("Unexpected response format:",e),new Error("תגובה לא צפויה מהשרת")}catch(e){throw console.error("Error creating bagrut:",e),e instanceof Error?e:new Error("שגיאה ביצירת בגרות חדשה")}},async updateBagrut(t,e){try{return this.validateUpdateData(e),await v.put(`${G}/${t}`,e)}catch(l){throw console.error("Error updating bagrut:",l),new Error("שגיאה בעדכון בגרות")}},async updateBagrutProgram(t,e){try{return await v.put(`${G}/${t}/program`,{program:e})}catch(l){throw console.error("Error updating bagrut program:",l),new Error("שגיאה בעדכון תכנית הבגרות")}},async updatePresentation(t,e,l){try{return this.validatePresentationData(l),await v.put(`${G}/${t}/presentation/${e}`,l)}catch(w){throw console.error("Error updating presentation:",w),new Error("שגיאה בעדכון המצגת")}},async updateDirectorEvaluation(t,e){try{return this.validateDirectorEvaluation(e),await v.put(`${G}/${t}/director-evaluation`,e)}catch(l){throw console.error("Error updating director evaluation:",l),new Error("שגיאה בעדכון הערכת המנהל")}},async setRecitalConfiguration(t,e){try{return this.validateRecitalConfiguration(e),await v.put(`${G}/${t}/recital-config`,e)}catch(l){throw console.error("Error setting recital configuration:",l),new Error("שגיאה בהגדרת תצורת הרסיטל")}},async calculateFinalGrade(t){try{return await v.post(`${G}/${t}/calculate-grade`)}catch(e){throw console.error("Error calculating final grade:",e),new Error("שגיאה בחישוב הציון הסופי")}},getDefaultDetailedGrading(){return{playingSkills:{points:0,maxPoints:40,comments:""},musicalUnderstanding:{points:0,maxPoints:30,comments:""},textKnowledge:{points:0,maxPoints:20,comments:""},playingByHeart:{points:0,maxPoints:10,comments:""}}},validateBagrutData(t){if(!t.studentId)throw new Error("מזהה תלמיד נדרש");if(!t.teacherId)throw new Error("מזהה מורה נדרש");if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("מספר יחידות חייב להיות 3 או 5");if(t.recitalField&&!["קלאסי","ג'אז","שירה","מוסיקה ישראלית","מוסיקה עולמית"].includes(t.recitalField))throw new Error("תחום הרסיטל לא תקין")},validateUpdateData(t){if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("מספר יחידות חייב להיות 3 או 5");if(t.recitalField&&!["קלאסי","ג'אז","שירה","מוסיקה ישראלית","מוסיקה עולמית"].includes(t.recitalField))throw new Error("תחום הרסיטל לא תקין")},validatePresentationData(t){if(t.detailedGrading){const e=t.detailedGrading;if(e.playingSkills?.points>40)throw new Error("כישורי נגינה לא יכולים לעלות על 40 נקודות");if(e.musicalUnderstanding?.points>30)throw new Error("הבנה מוזיקלית לא יכולה לעלות על 30 נקודות");if(e.textKnowledge?.points>20)throw new Error("ידע בטקסט לא יכול לעלות על 20 נקודות");if(e.playingByHeart?.points>10)throw new Error("נגינה בעל פה לא יכולה לעלות על 10 נקודות");if((e.playingSkills?.points||0)+(e.musicalUnderstanding?.points||0)+(e.textKnowledge?.points||0)+(e.playingByHeart?.points||0)>100)throw new Error("סך כל הנקודות לא יכול לעלות על 100")}},validateDirectorEvaluation(t){if(typeof t.points!="number")throw new Error("נקודות המנהל חייבות להיות מספר");if(t.points<0||t.points>100)throw new Error("נקודות המנהל חייבות להיות בין 0 ל-100")},validateRecitalConfiguration(t){if(![3,5].includes(t.recitalUnits))throw new Error("מספר יחידות חייב להיות 3 או 5");if(!["קלאסי","ג'אז","שירה"].includes(t.recitalField))throw new Error("תחום הרסיטל חייב להיות קלאסי, ג'אז או שירה")}};function X(){const{state:t,actions:e}=x(),l=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("🔍 Fetching bagruts with params:",m);const a=await E.getAllBagruts(m||{});console.log("📋 Raw bagruts from service:",a);const o=Array.isArray(a)?a:[];console.log("✅ Setting bagruts in context:",o.length,"items"),e.setBagruts(o),setTimeout(()=>{console.log("🔍 Context state after setBagruts:",t.bagruts?.length||0)},100)}catch(a){console.error("❌ Error fetching bagruts:",a);const o=a instanceof Error?a.message:"שגיאה בטעינת בגרויות";e.setError(o)}finally{e.setLoading(!1)}},[e,t.bagruts]),w=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("🔍 fetchBagrutById: Fetching bagrut with ID:",m);const a=await E.getBagrutById(m);console.log("✅ fetchBagrutById: Bagrut fetched successfully:",a),e.setCurrentBagrut(a),console.log("✅ fetchBagrutById: CurrentBagrut set in context")}catch(a){console.error("❌ fetchBagrutById: Error:",a);const o=a instanceof Error?a.message:"שגיאה בטעינת בגרות";e.setError(o)}finally{e.setLoading(!1)}},[e]),I=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{const a=await E.getBagrutByStudentId(m);e.setCurrentBagrut(a),a?._id&&e.recalculateGrade(a._id)}catch(a){const o=a instanceof Error?a.message:"שגיאה בטעינת בגרות התלמיד";e.setError(o)}finally{e.setLoading(!1)}},[e]),P=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("🚀 Creating bagrut with data:",m);const a=await E.createBagrut(m);return console.log("✅ Bagrut created successfully:",a),a&&(a._id||a.id)?(e.setCurrentBagrut(a),await l(),console.log("✅ Context updated with new bagrut"),a):(console.error("❌ Invalid bagrut object returned:",a),e.setError("בגרות נוצרה אך לא ניתן היה לטעון אותה"),null)}catch(a){console.error("❌ Error in createBagrut:",a);const o=a instanceof Error?a.message:"שגיאה ביצירת בגרות";return e.setError(o),null}finally{e.setLoading(!1)}},[e,l]),M=n.useCallback(async(m,a)=>{e.setLoading(!0),e.clearValidationErrors();try{const o=await E.updateBagrut(m,a);return o?(e.setCurrentBagrut(o),e.recalculateGrade(m),o):null}catch(o){const r=o instanceof Error?o.message:"שגיאה בעדכון בגרות";return e.setError(r),null}finally{e.setLoading(!1)}},[e]),B=n.useCallback(async(m,a,o)=>{if(a<3&&t.currentBagrut&&!e.validateSequentialPresentation(a,t.currentBagrut.presentations||[])||a===3&&o.detailedGrading&&!e.validatePointTotal(o.detailedGrading))return!1;e.setLoading(!0);try{return await E.updatePresentation(m,a,o)?(e.updatePresentation(m,a,o),!0):!1}catch(r){const u=r instanceof Error?r.message:"שגיאה בעדכון מצגת";return e.setError(u),!1}finally{e.setLoading(!1)}},[e,t.currentBagrut]),A=n.useCallback(async(m,a)=>{if(a.points<0||a.points>100)return e.setValidationError("directorEvaluation","הערכת מנהל חייבת להיות בין 0 ל-100"),!1;e.setLoading(!0);try{return await E.updateDirectorEvaluation(m,a)?(e.updateDirectorEvaluation(m,{points:a.points,percentage:a.points/100*100,comments:a.comments}),!0):!1}catch(o){const r=o instanceof Error?o.message:"שגיאה בעדכון הערכת מנהל";return e.setError(r),!1}finally{e.setLoading(!1)}},[e]),p=n.useCallback(async(m,a)=>{if(a.recitalUnits!==3&&a.recitalUnits!==5)return e.setValidationError("recitalUnits","יחידות רסיטל חייבות להיות 3 או 5"),!1;if(!["קלאסי","ג'אז","שירה"].includes(a.recitalField))return e.setValidationError("recitalField","תחום רסיטל לא חוקי"),!1;e.setLoading(!0);try{return await E.setRecitalConfiguration(m,a)?(e.updateRecitalConfig(m,a),!0):!1}catch(r){const u=r instanceof Error?r.message:"שגיאה בהגדרת תצורת רסיטל";return e.setError(u),!1}finally{e.setLoading(!1)}},[e]),L=n.useCallback(async m=>{e.setLoading(!0);try{e.recalculateGrade(m);const a=await E.calculateFinalGrade(m);return a?(e.setCurrentBagrut(a),!0):!1}catch(a){const o=a instanceof Error?a.message:"שגיאה בחישוב ציון סופי";return e.setError(o),!1}finally{e.setLoading(!1)}},[e]),U=n.useCallback(async(m,a)=>{if(!a.pieceTitle?.trim()||!a.composer?.trim()||!a.duration?.trim())return e.setValidationError("programPiece","נדרשים כותרת יצירה, מלחין ומשך זמן"),!1;e.setLoading(!0);try{return await E.addProgramPiece(m,a)?(await w(m),!0):!1}catch(o){const r=o instanceof Error?o.message:"שגיאה בהוספת יצירה";return e.setError(r),!1}finally{e.setLoading(!1)}},[e,w]),V=n.useCallback(m=>{const a=t.bagruts.find(r=>r._id===m)||t.currentBagrut;if(!a)return!1;const o=[];a.program?.length||o.push("נדרשת לפחות יצירה אחת בתכנית");for(let r=0;r<3;r++)a.presentations?.[r]?.completed||o.push(`מצגת ${r+1} לא הושלמה`);if(!a.presentations?.[3]?.detailedGrading)o.push("מצגת ביצוע לא הושלמה");else{const r=a.presentations[3].detailedGrading;(r.playingSkills?.points||0)+(r.musicalUnderstanding?.points||0)+(r.textKnowledge?.points||0)+(r.playingByHeart?.points||0)===0&&o.push("נדרש ציון ביצוע")}return a.directorEvaluation?.points||o.push("נדרשת הערכת מנהל"),(!a.recitalConfiguration?.units||!a.recitalConfiguration?.field)&&o.push("נדרשת הגדרת תצורת רסיטל"),o.length>0?(e.setValidationError("completion",o.join(", ")),!1):(e.clearValidationErrors(),!0)},[t.bagruts,t.currentBagrut,e]),F=n.useCallback(m=>{const a=t.bagruts.find(f=>f._id===m)||t.currentBagrut;if(!a)return null;const o=a.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1},r=7,u=o.presentations.filter(Boolean).length+(o.directorEvaluation?1:0)+(o.recitalConfig?1:0)+(o.program?1:0);return{completedSteps:u,totalSteps:r,percentageComplete:Math.round(u/r*100),isComplete:u===r,missingSteps:[...o.presentations.map((f,c)=>f?null:`מצגת ${c+1}`).filter(Boolean),o.directorEvaluation?null:"הערכת מנהל",o.recitalConfig?null:"תצורת רסיטל",o.program?null:"תכנית"].filter(Boolean)}},[t.bagruts,t.currentBagrut]);return{state:t,fetchAllBagruts:l,fetchBagrutById:w,fetchBagrutByStudentId:I,createBagrut:P,updateBagrut:M,updatePresentation:B,updateDirectorEvaluation:A,setRecitalConfiguration:p,calculateFinalGrade:L,addProgramPiece:U,validateBagrutCompletion:V,getValidationSummary:F,clearError:()=>e.setError(null),clearValidationErrors:e.clearValidationErrors,recalculateGrade:e.recalculateGrade}}function Y(){const{state:t}=x(),e=n.useMemo(()=>S.getCurrentBagrut(t),[t]),l=n.useMemo(()=>{const r=S.getAllBagruts(t);return console.log("🔍 useBagrutSelectors: allBagruts selector:",r?.length||0,"items"),console.log("🔍 Raw state.bagruts:",t.bagruts?.length||0,"items"),r},[t]),w=n.useMemo(()=>S.getLoadingState(t),[t]),I=n.useMemo(()=>S.getError(t),[t]),P=n.useMemo(()=>S.getValidationErrors(t),[t]),M=n.useMemo(()=>r=>S.getBagrutById(t,r),[t]),B=n.useMemo(()=>r=>S.getCompletedPresentations(t,r),[t]),A=n.useMemo(()=>r=>S.getTotalPerformancePoints(t,r),[t]),p=n.useMemo(()=>r=>S.getWeightedFinalGrade(t,r),[t]),L=n.useMemo(()=>r=>S.getCompletionStatus(t,r),[t]),U=n.useMemo(()=>{const r=l,u=r.length,f=r.filter(y=>y.isCompleted).length,c=r.filter(y=>!y.isCompleted&&y.isActive).length,s=r.filter(y=>!y.isActive).length,g=r.filter(y=>y.finalGrade!==void 0).reduce((y,C)=>{const k=C.finalGrade;return k>=95?y.excellent++:k>=85?y.veryGood++:k>=75?y.good++:k>=65?y.almostGood++:k>=55?y.sufficient++:y.insufficient++,y},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{total:u,completed:f,inProgress:c,inactive:s,completionRate:u>0?Math.round(f/u*100):0,gradeDistribution:g,averageGrade:r.length>0&&Math.round(r.filter(y=>y.finalGrade!==void 0).reduce((y,C)=>y+C.finalGrade,0)/r.filter(y=>y.finalGrade!==void 0).length)||0}},[l]),V=n.useMemo(()=>{const r=l.filter(s=>s.presentations?.length),u=[0,1,2,3].map(s=>{const g=r.filter(C=>C.presentations?.[s]?.completed).length,y=r.length;return{index:s,name:s<3?`מצגת ${s+1}`:"מצגת ביצוע",completed:g,total:y,completionRate:y>0?Math.round(g/y*100):0}}),f=r.filter(s=>s.presentations?.[3]?.detailedGrading).map(s=>{const g=s.presentations[3].detailedGrading;return{bagrutId:s._id,studentId:s.studentId,playingSkills:g.playingSkills?.points||0,musicalUnderstanding:g.musicalUnderstanding?.points||0,textKnowledge:g.textKnowledge?.points||0,playingByHeart:g.playingByHeart?.points||0,total:(g.playingSkills?.points||0)+(g.musicalUnderstanding?.points||0)+(g.textKnowledge?.points||0)+(g.playingByHeart?.points||0)}}),c=f.length>0?{playingSkills:Math.round(f.reduce((s,g)=>s+g.playingSkills,0)/f.length),musicalUnderstanding:Math.round(f.reduce((s,g)=>s+g.musicalUnderstanding,0)/f.length),textKnowledge:Math.round(f.reduce((s,g)=>s+g.textKnowledge,0)/f.length),playingByHeart:Math.round(f.reduce((s,g)=>s+g.playingByHeart,0)/f.length),total:Math.round(f.reduce((s,g)=>s+g.total,0)/f.length)}:{playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:0,total:0};return{presentationStats:u,performancePresentations:f,averagePerformanceScores:c}},[l]),F=n.useMemo(()=>{const r=l.filter(c=>c.directorEvaluation?.points!==void 0).map(c=>({bagrutId:c._id,studentId:c.studentId,points:c.directorEvaluation.points,hasComments:!!c.directorEvaluation.comments?.trim()})),u=r.length>0?Math.round(r.reduce((c,s)=>c+s.points,0)/r.length):0,f=r.reduce((c,s)=>{const g=s.points;return g>=95?c.excellent++:g>=85?c.veryGood++:g>=75?c.good++:g>=65?c.almostGood++:g>=55?c.sufficient++:c.insufficient++,c},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{totalEvaluations:r.length,averageScore:u,scoreDistribution:f,withComments:r.filter(c=>c.hasComments).length,commentsRate:r.length>0?Math.round(r.filter(c=>c.hasComments).length/r.length*100):0}},[l]),m=n.useMemo(()=>{const r=l.filter(c=>c.recitalConfiguration?.units&&c.recitalConfiguration?.field).map(c=>({bagrutId:c._id,studentId:c.studentId,units:c.recitalConfiguration.units,field:c.recitalConfiguration.field})),u=r.reduce((c,s)=>(s.units===3?c.three++:s.units===5&&c.five++,c),{three:0,five:0}),f=r.reduce((c,s)=>(s.field==="קלאסי"?c.classical++:s.field==="ג'אז"?c.jazz++:s.field==="שירה"&&c.vocal++,c),{classical:0,jazz:0,vocal:0});return{totalConfigurations:r.length,unitDistribution:u,fieldDistribution:f,configurationRate:l.length>0?Math.round(r.length/l.length*100):0}},[l]),a=n.useMemo(()=>{const u=l.filter(s=>s.computedValues?.totalPerformancePoints!==void 0&&s.computedValues?.weightedFinalGrade!==void 0&&s.directorEvaluation?.points!==void 0).map(s=>{const g=s.computedValues.totalPerformancePoints,y=s.directorEvaluation.points,C=s.computedValues.weightedFinalGrade;return{bagrutId:s._id,studentId:s.studentId,performancePoints:g,performanceGrade:g,directorPoints:y,directorGrade:y,performanceContribution:C*.9,directorContribution:C*.1,finalGrade:C,gradeLevel:s.computedValues.gradeLevel}}),f=u.length>0?Math.round(u.reduce((s,g)=>s+g.performanceContribution,0)/u.length):0,c=u.length>0?Math.round(u.reduce((s,g)=>s+g.directorContribution,0)/u.length):0;return{totalCalculatedGrades:u.length,gradeBreakdown:u,averagePerformanceContribution:f,averageDirectorContribution:c,calculationRate:l.length>0?Math.round(u.length/l.length*100):0}},[l]),o=n.useMemo(()=>({byStatus:r=>{switch(r){case"completed":return l.filter(u=>u.isCompleted);case"inProgress":return l.filter(u=>!u.isCompleted&&u.isActive);case"inactive":return l.filter(u=>!u.isActive);default:return l}},byGradeRange:(r,u)=>l.filter(f=>f.finalGrade!==void 0&&f.finalGrade>=r&&f.finalGrade<=u),byRecitalUnits:r=>l.filter(u=>u.recitalConfiguration?.units===r),byRecitalField:r=>l.filter(u=>u.recitalConfiguration?.field===r),byCompletionPercentage:r=>l.filter(u=>{if(!u.computedValues?.completionStatus)return!1;const f=u.computedValues.completionStatus;return(f.presentations.filter(Boolean).length+(f.directorEvaluation?1:0)+(f.recitalConfig?1:0)+(f.program?1:0))/7*100>=r}),needingAttention:()=>{const r=new Date,u=new Date(r.getTime()-7*24*60*60*1e3);return l.filter(f=>{if(f.isCompleted||!f.isActive)return!1;const s=new Date(f.updatedAt)<u,g=f.computedValues?.completionStatus,y=g?g.presentations.filter(Boolean).length+(g.directorEvaluation?1:0)+(g.recitalConfig?1:0)+(g.program?1:0)<4:!0;return s||y})}}),[l]);return{currentBagrut:e,allBagruts:l,loading:w,error:I,validationErrors:P,getBagrutById:M,getCompletedPresentations:B,getTotalPerformancePoints:A,getWeightedFinalGrade:p,getCompletionStatus:L,bagrutStatistics:U,presentationAnalytics:V,directorEvaluationAnalytics:F,recitalConfigAnalytics:m,gradeCalculationInsights:a,filterBagruts:o}}function re(){let t,e;try{t=X(),e=Y(),console.log("🔗 Using BagrutContext for state management")}catch(d){console.log("⚠️ BagrutContext not available, falling back to local state:",d)}const[l,w]=n.useState(null),[I,P]=n.useState([]),[M,B]=n.useState(!1),[A,p]=n.useState(null),[L,U]=n.useState(null),V=e?.currentBagrut??l,F=e?.allBagruts??I,m=e?.loading??M,a=e?.error??A,o=n.useCallback(()=>{t?t.clearError():p(null)},[t]),r=n.useCallback(()=>{},[]),u=n.useCallback(async d=>{if(t)return t.fetchAllBagruts(d);B(!0),p(null);try{const i=await E.getAllBagruts(d||{});P(Array.isArray(i)?i:[]),U(null)}catch(i){const h=i instanceof Error?i.message:"שגיאה לא ידועה";p(h),console.error("Error fetching bagruts:",i)}finally{B(!1)}},[t]),f=n.useCallback(async d=>{if(t)return t.fetchBagrutById(d);B(!0),p(null);try{const i=await E.getBagrutById(d);w(i||null)}catch(i){const h=i instanceof Error?i.message:"שגיאה לא ידועה";p(h),console.error("Error fetching bagrut:",i)}finally{B(!1)}},[t]),c=n.useCallback(async d=>{if(t)return t.fetchBagrutByStudentId(d);B(!0),p(null);try{const i=await E.getBagrutByStudentId(d);w(i||null)}catch(i){const h=i instanceof Error?i.message:"שגיאה לא ידועה";p(h),console.error("Error fetching student bagrut:",i)}finally{B(!1)}},[t]),s=n.useCallback(async d=>{if(t)return t.createBagrut(d);B(!0),p(null);try{const i=await E.createBagrut(d);if(w(i||null),i){const h=await E.getAllBagruts({});P(Array.isArray(h)?h:[])}return i}catch(i){const h=i instanceof Error?i.message:"שגיאה לא ידועה";return p(h),console.error("Error creating bagrut:",i),null}finally{B(!1)}},[t]),g=n.useCallback(async(d,i)=>{if(t)return t.updateBagrut(d,i);B(!0),p(null);try{const h=await E.updateBagrut(d,i);return w(h||null),h}catch(h){const b=h instanceof Error?h.message:"שגיאה לא ידועה";return p(b),console.error("Error updating bagrut:",h),null}finally{B(!1)}},[t]),y=n.useCallback(async d=>(p("מחיקת בגרויות לא מושלמה עדיין"),!1),[]),C=n.useCallback(async(d,i,h)=>{if(t)return t.updatePresentation(d,i,h);B(!0),p(null);try{const b=await E.updatePresentation(d,i,h);return w(b||null),!0}catch(b){const Q=b instanceof Error?b.message:"שגיאה בעדכון המצגת";return p(Q),!1}finally{B(!1)}},[t]),k=n.useCallback(async(d,i)=>(p("עדכון מגן בגרות לא מושלם עדיין"),!1),[]),R=n.useCallback(async(d,i)=>{try{return p(null),await apiService.bagrutApi.updateGradingDetails(d,i),console.log(`✅ Updated grading details for bagrut: ${d}`),!0}catch(h){return console.error("❌ Error updating grading details:",h),p("שגיאה בעדכון פרטי הציונים"),!1}},[]),$=n.useCallback(async d=>{if(t)return t.calculateFinalGrade(d);B(!0),p(null);try{const i=await E.calculateFinalGrade(d);return w(i||null),!0}catch(i){const h=i instanceof Error?i.message:"שגיאה בחישוב הציון הסופי";return p(h),!1}finally{B(!1)}},[t]),D=n.useCallback(async(d,i)=>(p("השלמת בגרות לא מושלמת עדיין"),!1),[]),_=n.useCallback(async(d,i,h,b)=>(p("העלאת מסמכים לא מושלמת עדיין"),!1),[]),H=n.useCallback(async(d,i)=>(p("מחיקת מסמכים לא מושלמת עדיין"),!1),[]),K=n.useCallback(async(d,i)=>(p("הורדת מסמכים לא מושלמת עדיין"),null),[]),T=n.useCallback(async(d,i)=>(p("הוספת יצירות לא מושלמת עדיין"),!1),[]),W=n.useCallback(async(d,i)=>(p("עדכון תכנית לא מושלם עדיין"),!1),[]),j=n.useCallback(async(d,i)=>(p("מחיקת יצירות לא מושלמת עדיין"),!1),[]),z=n.useCallback(async(d,i)=>(p("הוספת מלווים לא מושלמת עדיין"),!1),[]),q=n.useCallback(async(d,i)=>(p("מחיקת מלווים לא מושלמת עדיין"),!1),[]),J=n.useCallback(async(d,i)=>{if(t)return t.updateDirectorEvaluation(d,i);B(!0),p(null);try{const h=await E.updateDirectorEvaluation(d,i);return w(h||null),!0}catch(h){const b=h instanceof Error?h.message:"שגיאה בעדכון הערכת המנהל";return p(b),!1}finally{B(!1)}},[t]),N=n.useCallback(async(d,i)=>{if(t)return t.setRecitalConfiguration(d,i);B(!0),p(null);try{const h=await E.setRecitalConfiguration(d,i);return w(h||null),!0}catch(h){const b=h instanceof Error?h.message:"שגיאה בהגדרת תצורת הרסיטל";return p(b),!1}finally{B(!1)}},[t]),O=n.useCallback(()=>E.getDefaultDetailedGrading(),[]);return{bagrut:V,bagruts:F,loading:m,error:a,pagination:L,fetchAllBagruts:u,fetchBagrutById:f,fetchBagrutByStudentId:c,createBagrut:s,updateBagrut:g,deleteBagrut:y,updatePresentation:C,updateMagenBagrut:k,updateGradingDetails:R,calculateFinalGrade:$,completeBagrut:D,uploadDocument:_,removeDocument:H,downloadDocument:K,addProgramPiece:T,updateProgram:W,removeProgramPiece:j,addAccompanist:z,removeAccompanist:q,updateDirectorEvaluation:J,setRecitalConfiguration:N,getDefaultDetailedGrading:O,clearError:o,refreshCache:r}}export{re as u};
