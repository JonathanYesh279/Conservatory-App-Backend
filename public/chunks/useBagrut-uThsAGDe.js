import{r as n}from"./vendor-B2j9q2e_.js";import{g as v}from"./cascade-deletion-DAN0Gkem.js";import{i as x,k as S}from"../assets/index-CVVLhZwk.js";const G="/bagrut",E={async getAllBagruts(t={}){try{console.log("ğŸŒ BagrutService: Fetching bagruts with params:",t);const e=await v.get(G,t);console.log("ğŸ“¨ BagrutService: Raw API response:",e),console.log("ğŸ“¨ BagrutService: Response type:",typeof e),console.log("ğŸ“¨ BagrutService: Is array?",Array.isArray(e));let l=[];return Array.isArray(e)?l=e:e&&(console.warn("Unexpected response format (expected array):",e),l=[]),console.log("âœ… BagrutService: Returning bagruts:",l.length,"items"),l}catch(e){throw console.error("âŒ BagrutService: Error fetching bagruts:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×‘×’×¨×•×™×•×ª")}},async getBagrutById(t){try{console.log("ğŸ” BagrutService: Fetching bagrut by ID:",t);const e=await v.get(`${G}/${t}`);return console.log("ğŸ“¦ BagrutService: getBagrutById response:",e),e}catch(e){throw console.error("Error fetching bagrut:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª")}},async getBagrutByStudentId(t){try{console.log("ğŸ” BagrutService: Fetching bagrut by student ID:",t);const e=await v.get(`${G}/student/${t}`);return console.log("ğŸ“¦ BagrutService: getBagrutByStudentId response:",e),e}catch(e){throw console.error("Error fetching student bagrut:",e),new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª ×”×ª×œ××™×“")}},async createBagrut(t){try{this.validateBagrutData(t);const e=await v.post(G,t);if(console.log("ğŸ“ Create Bagrut Response:",e),e&&e._id)return e;throw console.error("Unexpected response format:",e),new Error("×ª×’×•×‘×” ×œ× ×¦×¤×•×™×” ××”×©×¨×ª")}catch(e){throw console.error("Error creating bagrut:",e),e instanceof Error?e:new Error("×©×’×™××” ×‘×™×¦×™×¨×ª ×‘×’×¨×•×ª ×—×“×©×”")}},async updateBagrut(t,e){try{return this.validateUpdateData(e),await v.put(`${G}/${t}`,e)}catch(l){throw console.error("Error updating bagrut:",l),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×‘×’×¨×•×ª")}},async updateBagrutProgram(t,e){try{return await v.put(`${G}/${t}/program`,{program:e})}catch(l){throw console.error("Error updating bagrut program:",l),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×ª×›× ×™×ª ×”×‘×’×¨×•×ª")}},async updatePresentation(t,e,l){try{return this.validatePresentationData(l),await v.put(`${G}/${t}/presentation/${e}`,l)}catch(w){throw console.error("Error updating presentation:",w),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××¦×’×ª")}},async updateDirectorEvaluation(t,e){try{return this.validateDirectorEvaluation(e),await v.put(`${G}/${t}/director-evaluation`,e)}catch(l){throw console.error("Error updating director evaluation:",l),new Error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×”×× ×”×œ")}},async setRecitalConfiguration(t,e){try{return this.validateRecitalConfiguration(e),await v.put(`${G}/${t}/recital-config`,e)}catch(l){throw console.error("Error setting recital configuration:",l),new Error("×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×”×¨×¡×™×˜×œ")}},async calculateFinalGrade(t){try{return await v.post(`${G}/${t}/calculate-grade`)}catch(e){throw console.error("Error calculating final grade:",e),new Error("×©×’×™××” ×‘×—×™×©×•×‘ ×”×¦×™×•×Ÿ ×”×¡×•×¤×™")}},getDefaultDetailedGrading(){return{playingSkills:{points:0,maxPoints:40,comments:""},musicalUnderstanding:{points:0,maxPoints:30,comments:""},textKnowledge:{points:0,maxPoints:20,comments:""},playingByHeart:{points:0,maxPoints:10,comments:""}}},validateBagrutData(t){if(!t.studentId)throw new Error("××–×”×” ×ª×œ××™×“ × ×“×¨×©");if(!t.teacherId)throw new Error("××–×”×” ××•×¨×” × ×“×¨×©");if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(t.recitalField&&!["×§×œ××¡×™","×’'××–","×©×™×¨×”","××•×¡×™×§×” ×™×©×¨××œ×™×ª","××•×¡×™×§×” ×¢×•×œ××™×ª"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×œ× ×ª×§×™×Ÿ")},validateUpdateData(t){if(t.recitalUnits&&![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(t.recitalField&&!["×§×œ××¡×™","×’'××–","×©×™×¨×”","××•×¡×™×§×” ×™×©×¨××œ×™×ª","××•×¡×™×§×” ×¢×•×œ××™×ª"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×œ× ×ª×§×™×Ÿ")},validatePresentationData(t){if(t.detailedGrading){const e=t.detailedGrading;if(e.playingSkills?.points>40)throw new Error("×›×™×©×•×¨×™ × ×’×™× ×” ×œ× ×™×›×•×œ×™× ×œ×¢×œ×•×ª ×¢×œ 40 × ×§×•×“×•×ª");if(e.musicalUnderstanding?.points>30)throw new Error("×”×‘× ×” ××•×–×™×§×œ×™×ª ×œ× ×™×›×•×œ×” ×œ×¢×œ×•×ª ×¢×œ 30 × ×§×•×“×•×ª");if(e.textKnowledge?.points>20)throw new Error("×™×“×¢ ×‘×˜×§×¡×˜ ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 20 × ×§×•×“×•×ª");if(e.playingByHeart?.points>10)throw new Error("× ×’×™× ×” ×‘×¢×œ ×¤×” ×œ× ×™×›×•×œ×” ×œ×¢×œ×•×ª ×¢×œ 10 × ×§×•×“×•×ª");if((e.playingSkills?.points||0)+(e.musicalUnderstanding?.points||0)+(e.textKnowledge?.points||0)+(e.playingByHeart?.points||0)>100)throw new Error("×¡×š ×›×œ ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100")}},validateDirectorEvaluation(t){if(typeof t.points!="number")throw new Error("× ×§×•×“×•×ª ×”×× ×”×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª ××¡×¤×¨");if(t.points<0||t.points>100)throw new Error("× ×§×•×“×•×ª ×”×× ×”×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-100")},validateRecitalConfiguration(t){if(![3,5].includes(t.recitalUnits))throw new Error("××¡×¤×¨ ×™×—×™×“×•×ª ×—×™×™×‘ ×œ×”×™×•×ª 3 ××• 5");if(!["×§×œ××¡×™","×’'××–","×©×™×¨×”"].includes(t.recitalField))throw new Error("×ª×—×•× ×”×¨×¡×™×˜×œ ×—×™×™×‘ ×œ×”×™×•×ª ×§×œ××¡×™, ×’'××– ××• ×©×™×¨×”")}};function X(){const{state:t,actions:e}=x(),l=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸ” Fetching bagruts with params:",m);const a=await E.getAllBagruts(m||{});console.log("ğŸ“‹ Raw bagruts from service:",a);const o=Array.isArray(a)?a:[];console.log("âœ… Setting bagruts in context:",o.length,"items"),e.setBagruts(o),setTimeout(()=>{console.log("ğŸ” Context state after setBagruts:",t.bagruts?.length||0)},100)}catch(a){console.error("âŒ Error fetching bagruts:",a);const o=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×™×•×ª";e.setError(o)}finally{e.setLoading(!1)}},[e,t.bagruts]),w=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸ” fetchBagrutById: Fetching bagrut with ID:",m);const a=await E.getBagrutById(m);console.log("âœ… fetchBagrutById: Bagrut fetched successfully:",a),e.setCurrentBagrut(a),console.log("âœ… fetchBagrutById: CurrentBagrut set in context")}catch(a){console.error("âŒ fetchBagrutById: Error:",a);const o=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª";e.setError(o)}finally{e.setLoading(!1)}},[e]),I=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{const a=await E.getBagrutByStudentId(m);e.setCurrentBagrut(a),a?._id&&e.recalculateGrade(a._id)}catch(a){const o=a instanceof Error?a.message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×‘×’×¨×•×ª ×”×ª×œ××™×“";e.setError(o)}finally{e.setLoading(!1)}},[e]),P=n.useCallback(async m=>{e.setLoading(!0),e.clearValidationErrors();try{console.log("ğŸš€ Creating bagrut with data:",m);const a=await E.createBagrut(m);return console.log("âœ… Bagrut created successfully:",a),a&&(a._id||a.id)?(e.setCurrentBagrut(a),await l(),console.log("âœ… Context updated with new bagrut"),a):(console.error("âŒ Invalid bagrut object returned:",a),e.setError("×‘×’×¨×•×ª × ×•×¦×¨×” ××š ×œ× × ×™×ª×Ÿ ×”×™×” ×œ×˜×¢×•×Ÿ ××•×ª×”"),null)}catch(a){console.error("âŒ Error in createBagrut:",a);const o=a instanceof Error?a.message:"×©×’×™××” ×‘×™×¦×™×¨×ª ×‘×’×¨×•×ª";return e.setError(o),null}finally{e.setLoading(!1)}},[e,l]),M=n.useCallback(async(m,a)=>{e.setLoading(!0),e.clearValidationErrors();try{const o=await E.updateBagrut(m,a);return o?(e.setCurrentBagrut(o),e.recalculateGrade(m),o):null}catch(o){const r=o instanceof Error?o.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×‘×’×¨×•×ª";return e.setError(r),null}finally{e.setLoading(!1)}},[e]),B=n.useCallback(async(m,a,o)=>{if(a<3&&t.currentBagrut&&!e.validateSequentialPresentation(a,t.currentBagrut.presentations||[])||a===3&&o.detailedGrading&&!e.validatePointTotal(o.detailedGrading))return!1;e.setLoading(!0);try{return await E.updatePresentation(m,a,o)?(e.updatePresentation(m,a,o),!0):!1}catch(r){const u=r instanceof Error?r.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ××¦×’×ª";return e.setError(u),!1}finally{e.setLoading(!1)}},[e,t.currentBagrut]),A=n.useCallback(async(m,a)=>{if(a.points<0||a.points>100)return e.setValidationError("directorEvaluation","×”×¢×¨×›×ª ×× ×”×œ ×—×™×™×‘×ª ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-100"),!1;e.setLoading(!0);try{return await E.updateDirectorEvaluation(m,a)?(e.updateDirectorEvaluation(m,{points:a.points,percentage:a.points/100*100,comments:a.comments}),!0):!1}catch(o){const r=o instanceof Error?o.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×× ×”×œ";return e.setError(r),!1}finally{e.setLoading(!1)}},[e]),p=n.useCallback(async(m,a)=>{if(a.recitalUnits!==3&&a.recitalUnits!==5)return e.setValidationError("recitalUnits","×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5"),!1;if(!["×§×œ××¡×™","×’'××–","×©×™×¨×”"].includes(a.recitalField))return e.setValidationError("recitalField","×ª×—×•× ×¨×¡×™×˜×œ ×œ× ×—×•×§×™"),!1;e.setLoading(!0);try{return await E.setRecitalConfiguration(m,a)?(e.updateRecitalConfig(m,a),!0):!1}catch(r){const u=r instanceof Error?r.message:"×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×¨×¡×™×˜×œ";return e.setError(u),!1}finally{e.setLoading(!1)}},[e]),L=n.useCallback(async m=>{e.setLoading(!0);try{e.recalculateGrade(m);const a=await E.calculateFinalGrade(m);return a?(e.setCurrentBagrut(a),!0):!1}catch(a){const o=a instanceof Error?a.message:"×©×’×™××” ×‘×—×™×©×•×‘ ×¦×™×•×Ÿ ×¡×•×¤×™";return e.setError(o),!1}finally{e.setLoading(!1)}},[e]),U=n.useCallback(async(m,a)=>{if(!a.pieceTitle?.trim()||!a.composer?.trim()||!a.duration?.trim())return e.setValidationError("programPiece","× ×“×¨×©×™× ×›×•×ª×¨×ª ×™×¦×™×¨×”, ××œ×—×™×Ÿ ×•××©×š ×–××Ÿ"),!1;e.setLoading(!0);try{return await E.addProgramPiece(m,a)?(await w(m),!0):!1}catch(o){const r=o instanceof Error?o.message:"×©×’×™××” ×‘×”×•×¡×¤×ª ×™×¦×™×¨×”";return e.setError(r),!1}finally{e.setLoading(!1)}},[e,w]),V=n.useCallback(m=>{const a=t.bagruts.find(r=>r._id===m)||t.currentBagrut;if(!a)return!1;const o=[];a.program?.length||o.push("× ×“×¨×©×ª ×œ×¤×—×•×ª ×™×¦×™×¨×” ××—×ª ×‘×ª×›× ×™×ª");for(let r=0;r<3;r++)a.presentations?.[r]?.completed||o.push(`××¦×’×ª ${r+1} ×œ× ×”×•×©×œ××”`);if(!a.presentations?.[3]?.detailedGrading)o.push("××¦×’×ª ×‘×™×¦×•×¢ ×œ× ×”×•×©×œ××”");else{const r=a.presentations[3].detailedGrading;(r.playingSkills?.points||0)+(r.musicalUnderstanding?.points||0)+(r.textKnowledge?.points||0)+(r.playingByHeart?.points||0)===0&&o.push("× ×“×¨×© ×¦×™×•×Ÿ ×‘×™×¦×•×¢")}return a.directorEvaluation?.points||o.push("× ×“×¨×©×ª ×”×¢×¨×›×ª ×× ×”×œ"),(!a.recitalConfiguration?.units||!a.recitalConfiguration?.field)&&o.push("× ×“×¨×©×ª ×”×’×“×¨×ª ×ª×¦×•×¨×ª ×¨×¡×™×˜×œ"),o.length>0?(e.setValidationError("completion",o.join(", ")),!1):(e.clearValidationErrors(),!0)},[t.bagruts,t.currentBagrut,e]),F=n.useCallback(m=>{const a=t.bagruts.find(f=>f._id===m)||t.currentBagrut;if(!a)return null;const o=a.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1},r=7,u=o.presentations.filter(Boolean).length+(o.directorEvaluation?1:0)+(o.recitalConfig?1:0)+(o.program?1:0);return{completedSteps:u,totalSteps:r,percentageComplete:Math.round(u/r*100),isComplete:u===r,missingSteps:[...o.presentations.map((f,c)=>f?null:`××¦×’×ª ${c+1}`).filter(Boolean),o.directorEvaluation?null:"×”×¢×¨×›×ª ×× ×”×œ",o.recitalConfig?null:"×ª×¦×•×¨×ª ×¨×¡×™×˜×œ",o.program?null:"×ª×›× ×™×ª"].filter(Boolean)}},[t.bagruts,t.currentBagrut]);return{state:t,fetchAllBagruts:l,fetchBagrutById:w,fetchBagrutByStudentId:I,createBagrut:P,updateBagrut:M,updatePresentation:B,updateDirectorEvaluation:A,setRecitalConfiguration:p,calculateFinalGrade:L,addProgramPiece:U,validateBagrutCompletion:V,getValidationSummary:F,clearError:()=>e.setError(null),clearValidationErrors:e.clearValidationErrors,recalculateGrade:e.recalculateGrade}}function Y(){const{state:t}=x(),e=n.useMemo(()=>S.getCurrentBagrut(t),[t]),l=n.useMemo(()=>{const r=S.getAllBagruts(t);return console.log("ğŸ” useBagrutSelectors: allBagruts selector:",r?.length||0,"items"),console.log("ğŸ” Raw state.bagruts:",t.bagruts?.length||0,"items"),r},[t]),w=n.useMemo(()=>S.getLoadingState(t),[t]),I=n.useMemo(()=>S.getError(t),[t]),P=n.useMemo(()=>S.getValidationErrors(t),[t]),M=n.useMemo(()=>r=>S.getBagrutById(t,r),[t]),B=n.useMemo(()=>r=>S.getCompletedPresentations(t,r),[t]),A=n.useMemo(()=>r=>S.getTotalPerformancePoints(t,r),[t]),p=n.useMemo(()=>r=>S.getWeightedFinalGrade(t,r),[t]),L=n.useMemo(()=>r=>S.getCompletionStatus(t,r),[t]),U=n.useMemo(()=>{const r=l,u=r.length,f=r.filter(y=>y.isCompleted).length,c=r.filter(y=>!y.isCompleted&&y.isActive).length,s=r.filter(y=>!y.isActive).length,g=r.filter(y=>y.finalGrade!==void 0).reduce((y,C)=>{const k=C.finalGrade;return k>=95?y.excellent++:k>=85?y.veryGood++:k>=75?y.good++:k>=65?y.almostGood++:k>=55?y.sufficient++:y.insufficient++,y},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{total:u,completed:f,inProgress:c,inactive:s,completionRate:u>0?Math.round(f/u*100):0,gradeDistribution:g,averageGrade:r.length>0&&Math.round(r.filter(y=>y.finalGrade!==void 0).reduce((y,C)=>y+C.finalGrade,0)/r.filter(y=>y.finalGrade!==void 0).length)||0}},[l]),V=n.useMemo(()=>{const r=l.filter(s=>s.presentations?.length),u=[0,1,2,3].map(s=>{const g=r.filter(C=>C.presentations?.[s]?.completed).length,y=r.length;return{index:s,name:s<3?`××¦×’×ª ${s+1}`:"××¦×’×ª ×‘×™×¦×•×¢",completed:g,total:y,completionRate:y>0?Math.round(g/y*100):0}}),f=r.filter(s=>s.presentations?.[3]?.detailedGrading).map(s=>{const g=s.presentations[3].detailedGrading;return{bagrutId:s._id,studentId:s.studentId,playingSkills:g.playingSkills?.points||0,musicalUnderstanding:g.musicalUnderstanding?.points||0,textKnowledge:g.textKnowledge?.points||0,playingByHeart:g.playingByHeart?.points||0,total:(g.playingSkills?.points||0)+(g.musicalUnderstanding?.points||0)+(g.textKnowledge?.points||0)+(g.playingByHeart?.points||0)}}),c=f.length>0?{playingSkills:Math.round(f.reduce((s,g)=>s+g.playingSkills,0)/f.length),musicalUnderstanding:Math.round(f.reduce((s,g)=>s+g.musicalUnderstanding,0)/f.length),textKnowledge:Math.round(f.reduce((s,g)=>s+g.textKnowledge,0)/f.length),playingByHeart:Math.round(f.reduce((s,g)=>s+g.playingByHeart,0)/f.length),total:Math.round(f.reduce((s,g)=>s+g.total,0)/f.length)}:{playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:0,total:0};return{presentationStats:u,performancePresentations:f,averagePerformanceScores:c}},[l]),F=n.useMemo(()=>{const r=l.filter(c=>c.directorEvaluation?.points!==void 0).map(c=>({bagrutId:c._id,studentId:c.studentId,points:c.directorEvaluation.points,hasComments:!!c.directorEvaluation.comments?.trim()})),u=r.length>0?Math.round(r.reduce((c,s)=>c+s.points,0)/r.length):0,f=r.reduce((c,s)=>{const g=s.points;return g>=95?c.excellent++:g>=85?c.veryGood++:g>=75?c.good++:g>=65?c.almostGood++:g>=55?c.sufficient++:c.insufficient++,c},{excellent:0,veryGood:0,good:0,almostGood:0,sufficient:0,insufficient:0});return{totalEvaluations:r.length,averageScore:u,scoreDistribution:f,withComments:r.filter(c=>c.hasComments).length,commentsRate:r.length>0?Math.round(r.filter(c=>c.hasComments).length/r.length*100):0}},[l]),m=n.useMemo(()=>{const r=l.filter(c=>c.recitalConfiguration?.units&&c.recitalConfiguration?.field).map(c=>({bagrutId:c._id,studentId:c.studentId,units:c.recitalConfiguration.units,field:c.recitalConfiguration.field})),u=r.reduce((c,s)=>(s.units===3?c.three++:s.units===5&&c.five++,c),{three:0,five:0}),f=r.reduce((c,s)=>(s.field==="×§×œ××¡×™"?c.classical++:s.field==="×’'××–"?c.jazz++:s.field==="×©×™×¨×”"&&c.vocal++,c),{classical:0,jazz:0,vocal:0});return{totalConfigurations:r.length,unitDistribution:u,fieldDistribution:f,configurationRate:l.length>0?Math.round(r.length/l.length*100):0}},[l]),a=n.useMemo(()=>{const u=l.filter(s=>s.computedValues?.totalPerformancePoints!==void 0&&s.computedValues?.weightedFinalGrade!==void 0&&s.directorEvaluation?.points!==void 0).map(s=>{const g=s.computedValues.totalPerformancePoints,y=s.directorEvaluation.points,C=s.computedValues.weightedFinalGrade;return{bagrutId:s._id,studentId:s.studentId,performancePoints:g,performanceGrade:g,directorPoints:y,directorGrade:y,performanceContribution:C*.9,directorContribution:C*.1,finalGrade:C,gradeLevel:s.computedValues.gradeLevel}}),f=u.length>0?Math.round(u.reduce((s,g)=>s+g.performanceContribution,0)/u.length):0,c=u.length>0?Math.round(u.reduce((s,g)=>s+g.directorContribution,0)/u.length):0;return{totalCalculatedGrades:u.length,gradeBreakdown:u,averagePerformanceContribution:f,averageDirectorContribution:c,calculationRate:l.length>0?Math.round(u.length/l.length*100):0}},[l]),o=n.useMemo(()=>({byStatus:r=>{switch(r){case"completed":return l.filter(u=>u.isCompleted);case"inProgress":return l.filter(u=>!u.isCompleted&&u.isActive);case"inactive":return l.filter(u=>!u.isActive);default:return l}},byGradeRange:(r,u)=>l.filter(f=>f.finalGrade!==void 0&&f.finalGrade>=r&&f.finalGrade<=u),byRecitalUnits:r=>l.filter(u=>u.recitalConfiguration?.units===r),byRecitalField:r=>l.filter(u=>u.recitalConfiguration?.field===r),byCompletionPercentage:r=>l.filter(u=>{if(!u.computedValues?.completionStatus)return!1;const f=u.computedValues.completionStatus;return(f.presentations.filter(Boolean).length+(f.directorEvaluation?1:0)+(f.recitalConfig?1:0)+(f.program?1:0))/7*100>=r}),needingAttention:()=>{const r=new Date,u=new Date(r.getTime()-7*24*60*60*1e3);return l.filter(f=>{if(f.isCompleted||!f.isActive)return!1;const s=new Date(f.updatedAt)<u,g=f.computedValues?.completionStatus,y=g?g.presentations.filter(Boolean).length+(g.directorEvaluation?1:0)+(g.recitalConfig?1:0)+(g.program?1:0)<4:!0;return s||y})}}),[l]);return{currentBagrut:e,allBagruts:l,loading:w,error:I,validationErrors:P,getBagrutById:M,getCompletedPresentations:B,getTotalPerformancePoints:A,getWeightedFinalGrade:p,getCompletionStatus:L,bagrutStatistics:U,presentationAnalytics:V,directorEvaluationAnalytics:F,recitalConfigAnalytics:m,gradeCalculationInsights:a,filterBagruts:o}}function re(){let t,e;try{t=X(),e=Y(),console.log("ğŸ”— Using BagrutContext for state management")}catch(d){console.log("âš ï¸ BagrutContext not available, falling back to local state:",d)}const[l,w]=n.useState(null),[I,P]=n.useState([]),[M,B]=n.useState(!1),[A,p]=n.useState(null),[L,U]=n.useState(null),V=e?.currentBagrut??l,F=e?.allBagruts??I,m=e?.loading??M,a=e?.error??A,o=n.useCallback(()=>{t?t.clearError():p(null)},[t]),r=n.useCallback(()=>{},[]),u=n.useCallback(async d=>{if(t)return t.fetchAllBagruts(d);B(!0),p(null);try{const i=await E.getAllBagruts(d||{});P(Array.isArray(i)?i:[]),U(null)}catch(i){const h=i instanceof Error?i.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";p(h),console.error("Error fetching bagruts:",i)}finally{B(!1)}},[t]),f=n.useCallback(async d=>{if(t)return t.fetchBagrutById(d);B(!0),p(null);try{const i=await E.getBagrutById(d);w(i||null)}catch(i){const h=i instanceof Error?i.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";p(h),console.error("Error fetching bagrut:",i)}finally{B(!1)}},[t]),c=n.useCallback(async d=>{if(t)return t.fetchBagrutByStudentId(d);B(!0),p(null);try{const i=await E.getBagrutByStudentId(d);w(i||null)}catch(i){const h=i instanceof Error?i.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";p(h),console.error("Error fetching student bagrut:",i)}finally{B(!1)}},[t]),s=n.useCallback(async d=>{if(t)return t.createBagrut(d);B(!0),p(null);try{const i=await E.createBagrut(d);if(w(i||null),i){const h=await E.getAllBagruts({});P(Array.isArray(h)?h:[])}return i}catch(i){const h=i instanceof Error?i.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";return p(h),console.error("Error creating bagrut:",i),null}finally{B(!1)}},[t]),g=n.useCallback(async(d,i)=>{if(t)return t.updateBagrut(d,i);B(!0),p(null);try{const h=await E.updateBagrut(d,i);return w(h||null),h}catch(h){const b=h instanceof Error?h.message:"×©×’×™××” ×œ× ×™×“×•×¢×”";return p(b),console.error("Error updating bagrut:",h),null}finally{B(!1)}},[t]),y=n.useCallback(async d=>(p("××—×™×§×ª ×‘×’×¨×•×™×•×ª ×œ× ××•×©×œ××” ×¢×“×™×™×Ÿ"),!1),[]),C=n.useCallback(async(d,i,h)=>{if(t)return t.updatePresentation(d,i,h);B(!0),p(null);try{const b=await E.updatePresentation(d,i,h);return w(b||null),!0}catch(b){const Q=b instanceof Error?b.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××¦×’×ª";return p(Q),!1}finally{B(!1)}},[t]),k=n.useCallback(async(d,i)=>(p("×¢×“×›×•×Ÿ ××’×Ÿ ×‘×’×¨×•×ª ×œ× ××•×©×œ× ×¢×“×™×™×Ÿ"),!1),[]),R=n.useCallback(async(d,i)=>{try{return p(null),await apiService.bagrutApi.updateGradingDetails(d,i),console.log(`âœ… Updated grading details for bagrut: ${d}`),!0}catch(h){return console.error("âŒ Error updating grading details:",h),p("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¤×¨×˜×™ ×”×¦×™×•× ×™×"),!1}},[]),$=n.useCallback(async d=>{if(t)return t.calculateFinalGrade(d);B(!0),p(null);try{const i=await E.calculateFinalGrade(d);return w(i||null),!0}catch(i){const h=i instanceof Error?i.message:"×©×’×™××” ×‘×—×™×©×•×‘ ×”×¦×™×•×Ÿ ×”×¡×•×¤×™";return p(h),!1}finally{B(!1)}},[t]),D=n.useCallback(async(d,i)=>(p("×”×©×œ××ª ×‘×’×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),_=n.useCallback(async(d,i,h,b)=>(p("×”×¢×œ××ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),H=n.useCallback(async(d,i)=>(p("××—×™×§×ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),K=n.useCallback(async(d,i)=>(p("×”×•×¨×“×ª ××¡××›×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),null),[]),T=n.useCallback(async(d,i)=>(p("×”×•×¡×¤×ª ×™×¦×™×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),W=n.useCallback(async(d,i)=>(p("×¢×“×›×•×Ÿ ×ª×›× ×™×ª ×œ× ××•×©×œ× ×¢×“×™×™×Ÿ"),!1),[]),j=n.useCallback(async(d,i)=>(p("××—×™×§×ª ×™×¦×™×¨×•×ª ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),z=n.useCallback(async(d,i)=>(p("×”×•×¡×¤×ª ××œ×•×•×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),q=n.useCallback(async(d,i)=>(p("××—×™×§×ª ××œ×•×•×™× ×œ× ××•×©×œ××ª ×¢×“×™×™×Ÿ"),!1),[]),J=n.useCallback(async(d,i)=>{if(t)return t.updateDirectorEvaluation(d,i);B(!0),p(null);try{const h=await E.updateDirectorEvaluation(d,i);return w(h||null),!0}catch(h){const b=h instanceof Error?h.message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×›×ª ×”×× ×”×œ";return p(b),!1}finally{B(!1)}},[t]),N=n.useCallback(async(d,i)=>{if(t)return t.setRecitalConfiguration(d,i);B(!0),p(null);try{const h=await E.setRecitalConfiguration(d,i);return w(h||null),!0}catch(h){const b=h instanceof Error?h.message:"×©×’×™××” ×‘×”×’×“×¨×ª ×ª×¦×•×¨×ª ×”×¨×¡×™×˜×œ";return p(b),!1}finally{B(!1)}},[t]),O=n.useCallback(()=>E.getDefaultDetailedGrading(),[]);return{bagrut:V,bagruts:F,loading:m,error:a,pagination:L,fetchAllBagruts:u,fetchBagrutById:f,fetchBagrutByStudentId:c,createBagrut:s,updateBagrut:g,deleteBagrut:y,updatePresentation:C,updateMagenBagrut:k,updateGradingDetails:R,calculateFinalGrade:$,completeBagrut:D,uploadDocument:_,removeDocument:H,downloadDocument:K,addProgramPiece:T,updateProgram:W,removeProgramPiece:j,addAccompanist:z,removeAccompanist:q,updateDirectorEvaluation:J,setRecitalConfiguration:N,getDefaultDetailedGrading:O,clearError:o,refreshCache:r}}export{re as u};
