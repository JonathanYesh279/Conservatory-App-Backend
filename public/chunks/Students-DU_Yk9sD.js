import{j as e,u as hs}from"../assets/index-BAwpfw4Y.js";import{r as o,b as gs}from"./vendor-E-WBaSU9.js";import{C as re}from"./Card-Cf_Ok3Ft.js";import{S as We,T as us}from"./Table-CRtO5CqB.js";import{C as _e}from"./ConfirmationModal-FX2Cuwnj.js";import{T as ne,C as Ie,i as Ke,j as qe,X as le,k as Fe,e as ge,f as te,B as Qe,a as Ze,P as Oe,l as ae,F as Je,m as Re,n as ps,U as Ce,o as fs,p as Be,q as Ue,r as pe,s as ue,D as fe,t as ys,u as bs,E as js,v as Ns,S as vs,w as ws,x as Ss}from"./ui-BeR0qYie.js";import{a as M,c as ye,u as Is}from"./cascade-deletion-C-2LBfWA.js";import"./query-CMzvnXZ6.js";import"./utils-x1PSU_OZ.js";const Cs=({student:y,showInstruments:h=!0,showTeacherAssignments:B=!0,showParentContact:E=!1,onClick:c,onDelete:m,className:d="",isSelectMode:$=!1,isSelected:L=!1,onSelectionChange:T})=>{const N=y.academicInfo.instrumentProgress?.find(b=>b.isPrimary)||y.academicInfo.instrumentProgress?.[0],u=b=>({1:"bg-gray-100 text-gray-800",2:"bg-blue-100 text-blue-800",3:"bg-green-100 text-green-800",4:"bg-yellow-100 text-yellow-800",5:"bg-orange-100 text-orange-800",6:"bg-red-100 text-red-800",7:"bg-purple-100 text-purple-800",8:"bg-indigo-100 text-indigo-800"})[b]||"bg-gray-100 text-gray-800",v=b=>b.split(" ").map(_=>_[0]).join("").slice(0,2),J=b=>({1:"bg-gray-500",2:"bg-blue-500",3:"bg-green-500",4:"bg-yellow-500",5:"bg-orange-500",6:"bg-red-500",7:"bg-purple-500",8:"bg-indigo-500"})[b]||"bg-gray-500",[D,p]=o.useState(!1),C=b=>{b.stopPropagation(),p(!0)},Y=()=>{m&&m(y._id),p(!1)},X=()=>{p(!1)},z=b=>{b.stopPropagation(),T&&T(y._id,b.target.checked)};return e.jsxs(re,{className:`relative transition-all duration-200 hover:shadow-md ${c?"cursor-pointer hover:shadow-lg":""} ${L?"ring-2 ring-blue-500 bg-blue-50":""} ${d}`,onClick:c,padding:"md",children:[$&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("input",{type:"checkbox",checked:L,onChange:z,className:"w-4 h-4 text-blue-600 bg-white border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})}),e.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[e.jsx("div",{className:`
          w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm
          ${N?J(N.currentStage):"bg-gray-500"}
        `,children:v(y.personalInfo.fullName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-lg font-semibold truncate ${L?"text-blue-900":"text-gray-900"} ${$?"ml-6":""}`,children:y.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[m&&e.jsx("button",{onClick:C,className:"p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"×ž×—×§ ×ª×œ×ž×™×“",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("div",{className:`w-3 h-3 rounded-full ${y.isActive?"bg-green-400":"bg-gray-300"}`}),e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["×›×™×ª×” ",y.academicInfo.class]})]})]}),h&&N&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×›×œ×™ ×¨××©×™:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.instrumentName}),e.jsxs("span",{className:`
                  inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                  ${u(N.currentStage)}
                `,children:["×©×œ×‘ ",N.currentStage]})]})}),B&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsxs("span",{children:[y.teacherAssignments?.length||0," ×©×™×¢×•×¨×™× ×©×‘×•×¢×™×™×"]})]})}),h&&y.academicInfo.instrumentProgress&&y.academicInfo.instrumentProgress.length>1&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"×›×œ×™× × ×•×¡×¤×™×:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:y.academicInfo.instrumentProgress.filter(b=>!b.isPrimary).map((b,_)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:[b.instrumentName," (×©×œ×‘ ",b.currentStage,")"]},_))})]}),E&&y.personalInfo.parentName&&e.jsxs("div",{className:"border-t border-gray-100 pt-3 mt-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"×¤×¨×˜×™ ×”×•×¨×”:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(Ke,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:y.personalInfo.parentName})]}),y.personalInfo.parentPhone&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(qe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:y.personalInfo.parentPhone})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(qe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600 font-mono",dir:"ltr",children:y.personalInfo.phone})]})})]})]}),e.jsx(_e,{isOpen:D,title:"×ž×—×™×§×ª ×ª×œ×ž×™×“",message:`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ×”×ª×œ×ž×™×“ ${y.personalInfo.fullName}? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`,confirmText:"×ž×—×§",cancelText:"×‘×™×˜×•×œ",onConfirm:Y,onCancel:X,variant:"danger"})]})},ks=Cs,Ts=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨"],Ds=[1,2,3,4,5,6,7,8],$s=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•×ž×‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","×’×™×˜×¨×” ×‘×¡","×ª×•×¤×™×"],Ls=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—×ž×™×©×™","×©×™×©×™"],Ps=[30,45,60],Xe=["×œ× × ×‘×—×Ÿ","×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”"],As=({initialData:y,onSubmit:h,onCancel:B,isEdit:E=!1})=>{const[c,m]=o.useState({personalInfo:{fullName:"",phone:"",age:null,address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[{instrumentName:"",isPrimary:!0,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}],class:"×",tests:{bagrutId:null}},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,...y}),[d,$]=o.useState({}),[L,T]=o.useState(!1),[N,u]=o.useState({personal:!0,academic:!0,instruments:!0,teachers:!0,enrollments:!1}),[v,J]=o.useState([]),[D,p]=o.useState([]),[C,Y]=o.useState([]),[X,z]=o.useState([]),[b,_]=o.useState(""),[x,P]=o.useState(!1);o.useState([]);const[f,I]=o.useState({duration:null,selectedDays:[],startTime:"",endTime:""}),[F,V]=o.useState(!0);o.useEffect(()=>{const s=async()=>{try{const i=await M.teachers.getTeachers();J(i)}catch(i){console.error("Error fetching teachers:",i)}},r=async()=>{try{const i=await M.orchestras.getOrchestras();console.log("Fetched orchestras:",i);const g=await Promise.all((i||[]).map(async w=>{if(w.rehearsalIds&&w.rehearsalIds.length>0)try{const A=await M.rehearsals.getRehearsalById(w.rehearsalIds[0]);return{...w,rehearsalSchedule:A?{day:A.day||A.dayOfWeek,startTime:A.startTime,endTime:A.endTime,location:A.location||w.location}:null}}catch{return console.log("Could not fetch rehearsal for orchestra:",w.name),w}return w}));Y(g)}catch(i){console.error("Error fetching orchestras:",i),Y([])}},a=async()=>{try{const i=await M.theory.getTheoryLessons();console.log("Fetched theory lessons:",i),z(i||[])}catch(i){console.error("Error fetching theory lessons:",i),z([])}};s(),r(),a()},[]),o.useEffect(()=>{b&&(K(b),V(!0))},[b]);const K=async s=>{P(!0);try{const r=await M.teachers.getTeacherById(s);console.log("Teacher data for slots:",r);const a=r.teaching?.timeBlocks?.filter(g=>g.isActive!==!1)||[];console.log("Time blocks found:",a);const i=[];a.forEach(g=>{const w=g.startTime,A=g.endTime,ie=g.day,[R,W]=w.split(":").map(Number),[De,$e]=A.split(":").map(Number),U=R*60+W,Z=De*60+$e-U;Ps.forEach(ee=>{const oe=Math.floor(Z/ee);for(let se=0;se<oe;se++){const de=U+se*ee,me=de+ee,Pe=Math.floor(de/60),Ae=de%60,ve=Math.floor(me/60),Ee=me%60,we=`${Pe.toString().padStart(2,"0")}:${Ae.toString().padStart(2,"0")}`,Me=`${ve.toString().padStart(2,"0")}:${Ee.toString().padStart(2,"0")}`;g.assignedLessons&&g.assignedLessons.some(xe=>xe.startTime===we&&xe.duration===ee)||i.push({_id:`${g._id}-${ee}-${se}`,day:ie,startTime:we,endTime:Me,duration:ee,isAvailable:!0,location:g.location,teacherName:r.personalInfo?.fullName,teacherId:r._id,instrument:r.professionalInfo?.instrument})}})}),console.log("Generated available slots:",i),p(i)}catch(r){console.error("Error fetching teacher slots:",r),p([])}finally{P(!1)}},H=s=>{u(r=>({...r,[s]:!r[s]}))},O=(s,r,a)=>{m(i=>({...i,[s]:{...i[s],[r]:a}})),$(i=>({...i,[`${s}.${r}`]:""}))},Q=(s,r,a)=>{const i=[...c.academicInfo.instrumentProgress];r==="tests"?i[s]={...i[s],tests:a}:i[s]={...i[s],[r]:a},r==="isPrimary"&&a===!0&&i.forEach((g,w)=>{w!==s&&(g.isPrimary=!1)}),m(g=>({...g,academicInfo:{...g.academicInfo,instrumentProgress:i}}))},be=()=>{const s=c.academicInfo.instrumentProgress.some(r=>r.isPrimary);m(r=>({...r,academicInfo:{...r.academicInfo,instrumentProgress:[...r.academicInfo.instrumentProgress,{instrumentName:"",isPrimary:!s,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}]}}))},ke=s=>{const r=c.academicInfo.instrumentProgress.filter((a,i)=>i!==s);r.length>0&&!r.some(a=>a.isPrimary)&&(r[0].isPrimary=!0),m(a=>({...a,academicInfo:{...a.academicInfo,instrumentProgress:r}}))},je=s=>{const r={teacherId:s.teacherId,day:s.day,time:s.startTime,duration:s.duration,isActive:!0,isRecurring:!0,...s.location&&{location:s.location}};m(a=>({...a,teacherAssignments:[...a.teacherAssignments,r],teacherIds:a.teacherIds.includes(s.teacherId)?a.teacherIds:[...a.teacherIds,s.teacherId]})),p(a=>a.filter(i=>i._id!==s._id)),V(!1)},G=(s,r)=>{const[a,i]=s.split(":").map(Number),g=a*60+i+r,w=Math.floor(g/60),A=g%60;return`${w.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}`},ce=s=>{const r=c.teacherAssignments[s];m(a=>{const i=a.teacherAssignments.filter((w,A)=>A!==s),g=i.some(w=>w.teacherId===r.teacherId);return{...a,teacherAssignments:i,teacherIds:g?a.teacherIds:a.teacherIds.filter(w=>w!==r.teacherId)}})},Te=()=>{const s={};c.personalInfo.fullName.trim()||(s["personalInfo.fullName"]="×©× ×ž×œ× ×”×•× ×©×“×” ×—×•×‘×”"),c.personalInfo.phone&&!/^05\d{8}$/.test(c.personalInfo.phone)&&(s["personalInfo.phone"]="×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×“×•×’×ž×”: 0501234567)"),c.personalInfo.parentPhone&&!/^05\d{8}$/.test(c.personalInfo.parentPhone)&&(s["personalInfo.parentPhone"]="×ž×¡×¤×¨ ×˜×œ×¤×•×Ÿ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),c.personalInfo.parentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.personalInfo.parentEmail)&&(s["personalInfo.parentEmail"]="××™×ž×™×™×œ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),c.personalInfo.studentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.personalInfo.studentEmail)&&(s["personalInfo.studentEmail"]="××™×ž×™×™×œ ×ª×œ×ž×™×“ ×œ× ×ª×§×™×Ÿ"),c.academicInfo.class||(s["academicInfo.class"]="×›×™×ª×” ×”×™× ×©×“×” ×—×•×‘×”"),c.academicInfo.instrumentProgress.length===0?s["academicInfo.instruments"]="×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×›×œ×™ × ×’×™× ×” ××—×“":c.academicInfo.instrumentProgress.forEach((a,i)=>{a.instrumentName||(s[`instrument.${i}.name`]="×©× ×”×›×œ×™ ×”×•× ×©×“×” ×—×•×‘×”")});const r=c.academicInfo.instrumentProgress.some(a=>a.isPrimary);return c.academicInfo.instrumentProgress.length>0&&!r&&(s["academicInfo.primaryInstrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ ×¨××©×™"),$(s),Object.keys(s).length===0},Ne=async s=>{if(s.preventDefault(),!!Te()){T(!0);try{console.log("ðŸ“‹ Form data being submitted:",JSON.stringify(c,null,2)),console.log("ðŸ‘¥ Teacher assignments:",JSON.stringify(c.teacherAssignments,null,2)),console.log("ðŸ‘¨â€ðŸ« Teacher IDs:",c.teacherIds),await h(c)}catch(r){console.error("Error submitting form:",r),$({submit:"×©×’×™××” ×‘×©×ž×™×¨×ª ×”× ×ª×•× ×™×"})}finally{T(!1)}}};return e.jsxs("form",{onSubmit:Ne,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:E?"×¢×¨×™×›×ª ×ª×œ×ž×™×“":"×”×•×¡×¤×ª ×ª×œ×ž×™×“ ×—×“×©"}),e.jsx("button",{type:"button",onClick:B,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(le,{className:"w-5 h-5"})})]}),d.submit&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:d.submit})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>H("personal"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××™×©×™×™×"})]}),N.personal?e.jsx(ge,{}):e.jsx(te,{})]}),N.personal&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ×ž×œ× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.personalInfo.fullName,onChange:s=>O("personalInfo","fullName",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["personalInfo.fullName"]?"border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ×ž×©×¤×—×” ×•××– ×©× ×¤×¨×˜×™ (×œ×“×•×’×ž×”: ×›×”×Ÿ ×™×•×¡×™)"}),d["personalInfo.fullName"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×ª×œ×ž×™×“"}),e.jsx("input",{type:"tel",value:c.personalInfo.phone,onChange:s=>O("personalInfo","phone",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["personalInfo.phone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),d["personalInfo.phone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×’×™×œ"}),e.jsx("input",{type:"number",value:c.personalInfo.age||"",onChange:s=>O("personalInfo","age",s.target.value?parseInt(s.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×’×™×œ ×”×ª×œ×ž×™×“",min:"0",max:"99"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™×ž×™×™×œ ×ª×œ×ž×™×“"}),e.jsx("input",{type:"email",value:c.personalInfo.studentEmail,onChange:s=>O("personalInfo","studentEmail",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["personalInfo.studentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"student@example.com"}),d["personalInfo.studentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["personalInfo.studentEmail"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª"}),e.jsx("input",{type:"text",value:c.personalInfo.address,onChange:s=>O("personalInfo","address",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×”×›× ×¡ ×›×ª×•×‘×ª ×ž×œ××”"})]}),e.jsx("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-4",children:"×¤×¨×˜×™ ×”×•×¨×”"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×•×¨×”"}),e.jsx("input",{type:"text",value:c.personalInfo.parentName,onChange:s=>O("personalInfo","parentName",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×©× ×”×”×•×¨×”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×”×•×¨×”"}),e.jsx("input",{type:"tel",value:c.personalInfo.parentPhone,onChange:s=>O("personalInfo","parentPhone",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["personalInfo.parentPhone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),d["personalInfo.parentPhone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["personalInfo.parentPhone"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™×ž×™×™×œ ×”×•×¨×”"}),e.jsx("input",{type:"email",value:c.personalInfo.parentEmail,onChange:s=>O("personalInfo","parentEmail",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["personalInfo.parentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"parent@example.com"}),d["personalInfo.parentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["personalInfo.parentEmail"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>H("academic"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××§×“×ž×™×™×"})]}),N.academic?e.jsx(ge,{}):e.jsx(te,{})]}),N.academic&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×™×ª×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:c.academicInfo.class,onChange:s=>O("academicInfo","class",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d["academicInfo.class"]?"border-red-500":"border-gray-300"}`,children:Ts.map(s=>e.jsx("option",{value:s,children:s},s))}),d["academicInfo.class"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d["academicInfo.class"]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>H("instruments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×›×œ×™ × ×’×™× ×”"})]}),N.instruments?e.jsx(ge,{}):e.jsx(te,{})]}),N.instruments&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[d["academicInfo.instruments"]&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:d["academicInfo.instruments"]})}),d["academicInfo.primaryInstrument"]&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:d["academicInfo.primaryInstrument"]})}),e.jsxs("div",{className:"space-y-4",children:[c.academicInfo.instrumentProgress.map((s,r)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×›×œ×™ × ×’×™× ×” ",r+1]}),c.academicInfo.instrumentProgress.length>1&&e.jsx("button",{type:"button",onClick:()=>ke(r),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["×©× ×”×›×œ×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s.instrumentName,onChange:a=>Q(r,"instrumentName",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${d[`instrument.${r}.name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),$s.map(a=>e.jsx("option",{value:a,children:a},a))]}),d[`instrument.${r}.name`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d[`instrument.${r}.name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×œ×‘ × ×•×›×—×™"}),e.jsx("select",{value:s.currentStage,onChange:a=>Q(r,"currentStage",parseInt(a.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:Ds.map(a=>e.jsxs("option",{value:a,children:["×©×œ×‘ ",a]},a))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.isPrimary,onChange:a=>Q(r,"isPrimary",a.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×›×œ×™ ×¨××©×™"})]})}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×‘×—×Ÿ ×©×œ×‘"}),e.jsx("select",{value:s.tests.stageTest.status,onChange:a=>Q(r,"tests",{...s.tests,stageTest:{...s.tests.stageTest,status:a.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:Xe.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×ž×‘×—×Ÿ ×˜×›× ×™"}),e.jsx("select",{value:s.tests.technicalTest.status,onChange:a=>Q(r,"tests",{...s.tests,technicalTest:{...s.tests.technicalTest,status:a.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:Xe.map(a=>e.jsx("option",{value:a,children:a},a))})]})]})]})]},r)),e.jsxs("button",{type:"button",onClick:be,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors flex items-center justify-center gap-2 text-gray-600 hover:text-primary-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),"×”×•×¡×£ ×›×œ×™ × ×’×™× ×”"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>H("teachers"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×ž×•×¨×™× ×•×©×™×¢×•×¨×™×"}),c.teacherAssignments.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:[c.teacherAssignments.length," ×©×™×‘×•×¦×™×"]})]}),N.teachers?e.jsx(ge,{}):e.jsx(te,{})]}),N.teachers&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[c.teacherAssignments.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×©×™×¢×•×¨×™× ×ž×ª×•×›× × ×™×"}),e.jsx("div",{className:"space-y-2",children:c.teacherAssignments.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["×ž×•×¨×” - ",v.find(a=>a._id===s.teacherId)?.professionalInfo?.instrument||"×›×œ×™"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.day," | ",s.time,"-",G(s.time,s.duration)," | ",s.duration," ×“×§×•×ª",s.location&&` | ${s.location}`]})]})]}),e.jsx("button",{type:"button",onClick:()=>ce(r),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(ne,{className:"w-4 h-4"})})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×‘×—×¨ ×ž×•×¨×”"}),e.jsxs("select",{value:b,onChange:s=>_(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ž×•×¨×” ×œ×¨××•×ª ×–×ž× ×™× ×¤× ×•×™×™×"}),v.map(s=>e.jsxs("option",{value:s._id,children:[s.personalInfo?.fullName," - ",s.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"]},s._id))]})]}),b&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["×–×ž× ×™× ×¤× ×•×™×™× - ",v.find(s=>s._id===b)?.personalInfo?.fullName||"×ž×•×¨×”"]}),!F&&D.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>V(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4"}),"×‘×—×¨ ×©×™×¢×•×¨ × ×•×¡×£"]})}),F&&!x&&D.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"×¡×™× ×•×Ÿ ×–×ž× ×™×"]}),(f.duration||f.selectedDays.length>0||f.startTime||f.endTime)&&e.jsxs("button",{type:"button",onClick:()=>I({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),"× ×§×” ×¡×™× ×•×Ÿ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×ž×©×š ×©×™×¢×•×¨"}),e.jsxs("select",{value:f.duration||"",onChange:s=>I(r=>({...r,duration:s.target.value?Number(s.target.value):null})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"×›×œ ×”×ž×©×›×™×"}),e.jsx("option",{value:"30",children:"30 ×“×§×•×ª"}),e.jsx("option",{value:"45",children:"45 ×“×§×•×ª"}),e.jsx("option",{value:"60",children:"60 ×“×§×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×™×ž×™×"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-right flex items-center justify-between text-gray-900",onClick:s=>{const r=s.currentTarget.nextElementSibling;r&&r.classList.toggle("hidden")},children:[e.jsx("span",{className:"truncate",children:f.selectedDays.length>0?`${f.selectedDays.length} ×™×ž×™× × ×‘×—×¨×•`:"×›×œ ×”×™×ž×™×"}),e.jsx(te,{className:"w-4 h-4 flex-shrink-0"})]}),e.jsx("div",{className:"hidden absolute top-full mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg z-10",children:Ls.map(s=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.selectedDays.includes(s),onChange:r=>{r.target.checked?I(a=>({...a,selectedDays:[...a.selectedDays,s]})):I(a=>({...a,selectedDays:a.selectedDays.filter(i=>i!==s)}))},className:"ml-2 text-primary-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:s})]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×ž×©×¢×”"}),e.jsx("input",{type:"time",value:f.startTime,onChange:s=>I(r=>({...r,startTime:s.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×¢×“ ×©×¢×”"}),e.jsx("input",{type:"time",value:f.endTime,onChange:s=>I(r=>({...r,endTime:s.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]})]})]}),x?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"×˜×•×¢×Ÿ ×–×ž× ×™× ×¤× ×•×™×™×..."})]}):F&&D.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–×ž×Ÿ ×•×ž×©×š ×©×™×¢×•×¨ ×ž×”××¤×©×¨×•×™×•×ª ×”×–×ž×™× ×•×ª:"}),(()=>{const s=D.filter(a=>!(f.duration&&a.duration!==f.duration||f.selectedDays.length>0&&!f.selectedDays.includes(a.day)||f.startTime&&a.startTime<f.startTime||f.endTime&&a.endTime>f.endTime));if(s.length===0)return e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×ž× ×™× ×”×ª×•××ž×™× ×œ×¡×™× ×•×Ÿ ×©×‘×—×¨×ª"}),e.jsx("button",{type:"button",onClick:()=>I({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700",children:"× ×§×” ×¡×™× ×•×Ÿ ×•×ª×¨××” ××ª ×›×œ ×”×–×ž× ×™×"})]});const r=s.reduce((a,i)=>(a[i.day]||(a[i.day]=[]),a[i.day].push(i),a),{});return Object.entries(r).map(([a,i])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),a]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:i.sort((g,w)=>g.startTime.localeCompare(w.startTime)).map(g=>e.jsx("button",{type:"button",onClick:()=>je(g),className:`p-3 border rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-right ${g.duration===30?"border-green-300 bg-green-50":g.duration===45?"border-blue-300 bg-blue-50":"border-purple-300 bg-purple-50"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[g.startTime,"-",g.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.duration===30?"bg-green-100 text-green-800":g.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[g.duration," ×“×§×³"]})]}),g.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ps,{className:"w-3 h-3"}),g.location]}),e.jsx("div",{className:"text-xs text-gray-600",children:g.instrument})]})},g._id))})]},a))})()]}):b&&!x&&F&&D.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×ž× ×™× ×¤× ×•×™×™× ×œ×ž×•×¨×” ×–×”"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×ž× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×”×ž×•×¨×” ×œ× ×”×’×“×™×¨ ×–×ž× ×™ ×”×•×¨××”"})]}):null]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>H("enrollments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×¨×©×ž×•×ª"})]}),N.enrollments?e.jsx(ge,{}):e.jsx(te,{})]}),N.enrollments&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×–×ž×•×¨×ª"}),e.jsxs("select",{value:c.enrollments.orchestraIds[0]||"",onChange:s=>{m(r=>({...r,enrollments:{...r.enrollments,orchestraIds:s.target.value?[s.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–×ž×•×¨×ª"}),C.map(s=>{const r=s.rehearsalSchedule||s.schedule&&s.schedule[0]||s.rehearsals&&s.rehearsals[0]||null;let a=s.name;if(r){const i=r.day||r.dayOfWeek||"",g=r.startTime||"",w=r.endTime||"",A=r.location||s.location||"";i&&g&&w&&(a+=` | ${i} ${g}-${w}`),A&&(a+=` | ${A}`)}else s.location&&(a+=` | ${s.location}`);return e.jsx("option",{value:s._id,children:a},s._id)})]}),c.enrollments.orchestraIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200",children:(()=>{const s=C.find(r=>r._id===c.enrollments.orchestraIds[0]);return s?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-purple-900",children:s.name}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[s.rehearsalSchedule&&e.jsxs("div",{className:"p-2 bg-purple-100 rounded",children:[e.jsx("strong",{children:"×–×ž× ×™ ×—×–×¨×•×ª:"})," ",s.rehearsalSchedule.day," ",s.rehearsalSchedule.startTime,"-",s.rehearsalSchedule.endTime,s.rehearsalSchedule.location&&e.jsxs("span",{children:[" | ",s.rehearsalSchedule.location]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×•×’:"})," ",s.type||"×ª×–×ž×•×¨×ª"]}),!s.rehearsalSchedule&&s.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ž×™×§×•×:"})," ",s.location]}),s.memberIds&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ž×¡×¤×¨ ×—×‘×¨×™×:"})," ",s.memberIds.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×˜×˜×•×¡:"})," ",s.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"]}),s.rehearsalIds&&s.rehearsalIds.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ž×¡×¤×¨ ×—×–×¨×•×ª ×©×ž×•×¨×•×ª:"})," ",s.rehearsalIds.length]})]})]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),e.jsxs("select",{value:c.enrollments.theoryLessonIds[0]||"",onChange:s=>{m(r=>({...r,enrollments:{...r.enrollments,theoryLessonIds:s.target.value?[s.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),X.map(s=>{const r=s.schedule&&s.schedule.length>0?s.schedule[0]:null,a=r?`${r.day} ${r.startTime}-${r.endTime}${r.location?` | ${r.location}`:""}`:"";return e.jsxs("option",{value:s._id,children:[s.name||s.title||s.category," ",a?`| ${a}`:"",s.teacher?.personalInfo?.fullName&&` | ×ž×•×¨×”: ${s.teacher.personalInfo.fullName}`]},s._id)})]}),c.enrollments.theoryLessonIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(()=>{const s=X.find(r=>r._id===c.enrollments.theoryLessonIds[0]);return s?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:s.name}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"×¨×ž×”:"})," ",s.level]}),s.teacher?.personalInfo?.fullName&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ž×•×¨×”:"})," ",s.teacher.personalInfo.fullName]}),s.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×™××•×¨:"})," ",s.description]}),s.maxStudents&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ž×§×¡×™×ž×•× ×ª×œ×ž×™×“×™×:"})," ",s.maxStudents]}),s.currentStudents!==void 0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×œ×ž×™×“×™× × ×•×›×—×™×™×:"})," ",s.currentStudents,"/",s.maxStudents||"âˆž"]}),s.schedule&&s.schedule.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×–×ž× ×™ ×©×™×¢×•×¨:"}),e.jsx("div",{className:"mt-1 space-y-1",children:s.schedule.map((r,a)=>e.jsxs("div",{className:"text-xs bg-blue-100 px-2 py-1 rounded",children:[r.day," ",r.startTime,"-",r.endTime,r.location&&` | ${r.location}`]},a))})]}),s.prerequisites&&e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[e.jsx("strong",{children:"×“×¨×™×©×•×ª ×§×“×:"})," ",s.prerequisites]})]})]}):null})()})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:B,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:L,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"×©×•×ž×¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"w-4 h-4"}),E?"×¢×“×›×Ÿ ×ª×œ×ž×™×“":"×”×•×¡×£ ×ª×œ×ž×™×“"]})})]})]})},Es=As,Ms=({isOpen:y,studentId:h,studentName:B,onClose:E,onConfirm:c})=>{const[m,d]=o.useState(null),[$,L]=o.useState(!1),[T,N]=o.useState(null),[u,v]=o.useState({createSnapshot:!0,skipValidation:!1,deleteDocuments:!0,notifyUsers:!1,reason:"Safe deletion via UI"});o.useEffect(()=>{y&&h&&J()},[y,h]);const J=async()=>{L(!0),N(null);try{const p=await ye.previewDeletion(h);d(p)}catch(p){console.error("Error loading deletion preview:",p),N(p.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¦×•×’×” ×ž×§×“×™×ž×”")}finally{L(!1)}},D=()=>{c(h,u)};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-6 h-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"×ž×—×™×§×” ×ž××•×‘×˜×—×ª"})]}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600",children:e.jsx(le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:["×ž×—×™×§×ª ×”×ª×œ×ž×™×“: ",B]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"×¤×¢×•×œ×” ×–×• ×ª×ž×—×§ ××ª ×”×ª×œ×ž×™×“ ×•×›×œ ×”× ×ª×•× ×™× ×”×§×©×•×¨×™× ××œ×™×•. ×”×ž×¢×¨×›×ª ×ª×‘×¦×¢ ×‘×“×™×§×•×ª ×‘×˜×™×—×•×ª ×•×ª×™×¦×•×¨ ×’×™×‘×•×™ ×œ×¤× ×™ ×”×ž×—×™×§×”."})]}),$&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(pe,{className:"w-6 h-6 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"×˜×•×¢×Ÿ ×ª×¦×•×’×” ×ž×§×“×™×ž×”..."})]}),T&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"×©×’×™××”"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:T})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"×¡×™×›×•× ×”×©×¤×¢×”"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:'×¡×”"×› ×¨×©×•×ž×•×ª'}),e.jsx("div",{className:"text-xl font-bold text-gray-900",children:m.summary?.totalRecords||0})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"×–×ž×Ÿ ×ž×©×•×¢×¨"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[m.summary?.estimatedDuration||0," ×©× ×™×•×ª"]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:`p-4 rounded-lg border ${m.summary?.riskLevel==="high"?"bg-red-50 border-red-200":m.summary?.riskLevel==="medium"?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:`w-5 h-5 ${m.summary?.riskLevel==="high"?"text-red-600":m.summary?.riskLevel==="medium"?"text-yellow-600":"text-green-600"}`}),e.jsxs("span",{className:"font-medium",children:["×¨×ž×ª ×¡×™×›×•×Ÿ: ",m.summary?.riskLevel==="high"?"×’×‘×•×”×”":m.summary?.riskLevel==="medium"?"×‘×™× ×•× ×™×ª":"× ×ž×•×›×”"]})]})})}),m.summary?.affectedCollections?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"××–×•×¨×™× ×ž×•×©×¤×¢×™×"}),e.jsx("div",{className:"space-y-2",children:m.summary.affectedCollections.map((p,C)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx(ae,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:p})]},C))})]}),m.warnings?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"××–×”×¨×•×ª"}),e.jsx("div",{className:"space-y-2",children:m.warnings.map((p,C)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx(Ue,{className:"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-yellow-800",children:p})]},C))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"××¤×©×¨×•×™×•×ª ×ž×—×™×§×”"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.createSnapshot,onChange:p=>v(C=>({...C,createSnapshot:p.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"×¦×•×¨ ×’×™×‘×•×™ ×œ×¤× ×™ ×”×ž×—×™×§×” (×ž×•×ž×œ×¥)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.deleteDocuments,onChange:p=>v(C=>({...C,deleteDocuments:p.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"×ž×—×§ ×’× ×§×‘×¦×™× ×•×ž×¡×ž×›×™×"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.notifyUsers,onChange:p=>v(C=>({...C,notifyUsers:p.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"×©×œ×— ×”×ª×¨××•×ª ×œ×ž×•×¨×™× ×§×©×•×¨×™×"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.skipValidation,onChange:p=>v(C=>({...C,skipValidation:p.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"×“×œ×’ ×¢×œ ×‘×“×™×§×•×ª ×ª×§×™× ×•×ª (×œ× ×ž×•×ž×œ×¥)"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×™×‘×ª ×”×ž×—×™×§×”"}),e.jsx("textarea",{value:u.reason,onChange:p=>v(C=>({...C,reason:p.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"×”×–×Ÿ ×¡×™×‘×” ×œ×ž×—×™×§×”..."})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:"×”×ž×—×™×§×” ×ª×—×œ ×œ××—×¨ ××™×©×•×¨"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsxs("button",{onClick:D,disabled:$||!m?.canProceed,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Be,{className:"w-4 h-4"}),"×ž×—×§ ×‘××•×¤×Ÿ ×ž××•×‘×˜×—"]})]})]})]})}):null},_s=Ms,Fs=({isOpen:y,preview:h,onClose:B})=>{if(!y||!h)return null;const E=m=>{switch(m){case"lessons":return e.jsx(Ie,{className:"w-4 h-4"});case"attendance":return e.jsx(Ce,{className:"w-4 h-4"});case"orchestras":return e.jsx(Ze,{className:"w-4 h-4"});case"theoryClasses":return e.jsx(Qe,{className:"w-4 h-4"});case"documents":return e.jsx(bs,{className:"w-4 h-4"});case"payments":return e.jsx(ys,{className:"w-4 h-4"});default:return e.jsx(fe,{className:"w-4 h-4"})}},c=m=>{switch(m){case"lessons":return"×©×™×¢×•×¨×™×";case"attendance":return"× ×•×›×—×•×ª";case"orchestras":return"×ª×–×ž×•×¨×•×ª";case"theoryClasses":return"×ª×™××•×¨×™×”";case"documents":return"×ž×¡×ž×›×™×";case"payments":return"×ª×©×œ×•×ž×™×";case"rehearsals":return"×—×–×¨×•×ª";case"assignments":return"×”×§×¦××•×ª";default:return m}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"×”×©×¤×¢×ª ×”×ž×—×™×§×”"})]}),e.jsx("button",{onClick:B,className:"text-gray-400 hover:text-gray-600",children:e.jsx(le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"×¡×™×›×•× ×›×œ×œ×™"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:'×¡×”"×› ×¨×©×•×ž×•×ª'}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:h.summary?.totalRecords||0})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"×–×ž×Ÿ ×ž×©×•×¢×¨"}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[h.summary?.estimatedDuration||0,"s"]})]}),e.jsxs("div",{className:`p-4 border rounded-lg ${h.summary?.riskLevel==="high"?"bg-red-50 border-red-200":h.summary?.riskLevel==="medium"?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:[e.jsx("div",{className:`text-sm mb-1 ${h.summary?.riskLevel==="high"?"text-red-600":h.summary?.riskLevel==="medium"?"text-yellow-600":"text-green-600"}`,children:"×¨×ž×ª ×¡×™×›×•×Ÿ"}),e.jsx("div",{className:`text-2xl font-bold ${h.summary?.riskLevel==="high"?"text-red-900":h.summary?.riskLevel==="medium"?"text-yellow-900":"text-green-900"}`,children:h.summary?.riskLevel==="high"?"×’×‘×•×”×”":h.summary?.riskLevel==="medium"?"×‘×™× ×•× ×™×ª":"× ×ž×•×›×”"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"×¤×™×¨×•×˜ ×ž×¤×•×¨×˜"}),e.jsx("div",{className:"space-y-4",children:Object.entries(h.details||{}).map(([m,d])=>{if(!d||Array.isArray(d)&&d.length===0)return null;const $=Array.isArray(d)?d.length:d.count||0;return $===0?null:e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[E(m),e.jsx("span",{className:"font-medium text-gray-900",children:c(m)})]}),e.jsxs("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:[$," ×¨×©×•×ž×•×ª"]})]}),Array.isArray(d)&&d.length>0&&e.jsx("div",{className:"p-4 max-h-40 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[d.slice(0,10).map((L,T)=>e.jsx("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:L.title||L.name||L.date||`×¤×¨×™×˜ ${T+1}`},T)),d.length>10&&e.jsxs("div",{className:"text-sm text-gray-500 text-center py-2",children:["×•×¢×•×“ ",d.length-10," ×¤×¨×™×˜×™×..."]})]})})]},m)})})]}),h.dependencies?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"×ª×œ×•×™×•×ª"}),e.jsx("div",{className:"space-y-2",children:h.dependencies.map((m,d)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(Fe,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-orange-900",children:[m.type,": ",m.entity]}),e.jsx("div",{className:"text-sm text-orange-700",children:m.description})]})]},d))})]}),h.warnings?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"××–×”×¨×•×ª"}),e.jsx("div",{className:"space-y-2",children:h.warnings.map((m,d)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-yellow-800",children:m})]},d))})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx("div",{className:`p-4 rounded-lg ${h.canProceed?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${h.canProceed?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`font-medium ${h.canProceed?"text-green-900":"text-red-900"}`,children:h.canProceed?"× ×™×ª×Ÿ ×œ×‘×¦×¢ ×ž×—×™×§×”":"×œ× × ×™×ª×Ÿ ×œ×‘×¦×¢ ×ž×—×™×§×” ×¢×§×‘ ×ª×œ×•×™×•×ª ×§×¨×™×˜×™×•×ª"})]})})})]}),e.jsx("div",{className:"flex items-center justify-end p-6 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:B,className:"px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"×¡×’×•×¨"})})]})})},Os=Fs,Rs=({isOpen:y,selectedStudentIds:h,onClose:B,onComplete:E})=>{const[c,m]=o.useState("preview"),[d,$]=o.useState(!1),[L,T]=o.useState(null),[N,u]=o.useState([]),[v,J]=o.useState({current:0,total:0,stage:""}),[D,p]=o.useState({success:0,failed:0,details:[]});o.useEffect(()=>{y&&h.length>0&&C()},[y,h]);const C=async()=>{$(!0),T(null);try{const x=h.map(async f=>{try{const I=await ye.previewDeletion(f);return{studentId:f,studentName:`×ª×œ×ž×™×“ ${f}`,canDelete:I.canProceed,riskLevel:I.summary?.riskLevel||"low",totalRecords:I.summary?.totalRecords||0,warnings:I.warnings||[],errors:[]}}catch(I){return{studentId:f,studentName:`×ª×œ×ž×™×“ ${f}`,canDelete:!1,riskLevel:"high",totalRecords:0,warnings:[],errors:[I.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¦×•×’×” ×ž×§×“×™×ž×”"]}}}),P=await Promise.all(x);u(P)}catch(x){console.error("Error loading batch previews:",x),T(x.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¦×•×’×•×ª ×ž×§×“×™×ž×•×ª")}finally{$(!1)}},Y=async()=>{const x=N.filter(F=>F.canDelete);if(x.length===0){T("××™×Ÿ ×ª×œ×ž×™×“×™× ×©× ×™×ª×Ÿ ×œ×ž×—×•×§");return}m("progress"),J({current:0,total:x.length,stage:"×ž×ª×—×™×œ ×ž×—×™×§×”..."});const P=[];let f=0,I=0;for(let F=0;F<x.length;F++){const V=x[F];J({current:F+1,total:x.length,stage:`×ž×•×—×§ ${V.studentName}...`});try{await ye.executeDelete(V.studentId,{createSnapshot:!0,batchMode:!0,batchIndex:F+1,batchTotal:x.length}),f++,P.push({studentId:V.studentId,studentName:V.studentName,success:!0,error:null})}catch(K){I++,P.push({studentId:V.studentId,studentName:V.studentName,success:!1,error:K.message||"×©×’×™××” ×‘×ž×—×™×§×”"})}await new Promise(K=>setTimeout(K,500))}p({success:f,failed:I,details:P}),m("complete")},X=()=>{c!=="progress"&&(c==="complete"&&D.success>0?E():B())};if(!y)return null;const z=N.filter(x=>x.canDelete).length,b=N.filter(x=>x.riskLevel==="high").length,_=N.reduce((x,P)=>x+P.totalRecords,0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-6 h-6 text-red-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["×ž×—×™×§×” ×ž×¨×•×‘×ª ×ª×œ×ž×™×“×™× (",h.length,")"]})]}),e.jsx("button",{onClick:X,disabled:c==="progress",className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:e.jsx(le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:[c==="preview"&&e.jsxs("div",{className:"p-6",children:[d&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(pe,{className:"w-6 h-6 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"×˜×•×¢×Ÿ ×ª×¦×•×’×•×ª ×ž×§×“×™×ž×•×ª..."})]}),L&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"×©×’×™××”"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:L})]}),N.length>0&&!d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:h.length}),e.jsx("div",{className:"text-sm text-blue-600",children:"× ×‘×—×¨×•"})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:z}),e.jsx("div",{className:"text-sm text-green-600",children:"× ×™×ª×Ÿ ×œ×ž×—×•×§"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:b}),e.jsx("div",{className:"text-sm text-red-600",children:"×¡×™×›×•×Ÿ ×’×‘×•×”"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:_}),e.jsx("div",{className:"text-sm text-gray-600",children:'×¡×”"×› ×¨×©×•×ž×•×ª'})]})]}),e.jsx("div",{className:"space-y-3",children:N.map(x=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x.canDelete?e.jsx(ae,{className:"w-5 h-5 text-green-600"}):e.jsx(ue,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:x.studentName}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.riskLevel==="high"?"bg-red-100 text-red-800":x.riskLevel==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:x.riskLevel==="high"?"×¡×™×›×•×Ÿ ×’×‘×•×”":x.riskLevel==="medium"?"×¡×™×›×•×Ÿ ×‘×™× ×•× ×™":"×¡×™×›×•×Ÿ × ×ž×•×š"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[x.totalRecords," ×¨×©×•×ž×•×ª"]})]}),x.warnings.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:x.warnings.map((P,f)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-yellow-700",children:[e.jsx(Ue,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:P})]},f))}),x.errors.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:x.errors.map((P,f)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-red-700",children:[e.jsx(ue,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:P})]},f))})]},x.studentId))})]})]}),c==="progress"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(pe,{className:"w-12 h-12 animate-spin text-red-600 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"×ž×‘×¦×¢ ×ž×—×™×§×”..."}),e.jsx("p",{className:"text-gray-600 mb-6",children:v.stage}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsxs("span",{children:[v.current," ×ž×ª×•×š ",v.total]}),e.jsxs("span",{children:[Math.round(v.current/v.total*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-600 h-2 rounded-full transition-all duration-300",style:{width:`${v.current/v.total*100}%`}})})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"×× × ×”×ž×ª×Ÿ ×¢×“ ×œ×¡×™×•× ×”×¤×¢×•×œ×”. ××œ ×ª×¡×’×•×¨ ××ª ×”×—×œ×•×Ÿ."})]})}),c==="complete"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(ae,{className:"w-12 h-12 text-green-600 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"×”×ž×—×™×§×” ×”×•×©×œ×ž×”"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:D.success}),e.jsx("div",{className:"text-sm text-green-600",children:"× ×ž×—×§×• ×‘×”×¦×œ×—×”"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:D.failed}),e.jsx("div",{className:"text-sm text-red-600",children:"× ×›×©×œ×•"})]})]}),D.details.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"×¤×™×¨×•×˜ ×ž×œ×:"}),D.details.map((x,P)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${x.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[x.success?e.jsx(ae,{className:"w-4 h-4 text-green-600"}):e.jsx(ue,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"flex-1",children:x.studentName}),x.error&&e.jsx("span",{className:"text-sm text-red-600",children:x.error})]},P))]})]})]}),c!=="progress"&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[c==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{children:["×ž×•×›×Ÿ ×œ×ž×—×™×§×ª ",z," ×ª×œ×ž×™×“×™×"]})]}),c==="complete"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["×”×•×©×œ×ž×• ",D.success," ×ž×—×™×§×•×ª"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:X,className:"px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:c==="complete"?"×¡×’×•×¨":"×‘×™×˜×•×œ"}),c==="preview"&&z>0&&e.jsxs("button",{onClick:Y,disabled:d,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50",children:[e.jsx(ne,{className:"w-4 h-4"}),"×ž×—×§ ",z," ×ª×œ×ž×™×“×™×"]})]})]})]})})},Bs=Rs;function Xs(){const y=gs(),{currentSchoolYear:h,isLoading:B}=hs(),[E,c]=o.useState([]),[m,d]=o.useState(!0),[$,L]=o.useState(null),[T,N]=o.useState(""),[u,v]=o.useState({orchestra:"",instrument:"",teacher:"",stageLevel:"",orphaned:"",noActivity:"",integrityStatus:""}),[J,D]=o.useState(!1),[p,C]=o.useState(null),[Y,X]=o.useState([]),[z,b]=o.useState(!1),[_,x]=o.useState(""),[P,f]=o.useState(!1),[I,F]=o.useState("table"),[V,K]=o.useState(!1),[H,O]=o.useState(null),[Q,be]=o.useState(null),[ke,je]=o.useState(!1),[G,ce]=o.useState(null),[Te,Ne]=o.useState(null),[s,r]=o.useState(null),[a,i]=o.useState(!1),[g,w]=o.useState(!1),[A,ie]=o.useState(!1),[R,W]=o.useState(new Set),[De,$e]=o.useState(null),[U,Le]=o.useState(!1);Is(),o.useEffect(()=>{const t=()=>{s&&r(null)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[s]),o.useEffect(()=>{B||(Z(),ee())},[h,B]),o.useEffect(()=>{if(u.teacher&&Y.length>0&&!_){const t=Y.find(n=>n._id===u.teacher);t&&x(t.personalInfo?.fullName||"")}},[u.teacher,Y,_]);const Z=async()=>{try{d(!0),L(null);const t=h?{schoolYearId:h._id}:{},n=await M.students.getStudents(t),S=n.map(l=>({id:l._id,fullName:l.personalInfo.fullName,phone:l.personalInfo.phone,age:l.personalInfo.age,class:l.academicInfo.class,primaryInstrument:l.academicInfo.instrumentProgress.find(k=>k.isPrimary)?.instrumentName||l.academicInfo.instrumentProgress[0]?.instrumentName||"×œ×œ× ×›×œ×™",currentStage:l.academicInfo.instrumentProgress.find(k=>k.isPrimary)?.currentStage||1,teacherAssignments:l.teacherAssignments,parentName:l.personalInfo.parentName,parentPhone:l.personalInfo.parentPhone,orchestraIds:l.enrollments.orchestraIds,isActive:l.isActive})).map(l=>({id:l.id,name:l.fullName,instrument:l.primaryInstrument,stageLevel:l.currentStage,orchestra:l.orchestraIds?.length>0?"×ª×–×ž×•×¨×ª":"×œ×œ× ×ª×–×ž×•×¨×ª",grade:e.jsx(We,{status:"completed",children:l.class}),status:e.jsx(We,{status:l.isActive?"active":"inactive",children:l.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"}),teacherAssignments:l.teacherAssignments?.length||0,rawData:{...l,referenceCount:l.referenceCount||0,isOrphaned:l.isOrphaned||!1,hasNoRecentActivity:l.hasNoRecentActivity||!1,integrityStatus:l.integrityStatus||"healthy",lastActivity:l.lastActivity||null},originalStudent:n.find(k=>k._id===l.id),actions:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[U&&e.jsx("input",{type:"checkbox",checked:R.has(l.id),onChange:k=>{k.stopPropagation();const he=new Set(R);k.target.checked?he.add(l.id):he.delete(l.id),W(he)},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("button",{className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",onClick:k=>{k.stopPropagation(),console.log("Eye icon clicked for student:",l.id),oe(l.id)},title:"×¦×¤×” ×‘×¤×¨×˜×™ ×”×ª×œ×ž×™×“",children:e.jsx(js,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",onClick:k=>{k.stopPropagation(),se(l.id)},title:"×¢×¨×•×š ×¤×¨×˜×™ ×”×ª×œ×ž×™×“",children:e.jsx(Ns,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded transition-colors",onClick:k=>{k.stopPropagation(),we(l.id)},title:"×‘×“×•×§ ×ª×œ×•×™×•×ª",children:e.jsx(fe,{className:"w-4 h-4"})}),(l.referenceCount||l.rawData?.referenceCount||0)>0?e.jsx("button",{className:"p-1.5 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded transition-colors",onClick:k=>{k.stopPropagation(),Ee(l.id,l.name)},title:"×ž×—×™×§×” ×ž××•×‘×˜×—×ª",children:e.jsx(Be,{className:"w-4 h-4"})}):e.jsx("button",{className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded transition-colors",onClick:k=>{k.stopPropagation(),ss(l.id,l.name)},title:"×ž×—×§ ×ª×œ×ž×™×“",children:e.jsx(ne,{className:"w-4 h-4"})})]})}));c(S)}catch(t){console.error("Error loading students:",t),L(t.message)}finally{d(!1)}},ee=async()=>{try{b(!0);const t=h?{schoolYearId:h._id}:{},n=await M.teachers.getTeachers(t);X(n)}catch(t){console.error("Error loading teachers:",t)}finally{b(!1)}},oe=t=>{console.log("=== NAVIGATION DEBUG ==="),console.log("Student ID:",t),console.log("Target path:",`/students/${t}`),console.log("Current location:",window.location.pathname);const n=`/students/${t}`;try{y(n),console.log("Navigate function called successfully")}catch(j){console.error("Navigate failed, using window.location:",j),window.location.href=n}},se=async t=>{try{je(!0),C(t);const n=await M.students.getStudentById(t);be(n),D(!0)}catch(n){console.error("Error loading student for editing:",n),alert("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×”×ª×œ×ž×™×“ ×œ×¢×¨×™×›×”")}finally{je(!1)}},de=()=>{C(null),D(!0)},me=()=>{D(!1),C(null),be(null)},Pe=async t=>{try{let n=p;if(p){if(await M.students.updateStudent(p,t),Q?.enrollments?.orchestraIds){const j=Q.enrollments.orchestraIds,S=t.enrollments?.orchestraIds||[];for(const l of j)if(!S.includes(l))try{await M.orchestras.removeMember(l,p),console.log(`Removed student ${p} from orchestra ${l}`)}catch(k){console.error(`Failed to remove from orchestra ${l}:`,k)}for(const l of S)if(!j.includes(l))try{await M.orchestras.addMember(l,p),console.log(`Added student ${p} to orchestra ${l}`)}catch(k){console.error(`Failed to add to orchestra ${l}:`,k)}}else if(t.enrollments?.orchestraIds?.length>0)for(const j of t.enrollments.orchestraIds)try{await M.orchestras.addMember(j,p),console.log(`Added student ${p} to orchestra ${j}`)}catch(S){console.error(`Failed to add to orchestra ${j}:`,S)}}else if(n=(await M.students.createStudent(t))._id,t.enrollments?.orchestraIds?.length>0)for(const S of t.enrollments.orchestraIds)try{await M.orchestras.addMember(S,n),console.log(`Added new student ${n} to orchestra ${S}`)}catch(l){console.error(`Failed to add to orchestra ${S}:`,l)}Z(),me()}catch(n){throw console.error("Error saving student:",n),n}},Ae=()=>{me()},ve=async t=>{try{await M.students.deleteStudent(t),Z()}catch(n){console.error("Error deleting student:",n),alert("×©×’×™××” ×‘×ž×—×™×§×ª ×”×ª×œ×ž×™×“")}},Ee=async(t,n)=>{O({id:t,name:n}),i(!0)},we=async t=>{try{const n=await ye.previewDeletion(t);$e(n),w(!0)}catch(n){console.error("Error checking references:",n),alert("×©×’×™××” ×‘×‘×“×™×§×ª ×”×ª×œ×•×™×•×ª")}},Me=()=>{if(R.size===0){alert("×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×ª×œ×ž×™×“ ××—×“");return}ie(!0)},ze=()=>{Le(!U),W(new Set)},xe=(t,n)=>{const j=new Set(R);n?j.add(t):j.delete(t),W(j)},es=async(t,n)=>{try{await ye.executeDelete(t,n),i(!1),O(null),Z()}catch(j){console.error("Error in safe deletion:",j),alert("×©×’×™××” ×‘×ž×—×™×§×” ×”×ž××•×‘×˜×—×ª")}},ss=(t,n)=>{O({id:t,name:n}),K(!0)},ts=()=>{H&&(ve(H.id),O(null)),K(!1)},rs=()=>{O(null),K(!1)},Ve=Y.filter(t=>t.personalInfo?.fullName?.toLowerCase().includes(_.toLowerCase())||!1),Ye=(t,n)=>{v(j=>({...j,teacher:t})),x(n),f(!1)},as=t=>{x(t),f(!0),t===""&&v(n=>({...n,teacher:""}))},ns=t=>{r(t)},He=(t,n,j,S)=>{const l=S?j+1:j-1;l<1||l>8||ce({studentId:t,studentName:n,currentLevel:j,newLevel:l})},ls=async()=>{if(G)try{Ne(G.studentId),await M.students.updateStudentStageLevel(G.studentId,G.newLevel),await Z(),ce(null),r(null)}catch(t){console.error("Error updating stage level:",t),alert("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×©×œ×‘: "+t.message)}finally{Ne(null)}},cs=()=>{ce(null),r(null)},q=E.filter(t=>{const n=!T||t.name.toLowerCase().includes(T.toLowerCase())||t.instrument.toLowerCase().includes(T.toLowerCase()),j=!u.orchestra||t.orchestra===u.orchestra,S=!u.instrument||t.instrument===u.instrument,l=!u.stageLevel||t.stageLevel===parseInt(u.stageLevel),k=!u.teacher||t.rawData.teacherAssignments&&t.rawData.teacherAssignments.some(xs=>xs.teacherId===u.teacher),he=!u.orphaned||(u.orphaned==="true"?t.rawData.isOrphaned:!t.rawData.isOrphaned),ms=!u.noActivity||(u.noActivity==="true"?t.rawData.hasNoRecentActivity:!t.rawData.hasNoRecentActivity);return n&&j&&S&&l&&k&&he&&ms}),Se=E.length,Ge=E.filter(t=>t.rawData?.isActive).length,is=Se-Ge,os=E.filter(t=>t.teacherAssignments>0).length,ds=[...U?[{key:"select",header:e.jsx("input",{type:"checkbox",checked:R.size===q.length&&q.length>0,onChange:t=>{t.target.checked?W(new Set(q.map(n=>n.id))):W(new Set)},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),width:"50px",align:"center"}]:[],{key:"name",header:"×©× ×”×ª×œ×ž×™×“"},{key:"instrument",header:"×›×œ×™ × ×’×™× ×”"},{key:"references",header:"×ª×œ×•×™×•×ª",align:"center",render:t=>{const n=t.rawData.referenceCount||0;return n>0?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n>10?"bg-red-100 text-red-800":n>5?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:n})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})}},{key:"stageLevel",header:"×©×œ×‘",align:"center",render:t=>{const n=s===t.id;return Te===t.id?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-8 flex items-center justify-center bg-blue-50 rounded-lg border-2 border-blue-200",children:e.jsx("span",{className:"text-blue-600 font-medium",children:"..."})})}):n?e.jsxs("div",{className:"flex items-center justify-center gap-1",onClick:S=>S.stopPropagation(),children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),He(t.id,t.name,t.stageLevel,!1)},disabled:t.stageLevel<=1,className:"w-6 h-6 flex items-center justify-center bg-red-100 text-red-600 hover:bg-red-200 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-sm font-bold",title:"×”×•×¨×“ ×©×œ×‘",children:"-"}),e.jsx("div",{className:"w-12 h-8 flex items-center justify-center bg-blue-50 rounded-lg border-2 border-blue-300 mx-1",children:e.jsx("span",{className:"text-blue-700 font-bold text-sm",children:t.stageLevel})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),He(t.id,t.name,t.stageLevel,!0)},disabled:t.stageLevel>=8,className:"w-6 h-6 flex items-center justify-center bg-green-100 text-green-600 hover:bg-green-200 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-sm font-bold",title:"×”×¢×œ×” ×©×œ×‘",children:"+"})]}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{onClick:S=>{S.stopPropagation(),ns(t.id)},className:"w-8 h-8 flex items-center justify-center text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors font-medium border border-transparent hover:border-blue-200",title:"×œ×—×¥ ×œ×¢×¨×™×›×ª ×”×©×œ×‘",children:t.stageLevel})})}},{key:"orchestra",header:"×ª×–×ž×•×¨×ª"},{key:"grade",header:"×›×™×ª×”",align:"center"},{key:"status",header:"×¡×˜×˜×•×¡",align:"center"},{key:"integrity",header:"×©×œ×ž×•×ª × ×ª×•× ×™×",align:"center",render:t=>{const n=t.rawData.integrityStatus||"healthy",j=t.rawData.isOrphaned,S=t.rawData.hasNoRecentActivity;return e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[j&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full",title:"×¨×©×•×ž×” ×™×ª×•×ž×”"}),S&&e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full",title:"××™×Ÿ ×¤×¢×™×œ×•×ª"}),n==="healthy"&&!j&&!S&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full",title:"×ª×§×™×Ÿ"})]})}},{key:"lastActivity",header:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”",align:"center",render:t=>{const n=t.rawData.lastActivity;if(!n)return e.jsx("span",{className:"text-gray-400 text-xs",children:"-"});const j=new Date(n),l=Math.floor((new Date().getTime()-j.getTime())/(1e3*60*60*24));return e.jsx("span",{className:`text-xs ${l>30?"text-red-600":l>7?"text-yellow-600":"text-green-600"}`,children:l===0?"×”×™×•×":l===1?"××ª×ž×•×œ":`×œ×¤× ×™ ${l} ×™×ž×™×`})}},{key:"actions",header:"×¤×¢×•×œ×•×ª",align:"center",width:U?"120px":"140px"}];return m?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"×˜×•×¢×Ÿ ×ª×œ×ž×™×“×™×..."})]})}):$?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×"}),e.jsx("div",{className:"text-gray-600 mb-6",children:$}),e.jsx("button",{onClick:Z,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"× ×¡×” ×©×•×‘"})]}):e.jsxs("div",{className:"relative",children:[J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:ke?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×ª×œ×ž×™×“..."})]}):e.jsx(Es,{onSubmit:Pe,onCancel:Ae,isEdit:!!p,initialData:Q})})}),e.jsx(re,{className:"mb-6",padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ×ž×™×“×™×...",value:T,onChange:t=>N(t.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:u.orchestra,onChange:t=>v(n=>({...n,orchestra:t.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×›×œ ×”×ª×–×ž×•×¨×•×ª"}),e.jsx("option",{value:"×ª×–×ž×•×¨×ª",children:"×ª×–×ž×•×¨×ª"}),e.jsx("option",{value:"×œ×œ× ×ª×–×ž×•×¨×ª",children:"×œ×œ× ×ª×–×ž×•×¨×ª"})]}),e.jsxs("select",{value:u.instrument,onChange:t=>v(n=>({...n,instrument:t.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×›×œ ×”×›×œ×™×"}),e.jsx("option",{value:"×—×œ×™×œ×™×ª",children:"×—×œ×™×œ×™×ª"}),e.jsx("option",{value:"×—×œ×™×œ ×¦×“",children:"×—×œ×™×œ ×¦×“"}),e.jsx("option",{value:"××‘×•×‘",children:"××‘×•×‘"}),e.jsx("option",{value:"×‘×¡×•×Ÿ",children:"×‘×¡×•×Ÿ"}),e.jsx("option",{value:"×¡×§×¡×•×¤×•×Ÿ",children:"×¡×§×¡×•×¤×•×Ÿ"}),e.jsx("option",{value:"×§×œ×¨×™× ×˜",children:"×§×œ×¨×™× ×˜"}),e.jsx("option",{value:"×—×¦×•×¦×¨×”",children:"×—×¦×•×¦×¨×”"}),e.jsx("option",{value:"×§×¨×Ÿ ×™×¢×¨",children:"×§×¨×Ÿ ×™×¢×¨"}),e.jsx("option",{value:"×˜×¨×•×ž×‘×•×Ÿ",children:"×˜×¨×•×ž×‘×•×Ÿ"}),e.jsx("option",{value:"×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ",children:"×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ"}),e.jsx("option",{value:"×©×™×¨×”",children:"×©×™×¨×”"}),e.jsx("option",{value:"×›×™× ×•×¨",children:"×›×™× ×•×¨"}),e.jsx("option",{value:"×•×™×•×œ×”",children:"×•×™×•×œ×”"}),e.jsx("option",{value:"×¦'×œ×•",children:"×¦'×œ×•"}),e.jsx("option",{value:"×§×•× ×˜×¨×‘×¡",children:"×§×•× ×˜×¨×‘×¡"}),e.jsx("option",{value:"×¤×¡× ×ª×¨",children:"×¤×¡× ×ª×¨"}),e.jsx("option",{value:"×’×™×˜×¨×”",children:"×’×™×˜×¨×”"}),e.jsx("option",{value:"×’×™×˜×¨×” ×‘×¡",children:"×’×™×˜×¨×” ×‘×¡"}),e.jsx("option",{value:"×ª×•×¤×™×",children:"×ª×•×¤×™×"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"×—×¤×© ×ž×•×¨×”...",value:_,onChange:t=>as(t.target.value),onFocus:()=>f(!0),onBlur:()=>{setTimeout(()=>f(!1),200)},disabled:z,className:"w-48 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500"}),_&&e.jsx("button",{onClick:()=>{x(""),v(t=>({...t,teacher:""})),f(!1)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(le,{className:"w-4 h-4"})}),P&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50",children:z?e.jsxs("div",{className:"px-3 py-2 text-gray-500 text-center",children:[e.jsx(pe,{className:"w-4 h-4 animate-spin mx-auto mb-1"}),"×˜×•×¢×Ÿ ×ž×•×¨×™×..."]}):Ve.length>0?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ye("","×›×œ ×”×ž×•×¨×™×"),className:`w-full text-right px-3 py-2 hover:bg-gray-50 border-b border-gray-100 ${u.teacher===""?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:"×›×œ ×”×ž×•×¨×™×"}),Ve.map(t=>e.jsx("button",{onClick:()=>Ye(t._id,t.personalInfo?.fullName||"×ž×•×¨×” ×œ×œ× ×©×"),className:`w-full text-right px-3 py-2 hover:bg-gray-50 ${u.teacher===t._id?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:t.personalInfo?.fullName||"×ž×•×¨×” ×œ×œ× ×©×"},t._id))]}):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-center",children:"×œ× × ×ž×¦××• ×ž×•×¨×™×"})})]}),e.jsxs("select",{value:u.stageLevel,onChange:t=>v(n=>({...n,stageLevel:t.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×›×œ ×”×©×œ×‘×™×"}),[1,2,3,4,5,6,7,8].map(t=>e.jsxs("option",{value:t,children:["×©×œ×‘ ",t]},t))]}),e.jsxs("select",{value:u.orphaned,onChange:t=>v(n=>({...n,orphaned:t.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×›×œ ×”×¡×˜×˜×•×¡×™×"}),e.jsx("option",{value:"true",children:"×¨×©×•×ž×•×ª ×™×ª×•×ž×•×ª"}),e.jsx("option",{value:"false",children:"×¨×©×•×ž×•×ª ×ª×§×™× ×•×ª"})]}),e.jsxs("select",{value:u.noActivity,onChange:t=>v(n=>({...n,noActivity:t.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×›×œ ×”×¤×¢×™×œ×•×™×•×ª"}),e.jsx("option",{value:"true",children:"××™×Ÿ ×¤×¢×™×œ×•×ª"}),e.jsx("option",{value:"false",children:"×™×© ×¤×¢×™×œ×•×ª"})]}),e.jsxs("button",{onClick:de,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4 ml-2"}),"×”×•×¡×£ ×ª×œ×ž×™×“"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(re,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary-600 mb-1",children:Se}),e.jsx("div",{className:"text-sm text-gray-600",children:"×¡×”×´×› ×ª×œ×ž×™×“×™×"})]})}),e.jsx(re,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-success-600 mb-1",children:Ge}),e.jsx("div",{className:"text-sm text-gray-600",children:"×¤×¢×™×œ×™×"})]})}),e.jsx(re,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-1",children:is}),e.jsx("div",{className:"text-sm text-gray-600",children:"×œ× ×¤×¢×™×œ×™×"})]})}),e.jsx(re,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:os}),e.jsx("div",{className:"text-sm text-gray-600",children:"×¢× ×©×™×¢×•×¨×™×"})]})})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:T||u.orchestra||u.instrument||u.teacher||u.stageLevel?e.jsxs("span",{children:["×ž×¦×™×’ ",q.length," ×ž×ª×•×š ",Se," ×ª×œ×ž×™×“×™×"]}):e.jsxs("span",{children:['×¡×”"×› ',Se," ×ª×œ×ž×™×“×™×"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:ze,className:`flex items-center px-3 py-1 rounded-lg text-xs transition-colors ${U?"bg-gray-500 text-white hover:bg-gray-600":"bg-blue-500 text-white hover:bg-blue-600"}`,title:U?"×‘×˜×œ ×‘×—×™×¨×” ×ž×¨×•×‘×”":"×”×¤×¢×œ ×‘×—×™×¨×” ×ž×¨×•×‘×”",children:[e.jsx(Ce,{className:"w-3 h-3 ml-1"}),U?"×‘×˜×œ ×‘×—×™×¨×”":"×‘×—×™×¨×” ×ž×¨×•×‘×”"]}),U&&R.size>0&&e.jsxs("button",{onClick:Me,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-xs",children:[e.jsx(ne,{className:"w-3 h-3 ml-1"}),"×ž×—×§ × ×‘×—×¨×™× (",R.size,")"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>F("table"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${I==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":I==="table","aria-label":"×ª×¦×•×’×ª ×˜×‘×œ×”",children:[e.jsx(ws,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"×˜×‘×œ×”"}),I==="table"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>F("grid"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${I==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":I==="grid","aria-label":"×ª×¦×•×’×ª ×¨×©×ª",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"×¨×©×ª"}),I==="grid"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]})]})]})]}),I==="table"?e.jsx(us,{columns:ds,data:q,onRowClick:t=>{console.log("=== ROW CLICKED ==="),console.log("Row data:",t),console.log("Student ID from row:",t.id),oe(t.id)},rowClassName:"hover:bg-gray-50 cursor-pointer transition-colors"}):e.jsxs("div",{children:[U&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:R.size===q.length&&q.length>0,onChange:t=>{t.target.checked?W(new Set(q.map(n=>n.id))):W(new Set)},className:"w-4 h-4 text-blue-600 bg-white border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["×‘×—×¨ ×”×›×œ (",q.length," ×ª×œ×ž×™×“×™×)"]})]}),R.size>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["× ×‘×—×¨×•: ",R.size]}),e.jsx("button",{onClick:()=>W(new Set),className:"text-blue-600 hover:text-blue-800 underline",children:"× ×§×” ×‘×—×™×¨×”"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:q.map(t=>e.jsx(ks,{student:t.originalStudent,showInstruments:!0,showTeacherAssignments:!0,showParentContact:!1,onClick:()=>{U?xe(t.id,!R.has(t.id)):oe(t.id)},onDelete:ve,className:"h-full hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1",isSelectMode:U,isSelected:R.has(t.id),onSelectionChange:xe},t.id))})]}),q.length===0&&!m&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"×œ× × ×ž×¦××• ×ª×œ×ž×™×“×™× ×”×ª×•××ž×™× ×œ×—×™×¤×•×©"}),e.jsx(_e,{isOpen:V,title:"×ž×—×™×§×ª ×ª×œ×ž×™×“",message:`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ×”×ª×œ×ž×™×“ ${H?.name}? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`,confirmText:"×ž×—×§",cancelText:"×‘×™×˜×•×œ",onConfirm:ts,onCancel:rs,variant:"danger"}),e.jsx(_e,{isOpen:!!G,title:"×¢×“×›×•×Ÿ ×©×œ×‘ ×”×ª×œ×ž×™×“",message:G?`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×©× ×•×ª ××ª ×©×œ×‘ ×”×ª×œ×ž×™×“ "${G.studentName}" ×ž×©×œ×‘ ${G.currentLevel} ×œ×©×œ×‘ ${G.newLevel}?`:"",confirmText:"×¢×“×›×Ÿ ×©×œ×‘",cancelText:"×‘×™×˜×•×œ",onConfirm:ls,onCancel:cs,variant:"primary"}),e.jsx(_s,{isOpen:a,studentId:H?.id||"",studentName:H?.name||"",onClose:()=>i(!1),onConfirm:es}),e.jsx(Os,{isOpen:g,preview:De,onClose:()=>w(!1)}),e.jsx(Bs,{isOpen:A,selectedStudentIds:Array.from(R),onClose:()=>ie(!1),onComplete:()=>{ie(!1),W(new Set),Le(!1),Z()}})]})}export{Xs as default};
