import{j as e,u as Ge,a as Xe,S as qe}from"../assets/index-DnlL1uC7.js";import{r as c,b as Je}from"./vendor-B2j9q2e_.js";import{c as We}from"./utils-Cgyyg58q.js";import{C as Y}from"./Card-Dv8YFTs-.js";import{S as fe,T as Ze}from"./Table-C0MH31ML.js";import{C as le}from"./ConfirmationModal-6LP76O7f.js";import{T as W,b as ye,U as He,Z as be,n as ne,X as ie,j as ce,_ as Z,i as G,$ as H,c as X,d as Ke,A as je,a0 as Qe,u as es,B as ss,M as ts,f as oe,J as rs,O as as,m as ls,P as ns,a1 as cs,a2 as is}from"./ui-26XYoSED.js";import{c as K,u as os,a as I}from"./cascade-deletion-C7j5aisD.js";import"./query-BI61muSV.js";const ds=({student:o,showInstruments:r=!0,showTeacherAssignments:C=!0,showParentContact:E=!1,onClick:u,onDelete:n,className:h="",isSelectMode:S=!1,isSelected:v=!1,onSelectionChange:k})=>{const p=o.academicInfo.instrumentProgress?.find(b=>b.isPrimary)||o.academicInfo.instrumentProgress?.[0],D=b=>({1:"bg-gray-100 text-gray-800",2:"bg-blue-100 text-blue-800",3:"bg-green-100 text-green-800",4:"bg-yellow-100 text-yellow-800",5:"bg-orange-100 text-orange-800",6:"bg-red-100 text-red-800",7:"bg-purple-100 text-purple-800",8:"bg-indigo-100 text-indigo-800"})[b]||"bg-gray-100 text-gray-800",d=b=>b.split(" ").map(T=>T[0]).join("").slice(0,2),O=b=>({1:"bg-gray-500",2:"bg-blue-500",3:"bg-green-500",4:"bg-yellow-500",5:"bg-orange-500",6:"bg-red-500",7:"bg-purple-500",8:"bg-indigo-500"})[b]||"bg-gray-500",[P,m]=c.useState(!1),x=b=>{b.stopPropagation(),m(!0)},_=()=>{n&&n(o._id),m(!1)},$=()=>{m(!1)},U=b=>{b.stopPropagation(),k&&k(o._id,b.target.checked)};return e.jsxs(Y,{className:`relative transition-all duration-200 hover:shadow-md ${u?"cursor-pointer hover:shadow-lg":""} ${v?"ring-2 ring-blue-500 bg-blue-50":""} ${h}`,onClick:u,padding:"md",children:[S&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("input",{type:"checkbox",checked:v,onChange:U,className:"w-4 h-4 text-blue-600 bg-white border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})}),e.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[e.jsx("div",{className:`
          w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm
          ${p?O(p.currentStage):"bg-gray-500"}
        `,children:d(o.personalInfo.fullName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:`text-lg font-semibold truncate ${v?"text-blue-900":"text-gray-900"} ${S?"ml-6":""}`,children:o.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[n&&e.jsx("button",{onClick:x,className:"p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"מחק תלמיד",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("div",{className:`w-3 h-3 rounded-full ${o.isActive?"bg-green-400":"bg-gray-300"}`}),e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["כיתה ",o.academicInfo.class]})]})]}),r&&p&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"כלי ראשי:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p.instrumentName}),e.jsxs("span",{className:`
                  inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                  ${D(p.currentStage)}
                `,children:["שלב ",p.currentStage]})]})}),C&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[o.teacherAssignments?.length||0," שיעורים שבועיים"]})]})}),r&&o.academicInfo.instrumentProgress&&o.academicInfo.instrumentProgress.length>1&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"כלים נוספים:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:o.academicInfo.instrumentProgress.filter(b=>!b.isPrimary).map((b,T)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:[b.instrumentName," (שלב ",b.currentStage,")"]},T))})]}),E&&o.personalInfo.parentName&&e.jsxs("div",{className:"border-t border-gray-100 pt-3 mt-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"פרטי הורה:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(He,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:o.personalInfo.parentName})]}),o.personalInfo.parentPhone&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(be,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:o.personalInfo.parentPhone})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(be,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600 font-mono",dir:"ltr",children:o.personalInfo.phone})]})})]})]}),e.jsx(le,{isOpen:P,title:"מחיקת תלמיד",message:`האם אתה בטוח שברצונך למחוק את התלמיד ${o.personalInfo.fullName}? פעולה זו לא ניתנת לביטול.`,confirmText:"מחק",cancelText:"ביטול",onConfirm:_,onCancel:$,variant:"danger"})]})},ms=ds,xs=({isOpen:o,studentId:r,studentName:C,onClose:E,onConfirm:u})=>{const[n,h]=c.useState(null),[S,v]=c.useState(!1),[k,p]=c.useState(null),[D,d]=c.useState({createSnapshot:!0,skipValidation:!1,deleteDocuments:!0,notifyUsers:!1,reason:"Safe deletion via UI"});c.useEffect(()=>{o&&r&&O()},[o,r]);const O=async()=>{v(!0),p(null);try{const m=await K.previewDeletion(r);h(m)}catch(m){console.error("Error loading deletion preview:",m),p(m.message||"שגיאה בטעינת תצוגה מקדימה")}finally{v(!1)}},P=()=>{u(r,D)};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"מחיקה מאובטחת"})]}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:["מחיקת התלמיד: ",C]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"פעולה זו תמחק את התלמיד וכל הנתונים הקשורים אליו. המערכת תבצע בדיקות בטיחות ותיצור גיבוי לפני המחיקה."})]}),S&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"טוען תצוגה מקדימה..."})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"שגיאה"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:k})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"סיכום השפעה"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:'סה"כ רשומות'}),e.jsx("div",{className:"text-xl font-bold text-gray-900",children:n.summary?.totalRecords||0})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"זמן משוער"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[n.summary?.estimatedDuration||0," שניות"]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:`p-4 rounded-lg border ${n.summary?.riskLevel==="high"?"bg-red-50 border-red-200":n.summary?.riskLevel==="medium"?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:`w-5 h-5 ${n.summary?.riskLevel==="high"?"text-red-600":n.summary?.riskLevel==="medium"?"text-yellow-600":"text-green-600"}`}),e.jsxs("span",{className:"font-medium",children:["רמת סיכון: ",n.summary?.riskLevel==="high"?"גבוהה":n.summary?.riskLevel==="medium"?"בינונית":"נמוכה"]})]})})}),n.summary?.affectedCollections?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"אזורים מושפעים"}),e.jsx("div",{className:"space-y-2",children:n.summary.affectedCollections.map((m,x)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx(X,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:m})]},x))})]}),n.warnings?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"אזהרות"}),e.jsx("div",{className:"space-y-2",children:n.warnings.map((m,x)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx(ce,{className:"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-yellow-800",children:m})]},x))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"אפשרויות מחיקה"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.createSnapshot,onChange:m=>d(x=>({...x,createSnapshot:m.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"צור גיבוי לפני המחיקה (מומלץ)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.deleteDocuments,onChange:m=>d(x=>({...x,deleteDocuments:m.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"מחק גם קבצים ומסמכים"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.notifyUsers,onChange:m=>d(x=>({...x,notifyUsers:m.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"שלח התראות למורים קשורים"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.skipValidation,onChange:m=>d(x=>({...x,skipValidation:m.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"דלג על בדיקות תקינות (לא מומלץ)"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"סיבת המחיקה"}),e.jsx("textarea",{value:D.reason,onChange:m=>d(x=>({...x,reason:m.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"הזן סיבה למחיקה..."})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{children:"המחיקה תחל לאחר אישור"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"ביטול"}),e.jsxs("button",{onClick:P,disabled:S||!n?.canProceed,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ne,{className:"w-4 h-4"}),"מחק באופן מאובטח"]})]})]})]})}):null},hs=xs,gs=({isOpen:o,preview:r,onClose:C})=>{if(!o||!r)return null;const E=n=>{switch(n){case"lessons":return e.jsx(ye,{className:"w-4 h-4"});case"attendance":return e.jsx(oe,{className:"w-4 h-4"});case"orchestras":return e.jsx(ts,{className:"w-4 h-4"});case"theoryClasses":return e.jsx(ss,{className:"w-4 h-4"});case"documents":return e.jsx(es,{className:"w-4 h-4"});case"payments":return e.jsx(Qe,{className:"w-4 h-4"});default:return e.jsx(H,{className:"w-4 h-4"})}},u=n=>{switch(n){case"lessons":return"שיעורים";case"attendance":return"נוכחות";case"orchestras":return"תזמורות";case"theoryClasses":return"תיאוריה";case"documents":return"מסמכים";case"payments":return"תשלומים";case"rehearsals":return"חזרות";case"assignments":return"הקצאות";default:return n}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"השפעת המחיקה"})]}),e.jsx("button",{onClick:C,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"סיכום כללי"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:'סה"כ רשומות'}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:r.summary?.totalRecords||0})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"זמן משוער"}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[r.summary?.estimatedDuration||0,"s"]})]}),e.jsxs("div",{className:`p-4 border rounded-lg ${r.summary?.riskLevel==="high"?"bg-red-50 border-red-200":r.summary?.riskLevel==="medium"?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:[e.jsx("div",{className:`text-sm mb-1 ${r.summary?.riskLevel==="high"?"text-red-600":r.summary?.riskLevel==="medium"?"text-yellow-600":"text-green-600"}`,children:"רמת סיכון"}),e.jsx("div",{className:`text-2xl font-bold ${r.summary?.riskLevel==="high"?"text-red-900":r.summary?.riskLevel==="medium"?"text-yellow-900":"text-green-900"}`,children:r.summary?.riskLevel==="high"?"גבוהה":r.summary?.riskLevel==="medium"?"בינונית":"נמוכה"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"פירוט מפורט"}),e.jsx("div",{className:"space-y-4",children:Object.entries(r.details||{}).map(([n,h])=>{if(!h||Array.isArray(h)&&h.length===0)return null;const S=Array.isArray(h)?h.length:h.count||0;return S===0?null:e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[E(n),e.jsx("span",{className:"font-medium text-gray-900",children:u(n)})]}),e.jsxs("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:[S," רשומות"]})]}),Array.isArray(h)&&h.length>0&&e.jsx("div",{className:"p-4 max-h-40 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[h.slice(0,10).map((v,k)=>e.jsx("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:v.title||v.name||v.date||`פריט ${k+1}`},k)),h.length>10&&e.jsxs("div",{className:"text-sm text-gray-500 text-center py-2",children:["ועוד ",h.length-10," פריטים..."]})]})})]},n)})})]}),r.dependencies?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"תלויות"}),e.jsx("div",{className:"space-y-2",children:r.dependencies.map((n,h)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(je,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-orange-900",children:[n.type,": ",n.entity]}),e.jsx("div",{className:"text-sm text-orange-700",children:n.description})]})]},h))})]}),r.warnings?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"אזהרות"}),e.jsx("div",{className:"space-y-2",children:r.warnings.map((n,h)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(je,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-yellow-800",children:n})]},h))})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsx("div",{className:`p-4 rounded-lg ${r.canProceed?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r.canProceed?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`font-medium ${r.canProceed?"text-green-900":"text-red-900"}`,children:r.canProceed?"ניתן לבצע מחיקה":"לא ניתן לבצע מחיקה עקב תלויות קריטיות"})]})})})]}),e.jsx("div",{className:"flex items-center justify-end p-6 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:C,className:"px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"סגור"})})]})})},us=gs,ps=({isOpen:o,selectedStudentIds:r,onClose:C,onComplete:E})=>{const[u,n]=c.useState("preview"),[h,S]=c.useState(!1),[v,k]=c.useState(null),[p,D]=c.useState([]),[d,O]=c.useState({current:0,total:0,stage:""}),[P,m]=c.useState({success:0,failed:0,details:[]});c.useEffect(()=>{o&&r.length>0&&x()},[o,r]);const x=async()=>{S(!0),k(null);try{const l=r.map(async w=>{try{const A=await K.previewDeletion(w);return{studentId:w,studentName:`תלמיד ${w}`,canDelete:A.canProceed,riskLevel:A.summary?.riskLevel||"low",totalRecords:A.summary?.totalRecords||0,warnings:A.warnings||[],errors:[]}}catch(A){return{studentId:w,studentName:`תלמיד ${w}`,canDelete:!1,riskLevel:"high",totalRecords:0,warnings:[],errors:[A.message||"שגיאה בטעינת תצוגה מקדימה"]}}}),y=await Promise.all(l);D(y)}catch(l){console.error("Error loading batch previews:",l),k(l.message||"שגיאה בטעינת תצוגות מקדימות")}finally{S(!1)}},_=async()=>{const l=p.filter(B=>B.canDelete);if(l.length===0){k("אין תלמידים שניתן למחוק");return}n("progress"),O({current:0,total:l.length,stage:"מתחיל מחיקה..."});const y=[];let w=0,A=0;for(let B=0;B<l.length;B++){const z=l[B];O({current:B+1,total:l.length,stage:`מוחק ${z.studentName}...`});try{await K.executeDelete(z.studentId,{createSnapshot:!0,batchMode:!0,batchIndex:B+1,batchTotal:l.length}),w++,y.push({studentId:z.studentId,studentName:z.studentName,success:!0,error:null})}catch(L){A++,y.push({studentId:z.studentId,studentName:z.studentName,success:!1,error:L.message||"שגיאה במחיקה"})}await new Promise(L=>setTimeout(L,500))}m({success:w,failed:A,details:y}),n("complete")},$=()=>{u!=="progress"&&(u==="complete"&&P.success>0?E():C())};if(!o)return null;const U=p.filter(l=>l.canDelete).length,b=p.filter(l=>l.riskLevel==="high").length,T=p.reduce((l,y)=>l+y.totalRecords,0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-6 h-6 text-red-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["מחיקה מרובת תלמידים (",r.length,")"]})]}),e.jsx("button",{onClick:$,disabled:u==="progress",className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:e.jsx(ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:[u==="preview"&&e.jsxs("div",{className:"p-6",children:[h&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"טוען תצוגות מקדימות..."})]}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium text-red-900",children:"שגיאה"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:v})]}),p.length>0&&!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:r.length}),e.jsx("div",{className:"text-sm text-blue-600",children:"נבחרו"})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:U}),e.jsx("div",{className:"text-sm text-green-600",children:"ניתן למחוק"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:b}),e.jsx("div",{className:"text-sm text-red-600",children:"סיכון גבוה"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:T}),e.jsx("div",{className:"text-sm text-gray-600",children:'סה"כ רשומות'})]})]}),e.jsx("div",{className:"space-y-3",children:p.map(l=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.canDelete?e.jsx(X,{className:"w-5 h-5 text-green-600"}):e.jsx(G,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:l.studentName}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.riskLevel==="high"?"bg-red-100 text-red-800":l.riskLevel==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:l.riskLevel==="high"?"סיכון גבוה":l.riskLevel==="medium"?"סיכון בינוני":"סיכון נמוך"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.totalRecords," רשומות"]})]}),l.warnings.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:l.warnings.map((y,w)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-yellow-700",children:[e.jsx(ce,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:y})]},w))}),l.errors.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:l.errors.map((y,w)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-red-700",children:[e.jsx(G,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:y})]},w))})]},l.studentId))})]})]}),u==="progress"&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Z,{className:"w-12 h-12 animate-spin text-red-600 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"מבצע מחיקה..."}),e.jsx("p",{className:"text-gray-600 mb-6",children:d.stage}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsxs("span",{children:[d.current," מתוך ",d.total]}),e.jsxs("span",{children:[Math.round(d.current/d.total*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-600 h-2 rounded-full transition-all duration-300",style:{width:`${d.current/d.total*100}%`}})})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"אנא המתן עד לסיום הפעולה. אל תסגור את החלון."})]})}),u==="complete"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(X,{className:"w-12 h-12 text-green-600 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"המחיקה הושלמה"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-900",children:P.success}),e.jsx("div",{className:"text-sm text-green-600",children:"נמחקו בהצלחה"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:P.failed}),e.jsx("div",{className:"text-sm text-red-600",children:"נכשלו"})]})]}),P.details.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"פירוט מלא:"}),P.details.map((l,y)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${l.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[l.success?e.jsx(X,{className:"w-4 h-4 text-green-600"}):e.jsx(G,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"flex-1",children:l.studentName}),l.error&&e.jsx("span",{className:"text-sm text-red-600",children:l.error})]},y))]})]})]}),u!=="progress"&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[u==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:["מוכן למחיקת ",U," תלמידים"]})]}),u==="complete"&&e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4"}),e.jsxs("span",{children:["הושלמו ",P.success," מחיקות"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:$,className:"px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:u==="complete"?"סגור":"ביטול"}),u==="preview"&&U>0&&e.jsxs("button",{onClick:_,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"}),"מחק ",U," תלמידים"]})]})]})]})})},fs=ps;function Is(){const o=Je(),{user:r}=Ge(),{currentSchoolYear:C,isLoading:E}=Xe(),[u,n]=c.useState([]),[h,S]=c.useState(!0),[v,k]=c.useState(null),[p,D]=c.useState(""),[d,O]=c.useState({orchestra:"",instrument:"",stageLevel:""}),[P,m]=c.useState(!1),[x,_]=c.useState(null),[$,U]=c.useState("table"),[b,T]=c.useState(!1),[l,y]=c.useState(null),[w,A]=c.useState(null),[B,z]=c.useState(!1),[L,Q]=c.useState(null),[Ne,de]=c.useState(null),[ee,q]=c.useState(null),[ve,se]=c.useState(!1),[we,Se]=c.useState(!1),[ke,te]=c.useState(!1),[N,R]=c.useState(new Set),[Ce,bs]=c.useState(null),[M,me]=c.useState(!1);os(),c.useEffect(()=>{const s=()=>{ee&&q(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[ee]),c.useEffect(()=>{E||V()},[C,E]);const Le=()=>!r||r.role==="admin"||r.roles?.includes("admin")||r.role==="מנהל"||r.roles?.includes("מנהל")?"admin":r.role==="teacher"||r.roles?.includes("teacher")||r.role==="מורה"||r.roles?.includes("מורה")||r.teaching?.studentIds?.length>0?"teacher":r.role==="theory-teacher"||r.roles?.includes("theory-teacher")||r.roles?.includes("theory_teacher")||r.role==="מורה תיאוריה"||r.roles?.includes("מורה תיאוריה")?"theory-teacher":r.role==="conductor"||r.roles?.includes("conductor")||r.role==="מנצח"||r.roles?.includes("מנצח")||r.conducting?.orchestraIds?.length>0?"conductor":"admin",V=async()=>{try{S(!0),k(null);const s=Le();console.log("Loading students for user role:",s,"User:",r?.personalInfo?.fullName);let t=[];if(s==="admin"){const a=C?{schoolYearId:C._id}:{};t=await I.students.getStudents(a),console.log("Admin - loaded all students:",t.length)}else if(s==="teacher"){const j=(await I.teachers.getMyProfile())?.teaching?.studentIds||[];console.log("Teacher - assigned student IDs:",j),j.length>0?(t=await I.students.getBatchStudents(j),console.log("Teacher - loaded assigned students:",t.length)):(t=[],console.log("Teacher - no assigned students"))}else{const a=C?{schoolYearId:C._id}:{};t=await I.students.getStudents(a),console.log("Other role - loaded students:",t.length)}const i=t,g=i.map(a=>({id:a._id,fullName:a.personalInfo.fullName,phone:a.personalInfo.phone,age:a.personalInfo.age,class:a.academicInfo.class,primaryInstrument:a.academicInfo.instrumentProgress.find(j=>j.isPrimary)?.instrumentName||a.academicInfo.instrumentProgress[0]?.instrumentName||"ללא כלי",currentStage:a.academicInfo.instrumentProgress.find(j=>j.isPrimary)?.currentStage||1,teacherAssignments:a.teacherAssignments,parentName:a.personalInfo.parentName,parentPhone:a.personalInfo.parentPhone,orchestraIds:a.enrollments.orchestraIds,isActive:a.isActive})).map(a=>({id:a.id,name:a.fullName,instrument:a.primaryInstrument,stageLevel:a.currentStage,orchestra:a.orchestraIds?.length>0?"תזמורת":"ללא תזמורת",grade:e.jsx(fe,{status:"completed",children:a.class}),status:e.jsx(fe,{status:a.isActive?"active":"inactive",children:a.isActive?"פעיל":"לא פעיל"}),teacherAssignments:a.teacherAssignments?.length||0,rawData:{...a,referenceCount:a.referenceCount||0,isOrphaned:a.isOrphaned||!1,hasNoRecentActivity:a.hasNoRecentActivity||!1,integrityStatus:a.integrityStatus||"healthy",lastActivity:a.lastActivity||null},originalStudent:i.find(j=>j._id===a.id),actions:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[M&&e.jsx("input",{type:"checkbox",checked:N.has(a.id),onChange:j=>{j.stopPropagation();const ae=new Set(N);j.target.checked?ae.add(a.id):ae.delete(a.id),R(ae)},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("button",{className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",onClick:j=>{j.stopPropagation(),console.log("Eye icon clicked for student:",a.id),re(a.id)},title:"צפה בפרטי התלמיד",children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",onClick:j=>{j.stopPropagation(),Ie(a.id)},title:"ערוך פרטי התלמיד",children:e.jsx(as,{className:"w-4 h-4"})}),(a.referenceCount||a.rawData?.referenceCount||0)>0?e.jsx("button",{className:"p-1.5 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded transition-colors",onClick:j=>{j.stopPropagation(),Ae(a.id,a.name)},title:"מחיקה מאובטחת",children:e.jsx(ne,{className:"w-4 h-4"})}):e.jsx("button",{className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded transition-colors",onClick:j=>{j.stopPropagation(),Re(a.id,a.name)},title:"מחק תלמיד",children:e.jsx(W,{className:"w-4 h-4"})})]})}));n(g)}catch(s){console.error("Error loading students:",s),k(s.message)}finally{S(!1)}},re=s=>{console.log("=== NAVIGATION DEBUG ==="),console.log("Student ID:",s),console.log("Target path:",`/students/${s}`),console.log("Current location:",window.location.pathname);const t=`/students/${s}`;try{o(t),console.log("Navigate function called successfully")}catch(i){console.error("Navigate failed, using window.location:",i),window.location.href=t}},Ie=async s=>{try{z(!0),_(s);const t=await I.students.getStudentById(s);A(t),m(!0)}catch(t){console.error("Error loading student for editing:",t),alert("שגיאה בטעינת נתוני התלמיד לעריכה")}finally{z(!1)}},De=()=>{_(null),m(!0)},xe=()=>{m(!1),_(null),A(null)},Pe=async s=>{try{let t=x;if(x){if(await I.students.updateStudent(x,s),w?.enrollments?.orchestraIds){const i=w.enrollments.orchestraIds,f=s.enrollments?.orchestraIds||[];for(const g of i)if(!f.includes(g))try{await I.orchestras.removeMember(g,x),console.log(`Removed student ${x} from orchestra ${g}`)}catch(a){console.error(`Failed to remove from orchestra ${g}:`,a)}for(const g of f)if(!i.includes(g))try{await I.orchestras.addMember(g,x),console.log(`Added student ${x} to orchestra ${g}`)}catch(a){console.error(`Failed to add to orchestra ${g}:`,a)}}else if(s.enrollments?.orchestraIds?.length>0)for(const i of s.enrollments.orchestraIds)try{await I.orchestras.addMember(i,x),console.log(`Added student ${x} to orchestra ${i}`)}catch(f){console.error(`Failed to add to orchestra ${i}:`,f)}}else if(t=(await I.students.createStudent(s))._id,s.enrollments?.orchestraIds?.length>0)for(const f of s.enrollments.orchestraIds)try{await I.orchestras.addMember(f,t),console.log(`Added new student ${t} to orchestra ${f}`)}catch(g){console.error(`Failed to add to orchestra ${f}:`,g)}V(),xe()}catch(t){throw console.error("Error saving student:",t),t}},$e=()=>{xe()},he=async s=>{try{await I.students.deleteStudent(s),V()}catch(t){console.error("Error deleting student:",t),alert("שגיאה במחיקת התלמיד")}},Ae=async(s,t)=>{y({id:s,name:t}),se(!0)},Me=()=>{if(N.size===0){alert("יש לבחור לפחות תלמיד אחד");return}te(!0)},Ee=()=>{me(!M),R(new Set)},ge=(s,t)=>{const i=new Set(N);t?i.add(s):i.delete(s),R(i)},Te=async(s,t)=>{try{await K.executeDelete(s,t),se(!1),y(null),V()}catch(i){console.error("Error in safe deletion:",i),alert("שגיאה במחיקה המאובטחת")}},Re=(s,t)=>{y({id:s,name:t}),T(!0)},Fe=()=>{l&&(he(l.id),y(null)),T(!1)},Oe=()=>{y(null),T(!1)},Ue=s=>{q(s)},ue=(s,t,i,f)=>{const g=f?i+1:i-1;g<1||g>8||Q({studentId:s,studentName:t,currentLevel:i,newLevel:g})},Be=async()=>{if(L)try{de(L.studentId),await I.students.updateStudentStageLevel(L.studentId,L.newLevel),await V(),Q(null),q(null)}catch(s){console.error("Error updating stage level:",s),alert("שגיאה בעדכון השלב: "+s.message)}finally{de(null)}},ze=()=>{Q(null),q(null)},F=u.filter(s=>{const t=!p||s.name.toLowerCase().includes(p.toLowerCase())||s.instrument.toLowerCase().includes(p.toLowerCase()),i=!d.orchestra||s.orchestra===d.orchestra,f=!d.instrument||s.instrument===d.instrument,g=!d.stageLevel||s.stageLevel===parseInt(d.stageLevel);return t&&i&&f&&g}),J=u.length,pe=u.filter(s=>s.rawData?.isActive).length,_e=J-pe,Ve=u.filter(s=>s.teacherAssignments>0).length,Ye=[...M?[{key:"select",header:e.jsx("input",{type:"checkbox",checked:N.size===F.length&&F.length>0,onChange:s=>{s.target.checked?R(new Set(F.map(t=>t.id))):R(new Set)},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-2 focus:ring-primary-500 cursor-pointer"}),render:s=>e.jsx("input",{type:"checkbox",checked:N.has(s.id),onChange:t=>{t.stopPropagation();const i=new Set(N);t.target.checked?i.add(s.id):i.delete(s.id),R(i)},onClick:t=>t.stopPropagation(),className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-2 focus:ring-primary-500 cursor-pointer"}),width:"60px",align:"center"}]:[],{key:"name",header:"שם התלמיד"},{key:"instrument",header:"כלי נגינה"},{key:"stageLevel",header:"שלב",align:"center",render:s=>{const t=ee===s.id;return Ne===s.id?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-8 flex items-center justify-center bg-blue-50 rounded-lg border-2 border-blue-200",children:e.jsx("span",{className:"text-blue-600 font-medium",children:"..."})})}):t?e.jsxs("div",{className:"flex items-center justify-center gap-1",onClick:f=>f.stopPropagation(),children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),ue(s.id,s.name,s.stageLevel,!1)},disabled:s.stageLevel<=1,className:"w-6 h-6 flex items-center justify-center bg-red-100 text-red-600 hover:bg-red-200 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-sm font-bold",title:"הורד שלב",children:"-"}),e.jsx("div",{className:"w-12 h-8 flex items-center justify-center bg-blue-50 rounded-lg border-2 border-blue-300 mx-1",children:e.jsx("span",{className:"text-blue-700 font-bold text-sm",children:s.stageLevel})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),ue(s.id,s.name,s.stageLevel,!0)},disabled:s.stageLevel>=8,className:"w-6 h-6 flex items-center justify-center bg-green-100 text-green-600 hover:bg-green-200 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-sm font-bold",title:"העלה שלב",children:"+"})]}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),Ue(s.id)},className:"w-8 h-8 flex items-center justify-center text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors font-medium border border-transparent hover:border-blue-200",title:"לחץ לעריכת השלב",children:s.stageLevel})})}},{key:"orchestra",header:"תזמורת"},{key:"grade",header:"כיתה",align:"center"},{key:"status",header:"סטטוס",align:"center"},{key:"lastActivity",header:"פעילות אחרונה",align:"center",render:s=>{const t=s.rawData.lastActivity;if(!t)return e.jsx("span",{className:"text-gray-400 text-xs",children:"-"});const i=new Date(t),g=Math.floor((new Date().getTime()-i.getTime())/(1e3*60*60*24));return e.jsx("span",{className:`text-xs ${g>30?"text-red-600":g>7?"text-yellow-600":"text-green-600"}`,children:g===0?"היום":g===1?"אתמול":`לפני ${g} ימים`})}},{key:"actions",header:"פעולות",align:"center",width:M?"120px":"140px"}];return h?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"טוען תלמידים..."})]})}):v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"❌ שגיאה בטעינת הנתונים"}),e.jsx("div",{className:"text-gray-600 mb-6",children:v}),e.jsx("button",{onClick:V,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"נסה שוב"})]}):e.jsxs("div",{className:"relative",children:[P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"טוען נתוני תלמיד..."})]}):e.jsx(qe,{onSubmit:Pe,onCancel:$e,isEdit:!!x,initialData:w})})}),e.jsx(Y,{className:"mb-6",padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:p,onChange:s=>D(s.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:d.orchestra,onChange:s=>O(t=>({...t,orchestra:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"כל התזמורות"}),e.jsx("option",{value:"תזמורת",children:"תזמורת"}),e.jsx("option",{value:"ללא תזמורת",children:"ללא תזמורת"})]}),e.jsxs("select",{value:d.instrument,onChange:s=>O(t=>({...t,instrument:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"כל הכלים"}),e.jsx("option",{value:"חלילית",children:"חלילית"}),e.jsx("option",{value:"חליל צד",children:"חליל צד"}),e.jsx("option",{value:"אבוב",children:"אבוב"}),e.jsx("option",{value:"בסון",children:"בסון"}),e.jsx("option",{value:"סקסופון",children:"סקסופון"}),e.jsx("option",{value:"קלרינט",children:"קלרינט"}),e.jsx("option",{value:"חצוצרה",children:"חצוצרה"}),e.jsx("option",{value:"קרן יער",children:"קרן יער"}),e.jsx("option",{value:"טרומבון",children:"טרומבון"}),e.jsx("option",{value:"טובה/בריטון",children:"טובה/בריטון"}),e.jsx("option",{value:"שירה",children:"שירה"}),e.jsx("option",{value:"כינור",children:"כינור"}),e.jsx("option",{value:"ויולה",children:"ויולה"}),e.jsx("option",{value:"צ'לו",children:"צ'לו"}),e.jsx("option",{value:"קונטרבס",children:"קונטרבס"}),e.jsx("option",{value:"פסנתר",children:"פסנתר"}),e.jsx("option",{value:"גיטרה",children:"גיטרה"}),e.jsx("option",{value:"גיטרה בס",children:"גיטרה בס"}),e.jsx("option",{value:"תופים",children:"תופים"})]}),e.jsxs("select",{value:d.stageLevel,onChange:s=>O(t=>({...t,stageLevel:s.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"כל השלבים"}),[1,2,3,4,5,6,7,8].map(s=>e.jsxs("option",{value:s,children:["שלב ",s]},s))]}),e.jsxs("button",{onClick:De,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(ns,{className:"w-4 h-4 ml-2"}),"הוסף תלמיד"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(Y,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary-600 mb-1",children:J}),e.jsx("div",{className:"text-sm text-gray-600",children:"סה״כ תלמידים"})]})}),e.jsx(Y,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-success-600 mb-1",children:pe}),e.jsx("div",{className:"text-sm text-gray-600",children:"פעילים"})]})}),e.jsx(Y,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-1",children:_e}),e.jsx("div",{className:"text-sm text-gray-600",children:"לא פעילים"})]})}),e.jsx(Y,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:Ve}),e.jsx("div",{className:"text-sm text-gray-600",children:"עם שיעורים"})]})})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:p||d.orchestra||d.instrument||d.stageLevel?e.jsxs("span",{children:["מציג ",F.length," מתוך ",J," תלמידים"]}):e.jsxs("span",{children:['סה"כ ',J," תלמידים"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Ee,className:`flex items-center px-3 py-1 rounded-lg text-xs transition-colors ${M?"bg-gray-500 text-white hover:bg-gray-600":"bg-blue-500 text-white hover:bg-blue-600"}`,title:M?"בטל בחירה מרובה":"הפעל בחירה מרובה",children:[e.jsx(oe,{className:"w-3 h-3 ml-1"}),M?"בטל בחירה":"בחירה מרובה"]}),M&&N.size>0&&e.jsxs("button",{onClick:Me,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-xs",children:[e.jsx(W,{className:"w-3 h-3 ml-1"}),"מחק נבחרים (",N.size,")"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>U("table"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${$==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":$==="table","aria-label":"תצוגת טבלה",children:[e.jsx(cs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"טבלה"}),$==="table"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>U("grid"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${$==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":$==="grid","aria-label":"תצוגת רשת",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"רשת"}),$==="grid"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]})]})]})]}),$==="table"?e.jsx(Ze,{columns:Ye,data:F,onRowClick:s=>{if(M){const t=new Set(N);t.has(s.id)?t.delete(s.id):t.add(s.id),R(t)}else re(s.id)},rowClassName:s=>{const t=N.has(s.id);return We("cursor-pointer transition-all duration-150",t?"bg-blue-50 hover:bg-blue-100 border-l-4 border-blue-500":"hover:bg-gray-50")}}):e.jsxs("div",{children:[M&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:N.size===F.length&&F.length>0,onChange:s=>{s.target.checked?R(new Set(F.map(t=>t.id))):R(new Set)},className:"w-4 h-4 text-blue-600 bg-white border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["בחר הכל (",F.length," תלמידים)"]})]}),N.size>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["נבחרו: ",N.size]}),e.jsx("button",{onClick:()=>R(new Set),className:"text-blue-600 hover:text-blue-800 underline",children:"נקה בחירה"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:F.map(s=>e.jsx(ms,{student:s.originalStudent,showInstruments:!0,showTeacherAssignments:!0,showParentContact:!1,onClick:()=>{M?ge(s.id,!N.has(s.id)):re(s.id)},onDelete:he,className:"h-full hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1",isSelectMode:M,isSelected:N.has(s.id),onSelectionChange:ge},s.id))})]}),F.length===0&&!h&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"לא נמצאו תלמידים התואמים לחיפוש"}),e.jsx(le,{isOpen:b,title:"מחיקת תלמיד",message:`האם אתה בטוח שברצונך למחוק את התלמיד ${l?.name}? פעולה זו לא ניתנת לביטול.`,confirmText:"מחק",cancelText:"ביטול",onConfirm:Fe,onCancel:Oe,variant:"danger"}),e.jsx(le,{isOpen:!!L,title:"עדכון שלב התלמיד",message:L?`האם אתה בטוח שברצונך לשנות את שלב התלמיד "${L.studentName}" משלב ${L.currentLevel} לשלב ${L.newLevel}?`:"",confirmText:"עדכן שלב",cancelText:"ביטול",onConfirm:Be,onCancel:ze,variant:"primary"}),e.jsx(hs,{isOpen:ve,studentId:l?.id||"",studentName:l?.name||"",onClose:()=>se(!1),onConfirm:Te}),e.jsx(us,{isOpen:we,preview:Ce,onClose:()=>Se(!1)}),e.jsx(fs,{isOpen:ke,selectedStudentIds:Array.from(N),onClose:()=>te(!1),onComplete:()=>{te(!1),R(new Set),me(!1),V()}})]})}export{Is as default};
