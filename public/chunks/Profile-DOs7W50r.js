import{j as e,a as H}from"../assets/index-BAwpfw4Y.js";import{R as ve,r as x}from"./vendor-E-WBaSU9.js";import{a as O,t as ie}from"./cascade-deletion-C-2LBfWA.js";import{a as V,E as se,v as K,T as ae,i as te,n as fe,j as pe,a6 as le,C as z,m as J,l as be,k as ye,W as G,S as oe,q as me,P as re,U,$ as je,a0 as Ne,B as ee,a7 as we,o as Se,X as Ie,y as Te,ad as Ce}from"./ui-BeR0qYie.js";import"./query-CMzvnXZ6.js";import"./utils-x1PSU_OZ.js";function ke({student:s,onEdit:S,onDelete:I,onViewDetails:i,onScheduleLesson:g,className:l=""}){const u=s.academicInfo?.instrumentProgress?.find(c=>c.isPrimary)||s.academicInfo?.instrumentProgress?.[0],n=u?.instrumentName||"לא הוגדר",m=u?.currentStage||0,C=10,T=s.scheduleInfo||s.teacherAssignments?.[0],h=T?`${T.day} ${T.startTime||T.time}`:null,y=T?.duration||60,f=s.academicInfo?.isActive!==!1&&s.status!=="inactive",w=f?"text-green-800 bg-green-100":"text-red-800 bg-red-100",D=f?"פעיל":"לא פעיל",v=f?be:ye;return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${l}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal text-lg",children:s.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${w}`,children:[ve.createElement(v,{className:"w-3 h-3"}),D]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(V,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-michal font-medium",children:n}),m>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-michal",children:["שלב ",m,"/",C]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>i(s.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"צפה בפרטים מלאים",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(s),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"עריכת תלמיד",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(s.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תלמיד",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[s.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-michal",children:["גיל: ",s.personalInfo.age]})]}),s.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-michal",children:["כיתה: ",s.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:s.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:s.personalInfo.phone})]})})]}),m>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 font-reisinger-michal",children:[e.jsx("span",{children:"התקדמות בכלי"}),e.jsxs("span",{children:[m,"/",C]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${m/C*100}%`}})}),e.jsxs("div",{className:"flex gap-1",children:[[...Array(Math.min(m,5))].map((c,L)=>e.jsx(le,{className:"w-3 h-3 text-yellow-400 fill-current"},L)),m>5&&e.jsxs("span",{className:"text-xs text-yellow-600 font-reisinger-michal",children:["+",m-5]})]})]}),h&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-michal",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"שיעור קבוע:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-michal text-blue-700",children:h}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsxs("span",{children:[y," דק'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i(s.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-michal transition-all duration-200 flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"פרטים מלאים"]}),g&&e.jsxs("button",{onClick:()=>g(s.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-michal transition-all duration-200 flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),"קבע שיעור"]})]})})]})}function ue(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState(0);x.useEffect(()=>{D()},[s]);const D=async(b=!0)=>{if(s?._id)try{b&&g(!0),y(null);const E=s._id,k=await O.teachers.getTeacher(E);if(!k)throw new Error("לא נמצא פרופיל מורה");const r=k?.teaching?.studentIds||[];if(r.length===0){console.log("No students assigned to teacher"),I([]),w(0);return}const t=await O.students.getBatchStudents(r);if(!Array.isArray(t))throw new Error("תגובה לא תקינה מהשרת");const p=t.filter(d=>r.includes(d._id)||r.includes(d.id));p.length!==t.length&&console.warn(`🔧 Component-level filtering: ${p.length}/${t.length} students match teacher's student IDs`);const N=p.map(d=>{const a=d.personalInfo?.fullName||"",o=a.split(" ");return{id:d._id,firstName:d.personalInfo?.firstName||o[0]||"",lastName:d.personalInfo?.lastName||o.slice(1).join(" ")||"",fullName:a,email:d.personalInfo?.email||d.contactInfo?.email||"",phone:d.personalInfo?.phone||d.contactInfo?.phone||"",instrument:d.academicInfo?.primaryInstrument||d.primaryInstrument||"",grade:d.academicInfo?.gradeLevel||"",status:d.academicInfo?.isActive!==!1?"active":"inactive",joinDate:d.createdAt,personalInfo:{fullName:a,phone:d.personalInfo?.phone||d.contactInfo?.phone,age:d.personalInfo?.age,class:d.personalInfo?.class||d.academicInfo?.class},academicInfo:{instrumentProgress:d.academicInfo?.instrumentProgress||[],isActive:d.academicInfo?.isActive!==!1},teacherAssignments:d.teacherAssignments||[],scheduleInfo:d.scheduleInfo}});I(N),w(0)}catch(E){console.error("Error loading teacher students:",E),y("שגיאה בטעינת רשימת התלמידים. בדוק את החיבור לאינטרנט ונסה שוב."),w(k=>k+1)}finally{b&&g(!1)}},v=S.filter(b=>l===""||`${b.firstName} ${b.lastName}`.toLowerCase().includes(l.toLowerCase())||b.instrument?.toLowerCase().includes(l.toLowerCase())||b.email?.toLowerCase().includes(l.toLowerCase())),c=async b=>{const E=S.find(r=>r.id===b),k=E?.personalInfo?.fullName||E?.fullName||"התלמיד";if(window.confirm(`האם אתה בטוח שברצונך למחוק את ${k}?

פעולה זו תמחק את כל הנתונים הקשורים לתלמיד ולא ניתנת לביטול.`))try{await O.students.deleteStudent(b),I(t=>t.filter(p=>p.id!==b));const r=document.createElement("div");r.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`<div class="flex items-center gap-2 font-reisinger-michal"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${k} נמחק בהצלחה</div>`,document.body.appendChild(r),setTimeout(()=>r.remove(),3e3)}catch(r){console.error("Error deleting student:",r);const t=document.createElement("div");t.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",t.innerHTML=`<div class="flex items-center gap-2 font-reisinger-michal"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>שגיאה במחיקת ${k}</div>`,document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)}},L=b=>{window.location.href=`/students/${b}`},M=b=>{const E=S.find(k=>k.id===b);E&&(console.log("Schedule lesson for:",E.personalInfo?.fullName),alert(`תכונה זו תהיה זמינה בקרוב עבור ${E.personalInfo?.fullName}`))},W=async b=>{try{if(C){const E={personalInfo:{firstName:b.firstName,lastName:b.lastName},contactInfo:{email:b.email,phone:b.phone},academicInfo:{gradeLevel:b.grade},status:b.status},k=await O.students.updateStudent(C.id,E),r={id:k._id,firstName:k.personalInfo?.firstName||"",lastName:k.personalInfo?.lastName||"",email:k.contactInfo?.email||"",phone:k.contactInfo?.phone||"",instrument:k.primaryInstrument||"",grade:k.academicInfo?.gradeLevel||"",status:k.status||"active",joinDate:k.createdAt};I(t=>t.map(p=>p.id===C.id?r:p))}else{const E=s?._id,k={personalInfo:{firstName:b.firstName,lastName:b.lastName},contactInfo:{email:b.email,phone:b.phone},academicInfo:{gradeLevel:b.grade},status:b.status,teacherId:E},r=await O.students.createStudent(k),t={id:r._id,firstName:r.personalInfo?.firstName||"",lastName:r.personalInfo?.lastName||"",email:r.contactInfo?.email||"",phone:r.contactInfo?.phone||"",instrument:r.primaryInstrument||"",grade:r.academicInfo?.gradeLevel||"",status:r.status||"active",joinDate:r.createdAt};I(p=>[...p,t])}m(!1),T(null)}catch(E){console.error("Error saving student:",E),alert("שגיאה בשמירת פרטי התלמיד")}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תלמידים..."})]})}):h?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-michal",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-michal mt-1",children:h})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-michal",children:"נסה שוב"}),f>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-michal",children:"רענן דף"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"התלמידים שלי"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," תלמידים רשומים"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"הוסף תלמיד"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תלמידים...",value:l,onChange:b=>u(b.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"לא נמצאו תלמידים":"אין תלמידים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת התלמיד הראשון שלך"}),!l&&e.jsxs("button",{onClick:()=>m(!0),className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:[e.jsx(G,{className:"w-4 h-4"}),"הוסף תלמיד ראשון"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-michal",children:"סה״כ תלמידים"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:S.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-michal",children:"פעילים"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:S.filter(b=>b.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-michal",children:"עם שיעורים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:S.filter(b=>b.scheduleInfo||b.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:v.map(b=>e.jsx(ke,{student:b,onEdit:E=>{T(E),m(!0)},onDelete:c,onViewDetails:L,onScheduleLesson:M},b.id))})]}),n&&e.jsx(Le,{student:C,onClose:()=>{m(!1),T(null)},onSubmit:W})]})}function Le({student:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({firstName:s?.firstName||"",lastName:s?.lastName||"",email:s?.email||"",phone:s?.phone||"",instrument:s?.instrument||"",grade:s?.grade||"",status:s?.status||"active",age:s?.personalInfo?.age||"",class:s?.personalInfo?.class||s?.grade||""}),[l,u]=x.useState(!1),[n,m]=x.useState({}),C=()=>{const h={};return i.firstName.trim()||(h.firstName="שם פרטי הוא שדה חובה"),i.lastName.trim()||(h.lastName="שם משפחה הוא שדה חובה"),i.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)&&(h.email="כתובת מייל לא תקינה"),i.phone&&!/^[\d\-\+\(\)\s]{8,15}$/.test(i.phone.replace(/\s/g,""))&&(h.phone="מספר טלפון לא תקין"),i.age&&(isNaN(Number(i.age))||Number(i.age)<5||Number(i.age)>25)&&(h.age="גיל צריך להיות בין 5 ל-25"),m(h),Object.keys(h).length===0},T=async h=>{if(h.preventDefault(),!!C()){u(!0);try{await I(i)}catch(y){console.error("Error submitting form:",y)}finally{u(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"עריכת תלמיד":"הוספת תלמיד חדש"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שם פרטי *"}),e.jsx("input",{type:"text",required:!0,value:i.firstName,onChange:h=>{g(y=>({...y,firstName:h.target.value})),n.firstName&&m(y=>({...y,firstName:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.firstName?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"הכנס שם פרטי"}),n.firstName&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שם משפחה *"}),e.jsx("input",{type:"text",required:!0,value:i.lastName,onChange:h=>{g(y=>({...y,lastName:h.target.value})),n.lastName&&m(y=>({...y,lastName:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.lastName?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"הכנס שם משפחה"}),n.lastName&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.lastName})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"גיל"}),e.jsx("input",{type:"number",min:"5",max:"25",value:i.age,onChange:h=>{g(y=>({...y,age:h.target.value})),n.age&&m(y=>({...y,age:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.age?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"גיל"}),n.age&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.age})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"כיתה"}),e.jsx("input",{type:"text",value:i.class,onChange:h=>g(y=>({...y,class:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"למשל: יא, יב, ט"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"כלי נגינה עיקרי"}),e.jsxs("select",{value:i.instrument,onChange:h=>g(y=>({...y,instrument:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר כלי נגינה"}),e.jsx("option",{value:"פסנתר",children:"פסנתר"}),e.jsx("option",{value:"כינור",children:"כינור"}),e.jsx("option",{value:"צ'לו",children:"צ'לו"}),e.jsx("option",{value:"ויולה",children:"ויולה"}),e.jsx("option",{value:"חצוצרה",children:"חצוצרה"}),e.jsx("option",{value:"טרומבון",children:"טרומבון"}),e.jsx("option",{value:"קלרינט",children:"קלרינט"}),e.jsx("option",{value:"חליל",children:"חליל"}),e.jsx("option",{value:"סקסופון",children:"סקסופון"}),e.jsx("option",{value:"הורן",children:"הורן"}),e.jsx("option",{value:"טובה",children:"טובה"}),e.jsx("option",{value:"כלי הקשה",children:"כלי הקשה"}),e.jsx("option",{value:"גיטרה",children:"גיטרה"}),e.jsx("option",{value:"קונטרבס",children:"קונטרבס"}),e.jsx("option",{value:"אחר",children:"אחר"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:'דוא"ל'}),e.jsx("input",{type:"email",value:i.email,onChange:h=>{g(y=>({...y,email:h.target.value})),n.email&&m(y=>({...y,email:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.email?"border-red-300 focus:border-red-500":"border-gray-300"}`,dir:"ltr",placeholder:"student@example.com"}),n.email&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"טלפון"}),e.jsx("input",{type:"tel",value:i.phone,onChange:h=>{g(y=>({...y,phone:h.target.value})),n.phone&&m(y=>({...y,phone:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.phone?"border-red-300 focus:border-red-500":"border-gray-300"}`,dir:"ltr",placeholder:"05X-XXXXXXX"}),n.phone&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סטטוס התלמיד"}),e.jsxs("select",{value:i.status,onChange:h=>g(y=>({...y,status:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"✅ פעיל - תלמיד פעיל"}),e.jsx("option",{value:"inactive",children:"⏸️ לא פעיל - השהייה זמנית"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",disabled:l,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-michal flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s?"מעדכן...":"מוסיף..."]}):e.jsx(e.Fragment,{children:s?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4"}),"עדכן תלמיד"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"הוסף תלמיד"]})})}),e.jsxs("button",{type:"button",onClick:S,disabled:l,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-michal flex items-center justify-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"ביטול"]})]})]}),Object.keys(n).length>0&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800 font-reisinger-michal text-sm",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"יש שגיאות בטופס, אנא תקן אותן ונסה שוב"})]})})]})})}function ge(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState([]),[D,v]=x.useState(null);x.useEffect(()=>{c()},[s]);const c=async()=>{if(s?._id)try{g(!0);const r=s._id,t=await O.teachers.getTeacher(r);if(!t)throw new Error("לא נמצא פרופיל מנצח");const p=t?.conducting?.orchestraIds||[];if(p.length===0){console.log("No orchestras assigned to conductor"),I([]);return}const N=await O.orchestras.getBatchOrchestras(p);if(!Array.isArray(N))throw new Error("תגובה לא תקינה מהשרת");const d=N.map(a=>({id:a._id,name:a.name,description:a.description,type:a.type,level:a.level,memberCount:a.memberCount||0,status:a.status||"active",rehearsalDay:a.rehearsalSchedule?.day,rehearsalTime:a.rehearsalSchedule?.time,venue:a.venue}));I(d)}catch(r){console.error("Error loading conductor orchestras:",r),v("שגיאה בטעינת רשימת התזמורות")}finally{g(!1)}},L=async r=>{try{const N=((await O.orchestras.getOrchestra(r)).memberDetails||[]).map(d=>({id:d._id,firstName:d.personalInfo?.firstName||"",lastName:d.personalInfo?.lastName||"",instrument:d.primaryInstrument||"",section:d.section||"",status:d.status||"active"}));w(N)}catch(t){console.error("Error loading orchestra members:",t)}},M=S.filter(r=>l===""||r.name.toLowerCase().includes(l.toLowerCase())||r.type.toLowerCase().includes(l.toLowerCase())||r.description?.toLowerCase().includes(l.toLowerCase())),W=async r=>{if(window.confirm("האם אתה בטוח שברצונך למחוק תזמורת זו?"))try{await O.orchestras.deleteOrchestra(r),I(t=>t.filter(p=>p.id!==r)),h===r&&(y(null),w([]))}catch(t){console.error("Error deleting orchestra:",t),alert("שגיאה במחיקת התזמורת")}},b=async r=>{try{if(C){const t={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue},p=await O.orchestras.updateOrchestra(C.id,t),N={id:p._id,name:p.name,description:p.description,type:p.type,level:p.level,memberCount:p.memberCount||0,status:p.status||"active",rehearsalDay:p.rehearsalSchedule?.day,rehearsalTime:p.rehearsalSchedule?.time,venue:p.venue};I(d=>d.map(a=>a.id===C.id?N:a))}else{const t=s?._id,p={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue,conductorId:t},N=await O.orchestras.createOrchestra(p),d={id:N._id,name:N.name,description:N.description,type:N.type,level:N.level,memberCount:N.memberCount||0,status:N.status||"active",rehearsalDay:N.rehearsalSchedule?.day,rehearsalTime:N.rehearsalSchedule?.time,venue:N.venue};I(a=>[...a,d])}m(!1),T(null)}catch(t){console.error("Error saving orchestra:",t),alert("שגיאה בשמירת פרטי התזמורת")}},E=r=>{switch(r){case"youth":return"תזמורת נוער";case"adult":return"תזמורת מבוגרים";case"chamber":return"תזמורת קאמרית";case"symphony":return"תזמורת סימפונית";default:return r}},k=r=>{switch(r){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return r}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת תזמורות..."})]})}):D?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:D})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"תזמורות שאני מנצח"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," תזמורות"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"הוסף תזמורת"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש תזמורות...",value:l,onChange:r=>u(r.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:M.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"לא נמצאו תזמורות":"אין תזמורות רשומות"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת התזמורת הראשונה שלך"})]}):M.map(r=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${h===r.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{y(r.id),L(r.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-michal",children:[E(r.type)," • ",k(r.level)]}),r.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-michal",children:r.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),T(r),m(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"עריכת תזמורת",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),W(r.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"מחיקת תזמורת",children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.memberCount||0," חברים"]})]}),r.rehearsalDay&&e.jsxs("span",{children:["חזרות: ",r.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"פעיל":"לא פעיל"})]})]},r.id))}),h&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:"חברי התזמורת"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-michal",children:"נהל חברים"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-michal",children:"אין חברים רשומים בתזמורת"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:f.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors duration-200 border border-transparent hover:border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-michal",children:[r.firstName," ",r.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-michal",children:[r.instrument," • ",r.section]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"פעיל":"לא פעיל"})]},r.id))})]})]}),n&&e.jsx($e,{orchestra:C,onClose:()=>{m(!1),T(null)},onSubmit:b})]})}function $e({orchestra:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({name:s?.name||"",description:s?.description||"",type:s?.type||"youth",level:s?.level||"beginner",status:s?.status||"active",rehearsalDay:s?.rehearsalDay||"",rehearsalTime:s?.rehearsalTime||"",venue:s?.venue||""}),l=u=>{u.preventDefault(),I(i)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"עריכת תזמורת":"הוספת תזמורת חדשה"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שם התזמורת *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:u=>g(n=>({...n,name:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"תיאור"}),e.jsx("textarea",{value:i.description,onChange:u=>g(n=>({...n,description:u.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סוג תזמורת *"}),e.jsxs("select",{required:!0,value:i.type,onChange:u=>g(n=>({...n,type:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"תזמורת נוער"}),e.jsx("option",{value:"adult",children:"תזמורת מבוגרים"}),e.jsx("option",{value:"chamber",children:"תזמורת קאמרית"}),e.jsx("option",{value:"symphony",children:"תזמורת סימפונית"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"רמה *"}),e.jsxs("select",{required:!0,value:i.level,onChange:u=>g(n=>({...n,level:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"יום חזרות"}),e.jsx("input",{type:"text",value:i.rehearsalDay,onChange:u=>g(n=>({...n,rehearsalDay:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"כלומר: יום ראשון"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שעת חזרות"}),e.jsx("input",{type:"time",value:i.rehearsalTime,onChange:u=>g(n=>({...n,rehearsalTime:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"מקום חזרות"}),e.jsx("input",{type:"text",value:i.venue,onChange:u=>g(n=>({...n,venue:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סטטוס"}),e.jsxs("select",{value:i.status,onChange:u=>g(n=>({...n,status:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:s?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-michal",children:"ביטול"})]})]})]})})}function he(){const{user:s}=H(),[S,I]=x.useState(new Date),[i,g]=x.useState(null),[l,u]=x.useState(!0),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState(null);x.useEffect(()=>{D()},[S,s]);const D=async()=>{if(s?._id)try{u(!0);const a=s._id,o=c(S),j=L(S),A=await O.teachers.getTeacher(a);if(!A)throw new Error("לא נמצא פרופיל מורה");const F=A?.teaching?.timeBlocks||[];console.log(`Found ${F.length} time blocks for teacher`);let B=[];try{const $=A?.teaching?.studentIds||[];$.length>0&&(B=await O.students.getBatchStudents($),console.log(`Found ${B.length} students for schedule integration`))}catch($){console.warn("Failed to load students for schedule:",$)}const _=M(o),ne={ראשון:0,שני:1,שלישי:2,רביעי:3,חמישי:4,שישי:5,שבת:6};F.length>0&&F.forEach($=>{const q=ne[$.day];q!==void 0&&_[q]&&_[q].lessons.push({id:`availability-${$.day}-${$.startTime}`,startTime:$.startTime,endTime:$.endTime,studentName:"זמין להוראה",studentId:null,instrument:"",lessonType:"availability",status:"available",notes:`זמין ${$.totalDuration} דקות`})}),B.length>0&&B.forEach($=>{const q=$.teacherAssignments||[],X=$.scheduleInfo;if(q.filter(P=>P.teacherId===a).forEach(P=>{const R=ne[P.day];if(R!==void 0&&_[R]){const Q=$.academicInfo?.instrumentProgress?.find(Y=>Y.isPrimary)||$.academicInfo?.instrumentProgress?.[0],ce=_[R].lessons.findIndex(Y=>Y.startTime===P.time&&Y.lessonType==="availability"),de={id:`lesson-${$._id}-${P.day}`,startTime:P.time,endTime:v(P.time,P.duration),studentName:$.personalInfo?.fullName||"תלמיד",studentId:$._id,instrument:Q?.instrumentName||"",lessonType:"individual",status:"scheduled",notes:`${P.duration} דקות`,studentStage:Q?.currentStage,studentClass:$.personalInfo?.class||$.academicInfo?.class,studentPhone:$.personalInfo?.phone,isRecurring:!0,repeatType:"weekly"};ce!==-1?_[R].lessons[ce]=de:_[R].lessons.push(de)}}),X&&!q.find(P=>P.teacherId===a)){const P=ne[X.day];if(P!==void 0&&_[P]){const R=$.academicInfo?.instrumentProgress?.find(Q=>Q.isPrimary)||$.academicInfo?.instrumentProgress?.[0];_[P].lessons.push({id:`schedule-${$._id}`,startTime:X.startTime,endTime:X.endTime,studentName:$.personalInfo?.fullName||"תלמיד",studentId:$._id,instrument:R?.instrumentName||"",lessonType:"individual",status:"scheduled",notes:`${X.duration} דקות`,studentStage:R?.currentStage,studentClass:$.personalInfo?.class||$.academicInfo?.class,studentPhone:$.personalInfo?.phone,isRecurring:!0,repeatType:"weekly"})}}}),_.forEach($=>{$.lessons.sort((q,X)=>q.startTime.localeCompare(X.startTime))}),g({weekStart:o,weekEnd:j,days:_})}catch(a){console.error("Error loading teacher schedule:",a),w("שגיאה בטעינת לוח הזמנים");const o=c(S);g({weekStart:o,weekEnd:L(S),days:M(o)})}finally{u(!1)}},v=(a,o)=>{const[j,A]=a.split(":").map(Number),F=j*60+A+o,B=Math.floor(F/60),_=F%60;return`${B.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`},c=a=>{const o=new Date(a),j=o.getDay(),A=o.getDate()-j;return new Date(o.setDate(A))},L=a=>{const o=c(a);return o.setDate(o.getDate()+6),o},M=a=>{const o=[],j=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];for(let A=0;A<7;A++){const F=new Date(a);F.setDate(a.getDate()+A),o.push({date:F.toISOString().split("T")[0],dayName:j[A],lessons:[]})}return o},W=a=>{const o=new Date(S);o.setDate(S.getDate()+(a==="next"?7:-7)),I(o)},b=a=>a.slice(0,5),E=a=>new Date(a).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),k=()=>{const a=[];for(let o=8;o<=20;o++)a.push(`${o.toString().padStart(2,"0")}:00`),a.push(`${o.toString().padStart(2,"0")}:30`);return a},r=(a,o)=>{T({date:a,time:o}),y(null),m(!0)},t=(a,o)=>{T({date:o,time:a.startTime}),y(a),m(!0)},p=async a=>{if(window.confirm("האם אתה בטוח שברצונך למחוק שיעור זה?"))try{await O.teacherSchedule.deleteLesson(a),D()}catch(o){console.error("Error deleting lesson:",o),alert("שגיאה במחיקת השיעור")}},N=(a,o)=>i?.days.find(A=>A.date===a)?.lessons.find(A=>A.startTime===o);if(l)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען לוח זמנים..."})]})});if(f&&!i)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:f})});const d=k();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"לוח זמנים שבועי"}),e.jsx("p",{className:"text-gray-600 mt-1",children:i&&`${E(i.weekStart.toISOString().split("T")[0])} - ${E(i.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>I(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-michal",children:"השבוע"}),e.jsx("button",{onClick:()=>W("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-michal",children:"שעה"}),i?.days.map(a=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-michal",children:a.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-michal",children:E(a.date)})]},a.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:d.map(a=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-michal",children:b(a)}),i?.days.map(o=>{const j=N(o.date,a);return e.jsx("div",{className:"p-1 border-l border-gray-100 min-h-[60px]",children:j?e.jsxs("div",{className:`h-full p-2 rounded text-xs font-reisinger-michal cursor-pointer group relative transition-all hover:scale-[1.02] ${j.status==="available"?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300":j.status==="scheduled"?"bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm":j.status==="completed"?"bg-green-100 text-green-800 hover:bg-green-200 border border-green-300":"bg-red-100 text-red-800 hover:bg-red-200 border border-red-300"}`,title:j.lessonType==="availability"?j.notes:`${j.studentName}${j.instrument?" - "+j.instrument:""}${j.studentStage?" (שלב "+j.studentStage+")":""}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:j.lessonType==="availability"?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3 opacity-60"}),"זמין להוראה"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3 opacity-60"}),j.studentName||"תלמיד"]})}),e.jsxs("div",{className:"text-[10px] opacity-75 mt-0.5",children:[b(j.startTime),"-",b(j.endTime)]}),j.lessonType!=="availability"&&e.jsxs("div",{className:"mt-1 space-y-0.5",children:[j.instrument&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] opacity-80",children:[e.jsx(V,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:j.instrument}),j.studentStage&&e.jsxs("span",{className:"bg-white bg-opacity-60 px-1 rounded text-[9px]",children:["שלב ",j.studentStage]})]}),j.studentClass&&e.jsxs("div",{className:"text-[10px] opacity-70",children:["כיתה ",j.studentClass]}),j.isRecurring&&e.jsxs("div",{className:"flex items-center gap-1 text-[9px] opacity-60",children:[e.jsx(le,{className:"w-2 h-2"}),"שיעור קבוע"]})]})]})}),e.jsx("div",{className:"absolute top-1 left-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:j.lessonType!=="availability"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),j.studentId&&(window.location.href=`/students/${j.studentId}`)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"צפה בפרטי התלמיד",children:e.jsx(se,{className:"w-2.5 h-2.5 text-blue-600"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),t(j,o.date)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"ערוך שיעור",children:e.jsx(K,{className:"w-2.5 h-2.5 text-gray-600"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),p(j.id)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"מחק שיעור",children:e.jsx(ae,{className:"w-2.5 h-2.5 text-red-600"})})]}):e.jsx("button",{onClick:A=>{A.stopPropagation(),r(o.date,j.startTime)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"קבע שיעור",children:e.jsx(re,{className:"w-2.5 h-2.5 text-green-600"})})})]}):e.jsx("button",{onClick:()=>r(o.date,a),className:"w-full h-full flex items-center justify-center text-gray-300 hover:text-indigo-500 hover:bg-indigo-50 rounded transition-all group",title:"הוסף שיעור",children:e.jsx(re,{className:"w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"})})},`${o.date}-${a}`)})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-michal",children:"שיעורים קבועים"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType!=="availability").length,0)||0}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"השבוע הנוכחי"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-michal",children:"שעות הוראה"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType!=="availability").reduce((j,A)=>{const F=new Date(`2000-01-01T${A.startTime}`),B=new Date(`2000-01-01T${A.endTime}`);return j+(B.getTime()-F.getTime())/(1e3*60*60)},0),0)?.toFixed(1)||"0"}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"שעות בפועל"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-michal",children:"תלמידים פעילים"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-michal",children:new Set(i?.days.flatMap(a=>a.lessons.filter(o=>o.lessonType!=="availability").map(o=>o.studentId).filter(Boolean))||[]).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"השבוע הזה"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-medium text-yellow-900 font-reisinger-michal",children:"זמינות"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType==="availability").length,0)||0}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"חלונות זמן פנויים"})]})]}),n&&e.jsx(Ee,{lesson:h,timeSlot:C,onClose:()=>{m(!1),T(null),y(null)},onSubmit:()=>{m(!1),T(null),y(null),D()}})]})}function Ee({lesson:s,timeSlot:S,onClose:I,onSubmit:i}){const{user:g}=H(),[l,u]=x.useState({startTime:s?.startTime||S?.time||"",endTime:s?.endTime||"",studentName:s?.studentName||"",studentId:s?.studentId||"",instrument:s?.instrument||"",lessonType:s?.lessonType||"individual",status:s?.status||"scheduled",notes:s?.notes||""}),[n,m]=x.useState([]),[C,T]=x.useState(!1);x.useEffect(()=>{if(h(),l.startTime&&!l.endTime){const f=new Date(`2000-01-01T${l.startTime}`);f.setMinutes(f.getMinutes()+60),u(w=>({...w,endTime:f.toTimeString().slice(0,5)}))}},[l.startTime]);const h=async()=>{try{const f=g?._id;if(!f)return;const D=(await O.teachers.getTeacherStudents(f)).map(v=>({id:v._id,firstName:v.personalInfo?.firstName||"",lastName:v.personalInfo?.lastName||"",instrument:v.primaryInstrument||""}));m(D)}catch(f){console.error("Error loading students:",f)}},y=async f=>{f.preventDefault();try{T(!0);const w=g?._id,D={...l,teacherId:w,date:S?.date,studentId:l.studentId||void 0};s?await O.teacherSchedule.updateLesson(s.id,D):await O.teacherSchedule.createLesson(D),i()}catch(w){console.error("Error saving lesson:",w),alert("שגיאה בשמירת השיעור")}finally{T(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"עריכת שיעור":"הוספת שיעור חדש"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שעת התחלה *"}),e.jsx("input",{type:"time",required:!0,value:l.startTime,onChange:f=>u(w=>({...w,startTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שעת סיום *"}),e.jsx("input",{type:"time",required:!0,value:l.endTime,onChange:f=>u(w=>({...w,endTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"תלמיד"}),e.jsxs("select",{value:l.studentId,onChange:f=>{const w=n.find(D=>D.id===f.target.value);u(D=>({...D,studentId:f.target.value,studentName:w?`${w.firstName} ${w.lastName}`:"",instrument:w?.instrument||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"בחר תלמיד"}),n.map(f=>e.jsxs("option",{value:f.id,children:[f.firstName," ",f.lastName,f.instrument&&` - ${f.instrument}`]},f.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"כלי נגינה"}),e.jsx("input",{type:"text",value:l.instrument,onChange:f=>u(w=>({...w,instrument:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סוג שיעור"}),e.jsxs("select",{value:l.lessonType,onChange:f=>u(w=>({...w,lessonType:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"individual",children:"שיעור פרטי"}),e.jsx("option",{value:"group",children:"שיעור קבוצתי"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סטטוס"}),e.jsxs("select",{value:l.status,onChange:f=>u(w=>({...w,status:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"scheduled",children:"מתוכנן"}),e.jsx("option",{value:"completed",children:"הושלם"}),e.jsx("option",{value:"cancelled",children:"בוטל"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"הערות"}),e.jsx("textarea",{value:l.notes,onChange:f=>u(w=>({...w,notes:f.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",disabled:C,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-michal",children:C?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mx-auto"}):s?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:I,disabled:C,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-michal",children:"ביטול"})]})]})]})})}function xe(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState([]),[D,v]=x.useState(null);x.useEffect(()=>{c()},[s]);const c=async()=>{if(s?._id)try{g(!0);const t=s._id,d=(await O.theory.getTheoryLessons()).filter(a=>a.teacherId===t).map(a=>({id:a._id,name:a.name,description:a.description,level:a.level,duration:a.duration,capacity:a.capacity,enrolledCount:a.enrolledStudentIds?.length||0,schedule:{dayOfWeek:a.dayOfWeek,startTime:a.startTime,endTime:a.endTime},status:a.isActive?"active":"inactive",venue:a.location,materials:a.materials||[]}));I(d)}catch(t){console.error("Error loading theory lessons:",t),v("שגיאה בטעינת רשימת שיעורי התיאוריה")}finally{g(!1)}},L=async t=>{try{const N=(await O.theory.getTheoryLesson(t)).enrolledStudentIds||[];if(N.length===0){w([]);return}const a=(await O.students.getStudents({ids:N.join(",")})).map(o=>({id:o._id,firstName:o.personalInfo?.firstName||"",lastName:o.personalInfo?.lastName||"",grade:o.academicInfo?.gradeLevel,instrument:o.primaryInstrument,enrollmentDate:o.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));w(a)}catch(p){console.error("Error loading lesson students:",p)}},M=S.filter(t=>l===""||t.name.toLowerCase().includes(l.toLowerCase())||t.level.toLowerCase().includes(l.toLowerCase())||t.description?.toLowerCase().includes(l.toLowerCase())),W=async t=>{if(window.confirm("האם אתה בטוח שברצונך למחוק שיעור זה?"))try{await O.theory.deleteTheoryLesson(t),I(p=>p.filter(N=>N.id!==t)),h===t&&(y(null),w([]))}catch(p){console.error("Error deleting lesson:",p),alert("שגיאה במחיקת השיעור")}},b=async t=>{try{if(C){const p={name:t.name,description:t.description,level:t.level,duration:t.duration,capacity:t.capacity,dayOfWeek:t.schedule?.dayOfWeek,startTime:t.schedule?.startTime,endTime:t.schedule?.endTime,isActive:t.status==="active",location:t.venue},N=await O.theory.updateTheoryLesson(C.id,p),d={id:N._id,name:N.name,description:N.description,level:N.level,duration:N.duration,capacity:N.capacity,enrolledCount:N.enrolledStudentIds?.length||0,schedule:{dayOfWeek:N.dayOfWeek,startTime:N.startTime,endTime:N.endTime},status:N.isActive?"active":"inactive",venue:N.location,materials:N.materials||[]};I(a=>a.map(o=>o.id===C.id?d:o))}else{const p=s?._id,N={name:t.name,description:t.description,level:t.level,duration:t.duration,capacity:t.capacity,dayOfWeek:t.schedule?.dayOfWeek,startTime:t.schedule?.startTime,endTime:t.schedule?.endTime,isActive:t.status==="active",location:t.venue,teacherId:p},d=await O.theory.createTheoryLesson(N),a={id:d._id,name:d.name,description:d.description,level:d.level,duration:d.duration,capacity:d.capacity,enrolledCount:d.enrolledStudentIds?.length||0,schedule:{dayOfWeek:d.dayOfWeek,startTime:d.startTime,endTime:d.endTime},status:d.isActive?"active":"inactive",venue:d.location,materials:d.materials||[]};I(o=>[...o,a])}m(!1),T(null)}catch(p){console.error("Error saving lesson:",p),alert("שגיאה בשמירת פרטי השיעור")}},E=t=>{switch(t){case"beginner":return"מתחילים";case"intermediate":return"בינוניים";case"advanced":return"מתקדמים";default:return t}},k=t=>t.substring(0,5),r=t=>({sunday:"יום ראשון",monday:"יום שני",tuesday:"יום שלישי",wednesday:"יום רביעי",thursday:"יום חמישי",friday:"יום שישי",saturday:"יום שבת"})[t.toLowerCase()]||t;return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען רשימת שיעורים..."})]})}):D?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:D})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"שיעורי התיאוריה שלי"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," שיעורים"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"הוסף שיעור"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"חיפוש שיעורים...",value:l,onChange:t=>u(t.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:M.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"לא נמצאו שיעורים":"אין שיעורים רשומים"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"נסה מילות חיפוש אחרות":"התחל בהוספת השיעור הראשון שלך"})]}):M.map(t=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${h===t.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{y(t.id),L(t.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-michal",children:[E(t.level)," • ",t.duration," דקות"]}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-michal",children:t.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),T(t),m(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),W(t.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:r(t.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{children:[k(t.schedule.startTime)," - ",k(t.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.enrolledCount||0,"/",t.capacity]})]}),t.venue&&e.jsx("span",{children:t.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status==="active"?"פעיל":"לא פעיל"})]})]},t.id))}),h&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:"תלמידי השיעור"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-michal",children:"נהל תלמידים"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-michal",children:"אין תלמידים רשומים לשיעור"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:f.map(t=>e.jsx("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-michal",children:[t.firstName," ",t.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-michal",children:[t.instrument&&`${t.instrument} • `,t.grade&&`כיתה ${t.grade} • `,"רישום: ",new Date(t.enrollmentDate).toLocaleDateString("he-IL")]}),t.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-michal",children:["נוכחות: ",t.attendance.present,"/",t.attendance.total," שיעורים",e.jsxs("span",{className:`ml-2 ${t.attendance.present/t.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(t.attendance.present/t.attendance.total*100),"%)"]})]})]})},t.id))})]})]}),n&&e.jsx(De,{lesson:C,onClose:()=>{m(!1),T(null)},onSubmit:b})]})}function De({lesson:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({name:s?.name||"",description:s?.description||"",level:s?.level||"beginner",duration:s?.duration||60,capacity:s?.capacity||15,status:s?.status||"active",venue:s?.venue||"",schedule:{dayOfWeek:s?.schedule?.dayOfWeek||"sunday",startTime:s?.schedule?.startTime||"09:00",endTime:s?.schedule?.endTime||"10:00"}}),l=n=>{n.preventDefault(),I(i)},u=(n,m)=>{g(C=>({...C,schedule:{...C.schedule,[n]:m}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"עריכת שיעור תיאוריה":"הוספת שיעור תיאוריה חדש"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שם השיעור *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:n=>g(m=>({...m,name:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"תיאור השיעור"}),e.jsx("textarea",{value:i.description,onChange:n=>g(m=>({...m,description:n.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"רמה *"}),e.jsxs("select",{required:!0,value:i.level,onChange:n=>g(m=>({...m,level:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"מתחילים"}),e.jsx("option",{value:"intermediate",children:"בינוניים"}),e.jsx("option",{value:"advanced",children:"מתקדמים"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"משך השיעור (דקות) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:i.duration,onChange:n=>g(m=>({...m,duration:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"קיבולת תלמידים *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:i.capacity,onChange:n=>g(m=>({...m,capacity:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"סטטוס"}),e.jsxs("select",{value:i.status,onChange:n=>g(m=>({...m,status:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"פעיל"}),e.jsx("option",{value:"inactive",children:"לא פעיל"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"יום השיעור *"}),e.jsxs("select",{required:!0,value:i.schedule.dayOfWeek,onChange:n=>u("dayOfWeek",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"יום ראשון"}),e.jsx("option",{value:"monday",children:"יום שני"}),e.jsx("option",{value:"tuesday",children:"יום שלישי"}),e.jsx("option",{value:"wednesday",children:"יום רביעי"}),e.jsx("option",{value:"thursday",children:"יום חמישי"}),e.jsx("option",{value:"friday",children:"יום שישי"}),e.jsx("option",{value:"saturday",children:"יום שבת"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שעת התחלה *"}),e.jsx("input",{type:"time",required:!0,value:i.schedule.startTime,onChange:n=>u("startTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"שעת סיום *"}),e.jsx("input",{type:"time",required:!0,value:i.schedule.endTime,onChange:n=>u("endTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"מקום השיעור"}),e.jsx("input",{type:"text",value:i.venue,onChange:n=>g(m=>({...m,venue:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:s?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-michal",children:"ביטול"})]})]})]})})}function Ae(){const{user:s,checkAuthStatus:S}=H(),[I,i]=x.useState(!1),[g,l]=x.useState(!1),[u,n]=x.useState({type:null,message:""}),[m,C]=x.useState(null),[T,h]=x.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});x.useEffect(()=>{y()},[]);const y=async()=>{try{l(!0);const c=await ie.getMyProfile();C(c),h({fullName:c?.personalInfo?.fullName||"",email:c?.personalInfo?.email||"",phone:c?.personalInfo?.phone||"",address:c?.personalInfo?.address||"",birthDate:c?.personalInfo?.birthDate||""})}catch(c){console.error("Error fetching profile data:",c),n({type:"error",message:"שגיאה בטעינת פרטי הפרופיל"}),s&&h({fullName:s?.personalInfo?.fullName||"",email:s?.personalInfo?.email||s?.email||"",phone:s?.personalInfo?.phone||s?.phone||"",address:s?.personalInfo?.address||s?.address||"",birthDate:s?.personalInfo?.birthDate||s?.birthDate||""})}finally{l(!1)}},f=async()=>{try{l(!0),n({type:null,message:""});const c=await ie.updateMyProfile(T);C(c),S&&await S(!0),i(!1),n({type:"success",message:"הפרופיל עודכן בהצלחה"}),setTimeout(()=>{n({type:null,message:""})},3e3)}catch(c){console.error("Error updating profile:",c),n({type:"error",message:"שגיאה בעדכון הפרופיל. אנא נסה שוב."})}finally{l(!1)}},w=()=>{const c=m||s;h({fullName:c?.personalInfo?.fullName||"",email:c?.personalInfo?.email||c?.email||"",phone:c?.personalInfo?.phone||c?.phone||"",address:c?.personalInfo?.address||c?.address||"",birthDate:c?.personalInfo?.birthDate||c?.birthDate||""}),i(!1),n({type:null,message:""})},D=c=>c?new Date(c).toLocaleDateString("he-IL"):"",v=m||s;return g&&!v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-michal",children:"טוען פרטי פרופיל..."})]})}):e.jsxs("div",{className:"space-y-6",children:[u.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${u.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[u.type==="success"?e.jsx(be,{className:"w-5 h-5"}):e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-michal",children:u.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"פרטים אישיים"}),I?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:f,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"שמירה"})]}),e.jsxs("button",{onClick:w,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"ביטול"})]})]}):e.jsxs("button",{onClick:()=>i(!0),disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"עריכה"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"שם מלא"}),I?e.jsx("input",{type:"text",value:T.fullName,onChange:c=>h(L=>({...L,fullName:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן שם מלא"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-michal",children:T.fullName||"לא צוין"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:'דוא"ל'}),I?e.jsx("input",{type:"email",value:T.email,onChange:c=>h(L=>({...L,email:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",dir:"ltr",children:T.email||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"טלפון"}),I?e.jsx("input",{type:"tel",value:T.phone,onChange:c=>h(L=>({...L,phone:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",dir:"ltr",children:T.phone||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"כתובת"}),I?e.jsx("input",{type:"text",value:T.address,onChange:c=>h(L=>({...L,address:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"הזן כתובת"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",children:T.address||"לא צוין"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"תאריך לידה"}),I?e.jsx("input",{type:"date",value:T.birthDate,onChange:c=>h(L=>({...L,birthDate:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",children:D(T.birthDate)||"לא צוין"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-michal",children:"מידע תפקיד"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"תפקיד:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:(()=>{const c=v?.roles||[];if(c.length>0)return c.join(", ");const L=v?.role||"";switch(L){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return L||"לא צוין"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"מזהה משתמש:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal font-mono text-sm",children:v?.teacherId||v?._id||v?.id||"לא צוין"})]}),v?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"סטטוס:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:v.isActive?"פעיל":"לא פעיל"})]}),v?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"כלי נגינה:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:v.professionalInfo.instrument})]})]})]})]})}function Be(){const{user:s}=H(),[S,I]=x.useState("general"),[i,g]=x.useState(null),[l,u]=x.useState(!0);x.useEffect(()=>{s&&n()},[s]);const n=async()=>{try{if(u(!0),!(s?._id||s?.teacherId||s?.id)){console.warn("No user ID available for loading profile statistics");return}const c=await ie.getMyProfile();if(!c){console.warn("No teacher profile found"),g({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const L=c?.teaching?.studentIds||[],M=c?.conducting?.orchestraIds||[],W=c?.teaching?.timeBlocks||[],[b,E]=await Promise.allSettled([L.length>0?O.students.getBatchStudents(L):Promise.resolve([]),M.length>0?O.orchestras.getBatchOrchestras(M):Promise.resolve([])]),k=b.status==="fulfilled"?b.value:[];b.status==="rejected"&&console.error("Failed to load student data:",b.reason);const r=E.status==="fulfilled"?E.value:[];E.status==="rejected"&&console.error("Failed to load orchestra data:",E.reason);const t=Array.isArray(k)?k.filter(d=>d.academicInfo?.isActive!==!1):[],p=Array.isArray(W)?W.reduce((d,a)=>d+(parseInt(a.totalDuration)||0),0):0,N=Math.round(p/60*10)/10;g({studentsCount:Array.isArray(k)?k.length:0,activeStudents:t.length,weeklyHours:N,orchestrasCount:Array.isArray(r)?r.length:0,theoryLessonsCount:0})}catch(v){console.error("Error loading profile statistics:",v),g({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{u(!1)}};if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"טוען פרטי משתמש..."})]})});const C=(()=>{const v=[{id:"general",label:"פרטים כלליים",icon:te,component:Ae}];switch(s?.role||s?.roles?.[0]||""){case"teacher":case"מורה":return[...v,{id:"students",label:"התלמידים שלי",icon:U,component:ue},{id:"schedule",label:"לוח זמנים שבועי",icon:z,component:he}];case"conductor":case"מנצח":return[...v,{id:"orchestras",label:"תזמורות שאני מנצח",icon:V,component:ge}];case"theory_teacher":case"מורה תיאוריה":return[...v,{id:"lessons",label:"שיעורי התיאוריה שלי",icon:ee,component:xe}];default:const L=[...v];return(s?.roles?.includes("teacher")||s?.roles?.includes("מורה"))&&(L.push({id:"students",label:"התלמידים שלי",icon:U,component:ue}),L.push({id:"schedule",label:"לוח זמנים שבועי",icon:z,component:he})),(s?.roles?.includes("conductor")||s?.roles?.includes("מנצח"))&&L.push({id:"orchestras",label:"תזמורות שאני מנצח",icon:V,component:ge}),(s?.roles?.includes("theory_teacher")||s?.roles?.includes("מורה תיאוריה"))&&L.push({id:"lessons",label:"שיעורי התיאוריה שלי",icon:ee,component:xe}),L}})(),h=(C.find(v=>v.id===S)||C[0]).component,y=()=>{const v=s?.role||s?.roles?.[0]||"";switch(v){case"teacher":return"מורה";case"מורה":return"מורה";case"conductor":return"מנצח";case"מנצח":return"מנצח";case"theory_teacher":return"מורה תיאוריה";case"מורה תיאוריה":return"מורה תיאוריה";case"admin":return"מנהל";case"מנהל":return"מנהל";default:return v||"משתמש"}},f=()=>s?.personalInfo?.fullName||s?.fullName||s?.name||"משתמש",w=()=>{const v=f();if(!v||v==="משתמש")return"מ";const c=v.trim().split(" ");return c.length>=2?c[0][0]+c[1][0]:c[0][0]||"מ"},D=()=>s?.personalInfo?.email||s?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-michal",children:w()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-michal",children:f()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[y()," • ",D()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(Z,{title:"סה״כ תלמידים",value:l?"...":i?.studentsCount?.toString()||"0",icon:U,color:"blue",loading:l}),e.jsx(Z,{title:"תלמידים פעילים",value:l?"...":i?.activeStudents?.toString()||"0",icon:Ce,color:"green",loading:l}),e.jsx(Z,{title:"שעות שבועיות",value:l?"...":i?.weeklyHours?.toString()||"0",icon:J,color:"purple",loading:l}),e.jsx(Z,{title:s?.roles?.includes("conductor")||s?.roles?.includes("מנצח")?"תזמורות":"שיעורי תיאוריה",value:l?"...":(i?.orchestrasCount||i?.theoryLessonsCount)?.toString()||"0",icon:s?.roles?.includes("conductor")||s?.roles?.includes("מנצח")?V:ee,color:"indigo",loading:l})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:C.map(v=>{const c=v.icon;return e.jsxs("button",{onClick:()=>I(v.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${S===v.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-michal",children:v.label})]},v.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(h,{})})]})]})}function Z({title:s,value:S,icon:I,color:i,loading:g}){const u={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[i];return e.jsx("div",{className:`bg-white rounded-lg border ${u.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-michal truncate",children:s}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-michal",children:g?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):S})]}),e.jsx("div",{className:`${u.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(I,{className:`w-4 h-4 sm:w-6 sm:h-6 ${u.text}`})})]})})}export{Be as default};
