import{j as e,a as H}from"../assets/index-BAwpfw4Y.js";import{R as ve,r as x}from"./vendor-E-WBaSU9.js";import{a as O,t as ie}from"./cascade-deletion-C-2LBfWA.js";import{a as V,E as se,v as K,T as ae,i as te,n as fe,j as pe,a6 as le,C as z,m as J,l as be,k as ye,W as G,S as oe,q as me,P as re,U,$ as je,a0 as Ne,B as ee,a7 as we,o as Se,X as Ie,y as Te,ad as Ce}from"./ui-BeR0qYie.js";import"./query-CMzvnXZ6.js";import"./utils-x1PSU_OZ.js";function ke({student:s,onEdit:S,onDelete:I,onViewDetails:i,onScheduleLesson:g,className:l=""}){const u=s.academicInfo?.instrumentProgress?.find(c=>c.isPrimary)||s.academicInfo?.instrumentProgress?.[0],n=u?.instrumentName||"×œ× ×”×•×’×“×¨",m=u?.currentStage||0,C=10,T=s.scheduleInfo||s.teacherAssignments?.[0],h=T?`${T.day} ${T.startTime||T.time}`:null,y=T?.duration||60,f=s.academicInfo?.isActive!==!1&&s.status!=="inactive",w=f?"text-green-800 bg-green-100":"text-red-800 bg-red-100",D=f?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ",v=f?be:ye;return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg hover:shadow-lg hover:border-indigo-300 transition-all duration-200 transform hover:-translate-y-1 group ${l}`,children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal text-lg",children:s.personalInfo.fullName}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${w}`,children:[ve.createElement(v,{className:"w-3 h-3"}),D]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(V,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"font-reisinger-michal font-medium",children:n}),m>0&&e.jsxs("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-reisinger-michal",children:["×©×œ×‘ ",m,"/",C]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>i(s.id),className:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¦×¤×” ×‘×¤×¨×˜×™× ××œ××™×",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(s),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×œ××™×“",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(s.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×œ××™×“",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[s.personalInfo.age&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-michal",children:["×’×™×œ: ",s.personalInfo.age]})]}),s.personalInfo.class&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-reisinger-michal",children:["×›×™×ª×”: ",s.personalInfo.class]})]})]}),e.jsx("div",{className:"space-y-1",children:s.personalInfo.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",dir:"ltr",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono text-xs",children:s.personalInfo.phone})]})})]}),m>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 font-reisinger-michal",children:[e.jsx("span",{children:"×”×ª×§×“××•×ª ×‘×›×œ×™"}),e.jsxs("span",{children:[m,"/",C]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${m/C*100}%`}})}),e.jsxs("div",{className:"flex gap-1",children:[[...Array(Math.min(m,5))].map((c,L)=>e.jsx(le,{className:"w-3 h-3 text-yellow-400 fill-current"},L)),m>5&&e.jsxs("span",{className:"text-xs text-yellow-600 font-reisinger-michal",children:["+",m-5]})]})]}),h&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-800 font-reisinger-michal",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"×©×™×¢×•×¨ ×§×‘×•×¢:"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm font-reisinger-michal text-blue-700",children:h}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsxs("span",{children:[y," ×“×§'"]})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i(s.id),className:"text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-michal transition-all duration-200 flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"×¤×¨×˜×™× ××œ××™×"]}),g&&e.jsxs("button",{onClick:()=>g(s.id),className:"text-green-600 hover:text-green-800 hover:bg-green-100 px-3 py-1 rounded-lg text-sm font-medium font-reisinger-michal transition-all duration-200 flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),"×§×‘×¢ ×©×™×¢×•×¨"]})]})})]})}function ue(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState(0);x.useEffect(()=>{D()},[s]);const D=async(b=!0)=>{if(s?._id)try{b&&g(!0),y(null);const E=s._id,k=await O.teachers.getTeacher(E);if(!k)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");const r=k?.teaching?.studentIds||[];if(r.length===0){console.log("No students assigned to teacher"),I([]),w(0);return}const t=await O.students.getBatchStudents(r);if(!Array.isArray(t))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const p=t.filter(d=>r.includes(d._id)||r.includes(d.id));p.length!==t.length&&console.warn(`ğŸ”§ Component-level filtering: ${p.length}/${t.length} students match teacher's student IDs`);const N=p.map(d=>{const a=d.personalInfo?.fullName||"",o=a.split(" ");return{id:d._id,firstName:d.personalInfo?.firstName||o[0]||"",lastName:d.personalInfo?.lastName||o.slice(1).join(" ")||"",fullName:a,email:d.personalInfo?.email||d.contactInfo?.email||"",phone:d.personalInfo?.phone||d.contactInfo?.phone||"",instrument:d.academicInfo?.primaryInstrument||d.primaryInstrument||"",grade:d.academicInfo?.gradeLevel||"",status:d.academicInfo?.isActive!==!1?"active":"inactive",joinDate:d.createdAt,personalInfo:{fullName:a,phone:d.personalInfo?.phone||d.contactInfo?.phone,age:d.personalInfo?.age,class:d.personalInfo?.class||d.academicInfo?.class},academicInfo:{instrumentProgress:d.academicInfo?.instrumentProgress||[],isActive:d.academicInfo?.isActive!==!1},teacherAssignments:d.teacherAssignments||[],scheduleInfo:d.scheduleInfo}});I(N),w(0)}catch(E){console.error("Error loading teacher students:",E),y("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×œ××™×“×™×. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×” ×©×•×‘."),w(k=>k+1)}finally{b&&g(!1)}},v=S.filter(b=>l===""||`${b.firstName} ${b.lastName}`.toLowerCase().includes(l.toLowerCase())||b.instrument?.toLowerCase().includes(l.toLowerCase())||b.email?.toLowerCase().includes(l.toLowerCase())),c=async b=>{const E=S.find(r=>r.id===b),k=E?.personalInfo?.fullName||E?.fullName||"×”×ª×œ××™×“";if(window.confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ${k}?

×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×©×•×¨×™× ×œ×ª×œ××™×“ ×•×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.`))try{await O.students.deleteStudent(b),I(t=>t.filter(p=>p.id!==b));const r=document.createElement("div");r.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",r.innerHTML=`<div class="flex items-center gap-2 font-reisinger-michal"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${k} × ××—×§ ×‘×”×¦×œ×—×”</div>`,document.body.appendChild(r),setTimeout(()=>r.remove(),3e3)}catch(r){console.error("Error deleting student:",r);const t=document.createElement("div");t.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",t.innerHTML=`<div class="flex items-center gap-2 font-reisinger-michal"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>×©×’×™××” ×‘××—×™×§×ª ${k}</div>`,document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)}},L=b=>{window.location.href=`/students/${b}`},M=b=>{const E=S.find(k=>k.id===b);E&&(console.log("Schedule lesson for:",E.personalInfo?.fullName),alert(`×ª×›×•× ×” ×–×• ×ª×”×™×” ×–××™× ×” ×‘×§×¨×•×‘ ×¢×‘×•×¨ ${E.personalInfo?.fullName}`))},W=async b=>{try{if(C){const E={personalInfo:{firstName:b.firstName,lastName:b.lastName},contactInfo:{email:b.email,phone:b.phone},academicInfo:{gradeLevel:b.grade},status:b.status},k=await O.students.updateStudent(C.id,E),r={id:k._id,firstName:k.personalInfo?.firstName||"",lastName:k.personalInfo?.lastName||"",email:k.contactInfo?.email||"",phone:k.contactInfo?.phone||"",instrument:k.primaryInstrument||"",grade:k.academicInfo?.gradeLevel||"",status:k.status||"active",joinDate:k.createdAt};I(t=>t.map(p=>p.id===C.id?r:p))}else{const E=s?._id,k={personalInfo:{firstName:b.firstName,lastName:b.lastName},contactInfo:{email:b.email,phone:b.phone},academicInfo:{gradeLevel:b.grade},status:b.status,teacherId:E},r=await O.students.createStudent(k),t={id:r._id,firstName:r.personalInfo?.firstName||"",lastName:r.personalInfo?.lastName||"",email:r.contactInfo?.email||"",phone:r.contactInfo?.phone||"",instrument:r.primaryInstrument||"",grade:r.academicInfo?.gradeLevel||"",status:r.status||"active",joinDate:r.createdAt};I(p=>[...p,t])}m(!1),T(null)}catch(E){console.error("Error saving student:",E),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×ª×œ××™×“")}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."})]})}):h?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold font-reisinger-michal",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×"}),e.jsx("p",{className:"text-red-700 text-sm font-reisinger-michal mt-1",children:h})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-reisinger-michal",children:"× ×¡×” ×©×•×‘"}),f>2&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm font-reisinger-michal",children:"×¨×¢× ×Ÿ ×“×£"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"×”×ª×œ××™×“×™× ×©×œ×™"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×ª×œ××™×“×™× ×¨×©×•××™×"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×”×•×¡×£ ×ª×œ××™×“"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×œ××™×“×™×...",value:l,onChange:b=>u(b.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"×œ× × ××¦××• ×ª×œ××™×“×™×":"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×œ××™×“ ×”×¨××©×•×Ÿ ×©×œ×š"}),!l&&e.jsxs("button",{onClick:()=>m(!0),className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:[e.jsx(G,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“ ×¨××©×•×Ÿ"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-michal",children:"×¡×”×´×› ×ª×œ××™×“×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-1",children:S.length})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-michal",children:"×¤×¢×™×œ×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-1",children:S.filter(b=>b.status==="active").length})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-michal",children:"×¢× ×©×™×¢×•×¨×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-1",children:S.filter(b=>b.scheduleInfo||b.teacherAssignments?.length>0).length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:v.map(b=>e.jsx(ke,{student:b,onEdit:E=>{T(E),m(!0)},onDelete:c,onViewDetails:L,onScheduleLesson:M},b.id))})]}),n&&e.jsx(Le,{student:C,onClose:()=>{m(!1),T(null)},onSubmit:W})]})}function Le({student:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({firstName:s?.firstName||"",lastName:s?.lastName||"",email:s?.email||"",phone:s?.phone||"",instrument:s?.instrument||"",grade:s?.grade||"",status:s?.status||"active",age:s?.personalInfo?.age||"",class:s?.personalInfo?.class||s?.grade||""}),[l,u]=x.useState(!1),[n,m]=x.useState({}),C=()=>{const h={};return i.firstName.trim()||(h.firstName="×©× ×¤×¨×˜×™ ×”×•× ×©×“×” ×—×•×‘×”"),i.lastName.trim()||(h.lastName="×©× ××©×¤×—×” ×”×•× ×©×“×” ×—×•×‘×”"),i.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)&&(h.email="×›×ª×•×‘×ª ××™×™×œ ×œ× ×ª×§×™× ×”"),i.phone&&!/^[\d\-\+\(\)\s]{8,15}$/.test(i.phone.replace(/\s/g,""))&&(h.phone="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ"),i.age&&(isNaN(Number(i.age))||Number(i.age)<5||Number(i.age)>25)&&(h.age="×’×™×œ ×¦×¨×™×š ×œ×”×™×•×ª ×‘×™×Ÿ 5 ×œ-25"),m(h),Object.keys(h).length===0},T=async h=>{if(h.preventDefault(),!!C()){u(!0);try{await I(i)}catch(y){console.error("Error submitting form:",y)}finally{u(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"×¢×¨×™×›×ª ×ª×œ××™×“":"×”×•×¡×¤×ª ×ª×œ××™×“ ×—×“×©"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©× ×¤×¨×˜×™ *"}),e.jsx("input",{type:"text",required:!0,value:i.firstName,onChange:h=>{g(y=>({...y,firstName:h.target.value})),n.firstName&&m(y=>({...y,firstName:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.firstName?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ×¤×¨×˜×™"}),n.firstName&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©× ××©×¤×—×” *"}),e.jsx("input",{type:"text",required:!0,value:i.lastName,onChange:h=>{g(y=>({...y,lastName:h.target.value})),n.lastName&&m(y=>({...y,lastName:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.lastName?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ××©×¤×—×”"}),n.lastName&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.lastName})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×’×™×œ"}),e.jsx("input",{type:"number",min:"5",max:"25",value:i.age,onChange:h=>{g(y=>({...y,age:h.target.value})),n.age&&m(y=>({...y,age:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.age?"border-red-300 focus:border-red-500":"border-gray-300"}`,placeholder:"×’×™×œ"}),n.age&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.age})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×›×™×ª×”"}),e.jsx("input",{type:"text",value:i.class,onChange:h=>g(y=>({...y,class:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×œ××©×œ: ×™×, ×™×‘, ×˜"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×›×œ×™ × ×’×™× ×” ×¢×™×§×¨×™"}),e.jsxs("select",{value:i.instrument,onChange:h=>g(y=>({...y,instrument:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),e.jsx("option",{value:"×¤×¡× ×ª×¨",children:"×¤×¡× ×ª×¨"}),e.jsx("option",{value:"×›×™× ×•×¨",children:"×›×™× ×•×¨"}),e.jsx("option",{value:"×¦'×œ×•",children:"×¦'×œ×•"}),e.jsx("option",{value:"×•×™×•×œ×”",children:"×•×™×•×œ×”"}),e.jsx("option",{value:"×—×¦×•×¦×¨×”",children:"×—×¦×•×¦×¨×”"}),e.jsx("option",{value:"×˜×¨×•××‘×•×Ÿ",children:"×˜×¨×•××‘×•×Ÿ"}),e.jsx("option",{value:"×§×œ×¨×™× ×˜",children:"×§×œ×¨×™× ×˜"}),e.jsx("option",{value:"×—×œ×™×œ",children:"×—×œ×™×œ"}),e.jsx("option",{value:"×¡×§×¡×•×¤×•×Ÿ",children:"×¡×§×¡×•×¤×•×Ÿ"}),e.jsx("option",{value:"×”×•×¨×Ÿ",children:"×”×•×¨×Ÿ"}),e.jsx("option",{value:"×˜×•×‘×”",children:"×˜×•×‘×”"}),e.jsx("option",{value:"×›×œ×™ ×”×§×©×”",children:"×›×œ×™ ×”×§×©×”"}),e.jsx("option",{value:"×’×™×˜×¨×”",children:"×’×™×˜×¨×”"}),e.jsx("option",{value:"×§×•× ×˜×¨×‘×¡",children:"×§×•× ×˜×¨×‘×¡"}),e.jsx("option",{value:"××—×¨",children:"××—×¨"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:'×“×•×"×œ'}),e.jsx("input",{type:"email",value:i.email,onChange:h=>{g(y=>({...y,email:h.target.value})),n.email&&m(y=>({...y,email:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.email?"border-red-300 focus:border-red-500":"border-gray-300"}`,dir:"ltr",placeholder:"student@example.com"}),n.email&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×˜×œ×¤×•×Ÿ"}),e.jsx("input",{type:"tel",value:i.phone,onChange:h=>{g(y=>({...y,phone:h.target.value})),n.phone&&m(y=>({...y,phone:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 transition-colors ${n.phone?"border-red-300 focus:border-red-500":"border-gray-300"}`,dir:"ltr",placeholder:"05X-XXXXXXX"}),n.phone&&e.jsx("p",{className:"mt-1 text-xs text-red-600 font-reisinger-michal",children:n.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×˜×˜×•×¡ ×”×ª×œ××™×“"}),e.jsxs("select",{value:i.status,onChange:h=>g(y=>({...y,status:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"âœ… ×¤×¢×™×œ - ×ª×œ××™×“ ×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"â¸ï¸ ×œ× ×¤×¢×™×œ - ×”×©×”×™×™×” ×–×× ×™×ª"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",disabled:l,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-michal flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s?"××¢×“×›×Ÿ...":"××•×¡×™×£..."]}):e.jsx(e.Fragment,{children:s?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4"}),"×¢×“×›×Ÿ ×ª×œ××™×“"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"×”×•×¡×£ ×ª×œ××™×“"]})})}),e.jsxs("button",{type:"button",onClick:S,disabled:l,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-reisinger-michal flex items-center justify-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"×‘×™×˜×•×œ"]})]})]}),Object.keys(n).length>0&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800 font-reisinger-michal text-sm",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"×™×© ×©×’×™××•×ª ×‘×˜×•×¤×¡, ×× × ×ª×§×Ÿ ××•×ª×Ÿ ×•× ×¡×” ×©×•×‘"})]})})]})})}function ge(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState([]),[D,v]=x.useState(null);x.useEffect(()=>{c()},[s]);const c=async()=>{if(s?._id)try{g(!0);const r=s._id,t=await O.teachers.getTeacher(r);if(!t)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const p=t?.conducting?.orchestraIds||[];if(p.length===0){console.log("No orchestras assigned to conductor"),I([]);return}const N=await O.orchestras.getBatchOrchestras(p);if(!Array.isArray(N))throw new Error("×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª");const d=N.map(a=>({id:a._id,name:a.name,description:a.description,type:a.type,level:a.level,memberCount:a.memberCount||0,status:a.status||"active",rehearsalDay:a.rehearsalSchedule?.day,rehearsalTime:a.rehearsalSchedule?.time,venue:a.venue}));I(d)}catch(r){console.error("Error loading conductor orchestras:",r),v("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”×ª×–××•×¨×•×ª")}finally{g(!1)}},L=async r=>{try{const N=((await O.orchestras.getOrchestra(r)).memberDetails||[]).map(d=>({id:d._id,firstName:d.personalInfo?.firstName||"",lastName:d.personalInfo?.lastName||"",instrument:d.primaryInstrument||"",section:d.section||"",status:d.status||"active"}));w(N)}catch(t){console.error("Error loading orchestra members:",t)}},M=S.filter(r=>l===""||r.name.toLowerCase().includes(l.toLowerCase())||r.type.toLowerCase().includes(l.toLowerCase())||r.description?.toLowerCase().includes(l.toLowerCase())),W=async r=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×ª×–××•×¨×ª ×–×•?"))try{await O.orchestras.deleteOrchestra(r),I(t=>t.filter(p=>p.id!==r)),h===r&&(y(null),w([]))}catch(t){console.error("Error deleting orchestra:",t),alert("×©×’×™××” ×‘××—×™×§×ª ×”×ª×–××•×¨×ª")}},b=async r=>{try{if(C){const t={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue},p=await O.orchestras.updateOrchestra(C.id,t),N={id:p._id,name:p.name,description:p.description,type:p.type,level:p.level,memberCount:p.memberCount||0,status:p.status||"active",rehearsalDay:p.rehearsalSchedule?.day,rehearsalTime:p.rehearsalSchedule?.time,venue:p.venue};I(d=>d.map(a=>a.id===C.id?N:a))}else{const t=s?._id,p={name:r.name,description:r.description,type:r.type,level:r.level,status:r.status,rehearsalSchedule:{day:r.rehearsalDay,time:r.rehearsalTime},venue:r.venue,conductorId:t},N=await O.orchestras.createOrchestra(p),d={id:N._id,name:N.name,description:N.description,type:N.type,level:N.level,memberCount:N.memberCount||0,status:N.status||"active",rehearsalDay:N.rehearsalSchedule?.day,rehearsalTime:N.rehearsalSchedule?.time,venue:N.venue};I(a=>[...a,d])}m(!1),T(null)}catch(t){console.error("Error saving orchestra:",t),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×ª×–××•×¨×ª")}},E=r=>{switch(r){case"youth":return"×ª×–××•×¨×ª × ×•×¢×¨";case"adult":return"×ª×–××•×¨×ª ××‘×•×’×¨×™×";case"chamber":return"×ª×–××•×¨×ª ×§×××¨×™×ª";case"symphony":return"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª";default:return r}},k=r=>{switch(r){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return r}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×–××•×¨×•×ª..."})]})}):D?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:D})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×ª×–××•×¨×•×ª"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×”×•×¡×£ ×ª×–××•×¨×ª"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×ª×–××•×¨×•×ª...",value:l,onChange:r=>u(r.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:M.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"×œ× × ××¦××• ×ª×–××•×¨×•×ª":"××™×Ÿ ×ª×–××•×¨×•×ª ×¨×©×•××•×ª"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×ª×–××•×¨×ª ×”×¨××©×•× ×” ×©×œ×š"})]}):M.map(r=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-lg hover:border-indigo-300 transition-all duration-200 cursor-pointer transform hover:-translate-y-1 group ${h===r.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{y(r.id),L(r.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-michal",children:[E(r.type)," â€¢ ",k(r.level)]}),r.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-michal",children:r.description})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),T(r),m(!0)},className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",title:"×¢×¨×™×›×ª ×ª×–××•×¨×ª",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),W(r.id)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"××—×™×§×ª ×ª×–××•×¨×ª",children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.memberCount||0," ×—×‘×¨×™×"]})]}),r.rehearsalDay&&e.jsxs("span",{children:["×—×–×¨×•×ª: ",r.rehearsalDay]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},r.id))}),h&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:"×—×‘×¨×™ ×”×ª×–××•×¨×ª"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-michal",children:"× ×”×œ ×—×‘×¨×™×"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-michal",children:"××™×Ÿ ×—×‘×¨×™× ×¨×©×•××™× ×‘×ª×–××•×¨×ª"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:f.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors duration-200 border border-transparent hover:border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-michal",children:[r.firstName," ",r.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-michal",children:[r.instrument," â€¢ ",r.section]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]},r.id))})]})]}),n&&e.jsx($e,{orchestra:C,onClose:()=>{m(!1),T(null)},onSubmit:b})]})}function $e({orchestra:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({name:s?.name||"",description:s?.description||"",type:s?.type||"youth",level:s?.level||"beginner",status:s?.status||"active",rehearsalDay:s?.rehearsalDay||"",rehearsalTime:s?.rehearsalTime||"",venue:s?.venue||""}),l=u=>{u.preventDefault(),I(i)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"×¢×¨×™×›×ª ×ª×–××•×¨×ª":"×”×•×¡×¤×ª ×ª×–××•×¨×ª ×—×“×©×”"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©× ×”×ª×–××•×¨×ª *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:u=>g(n=>({...n,name:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×ª×™××•×¨"}),e.jsx("textarea",{value:i.description,onChange:u=>g(n=>({...n,description:u.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×•×’ ×ª×–××•×¨×ª *"}),e.jsxs("select",{required:!0,value:i.type,onChange:u=>g(n=>({...n,type:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"youth",children:"×ª×–××•×¨×ª × ×•×¢×¨"}),e.jsx("option",{value:"adult",children:"×ª×–××•×¨×ª ××‘×•×’×¨×™×"}),e.jsx("option",{value:"chamber",children:"×ª×–××•×¨×ª ×§×××¨×™×ª"}),e.jsx("option",{value:"symphony",children:"×ª×–××•×¨×ª ×¡×™××¤×•× ×™×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:i.level,onChange:u=>g(n=>({...n,level:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×™×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:i.rehearsalDay,onChange:u=>g(n=>({...n,rehearsalDay:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"×›×œ×•××¨: ×™×•× ×¨××©×•×Ÿ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©×¢×ª ×—×–×¨×•×ª"}),e.jsx("input",{type:"time",value:i.rehearsalTime,onChange:u=>g(n=>({...n,rehearsalTime:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"××§×•× ×—×–×¨×•×ª"}),e.jsx("input",{type:"text",value:i.venue,onChange:u=>g(n=>({...n,venue:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:i.status,onChange:u=>g(n=>({...n,status:u.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:s?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-michal",children:"×‘×™×˜×•×œ"})]})]})]})})}function he(){const{user:s}=H(),[S,I]=x.useState(new Date),[i,g]=x.useState(null),[l,u]=x.useState(!0),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState(null);x.useEffect(()=>{D()},[S,s]);const D=async()=>{if(s?._id)try{u(!0);const a=s._id,o=c(S),j=L(S),A=await O.teachers.getTeacher(a);if(!A)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");const F=A?.teaching?.timeBlocks||[];console.log(`Found ${F.length} time blocks for teacher`);let B=[];try{const $=A?.teaching?.studentIds||[];$.length>0&&(B=await O.students.getBatchStudents($),console.log(`Found ${B.length} students for schedule integration`))}catch($){console.warn("Failed to load students for schedule:",$)}const _=M(o),ne={×¨××©×•×Ÿ:0,×©× ×™:1,×©×œ×™×©×™:2,×¨×‘×™×¢×™:3,×—××™×©×™:4,×©×™×©×™:5,×©×‘×ª:6};F.length>0&&F.forEach($=>{const q=ne[$.day];q!==void 0&&_[q]&&_[q].lessons.push({id:`availability-${$.day}-${$.startTime}`,startTime:$.startTime,endTime:$.endTime,studentName:"×–××™×Ÿ ×œ×”×•×¨××”",studentId:null,instrument:"",lessonType:"availability",status:"available",notes:`×–××™×Ÿ ${$.totalDuration} ×“×§×•×ª`})}),B.length>0&&B.forEach($=>{const q=$.teacherAssignments||[],X=$.scheduleInfo;if(q.filter(P=>P.teacherId===a).forEach(P=>{const R=ne[P.day];if(R!==void 0&&_[R]){const Q=$.academicInfo?.instrumentProgress?.find(Y=>Y.isPrimary)||$.academicInfo?.instrumentProgress?.[0],ce=_[R].lessons.findIndex(Y=>Y.startTime===P.time&&Y.lessonType==="availability"),de={id:`lesson-${$._id}-${P.day}`,startTime:P.time,endTime:v(P.time,P.duration),studentName:$.personalInfo?.fullName||"×ª×œ××™×“",studentId:$._id,instrument:Q?.instrumentName||"",lessonType:"individual",status:"scheduled",notes:`${P.duration} ×“×§×•×ª`,studentStage:Q?.currentStage,studentClass:$.personalInfo?.class||$.academicInfo?.class,studentPhone:$.personalInfo?.phone,isRecurring:!0,repeatType:"weekly"};ce!==-1?_[R].lessons[ce]=de:_[R].lessons.push(de)}}),X&&!q.find(P=>P.teacherId===a)){const P=ne[X.day];if(P!==void 0&&_[P]){const R=$.academicInfo?.instrumentProgress?.find(Q=>Q.isPrimary)||$.academicInfo?.instrumentProgress?.[0];_[P].lessons.push({id:`schedule-${$._id}`,startTime:X.startTime,endTime:X.endTime,studentName:$.personalInfo?.fullName||"×ª×œ××™×“",studentId:$._id,instrument:R?.instrumentName||"",lessonType:"individual",status:"scheduled",notes:`${X.duration} ×“×§×•×ª`,studentStage:R?.currentStage,studentClass:$.personalInfo?.class||$.academicInfo?.class,studentPhone:$.personalInfo?.phone,isRecurring:!0,repeatType:"weekly"})}}}),_.forEach($=>{$.lessons.sort((q,X)=>q.startTime.localeCompare(X.startTime))}),g({weekStart:o,weekEnd:j,days:_})}catch(a){console.error("Error loading teacher schedule:",a),w("×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×— ×”×–×× ×™×");const o=c(S);g({weekStart:o,weekEnd:L(S),days:M(o)})}finally{u(!1)}},v=(a,o)=>{const[j,A]=a.split(":").map(Number),F=j*60+A+o,B=Math.floor(F/60),_=F%60;return`${B.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`},c=a=>{const o=new Date(a),j=o.getDay(),A=o.getDate()-j;return new Date(o.setDate(A))},L=a=>{const o=c(a);return o.setDate(o.getDate()+6),o},M=a=>{const o=[],j=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"];for(let A=0;A<7;A++){const F=new Date(a);F.setDate(a.getDate()+A),o.push({date:F.toISOString().split("T")[0],dayName:j[A],lessons:[]})}return o},W=a=>{const o=new Date(S);o.setDate(S.getDate()+(a==="next"?7:-7)),I(o)},b=a=>a.slice(0,5),E=a=>new Date(a).toLocaleDateString("he-IL",{day:"numeric",month:"short"}),k=()=>{const a=[];for(let o=8;o<=20;o++)a.push(`${o.toString().padStart(2,"0")}:00`),a.push(`${o.toString().padStart(2,"0")}:30`);return a},r=(a,o)=>{T({date:a,time:o}),y(null),m(!0)},t=(a,o)=>{T({date:o,time:a.startTime}),y(a),m(!0)},p=async a=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×©×™×¢×•×¨ ×–×”?"))try{await O.teacherSchedule.deleteLesson(a),D()}catch(o){console.error("Error deleting lesson:",o),alert("×©×’×™××” ×‘××—×™×§×ª ×”×©×™×¢×•×¨")}},N=(a,o)=>i?.days.find(A=>A.date===a)?.lessons.find(A=>A.startTime===o);if(l)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×œ×•×— ×–×× ×™×..."})]})});if(f&&!i)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:f})});const d=k();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™"}),e.jsx("p",{className:"text-gray-600 mt-1",children:i&&`${E(i.weekStart.toISOString().split("T")[0])} - ${E(i.weekEnd.toISOString().split("T")[0])}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W("prev"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>I(new Date),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors font-reisinger-michal",children:"×”×©×‘×•×¢"}),e.jsx("button",{onClick:()=>W("next"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[e.jsx("div",{className:"p-3 bg-gray-50 font-medium text-gray-700 font-reisinger-michal",children:"×©×¢×”"}),i?.days.map(a=>e.jsxs("div",{className:"p-3 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-michal",children:a.dayName}),e.jsx("div",{className:"text-sm text-gray-500 font-reisinger-michal",children:E(a.date)})]},a.date))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:d.map(a=>e.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",children:[e.jsx("div",{className:"p-3 bg-gray-50 text-sm font-medium text-gray-600 font-reisinger-michal",children:b(a)}),i?.days.map(o=>{const j=N(o.date,a);return e.jsx("div",{className:"p-1 border-l border-gray-100 min-h-[60px]",children:j?e.jsxs("div",{className:`h-full p-2 rounded text-xs font-reisinger-michal cursor-pointer group relative transition-all hover:scale-[1.02] ${j.status==="available"?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300":j.status==="scheduled"?"bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300 shadow-sm":j.status==="completed"?"bg-green-100 text-green-800 hover:bg-green-200 border border-green-300":"bg-red-100 text-red-800 hover:bg-red-200 border border-red-300"}`,title:j.lessonType==="availability"?j.notes:`${j.studentName}${j.instrument?" - "+j.instrument:""}${j.studentStage?" (×©×œ×‘ "+j.studentStage+")":""}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:j.lessonType==="availability"?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3 opacity-60"}),"×–××™×Ÿ ×œ×”×•×¨××”"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3 opacity-60"}),j.studentName||"×ª×œ××™×“"]})}),e.jsxs("div",{className:"text-[10px] opacity-75 mt-0.5",children:[b(j.startTime),"-",b(j.endTime)]}),j.lessonType!=="availability"&&e.jsxs("div",{className:"mt-1 space-y-0.5",children:[j.instrument&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] opacity-80",children:[e.jsx(V,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"truncate",children:j.instrument}),j.studentStage&&e.jsxs("span",{className:"bg-white bg-opacity-60 px-1 rounded text-[9px]",children:["×©×œ×‘ ",j.studentStage]})]}),j.studentClass&&e.jsxs("div",{className:"text-[10px] opacity-70",children:["×›×™×ª×” ",j.studentClass]}),j.isRecurring&&e.jsxs("div",{className:"flex items-center gap-1 text-[9px] opacity-60",children:[e.jsx(le,{className:"w-2 h-2"}),"×©×™×¢×•×¨ ×§×‘×•×¢"]})]})]})}),e.jsx("div",{className:"absolute top-1 left-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:j.lessonType!=="availability"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),j.studentId&&(window.location.href=`/students/${j.studentId}`)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"×¦×¤×” ×‘×¤×¨×˜×™ ×”×ª×œ××™×“",children:e.jsx(se,{className:"w-2.5 h-2.5 text-blue-600"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),t(j,o.date)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"×¢×¨×•×š ×©×™×¢×•×¨",children:e.jsx(K,{className:"w-2.5 h-2.5 text-gray-600"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),p(j.id)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"××—×§ ×©×™×¢×•×¨",children:e.jsx(ae,{className:"w-2.5 h-2.5 text-red-600"})})]}):e.jsx("button",{onClick:A=>{A.stopPropagation(),r(o.date,j.startTime)},className:"p-1 bg-white bg-opacity-90 rounded shadow-sm hover:bg-gray-50",title:"×§×‘×¢ ×©×™×¢×•×¨",children:e.jsx(re,{className:"w-2.5 h-2.5 text-green-600"})})})]}):e.jsx("button",{onClick:()=>r(o.date,a),className:"w-full h-full flex items-center justify-center text-gray-300 hover:text-indigo-500 hover:bg-indigo-50 rounded transition-all group",title:"×”×•×¡×£ ×©×™×¢×•×¨",children:e.jsx(re,{className:"w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"})})},`${o.date}-${a}`)})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 font-reisinger-michal",children:"×©×™×¢×•×¨×™× ×§×‘×•×¢×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType!=="availability").length,0)||0}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"×”×©×‘×•×¢ ×”× ×•×›×—×™"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 font-reisinger-michal",children:"×©×¢×•×ª ×”×•×¨××”"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType!=="availability").reduce((j,A)=>{const F=new Date(`2000-01-01T${A.startTime}`),B=new Date(`2000-01-01T${A.endTime}`);return j+(B.getTime()-F.getTime())/(1e3*60*60)},0),0)?.toFixed(1)||"0"}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"×©×¢×•×ª ×‘×¤×•×¢×œ"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 font-reisinger-michal",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 mt-2 font-reisinger-michal",children:new Set(i?.days.flatMap(a=>a.lessons.filter(o=>o.lessonType!=="availability").map(o=>o.studentId).filter(Boolean))||[]).size}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"×”×©×‘×•×¢ ×”×–×”"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-medium text-yellow-900 font-reisinger-michal",children:"×–××™× ×•×ª"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-900 mt-2 font-reisinger-michal",children:i?.days.reduce((a,o)=>a+o.lessons.filter(j=>j.lessonType==="availability").length,0)||0}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"×—×œ×•× ×•×ª ×–××Ÿ ×¤× ×•×™×™×"})]})]}),n&&e.jsx(Ee,{lesson:h,timeSlot:C,onClose:()=>{m(!1),T(null),y(null)},onSubmit:()=>{m(!1),T(null),y(null),D()}})]})}function Ee({lesson:s,timeSlot:S,onClose:I,onSubmit:i}){const{user:g}=H(),[l,u]=x.useState({startTime:s?.startTime||S?.time||"",endTime:s?.endTime||"",studentName:s?.studentName||"",studentId:s?.studentId||"",instrument:s?.instrument||"",lessonType:s?.lessonType||"individual",status:s?.status||"scheduled",notes:s?.notes||""}),[n,m]=x.useState([]),[C,T]=x.useState(!1);x.useEffect(()=>{if(h(),l.startTime&&!l.endTime){const f=new Date(`2000-01-01T${l.startTime}`);f.setMinutes(f.getMinutes()+60),u(w=>({...w,endTime:f.toTimeString().slice(0,5)}))}},[l.startTime]);const h=async()=>{try{const f=g?._id;if(!f)return;const D=(await O.teachers.getTeacherStudents(f)).map(v=>({id:v._id,firstName:v.personalInfo?.firstName||"",lastName:v.personalInfo?.lastName||"",instrument:v.primaryInstrument||""}));m(D)}catch(f){console.error("Error loading students:",f)}},y=async f=>{f.preventDefault();try{T(!0);const w=g?._id,D={...l,teacherId:w,date:S?.date,studentId:l.studentId||void 0};s?await O.teacherSchedule.updateLesson(s.id,D):await O.teacherSchedule.createLesson(D),i()}catch(w){console.error("Error saving lesson:",w),alert("×©×’×™××” ×‘×©××™×¨×ª ×”×©×™×¢×•×¨")}finally{T(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"×¢×¨×™×›×ª ×©×™×¢×•×¨":"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×—×“×©"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",required:!0,value:l.startTime,onChange:f=>u(w=>({...w,startTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",required:!0,value:l.endTime,onChange:f=>u(w=>({...w,endTime:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×ª×œ××™×“"}),e.jsxs("select",{value:l.studentId,onChange:f=>{const w=n.find(D=>D.id===f.target.value);u(D=>({...D,studentId:f.target.value,studentName:w?`${w.firstName} ${w.lastName}`:"",instrument:w?.instrument||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×œ××™×“"}),n.map(f=>e.jsxs("option",{value:f.id,children:[f.firstName," ",f.lastName,f.instrument&&` - ${f.instrument}`]},f.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×›×œ×™ × ×’×™× ×”"}),e.jsx("input",{type:"text",value:l.instrument,onChange:f=>u(w=>({...w,instrument:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×•×’ ×©×™×¢×•×¨"}),e.jsxs("select",{value:l.lessonType,onChange:f=>u(w=>({...w,lessonType:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"individual",children:"×©×™×¢×•×¨ ×¤×¨×˜×™"}),e.jsx("option",{value:"group",children:"×©×™×¢×•×¨ ×§×‘×•×¦×ª×™"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:l.status,onChange:f=>u(w=>({...w,status:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"scheduled",children:"××ª×•×›× ×Ÿ"}),e.jsx("option",{value:"completed",children:"×”×•×©×œ×"}),e.jsx("option",{value:"cancelled",children:"×‘×•×˜×œ"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:l.notes,onChange:f=>u(w=>({...w,notes:f.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",disabled:C,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-michal",children:C?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mx-auto"}):s?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:I,disabled:C,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-reisinger-michal",children:"×‘×™×˜×•×œ"})]})]})]})})}function xe(){const{user:s}=H(),[S,I]=x.useState([]),[i,g]=x.useState(!0),[l,u]=x.useState(""),[n,m]=x.useState(!1),[C,T]=x.useState(null),[h,y]=x.useState(null),[f,w]=x.useState([]),[D,v]=x.useState(null);x.useEffect(()=>{c()},[s]);const c=async()=>{if(s?._id)try{g(!0);const t=s._id,d=(await O.theory.getTheoryLessons()).filter(a=>a.teacherId===t).map(a=>({id:a._id,name:a.name,description:a.description,level:a.level,duration:a.duration,capacity:a.capacity,enrolledCount:a.enrolledStudentIds?.length||0,schedule:{dayOfWeek:a.dayOfWeek,startTime:a.startTime,endTime:a.endTime},status:a.isActive?"active":"inactive",venue:a.location,materials:a.materials||[]}));I(d)}catch(t){console.error("Error loading theory lessons:",t),v("×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×”")}finally{g(!1)}},L=async t=>{try{const N=(await O.theory.getTheoryLesson(t)).enrolledStudentIds||[];if(N.length===0){w([]);return}const a=(await O.students.getStudents({ids:N.join(",")})).map(o=>({id:o._id,firstName:o.personalInfo?.firstName||"",lastName:o.personalInfo?.lastName||"",grade:o.academicInfo?.gradeLevel,instrument:o.primaryInstrument,enrollmentDate:o.createdAt||new Date().toISOString(),attendance:{total:0,present:0,absent:0}}));w(a)}catch(p){console.error("Error loading lesson students:",p)}},M=S.filter(t=>l===""||t.name.toLowerCase().includes(l.toLowerCase())||t.level.toLowerCase().includes(l.toLowerCase())||t.description?.toLowerCase().includes(l.toLowerCase())),W=async t=>{if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×©×™×¢×•×¨ ×–×”?"))try{await O.theory.deleteTheoryLesson(t),I(p=>p.filter(N=>N.id!==t)),h===t&&(y(null),w([]))}catch(p){console.error("Error deleting lesson:",p),alert("×©×’×™××” ×‘××—×™×§×ª ×”×©×™×¢×•×¨")}},b=async t=>{try{if(C){const p={name:t.name,description:t.description,level:t.level,duration:t.duration,capacity:t.capacity,dayOfWeek:t.schedule?.dayOfWeek,startTime:t.schedule?.startTime,endTime:t.schedule?.endTime,isActive:t.status==="active",location:t.venue},N=await O.theory.updateTheoryLesson(C.id,p),d={id:N._id,name:N.name,description:N.description,level:N.level,duration:N.duration,capacity:N.capacity,enrolledCount:N.enrolledStudentIds?.length||0,schedule:{dayOfWeek:N.dayOfWeek,startTime:N.startTime,endTime:N.endTime},status:N.isActive?"active":"inactive",venue:N.location,materials:N.materials||[]};I(a=>a.map(o=>o.id===C.id?d:o))}else{const p=s?._id,N={name:t.name,description:t.description,level:t.level,duration:t.duration,capacity:t.capacity,dayOfWeek:t.schedule?.dayOfWeek,startTime:t.schedule?.startTime,endTime:t.schedule?.endTime,isActive:t.status==="active",location:t.venue,teacherId:p},d=await O.theory.createTheoryLesson(N),a={id:d._id,name:d.name,description:d.description,level:d.level,duration:d.duration,capacity:d.capacity,enrolledCount:d.enrolledStudentIds?.length||0,schedule:{dayOfWeek:d.dayOfWeek,startTime:d.startTime,endTime:d.endTime},status:d.isActive?"active":"inactive",venue:d.location,materials:d.materials||[]};I(o=>[...o,a])}m(!1),T(null)}catch(p){console.error("Error saving lesson:",p),alert("×©×’×™××” ×‘×©××™×¨×ª ×¤×¨×˜×™ ×”×©×™×¢×•×¨")}},E=t=>{switch(t){case"beginner":return"××ª×—×™×œ×™×";case"intermediate":return"×‘×™× ×•× ×™×™×";case"advanced":return"××ª×§×“××™×";default:return t}},k=t=>t.substring(0,5),r=t=>({sunday:"×™×•× ×¨××©×•×Ÿ",monday:"×™×•× ×©× ×™",tuesday:"×™×•× ×©×œ×™×©×™",wednesday:"×™×•× ×¨×‘×™×¢×™",thursday:"×™×•× ×—××™×©×™",friday:"×™×•× ×©×™×©×™",saturday:"×™×•× ×©×‘×ª"})[t.toLowerCase()]||t;return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¨×©×™××ª ×©×™×¢×•×¨×™×..."})]})}):D?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"text-red-800 font-reisinger-michal",children:D})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," ×©×™×¢×•×¨×™×"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×”×•×¡×£ ×©×™×¢×•×¨"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×© ×©×™×¢×•×¨×™×...",value:l,onChange:t=>u(t.target.value),className:"w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:M.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2 font-reisinger-michal",children:l?"×œ× × ××¦××• ×©×™×¢×•×¨×™×":"××™×Ÿ ×©×™×¢×•×¨×™× ×¨×©×•××™×"}),e.jsx("p",{className:"text-gray-600 font-reisinger-michal",children:l?"× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª":"×”×ª×—×œ ×‘×”×•×¡×¤×ª ×”×©×™×¢×•×¨ ×”×¨××©×•×Ÿ ×©×œ×š"})]}):M.map(t=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer ${h===t.id?"ring-2 ring-indigo-500 bg-indigo-50":""}`,onClick:()=>{y(t.id),L(t.id)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600 font-reisinger-michal",children:[E(t.level)," â€¢ ",t.duration," ×“×§×•×ª"]}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 font-reisinger-michal",children:t.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),T(t),m(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 transition-colors",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),W(t.id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:r(t.schedule.dayOfWeek)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{children:[k(t.schedule.startTime)," - ",k(t.schedule.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.enrolledCount||0,"/",t.capacity]})]}),t.venue&&e.jsx("span",{children:t.venue})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status==="active"?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]})]},t.id))}),h&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 font-reisinger-michal",children:"×ª×œ××™×“×™ ×”×©×™×¢×•×¨"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium font-reisinger-michal",children:"× ×”×œ ×ª×œ××™×“×™×"})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm font-reisinger-michal",children:"××™×Ÿ ×ª×œ××™×“×™× ×¨×©×•××™× ×œ×©×™×¢×•×¨"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:f.map(t=>e.jsx("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded border",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm font-reisinger-michal",children:[t.firstName," ",t.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-michal",children:[t.instrument&&`${t.instrument} â€¢ `,t.grade&&`×›×™×ª×” ${t.grade} â€¢ `,"×¨×™×©×•×: ",new Date(t.enrollmentDate).toLocaleDateString("he-IL")]}),t.attendance&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-reisinger-michal",children:["× ×•×›×—×•×ª: ",t.attendance.present,"/",t.attendance.total," ×©×™×¢×•×¨×™×",e.jsxs("span",{className:`ml-2 ${t.attendance.present/t.attendance.total>=.8?"text-green-600":"text-red-600"}`,children:["(",Math.round(t.attendance.present/t.attendance.total*100),"%)"]})]})]})},t.id))})]})]}),n&&e.jsx(De,{lesson:C,onClose:()=>{m(!1),T(null)},onSubmit:b})]})}function De({lesson:s,onClose:S,onSubmit:I}){const[i,g]=x.useState({name:s?.name||"",description:s?.description||"",level:s?.level||"beginner",duration:s?.duration||60,capacity:s?.capacity||15,status:s?.status||"active",venue:s?.venue||"",schedule:{dayOfWeek:s?.schedule?.dayOfWeek||"sunday",startTime:s?.schedule?.startTime||"09:00",endTime:s?.schedule?.endTime||"10:00"}}),l=n=>{n.preventDefault(),I(i)},u=(n,m)=>{g(C=>({...C,schedule:{...C.schedule,[n]:m}}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-michal",children:s?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":"×”×•×¡×¤×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©× ×”×©×™×¢×•×¨ *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:n=>g(m=>({...m,name:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×ª×™××•×¨ ×”×©×™×¢×•×¨"}),e.jsx("textarea",{value:i.description,onChange:n=>g(m=>({...m,description:n.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¨××” *"}),e.jsxs("select",{required:!0,value:i.level,onChange:n=>g(m=>({...m,level:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"beginner",children:"××ª×—×™×œ×™×"}),e.jsx("option",{value:"intermediate",children:"×‘×™× ×•× ×™×™×"}),e.jsx("option",{value:"advanced",children:"××ª×§×“××™×"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª) *"}),e.jsx("input",{type:"number",required:!0,min:"30",max:"180",step:"15",value:i.duration,onChange:n=>g(m=>({...m,duration:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×§×™×‘×•×œ×ª ×ª×œ××™×“×™× *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"50",value:i.capacity,onChange:n=>g(m=>({...m,capacity:parseInt(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×¡×˜×˜×•×¡"}),e.jsxs("select",{value:i.status,onChange:n=>g(m=>({...m,status:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"active",children:"×¤×¢×™×œ"}),e.jsx("option",{value:"inactive",children:"×œ× ×¤×¢×™×œ"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×™×•× ×”×©×™×¢×•×¨ *"}),e.jsxs("select",{required:!0,value:i.schedule.dayOfWeek,onChange:n=>u("dayOfWeek",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"sunday",children:"×™×•× ×¨××©×•×Ÿ"}),e.jsx("option",{value:"monday",children:"×™×•× ×©× ×™"}),e.jsx("option",{value:"tuesday",children:"×™×•× ×©×œ×™×©×™"}),e.jsx("option",{value:"wednesday",children:"×™×•× ×¨×‘×™×¢×™"}),e.jsx("option",{value:"thursday",children:"×™×•× ×—××™×©×™"}),e.jsx("option",{value:"friday",children:"×™×•× ×©×™×©×™"}),e.jsx("option",{value:"saturday",children:"×™×•× ×©×‘×ª"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©×¢×ª ×”×ª×—×œ×” *"}),e.jsx("input",{type:"time",required:!0,value:i.schedule.startTime,onChange:n=>u("startTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",required:!0,value:i.schedule.endTime,onChange:n=>u("endTime",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 font-reisinger-michal",children:"××§×•× ×”×©×™×¢×•×¨"}),e.jsx("input",{type:"text",value:i.venue,onChange:n=>g(m=>({...m,venue:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors font-reisinger-michal",children:s?"×¢×“×›×Ÿ":"×”×•×¡×£"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors font-reisinger-michal",children:"×‘×™×˜×•×œ"})]})]})]})})}function Ae(){const{user:s,checkAuthStatus:S}=H(),[I,i]=x.useState(!1),[g,l]=x.useState(!1),[u,n]=x.useState({type:null,message:""}),[m,C]=x.useState(null),[T,h]=x.useState({fullName:"",email:"",phone:"",address:"",birthDate:""});x.useEffect(()=>{y()},[]);const y=async()=>{try{l(!0);const c=await ie.getMyProfile();C(c),h({fullName:c?.personalInfo?.fullName||"",email:c?.personalInfo?.email||"",phone:c?.personalInfo?.phone||"",address:c?.personalInfo?.address||"",birthDate:c?.personalInfo?.birthDate||""})}catch(c){console.error("Error fetching profile data:",c),n({type:"error",message:"×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×¤×¨×•×¤×™×œ"}),s&&h({fullName:s?.personalInfo?.fullName||"",email:s?.personalInfo?.email||s?.email||"",phone:s?.personalInfo?.phone||s?.phone||"",address:s?.personalInfo?.address||s?.address||"",birthDate:s?.personalInfo?.birthDate||s?.birthDate||""})}finally{l(!1)}},f=async()=>{try{l(!0),n({type:null,message:""});const c=await ie.updateMyProfile(T);C(c),S&&await S(!0),i(!1),n({type:"success",message:"×”×¤×¨×•×¤×™×œ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”"}),setTimeout(()=>{n({type:null,message:""})},3e3)}catch(c){console.error("Error updating profile:",c),n({type:"error",message:"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¤×¨×•×¤×™×œ. ×× × × ×¡×” ×©×•×‘."})}finally{l(!1)}},w=()=>{const c=m||s;h({fullName:c?.personalInfo?.fullName||"",email:c?.personalInfo?.email||c?.email||"",phone:c?.personalInfo?.phone||c?.phone||"",address:c?.personalInfo?.address||c?.address||"",birthDate:c?.personalInfo?.birthDate||c?.birthDate||""}),i(!1),n({type:null,message:""})},D=c=>c?new Date(c).toLocaleDateString("he-IL"):"",v=m||s;return g&&!v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 font-reisinger-michal",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×¤×¨×•×¤×™×œ..."})]})}):e.jsxs("div",{className:"space-y-6",children:[u.type&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${u.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[u.type==="success"?e.jsx(be,{className:"w-5 h-5"}):e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-michal",children:u.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 font-reisinger-michal",children:"×¤×¨×˜×™× ××™×©×™×™×"}),I?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:f,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×©××™×¨×”"})]}),e.jsxs("button",{onClick:w,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×‘×™×˜×•×œ"})]})]}):e.jsxs("button",{onClick:()=>i(!0),disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"font-reisinger-michal",children:"×¢×¨×™×›×”"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"×©× ××œ×"}),I?e.jsx("input",{type:"text",value:T.fullName,onChange:c=>h(L=>({...L,fullName:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×©× ××œ×"}):e.jsx("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:"font-reisinger-michal",children:T.fullName||"×œ× ×¦×•×™×Ÿ"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:'×“×•×"×œ'}),I?e.jsx("input",{type:"email",value:T.email,onChange:c=>h(L=>({...L,email:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"example@email.com"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",dir:"ltr",children:T.email||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"×˜×œ×¤×•×Ÿ"}),I?e.jsx("input",{type:"tel",value:T.phone,onChange:c=>h(L=>({...L,phone:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"ltr",placeholder:"050-1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",dir:"ltr",children:T.phone||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"×›×ª×•×‘×ª"}),I?e.jsx("input",{type:"text",value:T.address,onChange:c=>h(L=>({...L,address:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",dir:"rtl",placeholder:"×”×–×Ÿ ×›×ª×•×‘×ª"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",children:T.address||"×œ× ×¦×•×™×Ÿ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 font-reisinger-michal",children:"×ª××¨×™×š ×œ×™×“×”"}),I?e.jsx("input",{type:"date",value:T.birthDate,onChange:c=>h(L=>({...L,birthDate:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-reisinger-michal",children:D(T.birthDate)||"×œ× ×¦×•×™×Ÿ"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-2 font-reisinger-michal",children:"××™×“×¢ ×ª×¤×§×™×“"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"×ª×¤×§×™×“:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:(()=>{const c=v?.roles||[];if(c.length>0)return c.join(", ");const L=v?.role||"";switch(L){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return L||"×œ× ×¦×•×™×Ÿ"}})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"××–×”×” ××©×ª××©:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal font-mono text-sm",children:v?.teacherId||v?._id||v?.id||"×œ× ×¦×•×™×Ÿ"})]}),v?.isActive!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"×¡×˜×˜×•×¡:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:v.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"})]}),v?.professionalInfo?.instrument&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 font-reisinger-michal",children:"×›×œ×™ × ×’×™× ×”:"}),e.jsx("div",{className:"text-blue-900 font-reisinger-michal",children:v.professionalInfo.instrument})]})]})]})]})}function Be(){const{user:s}=H(),[S,I]=x.useState("general"),[i,g]=x.useState(null),[l,u]=x.useState(!0);x.useEffect(()=>{s&&n()},[s]);const n=async()=>{try{if(u(!0),!(s?._id||s?.teacherId||s?.id)){console.warn("No user ID available for loading profile statistics");return}const c=await ie.getMyProfile();if(!c){console.warn("No teacher profile found"),g({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0});return}const L=c?.teaching?.studentIds||[],M=c?.conducting?.orchestraIds||[],W=c?.teaching?.timeBlocks||[],[b,E]=await Promise.allSettled([L.length>0?O.students.getBatchStudents(L):Promise.resolve([]),M.length>0?O.orchestras.getBatchOrchestras(M):Promise.resolve([])]),k=b.status==="fulfilled"?b.value:[];b.status==="rejected"&&console.error("Failed to load student data:",b.reason);const r=E.status==="fulfilled"?E.value:[];E.status==="rejected"&&console.error("Failed to load orchestra data:",E.reason);const t=Array.isArray(k)?k.filter(d=>d.academicInfo?.isActive!==!1):[],p=Array.isArray(W)?W.reduce((d,a)=>d+(parseInt(a.totalDuration)||0),0):0,N=Math.round(p/60*10)/10;g({studentsCount:Array.isArray(k)?k.length:0,activeStudents:t.length,weeklyHours:N,orchestrasCount:Array.isArray(r)?r.length:0,theoryLessonsCount:0})}catch(v){console.error("Error loading profile statistics:",v),g({studentsCount:0,activeStudents:0,weeklyHours:0,orchestrasCount:0,theoryLessonsCount:0})}finally{u(!1)}};if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××©×ª××©..."})]})});const C=(()=>{const v=[{id:"general",label:"×¤×¨×˜×™× ×›×œ×œ×™×™×",icon:te,component:Ae}];switch(s?.role||s?.roles?.[0]||""){case"teacher":case"××•×¨×”":return[...v,{id:"students",label:"×”×ª×œ××™×“×™× ×©×œ×™",icon:U,component:ue},{id:"schedule",label:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™",icon:z,component:he}];case"conductor":case"×× ×¦×—":return[...v,{id:"orchestras",label:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—",icon:V,component:ge}];case"theory_teacher":case"××•×¨×” ×ª×™××•×¨×™×”":return[...v,{id:"lessons",label:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™",icon:ee,component:xe}];default:const L=[...v];return(s?.roles?.includes("teacher")||s?.roles?.includes("××•×¨×”"))&&(L.push({id:"students",label:"×”×ª×œ××™×“×™× ×©×œ×™",icon:U,component:ue}),L.push({id:"schedule",label:"×œ×•×— ×–×× ×™× ×©×‘×•×¢×™",icon:z,component:he})),(s?.roles?.includes("conductor")||s?.roles?.includes("×× ×¦×—"))&&L.push({id:"orchestras",label:"×ª×–××•×¨×•×ª ×©×× ×™ ×× ×¦×—",icon:V,component:ge}),(s?.roles?.includes("theory_teacher")||s?.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”"))&&L.push({id:"lessons",label:"×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” ×©×œ×™",icon:ee,component:xe}),L}})(),h=(C.find(v=>v.id===S)||C[0]).component,y=()=>{const v=s?.role||s?.roles?.[0]||"";switch(v){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return v||"××©×ª××©"}},f=()=>s?.personalInfo?.fullName||s?.fullName||s?.name||"××©×ª××©",w=()=>{const v=f();if(!v||v==="××©×ª××©")return"×";const c=v.trim().split(" ");return c.length>=2?c[0][0]+c[1][0]:c[0][0]||"×"},D=()=>s?.personalInfo?.email||s?.email||"";return e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-white font-reisinger-michal",children:w()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-reisinger-michal",children:f()}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[y()," â€¢ ",D()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(Z,{title:"×¡×”×´×› ×ª×œ××™×“×™×",value:l?"...":i?.studentsCount?.toString()||"0",icon:U,color:"blue",loading:l}),e.jsx(Z,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:l?"...":i?.activeStudents?.toString()||"0",icon:Ce,color:"green",loading:l}),e.jsx(Z,{title:"×©×¢×•×ª ×©×‘×•×¢×™×•×ª",value:l?"...":i?.weeklyHours?.toString()||"0",icon:J,color:"purple",loading:l}),e.jsx(Z,{title:s?.roles?.includes("conductor")||s?.roles?.includes("×× ×¦×—")?"×ª×–××•×¨×•×ª":"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",value:l?"...":(i?.orchestrasCount||i?.theoryLessonsCount)?.toString()||"0",icon:s?.roles?.includes("conductor")||s?.roles?.includes("×× ×¦×—")?V:ee,color:"indigo",loading:l})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-0 overflow-x-auto scrollbar-hide",children:C.map(v=>{const c=v.icon;return e.jsxs("button",{onClick:()=>I(v.id),className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-6 py-3 sm:py-4 font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${S===v.id?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-michal",children:v.label})]},v.id)})})}),e.jsx("div",{className:"p-6",children:e.jsx(h,{})})]})]})}function Z({title:s,value:S,icon:I,color:i,loading:g}){const u={blue:{bg:"bg-blue-50",text:"text-blue-600",border:"border-blue-200"},green:{bg:"bg-green-50",text:"text-green-600",border:"border-green-200"},purple:{bg:"bg-purple-50",text:"text-purple-600",border:"border-purple-200"},indigo:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-indigo-200"}}[i];return e.jsx("div",{className:`bg-white rounded-lg border ${u.border} p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 font-reisinger-michal truncate",children:s}),e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 mt-1 font-reisinger-michal",children:g?e.jsx("div",{className:"animate-pulse bg-gray-200 h-6 sm:h-8 w-12 sm:w-16 rounded"}):S})]}),e.jsx("div",{className:`${u.bg} p-2 sm:p-3 rounded-full flex-shrink-0 ml-2`,children:e.jsx(I,{className:`w-4 h-4 sm:w-6 sm:h-6 ${u.text}`})})]})})}export{Be as default};
