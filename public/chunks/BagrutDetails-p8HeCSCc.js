import{j as e}from"../assets/index-Bt-rbdKT.js";import{r as p,R as we,c as hs,b as ys}from"./vendor-B2j9q2e_.js";import{C as G}from"./Card-Bp9nq125.js";import{T as fs}from"./Table-BQGUFwcb.js";import{S as xe}from"./StatsCard-CfdMOdiv.js";import{C as je}from"./ConfirmationModal-B7HaZ5IM.js";import{u as bs}from"./useBagrut-DphyHZix.js";import{a as K}from"./cascade-deletion-DAN0Gkem.js";import{ad as ge,ae as Fe,S as te,X as z,b as ie,e as js,d as ue,M as ee,af as oe,T as Y,P as Z,ag as Oe,x as ke,ah as Ce,U as se,r as pe,c as Be,i as Ns,A as J,ai as vs,aj as ws,ak as ks,f as de,m as Cs,Z as He,a3 as Bs,p as Ss,O as Re,_ as Ge,a9 as Ue,a7 as Te,B as Ne,o as $e,al as Ae,am as Ls}from"./ui-ypR0-hKN.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";const Ds=({isOpen:s,performance:g,programPieces:t,onClose:w,onUpdate:N})=>{const[h,b]=p.useState(!1),[o,n]=p.useState(g);if(we.useEffect(()=>{n(g),b(!1)},[g]),!s||!g||!o)return null;const k=()=>{o&&(N(o),b(!1))},I=()=>{n(g),b(!1)},U=(d,C)=>{n(D=>D?{...D,evaluation:{...D.evaluation,technique:0,interpretation:0,stage_presence:0,overall_impression:0,...D.evaluation,[d]:C}}:null)},B=()=>{const d=prompt("הכנס קישור להקלטה:");d&&o&&n({...o,recordingLinks:[...o.recordingLinks||[],d]})},S=d=>{o&&n({...o,recordingLinks:o.recordingLinks?.filter((C,D)=>D!==d)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-6 h-6 text-primary-600"}),h?e.jsx("input",{type:"text",value:o.title,onChange:d=>n({...o,title:d.target.value}),className:"text-2xl font-bold text-gray-900 bg-transparent border-b-2 border-gray-300 focus:border-primary-500 outline-none"}):e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:g.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,className:"flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(te,{className:"w-4 h-4"}),"שמור"]}),e.jsxs("button",{onClick:I,className:"flex items-center gap-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(z,{className:"w-4 h-4"}),"ביטול"]})]}):e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Fe,{className:"w-4 h-4"}),"ערוך"]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי הביצוع"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך וזמן"}),h?e.jsx("input",{type:"datetime-local",value:o.date?new Date(o.date).toISOString().slice(0,16):"",onChange:d=>n({...o,date:d.target.value?new Date(d.target.value):void 0}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.date?new Date(g.date).toLocaleString("he-IL",{dateStyle:"full",timeStyle:"short"}):"לא נקבע"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(js,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מקום"}),h?e.jsx("input",{type:"text",value:o.location||"",onChange:d=>n({...o,location:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"מקום הביצוע"}):e.jsx("p",{className:"text-gray-900",children:g.location||"לא צוין"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"משך זמן"}),h?e.jsx("input",{type:"text",value:o.duration||"",onChange:d=>n({...o,duration:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"לדוגמה: 45 דקות"}):e.jsx("p",{className:"text-gray-900",children:g.duration||"לא צוין"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"סטטוס"}),h?e.jsxs("select",{value:o.status,onChange:d=>n({...o,status:d.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"scheduled",children:"מתוזמן"}),e.jsx("option",{value:"completed",children:"הושלם"}),e.jsx("option",{value:"cancelled",children:"בוטל"})]}):e.jsxs("p",{className:"text-gray-900",children:[g.status==="completed"&&"הושלם",g.status==="scheduled"&&"מתוזמן",g.status==="cancelled"&&"בוטל"]})]})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"יצירות בביצוע"}),e.jsxs("div",{className:"space-y-2",children:[g.pieces.map((d,C)=>{const D=t.find(L=>L.pieceTitle===d||L.pieceName===d);return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ee,{className:"w-4 h-4 text-primary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d}),D&&e.jsxs("div",{className:"text-sm text-gray-600",children:[D.composer," ",D.duration&&`• ${D.duration}`]})]})]},C)}),g.pieces.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"אין יצירות שהוגדרו לביצוע זה"})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"הערכה"}),g.evaluation||h?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"technique",label:"טכניקה"},{key:"interpretation",label:"פרשנות"},{key:"stage_presence",label:"נוכחות במה"},{key:"overall_impression",label:"רושם כללי"}].map(({key:d,label:C})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:C}),h?e.jsx("input",{type:"number",min:"0",max:"100",value:o.evaluation?.[d]||0,onChange:D=>U(d,parseInt(D.target.value)||0),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[g.evaluation?.[d]||0,"/100"]})]},d))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"הערות המעריך"}),h?e.jsx("textarea",{value:o.evaluation?.comments||"",onChange:d=>U("comments",d.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"הערות על הביצוע..."}):e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:g.evaluation?.comments||"אין הערות"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מעריך"}),h?e.jsx("input",{type:"text",value:o.evaluation?.evaluator||"",onChange:d=>U("evaluator",d.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"שם המעריך"}):e.jsx("p",{className:"text-gray-900",children:g.evaluation?.evaluator||"לא צוין"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך הערכה"}),h?e.jsx("input",{type:"date",value:o.evaluation?.evaluationDate?new Date(o.evaluation.evaluationDate).toISOString().slice(0,10):"",onChange:d=>U("evaluationDate",d.target.value?new Date(d.target.value):void 0),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.evaluation?.evaluationDate?new Date(g.evaluation.evaluationDate).toLocaleDateString("he-IL"):"לא צוין"})]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"לא בוצעה הערכה עדיין"})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"הקלטות"}),h&&e.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(oe,{className:"w-4 h-4"}),"הוסף קישור"]})]}),o.recordingLinks&&o.recordingLinks.length>0?e.jsx("div",{className:"space-y-2",children:o.recordingLinks.map((d,C)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-blue-600 hover:underline truncate",children:d}),h&&e.jsx("button",{onClick:()=>S(C),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(z,{className:"w-4 h-4"})})]},C))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"אין הקלטות"})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"הערות נוספות"}),h?e.jsx("textarea",{value:o.notes||"",onChange:d=>n({...o,notes:d.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"הערות נוספות על הביצוע..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:g.notes||"אין הערות נוספות"})]})]})]})})},Is=Ds,Me=s=>s>=95?"מעולה":s>=90?"טוב מאוד":s>=85?"כמעט טוב מאוד":s>=75?"טוב":s>=65?"כמעט טוב":s>=55?"מספיק":s>=45?"מספיק בקושי":"לא עבר/ה",ve=s=>{if(!s)return 0;const g=s.playingSkills?.points||0,t=s.musicalUnderstanding?.points||0,w=s.textKnowledge?.points||0,N=s.playingByHeart?.points||0;return g+t+w+N},Es=(s,g)=>g||s==="עבר/ה"?"text-green-600 bg-green-50":s==="לא עבר/ה"?"text-red-600 bg-red-50":s==="לא נבחן"?"text-gray-600 bg-gray-50":"text-orange-600 bg-orange-50",Ps=({presentation:s,programPieces:g,onSave:t,onCancel:w})=>{const[N,h]=p.useState(s.date?new Date(s.date).toISOString().slice(0,16):""),[b,o]=p.useState(s.reviewedBy||""),[n,k]=p.useState(s.notes||""),[I,U]=p.useState(s.recordingLinks||[""]),[B,S]=p.useState([]),[d,C]=p.useState({});p.useEffect(()=>{const f=g.map((a,c)=>({pieceNumber:c+1,pieceTitle:a.pieceTitle,composer:a.composer,playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:!1,comments:""}));s.detailedGrading&&f.forEach((a,c)=>{c===0&&s.detailedGrading&&(a.playingSkills=s.detailedGrading.playingSkills?.points||0,a.musicalUnderstanding=s.detailedGrading.musicalUnderstanding?.points||0,a.textKnowledge=s.detailedGrading.textKnowledge?.points||0,a.playingByHeart=(s.detailedGrading.playingByHeart?.points||0)===10)}),S(f)},[g,s.detailedGrading]);const D=(f,a,c)=>{const i={playingSkills:40,musicalUnderstanding:30,textKnowledge:20}[a];return c<0?"הציון חייב להיות חיובי":c>i?`הציון המקסימלי הוא ${i}`:null},L=(f,a,c)=>{S(i=>{const l=[...i];return l[f]={...l[f],[a]:c},l});const y=`piece${f}_${a}`;d[y]&&C(i=>({...i,[y]:""}))},j=f=>f.playingSkills+f.musicalUnderstanding+f.textKnowledge+(f.playingByHeart?10:0),v=()=>{if(B.length===0)return 0;const f=B.reduce((c,y)=>c+j(y),0),a=B.length*100;return Math.round(f/a*100)},u=()=>{const f={};return B.forEach((a,c)=>{const y=D(c,"playingSkills",a.playingSkills),i=D(c,"musicalUnderstanding",a.musicalUnderstanding),l=D(c,"textKnowledge",a.textKnowledge);y&&(f[`piece${c}_playingSkills`]=y),i&&(f[`piece${c}_musicalUnderstanding`]=i),l&&(f[`piece${c}_textKnowledge`]=l)}),N||(f.presentationDate="תאריך השמעה נדרש"),b.trim()||(f.examinerNames="שמות הבוחנים נדרשים"),C(f),Object.keys(f).length===0},P=()=>{if(!u())return;const f=v(),a={playingSkills:{points:Math.round(B.reduce((i,l)=>i+l.playingSkills,0)/B.length),maxPoints:40,grade:"מעולה",comments:"ממוצע מכל היצירות"},musicalUnderstanding:{points:Math.round(B.reduce((i,l)=>i+l.musicalUnderstanding,0)/B.length),maxPoints:30,grade:"טוב מאוד",comments:"ממוצע מכל היצירות"},textKnowledge:{points:Math.round(B.reduce((i,l)=>i+l.textKnowledge,0)/B.length),maxPoints:20,grade:"טוב",comments:"ממוצע מכל היצירות"},playingByHeart:{points:B.filter(i=>i.playingByHeart).length>B.length/2?10:0,maxPoints:10,grade:B.filter(i=>i.playingByHeart).length>B.length/2?"כן":"לא",comments:`${B.filter(i=>i.playingByHeart).length} מתוך ${B.length} יצירות נוגנו בע"פ`}},y={...{...s,date:N?new Date(N):void 0,reviewedBy:b,notes:n,recordingLinks:I.filter(i=>i.trim()!==""),detailedGrading:a,grade:f,gradeLevel:H(f),completed:f>=60,status:f>=60?"עבר/ה":"לא עבר/ה"},backendIndex:-1};t(s.presentationNumber-1,y)},H=f=>f>=95?"מצטיין במיוחד":f>=90?"מצטיין":f>=85?"טוב מאוד":f>=70?"טוב":f>=60?"עובר":"לא עובר",$=()=>{U([...I,""])},_=(f,a)=>{const c=[...I];c[f]=a,U(c)},X=f=>{I.length>1&&U(I.filter((a,c)=>c!==f))},V=f=>{const a=[];for(let c=0;c<=f;c++)a.push(e.jsx("option",{value:c,children:c},c));return a};return e.jsx("div",{className:"detailed-grading-modal",children:e.jsxs("div",{className:"detailed-grading-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"מגן בגרות - השמעה 4"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"השמעה אחרונה לקראת רסיטל וקביעת ציון מגן"})]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"סגור",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 scroll-smooth focus:scroll-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי השמעה"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך השמעה *"}),e.jsx("input",{type:"datetime-local",value:N,onChange:f=>h(f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.presentationDate?"border-red-300":"border-gray-300"}`}),d.presentationDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.presentationDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שמות הבוחנים *"}),e.jsx("input",{type:"text",value:b,onChange:f=>o(f.target.value),placeholder:"שם מלא של הבוחן/ים",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d.examinerNames?"border-red-300":"border-gray-300"}`}),d.examinerNames&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.examinerNames})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"תיעוד השמעה"}),e.jsxs("div",{className:"space-y-3",children:[I.map((f,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:f,onChange:c=>_(a,c.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),I.length>1&&e.jsx("button",{onClick:()=>X(a),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},a)),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),"הוסף קישור נוסף"]})]})]})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"טבלת ציונים מפורטת"}),e.jsxs("div",{className:"flex items-center gap-2 text-lg font-bold text-primary-600",children:[e.jsx(Oe,{className:"w-5 h-5"}),"ממוצע כללי: ",v()]})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs("table",{className:"detailed-grading-table",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-sm font-semibold text-gray-700 border border-gray-200",children:"מס' יצירה"}),e.jsx("th",{className:"px-2 sm:px-4 py-3 text-right text-sm font-semibold text-gray-700 border border-gray-200 min-w-[180px]",children:"שם היצירה ומלחין"}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["מיומנות נגינה/שירה",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 40)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["הבנה מוסיקלית",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 30)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:["ידיעת הטקסט",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 20)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:['נוגן בע"פ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-2 sm:px-4 py-3 text-center text-xs sm:text-sm font-semibold text-gray-700 border border-gray-200",children:['סה"כ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:B.map((f,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 sm:px-4 py-3 text-center font-medium text-gray-900 border border-gray-200",children:f.pieceNumber}),e.jsx("td",{className:"px-2 sm:px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-xs sm:text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.pieceTitle}),e.jsx("div",{className:"text-gray-600",children:f.composer})]})}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:f.playingSkills,onChange:c=>L(a,"playingSkills",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_playingSkills`]?"border-red-300":"border-gray-300"}`,children:V(40)}),d[`piece${a}_playingSkills`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_playingSkills`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:f.musicalUnderstanding,onChange:c=>L(a,"musicalUnderstanding",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_musicalUnderstanding`]?"border-red-300":"border-gray-300"}`,children:V(30)}),d[`piece${a}_musicalUnderstanding`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_musicalUnderstanding`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("select",{value:f.textKnowledge,onChange:c=>L(a,"textKnowledge",parseInt(c.target.value)),className:`w-16 sm:w-20 px-1 sm:px-2 py-1 text-center text-sm border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${d[`piece${a}_textKnowledge`]?"border-red-300":"border-gray-300"}`,children:V(20)}),d[`piece${a}_textKnowledge`]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d[`piece${a}_textKnowledge`]})]}),e.jsxs("td",{className:"px-2 sm:px-4 py-3 text-center border border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:f.playingByHeart,onChange:c=>L(a,"playingByHeart",c.target.checked),className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:f.playingByHeart?"10":"0"})]}),e.jsx("td",{className:"px-2 sm:px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:j(f)})]},a))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"מפתח ציונים"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"95-100"}),e.jsx("span",{className:"text-gray-600",children:"מצטיין במיוחד"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"90-94"}),e.jsx("span",{className:"text-gray-600",children:"מצטיין"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"85-89"}),e.jsx("span",{className:"text-gray-600",children:"טוב מאוד"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-yellow-600",children:"70-84"}),e.jsx("span",{className:"text-gray-600",children:"טוב"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-orange-600",children:"60-69"}),e.jsx("span",{className:"text-gray-600",children:"עובר"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-red-600",children:"0-59"}),e.jsx("span",{className:"text-gray-600",children:"לא עובר"})]})]})]})]}),e.jsxs(G,{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"הערות כלליות"}),e.jsx("textarea",{value:n,onChange:f=>k(f.target.value),placeholder:"הערות כלליות על הביצוע, המלצות לשיפור, נקודות חוזק...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-vertical"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsx("button",{onClick:w,className:"flex-1 sm:flex-none px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"ביטול"}),e.jsxs("button",{onClick:P,className:"flex-1 sm:flex-none flex items-center justify-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"שמור ציונים"]})]})})]})})},Gs=({presentation:s,onUpdate:g,onView:t,onDelete:w,programPieces:N=[]})=>{const[h,b]=p.useState(!1),[o,n]=p.useState(!1),[k,I]=p.useState(!1),[U,B]=p.useState(s),[S,d]=p.useState([]),[C,D]=p.useState([]),[L,j]=p.useState("");console.log("🔍 PresentationCard render:",{presentationNumber:s.presentationNumber,"presentation.reviewedBy":s.reviewedBy,examinerNames:L,renderTime:new Date().toISOString()}),we.useEffect(()=>{if(h){const i=s.reviewedBy?s.reviewedBy.split(",").map(m=>m.trim()).filter(m=>m.length>0):[""];d(i.length>0?i:[""]);const l=s.recordingLinks&&s.recordingLinks.length>0?s.recordingLinks:[""];D(l)}},[h,s.reviewedBy,s.recordingLinks]),we.useEffect(()=>{(async()=>{if(s.reviewedBy){console.log("🔍 Starting examiner name resolution for:",s.reviewedBy);const l=s.reviewedBy.split(",").map(T=>T.trim()),m=[];for(const T of l)if(console.log("🔍 Processing part:",T,"Is ObjectId?",/^[a-f\d]{24}$/i.test(T)),/^[a-f\d]{24}$/i.test(T))try{console.log("🔍 Fetching teacher for ObjectId:",T);const R=await K.teachers.getTeacher(T);console.log("📋 Teacher response for ID",T,":",R);const ce=R?.personalInfo?.fullName||(R?.personalInfo?.firstName&&R?.personalInfo?.lastName?`${R.personalInfo.firstName} ${R.personalInfo.lastName}`:R?.personalInfo?.firstName||R?.personalInfo?.lastName)||T;console.log("✅ Resolved teacher name:",T,"->",ce),m.push(ce)}catch(R){console.error("❌ Error fetching teacher name for",T,":",R),m.push(T)}else console.log("✅ Using name as-is:",T),m.push(T);const F=m.join(", ");console.log("🔍 Final examiner names:",F),console.log("🔍 Setting examinerNames state to:",F),j(F),console.log("🔍 examinerNames state should now be:",F)}else j("")})()},[s.reviewedBy]);const v=()=>{const i=S.filter(F=>F.trim().length>0).join(", "),l=C.filter(F=>F.trim().length>0),m={...U,reviewedBy:i,recordingLinks:l,backendIndex:s.backendIndex??s.presentationNumber-1};console.log("🔍 PresentationCard handleSave:",{examiners:S,reviewedByString:i,updatedData:m,presentationNumber:s.presentationNumber}),g(s.presentationNumber-1,m),b(!1)},u=()=>{B(s),d([]),D([]),b(!1)},P=()=>{w&&(w(s.presentationNumber-1),I(!1))},H=()=>{d([...S,""])},$=(i,l)=>{const m=[...S];m[i]=l,d(m)},_=i=>{S.length>1&&d(S.filter((l,m)=>m!==i))},X=()=>{D([...C,""])},V=(i,l)=>{const m=[...C];m[i]=l,D(m)},f=i=>{C.length>1&&D(C.filter((l,m)=>m!==i))},a=(i,l)=>l||i==="עבר/ה"?"עבר/ה":i==="לא עבר/ה"?"לא עבר/ה":i==="לא נבחן"?"לא נבחן":"ממתין",c=(i,l)=>l||i==="עבר/ה"?e.jsx(Be,{className:"w-4 h-4"}):i==="לא עבר/ה"?e.jsx(Ns,{className:"w-4 h-4"}):i==="לא נבחן"?e.jsx(J,{className:"w-4 h-4"}):e.jsx(ue,{className:"w-4 h-4"}),y=s.type==="magen";return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:`hover:shadow-lg transition-all cursor-pointer group relative ${y?"bg-blue-50":""}`,children:e.jsxs("div",{onClick:()=>!h&&t(s),className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx(ke,{className:"w-5 h-5 text-yellow-500"}):e.jsx(ge,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${Es(s.status,s.completed)}`,children:[c(s.status,s.completed),a(s.status,s.completed)]}),!h&&!o?e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),y&&N.length>0?n(!0):b(!0)},className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-all",title:"עריכה",children:e.jsx(Ce,{className:"w-4 h-4"})}),w&&e.jsx("button",{onClick:i=>{i.stopPropagation(),I(!0)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-all",title:"מחיקה",children:e.jsx(Y,{className:"w-4 h-4"})})]}):h?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),v()},className:"p-1 text-green-600 hover:bg-green-50 rounded",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),u()},className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(z,{className:"w-4 h-4"})})]}):null]})]}),h?e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700 w-24",children:"תאריך השמעה:"}),e.jsx("input",{type:"datetime-local",value:U.date?new Date(U.date).toISOString().slice(0,16):"",onChange:i=>B({...U,date:i.target.value?new Date(i.target.value):void 0}),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"שמות הבוחנים:"})]}),S.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-2 mr-6",children:[e.jsx("input",{type:"text",value:i,onChange:m=>$(l,m.target.value),placeholder:"שם הבוחן",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"}),S.length>1&&e.jsx("button",{onClick:()=>_(l),className:"p-1 text-red-600 hover:bg-red-50 rounded",type:"button",children:e.jsx(Y,{className:"w-4 h-4"})})]},l)),e.jsxs("button",{onClick:H,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded transition-colors text-sm mr-6",type:"button",children:[e.jsx(Z,{className:"w-4 h-4"}),"הוסף בוחן"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"קישורי תיעוד:"})]}),C.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-2 mr-6",children:[e.jsx("input",{type:"url",value:i,onChange:m=>V(l,m.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm"}),C.length>1&&e.jsx("button",{onClick:()=>f(l),className:"p-1 text-red-600 hover:bg-red-50 rounded",type:"button",children:e.jsx(Y,{className:"w-4 h-4"})})]},l)),e.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded transition-colors text-sm mr-6",type:"button",children:[e.jsx(Z,{className:"w-4 h-4"}),"הוסף קישור"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"הערות כלליות:"})]}),e.jsx("textarea",{value:U.notes||"",onChange:i=>B({...U,notes:i.target.value}),placeholder:"הערות כלליות על הביצוע...",className:"w-full px-3 py-2 border border-gray-300 rounded focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none text-sm resize-vertical",rows:3})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.date?new Date(s.date).toLocaleDateString("he-IL",{year:"numeric",month:"short",day:"numeric"}):"לא נקבע"})]}),(L||s.reviewedBy)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{title:`Original: ${s.reviewedBy}, Resolved: ${L||"none"}`,children:(()=>{const i=L||s.reviewedBy;return console.log("🔍 Rendering examiner display:",{examinerNames:L,"presentation.reviewedBy":s.reviewedBy,displayName:i,presentationNumber:s.presentationNumber}),i})()})]})]}),y&&s.detailedGrading&&!h&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"מיומנות נגינה"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.playingSkills?.points||0,"/40"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"הבנה מוסיקלית"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.musicalUnderstanding?.points||0,"/30"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:"ידיעת הטקסט"}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.textKnowledge?.points||0,"/20"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-blue-200",children:[e.jsx("div",{className:"font-medium text-gray-600",children:'נוגן בע"פ'}),e.jsxs("div",{className:"text-primary-600 font-semibold",children:[s.detailedGrading.playingByHeart?.points||0,"/10"]})]})]})}),s.notes&&!h&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"הערות: "}),s.notes.length>100?`${s.notes.substring(0,100)}...`:s.notes]}),s.recordingLinks&&s.recordingLinks.length>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.recordingLinks.length," קישורי תיעוד"]})]})]})}),o&&e.jsx(Ps,{presentation:s,programPieces:N,onSave:(i,l)=>{g(i,l),n(!1)},onCancel:()=>n(!1)}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(Y,{className:"w-6 h-6 text-red-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["מחיקת ",s.title]})]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["האם אתה בטוח שברצונך למחוק את ",s.title,"? פעולה זו לא ניתנת לביטול."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"ביטול"}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"מחק"})]})]})})]})},Us=Gs,Ts=({isOpen:s,title:g,placeholder:t="",initialValue:w="",onSubmit:N,onClose:h})=>{const[b,o]=p.useState(w);if(!s)return null;const n=I=>{I.preventDefault(),b.trim()&&(N(b.trim()),o(""),h())},k=()=>{o(""),h()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g}),e.jsx("button",{onClick:k,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:n,className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"url",value:b,onChange:I=>o(I.target.value),placeholder:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",autoFocus:!0,required:!0})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"ביטול"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"הוסף"})]})]})]})})},$s=({isOpen:s,presentation:g,programPieces:t,onClose:w,onUpdate:N,onNavigateToTab:h})=>{const[b,o]=p.useState(!1),[n,k]=p.useState(g),[I,U]=p.useState(!1);if(p.useEffect(()=>{k(g),o(!1)},[g]),!s||!g||!n)return null;const B=g.type==="magen",S=()=>{if(n){if(B&&n.detailedGrading){const j=ve(n.detailedGrading);n.grade=j,n.gradeLevel=Me(j)}N(g.presentationNumber-1,n),o(!1),setTimeout(()=>{w(),h&&h("השמעות")},100)}},d=()=>{k(g),o(!1)},C=(j,v,u)=>{n.detailedGrading||(n.detailedGrading={playingSkills:{grade:"",points:0,maxPoints:40,comments:""},musicalUnderstanding:{grade:"",points:0,maxPoints:30,comments:""},textKnowledge:{grade:"",points:0,maxPoints:20,comments:""},playingByHeart:{grade:"",points:0,maxPoints:10,comments:""}}),k({...n,detailedGrading:{...n.detailedGrading,[j]:{...n.detailedGrading[j],[v]:u}}})},D=j=>{j&&n&&k({...n,recordingLinks:[...n.recordingLinks||[],j]})},L=j=>{n&&k({...n,recordingLinks:n.recordingLinks?.filter((v,u)=>u!==j)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[B?e.jsx(ke,{className:"w-6 h-6 text-yellow-500"}):e.jsx(ge,{className:"w-6 h-6 text-primary-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:g.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(te,{className:"w-4 h-4"}),"שמור"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(z,{className:"w-4 h-4"}),"ביטול"]})]}):e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Fe,{className:"w-4 h-4"}),"ערוך"]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי ההשמעה"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך השמעה"}),b?e.jsx("input",{type:"date",value:n.date?new Date(n.date).toISOString().slice(0,10):"",onChange:j=>k({...n,date:j.target.value?new Date(j.target.value):void 0}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}):e.jsx("p",{className:"text-gray-900",children:g.date?new Date(g.date).toLocaleDateString("he-IL"):"לא נקבע"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שמות הבוחנים"}),b?e.jsx("input",{type:"text",value:n.reviewedBy||"",onChange:j=>k({...n,reviewedBy:j.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"שמות הבוחנים"}):e.jsx("p",{className:"text-gray-900",children:g.reviewedBy||"לא צוין"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"סטטוס"}),b?e.jsxs("select",{value:n.status||"לא נבחן",onChange:j=>k({...n,status:j.target.value,completed:j.target.value==="עבר/ה"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"לא נבחן",children:"לא נבחן"}),e.jsx("option",{value:"עבר/ה",children:"עבר/ה"}),e.jsx("option",{value:"לא עבר/ה",children:"לא עבר/ה"})]}):e.jsx("p",{className:"text-gray-900",children:g.status||"לא נבחן"})]})]})]})]}),B&&e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פירוט ציונים - מגן בגרות"}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-right px-4 py-2 font-medium text-gray-700",children:"קריטריון"}),e.jsx("th",{className:"text-center px-4 py-2 font-medium text-gray-700",children:"ניקוד"}),e.jsx("th",{className:"text-center px-4 py-2 font-medium text-gray-700",children:"מקסימום"}),e.jsx("th",{className:"text-right px-4 py-2 font-medium text-gray-700",children:"הערות"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"מיומנות נגינה/שירה"}),e.jsx("td",{className:"text-center px-4 py-3",children:b?e.jsx("input",{type:"number",min:"0",max:"40",value:n.detailedGrading?.playingSkills?.points||0,onChange:j=>C("playingSkills","points",parseInt(j.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.playingSkills?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"40"}),e.jsx("td",{className:"px-4 py-3",children:b?e.jsx("input",{type:"text",value:n.detailedGrading?.playingSkills?.comments||"",onChange:j=>C("playingSkills","comments",j.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"הערות..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.playingSkills?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"הבנה מוסיקלית"}),e.jsx("td",{className:"text-center px-4 py-3",children:b?e.jsx("input",{type:"number",min:"0",max:"30",value:n.detailedGrading?.musicalUnderstanding?.points||0,onChange:j=>C("musicalUnderstanding","points",parseInt(j.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.musicalUnderstanding?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"30"}),e.jsx("td",{className:"px-4 py-3",children:b?e.jsx("input",{type:"text",value:n.detailedGrading?.musicalUnderstanding?.comments||"",onChange:j=>C("musicalUnderstanding","comments",j.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"הערות..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.musicalUnderstanding?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:"ידיעת הטקסט"}),e.jsx("td",{className:"text-center px-4 py-3",children:b?e.jsx("input",{type:"number",min:"0",max:"20",value:n.detailedGrading?.textKnowledge?.points||0,onChange:j=>C("textKnowledge","points",parseInt(j.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.textKnowledge?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"20"}),e.jsx("td",{className:"px-4 py-3",children:b?e.jsx("input",{type:"text",value:n.detailedGrading?.textKnowledge?.comments||"",onChange:j=>C("textKnowledge","comments",j.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"הערות..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.textKnowledge?.comments||"-"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:'נוגן בע"פ'}),e.jsx("td",{className:"text-center px-4 py-3",children:b?e.jsx("input",{type:"number",min:"0",max:"10",value:n.detailedGrading?.playingByHeart?.points||0,onChange:j=>C("playingByHeart","points",parseInt(j.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center"}):e.jsx("span",{className:"font-semibold text-primary-600",children:n.detailedGrading?.playingByHeart?.points||0})}),e.jsx("td",{className:"text-center px-4 py-3 text-gray-600",children:"10"}),e.jsx("td",{className:"px-4 py-3",children:b?e.jsx("input",{type:"text",value:n.detailedGrading?.playingByHeart?.comments||"",onChange:j=>C("playingByHeart","comments",j.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"הערות..."}):e.jsx("span",{className:"text-gray-600 text-sm",children:n.detailedGrading?.playingByHeart?.comments||"-"})})]}),e.jsxs("tr",{className:"bg-primary-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-3",children:'סה"כ'}),e.jsx("td",{className:"text-center px-4 py-3 text-primary-600 text-lg",children:ve(n.detailedGrading)}),e.jsx("td",{className:"text-center px-4 py-3",children:"100"}),e.jsx("td",{className:"px-4 py-3 text-primary-600",children:Me(ve(n.detailedGrading))})]})]})]})})})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"קישורי תיעוד"}),b&&e.jsxs("button",{onClick:()=>U(!0),className:"flex items-center gap-1 px-3 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(oe,{className:"w-4 h-4"}),"הוסף קישור"]})]}),n.recordingLinks&&n.recordingLinks.length>0?e.jsx("div",{className:"space-y-2",children:n.recordingLinks.map((j,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-blue-600 hover:underline truncate",children:j}),b&&e.jsx("button",{onClick:()=>L(v),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(z,{className:"w-4 h-4"})})]},v))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"אין קישורי תיעוד"})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"הערות כלליות"}),b?e.jsx("textarea",{value:n.notes||"",onChange:j=>k({...n,notes:j.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"הערות כלליות על ההשמעה..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:g.notes||"אין הערות"})]})]}),e.jsx(Ts,{isOpen:I,title:"הוסף קישור לתיעוד",placeholder:"https://example.com/recording",onSubmit:D,onClose:()=>U(!1)})]})})},As=$s,Ms=({bagrut:s,onUpdate:g})=>{const[t,w]=p.useState(!1),[N,h]=p.useState(""),[b,o]=p.useState({date:"",reviewedBy:[""],recordingLinks:[""],review:"",completed:!1,grade:0,detailedGrading:null}),[n,k]=p.useState([]),[I,U]=p.useState({});p.useEffect(()=>{if(s.magenBagrut){const a=s.magenBagrut.reviewedBy?s.magenBagrut.reviewedBy.split(",").map(y=>y.trim()):[""],c=s.magenBagrut.recordingLinks&&s.magenBagrut.recordingLinks.length>0?s.magenBagrut.recordingLinks:[""];o({date:s.magenBagrut.date?new Date(s.magenBagrut.date).toISOString().slice(0,16):"",reviewedBy:a.length>0?a:[""],recordingLinks:c,review:s.magenBagrut.review||"",completed:s.magenBagrut.completed||!1,grade:s.magenBagrut.grade||0,detailedGrading:s.magenBagrut.detailedGrading||null})}if(s.program&&s.program.length>0){const a=s.program.map((c,y)=>({pieceNumber:c.pieceNumber||y+1,pieceTitle:c.pieceTitle,composer:c.composer,playingSkills:0,musicalUnderstanding:0,textKnowledge:0,playingByHeart:!1,comments:""}));s.magenBagrut?.pieceGradings&&s.magenBagrut.pieceGradings.forEach((c,y)=>{a[y]&&(a[y]={...a[y],...c})}),k(a)}},[s.magenBagrut,s.program]),p.useEffect(()=>{(async()=>{if(s.magenBagrut?.reviewedBy){const c=s.magenBagrut.reviewedBy.split(",").map(i=>i.trim()),y=[];for(const i of c)if(/^[a-f\d]{24}$/i.test(i))try{const l=await K.teachers.getTeacher(i);console.log("📋 Teacher response for ID",i,":",l);const m=l?.personalInfo?.fullName||(l?.personalInfo?.firstName&&l?.personalInfo?.lastName?`${l.personalInfo.firstName} ${l.personalInfo.lastName}`:l?.personalInfo?.firstName||l?.personalInfo?.lastName)||i;console.log("✅ Resolved teacher name:",i,"->",m),y.push(m)}catch(l){console.error("Error fetching teacher name:",l),y.push(i)}else y.push(i);h(y.join(", "))}else h("")})()},[s.magenBagrut?.reviewedBy]);const B=(a,c,y)=>{k(l=>{const m=[...l];return m[a]={...m[a],[c]:y},m});const i=`piece${a}_${c}`;I[i]&&U(l=>({...l,[i]:""}))},S=a=>a.playingSkills+a.musicalUnderstanding+a.textKnowledge+(a.playingByHeart?10:0),d=()=>{if(n.length===0)return 0;const a=n.reduce((y,i)=>y+S(i),0),c=n.length*100;return Math.round(a/c*100)},C=a=>a>=90?"מעולה":a>=80?"טוב מאוד":a>=70?"טוב":a>=60?"מספיק":a>=55?"מספיק בקושי":a>=1?"לא עבר/ה":null,D=a=>{const c=[];for(let y=0;y<=a;y++)c.push(e.jsx("option",{value:y,children:y},y));return c},L=async()=>{try{console.log("🔄 Starting מגן בגרות save process..."),console.log("🔍 Current form data:",b),console.log("🔍 Current piece gradings:",n);const a=b.reviewedBy.filter(m=>m.trim().length>0).join(", "),c=b.recordingLinks.filter(m=>m.trim().length>0);console.log("🔍 Processed reviewedByString:",a),console.log("🔍 Processed validLinks:",c);const y=d();console.log("🔍 Calculated overall grade:",y);let i=null;n.length>0&&(i={playingSkills:{points:Math.round(n.reduce((m,F)=>m+F.playingSkills,0)/n.length),maxPoints:40,grade:"מעולה",comments:"ממוצע מכל היצירות"},musicalUnderstanding:{points:Math.round(n.reduce((m,F)=>m+F.musicalUnderstanding,0)/n.length),maxPoints:30,grade:"טוב מאוד",comments:"ממוצע מכל היצירות"},textKnowledge:{points:Math.round(n.reduce((m,F)=>m+F.textKnowledge,0)/n.length),maxPoints:20,grade:"טוב",comments:"ממוצע מכל היצירות"},playingByHeart:{points:n.filter(m=>m.playingByHeart).length>n.length/2?10:0,maxPoints:10,grade:n.filter(m=>m.playingByHeart).length>n.length/2?"מעולה":"לא הוערך",comments:`${n.filter(m=>m.playingByHeart).length} מתוך ${n.length} יצירות נוגנו בע"פ`}});const l={date:b.date?new Date(b.date):void 0,reviewedBy:a,review:b.review,recordingLinks:c,completed:y>=60,grade:y,gradeLevel:C(y),detailedGrading:i,pieceGradings:n};console.log("💾 Final מגן בגרות data to save:",l),console.log("📡 Calling onUpdate with magen data..."),await g(l),console.log("✅ onUpdate completed successfully"),w(!1),console.log("🔄 Edit mode disabled, save process completed")}catch(a){console.error("❌ Error saving מגן בגרות:",a),console.error("❌ Error details:",a.message,a.stack)}},j=()=>{w(!1)},v=()=>{o(a=>({...a,reviewedBy:[...a.reviewedBy,""]}))},u=(a,c)=>{o(y=>{const i=[...y.reviewedBy];return i[a]=c,{...y,reviewedBy:i}})},P=a=>{b.reviewedBy.length>1&&o(c=>({...c,reviewedBy:c.reviewedBy.filter((y,i)=>i!==a)}))},H=()=>{o(a=>({...a,recordingLinks:[...a.recordingLinks,""]}))},$=(a,c)=>{o(y=>{const i=[...y.recordingLinks];return i[a]=c,{...y,recordingLinks:i}})},_=a=>{b.recordingLinks.length>1&&o(c=>({...c,recordingLinks:c.recordingLinks.filter((y,i)=>i!==a)}))},X=()=>s.magenBagrut?s.magenBagrut.completed?"green":s.magenBagrut.date?"orange":"gray":"gray",V=()=>s.magenBagrut?s.magenBagrut.completed?e.jsx(Be,{className:"w-4 h-4"}):s.magenBagrut.date?e.jsx(ue,{className:"w-4 h-4"}):e.jsx(J,{className:"w-4 h-4"}):e.jsx(J,{className:"w-4 h-4"}),f=()=>s.magenBagrut?s.magenBagrut.completed?"הושלם":s.magenBagrut.date?"מתוזמן":"בתהליך":"לא נקבע";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"מגן בגרות"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium 
            ${X()==="green"?"bg-green-100 text-green-800":X()==="orange"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[V(),f()]})]}),e.jsx("div",{className:"flex gap-2",children:t?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"שמור"]}),e.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"ביטול"]})]}):e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),"עריכה"]})})]}),s.magenBagrut||t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי השמעה"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"תאריך השמעה"]}),e.jsx("input",{type:"datetime-local",value:b.date,onChange:a=>o(c=>({...c,date:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"תאריך השמעה"}),e.jsx("div",{className:"font-medium text-gray-900",children:s.magenBagrut?.date?new Date(s.magenBagrut.date).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.jsx("span",{className:"text-gray-400",children:"לא נקבע"})})]})]})}),e.jsx("div",{className:"md:col-span-2",children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(se,{className:"w-4 h-4"}),"שמות הבוחנים"]}),b.reviewedBy.map((a,c)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:a,onChange:y=>u(c,y.target.value),placeholder:"שם הבוחן",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),b.reviewedBy.length>1&&e.jsx("button",{onClick:()=>P(c),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},c)),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),"הוסף בוחן"]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"בוחנים"}),e.jsx("div",{className:"font-medium text-gray-900",children:N||s.magenBagrut?.reviewedBy?N||s.magenBagrut.reviewedBy:e.jsx("span",{className:"text-gray-400",children:"לא הוזנו"})})]})]})})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:t?e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"קישורי תיעוד"]}),b.recordingLinks.map((a,c)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:a,onChange:y=>$(c,y.target.value),placeholder:"https://example.com/recording",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),b.recordingLinks.length>1&&e.jsx("button",{onClick:()=>_(c),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},c)),e.jsxs("button",{onClick:H,className:"flex items-center gap-2 px-3 py-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),"הוסף קישור"]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"קישורי תיעוד"}),s.magenBagrut?.recordingLinks&&s.magenBagrut.recordingLinks.length>0?e.jsx("div",{className:"space-y-1",children:s.magenBagrut.recordingLinks.map((a,c)=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"block text-blue-600 hover:text-blue-800 hover:underline text-sm",children:a},c))}):e.jsx("div",{className:"text-gray-400 text-sm",children:"אין קישורים"})]})]})})]}),s.program&&s.program.length>0?e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"טבלת ציונים מפורטת"}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-lg font-bold text-primary-600",children:[e.jsx(Oe,{className:"w-5 h-5"}),"ממוצע כללי: ",d()]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200",children:"מס' יצירה"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200 min-w-[200px]",children:"שם היצירה ומלחין"}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["מיומנות נגינה/שירה",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 40)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["הבנה מוסיקלית",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 30)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["ידיעת הטקסט",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 20)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['נוגן בע"פ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['סה"כ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:n.length>0?n.map((a,c)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center font-medium text-gray-900 border border-gray-200",children:a.pieceNumber}),e.jsx("td",{className:"px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.pieceTitle}),e.jsx("div",{className:"text-gray-600",children:a.composer})]})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.playingSkills,onChange:y=>B(c,"playingSkills",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_playingSkills`]?"border-red-300":"border-gray-300"}`,children:D(40)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.playingSkills})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.musicalUnderstanding,onChange:y=>B(c,"musicalUnderstanding",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_musicalUnderstanding`]?"border-red-300":"border-gray-300"}`,children:D(30)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.musicalUnderstanding})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsx("select",{value:a.textKnowledge,onChange:y=>B(c,"textKnowledge",parseInt(y.target.value)),className:`w-20 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent ${I[`piece${c}_textKnowledge`]?"border-red-300":"border-gray-300"}`,children:D(20)}):e.jsx("span",{className:"font-medium text-gray-900",children:a.textKnowledge})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:t?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{type:"button",onClick:()=>B(c,"playingByHeart",!a.playingByHeart),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${a.playingByHeart?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a.playingByHeart?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:a.playingByHeart?"10":"0"})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[a.playingByHeart?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-sm font-medium",children:"כן"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-sm font-medium",children:"לא"}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:a.playingByHeart?"10":"0"})]})}),e.jsx("td",{className:"px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:S(a)})]},c)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500 border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(J,{className:"w-8 h-8 text-gray-300"}),e.jsx("p",{children:"אין יצירות בתכנית הבגרות לדירוג"}),e.jsx("p",{className:"text-sm",children:'יש להוסיף יצירות בלשונית "יצירות בתכנית" לפני המשך הדירוג'})]})})})})]})}),t&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"מפתח ציונים"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"95-100"}),e.jsx("span",{className:"text-gray-600",children:"מצטיין במיוחד"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-green-600",children:"90-94"}),e.jsx("span",{className:"text-gray-600",children:"מצטיין"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"85-89"}),e.jsx("span",{className:"text-gray-600",children:"טוב מאוד"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-yellow-600",children:"70-84"}),e.jsx("span",{className:"text-gray-600",children:"טוב"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-orange-600",children:"60-69"}),e.jsx("span",{className:"text-gray-600",children:"עובר"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-red-600",children:"0-59"}),e.jsx("span",{className:"text-gray-600",children:"לא עובר"})]})]})]})]}):e.jsx(G,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"אין יצירות בתכנית הבגרות"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["לפני שניתן לדרג את המגן בגרות, יש להוסיף יצירות לתכנית הבגרות.",e.jsx("br",{}),'עבור ללשונית "יצירות בתכנית" והוסף לפחות יצירה אחת.']}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>{const a=document.querySelector('[data-tab="works"]');a&&a.click()},className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),"עבור לרשימת יצירות"]})})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"מגן בגרות טרם נקבע"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"השמעת מגן בגרות היא השמעה אחרונה לקראת רסיטל וקביעת ציון מגן"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),"הגדר מגן בגרות"]})]})]})},_s=Ms,Fs=({isOpen:s,onClose:g,onSubmit:t,existingPieces:w=[],initialData:N=null,title:h="הוסף יצירה",submitText:b="הוסף יצירה"})=>{const[o,n]=p.useState({pieceNumber:1,pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),[k,I]=p.useState({}),[U,B]=p.useState(!1),S=()=>{const v=w.map(u=>u.pieceNumber).filter(u=>u!=null);for(let u=1;u<=10;u++)if(!v.includes(u))return u;return v.length+1},d=()=>{n(N?{pieceNumber:N.pieceNumber||1,pieceTitle:N.pieceTitle||"",composer:N.composer||"",duration:N.duration||"",movement:N.movement||"",youtubeLink:N.youtubeLink||""}:{pieceNumber:S(),pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),I({}),B(!1)};p.useEffect(()=>{s&&n(N?{pieceNumber:N.pieceNumber||1,pieceTitle:N.pieceTitle||"",composer:N.composer||"",duration:N.duration||"",movement:N.movement||"",youtubeLink:N.youtubeLink||""}:v=>({...v,pieceNumber:S()}))},[s,w,N]);const C=()=>{d(),g()},D=()=>{const v={};return(!o.pieceNumber||o.pieceNumber<1)&&(v.pieceNumber="מספר יצירה חובה"),w.some(P=>P.pieceNumber===o.pieceNumber)&&(!N||N.pieceNumber!==o.pieceNumber)&&(v.pieceNumber="מספר יצירה זה כבר קיים"),o.pieceTitle.trim()||(v.pieceTitle="שם היצירה הוא שדה חובה"),o.composer.trim()||(v.composer="שם המלחין הוא שדה חובה"),o.duration.trim()||(v.duration="משך הביצוע הוא שדה חובה"),o.youtubeLink&&o.youtubeLink.trim()&&(/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/.test(o.youtubeLink)||(v.youtubeLink="קישור יוטיוב לא תקין")),I(v),Object.keys(v).length===0},L=async v=>{if(v.preventDefault(),!!D()){B(!0);try{await t({...o,movement:o.movement?.trim()||void 0,youtubeLink:o.youtubeLink?.trim()||void 0}),C()}catch(u){console.error("Error adding piece:",u),I({general:"שגיאה בהוספת היצירה. אנא נסה שוב."})}finally{B(!1)}}},j=(v,u)=>{n(P=>({...P,[v]:u})),k[v]&&I(P=>({...P,[v]:""}))};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:h}),e.jsx("p",{className:"text-gray-600 mt-1",children:N?"ערוך את פרטי היצירה":"הוסף יצירה חדשה לתכנית הביצוע"})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:L,className:"p-6 space-y-6",children:[k.general&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("span",{className:"text-red-700",children:k.general})}),e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-600"}),"פרטי היצירה"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["מספר יצירה ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:o.pieceNumber,onChange:v=>j("pieceNumber",parseInt(v.target.value)),disabled:!!N,className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.pieceNumber?"border-red-300":"border-gray-300"} ${N?"bg-gray-100 cursor-not-allowed":""}`,children:Array.from({length:10},(v,u)=>u+1).map(v=>{const u=w.some(P=>P.pieceNumber===v);return e.jsxs("option",{value:v,disabled:u,children:["יצירה ",v," ",u?"(תפוס)":""]},v)})})]}),k.pieceNumber&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.pieceNumber})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["שם היצירה ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.pieceTitle,onChange:v=>j("pieceTitle",v.target.value),placeholder:"לדוגמה: סונטה לפסנתר במי מינור",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.pieceTitle?"border-red-300":"border-gray-300"}`}),k.pieceTitle&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.pieceTitle})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["מלחין ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.composer,onChange:v=>j("composer",v.target.value),placeholder:"לדוגמה: יוהאן סבסטיאן באך",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.composer?"border-red-300":"border-gray-300"}`})]}),k.composer&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.composer})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["משך הביצוע ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.duration,onChange:v=>j("duration",v.target.value),placeholder:"לדוגמה: 7 דקות",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.duration?"border-red-300":"border-gray-300"}`})]}),k.duration&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.duration})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"פרק"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.movement||"",onChange:v=>j("movement",v.target.value),placeholder:"לדוגמה: פרק ראשון - Allegro",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"אופציונלי - ציין פרק או תנועה ספציפיים"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"קישור יוטיוב"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:o.youtubeLink||"",onChange:v=>j("youtubeLink",v.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${k.youtubeLink?"border-red-300":"border-gray-300"}`})]}),k.youtubeLink&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:k.youtubeLink}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"אופציונלי - קישור להקלטה ביוטיוב"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:C,disabled:U,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ביטול"}),e.jsx("button",{type:"submit",disabled:U,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"מוסיף..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),b]})})]})]})]})}):null},_e=Fs,Os=({initialData:s,onSubmit:g,onCancel:t,isEdit:w=!1,showTeacherSearch:N=!0})=>{const[h,b]=p.useState({name:"",instrument:"",phone:"",email:""}),[o,n]=p.useState([]),[k,I]=p.useState(""),[U,B]=p.useState(!1),[S,d]=p.useState(null),[C,D]=p.useState(!1),[L,j]=p.useState({}),[v,u]=p.useState(!1),[P,H]=p.useState(!0),$=["פסנתר","גיטרה","כינור","ויולה","צ'לו","קונטרבס","חלילית","חליל צד","אבוב","קלרינט","סקסופון","בסון","חצוצרה","קרן יער","טרומבון","תופים","כלי הקשה","אחר"];p.useEffect(()=>{N&&(async()=>{try{H(!0);const m=await K.teachers.getTeachers();console.log("🎭 Loaded teachers for accompanist selection:",m?.length||0),n(m||[])}catch(m){console.error("Error loading teachers:",m)}finally{H(!1)}})()},[N]),p.useEffect(()=>{s&&(b({name:s.name||"",instrument:s.instrument||"",phone:s.phone||"",email:s.email||""}),D(!0))},[s]);const _=p.useMemo(()=>{if(!k.trim()||!o)return o.slice(0,10);const l=k.toLowerCase().trim();return o.filter(m=>{const F=m.personalInfo?.fullName?.toLowerCase()||"",T=m.personalInfo?.firstName?.toLowerCase()||"",R=m.personalInfo?.lastName?.toLowerCase()||"",ce=m.professionalInfo?.instruments?.join(" ").toLowerCase()||"";return F.includes(l)||T.includes(l)||R.includes(l)||ce.includes(l)}).slice(0,20)},[o,k]),X=l=>{d(l),b(m=>({...m,name:l.personalInfo?.fullName||"",phone:l.personalInfo?.phone||"",email:l.personalInfo?.email||""})),I(l.personalInfo?.fullName||""),B(!1),D(!1),L.name&&j(m=>({...m,name:""}))},V=l=>{I(l),B(!0),d(null),S||b(m=>({...m,name:l}))},f=()=>{D(!0),d(null),I(""),B(!1),b(l=>({...l,name:"",phone:"",email:""}))},a=()=>{const l={};return h.name.trim()||(l.name="שם המלווה הוא שדה חובה"),h.instrument.trim()||(l.instrument="כלי הליווי הוא שדה חובה"),h.email&&!h.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(l.email="כתובת אימייל לא תקינה"),h.phone&&h.phone.trim()&&(/^05\d{8}$/.test(h.phone.replace(/\D/g,""))||(l.phone="מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)")),j(l),Object.keys(l).length===0},c=async l=>{if(l.preventDefault(),!!a()){u(!0);try{await g(h)}catch(m){console.error("Error submitting accompanist:",m),j({general:"שגיאה בשמירת המלווה. אנא נסה שוב."})}finally{u(!1)}}},y=l=>{const m=l.replace(/\D/g,"");return m.startsWith("972")&&m.length>=12?"0"+m.slice(3):m.length>0&&!m.startsWith("05")&&m.startsWith("5")?"05"+m.slice(1,9):m.slice(0,10)},i=(l,m)=>{let F=m;l==="phone"&&(F=y(m)),b(T=>({...T,[l]:F})),L[l]&&j(T=>({...T,[l]:""}))};return e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:w?"עריכת מלווה":"מלווה חדש"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"הוספת נגן מלווה לביצוע הבגרות"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-6",children:[L.general&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700",children:L.general})]}),N&&!C&&e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),"בחירת מורה מהמערכת"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"חיפוש מורה"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:l=>V(l.target.value),onFocus:()=>B(!0),placeholder:"חפש לפי שם או כלי נגינה...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:P})]}),P&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"טוען רשימת מורים..."}),U&&!P&&_.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:_.map(l=>e.jsx("div",{onClick:()=>X(l),className:"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.personalInfo?.fullName||"ללא שם"}),l.professionalInfo?.instruments&&l.professionalInfo.instruments.length>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:["כלים: ",l.professionalInfo.instruments.join(", ")]}),l.personalInfo?.phone&&e.jsx("div",{className:"text-xs text-gray-500",children:l.personalInfo.phone})]})]})},l._id))})]}),S&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:["נבחר: ",S.personalInfo?.fullName]}),S.personalInfo?.phone&&e.jsxs("div",{className:"text-sm text-green-700",children:["טלפון: ",S.personalInfo.phone]})]})]})}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsx("button",{type:"button",onClick:f,className:"text-sm text-primary-600 hover:text-primary-700 underline",children:"לא מצאת את המורה? הזן פרטים באופן ידני"})})]})]}),(C||!N)&&e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),"פרטי המלווה"]}),N&&e.jsx("button",{type:"button",onClick:()=>D(!1),className:"text-sm text-primary-600 hover:text-primary-700 underline",children:"חזור לחיפוש מורים"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["שם המלווה ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:h.name,onChange:l=>i("name",l.target.value),placeholder:"לדוגמה: יוסי כהן",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.name?"border-red-300":"border-gray-300"}`}),L.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"מספר טלפון"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:h.phone,onChange:l=>i("phone",l.target.value),placeholder:"0501234567",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.phone?"border-red-300":"border-gray-300"}`,dir:"ltr"})]}),L.phone&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"כתובת אימייל"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:h.email,onChange:l=>i("email",l.target.value),placeholder:"לדוגמה: yosi@example.com",className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.email?"border-red-300":"border-gray-300"}`,dir:"ltr"})]}),L.email&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.email})]})]})]}),e.jsxs(G,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-600"}),"כלי הליווי"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["כלי הליווי ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:h.instrument,onChange:l=>i("instrument",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ${L.instrument?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"בחר כלי"}),$.map(l=>e.jsx("option",{value:l,children:l},l))]}),L.instrument&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:L.instrument}),h.instrument==="אחר"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",placeholder:"הכנס את שם הכלי",onChange:l=>i("instrument",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"מידע חשוב"}),e.jsx("p",{children:"פרטי הקשר יועברו למלווה לתיאום חזרות ויום הבגרות. ודא שהפרטים נכונים ועדכניים."})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:t,disabled:v,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ביטול"}),e.jsx("button",{type:"submit",disabled:v,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"שמור מלווה"]})})]})]})]})},Hs=Os;function Rs({accompaniment:s,onUpdate:g,readonly:t=!1}){const[w,N]=p.useState(null),[h,b]=p.useState(null),[o,n]=p.useState(!1),k=["נגן מלווה","הרכב"],I=["פסנתר","גיטרה","כינור","ויולה","צ'לו","קונטרבס","חלילית","קלרינט","סקסופון","חצוצרה","טרומבון","תופים","כלי הקשה","אחר"],U=u=>{g({...s,type:u})},B=u=>{N(u),b({...s.accompanists[u]})},S=()=>{N(null),b(null)},d=()=>{if(w!==null&&h){const u=[...s.accompanists];u[w]=h,g({...s,accompanists:u}),N(null),b(null)}},C=u=>{if(window.confirm("האם אתה בטוח שברצונך למחוק נגן זה?")){const P=s.accompanists.filter((H,$)=>$!==u);g({...s,accompanists:P})}},D=u=>{if(u.name&&u.instrument){const P=[...s.accompanists,{name:u.name,instrument:u.instrument,phone:u.phone}];g({...s,accompanists:P}),n(!1)}},L=()=>{n(!1)},j=u=>u?/^05\d{8}$/.test(u):!0,v=(u,P)=>{const H=w===P;return e.jsx(G,{padding:"md",className:"relative",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שם הנגן *"}),e.jsx("input",{type:"text",value:h?.name||"",onChange:$=>b(_=>_?{..._,name:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"שם מלא"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"כלי נגינה *"}),e.jsxs("select",{value:h?.instrument||"",onChange:$=>b(_=>_?{..._,instrument:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"בחר כלי נגינה"}),I.map($=>e.jsx("option",{value:$,children:$},$))]}),h?.instrument==="אחר"&&e.jsx("input",{type:"text",value:h?.instrument||"",onChange:$=>b(_=>_?{..._,instrument:$.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 mt-2",placeholder:"ציין כלי נגינה"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מספר טלפון"}),e.jsx("input",{type:"tel",value:h?.phone||"",onChange:$=>b(_=>_?{..._,phone:$.target.value||null}:null),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 ${h?.phone&&!j(h.phone)?"border-red-300 focus:ring-red-500":"border-gray-300"}`,placeholder:"0501234567"}),h?.phone&&!j(h.phone)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:"מספר טלפון חייב להתחיל ב-05 ולהכיל 10 ספרות"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ss,{className:"w-5 h-5 text-primary-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u.name})]}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:u.instrument})]}),u.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),e.jsx("a",{href:`tel:${u.phone}`,className:"text-sm text-primary-600 hover:text-primary-800",children:u.phone})]})]})}),!t&&e.jsx("div",{className:"flex items-center gap-2 mr-4",children:H?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:d,disabled:!h?.name||!h?.instrument,className:"p-2 text-green-600 hover:text-green-800 disabled:text-gray-400",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:S,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx(z,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(P),className:"p-2 text-primary-600 hover:text-primary-800",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(P),className:"p-2 text-red-600 hover:text-red-800",children:e.jsx(Y,{className:"w-4 h-4"})})]})})]})},P)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(de,{className:"w-6 h-6 mr-3 text-primary-600"}),"ליווי מוזיקלי"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"נגנים:"})," ",s.accompanists.length]}),!t&&e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"הוסף נגן"]})]})]}),e.jsxs(G,{padding:"md",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"סוג הליווי"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(u=>e.jsx("div",{children:e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"accompanimentType",value:u,checked:s.type===u,onChange:P=>!t&&U(P.target.value),disabled:t,className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),e.jsxs("div",{className:"mr-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:u}),e.jsx("div",{className:"text-sm text-gray-600",children:u==="נגן מלווה"?"נגן יחיד המלווה את הביצוע":"הרכב של מספר נגנים"})]})]})},u))})]}),o&&!t&&e.jsx(Hs,{onSubmit:D,onCancel:L}),s.accompanists.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["נגנים מלווים (",s.type,")"]}),s.accompanists.map((u,P)=>v(u,P))]}):e.jsx(G,{padding:"md",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"אין נגנים מלווים"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"הוסף נגן מלווה לביצוע הבגרות"}),!t&&e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"הוסף נגן ראשון"]})]})})]})}const Ks=s=>(s.presentations?.slice(0,3)||[]).map((w,N)=>({presentationNumber:N+1,title:`השמעה ${N+1}`,date:w.date,status:w.completed?"עבר/ה":"לא נבחן",completed:w.completed||!1,grade:w.grade,gradeLevel:w.gradeLevel,recordingLinks:w.recordingLinks||[],notes:w.notes||"",reviewedBy:w.reviewedBy,detailedGrading:w.detailedGrading,type:"regular",backendIndex:N})),Ke=s=>s.type==="magen"||s.presentationNumber===4||s.backendIndex===-1,zs=s=>Ke(s)?-1:s.backendIndex??s.presentationNumber-1,Vs=s=>s>=0&&s<=2,qs=s=>({completed:s.completed,status:s.status,date:s.date,review:s.notes,reviewedBy:s.reviewedBy,grade:s.grade,gradeLevel:s.gradeLevel,recordingLinks:s.recordingLinks||[]}),Ws=s=>{const g=s.presentations?.filter(w=>w.completed).length||0,t=s.magenBagrut?.completed?1:0;return{regular:g,magen:t,total:g+t}},Xs={MAX_REGULAR_PRESENTATIONS:3,TOTAL_PRESENTATIONS_WITH_MAGEN:4,MAGEN_DISPLAY_INDEX:4,MAGEN_BACKEND_MARKER:-1},ne=({label:s,icon:g,isActive:t,onClick:w,badge:N})=>e.jsxs("button",{onClick:w,className:`
      flex items-center px-4 py-3 border-b-2 transition-all
      ${t?"border-primary-600 text-primary-700 bg-primary-50":"border-transparent text-gray-800 hover:text-gray-900 hover:bg-gray-50"}
    `,children:[g,e.jsx("span",{className:"mr-2 font-medium",children:s}),N!==void 0&&N>0&&e.jsx("span",{className:"mr-2 px-2 py-0.5 bg-primary-100 text-primary-700 rounded-full text-xs font-semibold",children:N})]});function it(){const{bagrutId:s}=hs(),g=ys(),{bagrut:t,loading:w,error:N,fetchBagrutById:h,updateBagrut:b,deleteBagrut:o,completeBagrut:n,calculateFinalGrade:k,uploadDocument:I,removeDocument:U,downloadDocument:B}=bs(),[S,d]=p.useState("overview"),[C,D]=p.useState(null),[L,j]=p.useState(null),[v,u]=p.useState(!1),[P,H]=p.useState(!1),[$,_]=p.useState(""),[X,V]=p.useState(!1),[f,a]=p.useState(null),[c,y]=p.useState(!1),[i,l]=p.useState(!1),[m,F]=p.useState(!1),[T,R]=p.useState(null),[ce,he]=p.useState(!1),[ye,fe]=p.useState(null),[ze,Ve]=p.useState(null),[qe,Se]=p.useState(!1),[ae,be]=p.useState(!1),[q,re]=p.useState({teacherId:"",conservatoryName:"",testDate:"",recitalUnits:5,recitalField:"",notes:""});t?.program?.slice(0,2).map(r=>r.pieceTitle||r.pieceName||""),t?.program?.slice(2,4).map(r=>r.pieceTitle||r.pieceName||""),t?.program?.slice(4,5).map(r=>r.pieceTitle||r.pieceName||""),p.useEffect(()=>{console.log("🔍 BagrutDetails useEffect: bagrutId:",s),s&&W()},[s]),p.useEffect(()=>{t&&re({teacherId:t.teacherId||"",conservatoryName:t.conservatoryName||"",testDate:t.testDate?new Date(t.testDate).toISOString().split("T")[0]:"",recitalUnits:t.recitalUnits||5,recitalField:t.recitalField||"",notes:t.notes||""})},[t]);const W=async()=>{if(s)try{console.log("🚀 BagrutDetails: Starting to load bagrut details for ID:",s),await h(s),console.log("✅ BagrutDetails: fetchBagrutById completed")}catch(r){console.error("❌ BagrutDetails: Error loading bagrut:",r)}};p.useEffect(()=>{console.log("🔍 BagrutDetails bagrut effect: bagrut exists:",!!t),t&&(console.log("📊 BagrutDetails: Bagrut data received:",t._id),We())},[t]);const We=async()=>{if(t)try{const[r,x]=await Promise.all([K.students.getStudentById(t.studentId),K.teachers.getTeacherById(t.teacherId)]);D(r),j(x)}catch(r){console.error("Error loading additional data:",r)}},Xe=async()=>{if(!s)return;await o(s)&&g("/bagruts"),u(!1)},Qe=async()=>{if(!s||!$.trim())return;await n(s,$)&&(await W(),H(!1),_(""))},Ye=async r=>{if(!(!s||!t))try{console.log("🔍 BagrutDetails: Updating accompaniment:",r);const x={studentId:t.studentId,teacherId:t.teacherId,program:t.program||[],conservatoryName:t.conservatoryName||"",accompaniment:r,presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(x.testDate=t.testDate),t.notes&&(x.notes=t.notes),t.recitalUnits&&(x.recitalUnits=t.recitalUnits),t.recitalField&&(x.recitalField=t.recitalField),t.directorName&&(x.directorName=t.directorName),t.directorEvaluation&&(x.directorEvaluation=t.directorEvaluation),console.log("🔍 BagrutDetails: Sending accompaniment update:",x),await b(s,x)&&(console.log("✅ BagrutDetails: Accompaniment updated successfully"),await W())}catch(x){console.error("❌ BagrutDetails: Error updating accompaniment:",x)}},Ze=async r=>{const x=r.target.files?.[0];if(!(!x||!s)){V(!0);try{const E=prompt("בחר קטגוריה: תעודה, תכנית, הקלטה, מכתב המלצה, אחר"),A=prompt("תיאור המסמך (אופציונלי)");E&&await I(s,x,E,A||void 0)&&await W()}catch(E){console.error("Error uploading document:",E)}finally{V(!1)}}},Je=async(r,x)=>{if(!s)return;const E=await B(s,r);if(E){const A=window.URL.createObjectURL(E),O=document.createElement("a");O.href=A,O.download=x,O.click(),window.URL.revokeObjectURL(A)}},es=async r=>{if(!s||!window.confirm("האם אתה בטוח שברצונך למחוק מסמך זה?"))return;await U(s,r)&&await W()},ss=r=>{console.log("Updated performance:",r),y(!1)},ts=r=>{console.log("View presentation:",r),Ve(r),Se(!0)},Le=async(r,x)=>{if(s)try{if(Ke(x)){const E=qs(x);await K.bagrut.updateMagenBagrut(s,E)&&await W()}else{const E=zs(x);if(!Vs(E)){console.error("Invalid presentation index for regular presentation:",E);return}console.log("🔍 Updating presentation:",{bagrutId:s,backendIndex:E,updatedPresentation:x}),await K.bagrut.updatePresentation(s,E,x)?(console.log("✅ Presentation updated successfully"),await W()):console.error("❌ Presentation update failed")}}catch(E){console.error("Error updating presentation:",E)}},as=async r=>{if(s)try{const x={date:null,completed:!1,grade:null,gradeLevel:null,recordingLinks:[],notes:"",reviewedBy:null,detailedGrading:null};await K.bagrut.updatePresentation(s,r,x)&&await W()}catch(x){console.error("Error deleting presentation:",x)}},rs=()=>{y(!1),a(null)},ls=async r=>{if(!(!s||!t))try{const x=[...t.program||[],r];let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(A){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",A),console.log("🔍 Original presentations:",t.presentations);const O=t.presentations?.map((M,ps)=>{console.log(`🔍 Processing presentation ${ps}:`,M);const Q={};return M.completed!==void 0&&(Q.completed=M.completed),M.status&&["עבר/ה","לא עבר/ה","לא נבחן"].includes(M.status)&&(Q.status=M.status),M.date&&(Q.date=M.date),M.review&&(Q.review=M.review),M.reviewedBy&&(Q.reviewedBy=M.reviewedBy),M.notes&&(Q.notes=M.notes),M.recordingLinks&&(Q.recordingLinks=M.recordingLinks),M.grade&&(Q.grade=M.grade),M.gradeLevel&&(Q.gradeLevel=M.gradeLevel),M.detailedGrading&&(Q.detailedGrading=M.detailedGrading),Q}).filter(M=>M&&Object.keys(M).length>0);console.log("🔍 Cleaned presentations:",O);const le={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"נגן מלווה",accompanists:[]},presentations:O||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(le.testDate=t.testDate),t.notes&&(le.notes=t.notes),t.recitalUnits&&(le.recitalUnits=t.recitalUnits),t.recitalField&&(le.recitalField=t.recitalField),t.magenBagrut&&(le.magenBagrut=t.magenBagrut),console.log("🔍 Sending update data:",le),E=await K.bagrut.updateBagrut(s,le)}E&&(await W(),l(!1))}catch(x){throw console.error("Error adding piece:",x),new Error("שגיאה בהוספת היצירה")}},ns=r=>{R(r),F(!0)},is=async r=>{if(!(!s||!t||!T))try{const x=(t.program||[]).map(A=>A.pieceNumber===T.pieceNumber?{...r,pieceNumber:T.pieceNumber}:A);let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(A){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",A);const O={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"נגן מלווה",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(O.testDate=t.testDate),t.notes&&(O.notes=t.notes),t.recitalUnits&&(O.recitalUnits=t.recitalUnits),t.recitalField&&(O.recitalField=t.recitalField),t.magenBagrut&&(O.magenBagrut=t.magenBagrut),E=await K.bagrut.updateBagrut(s,O)}E&&(await W(),F(!1),R(null))}catch(x){throw console.error("Error updating piece:",x),new Error("שגיאה בעדכון היצירה")}},cs=r=>{fe(r),he(!0)},ds=async()=>{if(!(!s||!t||ye===null))try{const x=(t.program||[]).filter(A=>A.pieceNumber!==ye).map((A,O)=>({...A,pieceNumber:O+1}));let E=!1;try{E=await K.bagrut.updateBagrutProgram(s,x)}catch(A){console.warn("Program-specific endpoint not available, falling back to full bagrut update:",A);const O={studentId:t.studentId,teacherId:t.teacherId,program:x,conservatoryName:t.conservatoryName||"",accompaniment:t.accompaniment||{type:"נגן מלווה",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.testDate&&(O.testDate=t.testDate),t.notes&&(O.notes=t.notes),t.recitalUnits&&(O.recitalUnits=t.recitalUnits),t.recitalField&&(O.recitalField=t.recitalField),t.magenBagrut&&(O.magenBagrut=t.magenBagrut),E=await K.bagrut.updateBagrut(s,O)}E&&(await W(),he(!1),fe(null))}catch(r){throw console.error("Error deleting piece:",r),new Error("שגיאה במחיקת היצירה")}},os=async()=>{if(!(!s||!t))try{const r={studentId:t.studentId,teacherId:q.teacherId,conservatoryName:q.conservatoryName,testDate:q.testDate?new Date(q.testDate):void 0,recitalUnits:q.recitalUnits,recitalField:q.recitalField,notes:q.notes,program:t.program||[],accompaniment:t.accompaniment||{type:"נגן מלווה",accompanists:[]},presentations:t.presentations||[],isCompleted:t.isCompleted,isActive:t.isActive};t.magenBagrut&&(r.magenBagrut=t.magenBagrut),await K.bagrut.updateBagrut(s,r)&&(await W(),be(!1))}catch(r){console.error("Error saving overview data:",r),alert("שגיאה בשמירת הנתונים")}},ms=()=>{t&&re({teacherId:t.teacherId||"",conservatoryName:t.conservatoryName||"",testDate:t.testDate?new Date(t.testDate).toISOString().split("T")[0]:"",recitalUnits:t.recitalUnits||5,recitalField:t.recitalField||"",notes:t.notes||""}),be(!1)},xs=async()=>{if(s)try{const r=await fetch(`/api/bagrut/${s}/export/pdf`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(r.ok){const x=await r.blob(),E=window.URL.createObjectURL(x),A=document.createElement("a");A.href=E,A.download=`bagrut-${C?.personalInfo?.fullName||s}.pdf`,A.click(),window.URL.revokeObjectURL(E)}}catch(r){console.error("Error exporting PDF:",r)}};if(console.log("🔍 BagrutDetails render: loading:",w,"bagrut:",!!t,"error:",N),w)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-gray-800",children:"טוען פרטי בגרות..."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["ID: ",s]})]})});if(N||!t)return console.log("❌ BagrutDetails: Showing error state - error:",N,"bagrut exists:",!!t),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"שגיאה בטעינת הבגרות"}),e.jsx("p",{className:"text-gray-800 mb-4",children:N||"בגרות לא נמצאה"}),e.jsxs("div",{className:"text-xs text-gray-400 mb-4",children:["Debug: ID=",s,", Loading=",w,", Error=",N,", Bagrut=",!!t]}),e.jsxs("button",{onClick:()=>g("/bagruts"),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Ue,{className:"w-4 h-4 ml-2"}),"חזור לרשימת בגרויות"]})]});const me=Ws(t),gs=Xs.TOTAL_PRESENTATIONS_WITH_MAGEN,De=t.program?.length||0,Ie=t.documents?.length||0,Ee=Ks(t),Pe=Math.round(me.total/gs*100),us=()=>t.isCompleted?"green":Pe>=50?"orange":"red";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/bagruts"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["בגרות - ",C?.personalInfo?.fullName||"טוען..."]}),t.isCompleted?e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"הושלם"}):e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium",children:"בתהליך"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-800",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"מורה: ",L?.personalInfo?.fullName||"טוען..."]}),t.conservatoryName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),t.conservatoryName]}),t.testDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),new Date(t.testDate).toLocaleDateString("he-IL")]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!t.isCompleted&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>H(!0),className:"flex items-center px-3 py-2 text-green-700 border border-green-300 rounded-lg hover:bg-green-50",children:[e.jsx(Be,{className:"w-4 h-4 ml-1"}),"השלם בגרות"]})}),e.jsxs("button",{onClick:xs,className:"flex items-center px-3 py-2 text-blue-700 border border-blue-300 rounded-lg hover:bg-blue-50",children:[e.jsx(Te,{className:"w-4 h-4 ml-1"}),"ייצא PDF"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center px-3 py-2 text-red-700 border border-red-300 rounded-lg hover:bg-red-50",children:[e.jsx(Y,{className:"w-4 h-4 ml-1"}),"מחק"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(xe,{title:"התקדמות כללית",value:`${Pe}%`,subtitle:"השלמת משימות",icon:e.jsx(ue,{}),color:us()}),e.jsx(xe,{title:"השמעות",value:`${me.regular}/3`,subtitle:"השמעות רגילות שהושלמו",icon:e.jsx(Ne,{}),color:me.regular===3?"green":"orange"}),e.jsx(xe,{title:"תכנית",value:De.toString(),subtitle:"יצירות בתכנית",icon:e.jsx(ee,{}),color:"blue"}),e.jsx(xe,{title:"מסמכים",value:Ie.toString(),subtitle:"מסמכים מצורפים",icon:e.jsx(pe,{}),color:"purple"}),e.jsx(xe,{title:"ציון סופי",value:t.finalGrade?.toString()||"-",subtitle:t.finalGradeLevel||"טרם חושב",icon:e.jsx($e,{}),color:t.finalGrade&&t.finalGrade>=90?"green":"gray"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex overflow-x-auto",children:[e.jsx(ne,{label:"סקירה כללית",icon:e.jsx(pe,{className:"w-4 h-4"}),isActive:S==="overview",onClick:()=>d("overview")}),e.jsx(ne,{label:"תכנית",icon:e.jsx(ee,{className:"w-4 h-4"}),isActive:S==="program",onClick:()=>d("program"),badge:De}),e.jsx(ne,{label:"השמעות",icon:e.jsx(Ne,{className:"w-4 h-4"}),isActive:S==="presentations",onClick:()=>d("presentations"),badge:me.regular}),e.jsx(ne,{label:"מגן בגרות",icon:e.jsx(ke,{className:"w-4 h-4"}),isActive:S==="magen",onClick:()=>d("magen")}),e.jsx(ne,{label:"ציונים",icon:e.jsx($e,{className:"w-4 h-4"}),isActive:S==="grading",onClick:()=>d("grading")}),e.jsx(ne,{label:"מסמכים",icon:e.jsx(Ae,{className:"w-4 h-4"}),isActive:S==="documents",onClick:()=>d("documents"),badge:Ie}),e.jsx(ne,{label:"מלווים",icon:e.jsx(de,{className:"w-4 h-4"}),isActive:S==="accompanists",onClick:()=>d("accompanists"),badge:t.accompaniment?.accompanists?.length||0})]})}),e.jsxs("div",{className:"p-6",children:[S==="overview"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:ae?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:os,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"שמור"]}),e.jsxs("button",{onClick:ms,className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"ביטול"]})]}):e.jsxs("button",{onClick:()=>be(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"ערוך פרטים כלליים"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי התלמיד"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"שם:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.personalInfo?.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"טלפון:"}),e.jsx("span",{className:"font-medium text-gray-900",dir:"ltr",children:C?.personalInfo?.phone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"כיתה:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.academicInfo?.class})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"כלי ראשי:"}),e.jsx("span",{className:"font-medium text-gray-900",children:C?.academicInfo?.instrumentProgress?.find(r=>r.isPrimary)?.instrumentName})]})]})]}),e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פרטי בגרות"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"מורה מנחה:"}),ae?e.jsx("span",{className:"text-gray-500",children:"לא ניתן לשנות"}):e.jsx("span",{className:"font-medium text-gray-900",children:L?.personalInfo?.fullName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"קונסרבטוריון:"}),ae?e.jsx("input",{type:"text",value:q.conservatoryName,onChange:r=>re(x=>({...x,conservatoryName:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-right"}):e.jsx("span",{className:"font-medium text-gray-900",children:t.conservatoryName||"לא צוין"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"תאריך מבחן:"}),ae?e.jsx("input",{type:"date",value:q.testDate,onChange:r=>re(x=>({...x,testDate:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded"}):e.jsx("span",{className:"font-medium text-gray-900",children:t.testDate?new Date(t.testDate).toLocaleDateString("he-IL"):"לא נקבע"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"יחידות רסיטל:"}),ae?e.jsxs("select",{value:q.recitalUnits,onChange:r=>re(x=>({...x,recitalUnits:parseInt(r.target.value)})),className:"px-2 py-1 border border-gray-300 rounded",children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"5",children:"5"})]}):e.jsx("span",{className:"font-medium text-gray-900",children:t.recitalUnits||"לא צוין"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"force-black-text",children:"תחום רסיטל:"}),ae?e.jsxs("select",{value:q.recitalField,onChange:r=>re(x=>({...x,recitalField:r.target.value})),className:"px-2 py-1 border border-gray-300 rounded",children:[e.jsx("option",{value:"",children:"בחר תחום"}),e.jsx("option",{value:"קלאסי",children:"קלאסי"}),e.jsx("option",{value:"ג'אז",children:"ג'אז"}),e.jsx("option",{value:"מוסיקה ערבית",children:"מוסיקה ערבית"}),e.jsx("option",{value:"אחר",children:"אחר"})]}):e.jsx("span",{className:"font-medium text-gray-900",children:t.recitalField||"לא צוין"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"force-black-text",children:"סטטוס:"}),e.jsx("span",{className:`font-medium ${t.isCompleted?"text-green-600":"text-orange-600"}`,children:t.isCompleted?"הושלם":"בתהליך"})]})]})]}),e.jsxs(G,{className:"lg:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"הערות"}),ae?e.jsx("textarea",{value:q.notes,onChange:r=>re(x=>({...x,notes:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none",rows:4,placeholder:"הוסף הערות..."}):e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:t.notes||"אין הערות"})]})]})]}),S==="program"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"תכנית הביצוע"}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Z,{className:"w-4 h-4 ml-1"}),"הוסף יצירה"]})]}),t.program&&t.program.length>0?e.jsx(fs,{data:t.program,columns:[{key:"pieceNumber",header:"מס׳",width:"60px",align:"center"},{key:"composer",header:"מלחין",render:r=>r.composer||"לא צוין"},{key:"pieceTitle",header:"שם היצירה",render:r=>r.pieceTitle||"לא צוין"},{key:"movement",header:"פרק",render:r=>r.movement||"-"},{key:"duration",header:"משך",render:r=>r.duration||"לא צוין"},{key:"youtubeLink",header:"קישור יוטיוב",render:r=>r.youtubeLink?e.jsx("a",{href:r.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:"צפה ביוטיוב"}):e.jsx("span",{className:"text-gray-500",children:"אין קישור"})},{key:"actions",header:"פעולות",width:"120px",render:r=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ns(r),className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",title:"ערוך יצירה",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>cs(r.pieceNumber),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded",title:"מחק יצירה",children:e.jsx(Y,{className:"w-4 h-4"})})]})}]}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"אין יצירות בתכנית"})]})]}),S==="presentations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"השמעות"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[me.regular," מתוך 3 השמעות הושלמו"]})]}),Ee.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Ee.map(r=>e.jsx(Us,{presentation:r,onUpdate:Le,onDelete:as,onView:ts,programPieces:t.program||[]},`presentation-${r.presentationNumber}`))}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(Ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"אין השמעות"}),e.jsxs("button",{onClick:()=>g(`/bagruts/${s}/edit?tab=presentations`),className:"mt-4 flex items-center mx-auto px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Z,{className:"w-4 h-4 ml-1"}),"הוסף השמעות"]})]})]}),S==="magen"&&e.jsx(_s,{bagrut:t,onUpdate:async r=>{try{console.log("🔄 BagrutDetails: Received magen data for update:",r),console.log("🔍 BagrutDetails: Current bagrutId:",s),console.log("🔍 BagrutDetails: Current bagrut data:",t);const x=r,E={studentId:t.studentId,teacherId:t.teacherId,program:t.program||[],magenBagrut:x};console.log("📡 BagrutDetails: Calling apiService.bagrut.updateBagrut with payload:",E);const A=await K.bagrut.updateBagrut(s,E);console.log("✅ BagrutDetails: API update result:",A),console.log("🔄 BagrutDetails: Refreshing bagrut data..."),await h(s),console.log("✅ BagrutDetails: Bagrut data refreshed successfully")}catch(x){console.error("❌ BagrutDetails: Error updating magen bagrut:",x),console.error("❌ BagrutDetails: Error details:",x.message,x.response?.data),alert("שגיאה בשמירה: "+(x.response?.data?.message||x.message))}}}),S==="grading"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ציון סופי"}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-primary-50 rounded-lg",children:[e.jsx("span",{className:"text-lg font-semibold force-black-text",children:"ציון מגן בגרות"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-3xl font-bold text-primary-600",children:t.magenBagrut?.grade||t.finalGrade||"-"}),(t.magenBagrut?.gradeLevel||t.finalGradeLevel)&&e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:t.magenBagrut?.gradeLevel||t.finalGradeLevel})]})]})]}),t.magenBagrut?.pieceGradings&&t.magenBagrut.pieceGradings.length>0?e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פירוט ציונים לפי יצירות"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 border border-gray-200",children:"יצירה"}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["מיומנות נגינה/שירה",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 40)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["הבנה מוסיקלית",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 30)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:["ידיעת הטקסט",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(מקס' 20)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['נגינה בע"פ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(10)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700 border border-gray-200",children:['סה"כ',e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"(100)"})]})]})}),e.jsx("tbody",{children:t.magenBagrut.pieceGradings.map((r,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 border border-gray-200",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[r.pieceTitle," #",r.pieceNumber]}),e.jsx("div",{className:"text-gray-600",children:r.composer})]})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.playingSkills})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.musicalUnderstanding})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsx("div",{className:"font-semibold text-gray-900",children:r.textKnowledge})}),e.jsx("td",{className:"px-4 py-3 text-center border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm",children:r.playingByHeart?"✓":"✗"}),e.jsx("span",{className:"text-xs text-gray-600",children:r.playingByHeart?"10":"0"})]})}),e.jsx("td",{className:"px-4 py-3 text-center font-bold text-primary-600 border border-gray-200",children:(r.playingSkills||0)+(r.musicalUnderstanding||0)+(r.textKnowledge||0)+(r.playingByHeart?10:0)})]},x))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ממוצע מיומנות נגינה:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.playingSkills||0),0)/t.magenBagrut.pieceGradings.length),"/40"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ממוצע הבנה מוסיקלית:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.musicalUnderstanding||0),0)/t.magenBagrut.pieceGradings.length),"/30"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ממוצע ידיעת טקסט:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.textKnowledge||0),0)/t.magenBagrut.pieceGradings.length),"/20"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"יצירות בעל פה:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[t.magenBagrut.pieceGradings.filter(r=>r.playingByHeart).length,"/",t.magenBagrut.pieceGradings.length]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"ציון כולל:"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:[Math.round(t.magenBagrut.pieceGradings.reduce((r,x)=>r+(x.playingSkills||0)+(x.musicalUnderstanding||0)+(x.textKnowledge||0)+(x.playingByHeart?10:0),0)/t.magenBagrut.pieceGradings.length),"/100"]})]})})]})]}):t.magenBagrut?.detailedGrading?e.jsxs(G,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"פירוט ציונים (סיכום)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"מיומנות נגינה"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.playingSkills?.points||0,"/40"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"הבנה מוזיקלית"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.musicalUnderstanding?.points||0,"/30"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"ידיעת הטקסט"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.textKnowledge?.points||0,"/20"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"force-black-text",children:"נגינה בעל פה"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:[t.magenBagrut.detailedGrading.playingByHeart?.points||0,"/10"]})]})]}),e.jsx("div",{className:"mt-6 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:["ציון מפורט: ",(t.magenBagrut.detailedGrading.playingSkills?.points||0)+(t.magenBagrut.detailedGrading.musicalUnderstanding?.points||0)+(t.magenBagrut.detailedGrading.textKnowledge?.points||0)+(t.magenBagrut.detailedGrading.playingByHeart?.points||0),"/100"]})})]}):e.jsx(G,{children:e.jsxs("div",{className:"text-center text-gray-500 py-12",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"טרם הוזנו ציונים"}),e.jsx("p",{className:"text-gray-600",children:"הציונים יוצגו כאן לאחר השלמת מגן בגרות"})]})})]}),S==="documents"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"מסמכים"}),e.jsxs("label",{className:"flex items-center px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 cursor-pointer",children:[e.jsx(Ls,{className:"w-4 h-4 ml-1"}),"העלה מסמך",e.jsx("input",{type:"file",onChange:Ze,className:"hidden",disabled:X})]})]}),X&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ge,{className:"w-6 h-6 animate-spin mx-auto text-primary-600"}),e.jsx("p",{className:"text-sm text-gray-800 mt-2",children:"מעלה מסמך..."})]}),t.documents&&t.documents.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.documents.map(r=>e.jsx(G,{className:"hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ae,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:r.fileName}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs mb-2",children:r.category}),r.description&&e.jsx("p",{className:"text-xs text-gray-800",children:r.description}),e.jsx("div",{className:"text-xs text-gray-700 mt-2",children:new Date(r.uploadDate).toLocaleDateString("he-IL")})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Je(r._id,r.fileName),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"הורד",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>es(r._id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"מחק",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})},r._id))}):e.jsxs("div",{className:"text-center py-8 text-gray-700",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{children:"אין מסמכים מצורפים"})]})]}),S==="accompanists"&&e.jsx(Rs,{accompaniment:t.accompaniment||{type:"נגן מלווה",accompanists:[]},onUpdate:Ye,readonly:t.isCompleted})]})]}),e.jsx(je,{isOpen:v,title:"מחיקת בגרות",message:`האם אתה בטוח שברצונך למחוק את הבגרות של ${C?.personalInfo?.fullName}? פעולה זו לא ניתנת לביטול.`,confirmText:"מחק",cancelText:"ביטול",onConfirm:Xe,onCancel:()=>u(!1),variant:"danger"}),e.jsx(je,{isOpen:P,title:"השלמת בגרות",message:"האם אתה בטוח שברצונך להשלים את הבגרות? לאחר ההשלמה לא ניתן יהיה לערוך את הנתונים.",confirmText:"השלם בגרות",cancelText:"ביטול",onConfirm:Qe,onCancel:()=>H(!1),variant:"primary",children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"חתימת המורה"}),e.jsx("input",{type:"text",value:$,onChange:r=>_(r.target.value),placeholder:"הכנס את שמך המלא כחתימה",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsx(Is,{isOpen:c,performance:f,programPieces:t?.program||[],onClose:rs,onUpdate:ss}),e.jsx(_e,{isOpen:i,onClose:()=>l(!1),onSubmit:ls,existingPieces:t?.program||[]}),e.jsx(_e,{isOpen:m,onClose:()=>{F(!1),R(null)},onSubmit:is,existingPieces:(t?.program||[]).filter(r=>r.pieceNumber!==T?.pieceNumber),initialData:T,title:"ערוך יצירה",submitText:"עדכן יצירה"}),e.jsx(je,{isOpen:ce,title:"מחיקת יצירה",message:`האם אתה בטוח שברצונך למחוק את היצירה מס' ${ye}? פעולה זו לא ניתנת לביטול.`,confirmText:"מחק יצירה",cancelText:"ביטול",onConfirm:ds,onCancel:()=>{he(!1),fe(null)},variant:"danger"}),e.jsx(As,{isOpen:qe,presentation:ze,programPieces:t?.program||[],onClose:()=>Se(!1),onUpdate:Le,onNavigateToTab:r=>d("presentations")})]})}export{it as default};
