import{u as $e,j as e,a as ze}from"../assets/index-DH8MwuUF.js";import{r as w,b as Pe}from"./vendor-C9PcmKF2.js";import{S as ye}from"./StatsCard-nOBJ5jx9.js";import{C as G}from"./Card-DzHgWdxq.js";import{a as F}from"./cascade-deletion-BN1czp3B.js";import{v as ve,M as ie,g as ue,w as tt,x as Ge,G as ne,y as Le,c as K,s as he,z as st,p as Re,D as de,V as at,f as Fe,E as rt,I as nt,J as Ae,K as _e,a as Xe,X as lt,e as Ne,P as Ze,B as oe,N as ct,O as ot,r as it,o as ge,Q as dt,q as We,W as mt,Y as ke,Z as Je,_ as xt,$ as ht,d as gt,a0 as ut,U as ft,a1 as pt}from"./ui-DsxFGtGk.js";import{T as yt}from"./teacherDetailsApi-C45WQoYF.js";import"./query-BdHdBeoH.js";import"./utils-x1PSU_OZ.js";function jt(){const{user:a}=$e(),[n,m]=w.useState({totalOrchestras:0,activeMusicians:0,upcomingRehearsals:0,completedConcerts:0,totalMembers:0,weeklyRehearsals:0,bagrutMembers:0,activeBagrutStudents:0}),[x,l]=w.useState([]),[g,o]=w.useState([]),[u,y]=w.useState([]),[C,r]=w.useState([]),[j,b]=w.useState(!0),[S,p]=w.useState(null);w.useEffect(()=>{a?._id&&f()},[a]);const f=async()=>{try{b(!0),p(null);const t=a._id,[i]=await Promise.all([F.teachers.getTeacher(t)]);if(!i)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ×× ×¦×—");const s=i?.conducting?.orchestraIds||[];let v=[],L=0,M=[];if(s.length>0){v=await F.orchestras.getBatchOrchestras(s),L=v.reduce(($,N)=>$+(N.memberCount||0),0);try{const $=await F.rehearsals.getRehearsals({groupIds:s.join(","),limit:100});M=Array.isArray($)?$:[]}catch($){console.warn("Error loading rehearsals:",$),M=[]}}const O=new Date,A=new Date(O.getTime()+7*24*60*60*1e3),W=M.filter($=>{const N=new Date($.scheduledDate);return N>=O&&N<=A}).slice(0,5).map($=>{const N=v.find(E=>E._id===$.groupId);return{id:$._id,orchestraName:N?.name||"×ª×–××•×¨×ª",date:new Date($.scheduledDate).toLocaleDateString("he-IL"),time:$.startTime||"19:00",location:$.location||"××•×œ× ××•×–×™×§×”",attendanceRate:Math.floor(Math.random()*20)+80,duration:120,status:"scheduled"}});l(W);const J=M.filter($=>{const N=new Date($.scheduledDate),E=new Date(O);E.setDate(O.getDate()-O.getDay());const h=new Date(E);return h.setDate(E.getDate()+6),N>=E&&N<=h}).length;let Z=[],se=0,Y=0;if(v.length>0){const $=v.flatMap(N=>N?.members?.map(E=>E.studentId)||[]);if($.length>0)try{const[N,E]=await Promise.all([Promise.all($.map(h=>F.bagrut.getBagrutByStudent(h).catch(()=>null))).then(h=>h.filter(Boolean)),F.students.getBatchStudents($)]);Z=$.map(h=>{const P=E.find(X=>X._id===h),q=N.find(X=>X.studentId===h),H=v.flatMap(X=>X.members||[]).find(X=>X.studentId===h),te=v.find(X=>X.members?.some(ae=>ae.studentId===h));let U="none",Q,le,ce;if(q){const X=q.presentations?.filter(ae=>ae.completed).length||0;if(Q=X+1,le=X/4*100,q.isCompleted&&q.finalGrade&&q.finalGrade>=55?U="completed":q.isCompleted&&q.finalGrade&&q.finalGrade<55?U="none":X===0?U="pending":U="active",U==="active"){const ae=new Date,fe=Math.floor(Math.random()*30)+7;ce=new Date(ae),ce.setDate(ae.getDate()+fe)}}return{studentId:h,studentName:P?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:H?.instrument||P?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",section:H?.section||"×œ× ×¦×•×™×Ÿ",bagrutStatus:U,stage:Q,progress:le,nextExamDate:ce,orchestraName:te?.name||"×ª×–××•×¨×ª"}}),se=Z.filter(h=>h.bagrutStatus!=="none").length,Y=Z.filter(h=>h.bagrutStatus==="active").length}catch(N){console.warn("Error loading Bagrut data:",N)}}r(Z);const ee={totalOrchestras:v.length,activeMusicians:L,upcomingRehearsals:W.length,completedConcerts:Math.floor(Math.random()*5)+2,totalMembers:L,weeklyRehearsals:J,bagrutMembers:se,activeBagrutStudents:Y};m(ee);const T=v.map($=>{const N=M.filter(h=>h.groupId===$._id),E=Math.floor(Math.random()*20)+80;return{orchestraId:$._id,orchestraName:$.name,totalRehearsals:N.length,averageAttendance:E,upcomingConcerts:Math.floor(Math.random()*3)+1,lastRehearsal:N.length>0?new Date(N[N.length-1].scheduledDate).toLocaleDateString("he-IL"):"××™×Ÿ × ×ª×•× ×™×",status:E>=90?"excellent":E>=75?"good":"needs_attention"}});y(T);const k=[];M.slice(0,3).forEach($=>{const N=v.find(E=>E._id===$.groupId);k.push({id:`rehearsal-${$._id}`,type:"rehearsal",title:"×—×–×¨×” ×”×•×©×œ××”",description:`×—×–×¨×” ×©×œ ${N?.name||"×ª×–××•×¨×ª"} - ${$.location||"××•×œ× ××•×–×™×§×”"}`,timestamp:new Date(Date.now()-Math.random()*864e5).toISOString(),orchestraName:N?.name})}),v.slice(0,2).forEach($=>{k.push({id:`enrollment-${$._id}`,type:"enrollment",title:"×¨×™×©×•× ×—×“×©",description:`×ª×œ××™×“ ×—×“×© ×”×¦×˜×¨×£ ×œ${$.name}`,timestamp:new Date(Date.now()-Math.random()*1728e5).toISOString(),orchestraName:$.name})}),o(k.sort(($,N)=>new Date(N.timestamp).getTime()-new Date($.timestamp).getTime()))}catch(t){console.error("Error loading conductor dashboard data:",t),p("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{b(!1)}},D=Pe(),d=t=>{switch(t){case"scheduleRehearsal":D("/profile",{state:{activeTab:"orchestras"}});break;case"markAttendance":D("/profile",{state:{activeTab:"orchestras"}});break;case"manageOrchestras":D("/profile",{state:{activeTab:"orchestras"}});break;case"viewMusicians":D("/profile",{state:{activeTab:"orchestras"}});break;default:console.log("Action:",t)}},c=t=>{const i=new Date(t),v=new Date().getTime()-i.getTime(),L=Math.floor(v/(1e3*60*60));return L<1?`×œ×¤× ×™ ${Math.floor(v/6e4)} ×“×§×•×ª`:L<24?`×œ×¤× ×™ ${L} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(L/24)} ×™××™×`};return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×× ×¦×—..."})]})}):S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:S}),e.jsx("button",{onClick:f,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×©×œ×•× ×× ×¦×— ",a?.firstName||"×™×§×¨"," ğŸ¼"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8",children:[e.jsx(je,{icon:e.jsx(ie,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×–××•×¨×•×ª",value:n.totalOrchestras,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(je,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"××•×–×™×§××™× ×¤×¢×™×œ×™×",value:n.activeMusicians,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(je,{icon:e.jsx(tt,{className:"w-6 h-6"}),title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:n.weeklyRehearsals,bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(je,{icon:e.jsx(Ge,{className:"w-6 h-6"}),title:"×§×•× ×¦×¨×˜×™× ×”×©× ×”",value:n.completedConcerts,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(je,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×—×‘×¨×™ ×‘×’×¨×•×ª",value:n.bagrutMembers,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(je,{icon:e.jsx(Le,{className:"w-6 h-6"}),title:"×‘×’×¨×•×ª ×¤×¢×™×œ×”",value:n.activeBagrutStudents,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{icon:e.jsx(K,{className:"w-5 h-5"}),label:"×§×‘×¢ ×—×–×¨×”",onClick:()=>d("scheduleRehearsal"),color:"indigo"}),e.jsx(we,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>d("markAttendance"),color:"green"}),e.jsx(we,{icon:e.jsx(st,{className:"w-5 h-5"}),label:"× ×”×œ ×ª×–××•×¨×•×ª",onClick:()=>d("manageOrchestras"),color:"blue"}),e.jsx(we,{icon:e.jsx(Re,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘××•×–×™×§××™×",onClick:()=>d("viewMusicians"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×—×–×¨×•×ª ×”×§×¨×•×‘×•×ª"}),e.jsxs("button",{onClick:()=>D("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×—×–×¨×•×ª ××ª×•×›× × ×•×ª ×”×©×‘×•×¢"})]}):e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(at,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-3 h-3"}),t.location]}),t.attendanceRate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["× ×•×›×—×•×ª ×××•×¦×¢×ª: ",t.attendanceRate,"%"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.date}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(rt,{className:"w-3 h-3 inline mr-1"}),t.duration," ×“×§×•×ª"]})]})]},t.id))})]}),C.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×—×‘×¨×™ ×ª×–××•×¨×ª ×¢× ×‘×’×¨×•×ª"}),e.jsx(ne,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:C.filter(t=>t.bagrutStatus==="active").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×‘×’×¨×•×ª ×¤×¢×™×œ×”"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:C.filter(t=>t.bagrutStatus==="completed").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×”×•×©×œ××”"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:C.filter(t=>t.bagrutStatus==="pending").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×××ª×™× ×™×"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-600",children:C.filter(t=>t.bagrutStatus==="none").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"×œ×œ× ×‘×’×¨×•×ª"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×"}),C.filter(t=>t.bagrutStatus==="active").slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.instrument," â€¢ ",t.section," â€¢ ",t.orchestraName]})]})]}),e.jsxs("div",{className:"text-right",children:[t.stage&&e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:["×”×©××¢×” ",t.stage,"/4"]}),t.progress!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(t.progress),"%"]})]}),t.nextExamDate&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["××‘×—×Ÿ ×”×‘×: ",t.nextExamDate.toLocaleDateString("he-IL")]}),e.jsx("button",{className:"mt-2 p-1 text-gray-400 hover:text-blue-600",children:e.jsx(nt,{className:"w-4 h-4"})})]})]},t.studentId)),C.filter(t=>t.bagrutStatus==="active").length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/teacher/bagrut",className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",C.filter(t=>t.bagrutStatus==="active").length,")"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×‘×™×¦×•×¢×™ ×ª×–××•×¨×•×ª"}),e.jsxs("button",{onClick:()=>D("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×“×•×— ××¤×•×¨×˜",e.jsx(de,{className:"w-4 h-4"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×‘×™×¦×•×¢×™×"})]}):e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="excellent"?"bg-green-500":t.status==="good"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.totalRehearsals," ×—×–×¨×•×ª ×”×©× ×” â€¢ ×—×–×¨×” ××—×¨×•× ×”: ",t.lastRehearsal]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:`font-medium ${t.averageAttendance>=90?"text-green-600":t.averageAttendance>=75?"text-yellow-600":"text-red-600"}`,children:[t.averageAttendance,"%"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª ×××•×¦×¢×ª"})]})]},t.orchestraId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(_e,{className:"w-5 h-5 text-gray-400"})]}),g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:g.map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${t.type==="rehearsal"?"bg-blue-100":t.type==="enrollment"?"bg-green-100":t.type==="performance"?"bg-purple-100":"bg-yellow-100"}`,children:[t.type==="rehearsal"&&e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),t.type==="enrollment"&&e.jsx(Re,{className:"w-4 h-4 text-green-600"}),t.type==="performance"&&e.jsx(Ge,{className:"w-4 h-4 text-purple-600"}),t.type==="attendance"&&e.jsx(he,{className:"w-4 h-4 text-yellow-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:t.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:c(t.timestamp)})]})]},t.id))})]})]})]})})}function je({icon:a,title:n,value:m,suffix:x,bgColor:l,iconColor:g,borderColor:o}){return e.jsx("div",{className:`${l} border ${o} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[m," ",x&&e.jsx("span",{className:"text-lg font-normal",children:x})]})]}),e.jsx("div",{className:`${g}`,children:a})]})})}function we({icon:a,label:n,onClick:m,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:m,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[a,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan",children:n})]})}function bt(){const{user:a}=$e(),n=Pe(),[m,x]=w.useState({totalStudents:0,todaysLessons:0,weeklyHours:0,activeBagrutStudents:0}),[l,g]=w.useState([]),[o,u]=w.useState([]),[y,C]=w.useState([]),[r,j]=w.useState([]),[b,S]=w.useState(!0),[p,f]=w.useState(null);w.useState(!1),w.useState(!1),w.useState(!1);const[D,d]=w.useState([]),[c,t]=w.useState([]),[i,s]=w.useState(null),[v,L]=w.useState([]),[M,O]=w.useState([]),[A,W]=w.useState([]),[J,Z]=w.useState({days:[]});w.useEffect(()=>{a?._id&&se()},[a]),w.useEffect(()=>{a?._id&&A.length>=0&&T()},[a,A]),w.useEffect(()=>{if(i){const h=setTimeout(()=>s(null),4e3);return()=>clearTimeout(h)}},[i]);const se=()=>{const h=a?.roles||[],P=a?.role,q=a?.allRoles||[];let H=[...h];P&&!H.includes(P)&&H.push(P),H=[...new Set([...H,...q])];const te=H.map(U=>{const Q=U?.toLowerCase();return Q==="conductor"||Q==="×× ×¦×—"?"conductor":Q==="theory-teacher"||Q==="××•×¨×” ×ª×™××•×¨×™×”"||Q==="theory teacher"?"theory-teacher":Q==="teacher"||Q==="××•×¨×”"?"teacher":U});W([...new Set(te)])},Y=async h=>{try{const P=await yt.getTransformedWeeklySchedule(h);if(P)return Z(P),P}catch(P){console.log("Error loading weekly schedule:",P)}return ee()},ee=()=>({days:["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"].map(P=>({dayName:P,lessons:[]}))}),T=async()=>{try{S(!0),f(null);const h=a._id,[P,q]=await Promise.all([F.teachers.getMyProfile(),Y(h)]);if(!P)throw new Error("×œ× × ××¦× ×¤×¨×•×¤×™×œ ××•×¨×”");console.log("Teacher profile loaded:",{name:P?.personalInfo?.fullName,studentIds:P?.teaching?.studentIds,studentCount:P?.teaching?.studentIds?.length||0,timeBlocks:P?.teaching?.timeBlocks?.length||0});const H=P?.teaching?.studentIds||[],te=P?.teaching?.timeBlocks||[];d(te);let U=[];if(H.length>0){console.log("ğŸ¯ Teacher assigned student IDs:",H);const I=await F.students.getBatchStudents(H);if(console.log(`ğŸ“Š API returned ${I.length} students for ${H.length} requested IDs`),U=I.filter(V=>{const _=V._id||V.id,R=H.includes(_);return!R&&I.length>H.length&&console.log(`âš ï¸ Filtering out unassigned student: ${_}`),R}),console.log(`âœ… Showing ${U.length} assigned students (filtered from ${I.length})`),U.length<H.length){const V=U.map(R=>R._id||R.id),_=H.filter(R=>!V.includes(R));console.warn("âš ï¸ Missing students:",_)}}else console.log("No student IDs found in teacher profile");t(U);const Q=new Date,le=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"][Q.getDay()],ce=q.days.find(I=>I.dayName===le)?.lessons.filter(I=>I.lessonType!=="availability").length||0,X=q.days.reduce((I,V)=>I+V.lessons.filter(_=>_.lessonType!=="availability").reduce((_,R)=>{const Be=new Date(`2000-01-01T${R.startTime}`),me=new Date(`2000-01-01T${R.endTime}`);return _+(me.getTime()-Be.getTime())/(1e3*60*60)},0),0);let ae=[];if(A.includes("conductor"))try{const V=(await F.orchestras.getOrchestras()).filter(_=>_.conductorId===h);L(V),console.log(`ğŸ¼ Loaded ${V.length} orchestras for conductor`)}catch(I){console.log("Error loading orchestras:",I)}if(A.includes("theory-teacher"))try{const I=await F.theory.getTheoryLessons({teacherId:h});O(I||[]),console.log(`ğŸ“š Loaded ${I?.length||0} theory lessons`)}catch(I){console.log("Error loading theory lessons:",I)}const fe=ae.map(I=>{const V=c.find(pe=>pe._id===I.studentId),_=I.presentations?.filter(pe=>pe.completed).length||0,R=4,Be=_/R*100;let me="active";I.isCompleted&&I.finalGrade&&I.finalGrade>=55?me="completed":I.isCompleted&&I.finalGrade&&I.finalGrade<55?me="failed":_===0&&(me="pending");let Ie;if(me==="active"&&_<4){const pe=new Date,et=Math.floor(Math.random()*30)+7;Ie=new Date(pe),Ie.setDate(pe.getDate()+et)}return{studentId:I.studentId,studentName:V?.personalInfo?.fullName||"×ª×œ××™×“ ×œ× ×™×“×•×¢",instrument:V?.academicInfo?.primaryInstrument||"×œ× ×¦×•×™×Ÿ",stage:_+1,progress:Be,nextExamDate:Ie,status:me,finalGrade:I.finalGrade,completedPresentations:_,totalPresentations:R,bagrutId:I._id}});j(fe);const B=fe.filter(I=>I.status==="active").length;x({totalStudents:U.length,todaysLessons:ce,weeklyHours:Math.round(X*10)/10,activeBagrutStudents:B});let z=[];const Oe=q.days.find(I=>I.dayName===le);if(Oe){const I=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`;z=Oe.lessons.filter(_=>_.lessonType!=="availability"&&_.startTime>=I).slice(0,5).map(_=>({id:_.id,studentName:_.studentName||"×ª×œ××™×“",time:_.startTime,instrument:_.instrument||"",duration:parseInt(_.notes?.match(/\d+/)?.[0]||"60"),type:_.lessonType}))}if(z.length===0&&P?.teaching?.schedule){const I=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`;z=P.teaching.schedule.filter(R=>R.day===le).filter(R=>R.startTime>=I).slice(0,5).map(R=>({id:R._id||`lesson-${R.studentId}`,studentName:R.studentName||"×ª×œ××™×“",time:R.startTime,instrument:R.instrument||"",duration:R.duration||60,type:"individual"}))}if(z.length===0&&U.length>0){const I=`${Q.getHours().toString().padStart(2,"0")}:${Q.getMinutes().toString().padStart(2,"0")}`;U.forEach(V=>{(V.teacherAssignments?.filter(R=>R.teacherId===a._id&&R.day===le)||[]).forEach(R=>{R.time&&R.time>=I&&z.push({id:`${V._id}-${R.time}`,studentName:V.personalInfo?.fullName||"×ª×œ××™×“",time:R.time,instrument:V.academicInfo?.primaryInstrument||R.instrument||"×›×œ×™ ××•×–×™×§×”",duration:R.duration||60,type:"individual"})})}),z.sort((V,_)=>V.time.localeCompare(_.time))}g(z.slice(0,5)),u([]),C([])}catch(h){console.error("Error loading dashboard data:",h),f("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”")}finally{S(!1)}},k=h=>{switch(console.log("handleQuickAction called with:",h),console.log("Teacher time blocks:",D),h){case"addLesson":n("/profile?tab=students&action=addStudent");break;case"markAttendance":n("/profile?tab=attendance");break;case"viewSchedule":n("/profile?tab=schedule");break;case"manageStudents":n("/profile?tab=students");break;case"manageTeachingDays":n("/profile?tab=schedule");break;case"viewOrchestras":n("/profile?tab=orchestras");break;case"viewTheoryLessons":n("/profile?tab=lessons");break;case"addOrchestra":n("/orchestras/new");break;case"addTheoryLesson":n("/theory/new");break;case"manageBagrut":window.location.href="/teacher/bagrut";break;case"scheduleBagrutExam":window.location.href="/teacher/bagrut/schedule";break;case"viewBagrutProgress":window.location.href="/teacher/bagrut/progress";break;case"updateBagrutStatus":window.location.href="/teacher/bagrut/update";break;default:console.log("Action:",h)}},$=h=>{switch(h){case"completed":return"text-green-600 bg-green-50";case"active":return"text-blue-600 bg-blue-50";case"pending":return"text-yellow-600 bg-yellow-50";case"failed":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},N=h=>{switch(h){case"completed":return"×”×•×©×œ×";case"active":return"×¤×¢×™×œ";case"pending":return"×××ª×™×Ÿ";case"failed":return"× ×›×©×œ";default:return"×œ× ×™×“×•×¢"}},E=h=>{const P=new Date(h),H=new Date().getTime()-P.getTime(),te=Math.floor(H/(1e3*60*60));return te<1?`×œ×¤× ×™ ${Math.floor(H/6e4)} ×“×§×•×ª`:te<24?`×œ×¤× ×™ ${te} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(te/24)} ×™××™×`};return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×”..."})]})}):p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:p}),e.jsx("button",{onClick:T,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${i.type==="success"?"bg-green-100 border border-green-200 text-green-800":"bg-red-100 border border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.type==="success"?e.jsx(he,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:i.message}),e.jsx("button",{onClick:()=>s(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(lt,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["×œ×•×— ×‘×§×¨×” - ",a?.personalInfo?.fullName||a?.fullName||"××•×¨×”"]})}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",a?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(De,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"×¡×”×´×› ×ª×œ××™×“×™×",value:m.totalStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(De,{icon:e.jsx(K,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:m.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(De,{icon:e.jsx(Ne,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:m.weeklyHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(De,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×‘×’×¨×•×ª ×¤×¢×™×œ×™×",value:m.activeBagrutStudents,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"×”×•×¡×£ ×©×™×¢×•×¨",onClick:()=>k("addLesson"),color:"indigo"}),e.jsx(re,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª",onClick:()=>k("markAttendance"),color:"green"}),e.jsx(re,{icon:e.jsx(K,{className:"w-5 h-5"}),label:"×¦×¤×” ×‘×œ×•×´×–",onClick:()=>k("viewSchedule"),color:"blue"}),e.jsx(re,{icon:e.jsx(Re,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×ª×œ××™×“×™×",onClick:()=>k("manageStudents"),color:"purple"}),A.includes("teacher")&&e.jsx(re,{icon:e.jsx(Ne,{className:"w-5 h-5"}),label:"×™××™ ×œ×™××•×“",onClick:()=>k("manageTeachingDays"),color:"orange"}),A.includes("conductor")&&e.jsx(re,{icon:e.jsx(ie,{className:"w-5 h-5"}),label:"×”×ª×–××•×¨×•×ª ×©×œ×™",onClick:()=>k("viewOrchestras"),color:"rose"}),A.includes("theory-teacher")&&e.jsx(re,{icon:e.jsx(oe,{className:"w-5 h-5"}),label:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",onClick:()=>k("viewTheoryLessons"),color:"amber"}),r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(re,{icon:e.jsx(ne,{className:"w-5 h-5"}),label:"× ×™×”×•×œ ×‘×’×¨×•×ª",onClick:()=>k("manageBagrut"),color:"emerald"}),e.jsx(re,{icon:e.jsx(ct,{className:"w-5 h-5"}),label:"×ª×–××•×Ÿ ××‘×—×Ÿ",onClick:()=>k("scheduleBagrutExam"),color:"orange"}),e.jsx(re,{icon:e.jsx(Le,{className:"w-5 h-5"}),label:"××¢×§×‘ ×”×ª×§×“××•×ª",onClick:()=>k("viewBagrutProgress"),color:"cyan"}),e.jsx(re,{icon:e.jsx(ot,{className:"w-5 h-5"}),label:"×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡",onClick:()=>k("updateBagrutStatus"),color:"pink"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™×"}),e.jsxs("button",{onClick:()=>k("viewSchedule"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™× ××ª×•×›× × ×™× ×”×™×•×"})]}):e.jsx("div",{className:"space-y-3",children:l.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:h.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:h.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[h.duration," ×“×§×•×ª â€¢ ",h.type==="individual"?"×¤×¨×˜× ×™":"×§×‘×•×¦×ª×™"]})]})]},h.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¡×§×™×¨×ª × ×•×›×—×•×ª"}),e.jsxs("button",{onClick:()=>k("manageStudents"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ × ×•×›×—×•×ª"})]}):e.jsx("div",{className:"space-y-3",children:y.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${h.status==="present"?"bg-green-500":h.status==="late"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["×©×™×¢×•×¨ ××—×¨×•×Ÿ: ",h.lastLesson]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-medium ${h.attendanceRate>=90?"text-green-600":h.attendanceRate>=75?"text-yellow-600":"text-red-600"}`,children:[h.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"× ×•×›×—×•×ª"})]})]},h.studentId))})]}),r.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×‘×’×¨×•×ª"}),e.jsxs("button",{onClick:()=>k("manageBagrut"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1 mx-auto",children:["×¦×¤×” ×‘×›×œ ×ª×œ××™×“×™ ×”×‘×’×¨×•×ª (",r.length,")",e.jsx(de,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:r.slice(0,5).map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:h.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:h.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${$(h.status)}`,children:N(h.status)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${h.progress>=75?"bg-green-500":h.progress>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${h.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(h.progress),"%"]})]})]})]},h.studentId))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx(_e,{className:"w-5 h-5 text-gray-400"})]}),o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:o.map(h=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${h.type==="lesson"?"bg-blue-100":h.type==="attendance"?"bg-green-100":h.type==="note"?"bg-yellow-100":"bg-purple-100"}`,children:[h.type==="lesson"&&e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),h.type==="attendance"&&e.jsx(he,{className:"w-4 h-4 text-green-600"}),h.type==="note"&&e.jsx(it,{className:"w-4 h-4 text-yellow-600"}),h.type==="grade"&&e.jsx(ge,{className:"w-4 h-4 text-purple-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:h.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:E(h.timestamp)})]})]},h.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"× ×ª×•× ×™× ××”×™×¨×™×"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"}),e.jsx("span",{className:"font-bold text-indigo-600",children:c.filter(h=>h.academicInfo?.isActive!==!1).length})]}),A.includes("conductor")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×ª×–××•×¨×•×ª"}),e.jsx("span",{className:"font-bold text-purple-600",children:v.length})]}),A.includes("theory-teacher")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"}),e.jsx("span",{className:"font-bold text-blue-600",children:M.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"×©×¢×•×ª ×”×©×‘×•×¢"}),e.jsxs("span",{className:"font-bold text-green-600",children:[m.weeklyHours," ×©×¢×•×ª"]})]})]})]})]})]})]})})}function De({icon:a,title:n,value:m,suffix:x,bgColor:l,iconColor:g,borderColor:o}){return e.jsx("div",{className:`${l} border ${o} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[m," ",x&&e.jsx("span",{className:"text-lg font-normal",children:x})]})]}),e.jsx("div",{className:`${g}`,children:a})]})})}function re({icon:a,label:n,onClick:m,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100 border-orange-200",rose:"bg-rose-50 text-rose-600 hover:bg-rose-100 border-rose-200",amber:"bg-amber-50 text-amber-600 hover:bg-amber-100 border-amber-200",emerald:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border-emerald-200",cyan:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100 border-cyan-200",pink:"bg-pink-50 text-pink-600 hover:bg-pink-100 border-pink-200"};return e.jsxs("button",{onClick:m,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[a,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:n})]})}function Nt(){const{user:a}=$e(),[n,m]=w.useState({totalTheoryStudents:0,todaysLessons:0,weeklyTheoryHours:0,upcomingExams:0,activeTheoryGroups:0,pendingGrades:0}),[x,l]=w.useState([]),[g,o]=w.useState([]),[u,y]=w.useState([]),[C,r]=w.useState(!0),[j,b]=w.useState(null);w.useEffect(()=>{a?._id&&S()},[a]);const S=async()=>{try{r(!0),b(null);const c=a._id,i=(await F.theory.getTheoryLessons()).filter(N=>N.teacherId===c),s=new Date,v=s.toISOString().split("T")[0],L=i.filter(N=>new Date(N.date).toISOString().split("T")[0]===v),M=p(new Date),O=new Date(M);O.setDate(M.getDate()+7);const W=i.filter(N=>{const E=new Date(N.date);return E>=M&&E<O}).reduce((N,E)=>N+(E.duration||90),0)/60,J=new Set;i.forEach(N=>{N.studentIds&&N.studentIds.length>0&&N.studentIds.forEach(E=>J.add(E))});const Z=i.filter(N=>N.isActive&&N.studentIds&&N.studentIds.length>0).length,se=new Date(s.getTime()+24*60*60*1e3).toISOString().split("T")[0],Y=i.filter(N=>{const E=N.date.split("T")[0];return E===v||E===se}).slice(0,5).map(N=>({id:N._id,name:N.title||N.category,time:N.startTime,duration:N.duration||90,enrolledCount:N.studentIds?.length||0,capacity:N.maxStudents||15,level:N.category||"×ª×™××•×¨×™×”",venue:N.location}));m({totalTheoryStudents:J.size,todaysLessons:L.length,weeklyTheoryHours:Math.round(W*10)/10,upcomingExams:Math.floor(Math.random()*5)+1,activeTheoryGroups:Z,pendingGrades:Math.floor(Math.random()*10)+2}),l(Y);const ee=[];i.slice(0,5).forEach((N,E)=>{ee.push({id:`activity-${N._id}-${E}`,type:"lesson",title:"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×”×•×©×œ×",description:`×©×™×¢×•×¨ ${N.title||N.category} - ${N.studentIds?.length||0} ×ª×œ××™×“×™×`,timestamp:new Date(Date.now()-Math.random()*864e5*3).toISOString(),groupName:N.title||N.category})}),ee.push({id:"attendance-1",type:"attendance",title:"× ×•×›×—×•×ª ×¢×•×“×›× ×”",description:"× ×•×›×—×•×ª ×œ×©×™×¢×•×¨ ××’××” ××ª×§×“××ª",timestamp:new Date(Date.now()-2*60*60*1e3).toISOString(),groupName:"××’××” ××ª×§×“××ª"}),o(ee.sort((N,E)=>new Date(E.timestamp).getTime()-new Date(N.timestamp).getTime()));const T=[],k=["××’××” ××ª×—×™×œ×™×","××’××” ×‘×™× ×•× ×™×™×","××’××” ××ª×§×“××™×","×”×¨××•× ×™×”","×§×•××¤×•×–×™×¦×™×”"],$=["×“× ×™××œ ×›×”×Ÿ","×¨×—×œ ×œ×•×™","×™×•×¡×£ ×’×¨×™×Ÿ","×©×¨×” ××‘×¨×”×","××™×›×œ ×“×•×“"];for(let N=0;N<Math.min(5,J.size);N++)T.push({studentId:`student-${N}`,studentName:$[N%$.length],theoryGroup:k[N%k.length],currentLevel:Math.random()>.5?"×‘×™× ×•× ×™":"××ª×§×“×",progressPercentage:Math.floor(Math.random()*30)+70,lastActivity:new Date(Date.now()-Math.random()*6048e5).toLocaleDateString("he-IL"),attendanceRate:Math.floor(Math.random()*20)+80});y(T)}catch(c){console.error("Error loading theory dashboard data:",c),b("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×” ×œ×ª×™××•×¨×™×”")}finally{r(!1)}},p=c=>{const t=new Date(c),i=t.getDay(),s=t.getDate()-i;return new Date(t.setDate(s))},f=Pe(),D=c=>{switch(c){case"scheduleTheoryLesson":f("/profile",{state:{activeTab:"theory-lessons"}});break;case"markTheoryAttendance":f("/profile",{state:{activeTab:"theory-lessons"}});break;case"manageTheoryGroups":f("/profile",{state:{activeTab:"theory-lessons"}});break;case"gradeStudents":window.location.href="/teacher/theory-grades";break;default:console.log("Action:",c)}},d=c=>{const t=new Date(c),s=new Date().getTime()-t.getTime(),v=Math.floor(s/(1e3*60*60));return v<1?`×œ×¤× ×™ ${Math.floor(s/6e4)} ×“×§×•×ª`:v<24?`×œ×¤× ×™ ${v} ×©×¢×•×ª`:`×œ×¤× ×™ ${Math.floor(v/24)} ×™××™×`};return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"×˜×•×¢×Ÿ ×œ×•×— ×‘×§×¨×” ×œ×ª×™××•×¨×™×”..."})]})}):j?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:j}),e.jsx("button",{onClick:S,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:"×œ×•×— ×‘×§×¨×” - ××•×¨×” ×ª×™××•×¨×™×” ğŸ¼"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["×©×œ×•× ",a?.firstName||"××•×¨×”"," â€¢ ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8",children:[e.jsx(be,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"×ª×œ××™×“×™ ×ª×™××•×¨×™×”",value:n.totalTheoryStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(be,{icon:e.jsx(K,{className:"w-6 h-6"}),title:"×©×™×¢×•×¨×™× ×”×™×•×",value:n.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(be,{icon:e.jsx(Ne,{className:"w-6 h-6"}),title:"×©×¢×•×ª ×”×©×‘×•×¢",value:n.weeklyTheoryHours,suffix:"×©×¢×•×ª",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(be,{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª",value:n.upcomingExams,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(be,{icon:e.jsx(oe,{className:"w-6 h-6"}),title:"×§×‘×•×¦×•×ª ×¤×¢×™×œ×•×ª",value:n.activeTheoryGroups,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(be,{icon:e.jsx(dt,{className:"w-6 h-6"}),title:"×¦×™×•× ×™× ×××ª×™× ×™×",value:n.pendingGrades,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª - ×ª×™××•×¨×™×”"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ce,{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",onClick:()=>D("scheduleTheoryLesson"),color:"indigo"}),e.jsx(Ce,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"×¡××Ÿ × ×•×›×—×•×ª ×ª×™××•×¨×™×”",onClick:()=>D("markTheoryAttendance"),color:"green"}),e.jsx(Ce,{icon:e.jsx(We,{className:"w-5 h-5"}),label:"× ×”×œ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",onClick:()=>D("manageTheoryGroups"),color:"blue"}),e.jsx(Ce,{icon:e.jsx(mt,{className:"w-5 h-5"}),label:"×“×¨×’ ×ª×œ××™×“×™×",onClick:()=>D("gradeStudents"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×©×™×¢×•×¨×™× ×”×‘××™× - ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>f("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ××ª×•×›× × ×™×"})]}):e.jsx("div",{className:"space-y-3",children:x.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:c.name}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[c.level," â€¢ ",c.enrolledCount,"/",c.capacity," ×ª×œ××™×“×™×"]}),c.venue&&e.jsx("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:c.venue})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:c.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c.duration," ×“×§×•×ª"]})]})]},c.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×”×ª×§×“××•×ª ×ª×œ××™×“×™ ×ª×™××•×¨×™×”"}),e.jsxs("button",{onClick:()=>f("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["×¦×¤×” ×‘×›×œ",e.jsx(de,{className:"w-4 h-4"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ × ×ª×•× ×™ ×”×ª×§×“××•×ª"})]}):e.jsx("div",{className:"space-y-3",children:u.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:c.studentName}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[c.theoryGroup," â€¢ ×¨××”: ",c.currentLevel]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["×¤×¢×™×œ×•×ª ××—×¨×•× ×”: ",c.lastActivity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${c.progressPercentage>=90?"bg-green-500":c.progressPercentage>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${c.progressPercentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[c.progressPercentage,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["× ×•×›×—×•×ª: ",c.attendanceRate,"%"]})]})]},c.studentId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×” - ×ª×™××•×¨×™×”"}),e.jsx(_e,{className:"w-5 h-5 text-gray-400"})]}),g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ×œ××—×¨×•× ×”"})]}):e.jsx("div",{className:"space-y-4",children:g.map(c=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${c.type==="lesson"?"bg-blue-100":c.type==="attendance"?"bg-green-100":c.type==="grade"?"bg-purple-100":c.type==="enrollment"?"bg-yellow-100":"bg-indigo-100"}`,children:[c.type==="lesson"&&e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),c.type==="attendance"&&e.jsx(he,{className:"w-4 h-4 text-green-600"}),c.type==="grade"&&e.jsx(ke,{className:"w-4 h-4 text-purple-600"}),c.type==="enrollment"&&e.jsx(We,{className:"w-4 h-4 text-yellow-600"}),c.type==="exam"&&e.jsx(ne,{className:"w-4 h-4 text-indigo-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:c.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:c.description}),c.groupName&&e.jsx("p",{className:"text-xs text-indigo-600 font-reisinger-yonatan",children:c.groupName}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:d(c.timestamp)})]})]},c.id))})]})]})]})})}function be({icon:a,title:n,value:m,suffix:x,bgColor:l,iconColor:g,borderColor:o}){return e.jsx("div",{className:`${l} border ${o} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[m," ",x&&e.jsx("span",{className:"text-sm font-normal",children:x})]})]}),e.jsx("div",{className:`${g}`,children:a})]})})}function Ce({icon:a,label:n,onClick:m,color:x}){const l={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:m,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${l[x]}`,children:[a,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:n})]})}const Me=({data:a,title:n,className:m="",showValues:x=!0,showPercentages:l=!1})=>{const g=Math.max(...a.map(u=>u.value)),o=a.reduce((u,y)=>u+y.value,0);return e.jsxs("div",{className:`${m}`,dir:"rtl",children:[n&&e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-reisinger-yonatan",children:n}),e.jsx("div",{className:"space-y-3",children:a.map((u,y)=>{const C=g>0?u.value/g*100:0,r=o>0?u.value/o*100:0;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-20 text-sm font-reisinger-yonatan text-right truncate ml-3",children:u.label}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-300",style:{width:`${C}%`,backgroundColor:u.color||"#3B82F6"}})})}),e.jsxs("div",{className:"w-12 text-sm font-medium text-gray-900 text-center mr-3 font-reisinger-yonatan",children:[x&&u.value,l&&`${Math.round(r)}%`]})]},y)})})]})},Ee=({data:a,title:n,className:m="",centerText:x,showValues:l=!0})=>{const g=a.reduce((r,j)=>r+j.value,0),o=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1"];let u=0;const y=a.map((r,j)=>{const b=g>0?r.value/g*100:0,S=r.value/g*360,p=u;return u+=S,{...r,percentage:b,angle:S,startAngle:p,color:r.color||o[j%o.length]}}),C=(r,j,b)=>{const S=r.startAngle*Math.PI/180,p=(r.startAngle+r.angle)*Math.PI/180,f=100+j*Math.cos(S),D=100+j*Math.sin(S),d=100+j*Math.cos(p),c=100+j*Math.sin(p),t=100+b*Math.cos(p),i=100+b*Math.sin(p),s=100+b*Math.cos(S),v=100+b*Math.sin(S),L=r.angle>180?1:0;return`M ${f} ${D} A ${j} ${j} 0 ${L} 1 ${d} ${c} L ${t} ${i} A ${b} ${b} 0 ${L} 0 ${s} ${v} Z`};return e.jsxs("div",{className:`${m}`,dir:"rtl",children:[n&&e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-reisinger-yonatan",children:n}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse",children:[e.jsxs("div",{className:"relative",children:[e.jsx("svg",{width:"200",height:"200",className:"transform rotate-90",children:y.map((r,j)=>e.jsx("path",{d:C(r,80,50),fill:r.color,className:"hover:opacity-80 transition-opacity cursor-pointer",title:`${r.label}: ${r.value} (${Math.round(r.percentage)}%)`},j))}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 font-reisinger-yonatan",children:g}),e.jsx("div",{className:"text-xs text-gray-600 font-reisinger-yonatan",children:x})]})})]}),e.jsx("div",{className:"flex-1 space-y-2",children:y.map((r,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full ml-2",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm font-reisinger-yonatan",children:r.label})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:[l&&r.value," (",Math.round(r.percentage),"%)"]})]},j))})]})]})},vt=({data:a,title:n,className:m="",color:x="#3B82F6",showDots:l=!0,trend:g})=>{const o=Math.max(...a.map(b=>b.value)),u=Math.min(...a.map(b=>b.value)),y=o-u||1,C=a.map((b,S)=>{const p=S/(a.length-1)*280+10,f=100-(b.value-u)/y*80+10;return{x:p,y:f,...b}}),r=C.reduce((b,S,p)=>`${b} ${p===0?"M":"L"} ${S.x} ${S.y}`,""),j=()=>{switch(g){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:`${m}`,dir:"rtl",children:[n&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:n}),g&&e.jsx("span",{className:`text-xs font-medium ${j()} font-reisinger-yonatan`,children:g==="up"?"â†— ×¢×œ×™×™×”":g==="down"?"â†˜ ×™×¨×™×“×”":"â†’ ×™×¦×™×‘"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:"300",height:"120",className:"overflow-visible",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"#f3f4f6",strokeWidth:"1"})})}),e.jsx("rect",{width:"300",height:"120",fill:"url(#grid)"}),e.jsx("path",{d:r,fill:"none",stroke:x,strokeWidth:"2",className:"drop-shadow-sm"}),l&&C.map((b,S)=>e.jsx("circle",{cx:b.x,cy:b.y,r:"4",fill:x,className:"drop-shadow-sm hover:r-6 transition-all cursor-pointer",title:`${b.label}: ${b.value}`},S))]}),e.jsx("div",{className:"flex justify-between mt-2 px-2",children:a.map((b,S)=>e.jsx("span",{className:"text-xs text-gray-600 font-reisinger-yonatan",style:{width:`${100/a.length}%`,textAlign:"center"},children:b.label},S))})]})]})},Ke=({value:a,max:n=100,size:m=120,strokeWidth:x=8,color:l="#3B82F6",label:g,subtitle:o,className:u=""})=>{const y=Math.min(Math.max(a/n*100,0),100),C=(m-x)/2,r=C*2*Math.PI,j=r,b=r-y/100*r;return e.jsxs("div",{className:`flex flex-col items-center ${u}`,dir:"rtl",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:m,height:m,className:"transform -rotate-90",children:[e.jsx("circle",{cx:m/2,cy:m/2,r:C,stroke:"#E5E7EB",strokeWidth:x,fill:"none"}),e.jsx("circle",{cx:m/2,cy:m/2,r:C,stroke:l,strokeWidth:x,fill:"none",strokeDasharray:j,strokeDashoffset:b,strokeLinecap:"round",className:"transition-all duration-300 ease-out"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-xl font-bold text-gray-900 font-reisinger-yonatan",children:[Math.round(y),"%"]}),o&&e.jsx("span",{className:"text-xs text-gray-600 font-reisinger-yonatan",children:o})]})]}),g&&e.jsx("span",{className:"mt-2 text-sm font-medium text-gray-700 text-center font-reisinger-yonatan",children:g})]})},wt=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"],Se={×¨××©×•×Ÿ:0,×©× ×™:1,×©×œ×™×©×™:2,×¨×‘×™×¢×™:3,×—××™×©×™:4,×©×™×©×™:5,×©×‘×ª:6,sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},He={×›×™× ×•×¨:{family:"×›×œ×™ ×§×©×ª",color:"#3B82F6"},×•×™×•×œ×”:{family:"×›×œ×™ ×§×©×ª",color:"#60A5FA"},"×¦'×œ×•":{family:"×›×œ×™ ×§×©×ª",color:"#2563EB"},×¦×œ×•:{family:"×›×œ×™ ×§×©×ª",color:"#2563EB"},×§×•× ×˜×¨×‘×¡:{family:"×›×œ×™ ×§×©×ª",color:"#1D4ED8"},×’×™×˜×¨×”:{family:"×›×œ×™ ×§×©×ª",color:"#93C5FD"},"×’×™×˜×¨×” ×§×œ××¡×™×ª":{family:"×›×œ×™ ×§×©×ª",color:"#93C5FD"},"×’×™×˜×¨×” ×—×©××œ×™×ª":{family:"×›×œ×™ ×§×©×ª",color:"#BFDBFE"},× ×‘×œ:{family:"×›×œ×™ ×§×©×ª",color:"#DBEAFE"},×—×œ×™×œ:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#10B981"},"×—×œ×™×œ ×¦×“":{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#10B981"},×§×œ×¨×™× ×˜:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#34D399"},××‘×•×‘:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#6EE7B7"},×¡×§×¡×•×¤×•×Ÿ:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#059669"},×¤×’×•×˜:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#047857"},×—×œ×™×œ×™×ª:{family:"×›×œ×™ × ×©×™×¤×” ××¢×¥",color:"#A7F3D0"},×—×¦×•×¦×¨×”:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#F59E0B"},×˜×¨×•××‘×•×Ÿ:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#FBBF24"},"×§×¨×Ÿ ×™×¢×¨":{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#FCD34D"},×˜×•×‘×”:{family:"×›×œ×™ × ×©×™×¤×” ×××ª×›×ª",color:"#D97706"},×ª×•×¤×™×:{family:"×›×œ×™ ×”×§×©×”",color:"#EF4444"},"×›×œ×™ ×”×§×©×”":{family:"×›×œ×™ ×”×§×©×”",color:"#F87171"},××¨×™××‘×”:{family:"×›×œ×™ ×”×§×©×”",color:"#DC2626"},×§×¡×™×œ×•×¤×•×Ÿ:{family:"×›×œ×™ ×”×§×©×”",color:"#FCA5A5"},×¤×¡× ×ª×¨:{family:"×¤×¡× ×ª×¨",color:"#8B5CF6"},××•×¨×’×Ÿ:{family:"×¤×¡× ×ª×¨",color:"#A78BFA"},××§×•×¨×“×™×•×Ÿ:{family:"×¤×¡× ×ª×¨",color:"#7C3AED"},×©×™×¨×”:{family:"×§×•×œ",color:"#EC4899"},×–××¨×”:{family:"×§×•×œ",color:"#F472B6"},default:{family:"××—×¨",color:"#6B7280"}},Ue=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1","#14B8A6","#A855F7","#22C55E","#EAB308","#0EA5E9"],Ye=a=>{const n=new Date(a),m=n.getDay(),x=n.getDate()-m;return new Date(n.setDate(x))},Dt=a=>{const n=Ye(a),m=new Date(n);return m.setDate(m.getDate()+6),`${n.getDate()}/${n.getMonth()+1} - ${m.getDate()}/${m.getMonth()+1}`},Ve=(a,n,m)=>a>=n&&a<=m,Ct=(a,n="status")=>{if(!a||a.length===0)return{present:0,absent:0,excused:0,late:0,total:0,rate:0};let m=0,x=0,l=0,g=0;a.forEach(y=>{const r=(y[n]||y.attendance?.status||"").toLowerCase();r==="present"||r==="×”×’×™×¢/×”"||r==="× ×•×›×—"?m++:r==="absent"||r==="×œ× ×”×’×™×¢/×”"||r==="×—×¡×¨"?x++:r==="excused"||r==="× ×¢×“×¨ ×××•×©×¨"?l++:(r==="late"||r==="××™×—×•×¨")&&g++});const o=m+x+l+g,u=o>0?Math.round((m+g)/o*100):0;return{present:m,absent:x,excused:l,late:g,total:o,rate:u}},xe={_cache:new Map,_cacheExpiry:3*60*1e3,async getCached(a,n){const m=Date.now();if(this._cache.has(a)){const l=this._cache.get(a);if(m-l.timestamp<this._cacheExpiry)return console.log(`ğŸ“¦ Using cached data for: ${a}`),l.data}const x=await n();return this._cache.set(a,{data:x,timestamp:m}),x},clearCache(){this._cache.clear(),console.log("ğŸ§¹ Dashboard analytics cache cleared")},async getDashboardSummary(a){return this.getCached(`summary_${a||"all"}`,async()=>{console.log("ğŸ“Š Fetching dashboard summary...");const n=a?{schoolYearId:a}:{},[m,x,l,g,o,u]=await Promise.allSettled([F.students.getStudents(n),F.teachers.getTeachers(n),F.orchestras.getOrchestras(n),F.rehearsals.getRehearsals(n),F.theory.getTheoryLessons(n),F.bagrut.getBagruts()]),y=m.status==="fulfilled"?m.value:[],C=x.status==="fulfilled"?x.value:[],r=l.status==="fulfilled"?l.value:[],j=g.status==="fulfilled"?g.value:[],b=o.status==="fulfilled"?o.value:[],S=u.status==="fulfilled"?u.value:[],p=new Date,f=new Date(p.getFullYear(),p.getMonth(),1),D=Ye(p),d=new Date(D);d.setDate(d.getDate()+7);const c=y.filter(T=>T.isActive!==!1),t=y.filter(T=>T.createdAt&&new Date(T.createdAt)>=f),i=C.filter(T=>T.isActive!==!1&&T.professionalInfo?.isActive!==!1),s=C.filter(T=>(T.teaching?.studentIds?.length||0)>0||(T.studentCount||0)>0),v=r.filter(T=>T.isActive!==!1),L=v.reduce((T,k)=>T+(k.memberIds?.length||k.memberCount||0),0),M=j.filter(T=>{if(!T.date)return!1;const k=new Date(T.date);return k>=D&&k<d}),O=j.filter(T=>T.date?new Date(T.date)>=f:!1),A=j.reduce((T,k)=>(k.attendance&&(T.present+=k.attendance.present?.length||0,T.total+=(k.attendance.present?.length||0)+(k.attendance.absent?.length||0)),T),{present:0,total:0}),W=b.filter(T=>{if(!T.date)return!1;const k=new Date(T.date);return k>=D&&k<d}),J=[...new Set(b.filter(T=>T.isActive!==!1).map(T=>T.category))].length,Z=b.reduce((T,k)=>(k.attendance&&(T.present+=k.attendance.present?.length||0,T.total+=(k.attendance.present?.length||0)+(k.attendance.absent?.length||0)),T),{present:0,total:0}),se=S.filter(T=>!T.isCompleted&&T.isActive!==!1),Y=S.filter(T=>T.isCompleted),ee=S.filter(T=>!T.testDate||T.isCompleted?!1:new Date(T.testDate)>p);return{students:{total:y.length,active:c.length,newThisMonth:t.length,trend:t.length>0?Math.round(t.length/Math.max(c.length,1)*100):0},teachers:{total:C.length,active:i.length,withStudents:s.length},orchestras:{total:r.length,active:v.length,totalMembers:L},rehearsals:{thisWeek:M.length,thisMonth:O.length,avgAttendance:A.total>0?Math.round(A.present/A.total*100):0},theoryLessons:{thisWeek:W.length,activeGroups:J,avgAttendance:Z.total>0?Math.round(Z.present/Z.total*100):0},bagrut:{active:se.length,completed:Y.length,upcomingExams:ee.length}}})},async getInstrumentDistribution(a){return this.getCached(`instruments_${a||"all"}`,async()=>{console.log("ğŸ» Calculating instrument distribution...");const n=a?{schoolYearId:a}:{},m=await F.students.getStudents(n),x={};m.forEach(o=>{o.isActive!==!1&&(o.academicInfo?.instrumentProgress&&o.academicInfo.instrumentProgress.forEach(u=>{const y=u.instrumentName;y&&(x[y]=(x[y]||0)+1)}),o.instrument&&(x[o.instrument]=(x[o.instrument]||0)+1))});const l=Object.values(x).reduce((o,u)=>o+u,0),g=Object.entries(x).map(([o,u])=>{const y=He[o]||He.default;return{instrumentName:o,count:u,percentage:l>0?Math.round(u/l*100):0,color:y.color,family:y.family}}).sort((o,u)=>u.count-o.count);return console.log(`âœ… Found ${g.length} instruments across ${l} enrollments`),g})},async getClassDistribution(a){return this.getCached(`classes_${a||"all"}`,async()=>{console.log("ğŸ« Calculating class distribution...");const n=a?{schoolYearId:a}:{},m=await F.students.getStudents(n),x={};m.forEach(u=>{const y=u.academicInfo?.class||u.class||"×œ× ×”×•×’×“×¨";x[y]||(x[y]={active:0,inactive:0}),u.isActive!==!1?x[y].active++:x[y].inactive++});const l=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨","×œ× ×”×•×’×“×¨"],g=m.filter(u=>u.isActive!==!1).length,o=l.filter(u=>x[u]).map(u=>{const y=x[u],C=y.active+y.inactive;return{className:u,count:C,percentage:g>0?Math.round(y.active/g*100):0,activeCount:y.active,inactiveCount:y.inactive}});return console.log(`âœ… Found ${o.length} classes`),o})},async getTeacherRoomSchedule(a){return this.getCached(`schedule_${a||"all"}`,async()=>{console.log("ğŸ“… Building teacher-room schedule matrix...");const n=a?{schoolYearId:a}:{},m=await F.teachers.getTeachers(n),x=[],l=new Map,g=new Set,o=new Set;let u=0;for(const r of m){if(r.isActive===!1)continue;const j=r._id,b=r.personalInfo?.fullName||"××•×¨×”";l.has(j)||(l.set(j,{id:j,name:b,color:Ue[u%Ue.length]}),u++);const S=r.teaching?.timeBlocks||[];for(const f of S){if(!f.isActive)continue;const D=f.day||"",d=Se[D.toLowerCase()]??Se[D]??-1,c=f.location||"×œ× ×¦×•×™×Ÿ",t=f.roomNumber||c;g.add(t),o.add(f.startTime||""),x.push({teacherId:j,teacherName:b,day:D,dayIndex:d,startTime:f.startTime||"",endTime:f.endTime||"",duration:f.totalDuration||60,location:c,roomNumber:t,color:l.get(j)?.color})}const p=r.teaching?.schedule||[];for(const f of p){if(!f.isAvailable)continue;const D=f.day||"",d=Se[D.toLowerCase()]??Se[D]??-1,c=f.location||"×œ× ×¦×•×™×Ÿ",t=f.roomNumber||c;g.add(t),o.add(f.startTime||""),x.some(s=>s.teacherId===j&&s.day===D&&s.startTime===f.startTime)||x.push({teacherId:j,teacherName:b,day:D,dayIndex:d,startTime:f.startTime||"",endTime:f.endTime||"",duration:f.duration||45,location:c,roomNumber:t,studentName:f.studentName,lessonType:f.lessonType||"individual",color:l.get(j)?.color})}}const y=Array.from(o).filter(r=>r).sort((r,j)=>{const[b,S]=r.split(":").map(Number),[p,f]=j.split(":").map(Number);return b*60+S-(p*60+f)}),C=Array.from(g).filter(r=>r&&r!=="×œ× ×¦×•×™×Ÿ").sort();return console.log(`âœ… Found ${x.length} schedule slots across ${l.size} teachers`),{slots:x,teachers:Array.from(l.values()),rooms:C,timeSlots:y}})},async getAttendanceTrends(a=12,n){return this.getCached(`trends_${a}_${n||"all"}`,async()=>{console.log(`ğŸ“ˆ Calculating attendance trends for last ${a} weeks...`);const m=n?{schoolYearId:n}:{},[x,l]=await Promise.allSettled([F.rehearsals.getRehearsals(m),F.theory.getTheoryLessons(m)]),g=x.status==="fulfilled"?x.value:[],o=l.status==="fulfilled"?l.value:[],u=new Date,y=[];for(let C=a-1;C>=0;C--){const r=new Date(u);r.setDate(r.getDate()-C*7-u.getDay()),r.setHours(0,0,0,0);const j=new Date(r);j.setDate(j.getDate()+7);const S=g.filter(i=>{if(!i.date)return!1;const s=new Date(i.date);return Ve(s,r,j)}).reduce((i,s)=>(s.attendance&&(i.present+=s.attendance.present?.length||0,i.total+=(s.attendance.present?.length||0)+(s.attendance.absent?.length||0)),i),{present:0,total:0}),f=o.filter(i=>{if(!i.date)return!1;const s=new Date(i.date);return Ve(s,r,j)}).reduce((i,s)=>(s.attendance&&(i.present+=s.attendance.present?.length||0,i.total+=(s.attendance.present?.length||0)+(s.attendance.absent?.length||0)),i),{present:0,total:0}),D=S.total>0?Math.round(S.present/S.total*100):0,d=f.total>0?Math.round(f.present/f.total*100):0,c=[D,d].filter(i=>i>0),t=c.length>0?Math.round(c.reduce((i,s)=>i+s,0)/c.length):0;y.push({weekLabel:Dt(r),weekStartDate:r.toISOString().split("T")[0],privateLessons:0,theoryLessons:d,orchestraRehearsals:D,overall:t})}return console.log(`âœ… Generated ${y.length} weeks of attendance trends`),y})},async getBagrutProgress(a){return this.getCached(`bagrut_${a||"all"}`,async()=>{console.log("ğŸ“ Calculating bagrut progress...");const[n,m]=await Promise.allSettled([F.bagrut.getBagruts(),F.students.getStudents(a?{schoolYearId:a}:{})]),x=n.status==="fulfilled"?n.value:[],l=m.status==="fulfilled"?m.value:[],g=new Map;l.forEach(d=>{g.set(d._id,d.personalInfo?.fullName||"×ª×œ××™×“")});const o=x.filter(d=>d.isActive!==!1),u=o.filter(d=>d.isCompleted),y=o.filter(d=>!d.isCompleted&&d.presentations?.some(c=>c.completed)),C=o.filter(d=>!d.isCompleted&&!d.presentations?.some(c=>c.completed)),r={presentation1:{completed:0,passed:0,total:0},presentation2:{completed:0,passed:0,total:0},presentation3:{completed:0,passed:0,total:0},presentation4:{completed:0,passed:0,total:0}};o.forEach(d=>{d.presentations&&d.presentations.forEach((c,t)=>{const i=`presentation${t+1}`;r[i]&&(r[i].total++,c.completed&&(r[i].completed++,(c.status==="×¢×‘×¨/×”"||c.grade>=55)&&r[i].passed++))})});const j=[{range:"90-100",min:90,max:100,count:0,color:"#10B981"},{range:"80-89",min:80,max:89,count:0,color:"#3B82F6"},{range:"70-79",min:70,max:79,count:0,color:"#6366F1"},{range:"60-69",min:60,max:69,count:0,color:"#F59E0B"},{range:"55-59",min:55,max:59,count:0,color:"#F97316"},{range:"××ª×—×ª ×œ-55",min:0,max:54,count:0,color:"#EF4444"}];let b=0,S=0;u.forEach(d=>{const c=d.finalGrade||0;if(c>0){b++,S+=c;for(const t of j)if(c>=t.min&&c<=t.max){t.count++;break}}});const p=new Date,f=o.filter(d=>d.testDate&&new Date(d.testDate)>p&&!d.isCompleted).sort((d,c)=>new Date(d.testDate).getTime()-new Date(c.testDate).getTime()).slice(0,5).map(d=>({studentName:g.get(d.studentId)||"×ª×œ××™×“",date:new Date(d.testDate).toLocaleDateString("he-IL"),teacherName:d.teacherName||"××•×¨×”"})),D={totalStudents:o.length,completedCount:u.length,inProgressCount:y.length,notStartedCount:C.length,completionRate:o.length>0?Math.round(u.length/o.length*100):0,presentations:r,gradeDistribution:j.map(d=>({range:d.range,count:d.count,color:d.color})),averageGrade:b>0?Math.round(S/b):0,upcomingExams:f};return console.log(`âœ… Bagrut progress calculated: ${u.length}/${o.length} completed`),D})},async getStudentActivity(a){try{console.log(`ğŸ‘¤ Fetching activity for student ${a}...`);const[n,m,x]=await Promise.allSettled([F.students.getStudent(a),F.theory.getTheoryLessons(),F.orchestras.getOrchestras()]);if(n.status!=="fulfilled"||!n.value)return null;const l=n.value,g=m.status==="fulfilled"?m.value:[],o=x.status==="fulfilled"?x.value:[],u=g.filter(j=>j.studentIds?.includes(a)),y=o.filter(j=>j.memberIds?.includes(a)),C=wt.map((j,b)=>({day:j,dayIndex:b,activities:0,attendance:0})),r=[];return l.academicInfo?.instrumentProgress&&l.academicInfo.instrumentProgress.forEach(j=>{j.startDate&&r.push({date:new Date(j.startDate).toISOString().split("T")[0],stage:j.currentStage||1,instrumentName:j.instrumentName||""})}),{studentId:a,studentName:l.personalInfo?.fullName||"×ª×œ××™×“",privateLessons:{present:0,absent:0,excused:0,late:0,total:0,rate:0},theoryLessons:Ct(u.flatMap(j=>j.attendanceList?.filter(b=>b.studentId===a)||[])),orchestraRehearsals:{present:0,absent:0,excused:0,late:0,total:0,rate:0},overall:{present:0,absent:0,excused:0,late:0,total:0,rate:0},weeklyActivity:C,progressHistory:r}}catch(n){return console.error("Error fetching student activity:",n),null}},async getQuickMetrics(a){const n=await this.getDashboardSummary(a);return{totalStudents:n.students.active,attendanceRate:Math.round((n.rehearsals.avgAttendance+n.theoryLessons.avgAttendance)/2),activeTeachers:n.teachers.active,upcomingEvents:n.rehearsals.thisWeek+n.theoryLessons.thisWeek}}},St=({schoolYearId:a,className:n=""})=>{const[m,x]=w.useState(!0),[l,g]=w.useState(null),[o,u]=w.useState(null),[y,C]=w.useState([]),[r,j]=w.useState([]),[b,S]=w.useState([]);w.useEffect(()=>{p()},[a]);const p=async()=>{try{x(!0),g(null);const[s,v,L,M]=await Promise.allSettled([xe.getDashboardSummary(a),xe.getAttendanceTrends(8,a),xe.getInstrumentDistribution(a),xe.getClassDistribution(a)]);s.status==="fulfilled"&&u(s.value),v.status==="fulfilled"&&C(v.value),L.status==="fulfilled"&&j(L.value),M.status==="fulfilled"&&S(M.value)}catch(s){console.error("Error loading activity data:",s),g("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×")}finally{x(!1)}};if(m)return e.jsx("div",{className:`grid grid-cols-1 lg:grid-cols-2 gap-6 ${n}`,children:[1,2,3,4].map(s=>e.jsx(G,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-gray-100 rounded"})]})},s))});if(l)return e.jsx(G,{className:n,children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-500 mb-4",children:l}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"× ×¡×” ×©×•×‘"})]})});const f=[{label:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:o?.students?.active||0,trend:o?.students?.trend||0,icon:e.jsx(ue,{className:"w-5 h-5"}),color:"#3B82F6"},{label:"× ×•×›×—×•×ª ×ª×–××•×¨×•×ª",value:o?.rehearsals?.avgAttendance||0,trend:0,icon:e.jsx(ie,{className:"w-5 h-5"}),color:"#10B981"},{label:"× ×•×›×—×•×ª ×ª××•×¨×™×”",value:o?.theoryLessons?.avgAttendance||0,trend:0,icon:e.jsx(oe,{className:"w-5 h-5"}),color:"#8B5CF6"},{label:"×‘×’×¨×•×™×•×ª ×¤×¢×™×œ×•×ª",value:o?.bagrut?.active||0,trend:0,icon:e.jsx(ge,{className:"w-5 h-5"}),color:"#F59E0B"}],D=y.map(s=>({label:s.weekLabel.split(" - ")[0],value:s.overall||0})),d=()=>{if(D.length<2)return"neutral";const s=D.slice(-3),v=s.reduce((M,O)=>M+O.value,0)/s.length,L=D.slice(0,3).reduce((M,O)=>M+O.value,0)/3;return v>L+5?"up":v<L-5?"down":"neutral"},c=r.slice(0,8).map(s=>({label:s.instrumentName,value:s.count,color:s.color})),t=b.map(s=>({label:`×›×™×ª×” ${s.className}`,value:s.activeCount,color:"#3B82F6"})),i=Math.round(((o?.rehearsals?.avgAttendance||0)+(o?.theoryLessons?.avgAttendance||0))/2);return e.jsxs("div",{className:`space-y-6 ${n}`,dir:"rtl",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:f.map((s,v)=>e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`},children:e.jsx("div",{style:{color:s.color},children:s.icon})}),s.trend!==0&&e.jsxs("span",{className:`text-xs font-medium ${s.trend>0?"text-green-600":"text-red-600"}`,children:[s.trend>0?"â†‘":"â†“"," ",Math.abs(s.trend),"%"]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.label.includes("× ×•×›×—×•×ª")?`${s.value}%`:s.value}),e.jsx("p",{className:"text-sm text-gray-600",children:s.label})]},v))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××’××ª × ×•×›×—×•×ª ×›×œ×œ×™×ª"}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ke,{className:`w-4 h-4 ${d()==="up"?"text-green-500":d()==="down"?"text-red-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:"8 ×©×‘×•×¢×•×ª ××—×¨×•× ×™×"})]})]}),D.length>0?e.jsx(vt,{data:D,color:"#3B82F6",showDots:!0,trend:d()}):e.jsx("div",{className:"h-32 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[o?.rehearsals?.avgAttendance||0,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª×–××•×¨×•×ª"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-purple-600",children:[o?.theoryLessons?.avgAttendance||0,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª××•×¨×™×”"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[i,"%"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×××•×¦×¢ ×›×œ×œ×™"})]})]})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"× ×•×›×—×•×ª ×›×•×œ×œ×ª"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ke,{value:i,max:100,size:180,strokeWidth:12,color:i>=80?"#10B981":i>=60?"#F59E0B":"#EF4444",label:"×©×™×¢×•×¨ × ×•×›×—×•×ª",subtitle:"×××•×¦×¢ ×›×œ ×”×¤×¢×™×œ×•×™×•×ª"})}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×—×–×¨×•×ª ×ª×–××•×¨×ª"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full mx-2",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${o?.rehearsals?.avgAttendance||0}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-10 text-left",children:[o?.rehearsals?.avgAttendance||0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full mx-2",children:e.jsx("div",{className:"h-2 bg-purple-500 rounded-full",style:{width:`${o?.theoryLessons?.avgAttendance||0}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-10 text-left",children:[o?.theoryLessons?.avgAttendance||0,"%"]})]})]})]})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×›×œ×™ × ×’×™× ×”"}),c.length>0?e.jsx(Ee,{data:c,centerText:"×ª×œ××™×“×™×",showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×›×™×ª×•×ª"}),t.length>0?e.jsx(Me,{data:t,showValues:!0,showPercentages:!1}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:'×¡×”"×› ×›×™×ª×•×ª:'}),e.jsx("span",{className:"font-medium",children:b.length})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"×××•×¦×¢ ×ª×œ××™×“×™× ×œ×›×™×ª×”:"}),e.jsx("span",{className:"font-medium",children:b.length>0?Math.round(b.reduce((s,v)=>s+v.activeCount,0)/b.length):0})]})]})]})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×¤×¢×™×œ×•×ª ×©×‘×•×¢×™×ª"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"].map((s,v)=>{const M=v<5?Math.random()*.6+.3:Math.random()*.3;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"aspect-square rounded-lg mb-2 transition-colors",style:{backgroundColor:`rgba(59, 130, 246, ${M})`},title:`${s}: ${Math.round(M*100)}% ×¤×¢×™×œ×•×ª`}),e.jsx("span",{className:"text-xs text-gray-600",children:s})]},s)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-100 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×¤×¢×™×œ×•×ª × ××•×›×”"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-300 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×‘×™× ×•× ×™×ª"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-500 ml-1"}),e.jsx("span",{className:"text-xs text-gray-600",children:"×’×‘×•×”×”"})]})]})]})]})},Tt=St,kt=({schoolYearId:a,className:n="",maxItems:m=10,showFamilyGroups:x=!0})=>{const[l,g]=w.useState(!0),[o,u]=w.useState([]),[y,C]=w.useState("donut"),[r,j]=w.useState(!1);w.useEffect(()=>{b()},[a]);const b=async()=>{try{g(!0);const d=await xe.getInstrumentDistribution(a);u(d)}catch(d){console.error("Error loading instrument distribution:",d)}finally{g(!1)}},S=w.useMemo(()=>{if(!r)return o.slice(0,m);const d={};return o.forEach(c=>{const t=c.family||"××—×¨";d[t]||(d[t]={count:0,color:c.color}),d[t].count+=c.count}),Object.entries(d).map(([c,{count:t,color:i}])=>({instrumentName:c,count:t,percentage:0,color:i,family:c})).sort((c,t)=>t.count-c.count)},[o,r,m]),p=w.useMemo(()=>o.reduce((d,c)=>d+c.count,0),[o]),f=w.useMemo(()=>S.map(d=>({label:d.instrumentName,value:d.count,color:d.color})),[S]),D=o[0];return l?e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-gray-100 rounded"})]})}):e.jsxs(G,{className:`p-6 ${n}`,dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×ª×¤×œ×’×•×ª ×›×œ×™ × ×’×™× ×”"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p," ×ª×œ××™×“×™× | ",o.length," ×›×œ×™×"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>C("donut"),className:`p-1.5 rounded-md transition-colors ${y==="donut"?"bg-white shadow-sm":""}`,title:"×ª×¦×•×’×ª ×¢×•×’×”",children:e.jsx(Je,{className:`w-4 h-4 ${y==="donut"?"text-gray-900":"text-gray-500"}`})}),e.jsx("button",{onClick:()=>C("bar"),className:`p-1.5 rounded-md transition-colors ${y==="bar"?"bg-white shadow-sm":""}`,title:"×ª×¦×•×’×ª ×¢××•×“×•×ª",children:e.jsx(Ae,{className:`w-4 h-4 ${y==="bar"?"text-gray-900":"text-gray-500"}`})})]}),x&&e.jsx("button",{onClick:()=>j(!r),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${r?"bg-purple-50 border-purple-200 text-purple-700":"border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:r?"×œ×¤×™ ××©×¤×—×”":"×œ×¤×™ ×›×œ×™"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p}),e.jsx("p",{className:"text-xs text-gray-600",children:'×¡×”"×› × ×¨×©××™×'})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"×›×œ×™ × ×’×™× ×”"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600 truncate",title:D?.instrumentName,children:D?.instrumentName||"-"}),e.jsx("p",{className:"text-xs text-gray-600",children:"×”×›×™ ×¤×•×¤×•×œ×¨×™"})]})]}),f.length>0?y==="donut"?e.jsx(Ee,{data:f,centerText:r?"××©×¤×—×•×ª":"×›×œ×™×",showValues:!0}):e.jsx(Me,{data:f,showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})]})}),!r&&o.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×œ×¤×™ ××©×¤×—×ª ×›×œ×™×"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(o.map(d=>d.family))).map(d=>{const c=o.filter(s=>s.family===d),t=c.reduce((s,v)=>s+v.count,0),i=c[0]?.color||"#6B7280";return e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${i}15`},children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i}}),e.jsx("span",{className:"text-gray-700",children:d}),e.jsx("span",{className:"font-medium",style:{color:i},children:t})]},d)})})]}),o.length>m&&e.jsxs("details",{className:"mt-4",children:[e.jsxs("summary",{className:"text-sm text-blue-600 cursor-pointer hover:text-blue-700",children:["×”×¦×’ ××ª ×›×œ ",o.length," ×”×›×œ×™×"]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2",children:o.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.color}}),e.jsx("span",{className:"text-gray-700 truncate",children:d.instrumentName})]}),e.jsx("span",{className:"font-medium text-gray-900",children:d.count})]},d.instrumentName))})]})]})},$t=kt,At=({schoolYearId:a,className:n="",showInactive:m=!1})=>{const[x,l]=w.useState(!0),[g,o]=w.useState([]),[u,y]=w.useState("bar");w.useEffect(()=>{C()},[a]);const C=async()=>{try{l(!0);const t=await xe.getClassDistribution(a);o(t)}catch(t){console.error("Error loading class distribution:",t)}finally{l(!1)}},r=g.reduce((t,i)=>t+i.activeCount,0);g.reduce((t,i)=>t+i.inactiveCount,0);const j=w.useMemo(()=>{const t=["×","×‘","×’","×“","×”","×•"],i=["×–","×—","×˜"],s=["×™","×™×","×™×‘"],v=g.filter(A=>t.includes(A.className)),L=g.filter(A=>i.includes(A.className)),M=g.filter(A=>s.includes(A.className)),O=g.filter(A=>!t.includes(A.className)&&!i.includes(A.className)&&!s.includes(A.className));return{primary:{label:"×™×¡×•×“×™ (×-×•)",count:v.reduce((A,W)=>A+W.activeCount,0),classes:v,color:"#3B82F6"},middle:{label:'×—×˜"×‘ (×–-×˜)',count:L.reduce((A,W)=>A+W.activeCount,0),classes:L,color:"#10B981"},high:{label:"×ª×™×›×•×Ÿ (×™-×™×‘)",count:M.reduce((A,W)=>A+W.activeCount,0),classes:M,color:"#8B5CF6"},other:{label:"××—×¨",count:O.reduce((A,W)=>A+W.activeCount,0),classes:O,color:"#6B7280"}}},[g]),b=g.map(t=>({label:`×›×™×ª×” ${t.className}`,value:t.activeCount,color:p(t.className)})),S=Object.values(j).filter(t=>t.count>0).map(t=>({label:t.label,value:t.count,color:t.color}));function p(t){const i=["×","×‘","×’","×“","×”","×•"],s=["×–","×—","×˜"],v=["×™","×™×","×™×‘"];return i.includes(t)?"#3B82F6":s.includes(t)?"#10B981":v.includes(t)?"#8B5CF6":"#6B7280"}const D=[...g].sort((t,i)=>i.activeCount-t.activeCount)[0],d=g.length>0?Math.round(r/g.length):0,c=[{id:"bar",label:"×¢××•×“×•×ª",icon:Ae},{id:"donut",label:"×¢×•×’×”",icon:Je},{id:"cards",label:"×›×¨×˜×™×¡×™×",icon:xt},{id:"levels",label:"×©×œ×‘×™×",icon:ht}];return x?e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]})}):e.jsxs(G,{className:`p-6 ${n}`,dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×›×™×ª×•×ª"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r," ×ª×œ××™×“×™× ×¤×¢×™×œ×™× | ",g.length," ×›×™×ª×•×ª"]})]})]}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:c.map(t=>{const i=t.icon;return e.jsxs("button",{onClick:()=>y(t.id),className:`flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-md transition-colors ${u===t.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:t.label,children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t.label})]},t.id)})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r}),e.jsx("p",{className:"text-xs text-gray-600",children:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d}),e.jsx("p",{className:"text-xs text-gray-600",children:"×××•×¦×¢ ×œ×›×™×ª×”"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-purple-600",children:D?`${D.className}`:"-"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["×›×™×ª×” ×’×“×•×œ×” (",D?.activeCount||0,")"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:g.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"×›×™×ª×•×ª ×¤×¢×™×œ×•×ª"})]})]}),u==="bar"&&e.jsx("div",{children:b.length>0?e.jsx(Me,{data:b,showValues:!0}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})}),u==="donut"&&e.jsx("div",{children:S.length>0?e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(Ee,{data:S,centerText:"×©×œ×‘×™×",showValues:!0})}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:"××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×"})}),u==="cards"&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-3",children:g.map(t=>{const i=r>0?Math.round(t.activeCount/r*100):0;return e.jsxs("div",{className:"relative p-4 rounded-xl text-center transition-all hover:shadow-lg hover:scale-105 cursor-pointer",style:{backgroundColor:`${p(t.className)}15`},children:[e.jsx("p",{className:"text-lg font-bold text-gray-800",children:t.className}),e.jsx("p",{className:"text-3xl font-bold mt-1",style:{color:p(t.className)},children:t.activeCount}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i,"%"]}),e.jsx("div",{className:"mt-2 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${t.activeCount/(D?.activeCount||1)*100}%`,backgroundColor:p(t.className)}})})]},t.className)})}),u==="levels"&&e.jsxs("div",{className:"space-y-6",children:[Object.entries(j).map(([t,i])=>{if(i.count===0)return null;const s=r>0?Math.round(i.count/r*100):0;return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:i.color}}),e.jsx("span",{className:"font-semibold text-gray-900",children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",style:{color:i.color},children:i.count}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s,"%)"]})]})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${s}%`,backgroundColor:i.color}})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.classes.map(v=>e.jsxs("div",{className:"px-3 py-1.5 bg-white rounded-lg shadow-sm flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["×›×™×ª×” ",v.className]}),e.jsx("span",{className:"font-bold",style:{color:i.color},children:v.activeCount})]},v.className))})]},t)}),e.jsxs("div",{className:"bg-gradient-to-l from-gray-50 to-white rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:"×”×©×•×•××” ×—×–×•×ª×™×ª"}),e.jsx("div",{className:"flex items-end justify-center gap-4 h-32",children:Object.entries(j).map(([t,i])=>{if(i.count===0)return null;const s=Math.max(...Object.values(j).map(L=>L.count)),v=s>0?i.count/s*100:0;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold",style:{color:i.color},children:i.count}),e.jsx("div",{className:"w-16 rounded-t-lg transition-all duration-500",style:{height:`${v}%`,backgroundColor:i.color,minHeight:"20px"}}),e.jsx("span",{className:"text-xs text-gray-600 text-center max-w-[64px]",children:i.label.split(" ")[0]})]},t)})})]})]})]})},Qe=At,Mt=({schoolYearId:a,className:n=""})=>{const[m,x]=w.useState(!0),[l,g]=w.useState(null);w.useEffect(()=>{o()},[a]);const o=async()=>{try{x(!0);const r=await xe.getBagrutProgress(a);g(r)}catch(r){console.error("Error loading bagrut progress:",r)}finally{x(!1)}};if(m)return e.jsx(G,{className:`p-6 ${n}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]})});if(!l)return e.jsx(G,{className:`p-6 ${n}`,dir:"rtl",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ × ×ª×•× ×™ ×‘×’×¨×•×™×•×ª ×–××™× ×™×"})]})});const u=[{label:"×”×•×©×œ×",value:l.completedCount,color:"#10B981"},{label:"×‘×ª×”×œ×™×š",value:l.inProgressCount,color:"#F59E0B"},{label:"×˜×¨× ×”×ª×—×™×œ",value:l.notStartedCount,color:"#6B7280"}].filter(r=>r.value>0),y=[{key:"presentation1",label:"×”×¦×’×” 1",completed:l.presentations.presentation1.completed,passed:l.presentations.presentation1.passed,total:l.presentations.presentation1.total},{key:"presentation2",label:"×”×¦×’×” 2",completed:l.presentations.presentation2.completed,passed:l.presentations.presentation2.passed,total:l.presentations.presentation2.total},{key:"presentation3",label:"×”×¦×’×” 3",completed:l.presentations.presentation3.completed,passed:l.presentations.presentation3.passed,total:l.presentations.presentation3.total},{key:"presentation4",label:"××’×Ÿ ×‘×’×¨×•×ª",completed:l.presentations.presentation4.completed,passed:l.presentations.presentation4.passed,total:l.presentations.presentation4.total}],C=l.gradeDistribution.map(r=>({label:r.range,value:r.count,color:r.color}));return e.jsxs("div",{className:`space-y-6 ${n}`,dir:"rtl",children:[e.jsx(G,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(ge,{className:"w-8 h-8 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"××¢×§×‘ ×‘×’×¨×•×™×•×ª"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.totalStudents," ×ª×œ××™×“×™× ×¨×©×•××™×"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center px-4 py-2 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(gt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:l.completedCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×”×•×©×œ××•"})]}),e.jsxs("div",{className:"text-center px-4 py-2 bg-amber-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(Ne,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-2xl font-bold text-amber-600",children:l.inProgressCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×‘×ª×”×œ×™×š"})]}),e.jsxs("div",{className:"text-center px-4 py-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-600",children:l.notStartedCount})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"×˜×¨× ×”×ª×—×™×œ×•"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×©×™×¢×•×¨ ×”×©×œ××” ×›×•×œ×œ"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ke,{value:l.completionRate,max:100,size:200,strokeWidth:16,color:l.completionRate>=70?"#10B981":l.completionRate>=40?"#F59E0B":"#EF4444",label:"×”×©×œ××ª ×‘×’×¨×•×™×•×ª",subtitle:`${l.completedCount} ××ª×•×š ${l.totalStudents}`})}),e.jsx("div",{className:"mt-6",children:u.length>0&&e.jsx(Ee,{data:u,centerText:"×¡×˜×˜×•×¡",showValues:!0})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×§×“××•×ª ×œ×¤×™ ×”×¦×’×•×ª"}),e.jsx("div",{className:"space-y-4",children:y.map((r,j)=>{const b=r.total>0?Math.round(r.completed/r.total*100):0,S=r.completed>0?Math.round(r.passed/r.completed*100):0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold ${b===100?"bg-green-500":b>0?"bg-amber-500":"bg-gray-400"}`,children:j+1}),e.jsx("span",{className:"font-medium text-gray-900",children:r.label})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r.completed,"/",r.total," ×”×•×©×œ××•"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-400 transition-all duration-500",style:{width:`${b}%`}})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[b,"% ×”×•×©×œ××•"]}),r.completed>0&&e.jsxs("span",{className:S>=80?"text-green-600":"text-amber-600",children:[S,"% ×¢×‘×¨×•"]})]})]},r.key)})})]}),e.jsxs(G,{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"×”×ª×¤×œ×’×•×ª ×¦×™×•× ×™×"}),C.some(r=>r.value>0)?e.jsxs(e.Fragment,{children:[e.jsx(Me,{data:C,showValues:!0}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-l from-amber-50 to-amber-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-gray-700",children:"×¦×™×•×Ÿ ×××•×¦×¢"})]}),e.jsx("span",{className:"text-3xl font-bold text-amber-600",children:l.averageGrade||"-"})]})})]}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ ×¦×™×•× ×™× ×–××™× ×™×"})]})})]}),e.jsxs(G,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[l.upcomingExams.length," ×‘×—×™× ×•×ª"]})]}),l.upcomingExams.length>0?e.jsx("div",{className:"space-y-3",children:l.upcomingExams.map((r,j)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.studentName}),e.jsx("p",{className:"text-sm text-gray-600",children:r.teacherName})]}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"text-sm font-medium text-amber-600",children:r.date})})]},j))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"××™×Ÿ ×‘×—×™× ×•×ª ××ª×•×›× × ×•×ª"})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm text-amber-700 bg-amber-50 rounded-lg hover:bg-amber-100 transition-colors",children:"×¦×¤×” ×‘×›×œ ×”×‘×’×¨×•×™×•×ª"}),e.jsx("button",{className:"px-3 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"×™×™×¦× ×“×•×—"})]})})]})]}),e.jsx(G,{className:"p-4 bg-gradient-to-l from-amber-50 to-white",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-8 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:l.totalStudents}),e.jsx("p",{className:"text-sm text-gray-600",children:'×¡×”"×› ×ª×œ××™×“×™×'})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[l.completionRate,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"×©×™×¢×•×¨ ×”×©×œ××”"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.averageGrade||"-"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×¦×™×•×Ÿ ×××•×¦×¢"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:l.upcomingExams.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×™× ×•×ª ×§×¨×•×‘×•×ª"})]})]})})]})},Et=Mt,Te=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],Bt=({className:a=""})=>{const{currentSchoolYear:n}=ze(),[m,x]=w.useState(!0),[l,g]=w.useState([]),[o,u]=w.useState(()=>{const p=new Date().getDay();return p<6?p:0});w.useEffect(()=>{y()},[n]);const y=async()=>{try{x(!0);const p=n?{schoolYearId:n._id}:{},f=await F.teachers.getTeachers(p);g(Array.isArray(f)?f:[])}catch(p){console.error("Error loading teachers:",p),g([])}finally{x(!1)}},C=w.useMemo(()=>{const p=Te[o],f=[];return l.forEach(D=>{if(!D.isActive)return;const d=D.personalInfo?.fullName||"××•×¨×”",c=D.professionalInfo?.instrument||"";(D.teaching?.timeBlocks||[]).forEach(s=>{if(!s.isActive)return;s.day?.trim()===p&&f.push({teacherId:D._id,teacherName:d,room:s.location||s.roomNumber||"×œ× ×¦×•×™×Ÿ",startTime:s.startTime||"",endTime:s.endTime||"",instrument:c})}),(D.teaching?.schedule||[]).forEach(s=>{if(!s.isAvailable)return;s.day?.trim()===p&&(f.some(M=>M.teacherId===D._id&&M.startTime===s.startTime)||f.push({teacherId:D._id,teacherName:d,room:s.location||s.roomNumber||"×œ× ×¦×•×™×Ÿ",startTime:s.startTime||"",endTime:s.endTime||"",instrument:c}))})}),f.sort((D,d)=>{const c=D.startTime.split(":").map(Number),t=d.startTime.split(":").map(Number),i=(c[0]||0)*60+(c[1]||0),s=(t[0]||0)*60+(t[1]||0);return i!==s?i-s:D.teacherName.localeCompare(d.teacherName,"he")})},[l,o]),r=w.useMemo(()=>{const p={};return C.forEach(f=>{const D=f.room||"×œ× ×¦×•×™×Ÿ";p[D]||(p[D]=[]),p[D].push(f)}),Object.entries(p).sort(([f],[D])=>f==="×œ× ×¦×•×™×Ÿ"?1:D==="×œ× ×¦×•×™×Ÿ"?-1:f.localeCompare(D,"he"))},[C]),j=()=>{u(p=>p>0?p-1:5)},b=()=>{u(p=>p<5?p+1:0)},S=p=>{const f=["bg-blue-50 hover:bg-blue-100","bg-green-50 hover:bg-green-100","bg-purple-50 hover:bg-purple-100","bg-amber-50 hover:bg-amber-100","bg-rose-50 hover:bg-rose-100","bg-cyan-50 hover:bg-cyan-100","bg-orange-50 hover:bg-orange-100","bg-indigo-50 hover:bg-indigo-100"];return f[p%f.length]};return m?e.jsx(G,{className:`p-6 ${a}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(p=>e.jsx("div",{className:"h-12 bg-gray-100 rounded"},p))})]})}):e.jsxs(G,{className:`p-6 ${a}`,dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["×œ×•×— ×—×“×¨×™× - ×™×•× ",Te[o]]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C.length," ×©×™×¢×•×¨×™× | ",r.length," ×—×“×¨×™× ×¤×¢×™×œ×™×"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:j,className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",title:"×™×•× ×§×•×“×",children:e.jsx(de,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"flex gap-1",children:Te.map((p,f)=>e.jsxs("button",{onClick:()=>u(f),className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${f===o?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[p.charAt(0),"×³"]},p))}),e.jsx("button",{onClick:b,className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",title:"×™×•× ×”×‘×",children:e.jsx(ut,{className:"w-5 h-5 text-gray-600"})})]})]}),C.length>0?e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-l from-blue-600 to-blue-700 text-white",children:[e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm w-16",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"}),"×©× ×”××•×¨×”"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"×—×“×¨"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"×©×¢×•×ª"]})}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-sm",children:"×›×œ×™ × ×’×™× ×”"})]})}),e.jsx("tbody",{children:C.map((p,f)=>e.jsxs("tr",{className:`${S(f)} transition-colors border-b border-gray-100 last:border-b-0`,children:[e.jsx("td",{className:"px-4 py-3 text-gray-500 font-medium",children:f+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-semibold text-gray-900",children:p.teacherName})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-white rounded-full text-sm font-medium text-gray-700 shadow-sm",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-blue-500"}),p.room]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-gray-700",children:[p.startTime," - ",p.endTime]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:p.instrument||"-"})]},`${p.teacherId}-${p.startTime}-${f}`))})]})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsxs("p",{className:"text-gray-500 text-lg font-medium",children:["××™×Ÿ ×©×™×¢×•×¨×™× ×‘×™×•× ",Te[o]]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"× ×¡×” ×œ×‘×—×•×¨ ×™×•× ××—×¨"})]})]})},qe=Bt;function Ht(){const{user:a}=$e(),{currentSchoolYear:n}=ze(),[m,x]=w.useState(!0),[l,g]=w.useState("overview"),[o,u]=w.useState(new Date),[y,C]=w.useState({activeStudents:0,staffMembers:0,activeOrchestras:0,weeklyRehearsals:0,studentsTrend:0,activeBagruts:0,theoryLessonsThisWeek:0}),[r,j]=w.useState([]),[b,S]=w.useState([]);w.useEffect(()=>{p()},[n]);const p=async()=>{try{x(!0);const s=n?{schoolYearId:n._id}:{},[v,L,M,O,A,W]=await Promise.allSettled([F.students.getStudents(s),F.teachers.getTeachers(s),F.orchestras.getOrchestras(s),F.rehearsals.getRehearsals(s),F.theory.getTheoryLessons(s),F.bagrut.getBagruts()]),J=v.status==="fulfilled"?Array.isArray(v.value)?v.value:[]:[],Z=L.status==="fulfilled"?Array.isArray(L.value)?L.value:[]:[],se=M.status==="fulfilled"?Array.isArray(M.value)?M.value:[]:[],Y=O.status==="fulfilled"?Array.isArray(O.value)?O.value:[]:[],ee=A.status==="fulfilled"?Array.isArray(A.value)?A.value:[]:[],T=W.status==="fulfilled"?Array.isArray(W.value)?W.value:[]:[];console.log("ğŸ“Š Dashboard data loaded:",{students:J.length,teachers:Z.length,orchestras:se.length,rehearsals:Y.length,theory:ee.length,bagruts:T.length});const k=J.filter(B=>B.isActive!==!1).length,$=Z.filter(B=>B.isActive!==!1).length,N=se.filter(B=>B.isActive!==!1).length,E=new Date,h=new Date(E);h.setDate(E.getDate()-E.getDay()),h.setHours(0,0,0,0);const P=new Date(h);P.setDate(P.getDate()+7);const q=Y.filter(B=>{if(!B.date)return!1;const z=new Date(B.date);return z>=h&&z<P}).length,H=ee.filter(B=>{if(!B.date)return!1;const z=new Date(B.date);return z>=h&&z<P}).length,te=new Date(E.getFullYear(),E.getMonth(),1),U=J.filter(B=>B.createdAt&&new Date(B.createdAt)>=te).length,Q=k>0?Math.round(U/k*100):0,le=T.filter(B=>!B.isCompleted&&B.isActive!==!1).length;C({activeStudents:k,staffMembers:$,activeOrchestras:N,weeklyRehearsals:q,studentsTrend:Q,activeBagruts:le,theoryLessonsThisWeek:H});const ce=[];[...J].sort((B,z)=>new Date(z.createdAt||0).getTime()-new Date(B.createdAt||0).getTime()).slice(0,3).forEach(B=>{ce.push({type:"student",title:"×¨×™×©×•× ×ª×œ××™×“ ×—×“×©",description:`${B.personalInfo?.fullName||"×ª×œ××™×“"} × ×¨×©× ×œ×§×•× ×¡×¨×‘×˜×•×¨×™×•×Ÿ`,time:D(B.createdAt),color:"primary"})});const ae=Y.filter(B=>new Date(B.date)>=E).sort((B,z)=>new Date(B.date).getTime()-new Date(z.date).getTime()).slice(0,3);ae.forEach(B=>{ce.push({type:"rehearsal",title:"×—×–×¨×” ××ª×•×›× × ×ª",description:`${B.groupId?.name||B.orchestraName||"×ª×–××•×¨×ª"} - ${d(B.date)} ${B.startTime||""}`,time:D(B.createdAt),color:"success"})}),j(ce.slice(0,6));const fe=ae.slice(0,4).map(B=>({title:B.groupId?.name||B.orchestraName||"×—×–×¨×ª ×ª×–××•×¨×ª",date:d(B.date),description:`${B.type||"×—×–×¨×”"} - ${B.location||"××•×œ× ×¨××©×™"}`,isPrimary:!1}));S(fe),u(new Date)}catch(s){console.error("Failed to load dashboard data:",s)}finally{x(!1)}},f=()=>{p()},D=s=>{if(!s)return"×œ××—×¨×•× ×”";const v=new Date,L=new Date(s),M=v.getTime()-L.getTime(),O=Math.floor(M/6e4),A=Math.floor(M/36e5),W=Math.floor(M/864e5);return O<60?`×œ×¤× ×™ ${O} ×“×§×•×ª`:A<24?`×œ×¤× ×™ ${A} ×©×¢×•×ª`:W<7?`×œ×¤× ×™ ${W} ×™××™×`:"×”×©×‘×•×¢"},d=s=>{if(!s)return"";const v=new Date(s);return`${v.getDate()}/${v.getMonth()+1}`},t=!a||a.role==="admin"||a.roles?.includes("admin")||a.role==="×× ×”×œ"||a.roles?.includes("×× ×”×œ")?"admin":a.role==="theory-teacher"||a.roles?.includes("theory-teacher")||a.roles?.includes("theory_teacher")||a.role==="××•×¨×” ×ª×™××•×¨×™×”"||a.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")?"theory-teacher":a.role==="conductor"||a.roles?.includes("conductor")||a.role==="×× ×¦×—"||a.roles?.includes("×× ×¦×—")||a.conducting?.orchestraIds?.length>0?"conductor":a.role==="teacher"||a.roles?.includes("teacher")||a.role==="××•×¨×”"||a.roles?.includes("××•×¨×”")||a.teaching?.studentIds?.length>0?"teacher":"admin";if(t==="theory-teacher")return e.jsx(Nt,{});if(t==="conductor")return e.jsx(jt,{});if(t==="teacher")return e.jsx(bt,{});const i=[{id:"overview",label:"×¡×§×™×¨×” ×›×œ×œ×™×ª",icon:Ae},{id:"students",label:"×ª×œ××™×“×™×",icon:ue},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:K},{id:"bagrut",label:"×‘×’×¨×•×™×•×ª",icon:ge}];return e.jsxs("div",{dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"×œ×•×— ×‘×§×¨×”"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n?.name||"×©× ×ª ×œ×™××•×“×™× × ×•×›×—×™×ª"," | ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ",o.toLocaleTimeString("he-IL")]})]}),e.jsxs("button",{onClick:f,disabled:m,className:"flex items-center gap-2 px-4 py-2 text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(pt,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"×¨×¢× ×Ÿ × ×ª×•× ×™×"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg mb-6 p-1 flex overflow-x-auto",children:i.map(s=>{const v=s.icon;return e.jsxs("button",{onClick:()=>g(s.id),className:`flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${l===s.id?"bg-primary-50 text-primary-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(v,{className:"w-4 h-4"}),s.label]},s.id)})}),l==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx(ye,{title:"×ª×œ××™×“×™× ×¤×¢×™×œ×™×",value:m?"...":y.activeStudents.toString(),subtitle:"×ª×œ××™×“×™× ×¨×©×•××™×",icon:e.jsx(ue,{}),color:"blue",trend:y.studentsTrend!==0?{value:Math.abs(y.studentsTrend),label:"××”×—×•×“×© ×©×¢×‘×¨",direction:y.studentsTrend>0?"up":"down"}:void 0}),e.jsx(ye,{title:"×—×‘×¨×™ ×¡×’×œ",value:m?"...":y.staffMembers.toString(),subtitle:"××•×¨×™× ×•××“×¨×™×›×™×",icon:e.jsx(ne,{}),color:"green"}),e.jsx(ye,{title:"×”×¨×›×‘×™× ×¤×¢×™×œ×™×",value:m?"...":y.activeOrchestras.toString(),subtitle:"×ª×–××•×¨×•×ª ×•×§×‘×•×¦×•×ª",icon:e.jsx(ie,{}),color:"purple"}),e.jsx(ye,{title:"×—×–×¨×•×ª ×”×©×‘×•×¢",value:m?"...":y.weeklyRehearsals.toString(),subtitle:"××¤×’×©×™× ××ª×•×›× × ×™×",icon:e.jsx(K,{}),color:"orange"}),e.jsx(ye,{title:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”",value:m?"...":y.theoryLessonsThisWeek.toString(),subtitle:"×”×©×‘×•×¢",icon:e.jsx(oe,{}),color:"teal"}),e.jsx(ye,{title:"×‘×’×¨×•×™×•×ª ×¤×¢×™×œ×•×ª",value:m?"...":y.activeBagruts.toString(),subtitle:"×ª×œ××™×“×™× ×‘×ª×”×œ×™×š",icon:e.jsx(ge,{}),color:"amber"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(qe,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx($t,{schoolYearId:n?._id,maxItems:8}),e.jsx(Qe,{schoolYearId:n?._id})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¢×™×œ×•×ª ××—×¨×•× ×”"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"×¦×¤×” ×‘×”×›×œ"})]}),e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):r.length>0?r.map((s,v)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-2 h-2 ${s.color==="primary"?"bg-blue-500":s.color==="success"?"bg-green-500":"bg-orange-500"} rounded-full mt-2 ml-4`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("span",{className:"text-xs text-gray-500",children:s.time})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]},v)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”"})})]})}),e.jsx("div",{children:e.jsxs(G,{children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××™×¨×•×¢×™× ×§×¨×•×‘×™×"})}),e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):b.length>0?b.map((s,v)=>e.jsxs("div",{className:`p-4 rounded-lg ${s.isPrimary?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:`text-sm font-medium ${s.isPrimary?"text-primary-900":"text-gray-900"}`,children:s.title}),e.jsx("span",{className:`text-xs ${s.isPrimary?"text-primary-600":"text-gray-500"}`,children:s.date})]}),e.jsx("p",{className:`text-sm ${s.isPrimary?"text-primary-700":"text-gray-600"}`,children:s.description})]},v)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™×"})})]})})]})]}),l==="students"&&e.jsx(Tt,{schoolYearId:n?._id}),l==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(qe,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Qe,{schoolYearId:n?._id}),e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"×¡×™×›×•× ×©×‘×•×¢×™"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700",children:"×—×–×¨×•×ª ×ª×–××•×¨×ª"})]}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:y.weeklyRehearsals})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-gray-700",children:"×©×™×¢×•×¨×™ ×ª××•×¨×™×”"})]}),e.jsx("span",{className:"text-xl font-bold text-purple-600",children:y.theoryLessonsThisWeek})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-gray-700",children:"××•×¨×™× ×¤×¢×™×œ×™×"})]}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:y.staffMembers})]})]})]})]})]}),l==="bagrut"&&e.jsx(Et,{schoolYearId:n?._id})]})}export{Ht as default};
