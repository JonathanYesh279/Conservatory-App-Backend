import{j as e}from"../assets/index-BAwpfw4Y.js";import{r as h}from"./vendor-E-WBaSU9.js";import{l as R,s as F,q as B,m as A,U as _,i as X,n as E,X as z,C as M,P as G,a1 as J,k as Z}from"./ui-BeR0qYie.js";const P={0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"},ee=Object.entries(P).map(([t,s])=>({value:parseInt(t),label:s})),L=t=>P[t]||"לא ידוע",te=t=>{const s=new Date(t.date).toLocaleDateString("he-IL"),n=`${t.startTime} - ${t.endTime}`,o=L(t.dayOfWeek),l=`${o}, ${s} ${n}`;return{date:s,time:n,dayName:o,fullDateTime:l}},W=(t,s)=>{const n=I(t);return I(s)-n},I=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},V=t=>{const s=t.attendance?.present?.length||0,n=t.attendance?.absent?.length||0,o=t.orchestra?.memberIds?.length||s+n,l=o>0?Math.round(s/o*100):0;return{presentCount:s,absentCount:n,totalMembers:o,attendanceRate:l,hasAttendanceData:s>0||n>0}},se=t=>{if(!t.isActive)return{status:"cancelled",text:"בוטלה",colorClass:"bg-gray-100 text-gray-800"};const s=new Date;new Date(t.date);const n=new Date(`${t.date}T${t.startTime}:00`),o=new Date(`${t.date}T${t.endTime}:00`);return s<n?{status:"upcoming",text:"עתידה",colorClass:"bg-blue-100 text-blue-800"}:s>=n&&s<=o?{status:"in_progress",text:"מתקיימת כעת",colorClass:"bg-green-100 text-green-800"}:{status:"completed",text:"הסתיימה",colorClass:"bg-orange-100 text-orange-800"}},Y=(t,s)=>{if(t.date!==s.date)return{hasConflict:!1,conflictType:"none",severity:"none",message:""};if(t.groupId===s.groupId)return{hasConflict:!1,conflictType:"none",severity:"none",message:"אותה תזמורת"};const n=I(t.startTime),o=I(t.endTime),l=I(s.startTime),i=I(s.endTime);if(n<i&&l<o){if(t.location===s.location)return{hasConflict:!0,conflictType:"location",severity:"critical",message:`חפיפה במיקום: ${t.location}`};const p=t.orchestra?.conductor?._id,N=s.orchestra?.conductor?._id;if(p&&N&&p===N)return{hasConflict:!0,conflictType:"conductor",severity:"critical",message:"אותו מנצח בשני מקומות"};const c=new Set(t.orchestra?.memberIds||[]),y=new Set(s.orchestra?.memberIds||[]),g=[...c].filter(C=>y.has(C));return g.length>0?{hasConflict:!0,conflictType:"members",severity:"warning",message:`${g.length} חברים משותפים`}:{hasConflict:!0,conflictType:"time",severity:"warning",message:"חפיפת זמנים"}}return{hasConflict:!1,conflictType:"none",severity:"none",message:""}},de=(t,s)=>t.filter(n=>{if(s.searchQuery){const o=s.searchQuery.toLowerCase();if(!(n.orchestra?.name?.toLowerCase().includes(o)||n.location?.toLowerCase().includes(o)||n.notes?.toLowerCase().includes(o)||L(n.dayOfWeek).toLowerCase().includes(o)))return!1}if(s.orchestraId&&n.groupId!==s.orchestraId||s.type&&n.type!==s.type||s.dayOfWeek!==""&&s.dayOfWeek!==void 0&&n.dayOfWeek!==s.dayOfWeek||s.location&&n.location!==s.location)return!1;if(s.startDate){const o=new Date(n.date),l=new Date(s.startDate);if(o<l)return!1}if(s.endDate){const o=new Date(n.date),l=new Date(s.endDate);if(o>l)return!1}return!(s.status&&s.status!=="all"&&se(n).status!==s.status||s.isActive!==void 0&&n.isActive!==s.isActive)}),me=(t,s="date",n="asc")=>[...t].sort((l,i)=>{let m=0;switch(s){case"date":m=new Date(l.date).getTime()-new Date(i.date).getTime();break;case"time":m=I(l.startTime)-I(i.startTime);break;case"orchestra":const p=l.orchestra?.name||"",N=i.orchestra?.name||"";m=p.localeCompare(N,"he");break;case"location":m=l.location.localeCompare(i.location,"he");break;case"attendance":const c=V(l).attendanceRate,y=V(i).attendanceRate;m=c-y;break;case"duration":const g=W(l.startTime,l.endTime),C=W(i.startTime,i.endTime);m=g-C;break;default:m=0}return n==="desc"?-m:m}),ae=t=>{const s=[],n=new Date(t.startDate),o=new Date(t.endDate),l=t.dayOfWeek,i=new Set(t.excludeDates||[]),m=new Date(n);for(;m.getDay()!==l&&m<=o;)m.setDate(m.getDate()+1);for(;m<=o;){const p=m.toISOString().split("T")[0];i.has(p)||s.push(p),m.setDate(m.getDate()+7)}return s},re=t=>{const s={};if(t.groupId?.trim()||(s.groupId="יש לבחור תזמורת"),t.type||(s.type="יש לבחור סוג הרכב"),!t.date)s.date="יש לבחור תאריך";else{const n=new Date(t.date),o=new Date;o.setHours(0,0,0,0),n<o&&(s.date="לא ניתן לקבוע חזרה בעבר")}if(t.startTime||(s.startTime="יש להזין שעת התחלה"),t.endTime||(s.endTime="יש להזין שעת סיום"),t.startTime&&t.endTime){const n=W(t.startTime,t.endTime);n<=0?s.endTime="שעת הסיום חייבת להיות אחרי שעת ההתחלה":n>300&&(s.endTime="משך החזרה לא יכול להיות יותר מ-5 שעות")}return t.location?.trim()||(s.location="יש לבחור מיקום"),{isValid:Object.keys(s).length===0,errors:s}},ne=t=>{const s={};if(t.orchestraId?.trim()||(s.orchestraId="יש לבחור תזמורת"),t.startDate||(s.startDate="יש לבחור תאריך התחלה"),t.endDate||(s.endDate="יש לבחור תאריך סיום"),t.startDate&&t.endDate){const n=new Date(t.startDate),o=new Date(t.endDate);n>=o&&(s.endDate="תאריך הסיום חייב להיות אחרי תאריך ההתחלה"),(o.getTime()-n.getTime())/(1e3*60*60*24)>365&&(s.endDate="תקופה לא יכולה להיות יותר משנה")}return(t.dayOfWeek===void 0||t.dayOfWeek<0||t.dayOfWeek>6)&&(s.dayOfWeek="יש לבחור יום בשבוע"),t.startTime||(s.startTime="יש להזין שעת התחלה"),t.endTime||(s.endTime="יש להזין שעת סיום"),t.startTime&&t.endTime&&W(t.startTime,t.endTime)<=0&&(s.endTime="שעת הסיום חייבת להיות אחרי שעת ההתחלה"),t.location?.trim()||(s.location="יש לבחור מיקום"),{isValid:Object.keys(s).length===0,errors:s}},ue=t=>{switch(t.orchestra?.type||t.type){case"תזמורת":return"bg-blue-500";case"הרכב":return"bg-pink-500";default:return"bg-gray-500"}};function ce({newRehearsal:t,bulkData:s,existingRehearsals:n,orchestras:o,onConflictsChanged:l}){const[i,m]=h.useState([]),[p,N]=h.useState(!1);h.useEffect(()=>{t||s?c():m([])},[t,s,n]),h.useEffect(()=>{l?.(i)},[i,l]);const c=async()=>{N(!0);try{let r=[];t?r=await y(t):s&&(r=await g(s)),m(r)}catch(r){console.error("Error detecting conflicts:",r)}finally{N(!1)}},y=async r=>{const v=[],k={_id:"temp",groupId:r.groupId,type:r.type,date:r.date,dayOfWeek:new Date(r.date).getDay(),startTime:r.startTime,endTime:r.endTime,location:r.location,attendance:{present:[],absent:[]},notes:r.notes||"",schoolYearId:"current",isActive:r.isActive,orchestra:o.find(f=>f._id===r.groupId)};for(const f of n){if(f.groupId===r.groupId&&f.date===r.date)continue;const b=Y(k,f);b.hasConflict&&v.push({...b,conflictingRehearsal:f,affectedDate:r.date})}return v},g=async r=>{const v=[],k=C(r),f=o.find(b=>b._id===r.orchestraId);for(const b of k){const D={_id:"temp",groupId:r.orchestraId,type:f?.type||"תזמורת",date:b,dayOfWeek:new Date(b).getDay(),startTime:r.startTime,endTime:r.endTime,location:r.location,attendance:{present:[],absent:[]},notes:r.notes||"",schoolYearId:r.schoolYearId,isActive:!0,orchestra:f};for(const x of n){if(x.groupId===r.orchestraId&&x.date===b)continue;const O=Y(D,x);O.hasConflict&&v.push({...O,conflictingRehearsal:x,affectedDate:b})}}return v},C=r=>{const v=[],k=new Date(r.startDate),f=new Date(r.endDate),b=r.dayOfWeek,D=new Set(r.excludeDates||[]),x=new Date(k);for(;x.getDay()!==b&&x<=f;)x.setDate(x.getDate()+1);for(;x<=f;){const O=x.toISOString().split("T")[0];D.has(O)||v.push(O),x.setDate(x.getDate()+7)}return v},d=r=>{switch(r){case"critical":return e.jsx(F,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(B,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(R,{className:"w-5 h-5 text-green-600"})}},S=r=>{switch(r){case"location":return e.jsx(E,{className:"w-4 h-4"});case"conductor":return e.jsx(X,{className:"w-4 h-4"});case"members":return e.jsx(_,{className:"w-4 h-4"});case"time":return e.jsx(A,{className:"w-4 h-4"});default:return e.jsx(R,{className:"w-4 h-4"})}},$=r=>{switch(r){case"critical":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-green-50 border-green-200 text-green-800"}},j=i.filter(r=>r.severity==="critical"),w=i.filter(r=>r.severity==="warning");return p?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"בודק התנגשויות..."})]})}):i.length===0&&(t||s)?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"w-5 h-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-sm text-green-800",children:"לא נמצאו התנגשויות - ניתן ליצור את החזרה"})]})}):i.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"סיכום התנגשויות"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[j.length>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(F,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[j.length," קריטיות"]})]}),w.length>0&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(B,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[w.length," אזהרות"]})]})]})]}),j.length>0&&e.jsx("p",{className:"text-sm text-red-800",children:"נמצאו התנגשויות קריטיות שמונעות יצירת החזרה. יש לפתור אותן לפני המשך."}),w.length>0&&j.length===0&&e.jsx("p",{className:"text-sm text-yellow-800",children:"נמצאו אזהרות שכדאי לבדוק. ניתן להמשיך ביצירת החזרה אך מומלץ לוודא."})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:i.map((r,v)=>e.jsx("div",{className:`border rounded-lg p-3 ${$(r.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-2",children:[d(r.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[S(r.conflictType),e.jsx("span",{className:"font-medium text-sm",children:r.message})]}),r.conflictingRehearsal&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:r.conflictingRehearsal.orchestra?.name}),e.jsx("span",{children:te(r.conflictingRehearsal).fullDateTime}),e.jsx("span",{children:r.conflictingRehearsal.location})]})}),r.affectedDate&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["תאריך מתנגש: ",new Date(r.affectedDate).toLocaleDateString("he-IL")]})]})]})})},v))}),j.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"פעולות מומלצות לפתרון:"}),e.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[j.some(r=>r.conflictType==="location")&&e.jsx("li",{children:"שנה את מיקום החזרה או בחר זמן אחר"}),j.some(r=>r.conflictType==="conductor")&&e.jsx("li",{children:"תאם עם המנצח או שנה את זמן החזרה"}),j.some(r=>r.conflictType==="time")&&e.jsx("li",{children:"בחר זמן אחר או תאריך אחר"})]})]})]})}function xe({orchestras:t,existingRehearsals:s=[],onSubmit:n,onCancel:o,initialData:l}){const[i,m]=h.useState("single"),[p,N]=h.useState(!1),[c,y]=h.useState({}),[g,C]=h.useState({groupId:"",type:"תזמורת",date:"",startTime:"19:00",endTime:"21:00",location:"",notes:"",isActive:!0,...l}),[d,S]=h.useState({orchestraId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"19:00",endTime:"21:00",location:"",notes:"",excludeDates:[],schoolYearId:"current"}),[$,j]=h.useState(""),[w,r]=h.useState([]),[v,k]=h.useState(!1),[f,b]=h.useState(!1);h.useEffect(()=>{if(i==="single"&&g.groupId){const a=t.find(u=>u._id===g.groupId);a&&!g.location&&C(u=>({...u,location:a.location,type:a.type}))}},[g.groupId,t,i]),h.useEffect(()=>{if(i==="bulk"&&d.orchestraId){const a=t.find(u=>u._id===d.orchestraId);a&&!d.location&&S(u=>({...u,location:a.location}))}},[d.orchestraId,t,i]),h.useEffect(()=>{if(i==="bulk"&&d.startDate&&d.endDate&&d.dayOfWeek!==void 0)try{const a=ae(d);r(a)}catch{r([])}else r([])},[i,d.startDate,d.endDate,d.dayOfWeek,d.excludeDates]);const D=(a,u)=>{C(T=>({...T,[a]:u})),c[a]&&y(T=>({...T,[a]:""}))},x=(a,u)=>{S(T=>({...T,[a]:u})),c[a]&&y(T=>({...T,[a]:""}))},O=()=>{$&&(S(a=>({...a,excludeDates:[...a.excludeDates||[],$]})),j(""))},H=a=>{S(u=>({...u,excludeDates:(u.excludeDates||[]).filter(T=>T!==a)}))},U=a=>{k(a.length>0),b(a.some(u=>u.severity==="critical"))},q=async a=>{a.preventDefault(),N(!0),y({});try{if(f){y({submit:"יש לפתור התנגשויות קריטיות לפני יצירת החזרה"});return}if(i==="single"){const u=re(g);if(!u.isValid){y(u.errors);return}const K=new Date(g.date).getDay(),Q={...g,dayOfWeek:K};await n(Q,!1)}else{const u=ne(d);if(!u.isValid){y(u.errors);return}await n(d,!0)}}catch(u){y({submit:u.message||"שגיאה בשמירת החזרה"})}finally{N(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:o,children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"ערוך חזרה":"חזרה חדשה"}),!l&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>m("single"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${i==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"חזרה יחידה"}),e.jsx("button",{type:"button",onClick:()=>m("bulk"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${i==="bulk"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"חזרות חוזרות"})]})})]}),e.jsx("div",{className:"w-8"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[i==="single"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(_,{className:"w-4 h-4 inline ml-1"}),"תזמורת"]}),e.jsxs("select",{value:g.groupId||"",onChange:a=>D("groupId",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.groupId?"border-red-300":"border-gray-300"}`,disabled:!!l,children:[e.jsx("option",{value:"",children:"בחר תזמורת"}),t.map(a=>e.jsxs("option",{value:a._id,children:[a.name," (",a.type,")"]},a._id))]}),c.groupId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.groupId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(M,{className:"w-4 h-4 inline ml-1"}),"תאריך"]}),e.jsx("input",{type:"date",value:g.date||"",onChange:a=>D("date",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.date?"border-red-300":"border-gray-300"}`}),c.date&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(A,{className:"w-4 h-4 inline ml-1"}),"שעת התחלה"]}),e.jsx("input",{type:"time",value:g.startTime||"",onChange:a=>D("startTime",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.startTime?"border-red-300":"border-gray-300"}`}),c.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שעת סיום"}),e.jsx("input",{type:"time",value:g.endTime||"",onChange:a=>D("endTime",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.endTime?"border-red-300":"border-gray-300"}`}),c.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(E,{className:"w-4 h-4 inline ml-1"}),"מיקום"]}),e.jsx("input",{type:"text",value:g.location||"",onChange:a=>D("location",a.target.value),placeholder:"כגון: אולם ערן, סטודיו קאמרי 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.location?"border-red-300":"border-gray-300"}`}),c.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות"}),e.jsx("textarea",{value:g.notes||"",onChange:a=>D("notes",a.target.value),rows:3,placeholder:"הערות נוספות עבור החזרה...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(_,{className:"w-4 h-4 inline ml-1"}),"תזמורת"]}),e.jsxs("select",{value:d.orchestraId||"",onChange:a=>x("orchestraId",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.orchestraId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"בחר תזמורת"}),t.map(a=>e.jsxs("option",{value:a._id,children:[a.name," (",a.type,")"]},a._id))]}),c.orchestraId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.orchestraId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(M,{className:"w-4 h-4 inline ml-1"}),"תאריך התחלה"]}),e.jsx("input",{type:"date",value:d.startDate||"",onChange:a=>x("startDate",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.startDate?"border-red-300":"border-gray-300"}`}),c.startDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך סיום"}),e.jsx("input",{type:"date",value:d.endDate||"",onChange:a=>x("endDate",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.endDate?"border-red-300":"border-gray-300"}`}),c.endDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.endDate})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יום בשבוע"}),e.jsx("select",{value:d.dayOfWeek||0,onChange:a=>x("dayOfWeek",parseInt(a.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.dayOfWeek?"border-red-300":"border-gray-300"}`,children:ee.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),c.dayOfWeek&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.dayOfWeek})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(A,{className:"w-4 h-4 inline ml-1"}),"שעת התחלה"]}),e.jsx("input",{type:"time",value:d.startTime||"",onChange:a=>x("startTime",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.startTime?"border-red-300":"border-gray-300"}`}),c.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שעת סיום"}),e.jsx("input",{type:"time",value:d.endTime||"",onChange:a=>x("endTime",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.endTime?"border-red-300":"border-gray-300"}`}),c.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(E,{className:"w-4 h-4 inline ml-1"}),"מיקום"]}),e.jsx("input",{type:"text",value:d.location||"",onChange:a=>x("location",a.target.value),placeholder:"כגון: אולם ערן, סטודיו קאמרי 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${c.location?"border-red-300":"border-gray-300"}`}),c.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:c.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריכים לדילוג"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:$,onChange:a=>j(a.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"בחר תאריך לדילוג"}),e.jsx("button",{type:"button",onClick:O,disabled:!$,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})]}),d.excludeDates&&d.excludeDates.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:d.excludeDates.map(a=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg px-2 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:new Date(a).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",onClick:()=>H(a),className:"mr-1 text-gray-500 hover:text-red-600",children:e.jsx(J,{className:"w-3 h-3"})})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות"}),e.jsx("textarea",{value:d.notes||"",onChange:a=>x("notes",a.target.value),rows:3,placeholder:"הערות נוספות עבור כל החזרות...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),w.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-600 ml-1"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["תיווצרו ",w.length," חזרות"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 max-h-32 overflow-y-auto",children:[w.slice(0,10).map(a=>e.jsxs("div",{children:[new Date(a).toLocaleDateString("he-IL")," - ",L(new Date(a).getDay())]},a)),w.length>10&&e.jsxs("div",{className:"text-blue-600",children:["...ועוד ",w.length-10]})]})]})]}),e.jsx(ce,{newRehearsal:i==="single"?g:null,bulkData:i==="bulk"?d:null,existingRehearsals:s,orchestras:t,onConflictsChanged:U}),c.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:c.submit})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"ביטול"}),e.jsx("button",{type:"submit",disabled:p||f,className:`px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors ${p||f?"opacity-50 cursor-not-allowed":""}`,children:p?"שומר...":l?"עדכן חזרה":i==="single"?"צור חזרה":`צור ${w.length} חזרות`})]})]})]})})})}export{ee as D,xe as R,P as V,L as a,se as b,V as c,de as d,te as f,ue as g,me as s};
