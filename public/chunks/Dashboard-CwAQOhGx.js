import{u as we,j as e,a as Pe}from"../assets/index-DVeVEBC0.js";import{r as c,b as ke}from"./vendor-B2j9q2e_.js";import{S as be}from"./StatsCard-DbPIK-rY.js";import{C as pe}from"./Card-D0qKSY5p.js";import{a as B}from"./cascade-deletion-DAN0Gkem.js";import{v as xe,M as he,f as ue,w as Oe,x as Me,G as Z,y as Ce,b as ee,s as le,z as _e,p as Te,D as oe,V as Ge,e as Ue,E as He,I as We,J as Qe,K as $e,A as ze,X as qe,d as ve,P as Ae,B as me,N as Fe,O as Ye,r as Ve,o as Je,Q as Ke,q as Le,W as Xe,Y as Re}from"./ui-ypR0-hKN.js";import{T as Ze}from"./teacherDetailsApi-BGs4ypj_.js";import"./query-BI61muSV.js";import"./utils-x1PSU_OZ.js";function et(){const{user:n}=we(),[d,u]=c.useState({totalOrchestras:0,activeMusicians:0,upcomingRehearsals:0,completedConcerts:0,totalMembers:0,weeklyRehearsals:0,bagrutMembers:0,activeBagrutStudents:0}),[j,m]=c.useState([]),[$,I]=c.useState([]),[z,q]=c.useState([]),[R,G]=c.useState([]),[F,W]=c.useState(!0),[Y,U]=c.useState(null);c.useEffect(()=>{n?._id&&x()},[n]);const x=async()=>{try{W(!0),U(null);const t=n._id,[b]=await Promise.all([B.teachers.getTeacher(t)]);if(!b)throw new Error("לא נמצא פרופיל מנצח");const w=b?.conducting?.orchestraIds||[];let p=[],C=0,k=[];if(w.length>0){p=await B.orchestras.getBatchOrchestras(w),C=p.reduce((o,a)=>o+(a.memberCount||0),0);try{const o=await B.rehearsals.getRehearsals({groupIds:w.join(","),limit:100});k=Array.isArray(o)?o:[]}catch(o){console.warn("Error loading rehearsals:",o),k=[]}}const _=new Date,E=new Date(_.getTime()+7*24*60*60*1e3),V=k.filter(o=>{const a=new Date(o.scheduledDate);return a>=_&&a<=E}).slice(0,5).map(o=>{const a=p.find(h=>h._id===o.groupId);return{id:o._id,orchestraName:a?.name||"תזמורת",date:new Date(o.scheduledDate).toLocaleDateString("he-IL"),time:o.startTime||"19:00",location:o.location||"אולם מוזיקה",attendanceRate:Math.floor(Math.random()*20)+80,duration:120,status:"scheduled"}});m(V);const J=k.filter(o=>{const a=new Date(o.scheduledDate),h=new Date(_);h.setDate(_.getDate()-_.getDay());const s=new Date(h);return s.setDate(h.getDate()+6),a>=h&&a<=s}).length;let P=[],te=0,se=0;if(p.length>0){const o=p.flatMap(a=>a?.members?.map(h=>h.studentId)||[]);if(o.length>0)try{const[a,h]=await Promise.all([Promise.all(o.map(s=>B.bagrut.getBagrutByStudent(s).catch(()=>null))).then(s=>s.filter(Boolean)),B.students.getBatchStudents(o)]);P=o.map(s=>{const y=h.find(L=>L._id===s),M=a.find(L=>L.studentId===s),S=p.flatMap(L=>L.members||[]).find(L=>L.studentId===s),Q=p.find(L=>L.members?.some(X=>X.studentId===s));let D="none",T,ae,ge;if(M){const L=M.presentations?.filter(X=>X.completed).length||0;if(T=L+1,ae=L/4*100,M.isCompleted&&M.finalGrade&&M.finalGrade>=55?D="completed":M.isCompleted&&M.finalGrade&&M.finalGrade<55?D="none":L===0?D="pending":D="active",D==="active"){const X=new Date,fe=Math.floor(Math.random()*30)+7;ge=new Date(X),ge.setDate(X.getDate()+fe)}}return{studentId:s,studentName:y?.personalInfo?.fullName||"תלמיד לא ידוע",instrument:S?.instrument||y?.academicInfo?.primaryInstrument||"לא צוין",section:S?.section||"לא צוין",bagrutStatus:D,stage:T,progress:ae,nextExamDate:ge,orchestraName:Q?.name||"תזמורת"}}),te=P.filter(s=>s.bagrutStatus!=="none").length,se=P.filter(s=>s.bagrutStatus==="active").length}catch(a){console.warn("Error loading Bagrut data:",a)}}G(P);const O={totalOrchestras:p.length,activeMusicians:C,upcomingRehearsals:V.length,completedConcerts:Math.floor(Math.random()*5)+2,totalMembers:C,weeklyRehearsals:J,bagrutMembers:te,activeBagrutStudents:se};u(O);const K=p.map(o=>{const a=k.filter(s=>s.groupId===o._id),h=Math.floor(Math.random()*20)+80;return{orchestraId:o._id,orchestraName:o.name,totalRehearsals:a.length,averageAttendance:h,upcomingConcerts:Math.floor(Math.random()*3)+1,lastRehearsal:a.length>0?new Date(a[a.length-1].scheduledDate).toLocaleDateString("he-IL"):"אין נתונים",status:h>=90?"excellent":h>=75?"good":"needs_attention"}});q(K);const l=[];k.slice(0,3).forEach(o=>{const a=p.find(h=>h._id===o.groupId);l.push({id:`rehearsal-${o._id}`,type:"rehearsal",title:"חזרה הושלמה",description:`חזרה של ${a?.name||"תזמורת"} - ${o.location||"אולם מוזיקה"}`,timestamp:new Date(Date.now()-Math.random()*864e5).toISOString(),orchestraName:a?.name})}),p.slice(0,2).forEach(o=>{l.push({id:`enrollment-${o._id}`,type:"enrollment",title:"רישום חדש",description:`תלמיד חדש הצטרף ל${o.name}`,timestamp:new Date(Date.now()-Math.random()*1728e5).toISOString(),orchestraName:o.name})}),I(l.sort((o,a)=>new Date(a.timestamp).getTime()-new Date(o.timestamp).getTime()))}catch(t){console.error("Error loading conductor dashboard data:",t),U("שגיאה בטעינת נתוני לוח הבקרה")}finally{W(!1)}},N=ke(),A=t=>{switch(t){case"scheduleRehearsal":N("/profile",{state:{activeTab:"orchestras"}});break;case"markAttendance":N("/profile",{state:{activeTab:"orchestras"}});break;case"manageOrchestras":N("/profile",{state:{activeTab:"orchestras"}});break;case"viewMusicians":N("/profile",{state:{activeTab:"orchestras"}});break;default:console.log("Action:",t)}},r=t=>{const b=new Date(t),p=new Date().getTime()-b.getTime(),C=Math.floor(p/(1e3*60*60));return C<1?`לפני ${Math.floor(p/6e4)} דקות`:C<24?`לפני ${C} שעות`:`לפני ${Math.floor(C/24)} ימים`};return F?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"טוען לוח בקרה למנצח..."})]})}):Y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:Y}),e.jsx("button",{onClick:x,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"נסה שוב"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["שלום מנצח ",n?.firstName||"יקר"," 🎼"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8",children:[e.jsx(ce,{icon:e.jsx(he,{className:"w-6 h-6"}),title:"סה״כ תזמורות",value:d.totalOrchestras,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(ce,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"מוזיקאים פעילים",value:d.activeMusicians,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(ce,{icon:e.jsx(Oe,{className:"w-6 h-6"}),title:"חזרות השבוע",value:d.weeklyRehearsals,bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(ce,{icon:e.jsx(Me,{className:"w-6 h-6"}),title:"קונצרטים השנה",value:d.completedConcerts,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(ce,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"חברי בגרות",value:d.bagrutMembers,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(ce,{icon:e.jsx(Ce,{className:"w-6 h-6"}),title:"בגרות פעילה",value:d.activeBagrutStudents,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"פעולות מהירות"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ye,{icon:e.jsx(ee,{className:"w-5 h-5"}),label:"קבע חזרה",onClick:()=>A("scheduleRehearsal"),color:"indigo"}),e.jsx(ye,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"סמן נוכחות",onClick:()=>A("markAttendance"),color:"green"}),e.jsx(ye,{icon:e.jsx(_e,{className:"w-5 h-5"}),label:"נהל תזמורות",onClick:()=>A("manageOrchestras"),color:"blue"}),e.jsx(ye,{icon:e.jsx(Te,{className:"w-5 h-5"}),label:"צפה במוזיקאים",onClick:()=>A("viewMusicians"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"החזרות הקרובות"}),e.jsxs("button",{onClick:()=>N("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["צפה בכל",e.jsx(oe,{className:"w-4 h-4"})]})]}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין חזרות מתוכננות השבוע"})]}):e.jsx("div",{className:"space-y-3",children:j.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Ge,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-3 h-3"}),t.location]}),t.attendanceRate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["נוכחות ממוצעת: ",t.attendanceRate,"%"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.date}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(He,{className:"w-3 h-3 inline mr-1"}),t.duration," דקות"]})]})]},t.id))})]}),R.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"חברי תזמורת עם בגרות"}),e.jsx(Z,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:R.filter(t=>t.bagrutStatus==="active").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"בגרות פעילה"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:R.filter(t=>t.bagrutStatus==="completed").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"הושלמה"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:R.filter(t=>t.bagrutStatus==="pending").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ממתינים"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-600",children:R.filter(t=>t.bagrutStatus==="none").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ללא בגרות"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"תלמידי בגרות פעילים"}),R.filter(t=>t.bagrutStatus==="active").slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.instrument," • ",t.section," • ",t.orchestraName]})]})]}),e.jsxs("div",{className:"text-right",children:[t.stage&&e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:["השמעה ",t.stage,"/4"]}),t.progress!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(t.progress),"%"]})]}),t.nextExamDate&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["מבחן הבא: ",t.nextExamDate.toLocaleDateString("he-IL")]}),e.jsx("button",{className:"mt-2 p-1 text-gray-400 hover:text-blue-600",children:e.jsx(We,{className:"w-4 h-4"})})]})]},t.studentId)),R.filter(t=>t.bagrutStatus==="active").length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/teacher/bagrut",className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:["צפה בכל תלמידי הבגרות (",R.filter(t=>t.bagrutStatus==="active").length,")"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"ביצועי תזמורות"}),e.jsxs("button",{onClick:()=>N("/profile",{state:{activeTab:"orchestras"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["דוח מפורט",e.jsx(oe,{className:"w-4 h-4"})]})]}),z.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין נתוני ביצועים"})]}):e.jsx("div",{className:"space-y-3",children:z.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="excellent"?"bg-green-500":t.status==="good"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:t.orchestraName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.totalRehearsals," חזרות השנה • חזרה אחרונה: ",t.lastRehearsal]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:`font-medium ${t.averageAttendance>=90?"text-green-600":t.averageAttendance>=75?"text-yellow-600":"text-red-600"}`,children:[t.averageAttendance,"%"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"נוכחות ממוצעת"})]})]},t.orchestraId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"פעילות אחרונה"}),e.jsx($e,{className:"w-5 h-5 text-gray-400"})]}),$.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין פעילות לאחרונה"})]}):e.jsx("div",{className:"space-y-4",children:$.map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${t.type==="rehearsal"?"bg-blue-100":t.type==="enrollment"?"bg-green-100":t.type==="performance"?"bg-purple-100":"bg-yellow-100"}`,children:[t.type==="rehearsal"&&e.jsx(he,{className:"w-4 h-4 text-blue-600"}),t.type==="enrollment"&&e.jsx(Te,{className:"w-4 h-4 text-green-600"}),t.type==="performance"&&e.jsx(Me,{className:"w-4 h-4 text-purple-600"}),t.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-yellow-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:t.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:r(t.timestamp)})]})]},t.id))})]})]})]})})}function ce({icon:n,title:d,value:u,suffix:j,bgColor:m,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${m} border ${I} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:d}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[u," ",j&&e.jsx("span",{className:"text-lg font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function ye({icon:n,label:d,onClick:u,color:j}){const m={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:u,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${m[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan",children:d})]})}function tt(){const{user:n}=we(),d=ke(),[u,j]=c.useState({totalStudents:0,todaysLessons:0,weeklyHours:0,activeBagrutStudents:0}),[m,$]=c.useState([]),[I,z]=c.useState([]),[q,R]=c.useState([]),[G,F]=c.useState([]),[W,Y]=c.useState(!0),[U,x]=c.useState(null);c.useState(!1),c.useState(!1),c.useState(!1);const[N,A]=c.useState([]),[r,t]=c.useState([]),[b,w]=c.useState(null),[p,C]=c.useState([]),[k,_]=c.useState([]),[E,V]=c.useState([]),[J,P]=c.useState({days:[]});c.useEffect(()=>{n?._id&&te()},[n]),c.useEffect(()=>{n?._id&&E.length>=0&&K()},[n,E]),c.useEffect(()=>{if(b){const s=setTimeout(()=>w(null),4e3);return()=>clearTimeout(s)}},[b]);const te=()=>{const s=n?.roles||[],y=n?.role,M=n?.allRoles||[];let S=[...s];y&&!S.includes(y)&&S.push(y),S=[...new Set([...S,...M])];const Q=S.map(D=>{const T=D?.toLowerCase();return T==="conductor"||T==="מנצח"?"conductor":T==="theory-teacher"||T==="מורה תיאוריה"||T==="theory teacher"?"theory-teacher":T==="teacher"||T==="מורה"?"teacher":D});V([...new Set(Q)])},se=async s=>{try{const y=await Ze.getTransformedWeeklySchedule(s);if(y)return P(y),y}catch(y){console.log("Error loading weekly schedule:",y)}return O()},O=()=>({days:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"].map(y=>({dayName:y,lessons:[]}))}),K=async()=>{try{Y(!0),x(null);const s=n._id,[y,M]=await Promise.all([B.teachers.getMyProfile(),se(s)]);if(!y)throw new Error("לא נמצא פרופיל מורה");console.log("Teacher profile loaded:",{name:y?.personalInfo?.fullName,studentIds:y?.teaching?.studentIds,studentCount:y?.teaching?.studentIds?.length||0,timeBlocks:y?.teaching?.timeBlocks?.length||0});const S=y?.teaching?.studentIds||[],Q=y?.teaching?.timeBlocks||[];A(Q);let D=[];if(S.length>0){console.log("🎯 Teacher assigned student IDs:",S);const i=await B.students.getBatchStudents(S);if(console.log(`📊 API returned ${i.length} students for ${S.length} requested IDs`),D=i.filter(v=>{const f=v._id||v.id,g=S.includes(f);return!g&&i.length>S.length&&console.log(`⚠️ Filtering out unassigned student: ${f}`),g}),console.log(`✅ Showing ${D.length} assigned students (filtered from ${i.length})`),D.length<S.length){const v=D.map(g=>g._id||g.id),f=S.filter(g=>!v.includes(g));console.warn("⚠️ Missing students:",f)}}else console.log("No student IDs found in teacher profile");t(D);const T=new Date,ae=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][T.getDay()],ge=M.days.find(i=>i.dayName===ae)?.lessons.filter(i=>i.lessonType!=="availability").length||0,L=M.days.reduce((i,v)=>i+v.lessons.filter(f=>f.lessonType!=="availability").reduce((f,g)=>{const Se=new Date(`2000-01-01T${g.startTime}`),ne=new Date(`2000-01-01T${g.endTime}`);return f+(ne.getTime()-Se.getTime())/(1e3*60*60)},0),0);let X=[];if(E.includes("conductor"))try{const v=(await B.orchestras.getOrchestras()).filter(f=>f.conductorId===s);C(v),console.log(`🎼 Loaded ${v.length} orchestras for conductor`)}catch(i){console.log("Error loading orchestras:",i)}if(E.includes("theory-teacher"))try{const i=await B.theory.getTheoryLessons({teacherId:s});_(i||[]),console.log(`📚 Loaded ${i?.length||0} theory lessons`)}catch(i){console.log("Error loading theory lessons:",i)}const fe=X.map(i=>{const v=r.find(ie=>ie._id===i.studentId),f=i.presentations?.filter(ie=>ie.completed).length||0,g=4,Se=f/g*100;let ne="active";i.isCompleted&&i.finalGrade&&i.finalGrade>=55?ne="completed":i.isCompleted&&i.finalGrade&&i.finalGrade<55?ne="failed":f===0&&(ne="pending");let De;if(ne==="active"&&f<4){const ie=new Date,Be=Math.floor(Math.random()*30)+7;De=new Date(ie),De.setDate(ie.getDate()+Be)}return{studentId:i.studentId,studentName:v?.personalInfo?.fullName||"תלמיד לא ידוע",instrument:v?.academicInfo?.primaryInstrument||"לא צוין",stage:f+1,progress:Se,nextExamDate:De,status:ne,finalGrade:i.finalGrade,completedPresentations:f,totalPresentations:g,bagrutId:i._id}});F(fe);const Ee=fe.filter(i=>i.status==="active").length;j({totalStudents:D.length,todaysLessons:ge,weeklyHours:Math.round(L*10)/10,activeBagrutStudents:Ee});let re=[];const Ie=M.days.find(i=>i.dayName===ae);if(Ie){const i=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}`;re=Ie.lessons.filter(f=>f.lessonType!=="availability"&&f.startTime>=i).slice(0,5).map(f=>({id:f.id,studentName:f.studentName||"תלמיד",time:f.startTime,instrument:f.instrument||"",duration:parseInt(f.notes?.match(/\d+/)?.[0]||"60"),type:f.lessonType}))}if(re.length===0&&y?.teaching?.schedule){const i=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}`;re=y.teaching.schedule.filter(g=>g.day===ae).filter(g=>g.startTime>=i).slice(0,5).map(g=>({id:g._id||`lesson-${g.studentId}`,studentName:g.studentName||"תלמיד",time:g.startTime,instrument:g.instrument||"",duration:g.duration||60,type:"individual"}))}if(re.length===0&&D.length>0){const i=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}`;D.forEach(v=>{(v.teacherAssignments?.filter(g=>g.teacherId===n._id&&g.day===ae)||[]).forEach(g=>{g.time&&g.time>=i&&re.push({id:`${v._id}-${g.time}`,studentName:v.personalInfo?.fullName||"תלמיד",time:g.time,instrument:v.academicInfo?.primaryInstrument||g.instrument||"כלי מוזיקה",duration:g.duration||60,type:"individual"})})}),re.sort((v,f)=>v.time.localeCompare(f.time))}$(re.slice(0,5)),z([]),R([])}catch(s){console.error("Error loading dashboard data:",s),x("שגיאה בטעינת נתוני לוח הבקרה")}finally{Y(!1)}},l=s=>{switch(console.log("handleQuickAction called with:",s),console.log("Teacher time blocks:",N),s){case"addLesson":d("/profile?tab=students&action=addStudent");break;case"markAttendance":d("/profile?tab=attendance");break;case"viewSchedule":d("/profile?tab=schedule");break;case"manageStudents":d("/profile?tab=students");break;case"manageTeachingDays":d("/profile?tab=schedule");break;case"viewOrchestras":d("/profile?tab=orchestras");break;case"viewTheoryLessons":d("/profile?tab=lessons");break;case"addOrchestra":d("/orchestras/new");break;case"addTheoryLesson":d("/theory/new");break;case"manageBagrut":window.location.href="/teacher/bagrut";break;case"scheduleBagrutExam":window.location.href="/teacher/bagrut/schedule";break;case"viewBagrutProgress":window.location.href="/teacher/bagrut/progress";break;case"updateBagrutStatus":window.location.href="/teacher/bagrut/update";break;default:console.log("Action:",s)}},o=s=>{switch(s){case"completed":return"text-green-600 bg-green-50";case"active":return"text-blue-600 bg-blue-50";case"pending":return"text-yellow-600 bg-yellow-50";case"failed":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},a=s=>{switch(s){case"completed":return"הושלם";case"active":return"פעיל";case"pending":return"ממתין";case"failed":return"נכשל";default:return"לא ידוע"}},h=s=>{const y=new Date(s),S=new Date().getTime()-y.getTime(),Q=Math.floor(S/(1e3*60*60));return Q<1?`לפני ${Math.floor(S/6e4)} דקות`:Q<24?`לפני ${Q} שעות`:`לפני ${Math.floor(Q/24)} ימים`};return W?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"טוען לוח בקרה..."})]})}):U?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:U}),e.jsx("button",{onClick:K,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"נסה שוב"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[b&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${b.type==="success"?"bg-green-100 border border-green-200 text-green-800":"bg-red-100 border border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[b.type==="success"?e.jsx(le,{className:"w-5 h-5"}):e.jsx(ze,{className:"w-5 h-5"}),e.jsx("span",{className:"font-reisinger-yonatan",children:b.message}),e.jsx("button",{onClick:()=>w(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(qe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:["לוח בקרה - ",n?.personalInfo?.fullName||n?.fullName||"מורה"]})}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["שלום ",n?.firstName||"מורה"," • ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(je,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"סה״כ תלמידים",value:u.totalStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(je,{icon:e.jsx(ee,{className:"w-6 h-6"}),title:"שיעורים היום",value:u.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(je,{icon:e.jsx(ve,{className:"w-6 h-6"}),title:"שעות השבוע",value:u.weeklyHours,suffix:"שעות",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(je,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"תלמידי בגרות פעילים",value:u.activeBagrutStudents,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"פעולות מהירות"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(H,{icon:e.jsx(Ae,{className:"w-5 h-5"}),label:"הוסף שיעור",onClick:()=>l("addLesson"),color:"indigo"}),e.jsx(H,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"סמן נוכחות",onClick:()=>l("markAttendance"),color:"green"}),e.jsx(H,{icon:e.jsx(ee,{className:"w-5 h-5"}),label:"צפה בלו״ז",onClick:()=>l("viewSchedule"),color:"blue"}),e.jsx(H,{icon:e.jsx(Te,{className:"w-5 h-5"}),label:"ניהול תלמידים",onClick:()=>l("manageStudents"),color:"purple"}),E.includes("teacher")&&e.jsx(H,{icon:e.jsx(ve,{className:"w-5 h-5"}),label:"ימי לימוד",onClick:()=>l("manageTeachingDays"),color:"orange"}),E.includes("conductor")&&e.jsx(H,{icon:e.jsx(he,{className:"w-5 h-5"}),label:"התזמורות שלי",onClick:()=>l("viewOrchestras"),color:"rose"}),E.includes("theory-teacher")&&e.jsx(H,{icon:e.jsx(me,{className:"w-5 h-5"}),label:"שיעורי תיאוריה",onClick:()=>l("viewTheoryLessons"),color:"amber"}),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:e.jsx(Z,{className:"w-5 h-5"}),label:"ניהול בגרות",onClick:()=>l("manageBagrut"),color:"emerald"}),e.jsx(H,{icon:e.jsx(Fe,{className:"w-5 h-5"}),label:"תזמון מבחן",onClick:()=>l("scheduleBagrutExam"),color:"orange"}),e.jsx(H,{icon:e.jsx(Ce,{className:"w-5 h-5"}),label:"מעקב התקדמות",onClick:()=>l("viewBagrutProgress"),color:"cyan"}),e.jsx(H,{icon:e.jsx(Ye,{className:"w-5 h-5"}),label:"עדכון סטטוס",onClick:()=>l("updateBagrutStatus"),color:"pink"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"השיעורים הבאים"}),e.jsxs("button",{onClick:()=>l("viewSchedule"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["צפה בכל",e.jsx(oe,{className:"w-4 h-4"})]})]}),m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין שיעורים מתוכננים היום"})]}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:s.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:s.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.duration," דקות • ",s.type==="individual"?"פרטני":"קבוצתי"]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"סקירת נוכחות"}),e.jsxs("button",{onClick:()=>l("manageStudents"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["צפה בכל",e.jsx(oe,{className:"w-4 h-4"})]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין נתוני נוכחות"})]}):e.jsx("div",{className:"space-y-3",children:q.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="present"?"bg-green-500":s.status==="late"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:s.studentName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["שיעור אחרון: ",s.lastLesson]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-medium ${s.attendanceRate>=90?"text-green-600":s.attendanceRate>=75?"text-yellow-600":"text-red-600"}`,children:[s.attendanceRate,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"נוכחות"})]})]},s.studentId))})]}),G.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"התקדמות תלמידי בגרות"}),e.jsxs("button",{onClick:()=>l("manageBagrut"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1 mx-auto",children:["צפה בכל תלמידי הבגרות (",G.length,")",e.jsx(oe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:G.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:s.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:s.instrument})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${o(s.status)}`,children:a(s.status)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.progress>=75?"bg-green-500":s.progress>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(s.progress),"%"]})]})]})]},s.studentId))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"פעילות אחרונה"}),e.jsx($e,{className:"w-5 h-5 text-gray-400"})]}),I.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין פעילות לאחרונה"})]}):e.jsx("div",{className:"space-y-4",children:I.map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.type==="lesson"?"bg-blue-100":s.type==="attendance"?"bg-green-100":s.type==="note"?"bg-yellow-100":"bg-purple-100"}`,children:[s.type==="lesson"&&e.jsx(me,{className:"w-4 h-4 text-blue-600"}),s.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-green-600"}),s.type==="note"&&e.jsx(Ve,{className:"w-4 h-4 text-yellow-600"}),s.type==="grade"&&e.jsx(Je,{className:"w-4 h-4 text-purple-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:s.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:h(s.timestamp)})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"נתונים מהירים"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"תלמידים פעילים"}),e.jsx("span",{className:"font-bold text-indigo-600",children:r.filter(s=>s.academicInfo?.isActive!==!1).length})]}),E.includes("conductor")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"תזמורות"}),e.jsx("span",{className:"font-bold text-purple-600",children:p.length})]}),E.includes("theory-teacher")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"שיעורי תיאוריה"}),e.jsx("span",{className:"font-bold text-blue-600",children:k.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"שעות השבוע"}),e.jsxs("span",{className:"font-bold text-green-600",children:[u.weeklyHours," שעות"]})]})]})]})]})]})]})})}function je({icon:n,title:d,value:u,suffix:j,bgColor:m,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${m} border ${I} rounded-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:d}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[u," ",j&&e.jsx("span",{className:"text-lg font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function H({icon:n,label:d,onClick:u,color:j}){const m={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100 border-orange-200",rose:"bg-rose-50 text-rose-600 hover:bg-rose-100 border-rose-200",amber:"bg-amber-50 text-amber-600 hover:bg-amber-100 border-amber-200",emerald:"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border-emerald-200",cyan:"bg-cyan-50 text-cyan-600 hover:bg-cyan-100 border-cyan-200",pink:"bg-pink-50 text-pink-600 hover:bg-pink-100 border-pink-200"};return e.jsxs("button",{onClick:u,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${m[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:d})]})}function st(){const{user:n}=we(),[d,u]=c.useState({totalTheoryStudents:0,todaysLessons:0,weeklyTheoryHours:0,upcomingExams:0,activeTheoryGroups:0,pendingGrades:0}),[j,m]=c.useState([]),[$,I]=c.useState([]),[z,q]=c.useState([]),[R,G]=c.useState(!0),[F,W]=c.useState(null);c.useEffect(()=>{n?._id&&Y()},[n]);const Y=async()=>{try{G(!0),W(null);const r=n._id,b=(await B.theory.getTheoryLessons()).filter(a=>a.teacherId===r),w=new Date,p=w.toISOString().split("T")[0],C=b.filter(a=>new Date(a.date).toISOString().split("T")[0]===p),k=U(new Date),_=new Date(k);_.setDate(k.getDate()+7);const V=b.filter(a=>{const h=new Date(a.date);return h>=k&&h<_}).reduce((a,h)=>a+(h.duration||90),0)/60,J=new Set;b.forEach(a=>{a.studentIds&&a.studentIds.length>0&&a.studentIds.forEach(h=>J.add(h))});const P=b.filter(a=>a.isActive&&a.studentIds&&a.studentIds.length>0).length,te=new Date(w.getTime()+24*60*60*1e3).toISOString().split("T")[0],se=b.filter(a=>{const h=a.date.split("T")[0];return h===p||h===te}).slice(0,5).map(a=>({id:a._id,name:a.title||a.category,time:a.startTime,duration:a.duration||90,enrolledCount:a.studentIds?.length||0,capacity:a.maxStudents||15,level:a.category||"תיאוריה",venue:a.location}));u({totalTheoryStudents:J.size,todaysLessons:C.length,weeklyTheoryHours:Math.round(V*10)/10,upcomingExams:Math.floor(Math.random()*5)+1,activeTheoryGroups:P,pendingGrades:Math.floor(Math.random()*10)+2}),m(se);const O=[];b.slice(0,5).forEach((a,h)=>{O.push({id:`activity-${a._id}-${h}`,type:"lesson",title:"שיעור תיאוריה הושלם",description:`שיעור ${a.title||a.category} - ${a.studentIds?.length||0} תלמידים`,timestamp:new Date(Date.now()-Math.random()*864e5*3).toISOString(),groupName:a.title||a.category})}),O.push({id:"attendance-1",type:"attendance",title:"נוכחות עודכנה",description:"נוכחות לשיעור מגמה מתקדמת",timestamp:new Date(Date.now()-2*60*60*1e3).toISOString(),groupName:"מגמה מתקדמת"}),I(O.sort((a,h)=>new Date(h.timestamp).getTime()-new Date(a.timestamp).getTime()));const K=[],l=["מגמה מתחילים","מגמה בינוניים","מגמה מתקדמים","הרמוניה","קומפוזיציה"],o=["דניאל כהן","רחל לוי","יוסף גרין","שרה אברהם","מיכל דוד"];for(let a=0;a<Math.min(5,J.size);a++)K.push({studentId:`student-${a}`,studentName:o[a%o.length],theoryGroup:l[a%l.length],currentLevel:Math.random()>.5?"בינוני":"מתקדם",progressPercentage:Math.floor(Math.random()*30)+70,lastActivity:new Date(Date.now()-Math.random()*6048e5).toLocaleDateString("he-IL"),attendanceRate:Math.floor(Math.random()*20)+80});q(K)}catch(r){console.error("Error loading theory dashboard data:",r),W("שגיאה בטעינת נתוני לוח הבקרה לתיאוריה")}finally{G(!1)}},U=r=>{const t=new Date(r),b=t.getDay(),w=t.getDate()-b;return new Date(t.setDate(w))},x=ke(),N=r=>{switch(r){case"scheduleTheoryLesson":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"markTheoryAttendance":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"manageTheoryGroups":x("/profile",{state:{activeTab:"theory-lessons"}});break;case"gradeStudents":window.location.href="/teacher/theory-grades";break;default:console.log("Action:",r)}},A=r=>{const t=new Date(r),w=new Date().getTime()-t.getTime(),p=Math.floor(w/(1e3*60*60));return p<1?`לפני ${Math.floor(w/6e4)} דקות`:p<24?`לפני ${p} שעות`:`לפני ${Math.floor(p/24)} ימים`};return R?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 font-reisinger-yonatan",children:"טוען לוח בקרה לתיאוריה..."})]})}):F?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"text-red-800 font-reisinger-yonatan text-center",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-4 text-red-600"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:F}),e.jsx("button",{onClick:Y,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"נסה שוב"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-reisinger-yonatan",children:"לוח בקרה - מורה תיאוריה 🎼"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["שלום ",n?.firstName||"מורה"," • ",new Date().toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8",children:[e.jsx(de,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"תלמידי תיאוריה",value:d.totalTheoryStudents,bgColor:"bg-blue-50",iconColor:"text-blue-600",borderColor:"border-blue-200"}),e.jsx(de,{icon:e.jsx(ee,{className:"w-6 h-6"}),title:"שיעורים היום",value:d.todaysLessons,bgColor:"bg-green-50",iconColor:"text-green-600",borderColor:"border-green-200"}),e.jsx(de,{icon:e.jsx(ve,{className:"w-6 h-6"}),title:"שעות השבוע",value:d.weeklyTheoryHours,suffix:"שעות",bgColor:"bg-purple-50",iconColor:"text-purple-600",borderColor:"border-purple-200"}),e.jsx(de,{icon:e.jsx(Z,{className:"w-6 h-6"}),title:"בחינות קרובות",value:d.upcomingExams,bgColor:"bg-yellow-50",iconColor:"text-yellow-600",borderColor:"border-yellow-200"}),e.jsx(de,{icon:e.jsx(me,{className:"w-6 h-6"}),title:"קבוצות פעילות",value:d.activeTheoryGroups,bgColor:"bg-indigo-50",iconColor:"text-indigo-600",borderColor:"border-indigo-200"}),e.jsx(de,{icon:e.jsx(Ke,{className:"w-6 h-6"}),title:"ציונים ממתינים",value:d.pendingGrades,bgColor:"bg-orange-50",iconColor:"text-orange-600",borderColor:"border-orange-200"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 font-reisinger-yonatan",children:"פעולות מהירות - תיאוריה"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ne,{icon:e.jsx(Ae,{className:"w-5 h-5"}),label:"תזמן שיעור תיאוריה",onClick:()=>N("scheduleTheoryLesson"),color:"indigo"}),e.jsx(Ne,{icon:e.jsx(le,{className:"w-5 h-5"}),label:"סמן נוכחות תיאוריה",onClick:()=>N("markTheoryAttendance"),color:"green"}),e.jsx(Ne,{icon:e.jsx(Le,{className:"w-5 h-5"}),label:"נהל קבוצות תיאוריה",onClick:()=>N("manageTheoryGroups"),color:"blue"}),e.jsx(Ne,{icon:e.jsx(Xe,{className:"w-5 h-5"}),label:"דרג תלמידים",onClick:()=>N("gradeStudents"),color:"purple"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"השיעורים הבאים - תיאוריה"}),e.jsxs("button",{onClick:()=>x("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["צפה בכל",e.jsx(oe,{className:"w-4 h-4"})]})]}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין שיעורי תיאוריה מתוכננים"})]}):e.jsx("div",{className:"space-y-3",children:j.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[r.level," • ",r.enrolledCount,"/",r.capacity," תלמידים"]}),r.venue&&e.jsx("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:r.venue})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.time}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r.duration," דקות"]})]})]},r.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"התקדמות תלמידי תיאוריה"}),e.jsxs("button",{onClick:()=>x("/profile",{state:{activeTab:"theory-lessons"}}),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium flex items-center gap-1",children:["צפה בכל",e.jsx(oe,{className:"w-4 h-4"})]})]}),z.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין נתוני התקדמות"})]}):e.jsx("div",{className:"space-y-3",children:z.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-reisinger-yonatan",children:r.studentName}),e.jsxs("div",{className:"text-sm text-gray-600 font-reisinger-yonatan",children:[r.theoryGroup," • רמה: ",r.currentLevel]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["פעילות אחרונה: ",r.lastActivity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.progressPercentage>=90?"bg-green-500":r.progressPercentage>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.progressPercentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[r.progressPercentage,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:["נוכחות: ",r.attendanceRate,"%"]})]})]},r.studentId))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 font-reisinger-yonatan",children:"פעילות אחרונה - תיאוריה"}),e.jsx($e,{className:"w-5 h-5 text-gray-400"})]}),$.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-reisinger-yonatan",children:"אין פעילות לאחרונה"})]}):e.jsx("div",{className:"space-y-4",children:$.map(r=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${r.type==="lesson"?"bg-blue-100":r.type==="attendance"?"bg-green-100":r.type==="grade"?"bg-purple-100":r.type==="enrollment"?"bg-yellow-100":"bg-indigo-100"}`,children:[r.type==="lesson"&&e.jsx(me,{className:"w-4 h-4 text-blue-600"}),r.type==="attendance"&&e.jsx(le,{className:"w-4 h-4 text-green-600"}),r.type==="grade"&&e.jsx(Re,{className:"w-4 h-4 text-purple-600"}),r.type==="enrollment"&&e.jsx(Le,{className:"w-4 h-4 text-yellow-600"}),r.type==="exam"&&e.jsx(Z,{className:"w-4 h-4 text-indigo-600"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 font-reisinger-yonatan",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 truncate font-reisinger-yonatan",children:r.description}),r.groupName&&e.jsx("p",{className:"text-xs text-indigo-600 font-reisinger-yonatan",children:r.groupName}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:A(r.timestamp)})]})]},r.id))})]})]})]})})}function de({icon:n,title:d,value:u,suffix:j,bgColor:m,iconColor:$,borderColor:I}){return e.jsx("div",{className:`${m} border ${I} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:d}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[u," ",j&&e.jsx("span",{className:"text-sm font-normal",children:j})]})]}),e.jsx("div",{className:`${$}`,children:n})]})})}function Ne({icon:n,label:d,onClick:u,color:j}){const m={indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border-indigo-200",green:"bg-green-50 text-green-600 hover:bg-green-100 border-green-200",blue:"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200"};return e.jsxs("button",{onClick:u,className:`flex flex-col items-center justify-center p-4 rounded-lg border transition-colors ${m[j]}`,children:[n,e.jsx("span",{className:"mt-2 text-sm font-medium font-reisinger-yonatan text-center",children:d})]})}function xt(){const{user:n}=we(),{currentSchoolYear:d}=Pe(),[u,j]=c.useState(!0),[m,$]=c.useState({activeStudents:0,staffMembers:0,activeOrchestras:0,weeklyRehearsals:0,studentsTrend:0,staffTrend:0,rehearsalsTrend:0}),[I,z]=c.useState([]),[q,R]=c.useState([]);c.useEffect(()=>{G()},[d]);const G=async()=>{try{j(!0);const x=d?{schoolYearId:d._id}:{},[N,A,r,t]=await Promise.all([B.students.getStudents(x),B.teachers.getTeachers(x),B.orchestras.getOrchestras(x),B.rehearsals.getRehearsals(x)]),b=N.filter(l=>l.isActive!==!1).length,w=A.filter(l=>l.isActive!==!1).length,p=r.filter(l=>l.isActive!==!1).length,C=new Date,k=new Date(C.getTime()+7*24*60*60*1e3),_=t.filter(l=>{const o=new Date(l.date);return o>=C&&o<=k}).length,E=Math.floor(Math.random()*20)-10,V=Math.floor(Math.random()*5)-2,J=Math.floor(Math.random()*8)-4;$({activeStudents:b,staffMembers:w,activeOrchestras:p,weeklyRehearsals:_,studentsTrend:E,staffTrend:V,rehearsalsTrend:J});const P=[];N.sort((l,o)=>new Date(o.createdAt||0)-new Date(l.createdAt||0)).slice(0,2).forEach(l=>{P.push({type:"student",title:"רישום תלמיד חדש",description:`${l.personalInfo?.fullName||"תלמיד"} נרשם לקונסרבטוריון`,time:F(l.createdAt),color:"primary"})}),t.filter(l=>new Date(l.date)>=C).sort((l,o)=>new Date(l.date)-new Date(o.date)).slice(0,2).forEach(l=>{P.push({type:"rehearsal",title:"חזרה נקבעה",description:`${l.orchestraId?.name||"תזמורת"} - ${W(l.date)} ${l.startTime||""}`,time:F(l.createdAt),color:"success"})}),A.length>0&&A.filter(o=>o.studentCount>0).slice(0,1).forEach(o=>{P.push({type:"assignment",title:"שיבוץ מורה",description:`${o.personalInfo?.fullName||"מורה"} - ${o.studentCount} תלמידים`,time:"השבוע",color:"orange"})}),z(P.slice(0,5));const O=[];t.filter(l=>new Date(l.date)>=C).sort((l,o)=>new Date(l.date)-new Date(o.date)).slice(0,2).forEach(l=>{O.push({title:l.orchestraId?.name||"חזרת תזמורת",date:W(l.date),description:`${l.type||"חזרה"} - ${l.location||"אולם ראשי"}`,isPrimary:l.type==="concert"})}),O.push({title:"קונצרט חורף",date:"15 בדצמבר",description:"כל התזמורות מבצעות",isPrimary:!0}),O.length<3&&O.push({title:"אספת סגל",date:"8 בדצמבר",description:"ישיבת תכנון חודשית",isPrimary:!1}),R(O.slice(0,3))}catch(x){console.error("Failed to load dashboard data:",x)}finally{j(!1)}},F=x=>{if(!x)return"לאחרונה";const N=new Date,A=new Date(x),r=N-A,t=Math.floor(r/6e4),b=Math.floor(r/36e5),w=Math.floor(r/864e5);return t<60?`לפני ${t} דקות`:b<24?`לפני ${b} שעות`:w<7?`לפני ${w} ימים`:"השבוע"},W=x=>{if(!x)return"";const N=new Date(x);return`${N.getDate()}/${N.getMonth()+1}`},U=!n||n.role==="admin"||n.roles?.includes("admin")||n.role==="מנהל"||n.roles?.includes("מנהל")?"admin":n.role==="theory-teacher"||n.roles?.includes("theory-teacher")||n.roles?.includes("theory_teacher")||n.role==="מורה תיאוריה"||n.roles?.includes("מורה תיאוריה")?"theory-teacher":n.role==="conductor"||n.roles?.includes("conductor")||n.role==="מנצח"||n.roles?.includes("מנצח")||n.conducting?.orchestraIds?.length>0?"conductor":n.role==="teacher"||n.roles?.includes("teacher")||n.role==="מורה"||n.roles?.includes("מורה")||n.teaching?.studentIds?.length>0?"teacher":"admin";return U==="theory-teacher"?e.jsx(st,{}):U==="conductor"?e.jsx(et,{}):U==="teacher"?e.jsx(tt,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(be,{title:"תלמידים פעילים",value:u?"...":m.activeStudents.toString(),subtitle:"תלמידים רשומים",icon:e.jsx(ue,{}),color:"blue",trend:m.studentsTrend!==0?{value:Math.abs(m.studentsTrend),label:"מהחודש שעבר",direction:m.studentsTrend>0?"up":"down"}:void 0}),e.jsx(be,{title:"חברי סגל",value:u?"...":m.staffMembers.toString(),subtitle:"מורים ומדריכים",icon:e.jsx(Z,{}),color:"green",trend:m.staffTrend!==0?{value:Math.abs(m.staffTrend),label:"מהרבעון שעבר",direction:m.staffTrend>0?"up":"down"}:void 0}),e.jsx(be,{title:"הרכבים פעילים",value:u?"...":m.activeOrchestras.toString(),subtitle:"תזמורות וקבוצות",icon:e.jsx(he,{}),color:"purple"}),e.jsx(be,{title:"חזרות השבוע",value:u?"...":m.weeklyRehearsals.toString(),subtitle:"מפגשים מתוכננים",icon:e.jsx(ee,{}),color:"orange",trend:m.rehearsalsTrend!==0?{value:Math.abs(m.rehearsalsTrend),label:"מהשבוע שעבר",direction:m.rehearsalsTrend>0?"up":"down"}:void 0})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(pe,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"פעילות אחרונה"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"צפה בהכל"})]}),e.jsx("div",{className:"space-y-4",children:u?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"טוען..."}):I.length>0?I.map((x,N)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-2 h-2 bg-${x.color}-500 rounded-full mt-2 ml-4`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:x.title}),e.jsx("span",{className:"text-xs text-gray-500",children:x.time})]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]})]},N)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"אין פעילות אחרונה"})})]})}),e.jsx("div",{children:e.jsxs(pe,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"אירועים קרובים"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"יצירת אירוע"})]}),e.jsx("div",{className:"space-y-4",children:u?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"טוען..."}):q.length>0?q.map((x,N)=>e.jsxs("div",{className:`p-4 rounded-lg ${x.isPrimary?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:`text-sm font-medium ${x.isPrimary?"text-primary-900":"text-gray-900"}`,children:x.title}),e.jsx("span",{className:`text-xs ${x.isPrimary?"text-primary-600":"text-gray-500"}`,children:x.date})]}),e.jsx("p",{className:`text-sm ${x.isPrimary?"text-primary-700":"text-gray-600"}`,children:x.description})]},N)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"אין אירועים קרובים"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(pe,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"התקדמות חודשית"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"סטטיסטיקות החודש"}),!u&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary-600",children:m.activeStudents}),e.jsx("p",{className:"text-sm text-gray-600",children:"תלמידים"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-success-600",children:m.weeklyRehearsals}),e.jsx("p",{className:"text-sm text-gray-600",children:"חזרות"})]})]})]})})]}),e.jsxs(pe,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"התפלגות תלמידים"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"התפלגות לפי הרכבים"}),!u&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:m.activeOrchestras}),e.jsx("p",{className:"text-sm text-gray-600",children:"הרכבים פעילים"}),e.jsxs("p",{className:"text-lg mt-2 text-gray-700",children:["ממוצע: ",m.activeOrchestras>0?Math.floor(m.activeStudents/m.activeOrchestras):0," תלמידים להרכב"]})]})]})})]})]})]})}export{xt as default};
