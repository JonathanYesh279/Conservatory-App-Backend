import{j as e,u as ae,a as he}from"../assets/index-ee7c9a55.js";import{r as x,b as ge}from"./vendor-594479e1.js";import{C as S}from"./card-cba69aa1.js";import{S as pe,T as fe}from"./Table-489a4a5c.js";import{C as be}from"./Card-c7ff3038.js";import{U as ye,C as K,j as je,y as Ne,X as ne,P as le,T as ve,d as Z,i as ee,k as we,o as Ie,z as Te,E as Ce,v as Se,r as se,S as Ae,w as ke,x as Ee}from"./ui-0ea49fd5.js";import{a as F}from"./cascade-deletion-5647227d.js";import"./query-5c608ab7.js";import"./utils-a4d8ec6e.js";const De=({teacher:l,showStudentCount:c=!0,showSchedule:f=!1,showContact:j=!1,onClick:u,className:v=""})=>{const n=i=>i.split(" ").map(p=>p[0]).join("").slice(0,2),b=i=>({מורה:"bg-blue-100 text-blue-800",מנצח:"bg-purple-100 text-purple-800","מדריך הרכב":"bg-green-100 text-green-800",מנהל:"bg-red-100 text-red-800","מורה תאוריה":"bg-yellow-100 text-yellow-800",מגמה:"bg-indigo-100 text-indigo-800"})[i]||"bg-gray-100 text-gray-800",k=()=>{const i=["מנהל","מנצח","מדריך הרכב","מורה תאוריה","מגמה","מורה"],p=l.roles||[];return p.find(T=>i.includes(T))||p[0]||"מורה"},E=i=>({מורה:"bg-blue-500",מנצח:"bg-purple-500","מדריך הרכב":"bg-green-500",מנהל:"bg-red-500","מורה תאוריה":"bg-yellow-500",מגמה:"bg-indigo-500"})[i]||"bg-blue-500",C=()=>{if(!l.teaching?.schedule)return{lessons:0,hours:0};const i=l.teaching.schedule.reduce((p,T)=>p+T.duration,0);return{lessons:l.teaching.schedule.length,hours:Math.round(i/60*10)/10}},D=k(),g=l.teaching?.studentIds?.length||0,I=C();return e.jsx(be,{className:`transition-all duration-200 hover:shadow-md ${u?"cursor-pointer hover:shadow-lg":""} ${v}`,onClick:u,padding:"md",children:e.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[e.jsx("div",{className:`
          w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-sm
          ${E(D)}
        `,children:n(l.personalInfo.fullName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:l.personalInfo.fullName}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l.isActive?"bg-green-400":"bg-gray-300"}`}),!l.professionalInfo?.isActive&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:"לא פעיל מקצועית"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(l.roles||[]).map((i,p)=>e.jsx("span",{className:`
                    inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                    ${b(i)}
                  `,children:i},p))})}),l.professionalInfo?.instrument&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"התמחות:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.professionalInfo.instrument})]})}),c&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[g," ",g===1?"תלמיד":"תלמידים"]})]})}),f&&I.lessons>0&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-gray-600",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[I.lessons," שיעורים (",I.hours," שעות בשבוע)"]})]})}),j&&e.jsxs("div",{className:"border-t border-gray-100 pt-3 mt-3 space-y-2",children:[l.personalInfo.phone&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(je,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:l.personalInfo.phone})]}),l.personalInfo.email&&e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(Ne,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700 font-mono",dir:"ltr",children:l.personalInfo.email})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:l.isActive?"פעיל במערכת":"לא פעיל במערכת"}),l.professionalInfo?.isActive&&e.jsx("span",{className:"text-green-600",children:"פעיל מקצועית"})]})})]})]})})},Re=De,$e=["מורה","מנצח","מדריך הרכב","מנהל","מורה תאוריה","מגמה"],Oe=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],re=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26","חדר תאוריה א","חדר תאוריה ב"],Me=["חלילית","חליל צד","אבוב","בסון","סקסופון","קלרינט","חצוצרה","קרן יער","טרומבון","טובה/בריטון","שירה","כינור","ויולה","צ'לו","קונטרבס","פסנתר","גיטרה","אורגן","חרמוניקה","מנדולינה","כינור בארוק","ויולה דה גמבה","פלוטה רקורדר","אוקרינה","חליל פאן","דולצימר","אוטו-הרפ","פסנתר אלקטרוני","גיטרה בס","גיטרה אקוסטית","גיטרה קלאסית","בנג׳ו","חליל אירי","כינור קלטי","בודהראן"],V=(l,c)=>{if(!l||!c)return 0;const[f,j]=l.split(":").map(Number),[u,v]=c.split(":").map(Number),n=f*60+j,b=u*60+v;return b<=n?0:b-n},te=(l,c)=>{if(!l||!c)return null;const f=V(l,c);return f<=0?"שעת הסיום חייבת להיות אחרי שעת ההתחלה":f<30?"יום לימוד חייב להיות לפחות 30 דקות":f>480?"יום לימוד לא יכול להיות יותר מ-8 שעות":null},_e=({isOpen:l,onClose:c,onTeacherAdded:f})=>{const{currentSchoolYear:j}=ae(),[u,v]=x.useState("personal"),[n,b]=x.useState({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),[k,E]=x.useState([]),[C,D]=x.useState([]),[g,I]=x.useState(!1),[i,p]=x.useState({}),[T,R]=x.useState("");x.useEffect(()=>{l&&P()},[l]);const P=async()=>{try{const[s,a]=await Promise.all([F.orchestras.getOrchestras(),F.orchestras.getOrchestras({type:"ensemble"})]);E(s||[]),D(a||[])}catch(s){console.error("Failed to load orchestras/ensembles:",s)}},W=()=>{const s={};return n.personalInfo.fullName.trim()||(s["personalInfo.fullName"]="שם מלא נדרש"),n.personalInfo.phone.match(/^05\d{8}$/)||(s["personalInfo.phone"]="מספר טלפון חייב להיות בפורמט: 05XXXXXXXX"),n.personalInfo.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(s["personalInfo.email"]="כתובת אימייל לא תקינה"),n.personalInfo.address.trim()||(s["personalInfo.address"]="כתובת נדרשת"),n.roles.length===0&&(s.roles="יש לבחור לפחות תפקיד אחד"),(n.roles.includes("מורה")||n.roles.includes("מגמה")||!n.roles.includes("מורה תאוריה"))&&!n.professionalInfo.instrument&&(s["professionalInfo.instrument"]="יש לבחור כלי נגינה"),n.teaching.schedule.forEach((t,o)=>{if(t.startTime||(s[`schedule.${o}.startTime`]="שעת התחלה נדרשת"),t.endTime||(s[`schedule.${o}.endTime`]="שעת סיום נדרשת"),t.location?re.includes(t.location)||(s[`schedule.${o}.location`]="מיקום לא תקין"):s[`schedule.${o}.location`]="יש לבחור מיקום",t.startTime&&t.endTime){const y=te(t.startTime,t.endTime);y&&(s[`schedule.${o}.timeRange`]=y)}}),p(s),Object.keys(s).length===0},w=(s,a,t)=>{b(y=>({...y,[s]:{...y[s],[a]:t}}));const o=`${s}.${a}`;i[o]&&p(y=>{const _={...y};return delete _[o],_})},$=(s,a)=>{const t=a?[...n.roles,s]:n.roles.filter(o=>o!==s);b(o=>({...o,roles:t})),i.roles&&p(o=>{const y={...o};return delete y.roles,y})},Y=()=>{const s={day:"ראשון",startTime:"14:00",endTime:"15:30",location:"",notes:""};b(a=>({...a,teaching:{...a.teaching,schedule:[...a.teaching.schedule,s]}}))},A=s=>{b(a=>({...a,teaching:{...a.teaching,schedule:a.teaching.schedule.filter((t,o)=>o!==s)}}))},N=(s,a,t)=>{b(o=>({...o,teaching:{...o.teaching,schedule:o.teaching.schedule.map((y,_)=>_===s?{...y,[a]:t}:y)}}))},B=async s=>{if(s.preventDefault(),!!W()){I(!0),R("");try{const a={personalInfo:n.personalInfo,roles:n.roles,professionalInfo:n.professionalInfo,teaching:{studentIds:[],schedule:n.teaching.schedule.map(o=>({day:o.day,startTime:o.startTime,endTime:o.endTime,duration:V(o.startTime,o.endTime),location:o.location||null,notes:o.notes||null,isAvailable:!0,studentId:null,recurring:{isRecurring:!0,excludeDates:[]}}))},conducting:n.conducting,ensemblesIds:n.ensemblesIds,schoolYears:j?[{schoolYearId:j._id,isActive:!0}]:[],credentials:{email:n.personalInfo.email,password:null,isInvitationAccepted:!1},isActive:!0};console.log("🔄 Creating teacher:",a);const t=await F.teachers.addTeacher(a);console.log("✅ Teacher created successfully:",t),f(t),U(),c()}catch(a){console.error("❌ Failed to create teacher:",a),R(a.message||"שגיאה ביצירת המורה. נסה שוב.")}finally{I(!1)}}},U=()=>{b({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),v("personal"),p({}),R("")},O=()=>{U(),c()};if(!l)return null;const M=[{id:"personal",label:"מידע אישי",icon:ee},{id:"professional",label:"מידע מקצועי",icon:Te},{id:"schedule",label:"לוח זמנים",icon:K},{id:"conducting",label:"ניצוח",icon:Z}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[85vh] overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"הוספת מורה חדש"}),e.jsx("button",{onClick:O,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:M.map(({id:s,label:a,icon:t})=>e.jsxs("button",{onClick:()=>v(s),className:`flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${u===s?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(t,{className:"w-4 h-4"}),a]},s))})}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[u==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שם מלא *"}),e.jsx("input",{type:"text",value:n.personalInfo.fullName,onChange:s=>w("personalInfo","fullName",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${i["personalInfo.fullName"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"הכנס שם מלא"}),i["personalInfo.fullName"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"טלפון *"}),e.jsx("input",{type:"tel",value:n.personalInfo.phone,onChange:s=>w("personalInfo","phone",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${i["personalInfo.phone"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"05XXXXXXXX"}),i["personalInfo.phone"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"אימייל *"}),e.jsx("input",{type:"email",value:n.personalInfo.email,onChange:s=>w("personalInfo","email",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${i["personalInfo.email"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"teacher@example.com"}),i["personalInfo.email"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i["personalInfo.email"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"כתובת *"}),e.jsx("input",{type:"text",value:n.personalInfo.address,onChange:s=>w("personalInfo","address",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${i["personalInfo.address"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"רחוב מספר, עיר"}),i["personalInfo.address"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i["personalInfo.address"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"תפקידים *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:$e.map(s=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.roles.includes(s),onChange:a=>$(s,a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 w-4 h-4"}),e.jsx("span",{className:"mr-3 text-sm text-gray-700 font-medium",children:s})]},s))}),i.roles&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.roles})]})]}),u==="professional"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["כלי נגינה ",!n.roles.includes("מורה תאוריה")&&"*"]}),e.jsxs("select",{value:n.professionalInfo.instrument,onChange:s=>w("professionalInfo","instrument",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 bg-white ${i["professionalInfo.instrument"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,disabled:n.roles.includes("מורה תאוריה")&&n.roles.length===1,children:[e.jsx("option",{value:"",children:"בחר כלי נגינה"}),Me.map(s=>e.jsx("option",{value:s,children:s},s))]}),i["professionalInfo.instrument"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i["professionalInfo.instrument"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.professionalInfo.isActive,onChange:s=>w("professionalInfo","isActive",s.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"מורה פעיל"})]})})]}),u==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"בלוקי זמן להוראה"}),e.jsxs("button",{type:"button",onClick:Y,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(le,{className:"w-4 h-4 ml-2"}),"הוסף בלוק זמן"]})]}),n.teaching.schedule.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"לא הוגדרו בלוקי זמן"}),e.jsx("p",{className:"text-sm",children:"הוסף בלוק זמן כדי לקבוע מתי המורה זמין להוראה"})]}):e.jsx("div",{className:"space-y-4",children:n.teaching.schedule.map((s,a)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"יום"}),e.jsx("select",{value:s.day,onChange:t=>N(a,"day",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white",children:Oe.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:s.startTime,onChange:t=>N(a,"startTime",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שעת סיום"}),e.jsx("input",{type:"time",value:s.endTime,onChange:t=>N(a,"endTime",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"}),s.startTime&&s.endTime&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const t=V(s.startTime,s.endTime),o=te(s.startTime,s.endTime);return o?e.jsx("span",{className:"text-red-600",children:o}):t>0?e.jsxs("span",{className:"text-gray-500",children:["משך: ",t," דקות"]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מיקום"}),e.jsxs("select",{value:s.location,onChange:t=>N(a,"location",t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white ${i[`schedule.${a}.location`]?"border-red-300 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"בחר מיקום..."}),re.map(t=>e.jsx("option",{value:t,children:t},t))]}),i[`schedule.${a}.location`]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i[`schedule.${a}.location`]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"הערות"}),e.jsx("input",{type:"text",value:s.notes,onChange:t=>N(a,"notes",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500 bg-white",placeholder:"הערות נוספות"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>A(a),className:"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(ve,{className:"w-4 h-4 ml-1"}),"הסר"]})})]},a))})]}),u==="conducting"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"תזמורות לניצוח"}),e.jsx("p",{className:"text-sm text-gray-600",children:"בחר את התזמורות שהמורה ינצח"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:k.map(s=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-purple-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:n.conducting.orchestraIds.includes(s._id),onChange:a=>{const t=a.target.checked?[...n.conducting.orchestraIds,s._id]:n.conducting.orchestraIds.filter(o=>o!==s._id);w("conducting","orchestraIds",t)},className:"rounded-lg border-gray-300 text-purple-600 focus:ring-purple-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-purple-700 transition-colors",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:s.description||"תזמורת ללא תיאור"}),s.memberCount&&e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["👥 ",s.memberCount," חברים"]})]})]},s._id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"אנסמבלים להדרכה"}),e.jsx("p",{className:"text-sm text-gray-600",children:"בחר את האנסמבלים שהמורה ידריך"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:C.map(s=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:n.ensemblesIds.includes(s._id),onChange:a=>{const t=a.target.checked?[...n.ensemblesIds,s._id]:n.ensemblesIds.filter(o=>o!==s._id);b(o=>({...o,ensemblesIds:t}))},className:"rounded-lg border-gray-300 text-green-600 focus:ring-green-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-green-700 transition-colors",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:s.description||"אנסמבל ללא תיאור"}),s.memberCount&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["🎵 ",s.memberCount," חברים"]})]})]},s._id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200",children:[T&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:T})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:O,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:g,children:"ביטול"}),e.jsxs("button",{type:"submit",disabled:g,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[g?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}):e.jsx(Ie,{className:"w-4 h-4 ml-2"}),g?"שומר...":"שמור מורה"]})]})]})]})]})})},He=_e,G=l=>{if(console.log("🔍 ADMIN CHECK - Start:",{userExists:!!l,userType:typeof l,userKeys:l?Object.keys(l):"no user"}),!l)return console.log("❌ ADMIN CHECK - No user object"),!1;const c=l?.roles?.includes("מנהל"),f=l?.roles?.includes("admin"),j=l?.role==="admin",u=l?.role==="מנהל",v=c||f||j||u;return console.log("🔍 ADMIN CHECK - Detailed:",{user:l,roles:l?.roles,role:l?.role,checks:{hasAdminInRoles:c,hasAdminEnglish:f,hasSingleAdminRole:j,hasHebrewAdminRole:u},finalResult:v}),v?console.log("✅ ADMIN CHECK - User is admin!"):console.warn("⚠️  ADMIN CHECK - Access denied! User is not admin"),v};function Ke(){const l=ge(),{user:c}=he(),{currentSchoolYear:f,isLoading:j}=ae();x.useEffect(()=>{console.log("🏛️ TEACHERS PAGE - Auth state changed:",{userExists:!!c,userId:c?._id,userRoles:c?.roles,userRole:c?.role,timestamp:new Date().toISOString()})},[c]);const[u,v]=x.useState([]),[n,b]=x.useState(!0),[k,E]=x.useState(null),[C,D]=x.useState(""),[g,I]=x.useState({instrument:"",role:""}),[i,p]=x.useState(null),[T,R]=x.useState(null),[P,W]=x.useState(!1),[w,$]=x.useState(""),[Y,A]=x.useState(!1),[N,B]=x.useState("table"),[U,O]=x.useState(!1);x.useEffect(()=>{j||M()},[f,j]);const M=async()=>{try{b(!0),E(null);const r=f?{schoolYearId:f._id}:{},L=(await F.teachers.getTeachers(r)).filter(m=>m._id!==c?._id).map(m=>({id:m._id,name:m.personalInfo?.fullName||"לא צוין",specialization:m.professionalInfo?.instrument||"לא צוין",roles:m.allRoles||m.roles||[],primaryRole:m.primaryRole||"לא מוגדר",studentCount:m.studentCount||0,email:m.personalInfo?.email||"",phone:m.personalInfo?.phone||"",isActive:m.isTeacherActive,hasTimeBlocks:m.hasTimeBlocks||!1,timeBlockCount:m.timeBlockCount||0,orchestraCount:m.orchestraCount||0,ensembleCount:m.ensembleCount||0,availabilityDays:m.availabilityDays||[],totalTeachingHours:Math.round(m.totalTeachingHours/60*10)/10||0,rawData:m,rolesDisplay:m.allRoles?.length>0?m.allRoles.join(", "):"לא מוגדר",status:e.jsx(pe,{status:m.isTeacherActive?"active":"inactive",children:m.isTeacherActive?"פעיל":"לא פעיל"}),actions:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("button",{className:"p-1.5 text-primary-600 hover:text-primary-900 hover:bg-primary-100 rounded transition-colors",onClick:z=>{z.stopPropagation(),a(m._id)},title:"צפה בפרטי המורה",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",onClick:z=>{z.stopPropagation(),t(m._id)},title:"ערוך פרטי המורה",children:e.jsx(Se,{className:"w-4 h-4"})})]})}));v(L)}catch(r){console.error("Error loading teachers:",r),E(r.message)}finally{b(!1)}},s=()=>{p(null),R(null)},a=r=>{console.log("=== NAVIGATION DEBUG ==="),console.log("Teacher ID:",r),console.log("Target path:",`/teachers/${r}`),console.log("Current location:",window.location.pathname);const d=`/teachers/${r}`;try{l(d),console.log("Navigate function called successfully")}catch(h){console.error("Navigate failed, using window.location:",h),window.location.href=d}},t=r=>{window.location.href=`/teacher-management/${r}`},o=()=>{console.log("🎯 HANDLE ADD TEACHER - Button clicked!"),G(c)?(console.log("✅ HANDLE ADD TEACHER - Opening modal..."),O(!0)):(console.log("❌ HANDLE ADD TEACHER - Access denied!"),alert(`רק מנהלים יכולים להוסיף מורים

DEBUG INFO:
User: `+JSON.stringify(c,null,2)))},y=r=>{j||M()},J=["חלילית","חליל צד","אבוב","בסון","סקסופון","קלרינט","חצוצרה","קרן יער","טרומבון","טובה/בריטון","שירה","כינור","ויולה","צ'לו","קונטרבס","פסנתר","גיטרה","גיטרה בס","תופים"].filter(r=>r.toLowerCase().includes(w.toLowerCase())),q=(r,d)=>{I(h=>({...h,instrument:r})),$(d),A(!1)},oe=r=>{$(r),A(!0),r===""&&I(d=>({...d,instrument:""}))},X=u.filter(r=>{const d=!C||r.name.toLowerCase().includes(C.toLowerCase())||r.specialization.toLowerCase().includes(C.toLowerCase()),h=!g.instrument||r.specialization.includes(g.instrument),L=!g.role||r.roles&&r.roles.includes(g.role);return d&&h&&L}),H=u.length,ie=u.filter(r=>r.isActive).length,Q=u.reduce((r,d)=>r+d.studentCount,0),ce=H>0?(Q/H).toFixed(1):0,de=u.filter(r=>r.hasTimeBlocks).length,me=u.reduce((r,d)=>r+d.totalTeachingHours,0);u.filter(r=>r.orchestraCount>0).length;const xe=[{key:"name",header:"שם המורה"},{key:"specialization",header:"התמחות"},{key:"rolesDisplay",header:"תפקידים"},{key:"studentCount",header:"מס' תלמידים",align:"center"},{key:"status",header:"סטטוס",align:"center"},{key:"actions",header:"פעולות",align:"center",width:"100px"}],ue=()=>{if(!i||!T)return null;const r=["ראשון","שני","שלישי","רביעי","חמישי","שישי"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",style:{position:"fixed !important",top:"0 !important",left:"0 !important",right:"0 !important",bottom:"0 !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",zIndex:9999},children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["לוח זמנים - ",i.name]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),P?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(se,{className:"w-8 h-8 animate-spin text-primary-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"טוען לוח זמנים..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(d=>e.jsxs(S,{padding:"md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 text-center",children:d}),e.jsx("div",{className:"space-y-3",children:T[d]&&T[d].length>0?T[d].map((h,L)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:[h.time,"-",h.endTime]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[h.studentName," | ",h.instrument," | שלב ",h.currentStage]}),h.location&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["מיקום: ",h.location]})]},h.lessonId||L)):e.jsxs("div",{className:"text-center text-gray-500 py-6",children:["אין שיעורים ביום ",d]})})]},d))})]})})})};return n?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("div",{className:"text-lg text-gray-600",children:"טוען מורים..."})]})}):k?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 text-lg mb-4",children:"❌ שגיאה בטעינת הנתונים"}),e.jsx("div",{className:"text-gray-600 mb-6",children:k}),e.jsx("button",{onClick:M,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600",children:"נסה שוב"})]}):e.jsxs("div",{children:[ue(),e.jsx(S,{className:"mb-6",padding:"md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute right-3 top-3 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש מורים...",value:C,onChange:r=>D(r.target.value),className:"w-full pr-10 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"חפש כלי נגינה...",value:w,onChange:r=>oe(r.target.value),onFocus:()=>A(!0),onBlur:()=>{setTimeout(()=>A(!1),200)},className:"w-48 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500"}),w&&e.jsx("button",{onClick:()=>{$(""),I(r=>({...r,instrument:""})),A(!1)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ne,{className:"w-4 h-4"})}),Y&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50 direction-rtl",children:[e.jsx("button",{onClick:()=>q("","כל הכלים"),className:`w-full text-right px-3 py-2 hover:bg-gray-50 border-b border-gray-100 direction-rtl ${g.instrument===""?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:"כל הכלים"}),J.map(r=>e.jsx("button",{onClick:()=>q(r,r),className:`w-full text-right px-3 py-2 hover:bg-gray-50 direction-rtl ${g.instrument===r?"bg-primary-50 text-primary-600":"text-gray-900"}`,children:r},r)),J.length===0&&w&&e.jsx("div",{className:"px-3 py-2 text-gray-500 text-center",children:"לא נמצאו כלים"})]})]}),e.jsxs("select",{value:g.role,onChange:r=>I(d=>({...d,role:r.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"כל התפקידים"}),e.jsx("option",{value:"מורה",children:"מורה"}),e.jsx("option",{value:"מנצח",children:"מנצח"}),e.jsx("option",{value:"מדריך הרכב",children:"מדריך הרכב"}),e.jsx("option",{value:"מנהל",children:"מנהל"}),e.jsx("option",{value:"מורה תאוריה",children:"מורה תאוריה"}),e.jsx("option",{value:"מגמה",children:"מגמה"})]}),(()=>{console.log("🎯 BUTTON RENDER - Checking admin status for button display...");const r=G(c),d=!0,h=r||d;return console.log("🎯 BUTTON RENDER - Result:",{isAdmin:r,forceShow:d,finalDecision:h?"SHOWING BUTTON":"HIDING BUTTON"}),h?e.jsxs("button",{onClick:o,className:`flex items-center px-4 py-2 rounded-lg transition-colors ${r?"bg-primary-500 text-white hover:bg-primary-600":"bg-orange-500 text-white hover:bg-orange-600"}`,title:r?"Add Teacher":"DEBUG MODE - Not really admin",children:[e.jsx(le,{className:"w-4 h-4 ml-2"}),r?"הוסף מורה":"הוסף מורה (DEBUG)"]}):e.jsx("div",{style:{display:"none"},children:console.log("🚫 BUTTON HIDDEN - User does not have admin privileges")})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600 mb-1",children:H}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ מורים"})]})}),e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success-600 mb-1",children:ie}),e.jsx("div",{className:"text-xs text-gray-600",children:"פעילים"})]})}),e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:Q}),e.jsx("div",{className:"text-xs text-gray-600",children:"סה״כ תלמידים"})]})}),e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:ce}),e.jsx("div",{className:"text-xs text-gray-600",children:"ממוצע תלמידים"})]})}),e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-1",children:de}),e.jsx("div",{className:"text-xs text-gray-600",children:"עם זמינות"})]})}),e.jsx(S,{padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-teal-600 mb-1",children:Math.round(me)}),e.jsx("div",{className:"text-xs text-gray-600",children:"שעות זמינות"})]})})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:C||g.instrument||g.role?e.jsxs("span",{children:["מציג ",X.length," מתוך ",H," מורים"]}):e.jsxs("span",{children:['סה"כ ',H," מורים"]})}),e.jsxs("div",{className:"flex items-center bg-gray-50 p-1 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>B("table"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${N==="table"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":N==="table","aria-label":"תצוגת טבלה",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"טבלה"}),N==="table"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>B("grid"),className:`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 ${N==="grid"?"bg-white text-primary-700 shadow-sm border border-gray-200 ring-1 ring-primary-500/20":"text-gray-600 hover:text-gray-800 hover:bg-gray-100/50"}`,"aria-pressed":N==="grid","aria-label":"תצוגת רשת",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"רשת"}),N==="grid"&&e.jsx("div",{className:"absolute inset-0 rounded-md bg-gradient-to-r from-primary-500/5 to-primary-600/5 pointer-events-none"})]})]})]}),N==="table"?e.jsx(fe,{columns:xe,data:X,onRowClick:r=>{console.log("=== ROW CLICKED ==="),console.log("Row data:",r),console.log("Teacher ID from row:",r.id),a(r.id)},rowClassName:"hover:bg-gray-50 cursor-pointer transition-colors"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:X.map(r=>{const d={_id:r.id,personalInfo:{fullName:r.name,phone:r.phone,email:r.email},roles:r.roles||[],professionalInfo:{instrument:r.specialization,isActive:r.isActive},teaching:{studentIds:Array(r.studentCount).fill(""),schedule:[]},isActive:r.isActive};return e.jsx(Re,{teacher:d,showStudentCount:!0,showSchedule:!1,showContact:!1,onClick:()=>a(r.id),className:"h-full hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1"},r.id)})}),e.jsx(S,{className:"mb-4 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"🐛 Debug Info (Remove after fixing)"}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"User Object:"})," ",c?"✅ Exists":"❌ Missing"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User ID:"})," ",c?._id||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Roles Array:"})," ",JSON.stringify(c?.roles)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Single Role:"})," ",c?.role||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Admin:"})," ",G(c)?"✅ YES":"❌ NO"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Button Forced:"})," ✅ YES (TEMPORARY)"]})]})]})}),X.length===0&&!n&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"לא נמצאו מורים התואמים לחיפוש"}),e.jsx(He,{isOpen:U,onClose:()=>O(!1),onTeacherAdded:y})]})}export{Ke as default};
