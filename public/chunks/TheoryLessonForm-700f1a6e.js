import{j as e}from"../assets/index-ee7c9a55.js";import{r as x}from"./vendor-594479e1.js";import{t as R,d as U}from"./cascade-deletion-5647227d.js";import{X as Z,C as z,Y as J,U as K,B as P,n as X,m as T,o as G}from"./ui-0ea49fd5.js";function re({theoryLesson:l,theoryLessons:o,teachers:v,onSubmit:y,onCancel:k,mode:s="create"}){const[u,w]=x.useState("single"),[i,h]=x.useState({category:"מגמה",teacherId:"",date:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"אולם ערן",studentIds:[],attendance:{present:[],absent:[]},notes:"",syllabus:"",homework:"",schoolYearId:""}),[t,j]=x.useState({category:"מגמה",teacherId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"אולם ערן",studentIds:[],notes:"",syllabus:"",excludeDates:[],schoolYearId:""}),[O,Y]=x.useState(v||[]),[N,I]=x.useState(!1),[q,H]=x.useState(!1),[D,n]=x.useState(""),[C,f]=x.useState(""),W=["תלמידים חדשים ב-ד","מתחילים","מתחילים ב","מתחילים ד","מתקדמים ב","מתקדמים א","מתקדמים ג","תלמידים חדשים בוגרים (ה - ט)","תלמידים חדשים צעירים","הכנה לרסיטל קלאסי יא","הכנה לרסיטל רוק\\פופ\\ג'אז יא","הכנה לרסיטל רוק\\פופ\\ג'אז יב","מגמה","תאוריה כלי"],E=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26","חדר תאוריה א","חדר תאוריה ב"],S={0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"};x.useEffect(()=>{v||F(),M()},[v]),x.useEffect(()=>{if(s==="edit"&&l){const r=new Date(l.date);h({category:l.category||"מגמה",teacherId:l.teacherId||"",date:l.date?new Date(l.date).toISOString().split("T")[0]:"",dayOfWeek:l.dayOfWeek!==void 0?l.dayOfWeek:r.getDay(),startTime:l.startTime||"14:00",endTime:l.endTime||"15:00",location:l.location||"אולם ערן",studentIds:l.studentIds||[],attendance:l.attendance||{present:[],absent:[]},notes:l.notes||"",syllabus:l.syllabus||"",homework:l.homework||"",schoolYearId:l.schoolYearId||""}),j(a=>({...a,category:l.category||"מגמה",teacherId:l.teacherId||"",location:l.location||"אולם ערן",startTime:l.startTime||"14:00",endTime:l.endTime||"15:00",notes:l.notes||"",syllabus:l.syllabus||"",schoolYearId:l.schoolYearId||""}))}else if(s==="bulk-edit"&&o&&o.length>0){const r=o[0],a=o.every(m=>m.category===r.category)?r.category:"",c=o.every(m=>m.teacherId===r.teacherId)?r.teacherId:"",g=o.every(m=>m.location===r.location)?r.location:"",p=o.every(m=>m.startTime===r.startTime)?r.startTime:"",b=o.every(m=>m.endTime===r.endTime)?r.endTime:"",$=o.every(m=>m.notes===r.notes)?r.notes:"",A=o.every(m=>m.syllabus===r.syllabus)?r.syllabus:"";j({category:a||"מגמה",teacherId:c||"",startDate:"",endDate:"",dayOfWeek:0,startTime:p||"14:00",endTime:b||"15:00",location:g||"אולם ערן",studentIds:[],notes:$||"",syllabus:A||"",excludeDates:[],schoolYearId:r.schoolYearId||""})}},[l,o,s]);const F=async()=>{try{const a=(await R.getTeachers()).filter(c=>c.roles&&c.roles.includes("מורה תאוריה"));Y(a)}catch(r){console.error("Error loading teachers:",r)}},M=async()=>{try{const r=await U.getCurrentSchoolYear();r&&(i.schoolYearId||h(a=>({...a,schoolYearId:r._id})),t.schoolYearId||j(a=>({...a,schoolYearId:r._id})))}catch(r){console.error("Error loading current school year:",r)}},d=(r,a)=>{if(s==="edit"||s==="create"&&u==="single"){if(h(c=>({...c,[r]:a})),r==="date"&&a){const g=new Date(a).getDay();h(p=>({...p,date:a,dayOfWeek:g}))}}else j(c=>({...c,[r]:a}))},_=()=>{if(u==="single"){if(!i.category.trim())return n("יש לבחור קטגוריה לשיעור"),!1;if(!i.teacherId)return n("יש לבחור מורה לשיעור"),!1;if(!i.date)return n("יש לבחור תאריך לשיעור"),!1;if(!i.startTime||!i.endTime)return n("יש להזין שעות התחלה וסיום"),!1;if(!i.location.trim())return n("יש להזין מיקום לשיעור"),!1;const r=i.startTime.split(":").map(Number),a=i.endTime.split(":").map(Number),c=r[0]*60+r[1];if(a[0]*60+a[1]<=c)return n("שעת הסיום חייבת להיות אחרי שעת ההתחלה"),!1}else{if(!t.category.trim())return n("יש לבחור קטגוריה לשיעורים"),!1;if(!t.teacherId)return n("יש לבחור מורה לשיעורים"),!1;if(!t.startDate||!t.endDate)return n("יש לבחור תאריכי התחלה וסיום"),!1;if(!t.startTime||!t.endTime)return n("יש להזין שעות התחלה וסיום"),!1;if(!t.location.trim())return n("יש להזין מיקום לשיעורים"),!1;if(t.dayOfWeek<0||t.dayOfWeek>6)return n("יש לבחור יום בשבוע"),!1;if(!t.schoolYearId)return n("יש לבחור שנת לימודים"),!1;if(new Date(t.endDate)<=new Date(t.startDate))return n("תאריך הסיום חייב להיות אחרי תאריך ההתחלה"),!1;const r=t.startTime.split(":").map(Number),a=t.endTime.split(":").map(Number),c=r[0]*60+r[1];if(a[0]*60+a[1]<=c)return n("שעת הסיום חייבת להיות אחרי שעת ההתחלה"),!1}return!0},B=async r=>{if(r.preventDefault(),n(""),f(""),!!_()){I(!0);try{if(s==="edit"){const a={...i,date:new Date(i.date+"T"+i.startTime+":00.000Z").toISOString(),mode:"edit",lessonId:l?._id};await y(a),f("שיעור התיאוריה עודכן בהצלחה")}else if(s==="bulk-edit"){const a={};t.category&&t.category.trim()&&(a.category=t.category),t.teacherId&&t.teacherId.trim()&&(a.teacherId=t.teacherId),t.location&&t.location.trim()&&(a.location=t.location),t.startTime&&t.startTime.trim()&&(a.startTime=t.startTime),t.endTime&&t.endTime.trim()&&(a.endTime=t.endTime),t.notes&&t.notes.trim()&&(a.notes=t.notes),t.syllabus&&t.syllabus.trim()&&(a.syllabus=t.syllabus);const c={mode:"bulk-edit",lessonIds:o?.map(g=>g._id)||[],updateData:a};await y(c),f(`${o?.length||0} שיעורי תיאוריה עודכנו בהצלחה`)}else if(u==="single"){const a={...i,date:new Date(i.date+"T"+i.startTime+":00.000Z").toISOString(),mode:"create"};await y(a),f("שיעור התיאוריה נוצר בהצלחה")}else{const a={...t,isBulk:!0,mode:"bulk-create"};console.log("🚀 Bulk theory lesson creation data:",JSON.stringify(a,null,2));const g=["category","teacherId","startDate","endDate","dayOfWeek","startTime","endTime","location","schoolYearId"].filter(p=>{const b=a[p];return b==null||typeof b=="string"&&b.trim()===""});if(g.length>0){console.error("❌ Missing required fields:",g),n(`חסרים שדות חובה: ${g.join(", ")}`);return}await y(a),f("רצף שיעורי התיאוריה נוצר בהצלחה")}}catch(a){console.error("Error submitting theory lesson form:",a),n(a.message||"שגיאה בשמירת השיעור")}finally{I(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s==="edit"?"עריכת שיעור תיאוריה":s==="bulk-edit"?"עריכה קבוצתית של שיעורי תיאוריה":"שיעור תיאוריה חדש"}),e.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),s==="create"&&e.jsxs("div",{className:"flex space-x-4 rtl:space-x-reverse",children:[e.jsxs("button",{type:"button",onClick:()=>w("single"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${u==="single"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(z,{className:"w-4 h-4 ml-2"}),"שיעור בודד"]}),e.jsxs("button",{type:"button",onClick:()=>w("bulk"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${u==="bulk"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(J,{className:"w-4 h-4 ml-2"}),"רצף שיעורים"]})]}),s==="bulk-edit"&&o&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600 ml-2"}),e.jsxs("p",{className:"text-blue-800",children:["עריכה קבוצתית של ",o.length," שיעורי תיאוריה"]})]}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"שדות ריקים יישארו ללא שינוי, רק שדות שימולאו יעודכנו"})]})]}),e.jsxs("form",{onSubmit:B,className:"p-6 space-y-6",children:[q&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 ml-2"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"טוען נתוני שיעור..."})]})}),C&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800 text-sm",children:C})}),D&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:D})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(P,{className:"w-4 h-4 inline ml-1"}),"קטגוריה *"]}),e.jsxs("select",{value:s==="edit"||s==="create"&&u==="single"?i.category:t.category,onChange:r=>d("category",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:s!=="bulk-edit",children:[s==="bulk-edit"&&e.jsx("option",{value:"",children:"השאר ללא שינוי"}),W.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"מורה *"}),e.jsxs("select",{value:s==="edit"||s==="create"&&u==="single"?i.teacherId:t.teacherId,onChange:r=>d("teacherId",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:s!=="bulk-edit",children:[e.jsx("option",{value:"",children:s==="bulk-edit"?"השאר ללא שינוי":"בחר מורה"}),O.map(r=>e.jsx("option",{value:r._id,children:r.personalInfo?.fullName},r._id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline ml-1"}),"מיקום *"]}),e.jsxs("select",{value:s==="edit"||s==="create"&&u==="single"?i.location:t.location,onChange:r=>d("location",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:s!=="bulk-edit",children:[s==="bulk-edit"&&e.jsx("option",{value:"",children:"השאר ללא שינוי"}),E.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),s==="edit"||s==="create"&&u==="single"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך *"}),e.jsx("input",{type:"date",value:i.date,onChange:r=>d("date",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יום בשבוע"}),e.jsx("input",{type:"text",value:S[i.dayOfWeek]||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(T,{className:"w-4 h-4 inline ml-1"}),"שעת התחלה *"]}),e.jsx("input",{type:"time",value:i.startTime,onChange:r=>d("startTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:i.endTime,onChange:r=>d("endTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]}):s==="bulk-edit"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(T,{className:"w-4 h-4 inline ml-1"}),"שעת התחלה"]}),e.jsx("input",{type:"time",value:t.startTime,onChange:r=>d("startTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"השאר ללא שינוי"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שעת סיום"}),e.jsx("input",{type:"time",value:t.endTime,onChange:r=>d("endTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"השאר ללא שינוי"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך התחלה *"}),e.jsx("input",{type:"date",value:t.startDate,onChange:r=>d("startDate",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"תאריך סיום *"}),e.jsx("input",{type:"date",value:t.endDate,onChange:r=>d("endDate",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"יום בשבוע *"}),e.jsx("select",{value:t.dayOfWeek,onChange:r=>d("dayOfWeek",parseInt(r.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0,children:Object.entries(S).map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(T,{className:"w-4 h-4 inline ml-1"}),"שעת התחלה *"]}),e.jsx("input",{type:"time",value:t.startTime,onChange:r=>d("startTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:t.endTime,onChange:r=>d("endTime",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"סילבוס"}),e.jsx("textarea",{value:s==="edit"||s==="create"&&u==="single"?i.syllabus:t.syllabus,onChange:r=>d("syllabus",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:s==="bulk-edit"?"השאר ללא שינוי - נושאי השיעור...":s==="edit"||u==="single"?"נושאי השיעור...":"נושאי השיעורים..."})]}),s==="edit"||s==="create"&&u==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"שיעורי בית"}),e.jsx("textarea",{value:i.homework,onChange:r=>d("homework",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"משימות לבית..."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"הערות"}),e.jsx("textarea",{value:s==="edit"||s==="create"&&u==="single"?i.notes:t.notes,onChange:r=>d("notes",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:s==="bulk-edit"?"השאר ללא שינוי - הערות כלליות...":"הערות כלליות..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:N,children:"ביטול"}),e.jsxs("button",{type:"submit",disabled:N,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[N?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(G,{className:"w-4 h-4 ml-2"}),s==="edit"?"עדכן שיעור":s==="bulk-edit"?"עדכן שיעורים":u==="single"?"צור שיעור":"צור רצף שיעורים"]})]})]})]})})}export{re as T};
