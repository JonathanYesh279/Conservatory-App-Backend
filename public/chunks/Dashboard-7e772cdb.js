import{u as k,j as e}from"../assets/index-ee7c9a55.js";import{r as m}from"./vendor-594479e1.js";import{S as g}from"./StatsCard-3afa2b00.js";import{C as p}from"./card-cba69aa1.js";import{a as j}from"./cascade-deletion-5647227d.js";import{U as I,G as U,a as W,C as Y}from"./ui-0ea49fd5.js";import"./query-5c608ab7.js";import"./utils-a4d8ec6e.js";import"./Card-c7ff3038.js";function X(){const{currentSchoolYear:y}=k(),[n,v]=m.useState(!0),[a,D]=m.useState({activeStudents:0,staffMembers:0,activeOrchestras:0,weeklyRehearsals:0,studentsTrend:0,staffTrend:0,rehearsalsTrend:0}),[N,T]=m.useState([]),[b,M]=m.useState([]);m.useEffect(()=>{$()},[y]);const $=async()=>{try{v(!0);const s=y?{schoolYearId:y._id}:{},[i,l,d,c]=await Promise.all([j.students.getStudents(s),j.teachers.getTeachers(s),j.orchestras.getOrchestras(s),j.rehearsals.getRehearsals(s)]),x=i.filter(t=>t.isActive!==!1).length,h=l.filter(t=>t.isActive!==!1).length,R=d.filter(t=>t.isActive!==!1).length,u=new Date,C=new Date(u.getTime()+7*24*60*60*1e3),A=c.filter(t=>{const r=new Date(t.date);return r>=u&&r<=C}).length,E=Math.floor(Math.random()*20)-10,O=Math.floor(Math.random()*5)-2,P=Math.floor(Math.random()*8)-4;D({activeStudents:x,staffMembers:h,activeOrchestras:R,weeklyRehearsals:A,studentsTrend:E,staffTrend:O,rehearsalsTrend:P});const f=[];i.sort((t,r)=>new Date(r.createdAt||0)-new Date(t.createdAt||0)).slice(0,2).forEach(t=>{f.push({type:"student",title:"רישום תלמיד חדש",description:`${t.personalInfo?.fullName||"תלמיד"} נרשם לקונסרבטוריון`,time:w(t.createdAt),color:"primary"})}),c.filter(t=>new Date(t.date)>=u).sort((t,r)=>new Date(t.date)-new Date(r.date)).slice(0,2).forEach(t=>{f.push({type:"rehearsal",title:"חזרה נקבעה",description:`${t.orchestraId?.name||"תזמורת"} - ${S(t.date)} ${t.startTime||""}`,time:w(t.createdAt),color:"success"})}),l.length>0&&l.filter(r=>r.studentCount>0).slice(0,1).forEach(r=>{f.push({type:"assignment",title:"שיבוץ מורה",description:`${r.personalInfo?.fullName||"מורה"} - ${r.studentCount} תלמידים`,time:"השבוע",color:"orange"})}),T(f.slice(0,5));const o=[];c.filter(t=>new Date(t.date)>=u).sort((t,r)=>new Date(t.date)-new Date(r.date)).slice(0,2).forEach(t=>{o.push({title:t.orchestraId?.name||"חזרת תזמורת",date:S(t.date),description:`${t.type||"חזרה"} - ${t.location||"אולם ראשי"}`,isPrimary:t.type==="concert"})}),o.push({title:"קונצרט חורף",date:"15 בדצמבר",description:"כל התזמורות מבצעות",isPrimary:!0}),o.length<3&&o.push({title:"אספת סגל",date:"8 בדצמבר",description:"ישיבת תכנון חודשית",isPrimary:!1}),M(o.slice(0,3))}catch(s){console.error("Failed to load dashboard data:",s)}finally{v(!1)}},w=s=>{if(!s)return"לאחרונה";const i=new Date,l=new Date(s),d=i-l,c=Math.floor(d/6e4),x=Math.floor(d/36e5),h=Math.floor(d/864e5);return c<60?`לפני ${c} דקות`:x<24?`לפני ${x} שעות`:h<7?`לפני ${h} ימים`:"השבוע"},S=s=>{if(!s)return"";const i=new Date(s);return`${i.getDate()}/${i.getMonth()+1}`};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(g,{title:"תלמידים פעילים",value:n?"...":a.activeStudents.toString(),subtitle:"תלמידים רשומים",icon:e.jsx(I,{}),color:"blue",trend:a.studentsTrend!==0?{value:Math.abs(a.studentsTrend),label:"מהחודש שעבר",direction:a.studentsTrend>0?"up":"down"}:void 0}),e.jsx(g,{title:"חברי סגל",value:n?"...":a.staffMembers.toString(),subtitle:"מורים ומדריכים",icon:e.jsx(U,{}),color:"green",trend:a.staffTrend!==0?{value:Math.abs(a.staffTrend),label:"מהרבעון שעבר",direction:a.staffTrend>0?"up":"down"}:void 0}),e.jsx(g,{title:"הרכבים פעילים",value:n?"...":a.activeOrchestras.toString(),subtitle:"תזמורות וקבוצות",icon:e.jsx(W,{}),color:"purple"}),e.jsx(g,{title:"חזרות השבוע",value:n?"...":a.weeklyRehearsals.toString(),subtitle:"מפגשים מתוכננים",icon:e.jsx(Y,{}),color:"orange",trend:a.rehearsalsTrend!==0?{value:Math.abs(a.rehearsalsTrend),label:"מהשבוע שעבר",direction:a.rehearsalsTrend>0?"up":"down"}:void 0})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"פעילות אחרונה"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"צפה בהכל"})]}),e.jsx("div",{className:"space-y-4",children:n?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"טוען..."}):N.length>0?N.map((s,i)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-2 h-2 bg-${s.color}-500 rounded-full mt-2 ml-4`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("span",{className:"text-xs text-gray-500",children:s.time})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]},i)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"אין פעילות אחרונה"})})]})}),e.jsx("div",{children:e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"אירועים קרובים"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"יצירת אירוע"})]}),e.jsx("div",{className:"space-y-4",children:n?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"טוען..."}):b.length>0?b.map((s,i)=>e.jsxs("div",{className:`p-4 rounded-lg ${s.isPrimary?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:`text-sm font-medium ${s.isPrimary?"text-primary-900":"text-gray-900"}`,children:s.title}),e.jsx("span",{className:`text-xs ${s.isPrimary?"text-primary-600":"text-gray-500"}`,children:s.date})]}),e.jsx("p",{className:`text-sm ${s.isPrimary?"text-primary-700":"text-gray-600"}`,children:s.description})]},i)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"אין אירועים קרובים"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"התקדמות חודשית"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"סטטיסטיקות החודש"}),!n&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary-600",children:a.activeStudents}),e.jsx("p",{className:"text-sm text-gray-600",children:"תלמידים"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-success-600",children:a.weeklyRehearsals}),e.jsx("p",{className:"text-sm text-gray-600",children:"חזרות"})]})]})]})})]}),e.jsxs(p,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"התפלגות תלמידים"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"התפלגות לפי הרכבים"}),!n&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:a.activeOrchestras}),e.jsx("p",{className:"text-sm text-gray-600",children:"הרכבים פעילים"}),e.jsxs("p",{className:"text-lg mt-2 text-gray-700",children:["ממוצע: ",a.activeOrchestras>0?Math.floor(a.activeStudents/a.activeOrchestras):0," תלמידים להרכב"]})]})]})})]})]})]})}export{X as default};
