const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/Dashboard-BiFyqkxZ.js","chunks/vendor-B2j9q2e_.js","chunks/StatsCard-DmQRh7bi.js","chunks/utils-Cgyyg58q.js","chunks/Card-BGhuT3RM.js","chunks/cascade-deletion-C7j5aisD.js","chunks/query-BI61muSV.js","chunks/ui-26XYoSED.js","chunks/Students-B3WzZYlC.js","chunks/Table-CZif58Gh.js","chunks/ConfirmationModal-DTUWOJ_e.js","chunks/StudentDetailsPageSimple-iavtekgY.js","chunks/TeacherNameDisplay-CfKb3N98.js","chunks/apiCache-Dd4IdD-E.js","chunks/theoryEnrollmentService-Bg5HiXhn.js","chunks/Teachers-Bh8T5VDP.js","chunks/TheoryLessons-3dyP5dq7.js","chunks/TheoryLessonDetails-B9ZslUMc.js","chunks/Orchestras-J_YZsWAW.js","chunks/Rehearsals-ugeODJ4w.js","chunks/RehearsalDetails-B8mgSV3W.js","chunks/Bagruts-CoZ_B3yB.js","chunks/useBagrut--IEJY9-m.js","chunks/BagrutDetails-BYf4vKgc.js","chunks/Profile-B2tuL76X.js","chunks/RehearsalAttendance-BsBsEqpQ.js","chunks/OrchestraEnrollmentManager-hOWToBun.js","chunks/TeacherDetailsPage-DdZ-lVWJ.js","chunks/OrchestraDetailsPage-BV6yC2-g.js"])))=>i.map(i=>d[i]);
var Pt=Object.defineProperty;var $t=(t,r,o)=>r in t?Pt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;var Pe=(t,r,o)=>$t(t,typeof r!="symbol"?r+"":r,o);import{r as d,a as Lt,u as Ut,b as Ee,L as de,c as Bt,d as Ft,e as F,N as Se,R as ke,B as Mt}from"../chunks/vendor-B2j9q2e_.js";import{a as X,t as Vt,s as Yt,o as Wt,b as gt,_ as G,e as Ht}from"../chunks/cascade-deletion-C7j5aisD.js";import{Q as xt,c as ft}from"../chunks/query-BI61muSV.js";import{X as ue,A as We,U as ie,C as ce,a as ae,B as we,M as _e,T as Fe,P as xe,b as te,c as De,F as Je,d as ne,e as ve,f as le,S as He,g as Ne,h as zt,R as Xt,i as Ze,j as et,k as qt,l as $e,m as Gt,n as Qt,H as Te,G as pt,o as ze,p as Ae,q as Kt,r as tt,s as st,t as yt,u as Jt,v as Zt,w as rt,L as es}from"../chunks/ui-26XYoSED.js";import"../chunks/utils-Cgyyg58q.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();var bt={exports:{}},Oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ts=d,ss=Symbol.for("react.element"),rs=Symbol.for("react.fragment"),as=Object.prototype.hasOwnProperty,ns=ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ls={key:!0,ref:!0,__self:!0,__source:!0};function jt(t,r,o){var c,i={},n=null,l=null;o!==void 0&&(n=""+o),r.key!==void 0&&(n=""+r.key),r.ref!==void 0&&(l=r.ref);for(c in r)as.call(r,c)&&!ls.hasOwnProperty(c)&&(i[c]=r[c]);if(t&&t.defaultProps)for(c in r=t.defaultProps,r)i[c]===void 0&&(i[c]=r[c]);return{$$typeof:ss,type:t,key:n,ref:l,props:i,_owner:ns.current}}Oe.Fragment=rs;Oe.jsx=jt;Oe.jsxs=jt;bt.exports=Oe;var e=bt.exports,Me={},at=Lt;Me.createRoot=at.createRoot,Me.hydrateRoot=at.hydrateRoot;const vt=d.createContext(null),fe=()=>{const t=d.useContext(vt);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},os=({children:t})=>{const[r,o]=d.useState(!1),[c,i]=d.useState(!0),[n,l]=d.useState(null),[x,y]=d.useState(null),[u,m]=d.useState(null),T=d.useRef(!1),A=d.useRef(null),I=d.useRef(!0);d.useEffect(()=>{I.current=!0;const b=setTimeout(()=>{I.current&&S()},100);return()=>{I.current=!1,A.current&&clearTimeout(A.current),clearTimeout(b)}},[]);const S=d.useCallback(async(b=!1)=>{if(T.current&&!b){console.log("ğŸ” AUTH CONTEXT - Validation already in progress, skipping");return}const k=Date.now();if(!b&&u&&k-u<3e4){console.log("ğŸ” AUTH CONTEXT - Using cached authentication status");return}T.current=!0,y(null);try{if(X.auth.isAuthenticated()){console.log("ğŸ” AUTH CONTEXT - Token found, validating with server");const C=await X.auth.validateToken();if(!I.current)return;const L=C?.data?.user||C?.user||C?.data||C;console.log("ğŸ” AUTH CONTEXT - Token validation successful, fetching full teacher data");let N=null;if(L?._id)try{N=await X.teachers.getTeacher(L._id),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched:",{hasPersonalInfo:!!N?.personalInfo,hasRoles:!!N?.roles,fullName:N?.personalInfo?.fullName})}catch(B){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data:",B),N=L}const R=N||L,_={...R,teacherId:R?.teacherId||R?._id,personalInfo:R?.personalInfo||{fullName:R?.fullName||L?.fullName||"",email:R?.email||L?.email||"",phone:R?.phone||"",address:R?.address||""},roles:R?.roles||L?.roles||[],role:R?.role||R?.roles?.[0]||L?.roles?.[0]||""};console.log("ğŸ” AUTH CONTEXT - User data normalized:",{hasUserData:!!_,userRole:_?.role||_?.roles,userId:_?.teacherId||_?._id,fullName:_?.personalInfo?.fullName}),o(!0),l(_),m(k)}else console.log("ğŸ” AUTH CONTEXT - No valid token found"),o(!1),l(null),m(k)}catch(C){if(console.error("ğŸ” AUTH CONTEXT - Auth validation failed:",C),!I.current)return;y(C.message),o(!1),l(null),m(k),C.message.includes("Authentication failed")&&X.auth.isAuthenticated()&&console.log("ğŸ” AUTH CONTEXT - Attempting token refresh")}finally{I.current&&i(!1),T.current=!1}},[u]),P=async(b,k)=>{try{i(!0),y(null);const C=await X.auth.login(b,k);if(!I.current)return;console.log("ğŸ” AUTH CONTEXT - Login successful:",{hasToken:!!C.token,hasUserData:!!(C.teacher||C.user)});const{token:L}=C,N=C.teacher||C.user||C.data?.teacher||C.data?.user||C.data;if(!L||!N)throw new Error("Invalid login response: missing token or user data");console.log("ğŸ” AUTH CONTEXT - Fetching full teacher data after login");let R=null;if(N?._id||N?.teacherId)try{const K=N._id||N.teacherId;R=await X.teachers.getTeacher(K),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched after login:",{hasPersonalInfo:!!R?.personalInfo,hasRoles:!!R?.roles,fullName:R?.personalInfo?.fullName})}catch(K){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data after login:",K),R=N}const _=R||N,B={..._,teacherId:_?.teacherId||_?._id,personalInfo:_?.personalInfo||{fullName:_?.fullName||N?.personalInfo?.fullName||N?.fullName||"",email:_?.email||N?.credentials?.email||N?.personalInfo?.email||N?.email||b,phone:_?.phone||N?.personalInfo?.phone||"",address:_?.address||N?.personalInfo?.address||""},roles:_?.roles||N?.roles||[],role:_?.role||_?.roles?.[0]||N?.roles?.[0]||""};return console.log("ğŸ” AUTH CONTEXT - User data normalized after login:",{hasUserData:!!B,userRole:B?.role||B?.roles,userId:B?.teacherId||B?._id,fullName:B?.personalInfo?.fullName}),o(!0),l(B),m(Date.now()),{success:!0,user:B}}catch(C){throw console.error("ğŸ” AUTH CONTEXT - Login failed:",C),I.current&&(y(C.message),o(!1),l(null)),C}finally{I.current&&i(!1)}},$=async()=>{try{i(!0),await X.auth.logout(),console.log("ğŸ” AUTH CONTEXT - Logout successful")}catch(b){console.warn("ğŸ” AUTH CONTEXT - Logout API call failed:",b)}finally{I.current&&(o(!1),l(null),y(null),m(null),i(!1))}},V=d.useCallback(async()=>{try{return console.log("ğŸ” AUTH CONTEXT - Attempting token refresh"),await S(!0),r}catch(b){return console.error("ğŸ” AUTH CONTEXT - Token refresh failed:",b),await $(),!1}},[r]),g=d.useCallback(()=>({isAuthenticated:r,isLoading:c,user:n?{id:n.teacherId||n.id,role:n.role}:null,authError:x,lastValidation:u?new Date(u).toISOString():null,isValidating:T.current,cacheAge:u?Date.now()-u:null}),[r,c,n,x,u]),v={isAuthenticated:r,isLoading:c,user:n,authError:x,login:P,logout:$,checkAuthStatus:S,refreshToken:V,debugAuth:g};return e.jsx(vt.Provider,{value:v,children:t})},Nt=d.createContext(null),wt=()=>{const t=d.useContext(Nt);if(!t)throw new Error("useSchoolYear must be used within a SchoolYearProvider");return t},is=({children:t})=>{const{isAuthenticated:r}=fe(),[o,c]=d.useState(null),[i,n]=d.useState([]),[l,x]=d.useState(!0),[y,u]=d.useState(null);d.useEffect(()=>{r?m():(c(null),n([]),x(!1),u(null))},[r]);const m=async()=>{try{x(!0),u(null);const g=await X.schoolYears.getSchoolYears();n(g);const v=await X.schoolYears.getCurrentSchoolYear();if(v)c(v);else if(g.length>0){const b=g.sort((k,C)=>new Date(C.startDate)-new Date(k.startDate))[0];c(b)}console.log(`ğŸ“ Loaded ${g.length} school years, current: ${v?.name||"None"}`)}catch(g){console.error("Failed to load school years:",g),u(g.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×©× ×•×ª ×”×œ×™××•×“")}finally{x(!1)}},T=async g=>{try{const v=i.find(b=>b._id===g);if(v)c(v),console.log(`ğŸ¯ Switched to school year: ${v.name}`);else{const b=await X.schoolYears.getSchoolYear(g);c(b),console.log(`ğŸ¯ Switched to fetched school year: ${b.name}`)}}catch(v){console.error("Failed to set school year:",v),u(v.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“")}},A=async g=>{try{const v=await X.schoolYears.createSchoolYear(g);return n(b=>[...b,v]),g.isCurrent&&c(v),console.log(`â• Created new school year: ${v.name}`),v}catch(v){throw console.error("Failed to create school year:",v),u(v.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×©× ×ª ×”×œ×™××•×“"),v}},I=async(g,v)=>{try{const b=await X.schoolYears.updateSchoolYear(g,v);return n(k=>k.map(C=>C._id===g?b:C)),o&&o._id===g&&c(b),console.log(`âœï¸ Updated school year: ${b.name}`),b}catch(b){throw console.error("Failed to update school year:",b),u(b.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“"),b}},S=async g=>{try{if(await X.schoolYears.deleteSchoolYear(g),n(v=>v.filter(b=>b._id!==g)),o&&o._id===g){const v=i.filter(b=>b._id!==g);v.length>0?c(v[0]):c(null)}console.log(`ğŸ—‘ï¸ Deleted school year: ${g}`)}catch(v){throw console.error("Failed to delete school year:",v),u(v.message||"×©×’×™××” ×‘××—×™×§×ª ×©× ×ª ×”×œ×™××•×“"),v}},P=g=>{if(!g)return!1;const v=new Date,b=new Date(g.startDate),k=new Date(g.endDate);return v>=b&&v<=k&&g.isActive},V={currentSchoolYear:o,schoolYears:i,isLoading:l,error:y,loadSchoolYears:m,setCurrentSchoolYearById:T,createSchoolYear:A,updateSchoolYear:I,deleteSchoolYear:S,isSchoolYearActive:P,getSchoolYearDisplayName:g=>{if(!g)return"×œ× × ×‘×—×¨×” ×©× ×”";const v=g.isCurrent,b=P(g);let k=g.name;return v?k+=" (× ×•×›×—×™×ª)":b&&(k+=" (×¤×¢×™×œ×”)"),k}};return e.jsx(Nt.Provider,{value:V,children:t})},cs={currentBagrut:null,bagruts:[],loading:!1,error:null,validation:{errors:{},warnings:{}}},ds=t=>{if(!t[3]?.detailedGrading)return 0;const r=t[3].detailedGrading;return(r.playingSkills?.points||0)+(r.musicalUnderstanding?.points||0)+(r.textKnowledge?.points||0)+(r.playingByHeart?.points||0)},us=(t,r)=>{const o=t/100*100,c=r/100*100;return o*.9+c*.1},ms=t=>t>=95?"××¦×•×™×Ÿ (100-95)":t>=85?"×˜×•×‘ ×××“ (94-85)":t>=75?"×˜×•×‘ (84-75)":t>=65?"×›××¢×˜ ×˜×•×‘ (74-65)":t>=55?"××¡×¤×™×§ (64-55)":"×œ× ××¡×¤×™×§ (54-0)",hs=t=>({presentations:[t.presentations?.[0]?.completed||!1,t.presentations?.[1]?.completed||!1,t.presentations?.[2]?.completed||!1,t.presentations?.[3]?.completed||!1],directorEvaluation:!!t.directorEvaluation?.points,recitalConfig:!!(t.recitalConfiguration?.units&&t.recitalConfiguration?.field),program:t.program?.length>0}),je=(t,r,o)=>t<0?`${o} ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×œ×™×œ×™`:t>r?`${o} ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ ${r} × ×§×•×“×•×ª`:null,gs=t=>t!==3&&t!==5?"×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5":null,xs=(t,r)=>{switch(r.type){case"SET_LOADING":return{...t,loading:r.payload};case"SET_ERROR":return{...t,error:r.payload};case"SET_CURRENT_BAGRUT":return console.log("âœ… BagrutContext: SET_CURRENT_BAGRUT reducer:",r.payload?._id),{...t,currentBagrut:r.payload};case"SET_BAGRUTS":return{...t,bagruts:r.payload};case"UPDATE_DIRECTOR_EVALUATION":{const{bagrutId:o,evaluation:c}=r.payload,i=t.currentBagrut?._id===o?{...t.currentBagrut,directorEvaluation:c}:t.currentBagrut,n=t.bagruts.map(l=>l._id===o?{...l,directorEvaluation:c}:l);return{...t,currentBagrut:i,bagruts:n}}case"UPDATE_RECITAL_CONFIG":{const{bagrutId:o,config:c}=r.payload,i={units:c.recitalUnits,field:c.recitalField},n=t.currentBagrut?._id===o?{...t.currentBagrut,recitalConfiguration:i,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:t.currentBagrut,l=t.bagruts.map(x=>x._id===o?{...x,recitalConfiguration:i,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:x);return{...t,currentBagrut:n,bagruts:l}}case"UPDATE_PRESENTATION":{const{bagrutId:o,index:c,data:i}=r.payload,n=(y=[])=>{const u=[...y];return u[c]={...u[c],...i},u},l=t.currentBagrut?._id===o?{...t.currentBagrut,presentations:n(t.currentBagrut.presentations)}:t.currentBagrut,x=t.bagruts.map(y=>y._id===o?{...y,presentations:n(y.presentations)}:y);return{...t,currentBagrut:l,bagruts:x}}case"CALCULATE_COMPUTED_VALUES":{const{bagrutId:o}=r.payload,c=i=>{if(i._id!==o)return i;const n=ds(i.presentations||[]),l=i.directorEvaluation?.points||0,x=us(n,l),y=ms(x),u=hs(i);return{...i,computedValues:{totalPerformancePoints:n,weightedFinalGrade:x,gradeLevel:y,completionStatus:u},finalGrade:x,finalGradeLevel:y}};return{...t,currentBagrut:t.currentBagrut?c(t.currentBagrut):null,bagruts:t.bagruts.map(c)}}case"SET_VALIDATION_ERROR":return{...t,validation:{...t.validation,errors:{...t.validation.errors,[r.payload.field]:r.payload.message}}};case"CLEAR_VALIDATION_ERRORS":return{...t,validation:{...t.validation,errors:{}}};default:return t}},Tt=d.createContext(null),fs=({children:t})=>{const[r,o]=d.useReducer(xs,cs),c=d.useMemo(()=>({setLoading:n=>o({type:"SET_LOADING",payload:n}),setError:n=>o({type:"SET_ERROR",payload:n}),setCurrentBagrut:n=>{console.log("ğŸ’¾ BagrutContext: setCurrentBagrut action called with:",n?._id),o({type:"SET_CURRENT_BAGRUT",payload:n})},setBagruts:n=>o({type:"SET_BAGRUTS",payload:n}),updateDirectorEvaluation:(n,l)=>{const x=je(l.points||0,100,"×”×¢×¨×›×ª ×× ×”×œ");if(x){o({type:"SET_VALIDATION_ERROR",payload:{field:"directorEvaluation",message:x}});return}o({type:"UPDATE_DIRECTOR_EVALUATION",payload:{bagrutId:n,evaluation:l}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updateRecitalConfig:(n,l)=>{const x=gs(l.recitalUnits);if(x){o({type:"SET_VALIDATION_ERROR",payload:{field:"recitalUnits",message:x}});return}o({type:"UPDATE_RECITAL_CONFIG",payload:{bagrutId:n,config:l}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updatePresentation:(n,l,x)=>{if(x.detailedGrading){const y=x.detailedGrading,u=[];if(y.playingSkills?.points!==void 0){const m=je(y.playingSkills.points,40,"×›×™×©×•×¨×™ × ×’×™× ×”");m&&u.push(m)}if(y.musicalUnderstanding?.points!==void 0){const m=je(y.musicalUnderstanding.points,30,"×”×‘× ×” ××•×–×™×§×œ×™×ª");m&&u.push(m)}if(y.textKnowledge?.points!==void 0){const m=je(y.textKnowledge.points,20,"×™×“×¢ ×˜×§×¡×˜");m&&u.push(m)}if(y.playingByHeart?.points!==void 0){const m=je(y.playingByHeart.points,10,"× ×’×™× ×” ×‘×¢×œ ×¤×”");m&&u.push(m)}if(u.length>0){o({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${l}`,message:u[0]}});return}}o({type:"UPDATE_PRESENTATION",payload:{bagrutId:n,index:l,data:x}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},recalculateGrade:n=>{o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},setValidationError:(n,l)=>{o({type:"SET_VALIDATION_ERROR",payload:{field:n,message:l}})},clearValidationErrors:()=>{o({type:"CLEAR_VALIDATION_ERRORS"})},validatePointTotal:n=>(n.playingSkills?.points||0)+(n.musicalUnderstanding?.points||0)+(n.textKnowledge?.points||0)+(n.playingByHeart?.points||0)>100?(o({type:"SET_VALIDATION_ERROR",payload:{field:"totalPoints",message:"×¡×š ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100"}}),!1):!0,validateSequentialPresentation:(n,l)=>n>0&&!l[n-1]?.completed?(o({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${n}`,message:`×™×© ×œ×”×©×œ×™× ×ª×—×™×œ×” ××¦×’×ª ${n}`}}),!1):!0}),[]),i=d.useMemo(()=>({state:r,actions:c}),[r,c]);return e.jsx(Tt.Provider,{value:i,children:t})},jr=()=>{const t=d.useContext(Tt);if(!t)throw new Error("useBagrutContext must be used within a BagrutProvider");return t},vr={getCurrentBagrut:t=>t.currentBagrut,getAllBagruts:t=>t.bagruts,getLoadingState:t=>t.loading,getError:t=>t.error,getValidationErrors:t=>t.validation.errors,getBagrutById:(t,r)=>t.bagruts.find(o=>o._id===r),getCompletedPresentations:(t,r)=>t.bagruts.find(c=>c._id===r)?.presentations?.filter(c=>c.completed)||[],getTotalPerformancePoints:(t,r)=>t.bagruts.find(c=>c._id===r)?.computedValues?.totalPerformancePoints||0,getWeightedFinalGrade:(t,r)=>t.bagruts.find(c=>c._id===r)?.computedValues?.weightedFinalGrade||0,getCompletionStatus:(t,r)=>t.bagruts.find(c=>c._id===r)?.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1}},pe=new xt({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!0,retry:(t,r)=>{const o=r?.response?.status;return o>=400&&o<500?!1:t<2},retryDelay:t=>Math.min(1e3*2**t,3e4),networkMode:"online"},mutations:{retry:1,networkMode:"online",onError:t=>{console.error("Mutation error:",t)}}}});pe.setQueryDefaults(["students"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["teachers"],{staleTime:10*60*1e3,gcTime:30*60*1e3});pe.setQueryDefaults(["theory-lessons"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["orchestras"],{staleTime:5*60*1e3,gcTime:15*60*1e3});pe.setQueryDefaults(["school-years"],{staleTime:30*60*1e3,gcTime:60*60*1e3});function ps({children:t}){return e.jsxs(ft,{client:pe,children:[t,!1]})}const It=d.createContext(void 0);function ys({children:t}){const[r,o]=d.useState(!0),[c,i]=d.useState(!1);return d.useEffect(()=>{const n=()=>{i(window.innerWidth<768)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),e.jsx(It.Provider,{value:{isDesktopOpen:r,setIsDesktopOpen:o,isMobile:c},children:t})}function Xe(){const t=d.useContext(It);if(t===void 0)throw new Error("useSidebar must be used within a SidebarProvider");return t}const bs=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨"],js=[1,2,3,4,5,6,7,8],vs=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","×’×™×˜×¨×” ×‘×¡","×ª×•×¤×™×"],Ns=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],ws=[30,45,60],nt=["×œ× × ×‘×—×Ÿ","×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”"],Ts=({initialData:t,onSubmit:r,onCancel:o,isEdit:c=!1})=>{const[i,n]=d.useState({personalInfo:{fullName:"",phone:"",age:null,address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[{instrumentName:"",isPrimary:!0,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}],class:"×",tests:{bagrutId:null}},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,...t}),[l,x]=d.useState({}),[y,u]=d.useState(!1),[m,T]=d.useState({personal:!0,academic:!0,instruments:!0,teachers:!0,enrollments:!1}),[A,I]=d.useState([]),[S,P]=d.useState([]),[$,V]=d.useState([]),[g,v]=d.useState([]),[b,k]=d.useState(""),[C,L]=d.useState(!1);d.useState([]);const[N,R]=d.useState({duration:null,selectedDays:[],startTime:"",endTime:""}),[_,B]=d.useState(!0);d.useEffect(()=>{const a=async()=>{try{const E=await X.teachers.getTeachers();I(E)}catch(E){console.error("Error fetching teachers:",E)}},f=async()=>{try{const E=await X.orchestras.getOrchestras();console.log("Fetched orchestras:",E);const O=await Promise.all((E||[]).map(async Y=>{if(Y.rehearsalIds&&Y.rehearsalIds.length>0)try{const Q=await X.rehearsals.getRehearsalById(Y.rehearsalIds[0]);return{...Y,rehearsalSchedule:Q?{day:Q.day||Q.dayOfWeek,startTime:Q.startTime,endTime:Q.endTime,location:Q.location||Y.location}:null}}catch{return console.log("Could not fetch rehearsal for orchestra:",Y.name),Y}return Y}));V(O)}catch(E){console.error("Error fetching orchestras:",E),V([])}},p=async()=>{try{const E=await X.theory.getTheoryLessons();console.log("Fetched theory lessons:",E),v(E||[])}catch(E){console.error("Error fetching theory lessons:",E),v([])}};a(),f(),p()},[]),d.useEffect(()=>{b&&(K(b),B(!0))},[b]);const K=async a=>{L(!0);try{const f=await X.teachers.getTeacherById(a);console.log("Teacher data for slots:",f);const p=f.teaching?.timeBlocks?.filter(O=>O.isActive!==!1)||[];console.log("Time blocks found:",p);const E=[];p.forEach(O=>{const Y=O.startTime,Q=O.endTime,w=O.day,[U,M]=Y.split(":").map(Number),[q,re]=Q.split(":").map(Number),be=U*60+M,Dt=q*60+re-be;ws.forEach(ge=>{const Ct=Math.floor(Dt/ge);for(let Ie=0;Ie<Ct;Ie++){const Re=be+Ie*ge,Ge=Re+ge,Et=Math.floor(Re/60),_t=Re%60,At=Math.floor(Ge/60),Ot=Ge%60,Qe=`${Et.toString().padStart(2,"0")}:${_t.toString().padStart(2,"0")}`,Rt=`${At.toString().padStart(2,"0")}:${Ot.toString().padStart(2,"0")}`;O.assignedLessons&&O.assignedLessons.some(Ke=>Ke.startTime===Qe&&Ke.duration===ge)||E.push({_id:`${O._id}-${ge}-${Ie}`,day:w,startTime:Qe,endTime:Rt,duration:ge,isAvailable:!0,location:O.location,teacherName:f.personalInfo?.fullName,teacherId:f._id,instrument:f.professionalInfo?.instrument})}})}),console.log("Generated available slots:",E),P(E)}catch(f){console.error("Error fetching teacher slots:",f),P([])}finally{L(!1)}},s=a=>{T(f=>({...f,[a]:!f[a]}))},h=(a,f,p)=>{n(E=>({...E,[a]:{...E[a],[f]:p}})),x(E=>({...E,[`${a}.${f}`]:""}))},j=(a,f,p)=>{const E=[...i.academicInfo.instrumentProgress];f==="tests"?E[a]={...E[a],tests:p}:E[a]={...E[a],[f]:p},f==="isPrimary"&&p===!0&&E.forEach((O,Y)=>{Y!==a&&(O.isPrimary=!1)}),n(O=>({...O,academicInfo:{...O.academicInfo,instrumentProgress:E}}))},D=()=>{const a=i.academicInfo.instrumentProgress.some(f=>f.isPrimary);n(f=>({...f,academicInfo:{...f.academicInfo,instrumentProgress:[...f.academicInfo.instrumentProgress,{instrumentName:"",isPrimary:!a,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}]}}))},W=a=>{const f=i.academicInfo.instrumentProgress.filter((p,E)=>E!==a);f.length>0&&!f.some(p=>p.isPrimary)&&(f[0].isPrimary=!0),n(p=>({...p,academicInfo:{...p.academicInfo,instrumentProgress:f}}))},ee=a=>{const f={teacherId:a.teacherId,day:a.day,time:a.startTime,duration:a.duration,isActive:!0,isRecurring:!0,...a.location&&{location:a.location}};n(p=>({...p,teacherAssignments:[...p.teacherAssignments,f],teacherIds:p.teacherIds.includes(a.teacherId)?p.teacherIds:[...p.teacherIds,a.teacherId]})),P(p=>p.filter(E=>E._id!==a._id)),B(!1)},me=(a,f)=>{const[p,E]=a.split(":").map(Number),O=p*60+E+f,Y=Math.floor(O/60),Q=O%60;return`${Y.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`},he=a=>{const f=i.teacherAssignments[a];n(p=>{const E=p.teacherAssignments.filter((Y,Q)=>Q!==a),O=E.some(Y=>Y.teacherId===f.teacherId);return{...p,teacherAssignments:E,teacherIds:O?p.teacherIds:p.teacherIds.filter(Y=>Y!==f.teacherId)}})},J=()=>{const a={};i.personalInfo.fullName.trim()||(a["personalInfo.fullName"]="×©× ××œ× ×”×•× ×©×“×” ×—×•×‘×”"),i.personalInfo.phone&&!/^05\d{8}$/.test(i.personalInfo.phone)&&(a["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×“×•×’××”: 0501234567)"),i.personalInfo.parentPhone&&!/^05\d{8}$/.test(i.personalInfo.parentPhone)&&(a["personalInfo.parentPhone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),i.personalInfo.parentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.personalInfo.parentEmail)&&(a["personalInfo.parentEmail"]="××™××™×™×œ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),i.personalInfo.studentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.personalInfo.studentEmail)&&(a["personalInfo.studentEmail"]="××™××™×™×œ ×ª×œ××™×“ ×œ× ×ª×§×™×Ÿ"),i.academicInfo.class||(a["academicInfo.class"]="×›×™×ª×” ×”×™× ×©×“×” ×—×•×‘×”"),i.academicInfo.instrumentProgress.length===0?a["academicInfo.instruments"]="×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×›×œ×™ × ×’×™× ×” ××—×“":i.academicInfo.instrumentProgress.forEach((p,E)=>{p.instrumentName||(a[`instrument.${E}.name`]="×©× ×”×›×œ×™ ×”×•× ×©×“×” ×—×•×‘×”")});const f=i.academicInfo.instrumentProgress.some(p=>p.isPrimary);return i.academicInfo.instrumentProgress.length>0&&!f&&(a["academicInfo.primaryInstrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ ×¨××©×™"),x(a),Object.keys(a).length===0},ye=async a=>{if(a.preventDefault(),!!J()){u(!0);try{console.log("ğŸ“‹ Form data being submitted:",JSON.stringify(i,null,2)),console.log("ğŸ‘¥ Teacher assignments:",JSON.stringify(i.teacherAssignments,null,2)),console.log("ğŸ‘¨â€ğŸ« Teacher IDs:",i.teacherIds),await r(i)}catch(f){console.error("Error submitting form:",f),x({submit:"×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×"})}finally{u(!1)}}};return e.jsxs("form",{onSubmit:ye,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:c?"×¢×¨×™×›×ª ×ª×œ××™×“":"×”×•×¡×¤×ª ×ª×œ××™×“ ×—×“×©"}),e.jsx("button",{type:"button",onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),l.submit&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:l.submit})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>s("personal"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××™×©×™×™×"})]}),m.personal?e.jsx(ce,{}):e.jsx(ae,{})]}),m.personal&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ××œ× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:i.personalInfo.fullName,onChange:a=>h("personalInfo","fullName",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.fullName"]?"border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ××©×¤×—×” ×•××– ×©× ×¤×¨×˜×™ (×œ×“×•×’××”: ×›×”×Ÿ ×™×•×¡×™)"}),l["personalInfo.fullName"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×ª×œ××™×“"}),e.jsx("input",{type:"tel",value:i.personalInfo.phone,onChange:a=>h("personalInfo","phone",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.phone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),l["personalInfo.phone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×’×™×œ"}),e.jsx("input",{type:"number",value:i.personalInfo.age||"",onChange:a=>h("personalInfo","age",a.target.value?parseInt(a.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×’×™×œ ×”×ª×œ××™×“",min:"0",max:"99"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×ª×œ××™×“"}),e.jsx("input",{type:"email",value:i.personalInfo.studentEmail,onChange:a=>h("personalInfo","studentEmail",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.studentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"student@example.com"}),l["personalInfo.studentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.studentEmail"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª"}),e.jsx("input",{type:"text",value:i.personalInfo.address,onChange:a=>h("personalInfo","address",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×”×›× ×¡ ×›×ª×•×‘×ª ××œ××”"})]}),e.jsx("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-4",children:"×¤×¨×˜×™ ×”×•×¨×”"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×•×¨×”"}),e.jsx("input",{type:"text",value:i.personalInfo.parentName,onChange:a=>h("personalInfo","parentName",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×©× ×”×”×•×¨×”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×”×•×¨×”"}),e.jsx("input",{type:"tel",value:i.personalInfo.parentPhone,onChange:a=>h("personalInfo","parentPhone",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.parentPhone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),l["personalInfo.parentPhone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.parentPhone"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×”×•×¨×”"}),e.jsx("input",{type:"email",value:i.personalInfo.parentEmail,onChange:a=>h("personalInfo","parentEmail",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.parentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"parent@example.com"}),l["personalInfo.parentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.parentEmail"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>s("academic"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××§×“××™×™×"})]}),m.academic?e.jsx(ce,{}):e.jsx(ae,{})]}),m.academic&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×™×ª×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:i.academicInfo.class,onChange:a=>h("academicInfo","class",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["academicInfo.class"]?"border-red-500":"border-gray-300"}`,children:bs.map(a=>e.jsx("option",{value:a,children:a},a))}),l["academicInfo.class"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["academicInfo.class"]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>s("instruments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×›×œ×™ × ×’×™× ×”"})]}),m.instruments?e.jsx(ce,{}):e.jsx(ae,{})]}),m.instruments&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[l["academicInfo.instruments"]&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:l["academicInfo.instruments"]})}),l["academicInfo.primaryInstrument"]&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:l["academicInfo.primaryInstrument"]})}),e.jsxs("div",{className:"space-y-4",children:[i.academicInfo.instrumentProgress.map((a,f)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×›×œ×™ × ×’×™× ×” ",f+1]}),i.academicInfo.instrumentProgress.length>1&&e.jsx("button",{type:"button",onClick:()=>W(f),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["×©× ×”×›×œ×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.instrumentName,onChange:p=>j(f,"instrumentName",p.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l[`instrument.${f}.name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),vs.map(p=>e.jsx("option",{value:p,children:p},p))]}),l[`instrument.${f}.name`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l[`instrument.${f}.name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×œ×‘ × ×•×›×—×™"}),e.jsx("select",{value:a.currentStage,onChange:p=>j(f,"currentStage",parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:js.map(p=>e.jsxs("option",{value:p,children:["×©×œ×‘ ",p]},p))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isPrimary,onChange:p=>j(f,"isPrimary",p.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×›×œ×™ ×¨××©×™"})]})}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×©×œ×‘"}),e.jsx("select",{value:a.tests.stageTest.status,onChange:p=>j(f,"tests",{...a.tests,stageTest:{...a.tests.stageTest,status:p.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:nt.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×˜×›× ×™"}),e.jsx("select",{value:a.tests.technicalTest.status,onChange:p=>j(f,"tests",{...a.tests,technicalTest:{...a.tests.technicalTest,status:p.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:nt.map(p=>e.jsx("option",{value:p,children:p},p))})]})]})]})]},f)),e.jsxs("button",{type:"button",onClick:D,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors flex items-center justify-center gap-2 text-gray-600 hover:text-primary-600",children:[e.jsx(xe,{className:"w-4 h-4"}),"×”×•×¡×£ ×›×œ×™ × ×’×™× ×”"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>s("teachers"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××•×¨×™× ×•×©×™×¢×•×¨×™×"}),i.teacherAssignments.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:[i.teacherAssignments.length," ×©×™×‘×•×¦×™×"]})]}),m.teachers?e.jsx(ce,{}):e.jsx(ae,{})]}),m.teachers&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[i.teacherAssignments.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×©×™×¢×•×¨×™× ××ª×•×›× × ×™×"}),e.jsx("div",{className:"space-y-2",children:i.teacherAssignments.map((a,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["××•×¨×” - ",A.find(p=>p._id===a.teacherId)?.professionalInfo?.instrument||"×›×œ×™"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.day," | ",a.time,"-",me(a.time,a.duration)," | ",a.duration," ×“×§×•×ª",a.location&&` | ${a.location}`]})]})]}),e.jsx("button",{type:"button",onClick:()=>he(f),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Fe,{className:"w-4 h-4"})})]},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×‘×—×¨ ××•×¨×”"}),e.jsxs("select",{value:b,onChange:a=>k(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×"}),A.map(a=>e.jsxs("option",{value:a._id,children:[a.personalInfo?.fullName," - ",a.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"]},a._id))]})]}),b&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["×–×× ×™× ×¤× ×•×™×™× - ",A.find(a=>a._id===b)?.personalInfo?.fullName||"××•×¨×”"]}),!_&&S.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>B(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4"}),"×‘×—×¨ ×©×™×¢×•×¨ × ×•×¡×£"]})}),_&&!C&&S.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"×¡×™× ×•×Ÿ ×–×× ×™×"]}),(N.duration||N.selectedDays.length>0||N.startTime||N.endTime)&&e.jsxs("button",{type:"button",onClick:()=>R({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),"× ×§×” ×¡×™× ×•×Ÿ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×š ×©×™×¢×•×¨"}),e.jsxs("select",{value:N.duration||"",onChange:a=>R(f=>({...f,duration:a.target.value?Number(a.target.value):null})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"×›×œ ×”××©×›×™×"}),e.jsx("option",{value:"30",children:"30 ×“×§×•×ª"}),e.jsx("option",{value:"45",children:"45 ×“×§×•×ª"}),e.jsx("option",{value:"60",children:"60 ×“×§×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×™××™×"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-right flex items-center justify-between text-gray-900",onClick:a=>{const f=a.currentTarget.nextElementSibling;f&&f.classList.toggle("hidden")},children:[e.jsx("span",{className:"truncate",children:N.selectedDays.length>0?`${N.selectedDays.length} ×™××™× × ×‘×—×¨×•`:"×›×œ ×”×™××™×"}),e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"})]}),e.jsx("div",{className:"hidden absolute top-full mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg z-10",children:Ns.map(a=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N.selectedDays.includes(a),onChange:f=>{f.target.checked?R(p=>({...p,selectedDays:[...p.selectedDays,a]})):R(p=>({...p,selectedDays:p.selectedDays.filter(E=>E!==a)}))},className:"ml-2 text-primary-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:a})]},a))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×¢×”"}),e.jsx("input",{type:"time",value:N.startTime,onChange:a=>R(f=>({...f,startTime:a.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×¢×“ ×©×¢×”"}),e.jsx("input",{type:"time",value:N.endTime,onChange:a=>R(f=>({...f,endTime:a.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]})]})]}),C?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"×˜×•×¢×Ÿ ×–×× ×™× ×¤× ×•×™×™×..."})]}):_&&S.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–××Ÿ ×•××©×š ×©×™×¢×•×¨ ××”××¤×©×¨×•×™×•×ª ×”×–××™× ×•×ª:"}),(()=>{const a=S.filter(p=>!(N.duration&&p.duration!==N.duration||N.selectedDays.length>0&&!N.selectedDays.includes(p.day)||N.startTime&&p.startTime<N.startTime||N.endTime&&p.endTime>N.endTime));if(a.length===0)return e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×”×ª×•×××™× ×œ×¡×™× ×•×Ÿ ×©×‘×—×¨×ª"}),e.jsx("button",{type:"button",onClick:()=>R({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700",children:"× ×§×” ×¡×™× ×•×Ÿ ×•×ª×¨××” ××ª ×›×œ ×”×–×× ×™×"})]});const f=a.reduce((p,E)=>(p[E.day]||(p[E.day]=[]),p[E.day].push(E),p),{});return Object.entries(f).map(([p,E])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),p]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:E.sort((O,Y)=>O.startTime.localeCompare(Y.startTime)).map(O=>e.jsx("button",{type:"button",onClick:()=>ee(O),className:`p-3 border rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-right ${O.duration===30?"border-green-300 bg-green-50":O.duration===45?"border-blue-300 bg-blue-50":"border-purple-300 bg-purple-50"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[O.startTime,"-",O.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${O.duration===30?"bg-green-100 text-green-800":O.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[O.duration," ×“×§×³"]})]}),O.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ve,{className:"w-3 h-3"}),O.location]}),e.jsx("div",{className:"text-xs text-gray-600",children:O.instrument})]})},O._id))})]},p))})()]}):b&&!C&&_&&S.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×¤× ×•×™×™× ×œ××•×¨×” ×–×”"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×”××•×¨×” ×œ× ×”×’×“×™×¨ ×–×× ×™ ×”×•×¨××”"})]}):null]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>s("enrollments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×¨×©××•×ª"})]}),m.enrollments?e.jsx(ce,{}):e.jsx(ae,{})]}),m.enrollments&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×–××•×¨×ª"}),e.jsxs("select",{value:i.enrollments.orchestraIds[0]||"",onChange:a=>{n(f=>({...f,enrollments:{...f.enrollments,orchestraIds:a.target.value?[a.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),$.map(a=>{const f=a.rehearsalSchedule||a.schedule&&a.schedule[0]||a.rehearsals&&a.rehearsals[0]||null;let p=a.name;if(f){const E=f.day||f.dayOfWeek||"",O=f.startTime||"",Y=f.endTime||"",Q=f.location||a.location||"";E&&O&&Y&&(p+=` | ${E} ${O}-${Y}`),Q&&(p+=` | ${Q}`)}else a.location&&(p+=` | ${a.location}`);return e.jsx("option",{value:a._id,children:p},a._id)})]}),i.enrollments.orchestraIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200",children:(()=>{const a=$.find(f=>f._id===i.enrollments.orchestraIds[0]);return a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-purple-900",children:a.name}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[a.rehearsalSchedule&&e.jsxs("div",{className:"p-2 bg-purple-100 rounded",children:[e.jsx("strong",{children:"×–×× ×™ ×—×–×¨×•×ª:"})," ",a.rehearsalSchedule.day," ",a.rehearsalSchedule.startTime,"-",a.rehearsalSchedule.endTime,a.rehearsalSchedule.location&&e.jsxs("span",{children:[" | ",a.rehearsalSchedule.location]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×•×’:"})," ",a.type||"×ª×–××•×¨×ª"]}),!a.rehearsalSchedule&&a.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"××™×§×•×:"})," ",a.location]}),a.memberIds&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×‘×¨×™×:"})," ",a.memberIds.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×˜×˜×•×¡:"})," ",a.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"]}),a.rehearsalIds&&a.rehearsalIds.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×–×¨×•×ª ×©××•×¨×•×ª:"})," ",a.rehearsalIds.length]})]})]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),e.jsxs("select",{value:i.enrollments.theoryLessonIds[0]||"",onChange:a=>{n(f=>({...f,enrollments:{...f.enrollments,theoryLessonIds:a.target.value?[a.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),g.map(a=>{const f=a.schedule&&a.schedule.length>0?a.schedule[0]:null,p=f?`${f.day} ${f.startTime}-${f.endTime}${f.location?` | ${f.location}`:""}`:"";return e.jsxs("option",{value:a._id,children:[a.name||a.title||a.category," ",p?`| ${p}`:"",a.teacher?.personalInfo?.fullName&&` | ××•×¨×”: ${a.teacher.personalInfo.fullName}`]},a._id)})]}),i.enrollments.theoryLessonIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(()=>{const a=g.find(f=>f._id===i.enrollments.theoryLessonIds[0]);return a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:a.name}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"×¨××”:"})," ",a.level]}),a.teacher?.personalInfo?.fullName&&e.jsxs("div",{children:[e.jsx("strong",{children:"××•×¨×”:"})," ",a.teacher.personalInfo.fullName]}),a.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×™××•×¨:"})," ",a.description]}),a.maxStudents&&e.jsxs("div",{children:[e.jsx("strong",{children:"××§×¡×™××•× ×ª×œ××™×“×™×:"})," ",a.maxStudents]}),a.currentStudents!==void 0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×œ××™×“×™× × ×•×›×—×™×™×:"})," ",a.currentStudents,"/",a.maxStudents||"âˆ"]}),a.schedule&&a.schedule.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×–×× ×™ ×©×™×¢×•×¨:"}),e.jsx("div",{className:"mt-1 space-y-1",children:a.schedule.map((f,p)=>e.jsxs("div",{className:"text-xs bg-blue-100 px-2 py-1 rounded",children:[f.day," ",f.startTime,"-",f.endTime,f.location&&` | ${f.location}`]},p))})]}),a.prerequisites&&e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[e.jsx("strong",{children:"×“×¨×™×©×•×ª ×§×“×:"})," ",a.prerequisites]})]})]}):null})()})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:o,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:y,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4"}),c?"×¢×“×›×Ÿ ×ª×œ××™×“":"×”×•×¡×£ ×ª×œ××™×“"]})})]})]})},Ve=["××•×œ× ×¢×¨×Ÿ","×¡×˜×•×“×™×• ×§×××¨×™ 1","×¡×˜×•×“×™×• ×§×××¨×™ 2","××•×œ×¤×Ÿ ×”×§×œ×˜×•×ª","×—×“×¨ ×—×–×¨×•×ª 1","×—×“×¨ ×—×–×¨×•×ª 2","×—×“×¨ ××—×©×‘×™×","×—×“×¨ 1","×—×“×¨ 2","×—×“×¨ ×—×–×¨×•×ª","×—×“×¨ 5","×—×“×¨ 6","×—×“×¨ 7","×—×“×¨ 8","×—×“×¨ 9","×—×“×¨ 10","×—×“×¨ 11","×—×“×¨ 12","×—×“×¨ 13","×—×“×¨ 14","×—×“×¨ 15","×—×“×¨ 16","×—×“×¨ 17","×—×“×¨ 18","×—×“×¨ 19","×—×“×¨ 20","×—×“×¨ 21","×—×“×¨ 22","×—×“×¨ 23","×—×“×¨ 24","×—×“×¨ 25","×—×“×¨ 26","×—×“×¨ ×ª××•×¨×™×” ×","×—×“×¨ ×ª××•×¨×™×” ×‘"],Is=["××•×¨×”","×× ×¦×—","××“×¨×™×š ×”×¨×›×‘","×× ×”×œ","××•×¨×” ×ª××•×¨×™×”","××’××”"],Ss=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],ks=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","××•×¨×’×Ÿ","×—×¨××•× ×™×§×”","×× ×“×•×œ×™× ×”","×›×™× ×•×¨ ×‘××¨×•×§","×•×™×•×œ×” ×“×” ×’××‘×”","×¤×œ×•×˜×” ×¨×§×•×¨×“×¨","××•×§×¨×™× ×”","×—×œ×™×œ ×¤××Ÿ","×“×•×œ×¦×™××¨","××•×˜×•-×”×¨×¤","×¤×¡× ×ª×¨ ××œ×§×˜×¨×•× ×™","×’×™×˜×¨×” ×‘×¡","×’×™×˜×¨×” ××§×•×¡×˜×™×ª","×’×™×˜×¨×” ×§×œ××¡×™×ª","×‘× ×’×³×•","×—×œ×™×œ ××™×¨×™","×›×™× ×•×¨ ×§×œ×˜×™","×‘×•×“×”×¨××Ÿ"],Ye=(t,r)=>{if(!t||!r)return 0;const[o,c]=t.split(":").map(Number),[i,n]=r.split(":").map(Number),l=o*60+c,x=i*60+n;return x<=l?0:x-l},lt=(t,r)=>{if(!t||!r)return null;const o=Ye(t,r);return o<=0?"×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":o<30?"×™×•× ×œ×™××•×“ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 30 ×“×§×•×ª":o>480?"×™×•× ×œ×™××•×“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-8 ×©×¢×•×ª":null},Ds=({isOpen:t,onClose:r,onTeacherAdded:o})=>{const{currentSchoolYear:c}=wt(),[i,n]=d.useState("personal"),[l,x]=d.useState({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),[y,u]=d.useState([]),[m,T]=d.useState([]),[A,I]=d.useState(!1),[S,P]=d.useState({}),[$,V]=d.useState("");d.useEffect(()=>{t&&g()},[t]);const g=async()=>{try{const[s,h]=await Promise.all([X.orchestras.getOrchestras(),X.orchestras.getOrchestras({type:"ensemble"})]);u(s||[]),T(h||[])}catch(s){console.error("Failed to load orchestras/ensembles:",s)}},v=()=>{const s={};return l.personalInfo.fullName.trim()||(s["personalInfo.fullName"]="×©× ××œ× × ×“×¨×©"),l.personalInfo.phone.match(/^05\d{8}$/)||(s["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¤×•×¨××˜: 05XXXXXXXX"),l.personalInfo.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(s["personalInfo.email"]="×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”"),l.personalInfo.address.trim()||(s["personalInfo.address"]="×›×ª×•×‘×ª × ×“×¨×©×ª"),l.roles.length===0&&(s.roles="×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×ª×¤×§×™×“ ××—×“"),(l.roles.includes("××•×¨×”")||l.roles.includes("××’××”")||!l.roles.includes("××•×¨×” ×ª××•×¨×™×”"))&&!l.professionalInfo.instrument&&(s["professionalInfo.instrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ × ×’×™× ×”"),l.teaching.schedule.forEach((j,D)=>{if(j.startTime||(s[`schedule.${D}.startTime`]="×©×¢×ª ×”×ª×—×œ×” × ×“×¨×©×ª"),j.endTime||(s[`schedule.${D}.endTime`]="×©×¢×ª ×¡×™×•× × ×“×¨×©×ª"),j.location?Ve.includes(j.location)||(s[`schedule.${D}.location`]="××™×§×•× ×œ× ×ª×§×™×Ÿ"):s[`schedule.${D}.location`]="×™×© ×œ×‘×—×•×¨ ××™×§×•×",j.startTime&&j.endTime){const W=lt(j.startTime,j.endTime);W&&(s[`schedule.${D}.timeRange`]=W)}}),P(s),Object.keys(s).length===0},b=(s,h,j)=>{x(W=>({...W,[s]:{...W[s],[h]:j}}));const D=`${s}.${h}`;S[D]&&P(W=>{const ee={...W};return delete ee[D],ee})},k=(s,h)=>{const j=h?[...l.roles,s]:l.roles.filter(D=>D!==s);x(D=>({...D,roles:j})),S.roles&&P(D=>{const W={...D};return delete W.roles,W})},C=()=>{const s={day:"×¨××©×•×Ÿ",startTime:"14:00",endTime:"15:30",location:"",notes:""};x(h=>({...h,teaching:{...h.teaching,schedule:[...h.teaching.schedule,s]}}))},L=s=>{x(h=>({...h,teaching:{...h.teaching,schedule:h.teaching.schedule.filter((j,D)=>D!==s)}}))},N=(s,h,j)=>{x(D=>({...D,teaching:{...D.teaching,schedule:D.teaching.schedule.map((W,ee)=>ee===s?{...W,[h]:j}:W)}}))},R=async s=>{if(s.preventDefault(),!!v()){I(!0),V("");try{const h={personalInfo:l.personalInfo,roles:l.roles,professionalInfo:l.professionalInfo,teaching:{studentIds:[],schedule:l.teaching.schedule.map(D=>({day:D.day,startTime:D.startTime,endTime:D.endTime,duration:Ye(D.startTime,D.endTime),location:D.location||null,notes:D.notes||null,isAvailable:!0,studentId:null,recurring:{isRecurring:!0,excludeDates:[]}}))},conducting:l.conducting,ensemblesIds:l.ensemblesIds,schoolYears:c?[{schoolYearId:c._id,isActive:!0}]:[],credentials:{email:l.personalInfo.email,password:null,isInvitationAccepted:!1},isActive:!0};console.log("ğŸ”„ Creating teacher:",h);const j=await X.teachers.addTeacher(h);console.log("âœ… Teacher created successfully:",j),o(j),_(),r()}catch(h){console.error("âŒ Failed to create teacher:",h),V(h.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×”××•×¨×”. × ×¡×” ×©×•×‘.")}finally{I(!1)}}},_=()=>{x({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),n("personal"),P({}),V("")},B=()=>{_(),r()};if(!t)return null;const K=[{id:"personal",label:"××™×“×¢ ××™×©×™",icon:ie},{id:"professional",label:"××™×“×¢ ××§×¦×•×¢×™",icon:zt},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:te},{id:"conducting",label:"× ×™×¦×•×—",icon:Ne}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[85vh] overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"×”×•×¡×¤×ª ××•×¨×” ×—×“×©"}),e.jsx("button",{onClick:B,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:K.map(({id:s,label:h,icon:j})=>e.jsxs("button",{onClick:()=>n(s),className:`flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${i===s?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(j,{className:"w-4 h-4"}),h]},s))})}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[i==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ××œ× *"}),e.jsx("input",{type:"text",value:l.personalInfo.fullName,onChange:s=>b("personalInfo","fullName",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.fullName"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×”×›× ×¡ ×©× ××œ×"}),S["personalInfo.fullName"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ *"}),e.jsx("input",{type:"tel",value:l.personalInfo.phone,onChange:s=>b("personalInfo","phone",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.phone"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"05XXXXXXXX"}),S["personalInfo.phone"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ *"}),e.jsx("input",{type:"email",value:l.personalInfo.email,onChange:s=>b("personalInfo","email",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.email"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"teacher@example.com"}),S["personalInfo.email"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S["personalInfo.email"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª *"}),e.jsx("input",{type:"text",value:l.personalInfo.address,onChange:s=>b("personalInfo","address",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.address"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×¨×—×•×‘ ××¡×¤×¨, ×¢×™×¨"}),S["personalInfo.address"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S["personalInfo.address"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×ª×¤×§×™×“×™× *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Is.map(s=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l.roles.includes(s),onChange:h=>k(s,h.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 w-4 h-4"}),e.jsx("span",{className:"mr-3 text-sm text-gray-700 font-medium",children:s})]},s))}),S.roles&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S.roles})]})]}),i==="professional"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×œ×™ × ×’×™× ×” ",!l.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&"*"]}),e.jsxs("select",{value:l.professionalInfo.instrument,onChange:s=>b("professionalInfo","instrument",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 bg-white ${S["professionalInfo.instrument"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,disabled:l.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&l.roles.length===1,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),ks.map(s=>e.jsx("option",{value:s,children:s},s))]}),S["professionalInfo.instrument"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S["professionalInfo.instrument"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.professionalInfo.isActive,onChange:s=>b("professionalInfo","isActive",s.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"××•×¨×” ×¤×¢×™×œ"})]})})]}),i==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"×‘×œ×•×§×™ ×–××Ÿ ×œ×”×•×¨××”"}),e.jsxs("button",{type:"button",onClick:C,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 ml-2"}),"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ"]})]}),l.teaching.schedule.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"×œ× ×”×•×’×“×¨×• ×‘×œ×•×§×™ ×–××Ÿ"}),e.jsx("p",{className:"text-sm",children:"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ ×›×“×™ ×œ×§×‘×•×¢ ××ª×™ ×”××•×¨×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}):e.jsx("div",{className:"space-y-4",children:l.teaching.schedule.map((s,h)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×™×•×"}),e.jsx("select",{value:s.day,onChange:j=>N(h,"day",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white",children:Ss.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:s.startTime,onChange:j=>N(h,"startTime",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:s.endTime,onChange:j=>N(h,"endTime",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"}),s.startTime&&s.endTime&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const j=Ye(s.startTime,s.endTime),D=lt(s.startTime,s.endTime);return D?e.jsx("span",{className:"text-red-600",children:D}):j>0?e.jsxs("span",{className:"text-gray-500",children:["××©×š: ",j," ×“×§×•×ª"]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××™×§×•×"}),e.jsxs("select",{value:s.location,onChange:j=>N(h,"location",j.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white ${S[`schedule.${h}.location`]?"border-red-300 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×..."}),Ve.map(j=>e.jsx("option",{value:j,children:j},j))]}),S[`schedule.${h}.location`]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:S[`schedule.${h}.location`]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×”×¢×¨×•×ª"}),e.jsx("input",{type:"text",value:s.notes,onChange:j=>N(h,"notes",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500 bg-white",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>L(h),className:"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-1"}),"×”×¡×¨"]})})]},h))})]}),i==="conducting"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×ª×–××•×¨×•×ª ×œ× ×™×¦×•×—"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×ª×–××•×¨×•×ª ×©×”××•×¨×” ×™× ×¦×—"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:y.map(s=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-purple-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:l.conducting.orchestraIds.includes(s._id),onChange:h=>{const j=h.target.checked?[...l.conducting.orchestraIds,s._id]:l.conducting.orchestraIds.filter(D=>D!==s._id);b("conducting","orchestraIds",j)},className:"rounded-lg border-gray-300 text-purple-600 focus:ring-purple-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-purple-700 transition-colors",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:s.description||"×ª×–××•×¨×ª ×œ×œ× ×ª×™××•×¨"}),s.memberCount&&e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["ğŸ‘¥ ",s.memberCount," ×—×‘×¨×™×"]})]})]},s._id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×× ×¡××‘×œ×™× ×œ×”×“×¨×›×”"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×× ×¡××‘×œ×™× ×©×”××•×¨×” ×™×“×¨×™×š"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:m.map(s=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:l.ensemblesIds.includes(s._id),onChange:h=>{const j=h.target.checked?[...l.ensemblesIds,s._id]:l.ensemblesIds.filter(D=>D!==s._id);x(D=>({...D,ensemblesIds:j}))},className:"rounded-lg border-gray-300 text-green-600 focus:ring-green-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-green-700 transition-colors",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:s.description||"×× ×¡××‘×œ ×œ×œ× ×ª×™××•×¨"}),s.memberCount&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ğŸµ ",s.memberCount," ×—×‘×¨×™×"]})]})]},s._id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200",children:[$&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:$})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:A,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:A,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[A?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),A?"×©×•××¨...":"×©××•×¨ ××•×¨×”"]})]})]})]})]})})};function Cs({theoryLesson:t,theoryLessons:r,teachers:o,onSubmit:c,onCancel:i,mode:n="create"}){const[l,x]=d.useState("single"),[y,u]=d.useState({category:"××’××”",teacherId:"",date:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],attendance:{present:[],absent:[]},notes:"",syllabus:"",homework:"",schoolYearId:""}),[m,T]=d.useState({category:"××’××”",teacherId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:"",syllabus:"",excludeDates:[],schoolYearId:""}),[A,I]=d.useState(o||[]),[S,P]=d.useState(!1),[$,V]=d.useState(!1),[g,v]=d.useState(""),[b,k]=d.useState(""),C=["×ª×œ××™×“×™× ×—×“×©×™× ×‘-×“","××ª×—×™×œ×™×","××ª×—×™×œ×™× ×‘","××ª×—×™×œ×™× ×“","××ª×§×“××™× ×‘","××ª×§×“××™× ×","××ª×§×“××™× ×’","×ª×œ××™×“×™× ×—×“×©×™× ×‘×•×’×¨×™× (×” - ×˜)","×ª×œ××™×“×™× ×—×“×©×™× ×¦×¢×™×¨×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×§×œ××¡×™ ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×‘","××’××”","×ª××•×¨×™×” ×›×œ×™"],L={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"};d.useEffect(()=>{o||N(),R()},[o]),d.useEffect(()=>{if(n==="edit"&&t){const s=new Date(t.date);u({category:t.category||"××’××”",teacherId:t.teacherId||"",date:t.date?new Date(t.date).toISOString().split("T")[0]:"",dayOfWeek:t.dayOfWeek!==void 0?t.dayOfWeek:s.getDay(),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||"××•×œ× ×¢×¨×Ÿ",studentIds:t.studentIds||[],attendance:t.attendance||{present:[],absent:[]},notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||""}),T(h=>({...h,category:t.category||"××’××”",teacherId:t.teacherId||"",location:t.location||"××•×œ× ×¢×¨×Ÿ",startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",notes:t.notes||"",syllabus:t.syllabus||"",schoolYearId:t.schoolYearId||""}))}else if(n==="bulk-edit"&&r&&r.length>0){const s=r[0],h=r.every(J=>J.category===s.category)?s.category:"",j=r.every(J=>J.teacherId===s.teacherId)?s.teacherId:"",D=r.every(J=>J.location===s.location)?s.location:"",W=r.every(J=>J.startTime===s.startTime)?s.startTime:"",ee=r.every(J=>J.endTime===s.endTime)?s.endTime:"",me=r.every(J=>J.notes===s.notes)?s.notes:"",he=r.every(J=>J.syllabus===s.syllabus)?s.syllabus:"";T({category:h||"××’××”",teacherId:j||"",startDate:"",endDate:"",dayOfWeek:0,startTime:W||"14:00",endTime:ee||"15:00",location:D||"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:me||"",syllabus:he||"",excludeDates:[],schoolYearId:s.schoolYearId||""})}},[t,r,n]);const N=async()=>{try{const h=(await Vt.getTeachers()).filter(j=>j.roles&&j.roles.includes("××•×¨×” ×ª××•×¨×™×”"));I(h)}catch(s){console.error("Error loading teachers:",s)}},R=async()=>{try{const s=await Yt.getCurrentSchoolYear();s&&(y.schoolYearId||u(h=>({...h,schoolYearId:s._id})),m.schoolYearId||T(h=>({...h,schoolYearId:s._id})))}catch(s){console.error("Error loading current school year:",s)}},_=(s,h)=>{if(n==="edit"||n==="create"&&l==="single"){if(u(j=>({...j,[s]:h})),s==="date"&&h){const D=new Date(h).getDay();u(W=>({...W,date:h,dayOfWeek:D}))}}else T(j=>({...j,[s]:h}))},B=()=>{if(l==="single"){if(!y.category.trim())return v("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨"),!1;if(!y.teacherId)return v("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨"),!1;if(!y.date)return v("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ×©×™×¢×•×¨"),!1;if(!y.startTime||!y.endTime)return v("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!y.location.trim())return v("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨"),!1;const s=y.startTime.split(":").map(Number),h=y.endTime.split(":").map(Number),j=s[0]*60+s[1];if(h[0]*60+h[1]<=j)return v("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}else{if(!m.category.trim())return v("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨×™×"),!1;if(!m.teacherId)return v("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨×™×"),!1;if(!m.startDate||!m.endDate)return v("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×›×™ ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!m.startTime||!m.endTime)return v("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!m.location.trim())return v("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨×™×"),!1;if(m.dayOfWeek<0||m.dayOfWeek>6)return v("×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),!1;if(!m.schoolYearId)return v("×™×© ×œ×‘×—×•×¨ ×©× ×ª ×œ×™××•×“×™×"),!1;if(new Date(m.endDate)<=new Date(m.startDate))return v("×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),!1;const s=m.startTime.split(":").map(Number),h=m.endTime.split(":").map(Number),j=s[0]*60+s[1];if(h[0]*60+h[1]<=j)return v("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}return!0},K=async s=>{if(s.preventDefault(),v(""),k(""),!!B()){P(!0);try{if(n==="edit"){const h={...y,date:new Date(y.date+"T"+y.startTime+":00.000Z").toISOString(),mode:"edit",lessonId:t?._id};await c(h),k("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”")}else if(n==="bulk-edit"){const h={};m.category&&m.category.trim()&&(h.category=m.category),m.teacherId&&m.teacherId.trim()&&(h.teacherId=m.teacherId),m.location&&m.location.trim()&&(h.location=m.location),m.startTime&&m.startTime.trim()&&(h.startTime=m.startTime),m.endTime&&m.endTime.trim()&&(h.endTime=m.endTime),m.notes&&m.notes.trim()&&(h.notes=m.notes),m.syllabus&&m.syllabus.trim()&&(h.syllabus=m.syllabus);const j={mode:"bulk-edit",lessonIds:r?.map(D=>D._id)||[],updateData:h};await c(j),k(`${r?.length||0} ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”`)}else if(l==="single"){const h={...y,date:new Date(y.date+"T"+y.startTime+":00.000Z").toISOString(),mode:"create"};await c(h),k("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}else{const h={...m,isBulk:!0,mode:"bulk-create"};console.log("ğŸš€ Bulk theory lesson creation data:",JSON.stringify(h,null,2));const D=["category","teacherId","startDate","endDate","dayOfWeek","startTime","endTime","location","schoolYearId"].filter(W=>{const ee=h[W];return ee==null||typeof ee=="string"&&ee.trim()===""});if(D.length>0){console.error("âŒ Missing required fields:",D),v(`×—×¡×¨×™× ×©×“×•×ª ×—×•×‘×”: ${D.join(", ")}`);return}await c(h),k("×¨×¦×£ ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}}catch(h){console.error("Error submitting theory lesson form:",h),v(h.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×©×™×¢×•×¨")}finally{P(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n==="edit"?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":n==="bulk-edit"?"×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”":"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5 text-gray-500"})})]}),n==="create"&&e.jsxs("div",{className:"flex space-x-4 rtl:space-x-reverse",children:[e.jsxs("button",{type:"button",onClick:()=>x("single"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${l==="single"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"×©×™×¢×•×¨ ×‘×•×“×“"]}),e.jsxs("button",{type:"button",onClick:()=>x("bulk"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${l==="bulk"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Xt,{className:"w-4 h-4 ml-2"}),"×¨×¦×£ ×©×™×¢×•×¨×™×"]})]}),n==="bulk-edit"&&r&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600 ml-2"}),e.jsxs("p",{className:"text-blue-800",children:["×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ",r.length," ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"]})]}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"×©×“×•×ª ×¨×™×§×™× ×™×™×©××¨×• ×œ×œ× ×©×™× ×•×™, ×¨×§ ×©×“×•×ª ×©×™××•×œ××• ×™×¢×•×“×›× ×•"})]})]}),e.jsxs("form",{onSubmit:K,className:"p-6 space-y-6",children:[$&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 ml-2"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×™×¢×•×¨..."})]})}),b&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800 text-sm",children:b})}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:g})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(we,{className:"w-4 h-4 inline ml-1"}),"×§×˜×’×•×¨×™×” *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?y.category:m.category,onChange:s=>_("category",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),C.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××•×¨×” *"}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?y.teacherId:m.teacherId,onChange:s=>_("teacherId",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[e.jsx("option",{value:"",children:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™":"×‘×—×¨ ××•×¨×”"}),A.map(s=>e.jsx("option",{value:s._id,children:s.personalInfo?.fullName},s._id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?y.location:m.location,onChange:s=>_("location",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),Ve.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),n==="edit"||n==="create"&&l==="single"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š *"}),e.jsx("input",{type:"date",value:y.date,onChange:s=>_("date",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("input",{type:"text",value:L[y.dayOfWeek]||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:y.startTime,onChange:s=>_("startTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:y.endTime,onChange:s=>_("endTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]}):n==="bulk-edit"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:m.startTime,onChange:s=>_("startTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:m.endTime,onChange:s=>_("endTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×”×ª×—×œ×” *"}),e.jsx("input",{type:"date",value:m.startDate,onChange:s=>_("startDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•× *"}),e.jsx("input",{type:"date",value:m.endDate,onChange:s=>_("endDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:m.dayOfWeek,onChange:s=>_("dayOfWeek",parseInt(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0,children:Object.entries(L).map(([s,h])=>e.jsx("option",{value:s,children:h},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:m.startTime,onChange:s=>_("startTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:m.endTime,onChange:s=>_("endTime",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×™×œ×‘×•×¡"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&l==="single"?y.syllabus:m.syllabus,onChange:s=>_("syllabus",s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - × ×•×©××™ ×”×©×™×¢×•×¨...":n==="edit"||l==="single"?"× ×•×©××™ ×”×©×™×¢×•×¨...":"× ×•×©××™ ×”×©×™×¢×•×¨×™×..."})]}),n==="edit"||n==="create"&&l==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨×™ ×‘×™×ª"}),e.jsx("textarea",{value:y.homework,onChange:s=>_("homework",s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"××©×™××•×ª ×œ×‘×™×ª..."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&l==="single"?y.notes:m.notes,onChange:s=>_("notes",s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª...":"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:S,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:S,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[S?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),n==="edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨":n==="bulk-edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨×™×":l==="single"?"×¦×•×¨ ×©×™×¢×•×¨":"×¦×•×¨ ×¨×¦×£ ×©×™×¢×•×¨×™×"]})]})]})]})})}const St={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"},Es=Object.entries(St).map(([t,r])=>({value:parseInt(t),label:r})),qe=t=>St[t]||"×œ× ×™×“×•×¢",_s=t=>{const r=new Date(t.date).toLocaleDateString("he-IL"),o=`${t.startTime} - ${t.endTime}`,c=qe(t.dayOfWeek),i=`${c}, ${r} ${o}`;return{date:r,time:o,dayName:c,fullDateTime:i}},Ce=(t,r)=>{const o=oe(t);return oe(r)-o},oe=t=>{const[r,o]=t.split(":").map(Number);return r*60+o},ot=t=>{const r=t.attendance?.present?.length||0,o=t.attendance?.absent?.length||0,c=t.orchestra?.memberIds?.length||r+o,i=c>0?Math.round(r/c*100):0;return{presentCount:r,absentCount:o,totalMembers:c,attendanceRate:i,hasAttendanceData:r>0||o>0}},As=t=>{if(!t.isActive)return{status:"cancelled",text:"×‘×•×˜×œ×”",colorClass:"bg-gray-100 text-gray-800"};const r=new Date;new Date(t.date);const o=new Date(`${t.date}T${t.startTime}:00`),c=new Date(`${t.date}T${t.endTime}:00`);return r<o?{status:"upcoming",text:"×¢×ª×™×“×”",colorClass:"bg-blue-100 text-blue-800"}:r>=o&&r<=c?{status:"in_progress",text:"××ª×§×™×™××ª ×›×¢×ª",colorClass:"bg-green-100 text-green-800"}:{status:"completed",text:"×”×¡×ª×™×™××”",colorClass:"bg-orange-100 text-orange-800"}},it=(t,r)=>{if(t.date!==r.date)return{hasConflict:!1,conflictType:"none",severity:"none",message:""};if(t.groupId===r.groupId)return{hasConflict:!1,conflictType:"none",severity:"none",message:"××•×ª×” ×ª×–××•×¨×ª"};const o=oe(t.startTime),c=oe(t.endTime),i=oe(r.startTime),n=oe(r.endTime);if(o<n&&i<c){if(t.location===r.location)return{hasConflict:!0,conflictType:"location",severity:"critical",message:`×—×¤×™×¤×” ×‘××™×§×•×: ${t.location}`};const x=t.orchestra?.conductor?._id,y=r.orchestra?.conductor?._id;if(x&&y&&x===y)return{hasConflict:!0,conflictType:"conductor",severity:"critical",message:"××•×ª×• ×× ×¦×— ×‘×©× ×™ ××§×•××•×ª"};const u=new Set(t.orchestra?.memberIds||[]),m=new Set(r.orchestra?.memberIds||[]),T=[...u].filter(A=>m.has(A));return T.length>0?{hasConflict:!0,conflictType:"members",severity:"warning",message:`${T.length} ×—×‘×¨×™× ××©×•×ª×¤×™×`}:{hasConflict:!0,conflictType:"time",severity:"warning",message:"×—×¤×™×¤×ª ×–×× ×™×"}}return{hasConflict:!1,conflictType:"none",severity:"none",message:""}},Nr=(t,r)=>t.filter(o=>{if(r.searchQuery){const c=r.searchQuery.toLowerCase();if(!(o.orchestra?.name?.toLowerCase().includes(c)||o.location?.toLowerCase().includes(c)||o.notes?.toLowerCase().includes(c)||qe(o.dayOfWeek).toLowerCase().includes(c)))return!1}if(r.orchestraId&&o.groupId!==r.orchestraId||r.type&&o.type!==r.type||r.dayOfWeek!==""&&r.dayOfWeek!==void 0&&o.dayOfWeek!==r.dayOfWeek||r.location&&o.location!==r.location)return!1;if(r.startDate){const c=new Date(o.date),i=new Date(r.startDate);if(c<i)return!1}if(r.endDate){const c=new Date(o.date),i=new Date(r.endDate);if(c>i)return!1}return!(r.status&&r.status!=="all"&&As(o).status!==r.status||r.isActive!==void 0&&o.isActive!==r.isActive)}),wr=(t,r="date",o="asc")=>[...t].sort((i,n)=>{let l=0;switch(r){case"date":l=new Date(i.date).getTime()-new Date(n.date).getTime();break;case"time":l=oe(i.startTime)-oe(n.startTime);break;case"orchestra":const x=i.orchestra?.name||"",y=n.orchestra?.name||"";l=x.localeCompare(y,"he");break;case"location":l=i.location.localeCompare(n.location,"he");break;case"attendance":const u=ot(i).attendanceRate,m=ot(n).attendanceRate;l=u-m;break;case"duration":const T=Ce(i.startTime,i.endTime),A=Ce(n.startTime,n.endTime);l=T-A;break;default:l=0}return o==="desc"?-l:l}),Os=t=>{const r=[],o=new Date(t.startDate),c=new Date(t.endDate),i=t.dayOfWeek,n=new Set(t.excludeDates||[]),l=new Date(o);for(;l.getDay()!==i&&l<=c;)l.setDate(l.getDate()+1);for(;l<=c;){const x=l.toISOString().split("T")[0];n.has(x)||r.push(x),l.setDate(l.getDate()+7)}return r},Rs=t=>{const r={};if(t.groupId?.trim()||(r.groupId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.type||(r.type="×™×© ×œ×‘×—×•×¨ ×¡×•×’ ×”×¨×›×‘"),!t.date)r.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const o=new Date(t.date),c=new Date;c.setHours(0,0,0,0),o<c&&(r.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(t.startTime||(r.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(r.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime){const o=Ce(t.startTime,t.endTime);o<=0?r.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":o>300&&(r.endTime="××©×š ×”×—×–×¨×” ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-5 ×©×¢×•×ª")}return t.location?.trim()||(r.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(r).length===0,errors:r}},Ps=t=>{const r={};if(t.orchestraId?.trim()||(r.orchestraId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.startDate||(r.startDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×”×ª×—×œ×”"),t.endDate||(r.endDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×¡×™×•×"),t.startDate&&t.endDate){const o=new Date(t.startDate),c=new Date(t.endDate);o>=c&&(r.endDate="×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),(c.getTime()-o.getTime())/(1e3*60*60*24)>365&&(r.endDate="×ª×§×•×¤×” ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×™×•×ª×¨ ××©× ×”")}return(t.dayOfWeek===void 0||t.dayOfWeek<0||t.dayOfWeek>6)&&(r.dayOfWeek="×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),t.startTime||(r.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(r.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime&&Ce(t.startTime,t.endTime)<=0&&(r.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),t.location?.trim()||(r.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(r).length===0,errors:r}},Tr=t=>{switch(t.orchestra?.type||t.type){case"×ª×–××•×¨×ª":return"bg-blue-500";case"×”×¨×›×‘":return"bg-pink-500";default:return"bg-gray-500"}};function $s({newRehearsal:t,bulkData:r,existingRehearsals:o,orchestras:c,onConflictsChanged:i}){const[n,l]=d.useState([]),[x,y]=d.useState(!1);d.useEffect(()=>{t||r?u():l([])},[t,r,o]),d.useEffect(()=>{i?.(n)},[n,i]);const u=async()=>{y(!0);try{let g=[];t?g=await m(t):r&&(g=await T(r)),l(g)}catch(g){console.error("Error detecting conflicts:",g)}finally{y(!1)}},m=async g=>{const v=[],b={_id:"temp",groupId:g.groupId,type:g.type,date:g.date,dayOfWeek:new Date(g.date).getDay(),startTime:g.startTime,endTime:g.endTime,location:g.location,attendance:{present:[],absent:[]},notes:g.notes||"",schoolYearId:"current",isActive:g.isActive,orchestra:c.find(k=>k._id===g.groupId)};for(const k of o){if(k.groupId===g.groupId&&k.date===g.date)continue;const C=it(b,k);C.hasConflict&&v.push({...C,conflictingRehearsal:k,affectedDate:g.date})}return v},T=async g=>{const v=[],b=A(g),k=c.find(C=>C._id===g.orchestraId);for(const C of b){const L={_id:"temp",groupId:g.orchestraId,type:k?.type||"×ª×–××•×¨×ª",date:C,dayOfWeek:new Date(C).getDay(),startTime:g.startTime,endTime:g.endTime,location:g.location,attendance:{present:[],absent:[]},notes:g.notes||"",schoolYearId:g.schoolYearId,isActive:!0,orchestra:k};for(const N of o){if(N.groupId===g.orchestraId&&N.date===C)continue;const R=it(L,N);R.hasConflict&&v.push({...R,conflictingRehearsal:N,affectedDate:C})}}return v},A=g=>{const v=[],b=new Date(g.startDate),k=new Date(g.endDate),C=g.dayOfWeek,L=new Set(g.excludeDates||[]),N=new Date(b);for(;N.getDay()!==C&&N<=k;)N.setDate(N.getDate()+1);for(;N<=k;){const R=N.toISOString().split("T")[0];L.has(R)||v.push(R),N.setDate(N.getDate()+7)}return v},I=g=>{switch(g){case"critical":return e.jsx(Ze,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(et,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(De,{className:"w-5 h-5 text-green-600"})}},S=g=>{switch(g){case"location":return e.jsx(ve,{className:"w-4 h-4"});case"conductor":return e.jsx(ie,{className:"w-4 h-4"});case"members":return e.jsx(le,{className:"w-4 h-4"});case"time":return e.jsx(ne,{className:"w-4 h-4"});default:return e.jsx(De,{className:"w-4 h-4"})}},P=g=>{switch(g){case"critical":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-green-50 border-green-200 text-green-800"}},$=n.filter(g=>g.severity==="critical"),V=n.filter(g=>g.severity==="warning");return x?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"×‘×•×“×§ ×”×ª× ×’×©×•×™×•×ª..."})]})}):n.length===0&&(t||r)?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"w-5 h-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-sm text-green-800",children:"×œ× × ××¦××• ×”×ª× ×’×©×•×™×•×ª - × ×™×ª×Ÿ ×œ×™×¦×•×¨ ××ª ×”×—×–×¨×”"})]})}):n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"×¡×™×›×•× ×”×ª× ×’×©×•×™×•×ª"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[$.length>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(Ze,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[$.length," ×§×¨×™×˜×™×•×ª"]})]}),V.length>0&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(et,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[V.length," ××–×”×¨×•×ª"]})]})]})]}),$.length>0&&e.jsx("p",{className:"text-sm text-red-800",children:"× ××¦××• ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×©××•× ×¢×•×ª ×™×¦×™×¨×ª ×”×—×–×¨×”. ×™×© ×œ×¤×ª×•×¨ ××•×ª×Ÿ ×œ×¤× ×™ ×”××©×š."}),V.length>0&&$.length===0&&e.jsx("p",{className:"text-sm text-yellow-800",children:"× ××¦××• ××–×”×¨×•×ª ×©×›×“××™ ×œ×‘×“×•×§. × ×™×ª×Ÿ ×œ×”××©×™×š ×‘×™×¦×™×¨×ª ×”×—×–×¨×” ××š ××•××œ×¥ ×œ×•×•×“×."})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n.map((g,v)=>e.jsx("div",{className:`border rounded-lg p-3 ${P(g.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-2",children:[I(g.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[S(g.conflictType),e.jsx("span",{className:"font-medium text-sm",children:g.message})]}),g.conflictingRehearsal&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:g.conflictingRehearsal.orchestra?.name}),e.jsx("span",{children:_s(g.conflictingRehearsal).fullDateTime}),e.jsx("span",{children:g.conflictingRehearsal.location})]})}),g.affectedDate&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["×ª××¨×™×š ××ª× ×’×©: ",new Date(g.affectedDate).toLocaleDateString("he-IL")]})]})]})})},v))}),$.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"×¤×¢×•×œ×•×ª ××•××œ×¦×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[$.some(g=>g.conflictType==="location")&&e.jsx("li",{children:"×©× ×” ××ª ××™×§×•× ×”×—×–×¨×” ××• ×‘×—×¨ ×–××Ÿ ××—×¨"}),$.some(g=>g.conflictType==="conductor")&&e.jsx("li",{children:"×ª×× ×¢× ×”×× ×¦×— ××• ×©× ×” ××ª ×–××Ÿ ×”×—×–×¨×”"}),$.some(g=>g.conflictType==="time")&&e.jsx("li",{children:"×‘×—×¨ ×–××Ÿ ××—×¨ ××• ×ª××¨×™×š ××—×¨"})]})]})]})}function Ls({orchestras:t,existingRehearsals:r=[],onSubmit:o,onCancel:c,initialData:i}){const[n,l]=d.useState("single"),[x,y]=d.useState(!1),[u,m]=d.useState({}),[T,A]=d.useState({groupId:"",type:"×ª×–××•×¨×ª",date:"",startTime:"19:00",endTime:"21:00",location:"",notes:"",isActive:!0,...i}),[I,S]=d.useState({orchestraId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"19:00",endTime:"21:00",location:"",notes:"",excludeDates:[],schoolYearId:"current"}),[P,$]=d.useState(""),[V,g]=d.useState([]),[v,b]=d.useState(!1),[k,C]=d.useState(!1);d.useEffect(()=>{if(n==="single"&&T.groupId){const s=t.find(h=>h._id===T.groupId);s&&!T.location&&A(h=>({...h,location:s.location,type:s.type}))}},[T.groupId,t,n]),d.useEffect(()=>{if(n==="bulk"&&I.orchestraId){const s=t.find(h=>h._id===I.orchestraId);s&&!I.location&&S(h=>({...h,location:s.location}))}},[I.orchestraId,t,n]),d.useEffect(()=>{if(n==="bulk"&&I.startDate&&I.endDate&&I.dayOfWeek!==void 0)try{const s=Os(I);g(s)}catch{g([])}else g([])},[n,I.startDate,I.endDate,I.dayOfWeek,I.excludeDates]);const L=(s,h)=>{A(j=>({...j,[s]:h})),u[s]&&m(j=>({...j,[s]:""}))},N=(s,h)=>{S(j=>({...j,[s]:h})),u[s]&&m(j=>({...j,[s]:""}))},R=()=>{P&&(S(s=>({...s,excludeDates:[...s.excludeDates||[],P]})),$(""))},_=s=>{S(h=>({...h,excludeDates:(h.excludeDates||[]).filter(j=>j!==s)}))},B=s=>{b(s.length>0),C(s.some(h=>h.severity==="critical"))},K=async s=>{s.preventDefault(),y(!0),m({});try{if(k){m({submit:"×™×© ×œ×¤×ª×•×¨ ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×œ×¤× ×™ ×™×¦×™×¨×ª ×”×—×–×¨×”"});return}if(n==="single"){const h=Rs(T);if(!h.isValid){m(h.errors);return}const D=new Date(T.date).getDay(),W={...T,dayOfWeek:D};await o(W,!1)}else{const h=Ps(I);if(!h.isValid){m(h.errors);return}await o(I,!0)}}catch(h){m({submit:h.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×—×–×¨×”"})}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:c,children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i?"×¢×¨×•×š ×—×–×¨×”":"×—×–×¨×” ×—×“×©×”"}),!i&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>l("single"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×” ×™×—×™×“×”"}),e.jsx("button",{type:"button",onClick:()=>l("bulk"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="bulk"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×•×ª ×—×•×–×¨×•×ª"})]})})]}),e.jsx("div",{className:"w-8"})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[n==="single"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:T.groupId||"",onChange:s=>L("groupId",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.groupId?"border-red-300":"border-gray-300"}`,disabled:!!i,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(s=>e.jsxs("option",{value:s._id,children:[s.name," (",s.type,")"]},s._id))]}),u.groupId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.groupId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š"]}),e.jsx("input",{type:"date",value:T.date||"",onChange:s=>L("date",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.date?"border-red-300":"border-gray-300"}`}),u.date&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:T.startTime||"",onChange:s=>L("startTime",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startTime?"border-red-300":"border-gray-300"}`}),u.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:T.endTime||"",onChange:s=>L("endTime",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endTime?"border-red-300":"border-gray-300"}`}),u.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:T.location||"",onChange:s=>L("location",s.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.location?"border-red-300":"border-gray-300"}`}),u.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:T.notes||"",onChange:s=>L("notes",s.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×”×—×–×¨×”...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:I.orchestraId||"",onChange:s=>N("orchestraId",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.orchestraId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(s=>e.jsxs("option",{value:s._id,children:[s.name," (",s.type,")"]},s._id))]}),u.orchestraId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.orchestraId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š ×”×ª×—×œ×”"]}),e.jsx("input",{type:"date",value:I.startDate||"",onChange:s=>N("startDate",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startDate?"border-red-300":"border-gray-300"}`}),u.startDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•×"}),e.jsx("input",{type:"date",value:I.endDate||"",onChange:s=>N("endDate",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endDate?"border-red-300":"border-gray-300"}`}),u.endDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endDate})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("select",{value:I.dayOfWeek||0,onChange:s=>N("dayOfWeek",parseInt(s.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.dayOfWeek?"border-red-300":"border-gray-300"}`,children:Es.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),u.dayOfWeek&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.dayOfWeek})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:I.startTime||"",onChange:s=>N("startTime",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startTime?"border-red-300":"border-gray-300"}`}),u.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:I.endTime||"",onChange:s=>N("endTime",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endTime?"border-red-300":"border-gray-300"}`}),u.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:I.location||"",onChange:s=>N("location",s.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.location?"border-red-300":"border-gray-300"}`}),u.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×›×™× ×œ×“×™×œ×•×’"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:P,onChange:s=>$(s.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"×‘×—×¨ ×ª××¨×™×š ×œ×“×™×œ×•×’"}),e.jsx("button",{type:"button",onClick:R,disabled:!P,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(xe,{className:"w-4 h-4"})})]}),I.excludeDates&&I.excludeDates.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:I.excludeDates.map(s=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg px-2 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:new Date(s).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",onClick:()=>_(s),className:"mr-1 text-gray-500 hover:text-red-600",children:e.jsx(qt,{className:"w-3 h-3"})})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:I.notes||"",onChange:s=>N("notes",s.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ×”×—×–×¨×•×ª...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),V.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-blue-600 ml-1"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["×ª×™×•×•×¦×¨×• ",V.length," ×—×–×¨×•×ª"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 max-h-32 overflow-y-auto",children:[V.slice(0,10).map(s=>e.jsxs("div",{children:[new Date(s).toLocaleDateString("he-IL")," - ",qe(new Date(s).getDay())]},s)),V.length>10&&e.jsxs("div",{className:"text-blue-600",children:["...×•×¢×•×“ ",V.length-10]})]})]})]}),e.jsx($s,{newRehearsal:n==="single"?T:null,bulkData:n==="bulk"?I:null,existingRehearsals:r,orchestras:t,onConflictsChanged:B}),u.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:u.submit})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:x||k,className:`px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors ${x||k?"opacity-50 cursor-not-allowed":""}`,children:x?"×©×•××¨...":i?"×¢×“×›×Ÿ ×—×–×¨×”":n==="single"?"×¦×•×¨ ×—×–×¨×”":`×¦×•×¨ ${V.length} ×—×–×¨×•×ª`})]})]})]})})})}const Us=[{name:"××™×“×¢ ×›×œ×œ×™",href:"/dashboard",icon:Te,category:"general"},{name:"×ª×œ××™×“×™×",href:"/students",icon:le,category:"management",roles:["admin"]},{name:"××•×¨×™×",href:"/teachers",icon:pt,category:"management",roles:["admin"]},{name:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:we,category:"management",roles:["admin"]},{name:"×ª×–××•×¨×•×ª",href:"/orchestras",icon:_e,category:"management",roles:["admin"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:te,category:"management",roles:["admin"]},{name:"×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"operations",roles:["admin"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["admin"]},{name:"×“×•×—×•×ª",href:"/reports",icon:Kt,category:"management",roles:["admin"]},{name:"×”×’×“×¨×•×ª",href:"/settings",icon:Ne,category:"system",roles:["admin"]}],Bs=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×ª×œ××™×“×™× ×©×œ×™",href:"/students",icon:le,category:"personal",roles:["teacher"]},{name:"×œ×•×— ×–×× ×™× ×©×œ×™",href:"/profile",icon:te,category:"personal",roles:["teacher"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["teacher"]},{name:"× ×™×”×•×œ ×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"operations",roles:["teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ie,category:"personal"}],Fs=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×ª×–××•×¨×•×ª ×©×œ×™",href:"/orchestras",icon:_e,category:"personal",roles:["conductor"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:te,category:"personal",roles:["conductor"]},{name:"× ×•×›×—×•×ª",href:"/conductor/attendance",icon:Ae,category:"operations",roles:["conductor"]},{name:"× ×™×”×•×œ ×¨×™×©×•××™×",href:"/conductor/enrollment",icon:yt,category:"operations",roles:["conductor"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ie,category:"personal"}],Ms=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×©×™×¢×•×¨×™× ×©×œ×™",href:"/theory-lessons",icon:we,category:"personal",roles:["theory-teacher"]},{name:"×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:le,category:"personal",roles:["theory-teacher"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["theory-teacher"]},{name:"×ª×›× ×™×ª ×œ×™××•×“×™×",href:"/theory-lessons",icon:Jt,category:"personal",roles:["theory-teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ie,category:"personal"}],ct={admin:[{name:"×”×•×¡×£ ×ª×œ××™×“ ×—×“×©",href:"/students/new",icon:le,role:"admin"},{name:"×”×•×¡×£ ××•×¨×” ×—×“×©",href:"/teachers/new",icon:pt,role:"admin"},{name:"×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:we,role:"admin"},{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:te,role:"admin"}],teacher:[{name:"×”×•×¡×£ ×©×™×¢×•×¨",href:"/profile",icon:xe,role:"teacher"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/attendance",icon:tt,role:"teacher"},{name:"×¦×¤×” ×‘×œ×•×— ×–×× ×™×",href:"/profile",icon:ne,role:"teacher"}],conductor:[{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:st,role:"conductor"},{name:"× ×”×œ ×ª×–××•×¨×ª",href:"/orchestras",icon:_e,role:"conductor"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/conductor/attendance",icon:tt,role:"conductor"}],"theory-teacher":[{name:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:st,role:"theory-teacher"},{name:"× ×”×œ ×§×‘×•×¦×•×ª",href:"/theory-lessons",icon:yt,role:"theory-teacher"},{name:"×“×¨×’ ×ª×œ××™×“×™×",href:"/theory-lessons",icon:ze,role:"theory-teacher"}]};function Vs(){const t=Ut(),r=Ee(),{user:o,isLoading:c}=fe(),{isDesktopOpen:i,setIsDesktopOpen:n,isMobile:l}=Xe(),[x,y]=d.useState(""),[u,m]=d.useState(!1),[T,A]=d.useState(new Set),[I,S]=d.useState(!1),[P,$]=d.useState(!1),[V,g]=d.useState(!1),[v,b]=d.useState(!1),[k,C]=d.useState([]),[L,N]=d.useState(!1),R=w=>t.pathname===w,B=(()=>{if(!o)return["admin"];const w=[];return o.role==="admin"||o.role==="×× ×”×œ"||o.roles?.includes("admin")||o.roles?.includes("×× ×”×œ")?["admin"]:(o.role&&w.push(o.role),o.roles&&Array.isArray(o.roles)&&w.push(...o.roles),o.teaching?.studentIds?.length>0&&!w.includes("teacher")&&w.push("teacher"),o.conducting?.orchestraIds?.length>0&&!w.includes("conductor")&&w.push("conductor"),[...new Set(w.map(U=>U==="theory_teacher"?"theory-teacher":U))])})(),K=B.includes("admin"),s=B.length>1,h=()=>{if(K)return Us;const w=new Map,U=[];return B.includes("teacher")&&U.push(...Bs),B.includes("conductor")&&U.push(...Fs),B.includes("theory-teacher")&&U.push(...Ms),U.forEach(M=>{const q=M.href;if(!w.has(q))w.set(q,M);else{const re=w.get(q);M.roles&&re.roles&&(re.roles=[...new Set([...re.roles,...M.roles])])}}),Array.from(w.values())},j=()=>{if(K)return ct.admin;const w=[],U=new Map;return B.forEach(M=>{const q=ct[M];q&&q.forEach(re=>{const be=`${re.href}-${re.name}`;U.has(be)||(U.set(be,!0),w.push(re))})}),w},D=w=>{const U={general:{label:"×›×œ×œ×™",items:[]},personal:{label:"××–×•×¨ ××™×©×™",items:[]},management:{label:"× ×™×”×•×œ ××¢×¨×›×ª",items:[]},operations:{label:"×¤×¢×•×œ×•×ª",items:[]},system:{label:"××¢×¨×›×ª",items:[]}};return w.forEach(M=>{const q=M.category||"general";U[q]&&U[q].items.push(M)}),Object.entries(U).filter(([M,q])=>q.items.length>0).map(([M,q])=>({key:M,...q}))},W=h(),ee=D(W),me=j();d.useEffect(()=>{l||m(!1)},[l]),d.useEffect(()=>{const w=U=>{if(l&&u){const M=document.getElementById("mobile-sidebar"),q=document.getElementById("hamburger-button");M&&!M.contains(U.target)&&q&&!q.contains(U.target)&&m(!1)}};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[l,u]),d.useEffect(()=>(l&&u?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[l,u]);const he=()=>{l&&m(!1)},J=w=>{const U=new Set(T);U.has(w)?U.delete(w):U.add(w),A(U)},ye=w=>{switch(w){case"admin":return"×× ×”×œ";case"teacher":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"theory-teacher":return"××•×¨×” ×ª×™××•×¨×™×”";default:return w}},a=w=>{switch(w){case"admin":return"bg-purple-100 text-purple-700";case"teacher":return"bg-blue-100 text-blue-700";case"conductor":return"bg-green-100 text-green-700";case"theory-teacher":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},f=async(w,U)=>{he(),w==="×”×•×¡×£ ×ª×œ××™×“ ×—×“×©"?S(!0):w==="×”×•×¡×£ ××•×¨×” ×—×“×©"?$(!0):w==="×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"?g(!0):w==="×ª×–××Ÿ ×—×–×¨×”"?(await p(),b(!0)):r(U)},p=async()=>{try{N(!0);const w=await Wt.getOrchestras();C(w||[])}catch(w){console.error("Failed to load orchestras:",w),C([])}finally{N(!1)}},E=async w=>{S(!1)},O=async()=>{$(!1)},Y=async w=>{g(!1)},Q=async w=>{b(!1)};return e.jsxs(e.Fragment,{children:[l&&e.jsx("button",{id:"hamburger-button",onClick:()=>m(!u),className:"fixed top-4 right-4 z-[1001] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-gray-50 transition-colors duration-200","aria-label":"Toggle menu",children:u?e.jsx(ue,{className:"w-6 h-6 text-gray-600"}):e.jsx($e,{className:"w-6 h-6 text-gray-600"})}),!l&&!i&&e.jsx("button",{onClick:()=>n(!0),className:"fixed top-4 right-4 z-[1001] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200","aria-label":"Open sidebar",children:e.jsx($e,{className:"w-5 h-5 text-indigo-600"})}),l&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[999] transition-opacity duration-300",onClick:()=>m(!1)}),e.jsxs("div",{id:"sidebar",className:`fixed top-0 right-0 w-[280px] h-screen bg-white border-l border-gray-200 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.1)] rtl z-[999] transition-transform duration-300 ease-in-out flex flex-col ${l?u?"translate-x-0":"translate-x-full":i?"translate-x-0":"translate-x-full"}`,children:[!l&&e.jsx("button",{onClick:()=>n(!i),className:"absolute top-4 left-4 p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200 z-10","aria-label":"Toggle sidebar",children:i?e.jsx(ue,{className:"w-5 h-5 text-gray-600"}):e.jsx($e,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("div",{className:"p-4 border-b border-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×©...",value:x,onChange:w=>y(w.target.value),className:"w-full pr-10 pl-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm font-reisinger-yonatan text-right rtl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),s&&!K&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(w=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a(w)}`,children:[e.jsx(Qt,{className:"w-3 h-3"}),ye(w)]},w))})}),e.jsx("nav",{className:"flex-1 px-3 py-4 overflow-y-auto overflow-x-hidden min-h-0 custom-scrollbar",children:c?e.jsx("div",{className:"space-y-2 px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})}):e.jsxs(e.Fragment,{children:[ee.map((w,U)=>e.jsxs("div",{className:U>0?"mt-6":"",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("button",{onClick:()=>J(w.key),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700 transition-colors",children:[e.jsx("span",{children:w.label}),e.jsx(ae,{className:`w-3 h-3 transition-transform ${T.has(w.key)?"rotate-180":""}`})]})}),!T.has(w.key)&&e.jsx("div",{className:"space-y-1",children:w.items.map(M=>{const q=M.icon,re=R(M.href);return e.jsxs(de,{to:M.href,onClick:he,className:`flex items-center justify-between px-4 py-3 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan ${re?"bg-primary-50 text-primary-700 border border-primary-200":"text-gray-600 hover:bg-gray-50 hover:text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:M.name}),s&&!K&&M.roles&&M.roles.length===1&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${a(M.roles[0])}`,children:ye(M.roles[0])})]}),e.jsx(q,{className:"w-4 h-4 flex-shrink-0"})]},`${w.key}-${M.href}-${M.name}`)})})]},w.key)),me.length>0&&e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-6 mt-6",children:[e.jsx("h3",{className:"px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),me.map(w=>{const U=w.icon;return e.jsxs("button",{onClick:()=>f(w.name,w.href),className:"w-full flex items-center justify-between px-4 py-2 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan text-gray-600 hover:bg-green-50 hover:text-green-700 group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:w.name}),s&&!K&&w.role&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${a(w.role)}`,children:ye(w.role)})]}),e.jsxs("div",{className:"flex items-center space-x-1 space-x-reverse",children:[e.jsx(xe,{className:"w-3 h-3 group-hover:text-green-500"}),e.jsx(U,{className:"w-3.5 h-3.5"})]})]},`${w.href}-${w.name}-${w.role}`)})]})]})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1002] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Ts,{onSubmit:E,onCancel:()=>S(!1),isEdit:!1,initialData:null})})}),P&&e.jsx(Ds,{isOpen:P,onClose:()=>$(!1),onSuccess:O}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1002] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Cs,{onSubmit:Y,onCancel:()=>g(!1)})})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1002] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:L?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×ª×–××•×¨×•×ª..."})]}):e.jsx(Ls,{orchestras:k,onSubmit:Q,onCancel:()=>b(!1)})})})]})}function Ys(){const[t,r]=d.useState(!1),o=d.useRef(null),{currentSchoolYear:c,schoolYears:i,isLoading:n,setCurrentSchoolYearById:l,getSchoolYearDisplayName:x}=wt();d.useEffect(()=>{const u=m=>{o.current&&!o.current.contains(m.target)&&r(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const y=async u=>{await l(u),r(!1)};return n?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx(te,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]}):e.jsxs("div",{className:"relative",ref:o,children:[e.jsxs("button",{onClick:()=>r(!t),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 ease-in-out min-w-[200px]",style:{direction:"rtl"},children:[e.jsx(te,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan flex-grow text-right truncate",children:c?x(c):"×‘×—×¨ ×©× ×ª ×œ×™××•×“"}),t?e.jsx(ce,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}):e.jsx(ae,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-full min-w-[250px] bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide font-reisinger-yonatan text-right",children:"×©× ×•×ª ×œ×™××•×“"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:i.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 font-reisinger-yonatan text-center",children:"×œ× × ××¦××• ×©× ×•×ª ×œ×™××•×“"}):i.sort((u,m)=>new Date(m.startDate).getTime()-new Date(u.startDate).getTime()).map(u=>{const m=c?._id===u._id,T=u.isCurrent,A=u.isActive;return e.jsxs("button",{onClick:()=>y(u._id),className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${m?"bg-indigo-50 border-l-4 border-indigo-500":""}`,style:{direction:"rtl"},children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${m?"text-indigo-700":"text-gray-700"}`,children:u.name}),T&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"× ×•×›×—×™×ª"}),!A&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"×œ× ×¤×¢×™×œ×”"})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[new Date(u.startDate).toLocaleDateString("he-IL")," - ",new Date(u.endDate).toLocaleDateString("he-IL")]})]}),m&&e.jsx(Zt,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"})]},u._id)})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:e.jsx("button",{className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium font-reisinger-yonatan",children:"+ ×”×•×¡×£ ×©× ×ª ×œ×™××•×“ ×—×“×©×”"})})]})]})}function Ws(){const[t,r]=d.useState(!1),[o,c]=d.useState(!1),i=d.useRef(null),n=d.useRef(null),l=Ee(),{user:x,logout:y}=fe(),{isDesktopOpen:u,isMobile:m}=Xe(),T=!x||x.role==="admin"||x.roles?.includes("admin"),A=T||x?.role==="teacher"||x?.roles?.includes("teacher")||x?.role==="conductor"||x?.roles?.includes("conductor")||x?.role==="theory-teacher"||x?.roles?.includes("theory-teacher")||x?.role==="theory_teacher"||x?.roles?.includes("theory_teacher")||x?.teaching?.studentIds?.length>0||x?.conducting?.orchestraIds?.length>0;d.useEffect(()=>{const b=k=>{i.current&&!i.current.contains(k.target)&&r(!1),n.current&&!n.current.contains(k.target)&&c(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const I=()=>[{icon:rt,label:"×”×ª×¨××•×ª",action:()=>console.log("Notifications")},{icon:te,label:"×œ×•×— ×©× ×”",action:()=>console.log("Calendar")},{icon:Ne,label:"×”×’×“×¨×•×ª",action:()=>console.log("Settings")}],S=()=>{l("/profile"),c(!1)},P=async()=>{try{await y(),l("/login")}catch(b){console.error("Logout error:",b)}c(!1)},$=()=>{l("/dashboard")},V=()=>{const b=x?.personalInfo?.fullName||x?.fullName||x?.name||"";if(!b)return"×";const k=b.trim().split(" ");return k.length>=2?k[0][0]+k[1][0]:k[0][0]||"×"},g=()=>x?.personalInfo?.fullName||x?.fullName||x?.name||"××©×ª××©",v=()=>{const b=x?.role||x?.roles?.[0]||"";switch(b){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return b||"××©×ª××©"}};return e.jsxs("header",{className:"fixed top-0 left-0 h-16 bg-white border-b border-gray-200 flex items-center justify-between z-[998] transition-all duration-300",style:{direction:"rtl",right:A&&!m&&u?"280px":"0",paddingLeft:"1.5rem",paddingRight:A&&!m&&!u?"4rem":"1.5rem"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-10 w-auto object-contain"}),e.jsx(Ys,{})]}),e.jsxs("div",{className:"flex items-center gap-4",style:{direction:"ltr"},children:[!m&&e.jsxs(e.Fragment,{children:[!T&&e.jsx("button",{onClick:$,className:"w-10 h-10 rounded-lg bg-indigo-50 border border-indigo-200 flex items-center justify-center hover:bg-indigo-100 hover:border-indigo-300 transition-all duration-150 ease-in-out cursor-pointer",title:"×œ×•×— ×‘×§×¨×”",children:e.jsx(Te,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(rt,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(te,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(Ne,{className:"w-5 h-5 text-gray-600"})})]}),m&&e.jsxs("div",{className:"relative",ref:i,children:[e.jsx("button",{onClick:()=>r(!t),className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:t?e.jsx(ce,{className:"w-5 h-5 text-gray-600"}):e.jsx(ae,{className:"w-5 h-5 text-gray-600"})}),t&&e.jsx("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:I().map((b,k)=>{const C=b.icon,L=b.label==="×œ×•×— ×‘×§×¨×”";return e.jsxs("button",{onClick:()=>{b.action(),r(!1)},className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${L?"hover:bg-indigo-50":""}`,style:{direction:"rtl"},children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${L?"text-indigo-700":"text-gray-700"}`,children:b.label}),e.jsx(C,{className:`w-4 h-4 ${L?"text-indigo-600":"text-gray-500"}`})]},k)})})]}),e.jsxs("div",{className:"relative",ref:n,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center cursor-pointer hover:bg-indigo-700 transition-colors",onClick:()=>c(!o),children:e.jsx("span",{className:"text-sm font-semibold text-white font-reisinger-yonatan",children:V()})}),o&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:g()}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:v()})]}),e.jsxs("button",{onClick:S,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×¢××•×“ ××™×©×™"}),e.jsx(ie,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs("button",{onClick:P,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 text-red-600 hover:bg-red-50",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium font-reisinger-yonatan",children:"×™×¦×™××”"}),e.jsx(es,{className:"w-4 h-4"})]})]})]})]})]})}function H({children:t}){const{user:r}=fe(),{isDesktopOpen:o,isMobile:c}=Xe(),i=!r||r.role==="admin"||r.roles?.includes("admin")||r.role==="teacher"||r.roles?.includes("teacher")||r.role==="conductor"||r.roles?.includes("conductor")||r.role==="theory-teacher"||r.roles?.includes("theory-teacher")||r.role==="theory_teacher"||r.roles?.includes("theory_teacher")||r.teaching?.studentIds?.length>0||r.conducting?.orchestraIds?.length>0;return e.jsxs("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[i&&e.jsx(Vs,{}),e.jsx(Ws,{}),e.jsx("main",{className:"mt-16 ml-0 p-0 bg-gray-50 min-h-[calc(100vh-64px)] rtl transition-all duration-300",style:{marginRight:i&&!c&&o?"280px":"0"},children:e.jsx("div",{className:"p-6 bg-gray-50",children:t})})]})}function Hs(){const[t,r]=d.useState(""),[o,c]=d.useState(""),[i,n]=d.useState(""),[l,x]=d.useState(!1),y=Ee(),{login:u}=fe(),m=async T=>{T.preventDefault(),n(""),x(!0),console.log("ğŸ” Login attempt started:",{email:t,password:"***"}),console.log("ğŸŒ API Base URL:","https://conservatory-app-backend.onrender.com/api"),console.log("ğŸ”§ Environment check:",{VITE_API_URL:"https://conservatory-app-backend.onrender.com/api",fallback:"http://localhost:3001/api",actual:"https://conservatory-app-backend.onrender.com/api"});try{console.log("ğŸ“¤ Sending login request to API service...");const A=await u(t,o);console.log("âœ… Login successful:",{user:A.user?.personalInfo?.fullName||"Unknown"}),console.log("ğŸ”‘ Authentication token stored successfully"),console.log("ğŸ§­ Navigating to dashboard..."),y("/dashboard")}catch(A){console.error("âŒ Login failed:",A),console.error("ğŸ“ Error details:",{message:A.message,stack:A.stack}),n(A.message||"×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª. ×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×•× ×¡×” ×©×•×‘.")}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×›× ×™×¡×” ×œ××¢×¨×›×ª"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[i&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:i})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:l,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:T=>r(T.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:l,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××”",value:o,onChange:T=>c(T.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"××ª×—×‘×¨..."]}):"×›× ×™×¡×”"})}),e.jsx("div",{className:"text-center",children:e.jsx(de,{to:"/forgot-password",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×©×›×—×ª×™ ×¡×™×¡××"})})]})]})})]})}function zs(){const[t,r]=d.useState(""),[o,c]=d.useState(!1),[i,n]=d.useState(!1),[l,x]=d.useState(""),y=async u=>{u.preventDefault(),x(""),c(!0);try{await gt.forgotPassword(t),n(!0)}catch(m){x(m.message||"×©×’×™××” ×‘×©×œ×™×—×ª ×‘×§×©×ª ××™×¤×•×¡ ×¡×™×¡××”")}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×©×›×—×ª×™ ×¡×™×¡××"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:'×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”×“×•×"×œ ×©×œ×š ×•× ×©×œ×— ×œ×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”'})]}),i?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan",children:'×× ×§×™×™× ×—×©×‘×•×Ÿ ×¢× ×›×ª×•×‘×ª ×“×•×"×œ ×–×•, × ×©×œ×— ××œ×™×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”. ×× × ×‘×“×•×§ ××ª ×ª×™×‘×ª ×”×“×•××¨ ×©×œ×š.'})}),e.jsx("div",{className:"text-center",children:e.jsx(de,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:y,children:[l&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:l})}),e.jsx("div",{className:"rounded-md shadow-sm",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:o,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:u=>r(u.target.value),dir:"ltr",style:{textAlign:"left"}})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:o,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×©×•×œ×—..."]}):"×©×œ×— ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsx("div",{className:"text-center",children:e.jsx(de,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]})]})})]})}function Xs(){const{token:t}=Bt(),[r,o]=d.useState(""),[c,i]=d.useState(""),[n,l]=d.useState(!1),[x,y]=d.useState(""),[u,m]=d.useState(!1),T=Ee();d.useEffect(()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),t||y("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”.")},[t]);const A=async I=>{if(I.preventDefault(),y(""),r.length<6){y("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×");return}if(r!==c){y("×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª");return}if(!t){y("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ");return}l(!0);try{await gt.resetPassword(t,r),m(!0),setTimeout(()=>{T("/login")},3e3)}catch(S){const P=S.message||S.error||"×©×’×™××” ×‘××™×¤×•×¡ ×”×¡×™×¡××”";P.includes("expired")||P.includes("RESET_TOKEN_EXPIRED")?y("×ª×•×§×£ ×”×§×™×©×•×¨ ×¤×’. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):P.includes("invalid")||P.includes("INVALID_RESET_TOKEN")?y("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):P.includes("password")||P.includes("WEAK_PASSWORD")?y("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×"):y(P)}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"××™×¤×•×¡ ×¡×™×¡××”"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:"×”×–×Ÿ ×¡×™×¡××” ×—×“×©×” ×œ×—×©×‘×•×Ÿ ×©×œ×š"})]}),u?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:[e.jsx("p",{className:"text-green-100 text-center font-reisinger-yonatan",children:"×”×¡×™×¡××” ××•×¤×¡×” ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×ª×•×›×œ ×œ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡××” ×”×—×“×©×”."}),e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan mt-2",children:"××¢×‘×™×¨ ××•×ª×š ×œ×“×£ ×”×›× ×™×¡×”..."})]}),e.jsx("div",{className:"text-center",children:e.jsx(de,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×” ×¢×›×©×™×•"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:A,children:[x&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:x})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××” ×—×“×©×”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××” ×—×“×©×” (×œ×¤×—×•×ª 6 ×ª×•×•×™×)",value:r,onChange:I=>o(I.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"sr-only font-reisinger-yonatan",children:"××™××•×ª ×¡×™×¡××”"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"××™××•×ª ×¡×™×¡××”",value:c,onChange:I=>i(I.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:n||!t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×××¤×¡ ×¡×™×¡××”..."]}):"××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(de,{to:"/forgot-password",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×‘×§×© ×§×™×©×•×¨ ×—×“×©"}),e.jsx(de,{to:"/login",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})]})]})]})})]})}function Z(t,r,o=3){return d.lazy(()=>{let c=0;const i=async()=>{try{const n=await t();return console.log(`âœ… Successfully loaded ${r}`),n}catch(n){if(console.error(`âŒ Failed to load ${r}, attempt ${c+1}/${o}:`,n),c<o-1){c++;const l=Math.min(1e3*Math.pow(2,c),5e3);return await new Promise(x=>setTimeout(x,l)),i()}else throw console.error(`âŒ All retry attempts failed for ${r}`),n}};return i()})}class qs{constructor(){Pe(this,"preloadedComponents",new Set);Pe(this,"preloadPromises",new Map)}preload(r,o){if(this.preloadedComponents.has(r))return Promise.resolve();if(this.preloadPromises.has(r))return this.preloadPromises.get(r);const c=o().then(i=>(this.preloadedComponents.add(r),console.log(`âœ… Preloaded ${r}`),i)).catch(i=>{throw console.error(`âŒ Failed to preload ${r}:`,i),i}).finally(()=>{this.preloadPromises.delete(r)});return this.preloadPromises.set(r,c),c}preloadOnHover(r,o){return()=>{this.preloadedComponents.has(r)||this.preload(r,o)}}getPreloadStats(){return{preloadedComponents:Array.from(this.preloadedComponents),pendingPreloads:Array.from(this.preloadPromises.keys())}}}const Le=new qs,Ue={STUDENT_DETAILS:"StudentDetailsPage",THEORY_TAB:"TheoryTab",ORCHESTRA_TAB:"OrchestraTab",DASHBOARD:"Dashboard",STUDENTS_LIST:"Students"};function Gs(){setTimeout(()=>{Le.preload(Ue.DASHBOARD,()=>G(()=>import("../chunks/Dashboard-BiFyqkxZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Le.preload(Ue.STUDENTS_LIST,()=>G(()=>import("../chunks/Students-B3WzZYlC.js"),__vite__mapDeps([8,1,3,4,9,7,10,5,6])))},1e3),setTimeout(()=>{Le.preload(Ue.STUDENT_DETAILS,()=>G(()=>import("../chunks/StudentDetailsPageSimple-iavtekgY.js"),__vite__mapDeps([11,1,7,5,6,3,12,13,14,4])))},3e3)}function Qs(){const t=document.head,r=document.createElement("link");r.rel="dns-prefetch",r.href="//localhost",t.appendChild(r);const o=document.createElement("link");o.rel="preconnect",o.href="http://localhost:3001",o.crossOrigin="anonymous",t.appendChild(o);const c=document.createElement("link");c.rel="prefetch",c.as="style",c.href="/src/index.css",t.appendChild(c)}function Ks(){typeof window>"u"||(Qs(),Gs(),console.log("ğŸš€ Bundle optimizations initialized"))}const Js=Z(()=>G(()=>import("../chunks/Dashboard-BiFyqkxZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),"Dashboard"),dt=Z(()=>G(()=>import("../chunks/Students-B3WzZYlC.js"),__vite__mapDeps([8,1,3,4,9,7,10,5,6])),"Students"),Zs=Z(()=>G(()=>import("../chunks/Teachers-Bh8T5VDP.js"),__vite__mapDeps([15,1,4,3,9,7,5,6])),"Teachers"),Be=Z(()=>G(()=>import("../chunks/TheoryLessons-3dyP5dq7.js"),__vite__mapDeps([16,1,4,3,2,12,5,6,7,10])),"TheoryLessons"),er=Z(()=>G(()=>import("../chunks/TheoryLessonDetails-B9ZslUMc.js"),__vite__mapDeps([17,1,4,3,9,7,2,10,5,6])),"TheoryLessonDetails"),ut=Z(()=>G(()=>import("../chunks/Orchestras-J_YZsWAW.js"),__vite__mapDeps([18,1,4,3,9,7,2,5,6])),"Orchestras"),mt=Z(()=>G(()=>import("../chunks/Rehearsals-ugeODJ4w.js"),__vite__mapDeps([19,1,4,3,9,7,10,5,6])),"Rehearsals"),tr=Z(()=>G(()=>import("../chunks/RehearsalDetails-B8mgSV3W.js"),__vite__mapDeps([20,1,5,6,3,4,10,7])),"RehearsalDetails"),sr=Z(()=>G(()=>import("../chunks/Bagruts-CoZ_B3yB.js"),__vite__mapDeps([21,1,4,3,9,7,2,10,22,5,6])),"Bagruts"),rr=Z(()=>G(()=>import("../chunks/BagrutDetails-BYf4vKgc.js"),__vite__mapDeps([23,1,4,3,9,7,2,10,22,5,6])),"BagrutDetails"),ar=Z(()=>G(()=>import("../chunks/Profile-B2tuL76X.js"),__vite__mapDeps([24,1,5,6,3,7,10,14])),"Profile"),ht=Z(()=>G(()=>import("../chunks/RehearsalAttendance-BsBsEqpQ.js"),__vite__mapDeps([25,1,5,6,3,7])),"ConductorAttendance"),nr=Z(()=>G(()=>import("../chunks/OrchestraEnrollmentManager-hOWToBun.js"),__vite__mapDeps([26,1,5,6,3,7])),"OrchestraEnrollmentManager"),lr=Z(()=>G(()=>import("../chunks/StudentDetailsPageSimple-iavtekgY.js"),__vite__mapDeps([11,1,7,5,6,3,12,13,14,4])),"StudentDetailsPage"),or=Z(()=>G(()=>import("../chunks/TeacherDetailsPage-DdZ-lVWJ.js"),__vite__mapDeps([27,1,7,5,6,3])),"TeacherDetailsPage"),ir=Z(()=>G(()=>import("../chunks/OrchestraDetailsPage-BV6yC2-g.js"),__vite__mapDeps([28,1,5,6,3,7,10])),"OrchestraDetailsPage"),se=({message:t="×˜×•×¢×Ÿ ×¢××•×“..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:t})]})});function z({children:t,allowedRoles:r}){const{isAuthenticated:o,isLoading:c,authError:i,checkAuthStatus:n,user:l}=fe(),[x,y]=ke.useState(0),u=2,m=()=>{if(!r||r.length===0)return!0;if(!l)return!1;const T=l.role||l.roles?.[0]||"",A=l.roles||[T],I={×× ×”×œ:"admin",××•×¨×”:"teacher",×× ×¦×—:"conductor","××“×¨×™×š ×ª×“×¨":"theory-teacher","××•×¨×” ×ª×™××•×¨×™×”":"theory-teacher"},S=A.map($=>I[$]||$),P=I[T]||T;return r.some($=>S.includes($)||P===$||$==="admin"&&!T)};return ke.useEffect(()=>{if(i&&x<u){const T=setTimeout(()=>{console.log(`ğŸ”„ ProtectedRoute - Retrying authentication (${x+1}/${u})`),n(!0),y(A=>A+1)},1e3*(x+1));return()=>clearTimeout(T)}},[i,x,n]),ke.useEffect(()=>{o&&x>0&&y(0)},[o]),c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"××××ª ×”×¨×©××•×ª..."}),i&&x>0&&e.jsxs("div",{className:"mt-2 text-sm text-amber-600",children:["×× ×¡×” ×©×•×‘ (",x,"/",u,")..."]})]})}):o?m()?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"××™×Ÿ ×”×¨×©××”"}),e.jsx("p",{className:"text-gray-600",children:"××™×Ÿ ×œ×š ×”×¨×©××” ×œ×’×©×ª ×œ×¢××•×“ ×–×”"})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"×—×–×•×¨"})]})}):e.jsx(Se,{to:"/login",replace:!0})}function cr(){return e.jsx("div",{dir:"rtl",children:e.jsxs(Ft,{children:[e.jsx(F,{path:"/login",element:e.jsx(Hs,{})}),e.jsx(F,{path:"/forgot-password",element:e.jsx(zs,{})}),e.jsx(F,{path:"/reset-password/:token",element:e.jsx(Xs,{})}),e.jsx(F,{path:"/dashboard",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×“×©×‘×•×¨×“..."}),children:e.jsx(Js,{})})})})}),e.jsx(F,{path:"/students",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}),children:e.jsx(dt,{})})})})}),e.jsx(F,{path:"/students/:studentId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×œ××™×“..."}),children:e.jsx(lr,{})})})})}),e.jsx(F,{path:"/teachers",element:e.jsx(z,{allowedRoles:["admin","teacher","conductor","theory-teacher"],children:e.jsx(H,{children:e.jsx(Zs,{})})})}),e.jsx(F,{path:"/teachers/:teacherId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××•×¨×”..."})]})}),children:e.jsx(or,{})})})})}),e.jsx(F,{path:"/theory-lessons",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(Be,{})})})}),e.jsx(F,{path:"/theory-lessons/:theoryId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(er,{})})})}),e.jsx(F,{path:"/orchestras",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(ut,{})})})}),e.jsx(F,{path:"/orchestras/:orchestraId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×–××•×¨×ª..."})]})}),children:e.jsx(ir,{})})})})}),e.jsx(F,{path:"/rehearsals",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(mt,{})})})}),e.jsx(F,{path:"/rehearsals/:rehearsalId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(tr,{})})})}),e.jsx(F,{path:"/bagruts",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(sr,{})})})}),e.jsx(F,{path:"/bagruts/:bagrutId",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(rr,{})})})}),e.jsx(F,{path:"/bagruts/:bagrutId/edit",element:e.jsx(z,{children:e.jsx(H,{children:e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"×¢×¨×™×›×ª ×‘×’×¨×•×ª"}),e.jsx("p",{className:"text-gray-600",children:"×¢×¨×™×›×ª ×¤×¨×˜×™ ×”×‘×’×¨×•×ª ×•×”×ª×§×“××•×ª"}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-blue-700",children:"ğŸ”§ ×¢××•×“ ×¢×¨×™×›×ª ×‘×’×¨×•×ª ×‘×¤×™×ª×•×— - ×‘×™× ×ª×™×™× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×“×¨×š ×¢××•×“ ×”×¤×¨×˜×™×"})})]})})})}),e.jsx(F,{path:"/bagrut",element:e.jsx(Se,{to:"/bagruts",replace:!0})}),e.jsx(F,{path:"/profile",element:e.jsx(z,{children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×¢××•×“ ××™×©×™..."}),children:e.jsx(ar,{})})})})}),e.jsx(F,{path:"/conductor/attendance",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×•×ª..."}),children:e.jsx(ht,{})})})})}),e.jsx(F,{path:"/conductor/attendance/:rehearsalId",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×”..."}),children:e.jsx(ht,{})})})})}),e.jsx(F,{path:"/conductor/enrollment",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×¨×™×©×•××™×..."}),children:e.jsx(nr,{})})})})}),e.jsx(F,{path:"/conductor/orchestras",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×ª×–××•×¨×•×ª..."}),children:e.jsx(ut,{})})})})}),e.jsx(F,{path:"/conductor/rehearsals",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×—×–×¨×•×ª..."}),children:e.jsx(mt,{})})})})}),e.jsx(F,{path:"/conductor/musicians",element:e.jsx(z,{allowedRoles:["conductor","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ××•×–×™×§××™×..."}),children:e.jsx(dt,{})})})})}),e.jsx(F,{path:"/theory-teacher/lessons",element:e.jsx(z,{allowedRoles:["theory-teacher","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”..."}),children:e.jsx(Be,{})})})})}),e.jsx(F,{path:"/theory-teacher/groups",element:e.jsx(z,{allowedRoles:["theory-teacher","admin"],children:e.jsx(H,{children:e.jsx(d.Suspense,{fallback:e.jsx(se,{message:"×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”..."}),children:e.jsx(Be,{})})})})}),e.jsx(F,{path:"/",element:e.jsx(Se,{to:"/dashboard",replace:!0})}),e.jsx(F,{path:"*",element:e.jsx(Se,{to:"/dashboard",replace:!0})})]})})}function dr(){return d.useEffect(()=>{Ks()},[]),e.jsx(ps,{children:e.jsx(os,{children:e.jsx(is,{children:e.jsx(fs,{children:e.jsx(ys,{children:e.jsx(cr,{})})})})})})}Ht();const ur=new xt({defaultOptions:{queries:{staleTime:1e3*60*5,retry:(t,r)=>r?.status===404||r?.status===403?!1:t<3}}}),kt=document.getElementById("root");if(!kt)throw new Error("Root element not found");Me.createRoot(kt).render(e.jsx(ke.StrictMode,{children:e.jsx(ft,{client:ur,children:e.jsx(Mt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(dr,{})})})}));export{Ds as A,Es as D,Ls as R,Ts as S,Cs as T,Ve as V,wt as a,qe as b,ot as c,St as d,As as e,_s as f,Tr as g,Nr as h,jr as i,e as j,vr as k,wr as s,fe as u};
