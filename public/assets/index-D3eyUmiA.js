var Gv=t=>{throw TypeError(t)};var N1=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var Rf=(t,s,n)=>s.has(t)||Gv("Cannot "+n);var ye=(t,s,n)=>(Rf(t,s,"read from private field"),n?n.call(t):s.get(t)),tt=(t,s,n)=>s.has(t)?Gv("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,n),Ye=(t,s,n,i)=>(Rf(t,s,"write to private field"),i?i.call(t,n):s.set(t,n),n),Ht=(t,s,n)=>(Rf(t,s,"access private method"),n);var bd=(t,s,n,i)=>({set _(l){Ye(t,s,l,n)},get _(){return ye(t,s,i)}});var nM=N1((ta,sa)=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=n(l);fetch(l.href,c)}})();function en(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Mf={exports:{}},Co={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv;function S1(){if(Qv)return Co;Qv=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function n(i,l,c){var u=null;if(c!==void 0&&(u=""+c),l.key!==void 0&&(u=""+l.key),"key"in l){c={};for(var f in l)f!=="key"&&(c[f]=l[f])}else c=l;return l=c.ref,{$$typeof:t,type:i,key:u,ref:l!==void 0?l:null,props:c}}return Co.Fragment=s,Co.jsx=n,Co.jsxs=n,Co}var Xv;function w1(){return Xv||(Xv=1,Mf.exports=S1()),Mf.exports}var e=w1(),zf={exports:{}},Xe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zv;function T1(){if(Zv)return Xe;Zv=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.iterator;function j(O){return O===null||typeof O!="object"?null:(O=v&&O[v]||O["@@iterator"],typeof O=="function"?O:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function C(O,B,L){this.props=O,this.context=B,this.refs=w,this.updater=L||N}C.prototype.isReactComponent={},C.prototype.setState=function(O,B){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,B,"setState")},C.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function T(){}T.prototype=C.prototype;function A(O,B,L){this.props=O,this.context=B,this.refs=w,this.updater=L||N}var _=A.prototype=new T;_.constructor=A,b(_,C.prototype),_.isPureReactComponent=!0;var D=Array.isArray,S={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function E(O,B,L,Y,H,P){return L=P.ref,{$$typeof:t,type:O,key:B,ref:L!==void 0?L:null,props:P}}function k(O,B){return E(O.type,B,void 0,void 0,void 0,O.props)}function I(O){return typeof O=="object"&&O!==null&&O.$$typeof===t}function M(O){var B={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(L){return B[L]})}var z=/\/+/g;function Z(O,B){return typeof O=="object"&&O!==null&&O.key!=null?M(""+O.key):B.toString(36)}function ee(){}function W(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(ee,ee):(O.status="pending",O.then(function(B){O.status==="pending"&&(O.status="fulfilled",O.value=B)},function(B){O.status==="pending"&&(O.status="rejected",O.reason=B)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function K(O,B,L,Y,H){var P=typeof O;(P==="undefined"||P==="boolean")&&(O=null);var q=!1;if(O===null)q=!0;else switch(P){case"bigint":case"string":case"number":q=!0;break;case"object":switch(O.$$typeof){case t:case s:q=!0;break;case g:return q=O._init,K(q(O._payload),B,L,Y,H)}}if(q)return H=H(O),q=Y===""?"."+Z(O,0):Y,D(H)?(L="",q!=null&&(L=q.replace(z,"$&/")+"/"),K(H,B,L,"",function(ae){return ae})):H!=null&&(I(H)&&(H=k(H,L+(H.key==null||O&&O.key===H.key?"":(""+H.key).replace(z,"$&/")+"/")+q)),B.push(H)),1;q=0;var F=Y===""?".":Y+":";if(D(O))for(var te=0;te<O.length;te++)Y=O[te],P=F+Z(Y,te),q+=K(Y,B,L,P,H);else if(te=j(O),typeof te=="function")for(O=te.call(O),te=0;!(Y=O.next()).done;)Y=Y.value,P=F+Z(Y,te++),q+=K(Y,B,L,P,H);else if(P==="object"){if(typeof O.then=="function")return K(W(O),B,L,Y,H);throw B=String(O),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return q}function Q(O,B,L){if(O==null)return O;var Y=[],H=0;return K(O,Y,"","",function(P){return B.call(L,P,H++)}),Y}function ne(O){if(O._status===-1){var B=O._result;B=B(),B.then(function(L){(O._status===0||O._status===-1)&&(O._status=1,O._result=L)},function(L){(O._status===0||O._status===-1)&&(O._status=2,O._result=L)}),O._status===-1&&(O._status=0,O._result=B)}if(O._status===1)return O._result.default;throw O._result}var X=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)};function se(){}return Xe.Children={map:Q,forEach:function(O,B,L){Q(O,function(){B.apply(this,arguments)},L)},count:function(O){var B=0;return Q(O,function(){B++}),B},toArray:function(O){return Q(O,function(B){return B})||[]},only:function(O){if(!I(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},Xe.Component=C,Xe.Fragment=n,Xe.Profiler=l,Xe.PureComponent=A,Xe.StrictMode=i,Xe.Suspense=p,Xe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Xe.act=function(){throw Error("act(...) is not supported in production builds of React.")},Xe.cache=function(O){return function(){return O.apply(null,arguments)}},Xe.cloneElement=function(O,B,L){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var Y=b({},O.props),H=O.key,P=void 0;if(B!=null)for(q in B.ref!==void 0&&(P=void 0),B.key!==void 0&&(H=""+B.key),B)!R.call(B,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&B.ref===void 0||(Y[q]=B[q]);var q=arguments.length-2;if(q===1)Y.children=L;else if(1<q){for(var F=Array(q),te=0;te<q;te++)F[te]=arguments[te+2];Y.children=F}return E(O.type,H,void 0,void 0,P,Y)},Xe.createContext=function(O){return O={$$typeof:u,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:c,_context:O},O},Xe.createElement=function(O,B,L){var Y,H={},P=null;if(B!=null)for(Y in B.key!==void 0&&(P=""+B.key),B)R.call(B,Y)&&Y!=="key"&&Y!=="__self"&&Y!=="__source"&&(H[Y]=B[Y]);var q=arguments.length-2;if(q===1)H.children=L;else if(1<q){for(var F=Array(q),te=0;te<q;te++)F[te]=arguments[te+2];H.children=F}if(O&&O.defaultProps)for(Y in q=O.defaultProps,q)H[Y]===void 0&&(H[Y]=q[Y]);return E(O,P,void 0,void 0,null,H)},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(O){return{$$typeof:f,render:O}},Xe.isValidElement=I,Xe.lazy=function(O){return{$$typeof:g,_payload:{_status:-1,_result:O},_init:ne}},Xe.memo=function(O,B){return{$$typeof:m,type:O,compare:B===void 0?null:B}},Xe.startTransition=function(O){var B=S.T,L={};S.T=L;try{var Y=O(),H=S.S;H!==null&&H(L,Y),typeof Y=="object"&&Y!==null&&typeof Y.then=="function"&&Y.then(se,X)}catch(P){X(P)}finally{S.T=B}},Xe.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},Xe.use=function(O){return S.H.use(O)},Xe.useActionState=function(O,B,L){return S.H.useActionState(O,B,L)},Xe.useCallback=function(O,B){return S.H.useCallback(O,B)},Xe.useContext=function(O){return S.H.useContext(O)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(O,B){return S.H.useDeferredValue(O,B)},Xe.useEffect=function(O,B){return S.H.useEffect(O,B)},Xe.useId=function(){return S.H.useId()},Xe.useImperativeHandle=function(O,B,L){return S.H.useImperativeHandle(O,B,L)},Xe.useInsertionEffect=function(O,B){return S.H.useInsertionEffect(O,B)},Xe.useLayoutEffect=function(O,B){return S.H.useLayoutEffect(O,B)},Xe.useMemo=function(O,B){return S.H.useMemo(O,B)},Xe.useOptimistic=function(O,B){return S.H.useOptimistic(O,B)},Xe.useReducer=function(O,B,L){return S.H.useReducer(O,B,L)},Xe.useRef=function(O){return S.H.useRef(O)},Xe.useState=function(O){return S.H.useState(O)},Xe.useSyncExternalStore=function(O,B,L){return S.H.useSyncExternalStore(O,B,L)},Xe.useTransition=function(){return S.H.useTransition()},Xe.version="19.0.0",Xe}var Wv;function Um(){return Wv||(Wv=1,zf.exports=T1()),zf.exports}var x=Um();const oi=en(x);var Lf={exports:{}},Ao={},Bf={exports:{}},Ff={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kv;function E1(){return Kv||(Kv=1,function(t){function s(Q,ne){var X=Q.length;Q.push(ne);e:for(;0<X;){var se=X-1>>>1,O=Q[se];if(0<l(O,ne))Q[se]=ne,Q[X]=O,X=se;else break e}}function n(Q){return Q.length===0?null:Q[0]}function i(Q){if(Q.length===0)return null;var ne=Q[0],X=Q.pop();if(X!==ne){Q[0]=X;e:for(var se=0,O=Q.length,B=O>>>1;se<B;){var L=2*(se+1)-1,Y=Q[L],H=L+1,P=Q[H];if(0>l(Y,X))H<O&&0>l(P,Y)?(Q[se]=P,Q[H]=X,se=H):(Q[se]=Y,Q[L]=X,se=L);else if(H<O&&0>l(P,X))Q[se]=P,Q[H]=X,se=H;else break e}}return ne}function l(Q,ne){var X=Q.sortIndex-ne.sortIndex;return X!==0?X:Q.id-ne.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var u=Date,f=u.now();t.unstable_now=function(){return u.now()-f}}var p=[],m=[],g=1,v=null,j=3,N=!1,b=!1,w=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function _(Q){for(var ne=n(m);ne!==null;){if(ne.callback===null)i(m);else if(ne.startTime<=Q)i(m),ne.sortIndex=ne.expirationTime,s(p,ne);else break;ne=n(m)}}function D(Q){if(w=!1,_(Q),!b)if(n(p)!==null)b=!0,W();else{var ne=n(m);ne!==null&&K(D,ne.startTime-Q)}}var S=!1,R=-1,E=5,k=-1;function I(){return!(t.unstable_now()-k<E)}function M(){if(S){var Q=t.unstable_now();k=Q;var ne=!0;try{e:{b=!1,w&&(w=!1,T(R),R=-1),N=!0;var X=j;try{t:{for(_(Q),v=n(p);v!==null&&!(v.expirationTime>Q&&I());){var se=v.callback;if(typeof se=="function"){v.callback=null,j=v.priorityLevel;var O=se(v.expirationTime<=Q);if(Q=t.unstable_now(),typeof O=="function"){v.callback=O,_(Q),ne=!0;break t}v===n(p)&&i(p),_(Q)}else i(p);v=n(p)}if(v!==null)ne=!0;else{var B=n(m);B!==null&&K(D,B.startTime-Q),ne=!1}}break e}finally{v=null,j=X,N=!1}ne=void 0}}finally{ne?z():S=!1}}}var z;if(typeof A=="function")z=function(){A(M)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ee=Z.port2;Z.port1.onmessage=M,z=function(){ee.postMessage(null)}}else z=function(){C(M,0)};function W(){S||(S=!0,z())}function K(Q,ne){R=C(function(){Q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){b||N||(b=!0,W())},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return j},t.unstable_getFirstCallbackNode=function(){return n(p)},t.unstable_next=function(Q){switch(j){case 1:case 2:case 3:var ne=3;break;default:ne=j}var X=j;j=ne;try{return Q()}finally{j=X}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var X=j;j=Q;try{return ne()}finally{j=X}},t.unstable_scheduleCallback=function(Q,ne,X){var se=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?se+X:se):X=se,Q){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=X+O,Q={id:g++,callback:ne,priorityLevel:Q,startTime:X,expirationTime:O,sortIndex:-1},X>se?(Q.sortIndex=X,s(m,Q),n(p)===null&&Q===n(m)&&(w?(T(R),R=-1):w=!0,K(D,X-se))):(Q.sortIndex=O,s(p,Q),b||N||(b=!0,W())),Q},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(Q){var ne=j;return function(){var X=j;j=ne;try{return Q.apply(this,arguments)}finally{j=X}}}}(Ff)),Ff}var Jv;function C1(){return Jv||(Jv=1,Bf.exports=E1()),Bf.exports}var Uf={exports:{}},bs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ex;function A1(){if(ex)return bs;ex=1;var t=Um();function s(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(s(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(p,m,g){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:v==null?null:""+v,children:p,containerInfo:m,implementation:g}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return bs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,bs.createPortal=function(p,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(s(299));return c(p,m,null,g)},bs.flushSync=function(p){var m=u.T,g=i.p;try{if(u.T=null,i.p=2,p)return p()}finally{u.T=m,i.p=g,i.d.f()}},bs.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,i.d.C(p,m))},bs.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},bs.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var g=m.as,v=f(g,m.crossOrigin),j=typeof m.integrity=="string"?m.integrity:void 0,N=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?i.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:j,fetchPriority:N}):g==="script"&&i.d.X(p,{crossOrigin:v,integrity:j,fetchPriority:N,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},bs.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=f(m.as,m.crossOrigin);i.d.M(p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&i.d.M(p)},bs.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,v=f(g,m.crossOrigin);i.d.L(p,g,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},bs.preloadModule=function(p,m){if(typeof p=="string")if(m){var g=f(m.as,m.crossOrigin);i.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else i.d.m(p)},bs.requestFormReset=function(p){i.d.r(p)},bs.unstable_batchedUpdates=function(p,m){return p(m)},bs.useFormState=function(p,m,g){return u.H.useFormState(p,m,g)},bs.useFormStatus=function(){return u.H.useHostTransitionStatus()},bs.version="19.0.0",bs}var tx;function s0(){if(tx)return Uf.exports;tx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),Uf.exports=A1(),Uf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sx;function D1(){if(sx)return Ao;sx=1;var t=C1(),s=Um(),n=s0();function i(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}var c=Symbol.for("react.element"),u=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),j=Symbol.for("react.consumer"),N=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),_=Symbol.for("react.offscreen"),D=Symbol.for("react.memo_cache_sentinel"),S=Symbol.iterator;function R(a){return a===null||typeof a!="object"?null:(a=S&&a[S]||a["@@iterator"],typeof a=="function"?a:null)}var E=Symbol.for("react.client.reference");function k(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===E?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case p:return"Fragment";case f:return"Portal";case g:return"Profiler";case m:return"StrictMode";case w:return"Suspense";case C:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case N:return(a.displayName||"Context")+".Provider";case j:return(a._context.displayName||"Context")+".Consumer";case b:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case T:return r=a.displayName||null,r!==null?r:k(a.type)||"Memo";case A:r=a._payload,a=a._init;try{return k(a(r))}catch{}}return null}var I=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.assign,z,Z;function ee(a){if(z===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);z=r&&r[1]||"",Z=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+z+a+Z}var W=!1;function K(a,r){if(!a||W)return"";W=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(r){var Ce=function(){throw Error()};if(Object.defineProperty(Ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ce,[])}catch(Se){var fe=Se}Reflect.construct(a,[],Ce)}else{try{Ce.call()}catch(Se){fe=Se}a.call(Ce.prototype)}}else{try{throw Error()}catch(Se){fe=Se}(Ce=a())&&typeof Ce.catch=="function"&&Ce.catch(function(){})}}catch(Se){if(Se&&fe&&typeof Se.stack=="string")return[Se.stack,fe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),$=y[0],U=y[1];if($&&U){var J=$.split(`
`),le=U.split(`
`);for(h=d=0;d<J.length&&!J[d].includes("DetermineComponentFrameRoot");)d++;for(;h<le.length&&!le[h].includes("DetermineComponentFrameRoot");)h++;if(d===J.length||h===le.length)for(d=J.length-1,h=le.length-1;1<=d&&0<=h&&J[d]!==le[h];)h--;for(;1<=d&&0<=h;d--,h--)if(J[d]!==le[h]){if(d!==1||h!==1)do if(d--,h--,0>h||J[d]!==le[h]){var we=`
`+J[d].replace(" at new "," at ");return a.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",a.displayName)),we}while(1<=d&&0<=h);break}}}finally{W=!1,Error.prepareStackTrace=o}return(o=a?a.displayName||a.name:"")?ee(o):""}function Q(a){switch(a.tag){case 26:case 27:case 5:return ee(a.type);case 16:return ee("Lazy");case 13:return ee("Suspense");case 19:return ee("SuspenseList");case 0:case 15:return a=K(a.type,!1),a;case 11:return a=K(a.type.render,!1),a;case 1:return a=K(a.type,!0),a;default:return""}}function ne(a){try{var r="";do r+=Q(a),a=a.return;while(a);return r}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function X(a){var r=a,o=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(o=r.return),a=r.return;while(a)}return r.tag===3?o:null}function se(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function O(a){if(X(a)!==a)throw Error(i(188))}function B(a){var r=a.alternate;if(!r){if(r=X(a),r===null)throw Error(i(188));return r!==a?null:a}for(var o=a,d=r;;){var h=o.return;if(h===null)break;var y=h.alternate;if(y===null){if(d=h.return,d!==null){o=d;continue}break}if(h.child===y.child){for(y=h.child;y;){if(y===o)return O(h),a;if(y===d)return O(h),r;y=y.sibling}throw Error(i(188))}if(o.return!==d.return)o=h,d=y;else{for(var $=!1,U=h.child;U;){if(U===o){$=!0,o=h,d=y;break}if(U===d){$=!0,d=h,o=y;break}U=U.sibling}if(!$){for(U=y.child;U;){if(U===o){$=!0,o=y,d=h;break}if(U===d){$=!0,d=y,o=h;break}U=U.sibling}if(!$)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?a:r}function L(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=L(a),r!==null)return r;a=a.sibling}return null}var Y=Array.isArray,H=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},q=[],F=-1;function te(a){return{current:a}}function ae(a){0>F||(a.current=q[F],q[F]=null,F--)}function oe(a,r){F++,q[F]=a.current,a.current=r}var ce=te(null),G=te(null),re=te(null),pe=te(null);function me(a,r){switch(oe(re,r),oe(G,a),oe(ce,null),a=r.nodeType,a){case 9:case 11:r=(r=r.documentElement)&&(r=r.namespaceURI)?Nv(r):0;break;default:if(a=a===8?r.parentNode:r,r=a.tagName,a=a.namespaceURI)a=Nv(a),r=Sv(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ae(ce),oe(ce,r)}function je(){ae(ce),ae(G),ae(re)}function Oe(a){a.memoizedState!==null&&oe(pe,a);var r=ce.current,o=Sv(r,a.type);r!==o&&(oe(G,a),oe(ce,o))}function De(a){G.current===a&&(ae(ce),ae(G)),pe.current===a&&(ae(pe),No._currentValue=P)}var be=Object.prototype.hasOwnProperty,Te=t.unstable_scheduleCallback,Be=t.unstable_cancelCallback,V=t.unstable_shouldYield,ue=t.unstable_requestPaint,ve=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,_e=t.unstable_ImmediatePriority,Ie=t.unstable_UserBlockingPriority,Ue=t.unstable_NormalPriority,$t=t.unstable_LowPriority,qe=t.unstable_IdlePriority,mt=t.log,Rt=t.unstable_setDisableYieldValue,Pt=null,xt=null;function xi(a){if(xt&&typeof xt.onCommitFiberRoot=="function")try{xt.onCommitFiberRoot(Pt,a,void 0,(a.current.flags&128)===128)}catch{}}function Ea(a){if(typeof mt=="function"&&Rt(a),xt&&typeof xt.setStrictMode=="function")try{xt.setStrictMode(Pt,a)}catch{}}var ke=Math.clz32?Math.clz32:At,ze=Math.log,Gt=Math.LN2;function At(a){return a>>>=0,a===0?32:31-(ze(a)/Gt|0)|0}var dt=128,os=4194304;function ra(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function sn(a,r){var o=a.pendingLanes;if(o===0)return 0;var d=0,h=a.suspendedLanes,y=a.pingedLanes,$=a.warmLanes;a=a.finishedLanes!==0;var U=o&134217727;return U!==0?(o=U&~h,o!==0?d=ra(o):(y&=U,y!==0?d=ra(y):a||($=U&~$,$!==0&&(d=ra($))))):(U=o&~h,U!==0?d=ra(U):y!==0?d=ra(y):a||($=o&~$,$!==0&&(d=ra($)))),d===0?0:r!==0&&r!==d&&(r&h)===0&&(h=d&-d,$=r&-r,h>=$||h===32&&($&4194176)!==0)?r:d}function Cr(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function uc(a,r){switch(a){case 1:case 2:case 4:case 8:return r+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hc(){var a=dt;return dt<<=1,(dt&4194176)===0&&(dt=128),a}function fc(){var a=os;return os<<=1,(os&62914560)===0&&(os=4194304),a}function Du(a){for(var r=[],o=0;31>o;o++)r.push(a);return r}function Ol(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function uN(a,r,o,d,h,y){var $=a.pendingLanes;a.pendingLanes=o,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=o,a.entangledLanes&=o,a.errorRecoveryDisabledLanes&=o,a.shellSuspendCounter=0;var U=a.entanglements,J=a.expirationTimes,le=a.hiddenUpdates;for(o=$&~o;0<o;){var we=31-ke(o),Ce=1<<we;U[we]=0,J[we]=-1;var fe=le[we];if(fe!==null)for(le[we]=null,we=0;we<fe.length;we++){var Se=fe[we];Se!==null&&(Se.lane&=-536870913)}o&=~Ce}d!==0&&gp(a,d,0),y!==0&&h===0&&a.tag!==0&&(a.suspendedLanes|=y&~($&~r))}function gp(a,r,o){a.pendingLanes|=r,a.suspendedLanes&=~r;var d=31-ke(r);a.entangledLanes|=r,a.entanglements[d]=a.entanglements[d]|1073741824|o&4194218}function yp(a,r){var o=a.entangledLanes|=r;for(a=a.entanglements;o;){var d=31-ke(o),h=1<<d;h&r|a[d]&r&&(a[d]|=r),o&=~h}}function vp(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function xp(){var a=H.p;return a!==0?a:(a=window.event,a===void 0?32:Uv(a.type))}function hN(a,r){var o=H.p;try{return H.p=a,r()}finally{H.p=o}}var zn=Math.random().toString(36).slice(2),xs="__reactFiber$"+zn,ks="__reactProps$"+zn,ji="__reactContainer$"+zn,ku="__reactEvents$"+zn,fN="__reactListeners$"+zn,mN="__reactHandles$"+zn,jp="__reactResources$"+zn,Il="__reactMarker$"+zn;function _u(a){delete a[xs],delete a[ks],delete a[ku],delete a[fN],delete a[mN]}function Ar(a){var r=a[xs];if(r)return r;for(var o=a.parentNode;o;){if(r=o[ji]||o[xs]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(a=Ev(a);a!==null;){if(o=a[xs])return o;a=Ev(a)}return r}a=o,o=a.parentNode}return null}function bi(a){if(a=a[xs]||a[ji]){var r=a.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return a}return null}function $l(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(i(33))}function Ni(a){var r=a[jp];return r||(r=a[jp]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function ss(a){a[Il]=!0}var bp=new Set,Np={};function Dr(a,r){Si(a,r),Si(a+"Capture",r)}function Si(a,r){for(Np[a]=r,a=0;a<r.length;a++)bp.add(r[a])}var an=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pN=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sp={},wp={};function gN(a){return be.call(wp,a)?!0:be.call(Sp,a)?!1:pN.test(a)?wp[a]=!0:(Sp[a]=!0,!1)}function mc(a,r,o){if(gN(r))if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var d=r.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+o)}}function pc(a,r,o){if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+o)}}function nn(a,r,o,d){if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttributeNS(r,o,""+d)}}function ia(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Tp(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function yN(a){var r=Tp(a)?"checked":"value",o=Object.getOwnPropertyDescriptor(a.constructor.prototype,r),d=""+a[r];if(!a.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var h=o.get,y=o.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return h.call(this)},set:function($){d=""+$,y.call(this,$)}}),Object.defineProperty(a,r,{enumerable:o.enumerable}),{getValue:function(){return d},setValue:function($){d=""+$},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function gc(a){a._valueTracker||(a._valueTracker=yN(a))}function Ep(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var o=r.getValue(),d="";return a&&(d=Tp(a)?a.checked?"true":"false":a.value),a=d,a!==o?(r.setValue(a),!0):!1}function yc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var vN=/[\n"\\]/g;function la(a){return a.replace(vN,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Ou(a,r,o,d,h,y,$,U){a.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?a.type=$:a.removeAttribute("type"),r!=null?$==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+ia(r)):a.value!==""+ia(r)&&(a.value=""+ia(r)):$!=="submit"&&$!=="reset"||a.removeAttribute("value"),r!=null?Iu(a,$,ia(r)):o!=null?Iu(a,$,ia(o)):d!=null&&a.removeAttribute("value"),h==null&&y!=null&&(a.defaultChecked=!!y),h!=null&&(a.checked=h&&typeof h!="function"&&typeof h!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?a.name=""+ia(U):a.removeAttribute("name")}function Cp(a,r,o,d,h,y,$,U){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(a.type=y),r!=null||o!=null){if(!(y!=="submit"&&y!=="reset"||r!=null))return;o=o!=null?""+ia(o):"",r=r!=null?""+ia(r):o,U||r===a.value||(a.value=r),a.defaultValue=r}d=d??h,d=typeof d!="function"&&typeof d!="symbol"&&!!d,a.checked=U?a.checked:!!d,a.defaultChecked=!!d,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(a.name=$)}function Iu(a,r,o){r==="number"&&yc(a.ownerDocument)===a||a.defaultValue===""+o||(a.defaultValue=""+o)}function wi(a,r,o,d){if(a=a.options,r){r={};for(var h=0;h<o.length;h++)r["$"+o[h]]=!0;for(o=0;o<a.length;o++)h=r.hasOwnProperty("$"+a[o].value),a[o].selected!==h&&(a[o].selected=h),h&&d&&(a[o].defaultSelected=!0)}else{for(o=""+ia(o),r=null,h=0;h<a.length;h++){if(a[h].value===o){a[h].selected=!0,d&&(a[h].defaultSelected=!0);return}r!==null||a[h].disabled||(r=a[h])}r!==null&&(r.selected=!0)}}function Ap(a,r,o){if(r!=null&&(r=""+ia(r),r!==a.value&&(a.value=r),o==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=o!=null?""+ia(o):""}function Dp(a,r,o,d){if(r==null){if(d!=null){if(o!=null)throw Error(i(92));if(Y(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),r=o}o=ia(r),a.defaultValue=o,d=a.textContent,d===o&&d!==""&&d!==null&&(a.value=d)}function Ti(a,r){if(r){var o=a.firstChild;if(o&&o===a.lastChild&&o.nodeType===3){o.nodeValue=r;return}}a.textContent=r}var xN=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kp(a,r,o){var d=r.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":d?a.setProperty(r,o):typeof o!="number"||o===0||xN.has(r)?r==="float"?a.cssFloat=o:a[r]=(""+o).trim():a[r]=o+"px"}function _p(a,r,o){if(r!=null&&typeof r!="object")throw Error(i(62));if(a=a.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||r!=null&&r.hasOwnProperty(d)||(d.indexOf("--")===0?a.setProperty(d,""):d==="float"?a.cssFloat="":a[d]="");for(var h in r)d=r[h],r.hasOwnProperty(h)&&o[h]!==d&&kp(a,h,d)}else for(var y in r)r.hasOwnProperty(y)&&kp(a,y,r[y])}function $u(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jN=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bN=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vc(a){return bN.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Ru=null;function Mu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ei=null,Ci=null;function Op(a){var r=bi(a);if(r&&(a=r.stateNode)){var o=a[ks]||null;e:switch(a=r.stateNode,r.type){case"input":if(Ou(a,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),r=o.name,o.type==="radio"&&r!=null){for(o=a;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+la(""+r)+'"][type="radio"]'),r=0;r<o.length;r++){var d=o[r];if(d!==a&&d.form===a.form){var h=d[ks]||null;if(!h)throw Error(i(90));Ou(d,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(r=0;r<o.length;r++)d=o[r],d.form===a.form&&Ep(d)}break e;case"textarea":Ap(a,o.value,o.defaultValue);break e;case"select":r=o.value,r!=null&&wi(a,!!o.multiple,r,!1)}}}var zu=!1;function Ip(a,r,o){if(zu)return a(r,o);zu=!0;try{var d=a(r);return d}finally{if(zu=!1,(Ei!==null||Ci!==null)&&(td(),Ei&&(r=Ei,a=Ci,Ci=Ei=null,Op(r),a)))for(r=0;r<a.length;r++)Op(a[r])}}function Rl(a,r){var o=a.stateNode;if(o===null)return null;var d=o[ks]||null;if(d===null)return null;o=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(a=a.type,d=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!d;break e;default:a=!1}if(a)return null;if(o&&typeof o!="function")throw Error(i(231,r,typeof o));return o}var Lu=!1;if(an)try{var Ml={};Object.defineProperty(Ml,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",Ml,Ml),window.removeEventListener("test",Ml,Ml)}catch{Lu=!1}var Ln=null,Bu=null,xc=null;function $p(){if(xc)return xc;var a,r=Bu,o=r.length,d,h="value"in Ln?Ln.value:Ln.textContent,y=h.length;for(a=0;a<o&&r[a]===h[a];a++);var $=o-a;for(d=1;d<=$&&r[o-d]===h[y-d];d++);return xc=h.slice(a,1<d?1-d:void 0)}function jc(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function bc(){return!0}function Rp(){return!1}function _s(a){function r(o,d,h,y,$){this._reactName=o,this._targetInst=h,this.type=d,this.nativeEvent=y,this.target=$,this.currentTarget=null;for(var U in a)a.hasOwnProperty(U)&&(o=a[U],this[U]=o?o(y):y[U]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?bc:Rp,this.isPropagationStopped=Rp,this}return M(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=bc)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=bc)},persist:function(){},isPersistent:bc}),r}var kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nc=_s(kr),zl=M({},kr,{view:0,detail:0}),NN=_s(zl),Fu,Uu,Ll,Sc=M({},zl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ll&&(Ll&&a.type==="mousemove"?(Fu=a.screenX-Ll.screenX,Uu=a.screenY-Ll.screenY):Uu=Fu=0,Ll=a),Fu)},movementY:function(a){return"movementY"in a?a.movementY:Uu}}),Mp=_s(Sc),SN=M({},Sc,{dataTransfer:0}),wN=_s(SN),TN=M({},zl,{relatedTarget:0}),Pu=_s(TN),EN=M({},kr,{animationName:0,elapsedTime:0,pseudoElement:0}),CN=_s(EN),AN=M({},kr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),DN=_s(AN),kN=M({},kr,{data:0}),zp=_s(kN),_N={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ON={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},IN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $N(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=IN[a])?!!r[a]:!1}function qu(){return $N}var RN=M({},zl,{key:function(a){if(a.key){var r=_N[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=jc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ON[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qu,charCode:function(a){return a.type==="keypress"?jc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?jc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),MN=_s(RN),zN=M({},Sc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lp=_s(zN),LN=M({},zl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qu}),BN=_s(LN),FN=M({},kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),UN=_s(FN),PN=M({},Sc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qN=_s(PN),HN=M({},kr,{newState:0,oldState:0}),YN=_s(HN),VN=[9,13,27,32],Hu=an&&"CompositionEvent"in window,Bl=null;an&&"documentMode"in document&&(Bl=document.documentMode);var GN=an&&"TextEvent"in window&&!Bl,Bp=an&&(!Hu||Bl&&8<Bl&&11>=Bl),Fp=" ",Up=!1;function Pp(a,r){switch(a){case"keyup":return VN.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qp(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ai=!1;function QN(a,r){switch(a){case"compositionend":return qp(r);case"keypress":return r.which!==32?null:(Up=!0,Fp);case"textInput":return a=r.data,a===Fp&&Up?null:a;default:return null}}function XN(a,r){if(Ai)return a==="compositionend"||!Hu&&Pp(a,r)?(a=$p(),xc=Bu=Ln=null,Ai=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Bp&&r.locale!=="ko"?null:r.data;default:return null}}var ZN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hp(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!ZN[a.type]:r==="textarea"}function Yp(a,r,o,d){Ei?Ci?Ci.push(d):Ci=[d]:Ei=d,r=id(r,"onChange"),0<r.length&&(o=new Nc("onChange","change",null,o,d),a.push({event:o,listeners:r}))}var Fl=null,Ul=null;function WN(a){yv(a,0)}function wc(a){var r=$l(a);if(Ep(r))return a}function Vp(a,r){if(a==="change")return r}var Gp=!1;if(an){var Yu;if(an){var Vu="oninput"in document;if(!Vu){var Qp=document.createElement("div");Qp.setAttribute("oninput","return;"),Vu=typeof Qp.oninput=="function"}Yu=Vu}else Yu=!1;Gp=Yu&&(!document.documentMode||9<document.documentMode)}function Xp(){Fl&&(Fl.detachEvent("onpropertychange",Zp),Ul=Fl=null)}function Zp(a){if(a.propertyName==="value"&&wc(Ul)){var r=[];Yp(r,Ul,a,Mu(a)),Ip(WN,r)}}function KN(a,r,o){a==="focusin"?(Xp(),Fl=r,Ul=o,Fl.attachEvent("onpropertychange",Zp)):a==="focusout"&&Xp()}function JN(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return wc(Ul)}function eS(a,r){if(a==="click")return wc(r)}function tS(a,r){if(a==="input"||a==="change")return wc(r)}function sS(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var Hs=typeof Object.is=="function"?Object.is:sS;function Pl(a,r){if(Hs(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var o=Object.keys(a),d=Object.keys(r);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var h=o[d];if(!be.call(r,h)||!Hs(a[h],r[h]))return!1}return!0}function Wp(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Kp(a,r){var o=Wp(a);a=0;for(var d;o;){if(o.nodeType===3){if(d=a+o.textContent.length,a<=r&&d>=r)return{node:o,offset:r-a};a=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Wp(o)}}function Jp(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?Jp(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function eg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=yc(a.document);r instanceof a.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)a=r.contentWindow;else break;r=yc(a.document)}return r}function Gu(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}function aS(a,r){var o=eg(r);r=a.focusedElem;var d=a.selectionRange;if(o!==r&&r&&r.ownerDocument&&Jp(r.ownerDocument.documentElement,r)){if(d!==null&&Gu(r)){if(a=d.start,o=d.end,o===void 0&&(o=a),"selectionStart"in r)r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length);else if(o=(a=r.ownerDocument||document)&&a.defaultView||window,o.getSelection){o=o.getSelection();var h=r.textContent.length,y=Math.min(d.start,h);d=d.end===void 0?y:Math.min(d.end,h),!o.extend&&y>d&&(h=d,d=y,y=h),h=Kp(r,y);var $=Kp(r,d);h&&$&&(o.rangeCount!==1||o.anchorNode!==h.node||o.anchorOffset!==h.offset||o.focusNode!==$.node||o.focusOffset!==$.offset)&&(a=a.createRange(),a.setStart(h.node,h.offset),o.removeAllRanges(),y>d?(o.addRange(a),o.extend($.node,$.offset)):(a.setEnd($.node,$.offset),o.addRange(a)))}}for(a=[],o=r;o=o.parentNode;)o.nodeType===1&&a.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<a.length;r++)o=a[r],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var nS=an&&"documentMode"in document&&11>=document.documentMode,Di=null,Qu=null,ql=null,Xu=!1;function tg(a,r,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Xu||Di==null||Di!==yc(d)||(d=Di,"selectionStart"in d&&Gu(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ql&&Pl(ql,d)||(ql=d,d=id(Qu,"onSelect"),0<d.length&&(r=new Nc("onSelect","select",null,r,o),a.push({event:r,listeners:d}),r.target=Di)))}function _r(a,r){var o={};return o[a.toLowerCase()]=r.toLowerCase(),o["Webkit"+a]="webkit"+r,o["Moz"+a]="moz"+r,o}var ki={animationend:_r("Animation","AnimationEnd"),animationiteration:_r("Animation","AnimationIteration"),animationstart:_r("Animation","AnimationStart"),transitionrun:_r("Transition","TransitionRun"),transitionstart:_r("Transition","TransitionStart"),transitioncancel:_r("Transition","TransitionCancel"),transitionend:_r("Transition","TransitionEnd")},Zu={},sg={};an&&(sg=document.createElement("div").style,"AnimationEvent"in window||(delete ki.animationend.animation,delete ki.animationiteration.animation,delete ki.animationstart.animation),"TransitionEvent"in window||delete ki.transitionend.transition);function Or(a){if(Zu[a])return Zu[a];if(!ki[a])return a;var r=ki[a],o;for(o in r)if(r.hasOwnProperty(o)&&o in sg)return Zu[a]=r[o];return a}var ag=Or("animationend"),ng=Or("animationiteration"),rg=Or("animationstart"),rS=Or("transitionrun"),iS=Or("transitionstart"),lS=Or("transitioncancel"),ig=Or("transitionend"),lg=new Map,og="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Ca(a,r){lg.set(a,r),Dr(r,[a])}var oa=[],_i=0,Wu=0;function Tc(){for(var a=_i,r=Wu=_i=0;r<a;){var o=oa[r];oa[r++]=null;var d=oa[r];oa[r++]=null;var h=oa[r];oa[r++]=null;var y=oa[r];if(oa[r++]=null,d!==null&&h!==null){var $=d.pending;$===null?h.next=h:(h.next=$.next,$.next=h),d.pending=h}y!==0&&cg(o,h,y)}}function Ec(a,r,o,d){oa[_i++]=a,oa[_i++]=r,oa[_i++]=o,oa[_i++]=d,Wu|=d,a.lanes|=d,a=a.alternate,a!==null&&(a.lanes|=d)}function Ku(a,r,o,d){return Ec(a,r,o,d),Cc(a)}function Bn(a,r){return Ec(a,null,null,r),Cc(a)}function cg(a,r,o){a.lanes|=o;var d=a.alternate;d!==null&&(d.lanes|=o);for(var h=!1,y=a.return;y!==null;)y.childLanes|=o,d=y.alternate,d!==null&&(d.childLanes|=o),y.tag===22&&(a=y.stateNode,a===null||a._visibility&1||(h=!0)),a=y,y=y.return;h&&r!==null&&a.tag===3&&(y=a.stateNode,h=31-ke(o),y=y.hiddenUpdates,a=y[h],a===null?y[h]=[r]:a.push(r),r.lane=o|536870912)}function Cc(a){if(50<po)throw po=0,nf=null,Error(i(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var Oi={},dg=new WeakMap;function ca(a,r){if(typeof a=="object"&&a!==null){var o=dg.get(a);return o!==void 0?o:(r={value:a,source:r,stack:ne(r)},dg.set(a,r),r)}return{value:a,source:r,stack:ne(r)}}var Ii=[],$i=0,Ac=null,Dc=0,da=[],ua=0,Ir=null,rn=1,ln="";function $r(a,r){Ii[$i++]=Dc,Ii[$i++]=Ac,Ac=a,Dc=r}function ug(a,r,o){da[ua++]=rn,da[ua++]=ln,da[ua++]=Ir,Ir=a;var d=rn;a=ln;var h=32-ke(d)-1;d&=~(1<<h),o+=1;var y=32-ke(r)+h;if(30<y){var $=h-h%5;y=(d&(1<<$)-1).toString(32),d>>=$,h-=$,rn=1<<32-ke(r)+h|o<<h|d,ln=y+a}else rn=1<<y|o<<h|d,ln=a}function Ju(a){a.return!==null&&($r(a,1),ug(a,1,0))}function eh(a){for(;a===Ac;)Ac=Ii[--$i],Ii[$i]=null,Dc=Ii[--$i],Ii[$i]=null;for(;a===Ir;)Ir=da[--ua],da[ua]=null,ln=da[--ua],da[ua]=null,rn=da[--ua],da[ua]=null}var Es=null,cs=null,rt=!1,Aa=null,qa=!1,th=Error(i(519));function Rr(a){var r=Error(i(418,""));throw Vl(ca(r,a)),th}function hg(a){var r=a.stateNode,o=a.type,d=a.memoizedProps;switch(r[xs]=a,r[ks]=d,o){case"dialog":st("cancel",r),st("close",r);break;case"iframe":case"object":case"embed":st("load",r);break;case"video":case"audio":for(o=0;o<yo.length;o++)st(yo[o],r);break;case"source":st("error",r);break;case"img":case"image":case"link":st("error",r),st("load",r);break;case"details":st("toggle",r);break;case"input":st("invalid",r),Cp(r,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),gc(r);break;case"select":st("invalid",r);break;case"textarea":st("invalid",r),Dp(r,d.value,d.defaultValue,d.children),gc(r)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||r.textContent===""+o||d.suppressHydrationWarning===!0||bv(r.textContent,o)?(d.popover!=null&&(st("beforetoggle",r),st("toggle",r)),d.onScroll!=null&&st("scroll",r),d.onScrollEnd!=null&&st("scrollend",r),d.onClick!=null&&(r.onclick=ld),r=!0):r=!1,r||Rr(a)}function fg(a){for(Es=a.return;Es;)switch(Es.tag){case 3:case 27:qa=!0;return;case 5:case 13:qa=!1;return;default:Es=Es.return}}function Hl(a){if(a!==Es)return!1;if(!rt)return fg(a),rt=!0,!1;var r=!1,o;if((o=a.tag!==3&&a.tag!==27)&&((o=a.tag===5)&&(o=a.type,o=!(o!=="form"&&o!=="button")||Nf(a.type,a.memoizedProps)),o=!o),o&&(r=!0),r&&cs&&Rr(a),fg(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));e:{for(a=a.nextSibling,r=0;a;){if(a.nodeType===8)if(o=a.data,o==="/$"){if(r===0){cs=ka(a.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++;a=a.nextSibling}cs=null}}else cs=Es?ka(a.stateNode.nextSibling):null;return!0}function Yl(){cs=Es=null,rt=!1}function Vl(a){Aa===null?Aa=[a]:Aa.push(a)}var Gl=Error(i(460)),mg=Error(i(474)),sh={then:function(){}};function pg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function kc(){}function gg(a,r,o){switch(o=a[o],o===void 0?a.push(r):o!==r&&(r.then(kc,kc),r=o),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,a===Gl?Error(i(483)):a;default:if(typeof r.status=="string")r.then(kc,kc);else{if(a=jt,a!==null&&100<a.shellSuspendCounter)throw Error(i(482));a=r,a.status="pending",a.then(function(d){if(r.status==="pending"){var h=r;h.status="fulfilled",h.value=d}},function(d){if(r.status==="pending"){var h=r;h.status="rejected",h.reason=d}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,a===Gl?Error(i(483)):a}throw Ql=r,Gl}}var Ql=null;function yg(){if(Ql===null)throw Error(i(459));var a=Ql;return Ql=null,a}var Ri=null,Xl=0;function _c(a){var r=Xl;return Xl+=1,Ri===null&&(Ri=[]),gg(Ri,a,r)}function Zl(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function Oc(a,r){throw r.$$typeof===c?Error(i(525)):(a=Object.prototype.toString.call(r),Error(i(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function vg(a){var r=a._init;return r(a._payload)}function xg(a){function r(de,ie){if(a){var he=de.deletions;he===null?(de.deletions=[ie],de.flags|=16):he.push(ie)}}function o(de,ie){if(!a)return null;for(;ie!==null;)r(de,ie),ie=ie.sibling;return null}function d(de){for(var ie=new Map;de!==null;)de.key!==null?ie.set(de.key,de):ie.set(de.index,de),de=de.sibling;return ie}function h(de,ie){return de=Wn(de,ie),de.index=0,de.sibling=null,de}function y(de,ie,he){return de.index=he,a?(he=de.alternate,he!==null?(he=he.index,he<ie?(de.flags|=33554434,ie):he):(de.flags|=33554434,ie)):(de.flags|=1048576,ie)}function $(de){return a&&de.alternate===null&&(de.flags|=33554434),de}function U(de,ie,he,Ee){return ie===null||ie.tag!==6?(ie=Zh(he,de.mode,Ee),ie.return=de,ie):(ie=h(ie,he),ie.return=de,ie)}function J(de,ie,he,Ee){var Me=he.type;return Me===p?we(de,ie,he.props.children,Ee,he.key):ie!==null&&(ie.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===A&&vg(Me)===ie.type)?(ie=h(ie,he.props),Zl(ie,he),ie.return=de,ie):(ie=Zc(he.type,he.key,he.props,null,de.mode,Ee),Zl(ie,he),ie.return=de,ie)}function le(de,ie,he,Ee){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==he.containerInfo||ie.stateNode.implementation!==he.implementation?(ie=Wh(he,de.mode,Ee),ie.return=de,ie):(ie=h(ie,he.children||[]),ie.return=de,ie)}function we(de,ie,he,Ee,Me){return ie===null||ie.tag!==7?(ie=Yr(he,de.mode,Ee,Me),ie.return=de,ie):(ie=h(ie,he),ie.return=de,ie)}function Ce(de,ie,he){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return ie=Zh(""+ie,de.mode,he),ie.return=de,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case u:return he=Zc(ie.type,ie.key,ie.props,null,de.mode,he),Zl(he,ie),he.return=de,he;case f:return ie=Wh(ie,de.mode,he),ie.return=de,ie;case A:var Ee=ie._init;return ie=Ee(ie._payload),Ce(de,ie,he)}if(Y(ie)||R(ie))return ie=Yr(ie,de.mode,he,null),ie.return=de,ie;if(typeof ie.then=="function")return Ce(de,_c(ie),he);if(ie.$$typeof===N)return Ce(de,Gc(de,ie),he);Oc(de,ie)}return null}function fe(de,ie,he,Ee){var Me=ie!==null?ie.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Me!==null?null:U(de,ie,""+he,Ee);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case u:return he.key===Me?J(de,ie,he,Ee):null;case f:return he.key===Me?le(de,ie,he,Ee):null;case A:return Me=he._init,he=Me(he._payload),fe(de,ie,he,Ee)}if(Y(he)||R(he))return Me!==null?null:we(de,ie,he,Ee,null);if(typeof he.then=="function")return fe(de,ie,_c(he),Ee);if(he.$$typeof===N)return fe(de,ie,Gc(de,he),Ee);Oc(de,he)}return null}function Se(de,ie,he,Ee,Me){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return de=de.get(he)||null,U(ie,de,""+Ee,Me);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case u:return de=de.get(Ee.key===null?he:Ee.key)||null,J(ie,de,Ee,Me);case f:return de=de.get(Ee.key===null?he:Ee.key)||null,le(ie,de,Ee,Me);case A:var Ke=Ee._init;return Ee=Ke(Ee._payload),Se(de,ie,he,Ee,Me)}if(Y(Ee)||R(Ee))return de=de.get(he)||null,we(ie,de,Ee,Me,null);if(typeof Ee.then=="function")return Se(de,ie,he,_c(Ee),Me);if(Ee.$$typeof===N)return Se(de,ie,he,Gc(ie,Ee),Me);Oc(ie,Ee)}return null}function Fe(de,ie,he,Ee){for(var Me=null,Ke=null,Pe=ie,He=ie=0,rs=null;Pe!==null&&He<he.length;He++){Pe.index>He?(rs=Pe,Pe=null):rs=Pe.sibling;var it=fe(de,Pe,he[He],Ee);if(it===null){Pe===null&&(Pe=rs);break}a&&Pe&&it.alternate===null&&r(de,Pe),ie=y(it,ie,He),Ke===null?Me=it:Ke.sibling=it,Ke=it,Pe=rs}if(He===he.length)return o(de,Pe),rt&&$r(de,He),Me;if(Pe===null){for(;He<he.length;He++)Pe=Ce(de,he[He],Ee),Pe!==null&&(ie=y(Pe,ie,He),Ke===null?Me=Pe:Ke.sibling=Pe,Ke=Pe);return rt&&$r(de,He),Me}for(Pe=d(Pe);He<he.length;He++)rs=Se(Pe,de,He,he[He],Ee),rs!==null&&(a&&rs.alternate!==null&&Pe.delete(rs.key===null?He:rs.key),ie=y(rs,ie,He),Ke===null?Me=rs:Ke.sibling=rs,Ke=rs);return a&&Pe.forEach(function(nr){return r(de,nr)}),rt&&$r(de,He),Me}function Ge(de,ie,he,Ee){if(he==null)throw Error(i(151));for(var Me=null,Ke=null,Pe=ie,He=ie=0,rs=null,it=he.next();Pe!==null&&!it.done;He++,it=he.next()){Pe.index>He?(rs=Pe,Pe=null):rs=Pe.sibling;var nr=fe(de,Pe,it.value,Ee);if(nr===null){Pe===null&&(Pe=rs);break}a&&Pe&&nr.alternate===null&&r(de,Pe),ie=y(nr,ie,He),Ke===null?Me=nr:Ke.sibling=nr,Ke=nr,Pe=rs}if(it.done)return o(de,Pe),rt&&$r(de,He),Me;if(Pe===null){for(;!it.done;He++,it=he.next())it=Ce(de,it.value,Ee),it!==null&&(ie=y(it,ie,He),Ke===null?Me=it:Ke.sibling=it,Ke=it);return rt&&$r(de,He),Me}for(Pe=d(Pe);!it.done;He++,it=he.next())it=Se(Pe,de,He,it.value,Ee),it!==null&&(a&&it.alternate!==null&&Pe.delete(it.key===null?He:it.key),ie=y(it,ie,He),Ke===null?Me=it:Ke.sibling=it,Ke=it);return a&&Pe.forEach(function(b1){return r(de,b1)}),rt&&$r(de,He),Me}function Lt(de,ie,he,Ee){if(typeof he=="object"&&he!==null&&he.type===p&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case u:e:{for(var Me=he.key;ie!==null;){if(ie.key===Me){if(Me=he.type,Me===p){if(ie.tag===7){o(de,ie.sibling),Ee=h(ie,he.props.children),Ee.return=de,de=Ee;break e}}else if(ie.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===A&&vg(Me)===ie.type){o(de,ie.sibling),Ee=h(ie,he.props),Zl(Ee,he),Ee.return=de,de=Ee;break e}o(de,ie);break}else r(de,ie);ie=ie.sibling}he.type===p?(Ee=Yr(he.props.children,de.mode,Ee,he.key),Ee.return=de,de=Ee):(Ee=Zc(he.type,he.key,he.props,null,de.mode,Ee),Zl(Ee,he),Ee.return=de,de=Ee)}return $(de);case f:e:{for(Me=he.key;ie!==null;){if(ie.key===Me)if(ie.tag===4&&ie.stateNode.containerInfo===he.containerInfo&&ie.stateNode.implementation===he.implementation){o(de,ie.sibling),Ee=h(ie,he.children||[]),Ee.return=de,de=Ee;break e}else{o(de,ie);break}else r(de,ie);ie=ie.sibling}Ee=Wh(he,de.mode,Ee),Ee.return=de,de=Ee}return $(de);case A:return Me=he._init,he=Me(he._payload),Lt(de,ie,he,Ee)}if(Y(he))return Fe(de,ie,he,Ee);if(R(he)){if(Me=R(he),typeof Me!="function")throw Error(i(150));return he=Me.call(he),Ge(de,ie,he,Ee)}if(typeof he.then=="function")return Lt(de,ie,_c(he),Ee);if(he.$$typeof===N)return Lt(de,ie,Gc(de,he),Ee);Oc(de,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,ie!==null&&ie.tag===6?(o(de,ie.sibling),Ee=h(ie,he),Ee.return=de,de=Ee):(o(de,ie),Ee=Zh(he,de.mode,Ee),Ee.return=de,de=Ee),$(de)):o(de,ie)}return function(de,ie,he,Ee){try{Xl=0;var Me=Lt(de,ie,he,Ee);return Ri=null,Me}catch(Pe){if(Pe===Gl)throw Pe;var Ke=pa(29,Pe,null,de.mode);return Ke.lanes=Ee,Ke.return=de,Ke}finally{}}}var Mr=xg(!0),jg=xg(!1),Mi=te(null),Ic=te(0);function bg(a,r){a=vn,oe(Ic,a),oe(Mi,r),vn=a|r.baseLanes}function ah(){oe(Ic,vn),oe(Mi,Mi.current)}function nh(){vn=Ic.current,ae(Mi),ae(Ic)}var ha=te(null),Ha=null;function Fn(a){var r=a.alternate;oe(Wt,Wt.current&1),oe(ha,a),Ha===null&&(r===null||Mi.current!==null||r.memoizedState!==null)&&(Ha=a)}function Ng(a){if(a.tag===22){if(oe(Wt,Wt.current),oe(ha,a),Ha===null){var r=a.alternate;r!==null&&r.memoizedState!==null&&(Ha=a)}}else Un()}function Un(){oe(Wt,Wt.current),oe(ha,ha.current)}function on(a){ae(ha),Ha===a&&(Ha=null),ae(Wt)}var Wt=te(0);function $c(a){for(var r=a;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var oS=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(o,d){a.push(d)}};this.abort=function(){r.aborted=!0,a.forEach(function(o){return o()})}},cS=t.unstable_scheduleCallback,dS=t.unstable_NormalPriority,Kt={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rh(){return{controller:new oS,data:new Map,refCount:0}}function Wl(a){a.refCount--,a.refCount===0&&cS(dS,function(){a.controller.abort()})}var Kl=null,ih=0,zi=0,Li=null;function uS(a,r){if(Kl===null){var o=Kl=[];ih=0,zi=ff(),Li={status:"pending",value:void 0,then:function(d){o.push(d)}}}return ih++,r.then(Sg,Sg),r}function Sg(){if(--ih===0&&Kl!==null){Li!==null&&(Li.status="fulfilled");var a=Kl;Kl=null,zi=0,Li=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function hS(a,r){var o=[],d={status:"pending",value:null,reason:null,then:function(h){o.push(h)}};return a.then(function(){d.status="fulfilled",d.value=r;for(var h=0;h<o.length;h++)(0,o[h])(r)},function(h){for(d.status="rejected",d.reason=h,h=0;h<o.length;h++)(0,o[h])(void 0)}),d}var wg=I.S;I.S=function(a,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&uS(a,r),wg!==null&&wg(a,r)};var zr=te(null);function lh(){var a=zr.current;return a!==null?a:jt.pooledCache}function Rc(a,r){r===null?oe(zr,zr.current):oe(zr,r.pool)}function Tg(){var a=lh();return a===null?null:{parent:Kt._currentValue,pool:a}}var Pn=0,Ze=null,ht=null,Qt=null,Mc=!1,Bi=!1,Lr=!1,zc=0,Jl=0,Fi=null,fS=0;function qt(){throw Error(i(321))}function oh(a,r){if(r===null)return!1;for(var o=0;o<r.length&&o<a.length;o++)if(!Hs(a[o],r[o]))return!1;return!0}function ch(a,r,o,d,h,y){return Pn=y,Ze=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,I.H=a===null||a.memoizedState===null?Br:qn,Lr=!1,y=o(d,h),Lr=!1,Bi&&(y=Cg(r,o,d,h)),Eg(a),y}function Eg(a){I.H=Ya;var r=ht!==null&&ht.next!==null;if(Pn=0,Qt=ht=Ze=null,Mc=!1,Jl=0,Fi=null,r)throw Error(i(300));a===null||as||(a=a.dependencies,a!==null&&Vc(a)&&(as=!0))}function Cg(a,r,o,d){Ze=a;var h=0;do{if(Bi&&(Fi=null),Jl=0,Bi=!1,25<=h)throw Error(i(301));if(h+=1,Qt=ht=null,a.updateQueue!=null){var y=a.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}I.H=Fr,y=r(o,d)}while(Bi);return y}function mS(){var a=I.H,r=a.useState()[0];return r=typeof r.then=="function"?eo(r):r,a=a.useState()[0],(ht!==null?ht.memoizedState:null)!==a&&(Ze.flags|=1024),r}function dh(){var a=zc!==0;return zc=0,a}function uh(a,r,o){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~o}function hh(a){if(Mc){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}Mc=!1}Pn=0,Qt=ht=Ze=null,Bi=!1,Jl=zc=0,Fi=null}function Os(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Ze.memoizedState=Qt=a:Qt=Qt.next=a,Qt}function Xt(){if(ht===null){var a=Ze.alternate;a=a!==null?a.memoizedState:null}else a=ht.next;var r=Qt===null?Ze.memoizedState:Qt.next;if(r!==null)Qt=r,ht=a;else{if(a===null)throw Ze.alternate===null?Error(i(467)):Error(i(310));ht=a,a={memoizedState:ht.memoizedState,baseState:ht.baseState,baseQueue:ht.baseQueue,queue:ht.queue,next:null},Qt===null?Ze.memoizedState=Qt=a:Qt=Qt.next=a}return Qt}var Lc;Lc=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function eo(a){var r=Jl;return Jl+=1,Fi===null&&(Fi=[]),a=gg(Fi,a,r),r=Ze,(Qt===null?r.memoizedState:Qt.next)===null&&(r=r.alternate,I.H=r===null||r.memoizedState===null?Br:qn),a}function Bc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return eo(a);if(a.$$typeof===N)return js(a)}throw Error(i(438,String(a)))}function fh(a){var r=null,o=Ze.updateQueue;if(o!==null&&(r=o.memoCache),r==null){var d=Ze.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(r={data:d.data.map(function(h){return h.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),o===null&&(o=Lc(),Ze.updateQueue=o),o.memoCache=r,o=r.data[r.index],o===void 0)for(o=r.data[r.index]=Array(a),d=0;d<a;d++)o[d]=D;return r.index++,o}function cn(a,r){return typeof r=="function"?r(a):r}function Fc(a){var r=Xt();return mh(r,ht,a)}function mh(a,r,o){var d=a.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var h=a.baseQueue,y=d.pending;if(y!==null){if(h!==null){var $=h.next;h.next=y.next,y.next=$}r.baseQueue=h=y,d.pending=null}if(y=a.baseState,h===null)a.memoizedState=y;else{r=h.next;var U=$=null,J=null,le=r,we=!1;do{var Ce=le.lane&-536870913;if(Ce!==le.lane?(nt&Ce)===Ce:(Pn&Ce)===Ce){var fe=le.revertLane;if(fe===0)J!==null&&(J=J.next={lane:0,revertLane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),Ce===zi&&(we=!0);else if((Pn&fe)===fe){le=le.next,fe===zi&&(we=!0);continue}else Ce={lane:0,revertLane:le.revertLane,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},J===null?(U=J=Ce,$=y):J=J.next=Ce,Ze.lanes|=fe,Kn|=fe;Ce=le.action,Lr&&o(y,Ce),y=le.hasEagerState?le.eagerState:o(y,Ce)}else fe={lane:Ce,revertLane:le.revertLane,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},J===null?(U=J=fe,$=y):J=J.next=fe,Ze.lanes|=Ce,Kn|=Ce;le=le.next}while(le!==null&&le!==r);if(J===null?$=y:J.next=U,!Hs(y,a.memoizedState)&&(as=!0,we&&(o=Li,o!==null)))throw o;a.memoizedState=y,a.baseState=$,a.baseQueue=J,d.lastRenderedState=y}return h===null&&(d.lanes=0),[a.memoizedState,d.dispatch]}function ph(a){var r=Xt(),o=r.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=a;var d=o.dispatch,h=o.pending,y=r.memoizedState;if(h!==null){o.pending=null;var $=h=h.next;do y=a(y,$.action),$=$.next;while($!==h);Hs(y,r.memoizedState)||(as=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),o.lastRenderedState=y}return[y,d]}function Ag(a,r,o){var d=Ze,h=Xt(),y=rt;if(y){if(o===void 0)throw Error(i(407));o=o()}else o=r();var $=!Hs((ht||h).memoizedState,o);if($&&(h.memoizedState=o,as=!0),h=h.queue,vh(_g.bind(null,d,h,a),[a]),h.getSnapshot!==r||$||Qt!==null&&Qt.memoizedState.tag&1){if(d.flags|=2048,Ui(9,kg.bind(null,d,h,o,r),{destroy:void 0},null),jt===null)throw Error(i(349));y||(Pn&60)!==0||Dg(d,r,o)}return o}function Dg(a,r,o){a.flags|=16384,a={getSnapshot:r,value:o},r=Ze.updateQueue,r===null?(r=Lc(),Ze.updateQueue=r,r.stores=[a]):(o=r.stores,o===null?r.stores=[a]:o.push(a))}function kg(a,r,o,d){r.value=o,r.getSnapshot=d,Og(r)&&Ig(a)}function _g(a,r,o){return o(function(){Og(r)&&Ig(a)})}function Og(a){var r=a.getSnapshot;a=a.value;try{var o=r();return!Hs(a,o)}catch{return!0}}function Ig(a){var r=Bn(a,2);r!==null&&Cs(r,a,2)}function gh(a){var r=Os();if(typeof a=="function"){var o=a;if(a=o(),Lr){Ea(!0);try{o()}finally{Ea(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:a},r}function $g(a,r,o,d){return a.baseState=o,mh(a,ht,typeof d=="function"?d:cn)}function pS(a,r,o,d,h){if(qc(a))throw Error(i(485));if(a=r.action,a!==null){var y={payload:h,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){y.listeners.push($)}};I.T!==null?o(!0):y.isTransition=!1,d(y),o=r.pending,o===null?(y.next=r.pending=y,Rg(r,y)):(y.next=o.next,r.pending=o.next=y)}}function Rg(a,r){var o=r.action,d=r.payload,h=a.state;if(r.isTransition){var y=I.T,$={};I.T=$;try{var U=o(h,d),J=I.S;J!==null&&J($,U),Mg(a,r,U)}catch(le){yh(a,r,le)}finally{I.T=y}}else try{y=o(h,d),Mg(a,r,y)}catch(le){yh(a,r,le)}}function Mg(a,r,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){zg(a,r,d)},function(d){return yh(a,r,d)}):zg(a,r,o)}function zg(a,r,o){r.status="fulfilled",r.value=o,Lg(r),a.state=o,r=a.pending,r!==null&&(o=r.next,o===r?a.pending=null:(o=o.next,r.next=o,Rg(a,o)))}function yh(a,r,o){var d=a.pending;if(a.pending=null,d!==null){d=d.next;do r.status="rejected",r.reason=o,Lg(r),r=r.next;while(r!==d)}a.action=null}function Lg(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function Bg(a,r){return r}function Fg(a,r){if(rt){var o=jt.formState;if(o!==null){e:{var d=Ze;if(rt){if(cs){t:{for(var h=cs,y=qa;h.nodeType!==8;){if(!y){h=null;break t}if(h=ka(h.nextSibling),h===null){h=null;break t}}y=h.data,h=y==="F!"||y==="F"?h:null}if(h){cs=ka(h.nextSibling),d=h.data==="F!";break e}}Rr(d)}d=!1}d&&(r=o[0])}}return o=Os(),o.memoizedState=o.baseState=r,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bg,lastRenderedState:r},o.queue=d,o=ny.bind(null,Ze,d),d.dispatch=o,d=gh(!1),y=Sh.bind(null,Ze,!1,d.queue),d=Os(),h={state:r,dispatch:null,action:a,pending:null},d.queue=h,o=pS.bind(null,Ze,h,y,o),h.dispatch=o,d.memoizedState=a,[r,o,!1]}function Ug(a){var r=Xt();return Pg(r,ht,a)}function Pg(a,r,o){r=mh(a,r,Bg)[0],a=Fc(cn)[0],r=typeof r=="object"&&r!==null&&typeof r.then=="function"?eo(r):r;var d=Xt(),h=d.queue,y=h.dispatch;return o!==d.memoizedState&&(Ze.flags|=2048,Ui(9,gS.bind(null,h,o),{destroy:void 0},null)),[r,y,a]}function gS(a,r){a.action=r}function qg(a){var r=Xt(),o=ht;if(o!==null)return Pg(r,o,a);Xt(),r=r.memoizedState,o=Xt();var d=o.queue.dispatch;return o.memoizedState=a,[r,d,!1]}function Ui(a,r,o,d){return a={tag:a,create:r,inst:o,deps:d,next:null},r=Ze.updateQueue,r===null&&(r=Lc(),Ze.updateQueue=r),o=r.lastEffect,o===null?r.lastEffect=a.next=a:(d=o.next,o.next=a,a.next=d,r.lastEffect=a),a}function Hg(){return Xt().memoizedState}function Uc(a,r,o,d){var h=Os();Ze.flags|=a,h.memoizedState=Ui(1|r,o,{destroy:void 0},d===void 0?null:d)}function Pc(a,r,o,d){var h=Xt();d=d===void 0?null:d;var y=h.memoizedState.inst;ht!==null&&d!==null&&oh(d,ht.memoizedState.deps)?h.memoizedState=Ui(r,o,y,d):(Ze.flags|=a,h.memoizedState=Ui(1|r,o,y,d))}function Yg(a,r){Uc(8390656,8,a,r)}function vh(a,r){Pc(2048,8,a,r)}function Vg(a,r){return Pc(4,2,a,r)}function Gg(a,r){return Pc(4,4,a,r)}function Qg(a,r){if(typeof r=="function"){a=a();var o=r(a);return function(){typeof o=="function"?o():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function Xg(a,r,o){o=o!=null?o.concat([a]):null,Pc(4,4,Qg.bind(null,r,a),o)}function xh(){}function Zg(a,r){var o=Xt();r=r===void 0?null:r;var d=o.memoizedState;return r!==null&&oh(r,d[1])?d[0]:(o.memoizedState=[a,r],a)}function Wg(a,r){var o=Xt();r=r===void 0?null:r;var d=o.memoizedState;if(r!==null&&oh(r,d[1]))return d[0];if(d=a(),Lr){Ea(!0);try{a()}finally{Ea(!1)}}return o.memoizedState=[d,r],d}function jh(a,r,o){return o===void 0||(Pn&1073741824)!==0?a.memoizedState=r:(a.memoizedState=o,a=Jy(),Ze.lanes|=a,Kn|=a,o)}function Kg(a,r,o,d){return Hs(o,r)?o:Mi.current!==null?(a=jh(a,o,d),Hs(a,r)||(as=!0),a):(Pn&42)===0?(as=!0,a.memoizedState=o):(a=Jy(),Ze.lanes|=a,Kn|=a,r)}function Jg(a,r,o,d,h){var y=H.p;H.p=y!==0&&8>y?y:8;var $=I.T,U={};I.T=U,Sh(a,!1,r,o);try{var J=h(),le=I.S;if(le!==null&&le(U,J),J!==null&&typeof J=="object"&&typeof J.then=="function"){var we=hS(J,d);to(a,r,we,Qs(a))}else to(a,r,d,Qs(a))}catch(Ce){to(a,r,{then:function(){},status:"rejected",reason:Ce},Qs())}finally{H.p=y,I.T=$}}function yS(){}function bh(a,r,o,d){if(a.tag!==5)throw Error(i(476));var h=ey(a).queue;Jg(a,h,r,P,o===null?yS:function(){return ty(a),o(d)})}function ey(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:P},next:null};var o={};return r.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:o},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function ty(a){var r=ey(a).next.queue;to(a,r,{},Qs())}function Nh(){return js(No)}function sy(){return Xt().memoizedState}function ay(){return Xt().memoizedState}function vS(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var o=Qs();a=Vn(o);var d=Gn(r,a,o);d!==null&&(Cs(d,r,o),no(d,r,o)),r={cache:rh()},a.payload=r;return}r=r.return}}function xS(a,r,o){var d=Qs();o={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},qc(a)?ry(r,o):(o=Ku(a,r,o,d),o!==null&&(Cs(o,a,d),iy(o,r,d)))}function ny(a,r,o){var d=Qs();to(a,r,o,d)}function to(a,r,o,d){var h={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(qc(a))ry(r,h);else{var y=a.alternate;if(a.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var $=r.lastRenderedState,U=y($,o);if(h.hasEagerState=!0,h.eagerState=U,Hs(U,$))return Ec(a,r,h,0),jt===null&&Tc(),!1}catch{}finally{}if(o=Ku(a,r,h,d),o!==null)return Cs(o,a,d),iy(o,r,d),!0}return!1}function Sh(a,r,o,d){if(d={lane:2,revertLane:ff(),action:d,hasEagerState:!1,eagerState:null,next:null},qc(a)){if(r)throw Error(i(479))}else r=Ku(a,o,d,2),r!==null&&Cs(r,a,2)}function qc(a){var r=a.alternate;return a===Ze||r!==null&&r===Ze}function ry(a,r){Bi=Mc=!0;var o=a.pending;o===null?r.next=r:(r.next=o.next,o.next=r),a.pending=r}function iy(a,r,o){if((o&4194176)!==0){var d=r.lanes;d&=a.pendingLanes,o|=d,r.lanes=o,yp(a,o)}}var Ya={readContext:js,use:Bc,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useLayoutEffect:qt,useInsertionEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useSyncExternalStore:qt,useId:qt};Ya.useCacheRefresh=qt,Ya.useMemoCache=qt,Ya.useHostTransitionStatus=qt,Ya.useFormState=qt,Ya.useActionState=qt,Ya.useOptimistic=qt;var Br={readContext:js,use:Bc,useCallback:function(a,r){return Os().memoizedState=[a,r===void 0?null:r],a},useContext:js,useEffect:Yg,useImperativeHandle:function(a,r,o){o=o!=null?o.concat([a]):null,Uc(4194308,4,Qg.bind(null,r,a),o)},useLayoutEffect:function(a,r){return Uc(4194308,4,a,r)},useInsertionEffect:function(a,r){Uc(4,2,a,r)},useMemo:function(a,r){var o=Os();r=r===void 0?null:r;var d=a();if(Lr){Ea(!0);try{a()}finally{Ea(!1)}}return o.memoizedState=[d,r],d},useReducer:function(a,r,o){var d=Os();if(o!==void 0){var h=o(r);if(Lr){Ea(!0);try{o(r)}finally{Ea(!1)}}}else h=r;return d.memoizedState=d.baseState=h,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:h},d.queue=a,a=a.dispatch=xS.bind(null,Ze,a),[d.memoizedState,a]},useRef:function(a){var r=Os();return a={current:a},r.memoizedState=a},useState:function(a){a=gh(a);var r=a.queue,o=ny.bind(null,Ze,r);return r.dispatch=o,[a.memoizedState,o]},useDebugValue:xh,useDeferredValue:function(a,r){var o=Os();return jh(o,a,r)},useTransition:function(){var a=gh(!1);return a=Jg.bind(null,Ze,a.queue,!0,!1),Os().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,o){var d=Ze,h=Os();if(rt){if(o===void 0)throw Error(i(407));o=o()}else{if(o=r(),jt===null)throw Error(i(349));(nt&60)!==0||Dg(d,r,o)}h.memoizedState=o;var y={value:o,getSnapshot:r};return h.queue=y,Yg(_g.bind(null,d,y,a),[a]),d.flags|=2048,Ui(9,kg.bind(null,d,y,o,r),{destroy:void 0},null),o},useId:function(){var a=Os(),r=jt.identifierPrefix;if(rt){var o=ln,d=rn;o=(d&~(1<<32-ke(d)-1)).toString(32)+o,r=":"+r+"R"+o,o=zc++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=fS++,r=":"+r+"r"+o.toString(32)+":";return a.memoizedState=r},useCacheRefresh:function(){return Os().memoizedState=vS.bind(null,Ze)}};Br.useMemoCache=fh,Br.useHostTransitionStatus=Nh,Br.useFormState=Fg,Br.useActionState=Fg,Br.useOptimistic=function(a){var r=Os();r.memoizedState=r.baseState=a;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=o,r=Sh.bind(null,Ze,!0,o),o.dispatch=r,[a,r]};var qn={readContext:js,use:Bc,useCallback:Zg,useContext:js,useEffect:vh,useImperativeHandle:Xg,useInsertionEffect:Vg,useLayoutEffect:Gg,useMemo:Wg,useReducer:Fc,useRef:Hg,useState:function(){return Fc(cn)},useDebugValue:xh,useDeferredValue:function(a,r){var o=Xt();return Kg(o,ht.memoizedState,a,r)},useTransition:function(){var a=Fc(cn)[0],r=Xt().memoizedState;return[typeof a=="boolean"?a:eo(a),r]},useSyncExternalStore:Ag,useId:sy};qn.useCacheRefresh=ay,qn.useMemoCache=fh,qn.useHostTransitionStatus=Nh,qn.useFormState=Ug,qn.useActionState=Ug,qn.useOptimistic=function(a,r){var o=Xt();return $g(o,ht,a,r)};var Fr={readContext:js,use:Bc,useCallback:Zg,useContext:js,useEffect:vh,useImperativeHandle:Xg,useInsertionEffect:Vg,useLayoutEffect:Gg,useMemo:Wg,useReducer:ph,useRef:Hg,useState:function(){return ph(cn)},useDebugValue:xh,useDeferredValue:function(a,r){var o=Xt();return ht===null?jh(o,a,r):Kg(o,ht.memoizedState,a,r)},useTransition:function(){var a=ph(cn)[0],r=Xt().memoizedState;return[typeof a=="boolean"?a:eo(a),r]},useSyncExternalStore:Ag,useId:sy};Fr.useCacheRefresh=ay,Fr.useMemoCache=fh,Fr.useHostTransitionStatus=Nh,Fr.useFormState=qg,Fr.useActionState=qg,Fr.useOptimistic=function(a,r){var o=Xt();return ht!==null?$g(o,ht,a,r):(o.baseState=a,[a,o.queue.dispatch])};function wh(a,r,o,d){r=a.memoizedState,o=o(d,r),o=o==null?r:M({},r,o),a.memoizedState=o,a.lanes===0&&(a.updateQueue.baseState=o)}var Th={isMounted:function(a){return(a=a._reactInternals)?X(a)===a:!1},enqueueSetState:function(a,r,o){a=a._reactInternals;var d=Qs(),h=Vn(d);h.payload=r,o!=null&&(h.callback=o),r=Gn(a,h,d),r!==null&&(Cs(r,a,d),no(r,a,d))},enqueueReplaceState:function(a,r,o){a=a._reactInternals;var d=Qs(),h=Vn(d);h.tag=1,h.payload=r,o!=null&&(h.callback=o),r=Gn(a,h,d),r!==null&&(Cs(r,a,d),no(r,a,d))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var o=Qs(),d=Vn(o);d.tag=2,r!=null&&(d.callback=r),r=Gn(a,d,o),r!==null&&(Cs(r,a,o),no(r,a,o))}};function ly(a,r,o,d,h,y,$){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(d,y,$):r.prototype&&r.prototype.isPureReactComponent?!Pl(o,d)||!Pl(h,y):!0}function oy(a,r,o,d){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,d),r.state!==a&&Th.enqueueReplaceState(r,r.state,null)}function Ur(a,r){var o=r;if("ref"in r){o={};for(var d in r)d!=="ref"&&(o[d]=r[d])}if(a=a.defaultProps){o===r&&(o=M({},o));for(var h in a)o[h]===void 0&&(o[h]=a[h])}return o}var Hc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function cy(a){Hc(a)}function dy(a){console.error(a)}function uy(a){Hc(a)}function Yc(a,r){try{var o=a.onUncaughtError;o(r.value,{componentStack:r.stack})}catch(d){setTimeout(function(){throw d})}}function hy(a,r,o){try{var d=a.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function Eh(a,r,o){return o=Vn(o),o.tag=3,o.payload={element:null},o.callback=function(){Yc(a,r)},o}function fy(a){return a=Vn(a),a.tag=3,a}function my(a,r,o,d){var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var y=d.value;a.payload=function(){return h(y)},a.callback=function(){hy(r,o,d)}}var $=o.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(a.callback=function(){hy(r,o,d),typeof h!="function"&&(Jn===null?Jn=new Set([this]):Jn.add(this));var U=d.stack;this.componentDidCatch(d.value,{componentStack:U!==null?U:""})})}function jS(a,r,o,d,h){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(r=o.alternate,r!==null&&ao(r,o,h,!0),o=ha.current,o!==null){switch(o.tag){case 13:return Ha===null?of():o.alternate===null&&zt===0&&(zt=3),o.flags&=-257,o.flags|=65536,o.lanes=h,d===sh?o.flags|=16384:(r=o.updateQueue,r===null?o.updateQueue=new Set([d]):r.add(d),df(a,d,h)),!1;case 22:return o.flags|=65536,d===sh?o.flags|=16384:(r=o.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=r):(o=r.retryQueue,o===null?r.retryQueue=new Set([d]):o.add(d)),df(a,d,h)),!1}throw Error(i(435,o.tag))}return df(a,d,h),of(),!1}if(rt)return r=ha.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=h,d!==th&&(a=Error(i(422),{cause:d}),Vl(ca(a,o)))):(d!==th&&(r=Error(i(423),{cause:d}),Vl(ca(r,o))),a=a.current.alternate,a.flags|=65536,h&=-h,a.lanes|=h,d=ca(d,o),h=Eh(a.stateNode,d,h),Uh(a,h),zt!==4&&(zt=2)),!1;var y=Error(i(520),{cause:d});if(y=ca(y,o),fo===null?fo=[y]:fo.push(y),zt!==4&&(zt=2),r===null)return!0;d=ca(d,o),o=r;do{switch(o.tag){case 3:return o.flags|=65536,a=h&-h,o.lanes|=a,a=Eh(o.stateNode,d,a),Uh(o,a),!1;case 1:if(r=o.type,y=o.stateNode,(o.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Jn===null||!Jn.has(y))))return o.flags|=65536,h&=-h,o.lanes|=h,h=fy(h),my(h,a,o,d),Uh(o,h),!1}o=o.return}while(o!==null);return!1}var py=Error(i(461)),as=!1;function ds(a,r,o,d){r.child=a===null?jg(r,null,o,d):Mr(r,a.child,o,d)}function gy(a,r,o,d,h){o=o.render;var y=r.ref;if("ref"in d){var $={};for(var U in d)U!=="ref"&&($[U]=d[U])}else $=d;return qr(r),d=ch(a,r,o,$,y,h),U=dh(),a!==null&&!as?(uh(a,r,h),dn(a,r,h)):(rt&&U&&Ju(r),r.flags|=1,ds(a,r,d,h),r.child)}function yy(a,r,o,d,h){if(a===null){var y=o.type;return typeof y=="function"&&!Xh(y)&&y.defaultProps===void 0&&o.compare===null?(r.tag=15,r.type=y,vy(a,r,y,d,h)):(a=Zc(o.type,null,d,r,r.mode,h),a.ref=r.ref,a.return=r,r.child=a)}if(y=a.child,!Rh(a,h)){var $=y.memoizedProps;if(o=o.compare,o=o!==null?o:Pl,o($,d)&&a.ref===r.ref)return dn(a,r,h)}return r.flags|=1,a=Wn(y,d),a.ref=r.ref,a.return=r,r.child=a}function vy(a,r,o,d,h){if(a!==null){var y=a.memoizedProps;if(Pl(y,d)&&a.ref===r.ref)if(as=!1,r.pendingProps=d=y,Rh(a,h))(a.flags&131072)!==0&&(as=!0);else return r.lanes=a.lanes,dn(a,r,h)}return Ch(a,r,o,d,h)}function xy(a,r,o){var d=r.pendingProps,h=d.children,y=(r.stateNode._pendingVisibility&2)!==0,$=a!==null?a.memoizedState:null;if(so(a,r),d.mode==="hidden"||y){if((r.flags&128)!==0){if(d=$!==null?$.baseLanes|o:o,a!==null){for(h=r.child=a.child,y=0;h!==null;)y=y|h.lanes|h.childLanes,h=h.sibling;r.childLanes=y&~d}else r.childLanes=0,r.child=null;return jy(a,r,d,o)}if((o&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&Rc(r,$!==null?$.cachePool:null),$!==null?bg(r,$):ah(),Ng(r);else return r.lanes=r.childLanes=536870912,jy(a,r,$!==null?$.baseLanes|o:o,o)}else $!==null?(Rc(r,$.cachePool),bg(r,$),Un(),r.memoizedState=null):(a!==null&&Rc(r,null),ah(),Un());return ds(a,r,h,o),r.child}function jy(a,r,o,d){var h=lh();return h=h===null?null:{parent:Kt._currentValue,pool:h},r.memoizedState={baseLanes:o,cachePool:h},a!==null&&Rc(r,null),ah(),Ng(r),a!==null&&ao(a,r,d,!0),null}function so(a,r){var o=r.ref;if(o===null)a!==null&&a.ref!==null&&(r.flags|=2097664);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(a===null||a.ref!==o)&&(r.flags|=2097664)}}function Ch(a,r,o,d,h){return qr(r),o=ch(a,r,o,d,void 0,h),d=dh(),a!==null&&!as?(uh(a,r,h),dn(a,r,h)):(rt&&d&&Ju(r),r.flags|=1,ds(a,r,o,h),r.child)}function by(a,r,o,d,h,y){return qr(r),r.updateQueue=null,o=Cg(r,d,o,h),Eg(a),d=dh(),a!==null&&!as?(uh(a,r,y),dn(a,r,y)):(rt&&d&&Ju(r),r.flags|=1,ds(a,r,o,y),r.child)}function Ny(a,r,o,d,h){if(qr(r),r.stateNode===null){var y=Oi,$=o.contextType;typeof $=="object"&&$!==null&&(y=js($)),y=new o(d,y),r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Th,r.stateNode=y,y._reactInternals=r,y=r.stateNode,y.props=d,y.state=r.memoizedState,y.refs={},Bh(r),$=o.contextType,y.context=typeof $=="object"&&$!==null?js($):Oi,y.state=r.memoizedState,$=o.getDerivedStateFromProps,typeof $=="function"&&(wh(r,o,$,d),y.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||($=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),$!==y.state&&Th.enqueueReplaceState(y,y.state,null),io(r,d,y,h),ro(),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308),d=!0}else if(a===null){y=r.stateNode;var U=r.memoizedProps,J=Ur(o,U);y.props=J;var le=y.context,we=o.contextType;$=Oi,typeof we=="object"&&we!==null&&($=js(we));var Ce=o.getDerivedStateFromProps;we=typeof Ce=="function"||typeof y.getSnapshotBeforeUpdate=="function",U=r.pendingProps!==U,we||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(U||le!==$)&&oy(r,y,d,$),Yn=!1;var fe=r.memoizedState;y.state=fe,io(r,d,y,h),ro(),le=r.memoizedState,U||fe!==le||Yn?(typeof Ce=="function"&&(wh(r,o,Ce,d),le=r.memoizedState),(J=Yn||ly(r,o,J,d,fe,le,$))?(we||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(r.flags|=4194308)):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=le),y.props=d,y.state=le,y.context=$,d=J):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{y=r.stateNode,Fh(a,r),$=r.memoizedProps,we=Ur(o,$),y.props=we,Ce=r.pendingProps,fe=y.context,le=o.contextType,J=Oi,typeof le=="object"&&le!==null&&(J=js(le)),U=o.getDerivedStateFromProps,(le=typeof U=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||($!==Ce||fe!==J)&&oy(r,y,d,J),Yn=!1,fe=r.memoizedState,y.state=fe,io(r,d,y,h),ro();var Se=r.memoizedState;$!==Ce||fe!==Se||Yn||a!==null&&a.dependencies!==null&&Vc(a.dependencies)?(typeof U=="function"&&(wh(r,o,U,d),Se=r.memoizedState),(we=Yn||ly(r,o,we,d,fe,Se,J)||a!==null&&a.dependencies!==null&&Vc(a.dependencies))?(le||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,Se,J),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,Se,J)),typeof y.componentDidUpdate=="function"&&(r.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof y.componentDidUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=Se),y.props=d,y.state=Se,y.context=J,d=we):(typeof y.componentDidUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=1024),d=!1)}return y=d,so(a,r),d=(r.flags&128)!==0,y||d?(y=r.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:y.render(),r.flags|=1,a!==null&&d?(r.child=Mr(r,a.child,null,h),r.child=Mr(r,null,o,h)):ds(a,r,o,h),r.memoizedState=y.state,a=r.child):a=dn(a,r,h),a}function Sy(a,r,o,d){return Yl(),r.flags|=256,ds(a,r,o,d),r.child}var Ah={dehydrated:null,treeContext:null,retryLane:0};function Dh(a){return{baseLanes:a,cachePool:Tg()}}function kh(a,r,o){return a=a!==null?a.childLanes&~o:0,r&&(a|=ga),a}function wy(a,r,o){var d=r.pendingProps,h=!1,y=(r.flags&128)!==0,$;if(($=y)||($=a!==null&&a.memoizedState===null?!1:(Wt.current&2)!==0),$&&(h=!0,r.flags&=-129),$=(r.flags&32)!==0,r.flags&=-33,a===null){if(rt){if(h?Fn(r):Un(),rt){var U=cs,J;if(J=U){e:{for(J=U,U=qa;J.nodeType!==8;){if(!U){U=null;break e}if(J=ka(J.nextSibling),J===null){U=null;break e}}U=J}U!==null?(r.memoizedState={dehydrated:U,treeContext:Ir!==null?{id:rn,overflow:ln}:null,retryLane:536870912},J=pa(18,null,null,0),J.stateNode=U,J.return=r,r.child=J,Es=r,cs=null,J=!0):J=!1}J||Rr(r)}if(U=r.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return U.data==="$!"?r.lanes=16:r.lanes=536870912,null;on(r)}return U=d.children,d=d.fallback,h?(Un(),h=r.mode,U=Oh({mode:"hidden",children:U},h),d=Yr(d,h,o,null),U.return=r,d.return=r,U.sibling=d,r.child=U,h=r.child,h.memoizedState=Dh(o),h.childLanes=kh(a,$,o),r.memoizedState=Ah,d):(Fn(r),_h(r,U))}if(J=a.memoizedState,J!==null&&(U=J.dehydrated,U!==null)){if(y)r.flags&256?(Fn(r),r.flags&=-257,r=Ih(a,r,o)):r.memoizedState!==null?(Un(),r.child=a.child,r.flags|=128,r=null):(Un(),h=d.fallback,U=r.mode,d=Oh({mode:"visible",children:d.children},U),h=Yr(h,U,o,null),h.flags|=2,d.return=r,h.return=r,d.sibling=h,r.child=d,Mr(r,a.child,null,o),d=r.child,d.memoizedState=Dh(o),d.childLanes=kh(a,$,o),r.memoizedState=Ah,r=h);else if(Fn(r),U.data==="$!"){if($=U.nextSibling&&U.nextSibling.dataset,$)var le=$.dgst;$=le,d=Error(i(419)),d.stack="",d.digest=$,Vl({value:d,source:null,stack:null}),r=Ih(a,r,o)}else if(as||ao(a,r,o,!1),$=(o&a.childLanes)!==0,as||$){if($=jt,$!==null){if(d=o&-o,(d&42)!==0)d=1;else switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=64;break;case 268435456:d=134217728;break;default:d=0}if(d=(d&($.suspendedLanes|o))!==0?0:d,d!==0&&d!==J.retryLane)throw J.retryLane=d,Bn(a,d),Cs($,a,d),py}U.data==="$?"||of(),r=Ih(a,r,o)}else U.data==="$?"?(r.flags|=128,r.child=a.child,r=RS.bind(null,a),U._reactRetry=r,r=null):(a=J.treeContext,cs=ka(U.nextSibling),Es=r,rt=!0,Aa=null,qa=!1,a!==null&&(da[ua++]=rn,da[ua++]=ln,da[ua++]=Ir,rn=a.id,ln=a.overflow,Ir=r),r=_h(r,d.children),r.flags|=4096);return r}return h?(Un(),h=d.fallback,U=r.mode,J=a.child,le=J.sibling,d=Wn(J,{mode:"hidden",children:d.children}),d.subtreeFlags=J.subtreeFlags&31457280,le!==null?h=Wn(le,h):(h=Yr(h,U,o,null),h.flags|=2),h.return=r,d.return=r,d.sibling=h,r.child=d,d=h,h=r.child,U=a.child.memoizedState,U===null?U=Dh(o):(J=U.cachePool,J!==null?(le=Kt._currentValue,J=J.parent!==le?{parent:le,pool:le}:J):J=Tg(),U={baseLanes:U.baseLanes|o,cachePool:J}),h.memoizedState=U,h.childLanes=kh(a,$,o),r.memoizedState=Ah,d):(Fn(r),o=a.child,a=o.sibling,o=Wn(o,{mode:"visible",children:d.children}),o.return=r,o.sibling=null,a!==null&&($=r.deletions,$===null?(r.deletions=[a],r.flags|=16):$.push(a)),r.child=o,r.memoizedState=null,o)}function _h(a,r){return r=Oh({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function Oh(a,r){return Zy(a,r,0,null)}function Ih(a,r,o){return Mr(r,a.child,null,o),a=_h(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function Ty(a,r,o){a.lanes|=r;var d=a.alternate;d!==null&&(d.lanes|=r),zh(a.return,r,o)}function $h(a,r,o,d,h){var y=a.memoizedState;y===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:h}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=o,y.tailMode=h)}function Ey(a,r,o){var d=r.pendingProps,h=d.revealOrder,y=d.tail;if(ds(a,r,d.children,o),d=Wt.current,(d&2)!==0)d=d&1|2,r.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Ty(a,o,r);else if(a.tag===19)Ty(a,o,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}switch(oe(Wt,d),h){case"forwards":for(o=r.child,h=null;o!==null;)a=o.alternate,a!==null&&$c(a)===null&&(h=o),o=o.sibling;o=h,o===null?(h=r.child,r.child=null):(h=o.sibling,o.sibling=null),$h(r,!1,h,o,y);break;case"backwards":for(o=null,h=r.child,r.child=null;h!==null;){if(a=h.alternate,a!==null&&$c(a)===null){r.child=h;break}a=h.sibling,h.sibling=o,o=h,h=a}$h(r,!0,o,null,y);break;case"together":$h(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function dn(a,r,o){if(a!==null&&(r.dependencies=a.dependencies),Kn|=r.lanes,(o&r.childLanes)===0)if(a!==null){if(ao(a,r,o,!1),(o&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(i(153));if(r.child!==null){for(a=r.child,o=Wn(a,a.pendingProps),r.child=o,o.return=r;a.sibling!==null;)a=a.sibling,o=o.sibling=Wn(a,a.pendingProps),o.return=r;o.sibling=null}return r.child}function Rh(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&Vc(a)))}function bS(a,r,o){switch(r.tag){case 3:me(r,r.stateNode.containerInfo),Hn(r,Kt,a.memoizedState.cache),Yl();break;case 27:case 5:Oe(r);break;case 4:me(r,r.stateNode.containerInfo);break;case 10:Hn(r,r.type,r.memoizedProps.value);break;case 13:var d=r.memoizedState;if(d!==null)return d.dehydrated!==null?(Fn(r),r.flags|=128,null):(o&r.child.childLanes)!==0?wy(a,r,o):(Fn(r),a=dn(a,r,o),a!==null?a.sibling:null);Fn(r);break;case 19:var h=(a.flags&128)!==0;if(d=(o&r.childLanes)!==0,d||(ao(a,r,o,!1),d=(o&r.childLanes)!==0),h){if(d)return Ey(a,r,o);r.flags|=128}if(h=r.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),oe(Wt,Wt.current),d)break;return null;case 22:case 23:return r.lanes=0,xy(a,r,o);case 24:Hn(r,Kt,a.memoizedState.cache)}return dn(a,r,o)}function Cy(a,r,o){if(a!==null)if(a.memoizedProps!==r.pendingProps)as=!0;else{if(!Rh(a,o)&&(r.flags&128)===0)return as=!1,bS(a,r,o);as=(a.flags&131072)!==0}else as=!1,rt&&(r.flags&1048576)!==0&&ug(r,Dc,r.index);switch(r.lanes=0,r.tag){case 16:e:{a=r.pendingProps;var d=r.elementType,h=d._init;if(d=h(d._payload),r.type=d,typeof d=="function")Xh(d)?(a=Ur(d,a),r.tag=1,r=Ny(null,r,d,a,o)):(r.tag=0,r=Ch(null,r,d,a,o));else{if(d!=null){if(h=d.$$typeof,h===b){r.tag=11,r=gy(null,r,d,a,o);break e}else if(h===T){r.tag=14,r=yy(null,r,d,a,o);break e}}throw r=k(d)||d,Error(i(306,r,""))}}return r;case 0:return Ch(a,r,r.type,r.pendingProps,o);case 1:return d=r.type,h=Ur(d,r.pendingProps),Ny(a,r,d,h,o);case 3:e:{if(me(r,r.stateNode.containerInfo),a===null)throw Error(i(387));var y=r.pendingProps;h=r.memoizedState,d=h.element,Fh(a,r),io(r,y,null,o);var $=r.memoizedState;if(y=$.cache,Hn(r,Kt,y),y!==h.cache&&Lh(r,[Kt],o,!0),ro(),y=$.element,h.isDehydrated)if(h={element:y,isDehydrated:!1,cache:$.cache},r.updateQueue.baseState=h,r.memoizedState=h,r.flags&256){r=Sy(a,r,y,o);break e}else if(y!==d){d=ca(Error(i(424)),r),Vl(d),r=Sy(a,r,y,o);break e}else for(cs=ka(r.stateNode.containerInfo.firstChild),Es=r,rt=!0,Aa=null,qa=!0,o=jg(r,null,y,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Yl(),y===d){r=dn(a,r,o);break e}ds(a,r,y,o)}r=r.child}return r;case 26:return so(a,r),a===null?(o=kv(r.type,null,r.pendingProps,null))?r.memoizedState=o:rt||(o=r.type,a=r.pendingProps,d=od(re.current).createElement(o),d[xs]=r,d[ks]=a,us(d,o,a),ss(d),r.stateNode=d):r.memoizedState=kv(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return Oe(r),a===null&&rt&&(d=r.stateNode=Cv(r.type,r.pendingProps,re.current),Es=r,qa=!0,cs=ka(d.firstChild)),d=r.pendingProps.children,a!==null||rt?ds(a,r,d,o):r.child=Mr(r,null,d,o),so(a,r),r.child;case 5:return a===null&&rt&&((h=d=cs)&&(d=WS(d,r.type,r.pendingProps,qa),d!==null?(r.stateNode=d,Es=r,cs=ka(d.firstChild),qa=!1,h=!0):h=!1),h||Rr(r)),Oe(r),h=r.type,y=r.pendingProps,$=a!==null?a.memoizedProps:null,d=y.children,Nf(h,y)?d=null:$!==null&&Nf(h,$)&&(r.flags|=32),r.memoizedState!==null&&(h=ch(a,r,mS,null,null,o),No._currentValue=h),so(a,r),ds(a,r,d,o),r.child;case 6:return a===null&&rt&&((a=o=cs)&&(o=KS(o,r.pendingProps,qa),o!==null?(r.stateNode=o,Es=r,cs=null,a=!0):a=!1),a||Rr(r)),null;case 13:return wy(a,r,o);case 4:return me(r,r.stateNode.containerInfo),d=r.pendingProps,a===null?r.child=Mr(r,null,d,o):ds(a,r,d,o),r.child;case 11:return gy(a,r,r.type,r.pendingProps,o);case 7:return ds(a,r,r.pendingProps,o),r.child;case 8:return ds(a,r,r.pendingProps.children,o),r.child;case 12:return ds(a,r,r.pendingProps.children,o),r.child;case 10:return d=r.pendingProps,Hn(r,r.type,d.value),ds(a,r,d.children,o),r.child;case 9:return h=r.type._context,d=r.pendingProps.children,qr(r),h=js(h),d=d(h),r.flags|=1,ds(a,r,d,o),r.child;case 14:return yy(a,r,r.type,r.pendingProps,o);case 15:return vy(a,r,r.type,r.pendingProps,o);case 19:return Ey(a,r,o);case 22:return xy(a,r,o);case 24:return qr(r),d=js(Kt),a===null?(h=lh(),h===null&&(h=jt,y=rh(),h.pooledCache=y,y.refCount++,y!==null&&(h.pooledCacheLanes|=o),h=y),r.memoizedState={parent:d,cache:h},Bh(r),Hn(r,Kt,h)):((a.lanes&o)!==0&&(Fh(a,r),io(r,null,null,o),ro()),h=a.memoizedState,y=r.memoizedState,h.parent!==d?(h={parent:d,cache:d},r.memoizedState=h,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=h),Hn(r,Kt,d)):(d=y.cache,Hn(r,Kt,d),d!==h.cache&&Lh(r,[Kt],o,!0))),ds(a,r,r.pendingProps.children,o),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}var Mh=te(null),Pr=null,un=null;function Hn(a,r,o){oe(Mh,r._currentValue),r._currentValue=o}function hn(a){a._currentValue=Mh.current,ae(Mh)}function zh(a,r,o){for(;a!==null;){var d=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),a===o)break;a=a.return}}function Lh(a,r,o,d){var h=a.child;for(h!==null&&(h.return=a);h!==null;){var y=h.dependencies;if(y!==null){var $=h.child;y=y.firstContext;e:for(;y!==null;){var U=y;y=h;for(var J=0;J<r.length;J++)if(U.context===r[J]){y.lanes|=o,U=y.alternate,U!==null&&(U.lanes|=o),zh(y.return,o,a),d||($=null);break e}y=U.next}}else if(h.tag===18){if($=h.return,$===null)throw Error(i(341));$.lanes|=o,y=$.alternate,y!==null&&(y.lanes|=o),zh($,o,a),$=null}else $=h.child;if($!==null)$.return=h;else for($=h;$!==null;){if($===a){$=null;break}if(h=$.sibling,h!==null){h.return=$.return,$=h;break}$=$.return}h=$}}function ao(a,r,o,d){a=null;for(var h=r,y=!1;h!==null;){if(!y){if((h.flags&524288)!==0)y=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var $=h.alternate;if($===null)throw Error(i(387));if($=$.memoizedProps,$!==null){var U=h.type;Hs(h.pendingProps.value,$.value)||(a!==null?a.push(U):a=[U])}}else if(h===pe.current){if($=h.alternate,$===null)throw Error(i(387));$.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(a!==null?a.push(No):a=[No])}h=h.return}a!==null&&Lh(r,a,o,d),r.flags|=262144}function Vc(a){for(a=a.firstContext;a!==null;){if(!Hs(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function qr(a){Pr=a,un=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function js(a){return Ay(Pr,a)}function Gc(a,r){return Pr===null&&qr(a),Ay(a,r)}function Ay(a,r){var o=r._currentValue;if(r={context:r,memoizedValue:o,next:null},un===null){if(a===null)throw Error(i(308));un=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else un=un.next=r;return o}var Yn=!1;function Bh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Fh(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Vn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Gn(a,r,o){var d=a.updateQueue;if(d===null)return null;if(d=d.shared,(kt&2)!==0){var h=d.pending;return h===null?r.next=r:(r.next=h.next,h.next=r),d.pending=r,r=Cc(a),cg(a,null,o),r}return Ec(a,d,r,o),Cc(a)}function no(a,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194176)!==0)){var d=r.lanes;d&=a.pendingLanes,o|=d,r.lanes=o,yp(a,o)}}function Uh(a,r){var o=a.updateQueue,d=a.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var h=null,y=null;if(o=o.firstBaseUpdate,o!==null){do{var $={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};y===null?h=y=$:y=y.next=$,o=o.next}while(o!==null);y===null?h=y=r:y=y.next=r}else h=y=r;o={baseState:d.baseState,firstBaseUpdate:h,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},a.updateQueue=o;return}a=o.lastBaseUpdate,a===null?o.firstBaseUpdate=r:a.next=r,o.lastBaseUpdate=r}var Ph=!1;function ro(){if(Ph){var a=Li;if(a!==null)throw a}}function io(a,r,o,d){Ph=!1;var h=a.updateQueue;Yn=!1;var y=h.firstBaseUpdate,$=h.lastBaseUpdate,U=h.shared.pending;if(U!==null){h.shared.pending=null;var J=U,le=J.next;J.next=null,$===null?y=le:$.next=le,$=J;var we=a.alternate;we!==null&&(we=we.updateQueue,U=we.lastBaseUpdate,U!==$&&(U===null?we.firstBaseUpdate=le:U.next=le,we.lastBaseUpdate=J))}if(y!==null){var Ce=h.baseState;$=0,we=le=J=null,U=y;do{var fe=U.lane&-536870913,Se=fe!==U.lane;if(Se?(nt&fe)===fe:(d&fe)===fe){fe!==0&&fe===zi&&(Ph=!0),we!==null&&(we=we.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var Fe=a,Ge=U;fe=r;var Lt=o;switch(Ge.tag){case 1:if(Fe=Ge.payload,typeof Fe=="function"){Ce=Fe.call(Lt,Ce,fe);break e}Ce=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ge.payload,fe=typeof Fe=="function"?Fe.call(Lt,Ce,fe):Fe,fe==null)break e;Ce=M({},Ce,fe);break e;case 2:Yn=!0}}fe=U.callback,fe!==null&&(a.flags|=64,Se&&(a.flags|=8192),Se=h.callbacks,Se===null?h.callbacks=[fe]:Se.push(fe))}else Se={lane:fe,tag:U.tag,payload:U.payload,callback:U.callback,next:null},we===null?(le=we=Se,J=Ce):we=we.next=Se,$|=fe;if(U=U.next,U===null){if(U=h.shared.pending,U===null)break;Se=U,U=Se.next,Se.next=null,h.lastBaseUpdate=Se,h.shared.pending=null}}while(!0);we===null&&(J=Ce),h.baseState=J,h.firstBaseUpdate=le,h.lastBaseUpdate=we,y===null&&(h.shared.lanes=0),Kn|=$,a.lanes=$,a.memoizedState=Ce}}function Dy(a,r){if(typeof a!="function")throw Error(i(191,a));a.call(r)}function ky(a,r){var o=a.callbacks;if(o!==null)for(a.callbacks=null,a=0;a<o.length;a++)Dy(o[a],r)}function lo(a,r){try{var o=r.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var h=d.next;o=h;do{if((o.tag&a)===a){d=void 0;var y=o.create,$=o.inst;d=y(),$.destroy=d}o=o.next}while(o!==h)}}catch(U){pt(r,r.return,U)}}function Qn(a,r,o){try{var d=r.updateQueue,h=d!==null?d.lastEffect:null;if(h!==null){var y=h.next;d=y;do{if((d.tag&a)===a){var $=d.inst,U=$.destroy;if(U!==void 0){$.destroy=void 0,h=r;var J=o;try{U()}catch(le){pt(h,J,le)}}}d=d.next}while(d!==y)}}catch(le){pt(r,r.return,le)}}function _y(a){var r=a.updateQueue;if(r!==null){var o=a.stateNode;try{ky(r,o)}catch(d){pt(a,a.return,d)}}}function Oy(a,r,o){o.props=Ur(a.type,a.memoizedProps),o.state=a.memoizedState;try{o.componentWillUnmount()}catch(d){pt(a,r,d)}}function Hr(a,r){try{var o=a.ref;if(o!==null){var d=a.stateNode;switch(a.tag){case 26:case 27:case 5:var h=d;break;default:h=d}typeof o=="function"?a.refCleanup=o(h):o.current=h}}catch(y){pt(a,r,y)}}function Ys(a,r){var o=a.ref,d=a.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(h){pt(a,r,h)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(h){pt(a,r,h)}else o.current=null}function Iy(a){var r=a.type,o=a.memoizedProps,d=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(h){pt(a,a.return,h)}}function $y(a,r,o){try{var d=a.stateNode;VS(d,a.type,o,r),d[ks]=r}catch(h){pt(a,a.return,h)}}function Ry(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27||a.tag===4}function qh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Ry(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==27&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Hh(a,r,o){var d=a.tag;if(d===5||d===6)a=a.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(a,r):o.insertBefore(a,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(a,o)):(r=o,r.appendChild(a)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=ld));else if(d!==4&&d!==27&&(a=a.child,a!==null))for(Hh(a,r,o),a=a.sibling;a!==null;)Hh(a,r,o),a=a.sibling}function Qc(a,r,o){var d=a.tag;if(d===5||d===6)a=a.stateNode,r?o.insertBefore(a,r):o.appendChild(a);else if(d!==4&&d!==27&&(a=a.child,a!==null))for(Qc(a,r,o),a=a.sibling;a!==null;)Qc(a,r,o),a=a.sibling}var fn=!1,Mt=!1,Yh=!1,My=typeof WeakSet=="function"?WeakSet:Set,ns=null,zy=!1;function NS(a,r){if(a=a.containerInfo,jf=md,a=eg(a),Gu(a)){if("selectionStart"in a)var o={start:a.selectionStart,end:a.selectionEnd};else e:{o=(o=a.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var h=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{o.nodeType,y.nodeType}catch{o=null;break e}var $=0,U=-1,J=-1,le=0,we=0,Ce=a,fe=null;t:for(;;){for(var Se;Ce!==o||h!==0&&Ce.nodeType!==3||(U=$+h),Ce!==y||d!==0&&Ce.nodeType!==3||(J=$+d),Ce.nodeType===3&&($+=Ce.nodeValue.length),(Se=Ce.firstChild)!==null;)fe=Ce,Ce=Se;for(;;){if(Ce===a)break t;if(fe===o&&++le===h&&(U=$),fe===y&&++we===d&&(J=$),(Se=Ce.nextSibling)!==null)break;Ce=fe,fe=Ce.parentNode}Ce=Se}o=U===-1||J===-1?null:{start:U,end:J}}else o=null}o=o||{start:0,end:0}}else o=null;for(bf={focusedElem:a,selectionRange:o},md=!1,ns=r;ns!==null;)if(r=ns,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,ns=a;else for(;ns!==null;){switch(r=ns,y=r.alternate,a=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&y!==null){a=void 0,o=r,h=y.memoizedProps,y=y.memoizedState,d=o.stateNode;try{var Fe=Ur(o.type,h,o.elementType===o.type);a=d.getSnapshotBeforeUpdate(Fe,y),d.__reactInternalSnapshotBeforeUpdate=a}catch(Ge){pt(o,o.return,Ge)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,o=a.nodeType,o===9)Tf(a);else if(o===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Tf(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(i(163))}if(a=r.sibling,a!==null){a.return=r.return,ns=a;break}ns=r.return}return Fe=zy,zy=!1,Fe}function Ly(a,r,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:pn(a,o),d&4&&lo(5,o);break;case 1:if(pn(a,o),d&4)if(a=o.stateNode,r===null)try{a.componentDidMount()}catch(U){pt(o,o.return,U)}else{var h=Ur(o.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(h,r,a.__reactInternalSnapshotBeforeUpdate)}catch(U){pt(o,o.return,U)}}d&64&&_y(o),d&512&&Hr(o,o.return);break;case 3:if(pn(a,o),d&64&&(d=o.updateQueue,d!==null)){if(a=null,o.child!==null)switch(o.child.tag){case 27:case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}try{ky(d,a)}catch(U){pt(o,o.return,U)}}break;case 26:pn(a,o),d&512&&Hr(o,o.return);break;case 27:case 5:pn(a,o),r===null&&d&4&&Iy(o),d&512&&Hr(o,o.return);break;case 12:pn(a,o);break;case 13:pn(a,o),d&4&&Uy(a,o);break;case 22:if(h=o.memoizedState!==null||fn,!h){r=r!==null&&r.memoizedState!==null||Mt;var y=fn,$=Mt;fn=h,(Mt=r)&&!$?Xn(a,o,(o.subtreeFlags&8772)!==0):pn(a,o),fn=y,Mt=$}d&512&&(o.memoizedProps.mode==="manual"?Hr(o,o.return):Ys(o,o.return));break;default:pn(a,o)}}function By(a){var r=a.alternate;r!==null&&(a.alternate=null,By(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&_u(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Zt=null,Vs=!1;function mn(a,r,o){for(o=o.child;o!==null;)Fy(a,r,o),o=o.sibling}function Fy(a,r,o){if(xt&&typeof xt.onCommitFiberUnmount=="function")try{xt.onCommitFiberUnmount(Pt,o)}catch{}switch(o.tag){case 26:Mt||Ys(o,r),mn(a,r,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Mt||Ys(o,r);var d=Zt,h=Vs;for(Zt=o.stateNode,mn(a,r,o),o=o.stateNode,r=o.attributes;r.length;)o.removeAttributeNode(r[0]);_u(o),Zt=d,Vs=h;break;case 5:Mt||Ys(o,r);case 6:h=Zt;var y=Vs;if(Zt=null,mn(a,r,o),Zt=h,Vs=y,Zt!==null)if(Vs)try{a=Zt,d=o.stateNode,a.nodeType===8?a.parentNode.removeChild(d):a.removeChild(d)}catch($){pt(o,r,$)}else try{Zt.removeChild(o.stateNode)}catch($){pt(o,r,$)}break;case 18:Zt!==null&&(Vs?(r=Zt,o=o.stateNode,r.nodeType===8?wf(r.parentNode,o):r.nodeType===1&&wf(r,o),Eo(r)):wf(Zt,o.stateNode));break;case 4:d=Zt,h=Vs,Zt=o.stateNode.containerInfo,Vs=!0,mn(a,r,o),Zt=d,Vs=h;break;case 0:case 11:case 14:case 15:Mt||Qn(2,o,r),Mt||Qn(4,o,r),mn(a,r,o);break;case 1:Mt||(Ys(o,r),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Oy(o,r,d)),mn(a,r,o);break;case 21:mn(a,r,o);break;case 22:Mt||Ys(o,r),Mt=(d=Mt)||o.memoizedState!==null,mn(a,r,o),Mt=d;break;default:mn(a,r,o)}}function Uy(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Eo(a)}catch(o){pt(r,r.return,o)}}function SS(a){switch(a.tag){case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new My),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new My),r;default:throw Error(i(435,a.tag))}}function Vh(a,r){var o=SS(a);r.forEach(function(d){var h=MS.bind(null,a,d);o.has(d)||(o.add(d),d.then(h,h))})}function fa(a,r){var o=r.deletions;if(o!==null)for(var d=0;d<o.length;d++){var h=o[d],y=a,$=r,U=$;e:for(;U!==null;){switch(U.tag){case 27:case 5:Zt=U.stateNode,Vs=!1;break e;case 3:Zt=U.stateNode.containerInfo,Vs=!0;break e;case 4:Zt=U.stateNode.containerInfo,Vs=!0;break e}U=U.return}if(Zt===null)throw Error(i(160));Fy(y,$,h),Zt=null,Vs=!1,y=h.alternate,y!==null&&(y.return=null),h.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)Py(r,a),r=r.sibling}var Da=null;function Py(a,r){var o=a.alternate,d=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:fa(r,a),ma(a),d&4&&(Qn(3,a,a.return),lo(3,a),Qn(5,a,a.return));break;case 1:fa(r,a),ma(a),d&512&&(Mt||o===null||Ys(o,o.return)),d&64&&fn&&(a=a.updateQueue,a!==null&&(d=a.callbacks,d!==null&&(o=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var h=Da;if(fa(r,a),ma(a),d&512&&(Mt||o===null||Ys(o,o.return)),d&4){var y=o!==null?o.memoizedState:null;if(d=a.memoizedState,o===null)if(d===null)if(a.stateNode===null){e:{d=a.type,o=a.memoizedProps,h=h.ownerDocument||h;t:switch(d){case"title":y=h.getElementsByTagName("title")[0],(!y||y[Il]||y[xs]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=h.createElement(d),h.head.insertBefore(y,h.querySelector("head > title"))),us(y,d,o),y[xs]=a,ss(y),d=y;break e;case"link":var $=Iv("link","href",h).get(d+(o.href||""));if($){for(var U=0;U<$.length;U++)if(y=$[U],y.getAttribute("href")===(o.href==null?null:o.href)&&y.getAttribute("rel")===(o.rel==null?null:o.rel)&&y.getAttribute("title")===(o.title==null?null:o.title)&&y.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){$.splice(U,1);break t}}y=h.createElement(d),us(y,d,o),h.head.appendChild(y);break;case"meta":if($=Iv("meta","content",h).get(d+(o.content||""))){for(U=0;U<$.length;U++)if(y=$[U],y.getAttribute("content")===(o.content==null?null:""+o.content)&&y.getAttribute("name")===(o.name==null?null:o.name)&&y.getAttribute("property")===(o.property==null?null:o.property)&&y.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&y.getAttribute("charset")===(o.charSet==null?null:o.charSet)){$.splice(U,1);break t}}y=h.createElement(d),us(y,d,o),h.head.appendChild(y);break;default:throw Error(i(468,d))}y[xs]=a,ss(y),d=y}a.stateNode=d}else $v(h,a.type,a.stateNode);else a.stateNode=Ov(h,d,a.memoizedProps);else y!==d?(y===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):y.count--,d===null?$v(h,a.type,a.stateNode):Ov(h,d,a.memoizedProps)):d===null&&a.stateNode!==null&&$y(a,a.memoizedProps,o.memoizedProps)}break;case 27:if(d&4&&a.alternate===null){h=a.stateNode,y=a.memoizedProps;try{for(var J=h.firstChild;J;){var le=J.nextSibling,we=J.nodeName;J[Il]||we==="HEAD"||we==="BODY"||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&J.rel.toLowerCase()==="stylesheet"||h.removeChild(J),J=le}for(var Ce=a.type,fe=h.attributes;fe.length;)h.removeAttributeNode(fe[0]);us(h,Ce,y),h[xs]=a,h[ks]=y}catch(Fe){pt(a,a.return,Fe)}}case 5:if(fa(r,a),ma(a),d&512&&(Mt||o===null||Ys(o,o.return)),a.flags&32){h=a.stateNode;try{Ti(h,"")}catch(Fe){pt(a,a.return,Fe)}}d&4&&a.stateNode!=null&&(h=a.memoizedProps,$y(a,h,o!==null?o.memoizedProps:h)),d&1024&&(Yh=!0);break;case 6:if(fa(r,a),ma(a),d&4){if(a.stateNode===null)throw Error(i(162));d=a.memoizedProps,o=a.stateNode;try{o.nodeValue=d}catch(Fe){pt(a,a.return,Fe)}}break;case 3:if(ud=null,h=Da,Da=cd(r.containerInfo),fa(r,a),Da=h,ma(a),d&4&&o!==null&&o.memoizedState.isDehydrated)try{Eo(r.containerInfo)}catch(Fe){pt(a,a.return,Fe)}Yh&&(Yh=!1,qy(a));break;case 4:d=Da,Da=cd(a.stateNode.containerInfo),fa(r,a),ma(a),Da=d;break;case 12:fa(r,a),ma(a);break;case 13:fa(r,a),ma(a),a.child.flags&8192&&a.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(tf=ve()),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vh(a,d)));break;case 22:if(d&512&&(Mt||o===null||Ys(o,o.return)),J=a.memoizedState!==null,le=o!==null&&o.memoizedState!==null,we=fn,Ce=Mt,fn=we||J,Mt=Ce||le,fa(r,a),Mt=Ce,fn=we,ma(a),r=a.stateNode,r._current=a,r._visibility&=-3,r._visibility|=r._pendingVisibility&2,d&8192&&(r._visibility=J?r._visibility&-2:r._visibility|1,J&&(r=fn||Mt,o===null||le||r||Pi(a)),a.memoizedProps===null||a.memoizedProps.mode!=="manual"))e:for(o=null,r=a;;){if(r.tag===5||r.tag===26||r.tag===27){if(o===null){le=o=r;try{if(h=le.stateNode,J)y=h.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{$=le.stateNode,U=le.memoizedProps.style;var Se=U!=null&&U.hasOwnProperty("display")?U.display:null;$.style.display=Se==null||typeof Se=="boolean"?"":(""+Se).trim()}}catch(Fe){pt(le,le.return,Fe)}}}else if(r.tag===6){if(o===null){le=r;try{le.stateNode.nodeValue=J?"":le.memoizedProps}catch(Fe){pt(le,le.return,Fe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;o===r&&(o=null),r=r.return}o===r&&(o=null),r.sibling.return=r.return,r=r.sibling}d&4&&(d=a.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,Vh(a,o))));break;case 19:fa(r,a),ma(a),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vh(a,d)));break;case 21:break;default:fa(r,a),ma(a)}}function ma(a){var r=a.flags;if(r&2){try{if(a.tag!==27){e:{for(var o=a.return;o!==null;){if(Ry(o)){var d=o;break e}o=o.return}throw Error(i(160))}switch(d.tag){case 27:var h=d.stateNode,y=qh(a);Qc(a,y,h);break;case 5:var $=d.stateNode;d.flags&32&&(Ti($,""),d.flags&=-33);var U=qh(a);Qc(a,U,$);break;case 3:case 4:var J=d.stateNode.containerInfo,le=qh(a);Hh(a,le,J);break;default:throw Error(i(161))}}}catch(we){pt(a,a.return,we)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function qy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;qy(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function pn(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Ly(a,r.alternate,r),r=r.sibling}function Pi(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:Qn(4,r,r.return),Pi(r);break;case 1:Ys(r,r.return);var o=r.stateNode;typeof o.componentWillUnmount=="function"&&Oy(r,r.return,o),Pi(r);break;case 26:case 27:case 5:Ys(r,r.return),Pi(r);break;case 22:Ys(r,r.return),r.memoizedState===null&&Pi(r);break;default:Pi(r)}a=a.sibling}}function Xn(a,r,o){for(o=o&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var d=r.alternate,h=a,y=r,$=y.flags;switch(y.tag){case 0:case 11:case 15:Xn(h,y,o),lo(4,y);break;case 1:if(Xn(h,y,o),d=y,h=d.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(le){pt(d,d.return,le)}if(d=y,h=d.updateQueue,h!==null){var U=d.stateNode;try{var J=h.shared.hiddenCallbacks;if(J!==null)for(h.shared.hiddenCallbacks=null,h=0;h<J.length;h++)Dy(J[h],U)}catch(le){pt(d,d.return,le)}}o&&$&64&&_y(y),Hr(y,y.return);break;case 26:case 27:case 5:Xn(h,y,o),o&&d===null&&$&4&&Iy(y),Hr(y,y.return);break;case 12:Xn(h,y,o);break;case 13:Xn(h,y,o),o&&$&4&&Uy(h,y);break;case 22:y.memoizedState===null&&Xn(h,y,o),Hr(y,y.return);break;default:Xn(h,y,o)}r=r.sibling}}function Gh(a,r){var o=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==o&&(a!=null&&a.refCount++,o!=null&&Wl(o))}function Qh(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&Wl(a))}function Zn(a,r,o,d){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Hy(a,r,o,d),r=r.sibling}function Hy(a,r,o,d){var h=r.flags;switch(r.tag){case 0:case 11:case 15:Zn(a,r,o,d),h&2048&&lo(9,r);break;case 3:Zn(a,r,o,d),h&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&Wl(a)));break;case 12:if(h&2048){Zn(a,r,o,d),a=r.stateNode;try{var y=r.memoizedProps,$=y.id,U=y.onPostCommit;typeof U=="function"&&U($,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(J){pt(r,r.return,J)}}else Zn(a,r,o,d);break;case 23:break;case 22:y=r.stateNode,r.memoizedState!==null?y._visibility&4?Zn(a,r,o,d):oo(a,r):y._visibility&4?Zn(a,r,o,d):(y._visibility|=4,qi(a,r,o,d,(r.subtreeFlags&10256)!==0)),h&2048&&Gh(r.alternate,r);break;case 24:Zn(a,r,o,d),h&2048&&Qh(r.alternate,r);break;default:Zn(a,r,o,d)}}function qi(a,r,o,d,h){for(h=h&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var y=a,$=r,U=o,J=d,le=$.flags;switch($.tag){case 0:case 11:case 15:qi(y,$,U,J,h),lo(8,$);break;case 23:break;case 22:var we=$.stateNode;$.memoizedState!==null?we._visibility&4?qi(y,$,U,J,h):oo(y,$):(we._visibility|=4,qi(y,$,U,J,h)),h&&le&2048&&Gh($.alternate,$);break;case 24:qi(y,$,U,J,h),h&&le&2048&&Qh($.alternate,$);break;default:qi(y,$,U,J,h)}r=r.sibling}}function oo(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var o=a,d=r,h=d.flags;switch(d.tag){case 22:oo(o,d),h&2048&&Gh(d.alternate,d);break;case 24:oo(o,d),h&2048&&Qh(d.alternate,d);break;default:oo(o,d)}r=r.sibling}}var co=8192;function Hi(a){if(a.subtreeFlags&co)for(a=a.child;a!==null;)Yy(a),a=a.sibling}function Yy(a){switch(a.tag){case 26:Hi(a),a.flags&co&&a.memoizedState!==null&&u1(Da,a.memoizedState,a.memoizedProps);break;case 5:Hi(a);break;case 3:case 4:var r=Da;Da=cd(a.stateNode.containerInfo),Hi(a),Da=r;break;case 22:a.memoizedState===null&&(r=a.alternate,r!==null&&r.memoizedState!==null?(r=co,co=16777216,Hi(a),co=r):Hi(a));break;default:Hi(a)}}function Vy(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function uo(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];ns=d,Qy(d,a)}Vy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Gy(a),a=a.sibling}function Gy(a){switch(a.tag){case 0:case 11:case 15:uo(a),a.flags&2048&&Qn(9,a,a.return);break;case 3:uo(a);break;case 12:uo(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&4&&(a.return===null||a.return.tag!==13)?(r._visibility&=-5,Xc(a)):uo(a);break;default:uo(a)}}function Xc(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];ns=d,Qy(d,a)}Vy(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:Qn(8,r,r.return),Xc(r);break;case 22:o=r.stateNode,o._visibility&4&&(o._visibility&=-5,Xc(r));break;default:Xc(r)}a=a.sibling}}function Qy(a,r){for(;ns!==null;){var o=ns;switch(o.tag){case 0:case 11:case 15:Qn(8,o,r);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Wl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,ns=d;else e:for(o=a;ns!==null;){d=ns;var h=d.sibling,y=d.return;if(By(d),d===o){ns=null;break e}if(h!==null){h.return=y,ns=h;break e}ns=y}}}function wS(a,r,o,d){this.tag=a,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pa(a,r,o,d){return new wS(a,r,o,d)}function Xh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Wn(a,r){var o=a.alternate;return o===null?(o=pa(a.tag,r,a.key,a.mode),o.elementType=a.elementType,o.type=a.type,o.stateNode=a.stateNode,o.alternate=a,a.alternate=o):(o.pendingProps=r,o.type=a.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=a.flags&31457280,o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,r=a.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=a.sibling,o.index=a.index,o.ref=a.ref,o.refCleanup=a.refCleanup,o}function Xy(a,r){a.flags&=31457282;var o=a.alternate;return o===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,r=o.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function Zc(a,r,o,d,h,y){var $=0;if(d=a,typeof a=="function")Xh(a)&&($=1);else if(typeof a=="string")$=c1(a,o,ce.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case p:return Yr(o.children,h,y,r);case m:$=8,h|=24;break;case g:return a=pa(12,o,r,h|2),a.elementType=g,a.lanes=y,a;case w:return a=pa(13,o,r,h),a.elementType=w,a.lanes=y,a;case C:return a=pa(19,o,r,h),a.elementType=C,a.lanes=y,a;case _:return Zy(o,h,y,r);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case v:case N:$=10;break e;case j:$=9;break e;case b:$=11;break e;case T:$=14;break e;case A:$=16,d=null;break e}$=29,o=Error(i(130,a===null?"null":typeof a,"")),d=null}return r=pa($,o,r,h),r.elementType=a,r.type=d,r.lanes=y,r}function Yr(a,r,o,d){return a=pa(7,a,d,r),a.lanes=o,a}function Zy(a,r,o,d){a=pa(22,a,d,r),a.elementType=_,a.lanes=o;var h={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var y=h._current;if(y===null)throw Error(i(456));if((h._pendingVisibility&2)===0){var $=Bn(y,2);$!==null&&(h._pendingVisibility|=2,Cs($,y,2))}},attach:function(){var y=h._current;if(y===null)throw Error(i(456));if((h._pendingVisibility&2)!==0){var $=Bn(y,2);$!==null&&(h._pendingVisibility&=-3,Cs($,y,2))}}};return a.stateNode=h,a}function Zh(a,r,o){return a=pa(6,a,null,r),a.lanes=o,a}function Wh(a,r,o){return r=pa(4,a.children!==null?a.children:[],a.key,r),r.lanes=o,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}function gn(a){a.flags|=4}function Wy(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Rv(r)){if(r=ha.current,r!==null&&((nt&4194176)===nt?Ha!==null:(nt&62914560)!==nt&&(nt&536870912)===0||r!==Ha))throw Ql=sh,mg;a.flags|=8192}}function Wc(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?fc():536870912,a.lanes|=r,Vi|=r)}function ho(a,r){if(!rt)switch(a.tailMode){case"hidden":r=a.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?a.tail=null:o.sibling=null;break;case"collapsed":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:d.sibling=null}}function Dt(a){var r=a.alternate!==null&&a.alternate.child===a.child,o=0,d=0;if(r)for(var h=a.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags&31457280,d|=h.flags&31457280,h.return=a,h=h.sibling;else for(h=a.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags,d|=h.flags,h.return=a,h=h.sibling;return a.subtreeFlags|=d,a.childLanes=o,r}function TS(a,r,o){var d=r.pendingProps;switch(eh(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(r),null;case 1:return Dt(r),null;case 3:return o=r.stateNode,d=null,a!==null&&(d=a.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),hn(Kt),je(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(a===null||a.child===null)&&(Hl(r)?gn(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Aa!==null&&(rf(Aa),Aa=null))),Dt(r),null;case 26:return o=r.memoizedState,a===null?(gn(r),o!==null?(Dt(r),Wy(r,o)):(Dt(r),r.flags&=-16777217)):o?o!==a.memoizedState?(gn(r),Dt(r),Wy(r,o)):(Dt(r),r.flags&=-16777217):(a.memoizedProps!==d&&gn(r),Dt(r),r.flags&=-16777217),null;case 27:De(r),o=re.current;var h=r.type;if(a!==null&&r.stateNode!=null)a.memoizedProps!==d&&gn(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return Dt(r),null}a=ce.current,Hl(r)?hg(r):(a=Cv(h,d,o),r.stateNode=a,gn(r))}return Dt(r),null;case 5:if(De(r),o=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==d&&gn(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return Dt(r),null}if(a=ce.current,Hl(r))hg(r);else{switch(h=od(re.current),a){case 1:a=h.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:a=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":a=h.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":a=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":a=h.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof d.is=="string"?h.createElement("select",{is:d.is}):h.createElement("select"),d.multiple?a.multiple=!0:d.size&&(a.size=d.size);break;default:a=typeof d.is=="string"?h.createElement(o,{is:d.is}):h.createElement(o)}}a[xs]=r,a[ks]=d;e:for(h=r.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}r.stateNode=a;e:switch(us(a,o,d),o){case"button":case"input":case"select":case"textarea":a=!!d.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&gn(r)}}return Dt(r),r.flags&=-16777217,null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==d&&gn(r);else{if(typeof d!="string"&&r.stateNode===null)throw Error(i(166));if(a=re.current,Hl(r)){if(a=r.stateNode,o=r.memoizedProps,d=null,h=Es,h!==null)switch(h.tag){case 27:case 5:d=h.memoizedProps}a[xs]=r,a=!!(a.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||bv(a.nodeValue,o)),a||Rr(r)}else a=od(a).createTextNode(d),a[xs]=r,r.stateNode=a}return Dt(r),null;case 13:if(d=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(h=Hl(r),d!==null&&d.dehydrated!==null){if(a===null){if(!h)throw Error(i(318));if(h=r.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));h[xs]=r}else Yl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Dt(r),h=!1}else Aa!==null&&(rf(Aa),Aa=null),h=!0;if(!h)return r.flags&256?(on(r),r):(on(r),null)}if(on(r),(r.flags&128)!==0)return r.lanes=o,r;if(o=d!==null,a=a!==null&&a.memoizedState!==null,o){d=r.child,h=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(h=d.alternate.memoizedState.cachePool.pool);var y=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==h&&(d.flags|=2048)}return o!==a&&o&&(r.child.flags|=8192),Wc(r,r.updateQueue),Dt(r),null;case 4:return je(),a===null&&yf(r.stateNode.containerInfo),Dt(r),null;case 10:return hn(r.type),Dt(r),null;case 19:if(ae(Wt),h=r.memoizedState,h===null)return Dt(r),null;if(d=(r.flags&128)!==0,y=h.rendering,y===null)if(d)ho(h,!1);else{if(zt!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(y=$c(a),y!==null){for(r.flags|=128,ho(h,!1),a=y.updateQueue,r.updateQueue=a,Wc(r,a),r.subtreeFlags=0,a=o,o=r.child;o!==null;)Xy(o,a),o=o.sibling;return oe(Wt,Wt.current&1|2),r.child}a=a.sibling}h.tail!==null&&ve()>Kc&&(r.flags|=128,d=!0,ho(h,!1),r.lanes=4194304)}else{if(!d)if(a=$c(y),a!==null){if(r.flags|=128,d=!0,a=a.updateQueue,r.updateQueue=a,Wc(r,a),ho(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!rt)return Dt(r),null}else 2*ve()-h.renderingStartTime>Kc&&o!==536870912&&(r.flags|=128,d=!0,ho(h,!1),r.lanes=4194304);h.isBackwards?(y.sibling=r.child,r.child=y):(a=h.last,a!==null?a.sibling=y:r.child=y,h.last=y)}return h.tail!==null?(r=h.tail,h.rendering=r,h.tail=r.sibling,h.renderingStartTime=ve(),r.sibling=null,a=Wt.current,oe(Wt,d?a&1|2:a&1),r):(Dt(r),null);case 22:case 23:return on(r),nh(),d=r.memoizedState!==null,a!==null?a.memoizedState!==null!==d&&(r.flags|=8192):d&&(r.flags|=8192),d?(o&536870912)!==0&&(r.flags&128)===0&&(Dt(r),r.subtreeFlags&6&&(r.flags|=8192)):Dt(r),o=r.updateQueue,o!==null&&Wc(r,o.retryQueue),o=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==o&&(r.flags|=2048),a!==null&&ae(zr),null;case 24:return o=null,a!==null&&(o=a.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),hn(Kt),Dt(r),null;case 25:return null}throw Error(i(156,r.tag))}function ES(a,r){switch(eh(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return hn(Kt),je(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return De(r),null;case 13:if(on(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Yl()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return ae(Wt),null;case 4:return je(),null;case 10:return hn(r.type),null;case 22:case 23:return on(r),nh(),a!==null&&ae(zr),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return hn(Kt),null;case 25:return null;default:return null}}function Ky(a,r){switch(eh(r),r.tag){case 3:hn(Kt),je();break;case 26:case 27:case 5:De(r);break;case 4:je();break;case 13:on(r);break;case 19:ae(Wt);break;case 10:hn(r.type);break;case 22:case 23:on(r),nh(),a!==null&&ae(zr);break;case 24:hn(Kt)}}var CS={getCacheForType:function(a){var r=js(Kt),o=r.data.get(a);return o===void 0&&(o=a(),r.data.set(a,o)),o}},AS=typeof WeakMap=="function"?WeakMap:Map,kt=0,jt=null,et=null,nt=0,bt=0,Gs=null,yn=!1,Yi=!1,Kh=!1,vn=0,zt=0,Kn=0,Vr=0,Jh=0,ga=0,Vi=0,fo=null,Va=null,ef=!1,tf=0,Kc=1/0,Jc=null,Jn=null,ed=!1,Gr=null,mo=0,sf=0,af=null,po=0,nf=null;function Qs(){if((kt&2)!==0&&nt!==0)return nt&-nt;if(I.T!==null){var a=zi;return a!==0?a:ff()}return xp()}function Jy(){ga===0&&(ga=(nt&536870912)===0||rt?hc():536870912);var a=ha.current;return a!==null&&(a.flags|=32),ga}function Cs(a,r,o){(a===jt&&bt===2||a.cancelPendingCommit!==null)&&(Gi(a,0),xn(a,nt,ga,!1)),Ol(a,o),((kt&2)===0||a!==jt)&&(a===jt&&((kt&2)===0&&(Vr|=o),zt===4&&xn(a,nt,ga,!1)),Ga(a))}function ev(a,r,o){if((kt&6)!==0)throw Error(i(327));var d=!o&&(r&60)===0&&(r&a.expiredLanes)===0||Cr(a,r),h=d?_S(a,r):cf(a,r,!0),y=d;do{if(h===0){Yi&&!d&&xn(a,r,0,!1);break}else if(h===6)xn(a,r,0,!yn);else{if(o=a.current.alternate,y&&!DS(o)){h=cf(a,r,!1),y=!1;continue}if(h===2){if(y=r,a.errorRecoveryDisabledLanes&y)var $=0;else $=a.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){r=$;e:{var U=a;h=fo;var J=U.current.memoizedState.isDehydrated;if(J&&(Gi(U,$).flags|=256),$=cf(U,$,!1),$!==2){if(Kh&&!J){U.errorRecoveryDisabledLanes|=y,Vr|=y,h=4;break e}y=Va,Va=h,y!==null&&rf(y)}h=$}if(y=!1,h!==2)continue}}if(h===1){Gi(a,0),xn(a,r,0,!0);break}e:{switch(d=a,h){case 0:case 1:throw Error(i(345));case 4:if((r&4194176)===r){xn(d,r,ga,!yn);break e}break;case 2:Va=null;break;case 3:case 5:break;default:throw Error(i(329))}if(d.finishedWork=o,d.finishedLanes=r,(r&62914560)===r&&(y=tf+300-ve(),10<y)){if(xn(d,r,ga,!yn),sn(d,0)!==0)break e;d.timeoutHandle=wv(tv.bind(null,d,o,Va,Jc,ef,r,ga,Vr,Vi,yn,2,-0,0),y);break e}tv(d,o,Va,Jc,ef,r,ga,Vr,Vi,yn,0,-0,0)}}break}while(!0);Ga(a)}function rf(a){Va===null?Va=a:Va.push.apply(Va,a)}function tv(a,r,o,d,h,y,$,U,J,le,we,Ce,fe){var Se=r.subtreeFlags;if((Se&8192||(Se&16785408)===16785408)&&(bo={stylesheets:null,count:0,unsuspend:d1},Yy(r),r=h1(),r!==null)){a.cancelPendingCommit=r(ov.bind(null,a,o,d,h,$,U,J,1,Ce,fe)),xn(a,y,$,!le);return}ov(a,o,d,h,$,U,J,we,Ce,fe)}function DS(a){for(var r=a;;){var o=r.tag;if((o===0||o===11||o===15)&&r.flags&16384&&(o=r.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var h=o[d],y=h.getSnapshot;h=h.value;try{if(!Hs(y(),h))return!1}catch{return!1}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function xn(a,r,o,d){r&=~Jh,r&=~Vr,a.suspendedLanes|=r,a.pingedLanes&=~r,d&&(a.warmLanes|=r),d=a.expirationTimes;for(var h=r;0<h;){var y=31-ke(h),$=1<<y;d[y]=-1,h&=~$}o!==0&&gp(a,o,r)}function td(){return(kt&6)===0?(go(0),!1):!0}function lf(){if(et!==null){if(bt===0)var a=et.return;else a=et,un=Pr=null,hh(a),Ri=null,Xl=0,a=et;for(;a!==null;)Ky(a.alternate,a),a=a.return;et=null}}function Gi(a,r){a.finishedWork=null,a.finishedLanes=0;var o=a.timeoutHandle;o!==-1&&(a.timeoutHandle=-1,QS(o)),o=a.cancelPendingCommit,o!==null&&(a.cancelPendingCommit=null,o()),lf(),jt=a,et=o=Wn(a.current,null),nt=r,bt=0,Gs=null,yn=!1,Yi=Cr(a,r),Kh=!1,Vi=ga=Jh=Vr=Kn=zt=0,Va=fo=null,ef=!1,(r&8)!==0&&(r|=r&32);var d=a.entangledLanes;if(d!==0)for(a=a.entanglements,d&=r;0<d;){var h=31-ke(d),y=1<<h;r|=a[h],d&=~y}return vn=r,Tc(),o}function sv(a,r){Ze=null,I.H=Ya,r===Gl?(r=yg(),bt=3):r===mg?(r=yg(),bt=4):bt=r===py?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Gs=r,et===null&&(zt=1,Yc(a,ca(r,a.current)))}function av(){var a=I.H;return I.H=Ya,a===null?Ya:a}function nv(){var a=I.A;return I.A=CS,a}function of(){zt=4,yn||(nt&4194176)!==nt&&ha.current!==null||(Yi=!0),(Kn&134217727)===0&&(Vr&134217727)===0||jt===null||xn(jt,nt,ga,!1)}function cf(a,r,o){var d=kt;kt|=2;var h=av(),y=nv();(jt!==a||nt!==r)&&(Jc=null,Gi(a,r)),r=!1;var $=zt;e:do try{if(bt!==0&&et!==null){var U=et,J=Gs;switch(bt){case 8:lf(),$=6;break e;case 3:case 2:case 6:ha.current===null&&(r=!0);var le=bt;if(bt=0,Gs=null,Qi(a,U,J,le),o&&Yi){$=0;break e}break;default:le=bt,bt=0,Gs=null,Qi(a,U,J,le)}}kS(),$=zt;break}catch(we){sv(a,we)}while(!0);return r&&a.shellSuspendCounter++,un=Pr=null,kt=d,I.H=h,I.A=y,et===null&&(jt=null,nt=0,Tc()),$}function kS(){for(;et!==null;)rv(et)}function _S(a,r){var o=kt;kt|=2;var d=av(),h=nv();jt!==a||nt!==r?(Jc=null,Kc=ve()+500,Gi(a,r)):Yi=Cr(a,r);e:do try{if(bt!==0&&et!==null){r=et;var y=Gs;t:switch(bt){case 1:bt=0,Gs=null,Qi(a,r,y,1);break;case 2:if(pg(y)){bt=0,Gs=null,iv(r);break}r=function(){bt===2&&jt===a&&(bt=7),Ga(a)},y.then(r,r);break e;case 3:bt=7;break e;case 4:bt=5;break e;case 7:pg(y)?(bt=0,Gs=null,iv(r)):(bt=0,Gs=null,Qi(a,r,y,7));break;case 5:var $=null;switch(et.tag){case 26:$=et.memoizedState;case 5:case 27:var U=et;if(!$||Rv($)){bt=0,Gs=null;var J=U.sibling;if(J!==null)et=J;else{var le=U.return;le!==null?(et=le,sd(le)):et=null}break t}}bt=0,Gs=null,Qi(a,r,y,5);break;case 6:bt=0,Gs=null,Qi(a,r,y,6);break;case 8:lf(),zt=6;break e;default:throw Error(i(462))}}OS();break}catch(we){sv(a,we)}while(!0);return un=Pr=null,I.H=d,I.A=h,kt=o,et!==null?0:(jt=null,nt=0,Tc(),zt)}function OS(){for(;et!==null&&!V();)rv(et)}function rv(a){var r=Cy(a.alternate,a,vn);a.memoizedProps=a.pendingProps,r===null?sd(a):et=r}function iv(a){var r=a,o=r.alternate;switch(r.tag){case 15:case 0:r=by(o,r,r.pendingProps,r.type,void 0,nt);break;case 11:r=by(o,r,r.pendingProps,r.type.render,r.ref,nt);break;case 5:hh(r);default:Ky(o,r),r=et=Xy(r,vn),r=Cy(o,r,vn)}a.memoizedProps=a.pendingProps,r===null?sd(a):et=r}function Qi(a,r,o,d){un=Pr=null,hh(r),Ri=null,Xl=0;var h=r.return;try{if(jS(a,h,r,o,nt)){zt=1,Yc(a,ca(o,a.current)),et=null;return}}catch(y){if(h!==null)throw et=h,y;zt=1,Yc(a,ca(o,a.current)),et=null;return}r.flags&32768?(rt||d===1?a=!0:Yi||(nt&536870912)!==0?a=!1:(yn=a=!0,(d===2||d===3||d===6)&&(d=ha.current,d!==null&&d.tag===13&&(d.flags|=16384))),lv(r,a)):sd(r)}function sd(a){var r=a;do{if((r.flags&32768)!==0){lv(r,yn);return}a=r.return;var o=TS(r.alternate,r,vn);if(o!==null){et=o;return}if(r=r.sibling,r!==null){et=r;return}et=r=a}while(r!==null);zt===0&&(zt=5)}function lv(a,r){do{var o=ES(a.alternate,a);if(o!==null){o.flags&=32767,et=o;return}if(o=a.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!r&&(a=a.sibling,a!==null)){et=a;return}et=a=o}while(a!==null);zt=6,et=null}function ov(a,r,o,d,h,y,$,U,J,le){var we=I.T,Ce=H.p;try{H.p=2,I.T=null,IS(a,r,o,d,Ce,h,y,$,U,J,le)}finally{I.T=we,H.p=Ce}}function IS(a,r,o,d,h,y,$,U){do Xi();while(Gr!==null);if((kt&6)!==0)throw Error(i(327));var J=a.finishedWork;if(d=a.finishedLanes,J===null)return null;if(a.finishedWork=null,a.finishedLanes=0,J===a.current)throw Error(i(177));a.callbackNode=null,a.callbackPriority=0,a.cancelPendingCommit=null;var le=J.lanes|J.childLanes;if(le|=Wu,uN(a,d,le,y,$,U),a===jt&&(et=jt=null,nt=0),(J.subtreeFlags&10256)===0&&(J.flags&10256)===0||ed||(ed=!0,sf=le,af=o,zS(Ue,function(){return Xi(),null})),o=(J.flags&15990)!==0,(J.subtreeFlags&15990)!==0||o?(o=I.T,I.T=null,y=H.p,H.p=2,$=kt,kt|=4,NS(a,J),Py(J,a),aS(bf,a.containerInfo),md=!!jf,bf=jf=null,a.current=J,Ly(a,J.alternate,J),ue(),kt=$,H.p=y,I.T=o):a.current=J,ed?(ed=!1,Gr=a,mo=d):cv(a,le),le=a.pendingLanes,le===0&&(Jn=null),xi(J.stateNode),Ga(a),r!==null)for(h=a.onRecoverableError,J=0;J<r.length;J++)le=r[J],h(le.value,{componentStack:le.stack});return(mo&3)!==0&&Xi(),le=a.pendingLanes,(d&4194218)!==0&&(le&42)!==0?a===nf?po++:(po=0,nf=a):po=0,go(0),null}function cv(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,Wl(r)))}function Xi(){if(Gr!==null){var a=Gr,r=sf;sf=0;var o=vp(mo),d=I.T,h=H.p;try{if(H.p=32>o?32:o,I.T=null,Gr===null)var y=!1;else{o=af,af=null;var $=Gr,U=mo;if(Gr=null,mo=0,(kt&6)!==0)throw Error(i(331));var J=kt;if(kt|=4,Gy($.current),Hy($,$.current,U,o),kt=J,go(0,!1),xt&&typeof xt.onPostCommitFiberRoot=="function")try{xt.onPostCommitFiberRoot(Pt,$)}catch{}y=!0}return y}finally{H.p=h,I.T=d,cv(a,r)}}return!1}function dv(a,r,o){r=ca(o,r),r=Eh(a.stateNode,r,2),a=Gn(a,r,2),a!==null&&(Ol(a,2),Ga(a))}function pt(a,r,o){if(a.tag===3)dv(a,a,o);else for(;r!==null;){if(r.tag===3){dv(r,a,o);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Jn===null||!Jn.has(d))){a=ca(o,a),o=fy(2),d=Gn(r,o,2),d!==null&&(my(o,d,r,a),Ol(d,2),Ga(d));break}}r=r.return}}function df(a,r,o){var d=a.pingCache;if(d===null){d=a.pingCache=new AS;var h=new Set;d.set(r,h)}else h=d.get(r),h===void 0&&(h=new Set,d.set(r,h));h.has(o)||(Kh=!0,h.add(o),a=$S.bind(null,a,r,o),r.then(a,a))}function $S(a,r,o){var d=a.pingCache;d!==null&&d.delete(r),a.pingedLanes|=a.suspendedLanes&o,a.warmLanes&=~o,jt===a&&(nt&o)===o&&(zt===4||zt===3&&(nt&62914560)===nt&&300>ve()-tf?(kt&2)===0&&Gi(a,0):Jh|=o,Vi===nt&&(Vi=0)),Ga(a)}function uv(a,r){r===0&&(r=fc()),a=Bn(a,r),a!==null&&(Ol(a,r),Ga(a))}function RS(a){var r=a.memoizedState,o=0;r!==null&&(o=r.retryLane),uv(a,o)}function MS(a,r){var o=0;switch(a.tag){case 13:var d=a.stateNode,h=a.memoizedState;h!==null&&(o=h.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(r),uv(a,o)}function zS(a,r){return Te(a,r)}var ad=null,Zi=null,uf=!1,nd=!1,hf=!1,Qr=0;function Ga(a){a!==Zi&&a.next===null&&(Zi===null?ad=Zi=a:Zi=Zi.next=a),nd=!0,uf||(uf=!0,BS(LS))}function go(a,r){if(!hf&&nd){hf=!0;do for(var o=!1,d=ad;d!==null;){if(a!==0){var h=d.pendingLanes;if(h===0)var y=0;else{var $=d.suspendedLanes,U=d.pingedLanes;y=(1<<31-ke(42|a)+1)-1,y&=h&~($&~U),y=y&201326677?y&201326677|1:y?y|2:0}y!==0&&(o=!0,mv(d,y))}else y=nt,y=sn(d,d===jt?y:0),(y&3)===0||Cr(d,y)||(o=!0,mv(d,y));d=d.next}while(o);hf=!1}}function LS(){nd=uf=!1;var a=0;Qr!==0&&(GS()&&(a=Qr),Qr=0);for(var r=ve(),o=null,d=ad;d!==null;){var h=d.next,y=hv(d,r);y===0?(d.next=null,o===null?ad=h:o.next=h,h===null&&(Zi=o)):(o=d,(a!==0||(y&3)!==0)&&(nd=!0)),d=h}go(a)}function hv(a,r){for(var o=a.suspendedLanes,d=a.pingedLanes,h=a.expirationTimes,y=a.pendingLanes&-62914561;0<y;){var $=31-ke(y),U=1<<$,J=h[$];J===-1?((U&o)===0||(U&d)!==0)&&(h[$]=uc(U,r)):J<=r&&(a.expiredLanes|=U),y&=~U}if(r=jt,o=nt,o=sn(a,a===r?o:0),d=a.callbackNode,o===0||a===r&&bt===2||a.cancelPendingCommit!==null)return d!==null&&d!==null&&Be(d),a.callbackNode=null,a.callbackPriority=0;if((o&3)===0||Cr(a,o)){if(r=o&-o,r===a.callbackPriority)return r;switch(d!==null&&Be(d),vp(o)){case 2:case 8:o=Ie;break;case 32:o=Ue;break;case 268435456:o=qe;break;default:o=Ue}return d=fv.bind(null,a),o=Te(o,d),a.callbackPriority=r,a.callbackNode=o,r}return d!==null&&d!==null&&Be(d),a.callbackPriority=2,a.callbackNode=null,2}function fv(a,r){var o=a.callbackNode;if(Xi()&&a.callbackNode!==o)return null;var d=nt;return d=sn(a,a===jt?d:0),d===0?null:(ev(a,d,r),hv(a,ve()),a.callbackNode!=null&&a.callbackNode===o?fv.bind(null,a):null)}function mv(a,r){if(Xi())return null;ev(a,r,!0)}function BS(a){XS(function(){(kt&6)!==0?Te(_e,a):a()})}function ff(){return Qr===0&&(Qr=hc()),Qr}function pv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:vc(""+a)}function gv(a,r){var o=r.ownerDocument.createElement("input");return o.name=r.name,o.value=r.value,a.id&&o.setAttribute("form",a.id),r.parentNode.insertBefore(o,r),a=new FormData(a),o.parentNode.removeChild(o),a}function FS(a,r,o,d,h){if(r==="submit"&&o&&o.stateNode===h){var y=pv((h[ks]||null).action),$=d.submitter;$&&(r=(r=$[ks]||null)?pv(r.formAction):$.getAttribute("formAction"),r!==null&&(y=r,$=null));var U=new Nc("action","action",null,d,h);a.push({event:U,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Qr!==0){var J=$?gv(h,$):new FormData(h);bh(o,{pending:!0,data:J,method:h.method,action:y},null,J)}}else typeof y=="function"&&(U.preventDefault(),J=$?gv(h,$):new FormData(h),bh(o,{pending:!0,data:J,method:h.method,action:y},y,J))},currentTarget:h}]})}}for(var mf=0;mf<og.length;mf++){var pf=og[mf],US=pf.toLowerCase(),PS=pf[0].toUpperCase()+pf.slice(1);Ca(US,"on"+PS)}Ca(ag,"onAnimationEnd"),Ca(ng,"onAnimationIteration"),Ca(rg,"onAnimationStart"),Ca("dblclick","onDoubleClick"),Ca("focusin","onFocus"),Ca("focusout","onBlur"),Ca(rS,"onTransitionRun"),Ca(iS,"onTransitionStart"),Ca(lS,"onTransitionCancel"),Ca(ig,"onTransitionEnd"),Si("onMouseEnter",["mouseout","mouseover"]),Si("onMouseLeave",["mouseout","mouseover"]),Si("onPointerEnter",["pointerout","pointerover"]),Si("onPointerLeave",["pointerout","pointerover"]),Dr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Dr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Dr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Dr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Dr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Dr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yo));function yv(a,r){r=(r&4)!==0;for(var o=0;o<a.length;o++){var d=a[o],h=d.event;d=d.listeners;e:{var y=void 0;if(r)for(var $=d.length-1;0<=$;$--){var U=d[$],J=U.instance,le=U.currentTarget;if(U=U.listener,J!==y&&h.isPropagationStopped())break e;y=U,h.currentTarget=le;try{y(h)}catch(we){Hc(we)}h.currentTarget=null,y=J}else for($=0;$<d.length;$++){if(U=d[$],J=U.instance,le=U.currentTarget,U=U.listener,J!==y&&h.isPropagationStopped())break e;y=U,h.currentTarget=le;try{y(h)}catch(we){Hc(we)}h.currentTarget=null,y=J}}}}function st(a,r){var o=r[ku];o===void 0&&(o=r[ku]=new Set);var d=a+"__bubble";o.has(d)||(vv(r,a,2,!1),o.add(d))}function gf(a,r,o){var d=0;r&&(d|=4),vv(o,a,d,r)}var rd="_reactListening"+Math.random().toString(36).slice(2);function yf(a){if(!a[rd]){a[rd]=!0,bp.forEach(function(o){o!=="selectionchange"&&(qS.has(o)||gf(o,!1,a),gf(o,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[rd]||(r[rd]=!0,gf("selectionchange",!1,r))}}function vv(a,r,o,d){switch(Uv(r)){case 2:var h=p1;break;case 8:h=g1;break;default:h=kf}o=h.bind(null,r,o,a),h=void 0,!Lu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(h=!0),d?h!==void 0?a.addEventListener(r,o,{capture:!0,passive:h}):a.addEventListener(r,o,!0):h!==void 0?a.addEventListener(r,o,{passive:h}):a.addEventListener(r,o,!1)}function vf(a,r,o,d,h){var y=d;if((r&1)===0&&(r&2)===0&&d!==null)e:for(;;){if(d===null)return;var $=d.tag;if($===3||$===4){var U=d.stateNode.containerInfo;if(U===h||U.nodeType===8&&U.parentNode===h)break;if($===4)for($=d.return;$!==null;){var J=$.tag;if((J===3||J===4)&&(J=$.stateNode.containerInfo,J===h||J.nodeType===8&&J.parentNode===h))return;$=$.return}for(;U!==null;){if($=Ar(U),$===null)return;if(J=$.tag,J===5||J===6||J===26||J===27){d=y=$;continue e}U=U.parentNode}}d=d.return}Ip(function(){var le=y,we=Mu(o),Ce=[];e:{var fe=lg.get(a);if(fe!==void 0){var Se=Nc,Fe=a;switch(a){case"keypress":if(jc(o)===0)break e;case"keydown":case"keyup":Se=MN;break;case"focusin":Fe="focus",Se=Pu;break;case"focusout":Fe="blur",Se=Pu;break;case"beforeblur":case"afterblur":Se=Pu;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=Mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=wN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=BN;break;case ag:case ng:case rg:Se=CN;break;case ig:Se=UN;break;case"scroll":case"scrollend":Se=NN;break;case"wheel":Se=qN;break;case"copy":case"cut":case"paste":Se=DN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=Lp;break;case"toggle":case"beforetoggle":Se=YN}var Ge=(r&4)!==0,Lt=!Ge&&(a==="scroll"||a==="scrollend"),de=Ge?fe!==null?fe+"Capture":null:fe;Ge=[];for(var ie=le,he;ie!==null;){var Ee=ie;if(he=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||he===null||de===null||(Ee=Rl(ie,de),Ee!=null&&Ge.push(vo(ie,Ee,he))),Lt)break;ie=ie.return}0<Ge.length&&(fe=new Se(fe,Fe,null,o,we),Ce.push({event:fe,listeners:Ge}))}}if((r&7)===0){e:{if(fe=a==="mouseover"||a==="pointerover",Se=a==="mouseout"||a==="pointerout",fe&&o!==Ru&&(Fe=o.relatedTarget||o.fromElement)&&(Ar(Fe)||Fe[ji]))break e;if((Se||fe)&&(fe=we.window===we?we:(fe=we.ownerDocument)?fe.defaultView||fe.parentWindow:window,Se?(Fe=o.relatedTarget||o.toElement,Se=le,Fe=Fe?Ar(Fe):null,Fe!==null&&(Lt=X(Fe),Ge=Fe.tag,Fe!==Lt||Ge!==5&&Ge!==27&&Ge!==6)&&(Fe=null)):(Se=null,Fe=le),Se!==Fe)){if(Ge=Mp,Ee="onMouseLeave",de="onMouseEnter",ie="mouse",(a==="pointerout"||a==="pointerover")&&(Ge=Lp,Ee="onPointerLeave",de="onPointerEnter",ie="pointer"),Lt=Se==null?fe:$l(Se),he=Fe==null?fe:$l(Fe),fe=new Ge(Ee,ie+"leave",Se,o,we),fe.target=Lt,fe.relatedTarget=he,Ee=null,Ar(we)===le&&(Ge=new Ge(de,ie+"enter",Fe,o,we),Ge.target=he,Ge.relatedTarget=Lt,Ee=Ge),Lt=Ee,Se&&Fe)t:{for(Ge=Se,de=Fe,ie=0,he=Ge;he;he=Wi(he))ie++;for(he=0,Ee=de;Ee;Ee=Wi(Ee))he++;for(;0<ie-he;)Ge=Wi(Ge),ie--;for(;0<he-ie;)de=Wi(de),he--;for(;ie--;){if(Ge===de||de!==null&&Ge===de.alternate)break t;Ge=Wi(Ge),de=Wi(de)}Ge=null}else Ge=null;Se!==null&&xv(Ce,fe,Se,Ge,!1),Fe!==null&&Lt!==null&&xv(Ce,Lt,Fe,Ge,!0)}}e:{if(fe=le?$l(le):window,Se=fe.nodeName&&fe.nodeName.toLowerCase(),Se==="select"||Se==="input"&&fe.type==="file")var Me=Vp;else if(Hp(fe))if(Gp)Me=tS;else{Me=JN;var Ke=KN}else Se=fe.nodeName,!Se||Se.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?le&&$u(le.elementType)&&(Me=Vp):Me=eS;if(Me&&(Me=Me(a,le))){Yp(Ce,Me,o,we);break e}Ke&&Ke(a,fe,le),a==="focusout"&&le&&fe.type==="number"&&le.memoizedProps.value!=null&&Iu(fe,"number",fe.value)}switch(Ke=le?$l(le):window,a){case"focusin":(Hp(Ke)||Ke.contentEditable==="true")&&(Di=Ke,Qu=le,ql=null);break;case"focusout":ql=Qu=Di=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,tg(Ce,o,we);break;case"selectionchange":if(nS)break;case"keydown":case"keyup":tg(Ce,o,we)}var Pe;if(Hu)e:{switch(a){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else Ai?Pp(a,o)&&(He="onCompositionEnd"):a==="keydown"&&o.keyCode===229&&(He="onCompositionStart");He&&(Bp&&o.locale!=="ko"&&(Ai||He!=="onCompositionStart"?He==="onCompositionEnd"&&Ai&&(Pe=$p()):(Ln=we,Bu="value"in Ln?Ln.value:Ln.textContent,Ai=!0)),Ke=id(le,He),0<Ke.length&&(He=new zp(He,a,null,o,we),Ce.push({event:He,listeners:Ke}),Pe?He.data=Pe:(Pe=qp(o),Pe!==null&&(He.data=Pe)))),(Pe=GN?QN(a,o):XN(a,o))&&(He=id(le,"onBeforeInput"),0<He.length&&(Ke=new zp("onBeforeInput","beforeinput",null,o,we),Ce.push({event:Ke,listeners:He}),Ke.data=Pe)),FS(Ce,a,le,o,we)}yv(Ce,r)})}function vo(a,r,o){return{instance:a,listener:r,currentTarget:o}}function id(a,r){for(var o=r+"Capture",d=[];a!==null;){var h=a,y=h.stateNode;h=h.tag,h!==5&&h!==26&&h!==27||y===null||(h=Rl(a,o),h!=null&&d.unshift(vo(a,h,y)),h=Rl(a,r),h!=null&&d.push(vo(a,h,y))),a=a.return}return d}function Wi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function xv(a,r,o,d,h){for(var y=r._reactName,$=[];o!==null&&o!==d;){var U=o,J=U.alternate,le=U.stateNode;if(U=U.tag,J!==null&&J===d)break;U!==5&&U!==26&&U!==27||le===null||(J=le,h?(le=Rl(o,y),le!=null&&$.unshift(vo(o,le,J))):h||(le=Rl(o,y),le!=null&&$.push(vo(o,le,J)))),o=o.return}$.length!==0&&a.push({event:r,listeners:$})}var HS=/\r\n?/g,YS=/\u0000|\uFFFD/g;function jv(a){return(typeof a=="string"?a:""+a).replace(HS,`
`).replace(YS,"")}function bv(a,r){return r=jv(r),jv(a)===r}function ld(){}function ft(a,r,o,d,h,y){switch(o){case"children":typeof d=="string"?r==="body"||r==="textarea"&&d===""||Ti(a,d):(typeof d=="number"||typeof d=="bigint")&&r!=="body"&&Ti(a,""+d);break;case"className":pc(a,"class",d);break;case"tabIndex":pc(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":pc(a,o,d);break;case"style":_p(a,d,y);break;case"data":if(r!=="object"){pc(a,"data",d);break}case"src":case"href":if(d===""&&(r!=="a"||o!=="href")){a.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(o);break}d=vc(""+d),a.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){a.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(o==="formAction"?(r!=="input"&&ft(a,r,"name",h.name,h,null),ft(a,r,"formEncType",h.formEncType,h,null),ft(a,r,"formMethod",h.formMethod,h,null),ft(a,r,"formTarget",h.formTarget,h,null)):(ft(a,r,"encType",h.encType,h,null),ft(a,r,"method",h.method,h,null),ft(a,r,"target",h.target,h,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(o);break}d=vc(""+d),a.setAttribute(o,d);break;case"onClick":d!=null&&(a.onclick=ld);break;case"onScroll":d!=null&&st("scroll",a);break;case"onScrollEnd":d!=null&&st("scrollend",a);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(h.children!=null)throw Error(i(60));a.innerHTML=o}}break;case"multiple":a.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":a.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){a.removeAttribute("xlink:href");break}o=vc(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,""+d):a.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,""):a.removeAttribute(o);break;case"capture":case"download":d===!0?a.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,d):a.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?a.setAttribute(o,d):a.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?a.removeAttribute(o):a.setAttribute(o,d);break;case"popover":st("beforetoggle",a),st("toggle",a),mc(a,"popover",d);break;case"xlinkActuate":nn(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":nn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":nn(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":nn(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":nn(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":nn(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":nn(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":nn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":nn(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":mc(a,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jN.get(o)||o,mc(a,o,d))}}function xf(a,r,o,d,h,y){switch(o){case"style":_p(a,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(h.children!=null)throw Error(i(60));a.innerHTML=o}}break;case"children":typeof d=="string"?Ti(a,d):(typeof d=="number"||typeof d=="bigint")&&Ti(a,""+d);break;case"onScroll":d!=null&&st("scroll",a);break;case"onScrollEnd":d!=null&&st("scrollend",a);break;case"onClick":d!=null&&(a.onclick=ld);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Np.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(h=o.endsWith("Capture"),r=o.slice(2,h?o.length-7:void 0),y=a[ks]||null,y=y!=null?y[o]:null,typeof y=="function"&&a.removeEventListener(r,y,h),typeof d=="function")){typeof y!="function"&&y!==null&&(o in a?a[o]=null:a.hasAttribute(o)&&a.removeAttribute(o)),a.addEventListener(r,d,h);break e}o in a?a[o]=d:d===!0?a.setAttribute(o,""):mc(a,o,d)}}}function us(a,r,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",a),st("load",a);var d=!1,h=!1,y;for(y in o)if(o.hasOwnProperty(y)){var $=o[y];if($!=null)switch(y){case"src":d=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ft(a,r,y,$,o,null)}}h&&ft(a,r,"srcSet",o.srcSet,o,null),d&&ft(a,r,"src",o.src,o,null);return;case"input":st("invalid",a);var U=y=$=h=null,J=null,le=null;for(d in o)if(o.hasOwnProperty(d)){var we=o[d];if(we!=null)switch(d){case"name":h=we;break;case"type":$=we;break;case"checked":J=we;break;case"defaultChecked":le=we;break;case"value":y=we;break;case"defaultValue":U=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(i(137,r));break;default:ft(a,r,d,we,o,null)}}Cp(a,y,U,J,le,$,h,!1),gc(a);return;case"select":st("invalid",a),d=$=y=null;for(h in o)if(o.hasOwnProperty(h)&&(U=o[h],U!=null))switch(h){case"value":y=U;break;case"defaultValue":$=U;break;case"multiple":d=U;default:ft(a,r,h,U,o,null)}r=y,o=$,a.multiple=!!d,r!=null?wi(a,!!d,r,!1):o!=null&&wi(a,!!d,o,!0);return;case"textarea":st("invalid",a),y=h=d=null;for($ in o)if(o.hasOwnProperty($)&&(U=o[$],U!=null))switch($){case"value":d=U;break;case"defaultValue":h=U;break;case"children":y=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(i(91));break;default:ft(a,r,$,U,o,null)}Dp(a,d,h,y),gc(a);return;case"option":for(J in o)if(o.hasOwnProperty(J)&&(d=o[J],d!=null))switch(J){case"selected":a.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:ft(a,r,J,d,o,null)}return;case"dialog":st("cancel",a),st("close",a);break;case"iframe":case"object":st("load",a);break;case"video":case"audio":for(d=0;d<yo.length;d++)st(yo[d],a);break;case"image":st("error",a),st("load",a);break;case"details":st("toggle",a);break;case"embed":case"source":case"link":st("error",a),st("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(le in o)if(o.hasOwnProperty(le)&&(d=o[le],d!=null))switch(le){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ft(a,r,le,d,o,null)}return;default:if($u(r)){for(we in o)o.hasOwnProperty(we)&&(d=o[we],d!==void 0&&xf(a,r,we,d,o,void 0));return}}for(U in o)o.hasOwnProperty(U)&&(d=o[U],d!=null&&ft(a,r,U,d,o,null))}function VS(a,r,o,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,y=null,$=null,U=null,J=null,le=null,we=null;for(Se in o){var Ce=o[Se];if(o.hasOwnProperty(Se)&&Ce!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":J=Ce;default:d.hasOwnProperty(Se)||ft(a,r,Se,null,d,Ce)}}for(var fe in d){var Se=d[fe];if(Ce=o[fe],d.hasOwnProperty(fe)&&(Se!=null||Ce!=null))switch(fe){case"type":y=Se;break;case"name":h=Se;break;case"checked":le=Se;break;case"defaultChecked":we=Se;break;case"value":$=Se;break;case"defaultValue":U=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(i(137,r));break;default:Se!==Ce&&ft(a,r,fe,Se,d,Ce)}}Ou(a,$,U,J,le,we,y,h);return;case"select":Se=$=U=fe=null;for(y in o)if(J=o[y],o.hasOwnProperty(y)&&J!=null)switch(y){case"value":break;case"multiple":Se=J;default:d.hasOwnProperty(y)||ft(a,r,y,null,d,J)}for(h in d)if(y=d[h],J=o[h],d.hasOwnProperty(h)&&(y!=null||J!=null))switch(h){case"value":fe=y;break;case"defaultValue":U=y;break;case"multiple":$=y;default:y!==J&&ft(a,r,h,y,d,J)}r=U,o=$,d=Se,fe!=null?wi(a,!!o,fe,!1):!!d!=!!o&&(r!=null?wi(a,!!o,r,!0):wi(a,!!o,o?[]:"",!1));return;case"textarea":Se=fe=null;for(U in o)if(h=o[U],o.hasOwnProperty(U)&&h!=null&&!d.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:ft(a,r,U,null,d,h)}for($ in d)if(h=d[$],y=o[$],d.hasOwnProperty($)&&(h!=null||y!=null))switch($){case"value":fe=h;break;case"defaultValue":Se=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(i(91));break;default:h!==y&&ft(a,r,$,h,d,y)}Ap(a,fe,Se);return;case"option":for(var Fe in o)if(fe=o[Fe],o.hasOwnProperty(Fe)&&fe!=null&&!d.hasOwnProperty(Fe))switch(Fe){case"selected":a.selected=!1;break;default:ft(a,r,Fe,null,d,fe)}for(J in d)if(fe=d[J],Se=o[J],d.hasOwnProperty(J)&&fe!==Se&&(fe!=null||Se!=null))switch(J){case"selected":a.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:ft(a,r,J,fe,d,Se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in o)fe=o[Ge],o.hasOwnProperty(Ge)&&fe!=null&&!d.hasOwnProperty(Ge)&&ft(a,r,Ge,null,d,fe);for(le in d)if(fe=d[le],Se=o[le],d.hasOwnProperty(le)&&fe!==Se&&(fe!=null||Se!=null))switch(le){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,r));break;default:ft(a,r,le,fe,d,Se)}return;default:if($u(r)){for(var Lt in o)fe=o[Lt],o.hasOwnProperty(Lt)&&fe!==void 0&&!d.hasOwnProperty(Lt)&&xf(a,r,Lt,void 0,d,fe);for(we in d)fe=d[we],Se=o[we],!d.hasOwnProperty(we)||fe===Se||fe===void 0&&Se===void 0||xf(a,r,we,fe,d,Se);return}}for(var de in o)fe=o[de],o.hasOwnProperty(de)&&fe!=null&&!d.hasOwnProperty(de)&&ft(a,r,de,null,d,fe);for(Ce in d)fe=d[Ce],Se=o[Ce],!d.hasOwnProperty(Ce)||fe===Se||fe==null&&Se==null||ft(a,r,Ce,fe,d,Se)}var jf=null,bf=null;function od(a){return a.nodeType===9?a:a.ownerDocument}function Nv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sv(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function Nf(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Sf=null;function GS(){var a=window.event;return a&&a.type==="popstate"?a===Sf?!1:(Sf=a,!0):(Sf=null,!1)}var wv=typeof setTimeout=="function"?setTimeout:void 0,QS=typeof clearTimeout=="function"?clearTimeout:void 0,Tv=typeof Promise=="function"?Promise:void 0,XS=typeof queueMicrotask=="function"?queueMicrotask:typeof Tv<"u"?function(a){return Tv.resolve(null).then(a).catch(ZS)}:wv;function ZS(a){setTimeout(function(){throw a})}function wf(a,r){var o=r,d=0;do{var h=o.nextSibling;if(a.removeChild(o),h&&h.nodeType===8)if(o=h.data,o==="/$"){if(d===0){a.removeChild(h),Eo(r);return}d--}else o!=="$"&&o!=="$?"&&o!=="$!"||d++;o=h}while(o);Eo(r)}function Tf(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var o=r;switch(r=r.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Tf(o),_u(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}a.removeChild(o)}}function WS(a,r,o,d){for(;a.nodeType===1;){var h=o;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!d&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(d){if(!a[Il])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(y=a.getAttribute("rel"),y==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(y!==h.rel||a.getAttribute("href")!==(h.href==null?null:h.href)||a.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||a.getAttribute("title")!==(h.title==null?null:h.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(y=a.getAttribute("src"),(y!==(h.src==null?null:h.src)||a.getAttribute("type")!==(h.type==null?null:h.type)||a.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&y&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var y=h.name==null?null:""+h.name;if(h.type==="hidden"&&a.getAttribute("name")===y)return a}else return a;if(a=ka(a.nextSibling),a===null)break}return null}function KS(a,r,o){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=ka(a.nextSibling),a===null))return null;return a}function ka(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return a}function Ev(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var o=a.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return a;r--}else o==="/$"&&r++}a=a.previousSibling}return null}function Cv(a,r,o){switch(r=od(o),a){case"html":if(a=r.documentElement,!a)throw Error(i(452));return a;case"head":if(a=r.head,!a)throw Error(i(453));return a;case"body":if(a=r.body,!a)throw Error(i(454));return a;default:throw Error(i(451))}}var ya=new Map,Av=new Set;function cd(a){return typeof a.getRootNode=="function"?a.getRootNode():a.ownerDocument}var jn=H.d;H.d={f:JS,r:e1,D:t1,C:s1,L:a1,m:n1,X:i1,S:r1,M:l1};function JS(){var a=jn.f(),r=td();return a||r}function e1(a){var r=bi(a);r!==null&&r.tag===5&&r.type==="form"?ty(r):jn.r(a)}var Ki=typeof document>"u"?null:document;function Dv(a,r,o){var d=Ki;if(d&&typeof r=="string"&&r){var h=la(r);h='link[rel="'+a+'"][href="'+h+'"]',typeof o=="string"&&(h+='[crossorigin="'+o+'"]'),Av.has(h)||(Av.add(h),a={rel:a,crossOrigin:o,href:r},d.querySelector(h)===null&&(r=d.createElement("link"),us(r,"link",a),ss(r),d.head.appendChild(r)))}}function t1(a){jn.D(a),Dv("dns-prefetch",a,null)}function s1(a,r){jn.C(a,r),Dv("preconnect",a,r)}function a1(a,r,o){jn.L(a,r,o);var d=Ki;if(d&&a&&r){var h='link[rel="preload"][as="'+la(r)+'"]';r==="image"&&o&&o.imageSrcSet?(h+='[imagesrcset="'+la(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(h+='[imagesizes="'+la(o.imageSizes)+'"]')):h+='[href="'+la(a)+'"]';var y=h;switch(r){case"style":y=Ji(a);break;case"script":y=el(a)}ya.has(y)||(a=M({rel:"preload",href:r==="image"&&o&&o.imageSrcSet?void 0:a,as:r},o),ya.set(y,a),d.querySelector(h)!==null||r==="style"&&d.querySelector(xo(y))||r==="script"&&d.querySelector(jo(y))||(r=d.createElement("link"),us(r,"link",a),ss(r),d.head.appendChild(r)))}}function n1(a,r){jn.m(a,r);var o=Ki;if(o&&a){var d=r&&typeof r.as=="string"?r.as:"script",h='link[rel="modulepreload"][as="'+la(d)+'"][href="'+la(a)+'"]',y=h;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=el(a)}if(!ya.has(y)&&(a=M({rel:"modulepreload",href:a},r),ya.set(y,a),o.querySelector(h)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(jo(y)))return}d=o.createElement("link"),us(d,"link",a),ss(d),o.head.appendChild(d)}}}function r1(a,r,o){jn.S(a,r,o);var d=Ki;if(d&&a){var h=Ni(d).hoistableStyles,y=Ji(a);r=r||"default";var $=h.get(y);if(!$){var U={loading:0,preload:null};if($=d.querySelector(xo(y)))U.loading=5;else{a=M({rel:"stylesheet",href:a,"data-precedence":r},o),(o=ya.get(y))&&Ef(a,o);var J=$=d.createElement("link");ss(J),us(J,"link",a),J._p=new Promise(function(le,we){J.onload=le,J.onerror=we}),J.addEventListener("load",function(){U.loading|=1}),J.addEventListener("error",function(){U.loading|=2}),U.loading|=4,dd($,r,d)}$={type:"stylesheet",instance:$,count:1,state:U},h.set(y,$)}}}function i1(a,r){jn.X(a,r);var o=Ki;if(o&&a){var d=Ni(o).hoistableScripts,h=el(a),y=d.get(h);y||(y=o.querySelector(jo(h)),y||(a=M({src:a,async:!0},r),(r=ya.get(h))&&Cf(a,r),y=o.createElement("script"),ss(y),us(y,"link",a),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(h,y))}}function l1(a,r){jn.M(a,r);var o=Ki;if(o&&a){var d=Ni(o).hoistableScripts,h=el(a),y=d.get(h);y||(y=o.querySelector(jo(h)),y||(a=M({src:a,async:!0,type:"module"},r),(r=ya.get(h))&&Cf(a,r),y=o.createElement("script"),ss(y),us(y,"link",a),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(h,y))}}function kv(a,r,o,d){var h=(h=re.current)?cd(h):null;if(!h)throw Error(i(446));switch(a){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(r=Ji(o.href),o=Ni(h).hoistableStyles,d=o.get(r),d||(d={type:"style",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){a=Ji(o.href);var y=Ni(h).hoistableStyles,$=y.get(a);if($||(h=h.ownerDocument||h,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(a,$),(y=h.querySelector(xo(a)))&&!y._p&&($.instance=y,$.state.loading=5),ya.has(a)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ya.set(a,o),y||o1(h,a,o,$.state))),r&&d===null)throw Error(i(528,""));return $}if(r&&d!==null)throw Error(i(529,""));return null;case"script":return r=o.async,o=o.src,typeof o=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=el(o),o=Ni(h).hoistableScripts,d=o.get(r),d||(d={type:"script",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,a))}}function Ji(a){return'href="'+la(a)+'"'}function xo(a){return'link[rel="stylesheet"]['+a+"]"}function _v(a){return M({},a,{"data-precedence":a.precedence,precedence:null})}function o1(a,r,o,d){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?d.loading=1:(r=a.createElement("link"),d.preload=r,r.addEventListener("load",function(){return d.loading|=1}),r.addEventListener("error",function(){return d.loading|=2}),us(r,"link",o),ss(r),a.head.appendChild(r))}function el(a){return'[src="'+la(a)+'"]'}function jo(a){return"script[async]"+a}function Ov(a,r,o){if(r.count++,r.instance===null)switch(r.type){case"style":var d=a.querySelector('style[data-href~="'+la(o.href)+'"]');if(d)return r.instance=d,ss(d),d;var h=M({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(a.ownerDocument||a).createElement("style"),ss(d),us(d,"style",h),dd(d,o.precedence,a),r.instance=d;case"stylesheet":h=Ji(o.href);var y=a.querySelector(xo(h));if(y)return r.state.loading|=4,r.instance=y,ss(y),y;d=_v(o),(h=ya.get(h))&&Ef(d,h),y=(a.ownerDocument||a).createElement("link"),ss(y);var $=y;return $._p=new Promise(function(U,J){$.onload=U,$.onerror=J}),us(y,"link",d),r.state.loading|=4,dd(y,o.precedence,a),r.instance=y;case"script":return y=el(o.src),(h=a.querySelector(jo(y)))?(r.instance=h,ss(h),h):(d=o,(h=ya.get(y))&&(d=M({},o),Cf(d,h)),a=a.ownerDocument||a,h=a.createElement("script"),ss(h),us(h,"link",d),a.head.appendChild(h),r.instance=h);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(d=r.instance,r.state.loading|=4,dd(d,o.precedence,a));return r.instance}function dd(a,r,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=d.length?d[d.length-1]:null,y=h,$=0;$<d.length;$++){var U=d[$];if(U.dataset.precedence===r)y=U;else if(y!==h)break}y?y.parentNode.insertBefore(a,y.nextSibling):(r=o.nodeType===9?o.head:o,r.insertBefore(a,r.firstChild))}function Ef(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function Cf(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var ud=null;function Iv(a,r,o){if(ud===null){var d=new Map,h=ud=new Map;h.set(o,d)}else h=ud,d=h.get(o),d||(d=new Map,h.set(o,d));if(d.has(a))return d;for(d.set(a,null),o=o.getElementsByTagName(a),h=0;h<o.length;h++){var y=o[h];if(!(y[Il]||y[xs]||a==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var $=y.getAttribute(r)||"";$=a+$;var U=d.get($);U?U.push(y):d.set($,[y])}}return d}function $v(a,r,o){a=a.ownerDocument||a,a.head.insertBefore(o,r==="title"?a.querySelector("head > title"):null)}function c1(a,r,o){if(o===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return a=r.disabled,typeof r.precedence=="string"&&a==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Rv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var bo=null;function d1(){}function u1(a,r,o){if(bo===null)throw Error(i(475));var d=bo;if(r.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var h=Ji(o.href),y=a.querySelector(xo(h));if(y){a=y._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(d.count++,d=hd.bind(d),a.then(d,d)),r.state.loading|=4,r.instance=y,ss(y);return}y=a.ownerDocument||a,o=_v(o),(h=ya.get(h))&&Ef(o,h),y=y.createElement("link"),ss(y);var $=y;$._p=new Promise(function(U,J){$.onload=U,$.onerror=J}),us(y,"link",o),r.instance=y}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(r,a),(a=r.state.preload)&&(r.state.loading&3)===0&&(d.count++,r=hd.bind(d),a.addEventListener("load",r),a.addEventListener("error",r))}}function h1(){if(bo===null)throw Error(i(475));var a=bo;return a.stylesheets&&a.count===0&&Af(a,a.stylesheets),0<a.count?function(r){var o=setTimeout(function(){if(a.stylesheets&&Af(a,a.stylesheets),a.unsuspend){var d=a.unsuspend;a.unsuspend=null,d()}},6e4);return a.unsuspend=r,function(){a.unsuspend=null,clearTimeout(o)}}:null}function hd(){if(this.count--,this.count===0){if(this.stylesheets)Af(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var fd=null;function Af(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,fd=new Map,r.forEach(f1,a),fd=null,hd.call(a))}function f1(a,r){if(!(r.state.loading&4)){var o=fd.get(a);if(o)var d=o.get(null);else{o=new Map,fd.set(a,o);for(var h=a.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<h.length;y++){var $=h[y];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(o.set($.dataset.precedence,$),d=$)}d&&o.set(null,d)}h=r.instance,$=h.getAttribute("data-precedence"),y=o.get($)||d,y===d&&o.set(null,h),o.set($,h),this.count++,d=hd.bind(this),h.addEventListener("load",d),h.addEventListener("error",d),y?y.parentNode.insertBefore(h,y.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(h,a.firstChild)),r.state.loading|=4}}var No={$$typeof:N,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function m1(a,r,o,d,h,y,$,U){this.tag=1,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Du(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Du(0),this.hiddenUpdates=Du(null),this.identifierPrefix=d,this.onUncaughtError=h,this.onCaughtError=y,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function Mv(a,r,o,d,h,y,$,U,J,le,we,Ce){return a=new m1(a,r,o,$,U,J,le,Ce),r=1,y===!0&&(r|=24),y=pa(3,null,null,r),a.current=y,y.stateNode=a,r=rh(),r.refCount++,a.pooledCache=r,r.refCount++,y.memoizedState={element:d,isDehydrated:o,cache:r},Bh(y),a}function zv(a){return a?(a=Oi,a):Oi}function Lv(a,r,o,d,h,y){h=zv(h),d.context===null?d.context=h:d.pendingContext=h,d=Vn(r),d.payload={element:o},y=y===void 0?null:y,y!==null&&(d.callback=y),o=Gn(a,d,r),o!==null&&(Cs(o,a,r),no(o,a,r))}function Bv(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var o=a.retryLane;a.retryLane=o!==0&&o<r?o:r}}function Df(a,r){Bv(a,r),(a=a.alternate)&&Bv(a,r)}function Fv(a){if(a.tag===13){var r=Bn(a,67108864);r!==null&&Cs(r,a,67108864),Df(a,67108864)}}var md=!0;function p1(a,r,o,d){var h=I.T;I.T=null;var y=H.p;try{H.p=2,kf(a,r,o,d)}finally{H.p=y,I.T=h}}function g1(a,r,o,d){var h=I.T;I.T=null;var y=H.p;try{H.p=8,kf(a,r,o,d)}finally{H.p=y,I.T=h}}function kf(a,r,o,d){if(md){var h=_f(d);if(h===null)vf(a,r,d,pd,o),Pv(a,d);else if(v1(h,a,r,o,d))d.stopPropagation();else if(Pv(a,d),r&4&&-1<y1.indexOf(a)){for(;h!==null;){var y=bi(h);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var $=ra(y.pendingLanes);if($!==0){var U=y;for(U.pendingLanes|=2,U.entangledLanes|=2;$;){var J=1<<31-ke($);U.entanglements[1]|=J,$&=~J}Ga(y),(kt&6)===0&&(Kc=ve()+500,go(0))}}break;case 13:U=Bn(y,2),U!==null&&Cs(U,y,2),td(),Df(y,2)}if(y=_f(d),y===null&&vf(a,r,d,pd,o),y===h)break;h=y}h!==null&&d.stopPropagation()}else vf(a,r,d,null,o)}}function _f(a){return a=Mu(a),Of(a)}var pd=null;function Of(a){if(pd=null,a=Ar(a),a!==null){var r=X(a);if(r===null)a=null;else{var o=r.tag;if(o===13){if(a=se(r),a!==null)return a;a=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return pd=a,null}function Uv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case _e:return 2;case Ie:return 8;case Ue:case $t:return 32;case qe:return 268435456;default:return 32}default:return 32}}var If=!1,er=null,tr=null,sr=null,So=new Map,wo=new Map,ar=[],y1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pv(a,r){switch(a){case"focusin":case"focusout":er=null;break;case"dragenter":case"dragleave":tr=null;break;case"mouseover":case"mouseout":sr=null;break;case"pointerover":case"pointerout":So.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(r.pointerId)}}function To(a,r,o,d,h,y){return a===null||a.nativeEvent!==y?(a={blockedOn:r,domEventName:o,eventSystemFlags:d,nativeEvent:y,targetContainers:[h]},r!==null&&(r=bi(r),r!==null&&Fv(r)),a):(a.eventSystemFlags|=d,r=a.targetContainers,h!==null&&r.indexOf(h)===-1&&r.push(h),a)}function v1(a,r,o,d,h){switch(r){case"focusin":return er=To(er,a,r,o,d,h),!0;case"dragenter":return tr=To(tr,a,r,o,d,h),!0;case"mouseover":return sr=To(sr,a,r,o,d,h),!0;case"pointerover":var y=h.pointerId;return So.set(y,To(So.get(y)||null,a,r,o,d,h)),!0;case"gotpointercapture":return y=h.pointerId,wo.set(y,To(wo.get(y)||null,a,r,o,d,h)),!0}return!1}function qv(a){var r=Ar(a.target);if(r!==null){var o=X(r);if(o!==null){if(r=o.tag,r===13){if(r=se(o),r!==null){a.blockedOn=r,hN(a.priority,function(){if(o.tag===13){var d=Qs(),h=Bn(o,d);h!==null&&Cs(h,o,d),Df(o,d)}});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){a.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}a.blockedOn=null}function gd(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var o=_f(a.nativeEvent);if(o===null){o=a.nativeEvent;var d=new o.constructor(o.type,o);Ru=d,o.target.dispatchEvent(d),Ru=null}else return r=bi(o),r!==null&&Fv(r),a.blockedOn=o,!1;r.shift()}return!0}function Hv(a,r,o){gd(a)&&o.delete(r)}function x1(){If=!1,er!==null&&gd(er)&&(er=null),tr!==null&&gd(tr)&&(tr=null),sr!==null&&gd(sr)&&(sr=null),So.forEach(Hv),wo.forEach(Hv)}function yd(a,r){a.blockedOn===r&&(a.blockedOn=null,If||(If=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,x1)))}var vd=null;function Yv(a){vd!==a&&(vd=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){vd===a&&(vd=null);for(var r=0;r<a.length;r+=3){var o=a[r],d=a[r+1],h=a[r+2];if(typeof d!="function"){if(Of(d||o)===null)continue;break}var y=bi(o);y!==null&&(a.splice(r,3),r-=3,bh(y,{pending:!0,data:h,method:o.method,action:d},d,h))}}))}function Eo(a){function r(J){return yd(J,a)}er!==null&&yd(er,a),tr!==null&&yd(tr,a),sr!==null&&yd(sr,a),So.forEach(r),wo.forEach(r);for(var o=0;o<ar.length;o++){var d=ar[o];d.blockedOn===a&&(d.blockedOn=null)}for(;0<ar.length&&(o=ar[0],o.blockedOn===null);)qv(o),o.blockedOn===null&&ar.shift();if(o=(a.ownerDocument||a).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var h=o[d],y=o[d+1],$=h[ks]||null;if(typeof y=="function")$||Yv(o);else if($){var U=null;if(y&&y.hasAttribute("formAction")){if(h=y,$=y[ks]||null)U=$.formAction;else if(Of(h)!==null)continue}else U=$.action;typeof U=="function"?o[d+1]=U:(o.splice(d,3),d-=3),Yv(o)}}}function $f(a){this._internalRoot=a}xd.prototype.render=$f.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(i(409));var o=r.current,d=Qs();Lv(o,d,a,r,null,null)},xd.prototype.unmount=$f.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;a.tag===0&&Xi(),Lv(a.current,2,null,a,null,null),td(),r[ji]=null}};function xd(a){this._internalRoot=a}xd.prototype.unstable_scheduleHydration=function(a){if(a){var r=xp();a={blockedOn:null,target:a,priority:r};for(var o=0;o<ar.length&&r!==0&&r<ar[o].priority;o++);ar.splice(o,0,a),o===0&&qv(a)}};var Vv=s.version;if(Vv!=="19.0.0")throw Error(i(527,Vv,"19.0.0"));H.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(i(188)):(a=Object.keys(a).join(","),Error(i(268,a)));return a=B(r),a=a!==null?L(a):null,a=a===null?null:a.stateNode,a};var j1={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:I,findFiberByHostInstance:Ar,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jd.isDisabled&&jd.supportsFiber)try{Pt=jd.inject(j1),xt=jd}catch{}}return Ao.createRoot=function(a,r){if(!l(a))throw Error(i(299));var o=!1,d="",h=cy,y=dy,$=uy,U=null;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onUncaughtError!==void 0&&(h=r.onUncaughtError),r.onCaughtError!==void 0&&(y=r.onCaughtError),r.onRecoverableError!==void 0&&($=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(U=r.unstable_transitionCallbacks)),r=Mv(a,1,!1,null,null,o,d,h,y,$,U,null),a[ji]=r.current,yf(a.nodeType===8?a.parentNode:a),new $f(r)},Ao.hydrateRoot=function(a,r,o){if(!l(a))throw Error(i(299));var d=!1,h="",y=cy,$=dy,U=uy,J=null,le=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&($=o.onCaughtError),o.onRecoverableError!==void 0&&(U=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(J=o.unstable_transitionCallbacks),o.formState!==void 0&&(le=o.formState)),r=Mv(a,1,!0,r,o??null,d,h,y,$,U,J,le),r.context=zv(null),o=r.current,d=Qs(),h=Vn(d),h.callback=null,Gn(o,h,d),r.current.lanes=d,Ol(r,d),Ga(r),a[ji]=r.current,yf(a),new xd(r)},Ao.version="19.0.0",Ao}var ax;function k1(){if(ax)return Lf.exports;ax=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),Lf.exports=D1(),Lf.exports}var _1=k1(),Do={},nx;function O1(){if(nx)return Do;nx=1,Object.defineProperty(Do,"__esModule",{value:!0}),Do.parse=u,Do.serialize=m;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,s=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,i=/^[\u0020-\u003A\u003D-\u007E]*$/,l=Object.prototype.toString,c=(()=>{const j=function(){};return j.prototype=Object.create(null),j})();function u(j,N){const b=new c,w=j.length;if(w<2)return b;const C=(N==null?void 0:N.decode)||g;let T=0;do{const A=j.indexOf("=",T);if(A===-1)break;const _=j.indexOf(";",T),D=_===-1?w:_;if(A>D){T=j.lastIndexOf(";",A-1)+1;continue}const S=f(j,T,A),R=p(j,A,S),E=j.slice(S,R);if(b[E]===void 0){let k=f(j,A+1,D),I=p(j,D,k);const M=C(j.slice(k,I));b[E]=M}T=D+1}while(T<w);return b}function f(j,N,b){do{const w=j.charCodeAt(N);if(w!==32&&w!==9)return N}while(++N<b);return b}function p(j,N,b){for(;N>b;){const w=j.charCodeAt(--N);if(w!==32&&w!==9)return N+1}return b}function m(j,N,b){const w=(b==null?void 0:b.encode)||encodeURIComponent;if(!t.test(j))throw new TypeError(`argument name is invalid: ${j}`);const C=w(N);if(!s.test(C))throw new TypeError(`argument val is invalid: ${N}`);let T=j+"="+C;if(!b)return T;if(b.maxAge!==void 0){if(!Number.isInteger(b.maxAge))throw new TypeError(`option maxAge is invalid: ${b.maxAge}`);T+="; Max-Age="+b.maxAge}if(b.domain){if(!n.test(b.domain))throw new TypeError(`option domain is invalid: ${b.domain}`);T+="; Domain="+b.domain}if(b.path){if(!i.test(b.path))throw new TypeError(`option path is invalid: ${b.path}`);T+="; Path="+b.path}if(b.expires){if(!v(b.expires)||!Number.isFinite(b.expires.valueOf()))throw new TypeError(`option expires is invalid: ${b.expires}`);T+="; Expires="+b.expires.toUTCString()}if(b.httpOnly&&(T+="; HttpOnly"),b.secure&&(T+="; Secure"),b.partitioned&&(T+="; Partitioned"),b.priority)switch(typeof b.priority=="string"?b.priority.toLowerCase():void 0){case"low":T+="; Priority=Low";break;case"medium":T+="; Priority=Medium";break;case"high":T+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${b.priority}`)}if(b.sameSite)switch(typeof b.sameSite=="string"?b.sameSite.toLowerCase():b.sameSite){case!0:case"strict":T+="; SameSite=Strict";break;case"lax":T+="; SameSite=Lax";break;case"none":T+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${b.sameSite}`)}return T}function g(j){if(j.indexOf("%")===-1)return j;try{return decodeURIComponent(j)}catch{return j}}function v(j){return l.call(j)==="[object Date]"}return Do}O1();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var rx="popstate";function I1(t={}){function s(i,l){let{pathname:c,search:u,hash:f}=i.location;return mm("",{pathname:c,search:u,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(i,l){return typeof l=="string"?l:Lo(l)}return R1(s,n,null,t)}function Ct(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function Na(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function $1(){return Math.random().toString(36).substring(2,10)}function ix(t,s){return{usr:t.state,key:t.key,idx:s}}function mm(t,s,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?bl(s):s,state:n,key:s&&s.key||i||$1()}}function Lo({pathname:t="/",search:s="",hash:n=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function bl(t){let s={};if(t){let n=t.indexOf("#");n>=0&&(s.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(s.search=t.substring(i),t=t.substring(0,i)),t&&(s.pathname=t)}return s}function R1(t,s,n,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,u=l.history,f="POP",p=null,m=g();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function g(){return(u.state||{idx:null}).idx}function v(){f="POP";let C=g(),T=C==null?null:C-m;m=C,p&&p({action:f,location:w.location,delta:T})}function j(C,T){f="PUSH";let A=mm(w.location,C,T);m=g()+1;let _=ix(A,m),D=w.createHref(A);try{u.pushState(_,"",D)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;l.location.assign(D)}c&&p&&p({action:f,location:w.location,delta:1})}function N(C,T){f="REPLACE";let A=mm(w.location,C,T);m=g();let _=ix(A,m),D=w.createHref(A);u.replaceState(_,"",D),c&&p&&p({action:f,location:w.location,delta:0})}function b(C){let T=l.location.origin!=="null"?l.location.origin:l.location.href,A=typeof C=="string"?C:Lo(C);return A=A.replace(/ $/,"%20"),Ct(T,`No window.location.(origin|href) available to create URL for href: ${A}`),new URL(A,T)}let w={get action(){return f},get location(){return t(l,u)},listen(C){if(p)throw new Error("A history only accepts one active listener");return l.addEventListener(rx,v),p=C,()=>{l.removeEventListener(rx,v),p=null}},createHref(C){return s(l,C)},createURL:b,encodeLocation(C){let T=b(C);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:j,replace:N,go(C){return u.go(C)}};return w}function a0(t,s,n="/"){return M1(t,s,n,!1)}function M1(t,s,n,i){let l=typeof s=="string"?bl(s):s,c=_n(l.pathname||"/",n);if(c==null)return null;let u=n0(t);z1(u);let f=null;for(let p=0;f==null&&p<u.length;++p){let m=Q1(c);f=V1(u[p],m,i)}return f}function n0(t,s=[],n=[],i=""){let l=(c,u,f)=>{let p={relativePath:f===void 0?c.path||"":f,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};p.relativePath.startsWith("/")&&(Ct(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length));let m=An([i,p.relativePath]),g=n.concat(p);c.children&&c.children.length>0&&(Ct(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),n0(c.children,s,g,m)),!(c.path==null&&!c.index)&&s.push({path:m,score:H1(m,c.index),routesMeta:g})};return t.forEach((c,u)=>{var f;if(c.path===""||!((f=c.path)!=null&&f.includes("?")))l(c,u);else for(let p of r0(c.path))l(c,u,p)}),s}function r0(t){let s=t.split("/");if(s.length===0)return[];let[n,...i]=s,l=n.endsWith("?"),c=n.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let u=r0(i.join("/")),f=[];return f.push(...u.map(p=>p===""?c:[c,p].join("/"))),l&&f.push(...u),f.map(p=>t.startsWith("/")&&p===""?"/":p)}function z1(t){t.sort((s,n)=>s.score!==n.score?n.score-s.score:Y1(s.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var L1=/^:[\w-]+$/,B1=3,F1=2,U1=1,P1=10,q1=-2,lx=t=>t==="*";function H1(t,s){let n=t.split("/"),i=n.length;return n.some(lx)&&(i+=q1),s&&(i+=F1),n.filter(l=>!lx(l)).reduce((l,c)=>l+(L1.test(c)?B1:c===""?U1:P1),i)}function Y1(t,s){return t.length===s.length&&t.slice(0,-1).every((i,l)=>i===s[l])?t[t.length-1]-s[s.length-1]:0}function V1(t,s,n=!1){let{routesMeta:i}=t,l={},c="/",u=[];for(let f=0;f<i.length;++f){let p=i[f],m=f===i.length-1,g=c==="/"?s:s.slice(c.length)||"/",v=Jd({path:p.relativePath,caseSensitive:p.caseSensitive,end:m},g),j=p.route;if(!v&&m&&n&&!i[i.length-1].route.index&&(v=Jd({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},g)),!v)return null;Object.assign(l,v.params),u.push({params:l,pathname:An([c,v.pathname]),pathnameBase:K1(An([c,v.pathnameBase])),route:j}),v.pathnameBase!=="/"&&(c=An([c,v.pathnameBase]))}return u}function Jd(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=G1(t.path,t.caseSensitive,t.end),l=s.match(n);if(!l)return null;let c=l[0],u=c.replace(/(.)\/+$/,"$1"),f=l.slice(1);return{params:i.reduce((m,{paramName:g,isOptional:v},j)=>{if(g==="*"){let b=f[j]||"";u=c.slice(0,c.length-b.length).replace(/(.)\/+$/,"$1")}const N=f[j];return v&&!N?m[g]=void 0:m[g]=(N||"").replace(/%2F/g,"/"),m},{}),pathname:c,pathnameBase:u,pattern:t}}function G1(t,s=!1,n=!0){Na(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],l="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,f,p)=>(i.push({paramName:f,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),l+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?l+="\\/*$":t!==""&&t!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,s?void 0:"i"),i]}function Q1(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Na(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function _n(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function X1(t,s="/"){let{pathname:n,search:i="",hash:l=""}=typeof t=="string"?bl(t):t;return{pathname:n?n.startsWith("/")?n:Z1(n,s):s,search:J1(i),hash:ew(l)}}function Z1(t,s){let n=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(l=>{l===".."?n.length>1&&n.pop():l!=="."&&n.push(l)}),n.length>1?n.join("/"):"/"}function Pf(t,s,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function W1(t){return t.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function Pm(t){let s=W1(t);return s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase)}function qm(t,s,n,i=!1){let l;typeof t=="string"?l=bl(t):(l={...t},Ct(!l.pathname||!l.pathname.includes("?"),Pf("?","pathname","search",l)),Ct(!l.pathname||!l.pathname.includes("#"),Pf("#","pathname","hash",l)),Ct(!l.search||!l.search.includes("#"),Pf("#","search","hash",l)));let c=t===""||l.pathname==="",u=c?"/":l.pathname,f;if(u==null)f=n;else{let v=s.length-1;if(!i&&u.startsWith("..")){let j=u.split("/");for(;j[0]==="..";)j.shift(),v-=1;l.pathname=j.join("/")}f=v>=0?s[v]:"/"}let p=X1(l,f),m=u&&u!=="/"&&u.endsWith("/"),g=(c||u===".")&&n.endsWith("/");return!p.pathname.endsWith("/")&&(m||g)&&(p.pathname+="/"),p}var An=t=>t.join("/").replace(/\/\/+/g,"/"),K1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),J1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,ew=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function tw(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var i0=["POST","PUT","PATCH","DELETE"];new Set(i0);var sw=["GET",...i0];new Set(sw);var Nl=x.createContext(null);Nl.displayName="DataRouter";var uu=x.createContext(null);uu.displayName="DataRouterState";var l0=x.createContext({isTransitioning:!1});l0.displayName="ViewTransition";var aw=x.createContext(new Map);aw.displayName="Fetchers";var nw=x.createContext(null);nw.displayName="Await";var Ba=x.createContext(null);Ba.displayName="Navigation";var Jo=x.createContext(null);Jo.displayName="Location";var wa=x.createContext({outlet:null,matches:[],isDataRoute:!1});wa.displayName="Route";var Hm=x.createContext(null);Hm.displayName="RouteError";function rw(t,{relative:s}={}){Ct(Sl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=x.useContext(Ba),{hash:l,pathname:c,search:u}=ec(t,{relative:s}),f=c;return n!=="/"&&(f=c==="/"?n:An([n,c])),i.createHref({pathname:f,search:u,hash:l})}function Sl(){return x.useContext(Jo)!=null}function ys(){return Ct(Sl(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Jo).location}var o0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function c0(t){x.useContext(Ba).static||x.useLayoutEffect(t)}function Ot(){let{isDataRoute:t}=x.useContext(wa);return t?jw():iw()}function iw(){Ct(Sl(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(Nl),{basename:s,navigator:n}=x.useContext(Ba),{matches:i}=x.useContext(wa),{pathname:l}=ys(),c=JSON.stringify(Pm(i)),u=x.useRef(!1);return c0(()=>{u.current=!0}),x.useCallback((p,m={})=>{if(Na(u.current,o0),!u.current)return;if(typeof p=="number"){n.go(p);return}let g=qm(p,JSON.parse(c),l,m.relative==="path");t==null&&s!=="/"&&(g.pathname=g.pathname==="/"?s:An([s,g.pathname])),(m.replace?n.replace:n.push)(g,m.state,m)},[s,n,c,l,t])}var lw=x.createContext(null);function ow(t){let s=x.useContext(wa).outlet;return s&&x.createElement(lw.Provider,{value:t},s)}function Nr(){let{matches:t}=x.useContext(wa),s=t[t.length-1];return s?s.params:{}}function ec(t,{relative:s}={}){let{matches:n}=x.useContext(wa),{pathname:i}=ys(),l=JSON.stringify(Pm(n));return x.useMemo(()=>qm(t,JSON.parse(l),i,s==="path"),[t,l,i,s])}function cw(t,s){return d0(t,s)}function d0(t,s,n,i){var A;Ct(Sl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l,static:c}=x.useContext(Ba),{matches:u}=x.useContext(wa),f=u[u.length-1],p=f?f.params:{},m=f?f.pathname:"/",g=f?f.pathnameBase:"/",v=f&&f.route;{let _=v&&v.path||"";u0(m,!v||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let j=ys(),N;if(s){let _=typeof s=="string"?bl(s):s;Ct(g==="/"||((A=_.pathname)==null?void 0:A.startsWith(g)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${_.pathname}" was given in the \`location\` prop.`),N=_}else N=j;let b=N.pathname||"/",w=b;if(g!=="/"){let _=g.replace(/^\//,"").split("/");w="/"+b.replace(/^\//,"").split("/").slice(_.length).join("/")}let C=!c&&n&&n.matches&&n.matches.length>0?n.matches:a0(t,{pathname:w});Na(v||C!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),Na(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let T=mw(C&&C.map(_=>Object.assign({},_,{params:Object.assign({},p,_.params),pathname:An([g,l.encodeLocation?l.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?g:An([g,l.encodeLocation?l.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),u,n,i);return s&&T?x.createElement(Jo.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},T):T}function dw(){let t=xw(),s=tw(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=x.createElement(x.Fragment,null,x.createElement("p",null,"💿 Hey developer 👋"),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:c},"ErrorBoundary")," or"," ",x.createElement("code",{style:c},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},s),n?x.createElement("pre",{style:l},n):null,u)}var uw=x.createElement(dw,null),hw=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?x.createElement(wa.Provider,{value:this.props.routeContext},x.createElement(Hm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function fw({routeContext:t,match:s,children:n}){let i=x.useContext(Nl);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),x.createElement(wa.Provider,{value:t},n)}function mw(t,s=[],n=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(s.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=n==null?void 0:n.errors;if(c!=null){let p=l.findIndex(m=>m.route.id&&(c==null?void 0:c[m.route.id])!==void 0);Ct(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,p+1))}let u=!1,f=-1;if(n)for(let p=0;p<l.length;p++){let m=l[p];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(f=p),m.route.id){let{loaderData:g,errors:v}=n,j=m.route.loader&&!g.hasOwnProperty(m.route.id)&&(!v||v[m.route.id]===void 0);if(m.route.lazy||j){u=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}return l.reduceRight((p,m,g)=>{let v,j=!1,N=null,b=null;n&&(v=c&&m.route.id?c[m.route.id]:void 0,N=m.route.errorElement||uw,u&&(f<0&&g===0?(u0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),j=!0,b=null):f===g&&(j=!0,b=m.route.hydrateFallbackElement||null)));let w=s.concat(l.slice(0,g+1)),C=()=>{let T;return v?T=N:j?T=b:m.route.Component?T=x.createElement(m.route.Component,null):m.route.element?T=m.route.element:T=p,x.createElement(fw,{match:m,routeContext:{outlet:p,matches:w,isDataRoute:n!=null},children:T})};return n&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?x.createElement(hw,{location:n.location,revalidation:n.revalidation,component:N,error:v,children:C(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):C()},null)}function Ym(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function pw(t){let s=x.useContext(Nl);return Ct(s,Ym(t)),s}function gw(t){let s=x.useContext(uu);return Ct(s,Ym(t)),s}function yw(t){let s=x.useContext(wa);return Ct(s,Ym(t)),s}function Vm(t){let s=yw(t),n=s.matches[s.matches.length-1];return Ct(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function vw(){return Vm("useRouteId")}function xw(){var i;let t=x.useContext(Hm),s=gw("useRouteError"),n=Vm("useRouteError");return t!==void 0?t:(i=s.errors)==null?void 0:i[n]}function jw(){let{router:t}=pw("useNavigate"),s=Vm("useNavigate"),n=x.useRef(!1);return c0(()=>{n.current=!0}),x.useCallback(async(l,c={})=>{Na(n.current,o0),n.current&&(typeof l=="number"?t.navigate(l):await t.navigate(l,{fromRouteId:s,...c}))},[t,s])}var ox={};function u0(t,s,n){!s&&!ox[t]&&(ox[t]=!0,Na(!1,n))}x.memo(bw);function bw({routes:t,future:s,state:n}){return d0(t,void 0,n,s)}function eu({to:t,replace:s,state:n,relative:i}){Ct(Sl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=x.useContext(Ba);Na(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=x.useContext(wa),{pathname:u}=ys(),f=Ot(),p=qm(t,Pm(c),u,i==="path"),m=JSON.stringify(p);return x.useEffect(()=>{f(JSON.parse(m),{replace:s,state:n,relative:i})},[f,m,i,s,n]),null}function wl(t){return ow(t.context)}function ut(t){Ct(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Nw({basename:t="/",children:s=null,location:n,navigationType:i="POP",navigator:l,static:c=!1}){Ct(!Sl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=t.replace(/^\/*/,"/"),f=x.useMemo(()=>({basename:u,navigator:l,static:c,future:{}}),[u,l,c]);typeof n=="string"&&(n=bl(n));let{pathname:p="/",search:m="",hash:g="",state:v=null,key:j="default"}=n,N=x.useMemo(()=>{let b=_n(p,u);return b==null?null:{location:{pathname:b,search:m,hash:g,state:v,key:j},navigationType:i}},[u,p,m,g,v,j,i]);return Na(N!=null,`<Router basename="${u}"> is not able to match the URL "${p}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),N==null?null:x.createElement(Ba.Provider,{value:f},x.createElement(Jo.Provider,{children:s,value:N}))}function Sw({children:t,location:s}){return cw(pm(t),s)}function pm(t,s=[]){let n=[];return x.Children.forEach(t,(i,l)=>{if(!x.isValidElement(i))return;let c=[...s,l];if(i.type===x.Fragment){n.push.apply(n,pm(i.props.children,c));return}Ct(i.type===ut,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ct(!i.props.index||!i.props.children,"An index route cannot have child routes.");let u={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(u.children=pm(i.props.children,c)),n.push(u)}),n}var Rd="get",Md="application/x-www-form-urlencoded";function hu(t){return t!=null&&typeof t.tagName=="string"}function ww(t){return hu(t)&&t.tagName.toLowerCase()==="button"}function Tw(t){return hu(t)&&t.tagName.toLowerCase()==="form"}function Ew(t){return hu(t)&&t.tagName.toLowerCase()==="input"}function Cw(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Aw(t,s){return t.button===0&&(!s||s==="_self")&&!Cw(t)}function gm(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,n)=>{let i=t[n];return s.concat(Array.isArray(i)?i.map(l=>[n,l]):[[n,i]])},[]))}function Dw(t,s){let n=gm(t);return s&&s.forEach((i,l)=>{n.has(l)||s.getAll(l).forEach(c=>{n.append(l,c)})}),n}var Nd=null;function kw(){if(Nd===null)try{new FormData(document.createElement("form"),0),Nd=!1}catch{Nd=!0}return Nd}var _w=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qf(t){return t!=null&&!_w.has(t)?(Na(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Md}"`),null):t}function Ow(t,s){let n,i,l,c,u;if(Tw(t)){let f=t.getAttribute("action");i=f?_n(f,s):null,n=t.getAttribute("method")||Rd,l=qf(t.getAttribute("enctype"))||Md,c=new FormData(t)}else if(ww(t)||Ew(t)&&(t.type==="submit"||t.type==="image")){let f=t.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=t.getAttribute("formaction")||f.getAttribute("action");if(i=p?_n(p,s):null,n=t.getAttribute("formmethod")||f.getAttribute("method")||Rd,l=qf(t.getAttribute("formenctype"))||qf(f.getAttribute("enctype"))||Md,c=new FormData(f,t),!kw()){let{name:m,type:g,value:v}=t;if(g==="image"){let j=m?`${m}.`:"";c.append(`${j}x`,"0"),c.append(`${j}y`,"0")}else m&&c.append(m,v)}}else{if(hu(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Rd,i=null,l=Md,u=t}return c&&l==="text/plain"&&(u=c,c=void 0),{action:i,method:n.toLowerCase(),encType:l,formData:c,body:u}}function Gm(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}async function Iw(t,s){if(t.id in s)return s[t.id];try{let n=await import(t.module);return s[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function $w(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Rw(t,s,n){let i=await Promise.all(t.map(async l=>{let c=s.routes[l.route.id];if(c){let u=await Iw(c,n);return u.links?u.links():[]}return[]}));return Bw(i.flat(1).filter($w).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function cx(t,s,n,i,l,c){let u=(p,m)=>n[m]?p.route.id!==n[m].route.id:!0,f=(p,m)=>{var g;return n[m].pathname!==p.pathname||((g=n[m].route.path)==null?void 0:g.endsWith("*"))&&n[m].params["*"]!==p.params["*"]};return c==="assets"?s.filter((p,m)=>u(p,m)||f(p,m)):c==="data"?s.filter((p,m)=>{var v;let g=i.routes[p.route.id];if(!g||!g.hasLoader)return!1;if(u(p,m)||f(p,m))return!0;if(p.route.shouldRevalidate){let j=p.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:((v=n[0])==null?void 0:v.params)||{},nextUrl:new URL(t,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof j=="boolean")return j}return!0}):[]}function Mw(t,s,{includeHydrateFallback:n}={}){return zw(t.map(i=>{let l=s.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),n&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function zw(t){return[...new Set(t)]}function Lw(t){let s={},n=Object.keys(t).sort();for(let i of n)s[i]=t[i];return s}function Bw(t,s){let n=new Set;return new Set(s),t.reduce((i,l)=>{let c=JSON.stringify(Lw(l));return n.has(c)||(n.add(c),i.push({key:c,link:l})),i},[])}function Fw(t,s){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":s&&_n(n.pathname,s)==="/"?n.pathname=`${s.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function h0(){let t=x.useContext(Nl);return Gm(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Uw(){let t=x.useContext(uu);return Gm(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Qm=x.createContext(void 0);Qm.displayName="FrameworkContext";function f0(){let t=x.useContext(Qm);return Gm(t,"You must render this element inside a <HydratedRouter> element"),t}function Pw(t,s){let n=x.useContext(Qm),[i,l]=x.useState(!1),[c,u]=x.useState(!1),{onFocus:f,onBlur:p,onMouseEnter:m,onMouseLeave:g,onTouchStart:v}=s,j=x.useRef(null);x.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let w=T=>{T.forEach(A=>{u(A.isIntersecting)})},C=new IntersectionObserver(w,{threshold:.5});return j.current&&C.observe(j.current),()=>{C.disconnect()}}},[t]),x.useEffect(()=>{if(i){let w=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(w)}}},[i]);let N=()=>{l(!0)},b=()=>{l(!1),u(!1)};return n?t!=="intent"?[c,j,{}]:[c,j,{onFocus:ko(f,N),onBlur:ko(p,b),onMouseEnter:ko(m,N),onMouseLeave:ko(g,b),onTouchStart:ko(v,N)}]:[!1,j,{}]}function ko(t,s){return n=>{t&&t(n),n.defaultPrevented||s(n)}}function qw({page:t,...s}){let{router:n}=h0(),i=x.useMemo(()=>a0(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?x.createElement(Yw,{page:t,matches:i,...s}):null}function Hw(t){let{manifest:s,routeModules:n}=f0(),[i,l]=x.useState([]);return x.useEffect(()=>{let c=!1;return Rw(t,s,n).then(u=>{c||l(u)}),()=>{c=!0}},[t,s,n]),i}function Yw({page:t,matches:s,...n}){let i=ys(),{manifest:l,routeModules:c}=f0(),{basename:u}=h0(),{loaderData:f,matches:p}=Uw(),m=x.useMemo(()=>cx(t,s,p,l,i,"data"),[t,s,p,l,i]),g=x.useMemo(()=>cx(t,s,p,l,i,"assets"),[t,s,p,l,i]),v=x.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let b=new Set,w=!1;if(s.forEach(T=>{var _;let A=l.routes[T.route.id];!A||!A.hasLoader||(!m.some(D=>D.route.id===T.route.id)&&T.route.id in f&&((_=c[T.route.id])!=null&&_.shouldRevalidate)||A.hasClientLoader?w=!0:b.add(T.route.id))}),b.size===0)return[];let C=Fw(t,u);return w&&b.size>0&&C.searchParams.set("_routes",s.filter(T=>b.has(T.route.id)).map(T=>T.route.id).join(",")),[C.pathname+C.search]},[u,f,i,l,m,s,t,c]),j=x.useMemo(()=>Mw(g,l),[g,l]),N=Hw(g);return x.createElement(x.Fragment,null,v.map(b=>x.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...n})),j.map(b=>x.createElement("link",{key:b,rel:"modulepreload",href:b,...n})),N.map(({key:b,link:w})=>x.createElement("link",{key:b,...w})))}function Vw(...t){return s=>{t.forEach(n=>{typeof n=="function"?n(s):n!=null&&(n.current=s)})}}var m0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{m0&&(window.__reactRouterVersion="7.4.0")}catch{}function Gw({basename:t,children:s,window:n}){let i=x.useRef();i.current==null&&(i.current=I1({window:n,v5Compat:!0}));let l=i.current,[c,u]=x.useState({action:l.action,location:l.location}),f=x.useCallback(p=>{x.startTransition(()=>u(p))},[u]);return x.useLayoutEffect(()=>l.listen(f),[l,f]),x.createElement(Nw,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:l})}var p0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Wr=x.forwardRef(function({onClick:s,discover:n="render",prefetch:i="none",relative:l,reloadDocument:c,replace:u,state:f,target:p,to:m,preventScrollReset:g,viewTransition:v,...j},N){let{basename:b}=x.useContext(Ba),w=typeof m=="string"&&p0.test(m),C,T=!1;if(typeof m=="string"&&w&&(C=m,m0))try{let I=new URL(window.location.href),M=m.startsWith("//")?new URL(I.protocol+m):new URL(m),z=_n(M.pathname,b);M.origin===I.origin&&z!=null?m=z+M.search+M.hash:T=!0}catch{Na(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=rw(m,{relative:l}),[_,D,S]=Pw(i,j),R=Ww(m,{replace:u,state:f,target:p,preventScrollReset:g,relative:l,viewTransition:v});function E(I){s&&s(I),I.defaultPrevented||R(I)}let k=x.createElement("a",{...j,...S,href:C||A,onClick:T||c?s:E,ref:Vw(N,D),target:p,"data-discover":!w&&n==="render"?"true":void 0});return _&&!w?x.createElement(x.Fragment,null,k,x.createElement(qw,{page:A})):k});Wr.displayName="Link";var Qw=x.forwardRef(function({"aria-current":s="page",caseSensitive:n=!1,className:i="",end:l=!1,style:c,to:u,viewTransition:f,children:p,...m},g){let v=ec(u,{relative:m.relative}),j=ys(),N=x.useContext(uu),{navigator:b,basename:w}=x.useContext(Ba),C=N!=null&&sT(v)&&f===!0,T=b.encodeLocation?b.encodeLocation(v).pathname:v.pathname,A=j.pathname,_=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;n||(A=A.toLowerCase(),_=_?_.toLowerCase():null,T=T.toLowerCase()),_&&w&&(_=_n(_,w)||_);const D=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let S=A===T||!l&&A.startsWith(T)&&A.charAt(D)==="/",R=_!=null&&(_===T||!l&&_.startsWith(T)&&_.charAt(T.length)==="/"),E={isActive:S,isPending:R,isTransitioning:C},k=S?s:void 0,I;typeof i=="function"?I=i(E):I=[i,S?"active":null,R?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let M=typeof c=="function"?c(E):c;return x.createElement(Wr,{...m,"aria-current":k,className:I,ref:g,style:M,to:u,viewTransition:f},typeof p=="function"?p(E):p)});Qw.displayName="NavLink";var Xw=x.forwardRef(({discover:t="render",fetcherKey:s,navigate:n,reloadDocument:i,replace:l,state:c,method:u=Rd,action:f,onSubmit:p,relative:m,preventScrollReset:g,viewTransition:v,...j},N)=>{let b=eT(),w=tT(f,{relative:m}),C=u.toLowerCase()==="get"?"get":"post",T=typeof f=="string"&&p0.test(f),A=_=>{if(p&&p(_),_.defaultPrevented)return;_.preventDefault();let D=_.nativeEvent.submitter,S=(D==null?void 0:D.getAttribute("formmethod"))||u;b(D||_.currentTarget,{fetcherKey:s,method:S,navigate:n,replace:l,state:c,relative:m,preventScrollReset:g,viewTransition:v})};return x.createElement("form",{ref:N,method:C,action:w,onSubmit:i?p:A,...j,"data-discover":!T&&t==="render"?"true":void 0})});Xw.displayName="Form";function Zw(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function g0(t){let s=x.useContext(Nl);return Ct(s,Zw(t)),s}function Ww(t,{target:s,replace:n,state:i,preventScrollReset:l,relative:c,viewTransition:u}={}){let f=Ot(),p=ys(),m=ec(t,{relative:c});return x.useCallback(g=>{if(Aw(g,s)){g.preventDefault();let v=n!==void 0?n:Lo(p)===Lo(m);f(t,{replace:v,state:i,preventScrollReset:l,relative:c,viewTransition:u})}},[p,f,m,n,i,s,t,l,c,u])}function y0(t){Na(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let s=x.useRef(gm(t)),n=x.useRef(!1),i=ys(),l=x.useMemo(()=>Dw(i.search,n.current?null:s.current),[i.search]),c=Ot(),u=x.useCallback((f,p)=>{const m=gm(typeof f=="function"?f(l):f);n.current=!0,c("?"+m,p)},[c,l]);return[l,u]}var Kw=0,Jw=()=>`__${String(++Kw)}__`;function eT(){let{router:t}=g0("useSubmit"),{basename:s}=x.useContext(Ba),n=vw();return x.useCallback(async(i,l={})=>{let{action:c,method:u,encType:f,formData:p,body:m}=Ow(i,s);if(l.navigate===!1){let g=l.fetcherKey||Jw();await t.fetch(g,n,l.action||c,{preventScrollReset:l.preventScrollReset,formData:p,body:m,formMethod:l.method||u,formEncType:l.encType||f,flushSync:l.flushSync})}else await t.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:p,body:m,formMethod:l.method||u,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[t,s,n])}function tT(t,{relative:s}={}){let{basename:n}=x.useContext(Ba),i=x.useContext(wa);Ct(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...ec(t||".",{relative:s})},u=ys();if(t==null){c.search=u.search;let f=new URLSearchParams(c.search),p=f.getAll("index");if(p.some(g=>g==="")){f.delete("index"),p.filter(v=>v).forEach(v=>f.append("index",v));let g=f.toString();c.search=g?`?${g}`:""}}return(!t||t===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(c.pathname=c.pathname==="/"?n:An([n,c.pathname])),Lo(c)}function sT(t,s={}){let n=x.useContext(l0);Ct(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=g0("useViewTransitionState"),l=ec(t,{relative:s.relative});if(!n.isTransitioning)return!1;let c=_n(n.currentLocation.pathname,i)||n.currentLocation.pathname,u=_n(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Jd(l.pathname,u)!=null||Jd(l.pathname,c)!=null}new TextEncoder;var aT=s0();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),v0=(...t)=>t.filter((s,n,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===n).join(" ").trim();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=x.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:u,...f},p)=>x.createElement("svg",{ref:p,...rT,width:s,height:s,stroke:t,strokeWidth:i?Number(n)*24/Number(s):n,className:v0("lucide",l),...f},[...u.map(([m,g])=>x.createElement(m,g)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=(t,s)=>{const n=x.forwardRef(({className:i,...l},c)=>x.createElement(iT,{ref:c,iconNode:s,className:v0(`lucide-${nT(t)}`,i),...l}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Bs=Re("ArrowLeft",lT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],dx=Re("ArrowRight",oT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ms=Re("Award",cT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Vt=Re("BookOpen",dT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],ux=Re("Building2",uT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],hx=Re("Calculator",hT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],mT=Re("CalendarDays",fT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],$e=Re("Calendar",pT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ym=Re("ChartColumn",gT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Bo=Re("Check",yT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],gt=Re("ChevronDown",vT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],x0=Re("ChevronLeft",xT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xm=Re("ChevronRight",jT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ft=Re("ChevronUp",bT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Us=Re("CircleAlert",NT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Et=Re("CircleCheckBig",ST);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ro=Re("CircleX",wT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Sd=Re("Circle",TT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Ve=Re("Clock",ET);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],AT=Re("Copy",CT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],kT=Re("Database",DT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _T=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],OT=Re("Download",_T);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],$T=Re("Ellipsis",IT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],vm=Re("ExternalLink",RT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ni=Re("EyeOff",MT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ba=Re("Eye",zT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],BT=Re("FilePenLine",LT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],tc=Re("FileText",FT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],hi=Re("Funnel",UT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],pr=Re("GraduationCap",PT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],$o=Re("Info",qT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HT=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],YT=Re("Link",HT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VT=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],mr=Re("Lock",VT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],QT=Re("LogOut",GT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XT=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],On=Re("Mail",XT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZT=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],vt=Re("MapPin",ZT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],Hf=Re("Moon",WT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],fx=Re("Music2",KT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],Je=Re("Music",JT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eE=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],fu=Re("PenLine",eE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tE=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Fo=Re("Pen",tE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],fi=Re("Phone",sE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ls=Re("Plus",aE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nE=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Yt=Re("RefreshCw",nE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rE=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],xm=Re("Repeat",rE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iE=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Uo=Re("RotateCcw",iE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],sc=Re("Save",lE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],gr=Re("Search",oE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cE=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],j0=Re("Shield",cE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dE=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Sa=Re("SquarePen",dE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uE=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],In=Re("Star",uE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hE=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Yf=Re("Sun",hE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],mE=Re("Target",fE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pE=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],_t=Re("Trash2",pE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gE=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],zd=Re("TrendingDown",gE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yE=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],ll=Re("TrendingUp",yE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vE=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],yr=Re("TriangleAlert",vE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xE=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],jE=Re("Undo",xE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bE=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],NE=Re("Upload",bE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],wE=Re("UserCheck",SE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],EE=Re("UserPlus",TE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],AE=Re("UserX",CE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DE=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],We=Re("User",DE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],ps=Re("Users",kE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _E=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],yt=Re("X",_E);var ac=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},mu=typeof window>"u"||"Deno"in globalThis;function _a(){}function OE(t,s){return typeof t=="function"?t(s):t}function IE(t){return typeof t=="number"&&t>=0&&t!==1/0}function $E(t,s){return Math.max(t+(s||0)-Date.now(),0)}function mx(t,s){return typeof t=="function"?t(s):t}function RE(t,s){return typeof t=="function"?t(s):t}function px(t,s){const{type:n="all",exact:i,fetchStatus:l,predicate:c,queryKey:u,stale:f}=t;if(u){if(i){if(s.queryHash!==Zm(u,s.options))return!1}else if(!Po(s.queryKey,u))return!1}if(n!=="all"){const p=s.isActive();if(n==="active"&&!p||n==="inactive"&&p)return!1}return!(typeof f=="boolean"&&s.isStale()!==f||l&&l!==s.state.fetchStatus||c&&!c(s))}function gx(t,s){const{exact:n,status:i,predicate:l,mutationKey:c}=t;if(c){if(!s.options.mutationKey)return!1;if(n){if(ci(s.options.mutationKey)!==ci(c))return!1}else if(!Po(s.options.mutationKey,c))return!1}return!(i&&s.state.status!==i||l&&!l(s))}function Zm(t,s){return((s==null?void 0:s.queryKeyHashFn)||ci)(t)}function ci(t){return JSON.stringify(t,(s,n)=>jm(n)?Object.keys(n).sort().reduce((i,l)=>(i[l]=n[l],i),{}):n)}function Po(t,s){return t===s?!0:typeof t!=typeof s?!1:t&&s&&typeof t=="object"&&typeof s=="object"?!Object.keys(s).some(n=>!Po(t[n],s[n])):!1}function b0(t,s){if(t===s)return t;const n=yx(t)&&yx(s);if(n||jm(t)&&jm(s)){const i=n?t:Object.keys(t),l=i.length,c=n?s:Object.keys(s),u=c.length,f=n?[]:{};let p=0;for(let m=0;m<u;m++){const g=n?m:c[m];(!n&&i.includes(g)||n)&&t[g]===void 0&&s[g]===void 0?(f[g]=void 0,p++):(f[g]=b0(t[g],s[g]),f[g]===t[g]&&t[g]!==void 0&&p++)}return l===u&&p===l?t:f}return s}function ME(t,s){if(!s||Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}function yx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function jm(t){if(!vx(t))return!1;const s=t.constructor;if(s===void 0)return!0;const n=s.prototype;return!(!vx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function vx(t){return Object.prototype.toString.call(t)==="[object Object]"}function zE(t){return new Promise(s=>{setTimeout(s,t)})}function LE(t,s,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,s):n.structuralSharing!==!1?b0(t,s):s}function BE(t,s,n=0){const i=[...t,s];return n&&i.length>n?i.slice(1):i}function FE(t,s,n=0){const i=[s,...t];return n&&i.length>n?i.slice(0,-1):i}var Wm=Symbol();function N0(t,s){return!t.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!t.queryFn||t.queryFn===Wm?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Jr,lr,ul,Gj,UE=(Gj=class extends ac{constructor(){super();tt(this,Jr);tt(this,lr);tt(this,ul);Ye(this,ul,s=>{if(!mu&&window.addEventListener){const n=()=>s();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){ye(this,lr)||this.setEventListener(ye(this,ul))}onUnsubscribe(){var s;this.hasListeners()||((s=ye(this,lr))==null||s.call(this),Ye(this,lr,void 0))}setEventListener(s){var n;Ye(this,ul,s),(n=ye(this,lr))==null||n.call(this),Ye(this,lr,s(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(s){ye(this,Jr)!==s&&(Ye(this,Jr,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(n=>{n(s)})}isFocused(){var s;return typeof ye(this,Jr)=="boolean"?ye(this,Jr):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},Jr=new WeakMap,lr=new WeakMap,ul=new WeakMap,Gj),S0=new UE,hl,or,fl,Qj,PE=(Qj=class extends ac{constructor(){super();tt(this,hl,!0);tt(this,or);tt(this,fl);Ye(this,fl,s=>{if(!mu&&window.addEventListener){const n=()=>s(!0),i=()=>s(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){ye(this,or)||this.setEventListener(ye(this,fl))}onUnsubscribe(){var s;this.hasListeners()||((s=ye(this,or))==null||s.call(this),Ye(this,or,void 0))}setEventListener(s){var n;Ye(this,fl,s),(n=ye(this,or))==null||n.call(this),Ye(this,or,s(this.setOnline.bind(this)))}setOnline(s){ye(this,hl)!==s&&(Ye(this,hl,s),this.listeners.forEach(i=>{i(s)}))}isOnline(){return ye(this,hl)}},hl=new WeakMap,or=new WeakMap,fl=new WeakMap,Qj),tu=new PE;function qE(){let t,s;const n=new Promise((l,c)=>{t=l,s=c});n.status="pending",n.catch(()=>{});function i(l){Object.assign(n,l),delete n.resolve,delete n.reject}return n.resolve=l=>{i({status:"fulfilled",value:l}),t(l)},n.reject=l=>{i({status:"rejected",reason:l}),s(l)},n}function HE(t){return Math.min(1e3*2**t,3e4)}function w0(t){return(t??"online")==="online"?tu.isOnline():!0}var T0=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Vf(t){return t instanceof T0}function E0(t){let s=!1,n=0,i=!1,l;const c=qE(),u=w=>{var C;i||(j(new T0(w)),(C=t.abort)==null||C.call(t))},f=()=>{s=!0},p=()=>{s=!1},m=()=>S0.isFocused()&&(t.networkMode==="always"||tu.isOnline())&&t.canRun(),g=()=>w0(t.networkMode)&&t.canRun(),v=w=>{var C;i||(i=!0,(C=t.onSuccess)==null||C.call(t,w),l==null||l(),c.resolve(w))},j=w=>{var C;i||(i=!0,(C=t.onError)==null||C.call(t,w),l==null||l(),c.reject(w))},N=()=>new Promise(w=>{var C;l=T=>{(i||m())&&w(T)},(C=t.onPause)==null||C.call(t)}).then(()=>{var w;l=void 0,i||(w=t.onContinue)==null||w.call(t)}),b=()=>{if(i)return;let w;const C=n===0?t.initialPromise:void 0;try{w=C??t.fn()}catch(T){w=Promise.reject(T)}Promise.resolve(w).then(v).catch(T=>{var R;if(i)return;const A=t.retry??(mu?0:3),_=t.retryDelay??HE,D=typeof _=="function"?_(n,T):_,S=A===!0||typeof A=="number"&&n<A||typeof A=="function"&&A(n,T);if(s||!S){j(T);return}n++,(R=t.onFail)==null||R.call(t,n,T),zE(D).then(()=>m()?void 0:N()).then(()=>{s?j(T):b()})})};return{promise:c,cancel:u,continue:()=>(l==null||l(),c),cancelRetry:f,continueRetry:p,canStart:g,start:()=>(g()?b():N().then(b),c)}}function YE(){let t=[],s=0,n=f=>{f()},i=f=>{f()},l=f=>setTimeout(f,0);const c=f=>{s?t.push(f):l(()=>{n(f)})},u=()=>{const f=t;t=[],f.length&&l(()=>{i(()=>{f.forEach(p=>{n(p)})})})};return{batch:f=>{let p;s++;try{p=f()}finally{s--,s||u()}return p},batchCalls:f=>(...p)=>{c(()=>{f(...p)})},schedule:c,setNotifyFunction:f=>{n=f},setBatchNotifyFunction:f=>{i=f},setScheduler:f=>{l=f}}}var fs=YE(),ei,Xj,C0=(Xj=class{constructor(){tt(this,ei)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),IE(this.gcTime)&&Ye(this,ei,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(mu?1/0:5*60*1e3))}clearGcTimeout(){ye(this,ei)&&(clearTimeout(ye(this,ei)),Ye(this,ei,void 0))}},ei=new WeakMap,Xj),ml,pl,xa,ti,ws,Wo,si,Oa,Nn,Zj,VE=(Zj=class extends C0{constructor(s){super();tt(this,Oa);tt(this,ml);tt(this,pl);tt(this,xa);tt(this,ti);tt(this,ws);tt(this,Wo);tt(this,si);Ye(this,si,!1),Ye(this,Wo,s.defaultOptions),this.setOptions(s.options),this.observers=[],Ye(this,ti,s.client),Ye(this,xa,ye(this,ti).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,Ye(this,ml,QE(this.options)),this.state=s.state??ye(this,ml),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=ye(this,ws))==null?void 0:s.promise}setOptions(s){this.options={...ye(this,Wo),...s},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ye(this,xa).remove(this)}setData(s,n){const i=LE(this.state.data,s,this.options);return Ht(this,Oa,Nn).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(s,n){Ht(this,Oa,Nn).call(this,{type:"setState",state:s,setStateOptions:n})}cancel(s){var i,l;const n=(i=ye(this,ws))==null?void 0:i.promise;return(l=ye(this,ws))==null||l.cancel(s),n?n.then(_a).catch(_a):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ye(this,ml))}isActive(){return this.observers.some(s=>RE(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Wm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(s=0){return this.state.isInvalidated||this.state.data===void 0||!$E(this.state.dataUpdatedAt,s)}onFocus(){var n;const s=this.observers.find(i=>i.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(n=ye(this,ws))==null||n.continue()}onOnline(){var n;const s=this.observers.find(i=>i.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(n=ye(this,ws))==null||n.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),ye(this,xa).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(n=>n!==s),this.observers.length||(ye(this,ws)&&(ye(this,si)?ye(this,ws).cancel({revert:!0}):ye(this,ws).cancelRetry()),this.scheduleGc()),ye(this,xa).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ht(this,Oa,Nn).call(this,{type:"invalidate"})}fetch(s,n){var p,m,g;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(ye(this,ws))return ye(this,ws).continueRetry(),ye(this,ws).promise}if(s&&this.setOptions(s),!this.options.queryFn){const v=this.observers.find(j=>j.options.queryFn);v&&this.setOptions(v.options)}const i=new AbortController,l=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(Ye(this,si,!0),i.signal)})},c=()=>{const v=N0(this.options,n),j={client:ye(this,ti),queryKey:this.queryKey,meta:this.meta};return l(j),Ye(this,si,!1),this.options.persister?this.options.persister(v,j,this):v(j)},u={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:ye(this,ti),state:this.state,fetchFn:c};l(u),(p=this.options.behavior)==null||p.onFetch(u,this),Ye(this,pl,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((m=u.fetchOptions)==null?void 0:m.meta))&&Ht(this,Oa,Nn).call(this,{type:"fetch",meta:(g=u.fetchOptions)==null?void 0:g.meta});const f=v=>{var j,N,b,w;Vf(v)&&v.silent||Ht(this,Oa,Nn).call(this,{type:"error",error:v}),Vf(v)||((N=(j=ye(this,xa).config).onError)==null||N.call(j,v,this),(w=(b=ye(this,xa).config).onSettled)==null||w.call(b,this.state.data,v,this)),this.scheduleGc()};return Ye(this,ws,E0({initialPromise:n==null?void 0:n.initialPromise,fn:u.fetchFn,abort:i.abort.bind(i),onSuccess:v=>{var j,N,b,w;if(v===void 0){f(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(v)}catch(C){f(C);return}(N=(j=ye(this,xa).config).onSuccess)==null||N.call(j,v,this),(w=(b=ye(this,xa).config).onSettled)==null||w.call(b,v,this.state.error,this),this.scheduleGc()},onError:f,onFail:(v,j)=>{Ht(this,Oa,Nn).call(this,{type:"failed",failureCount:v,error:j})},onPause:()=>{Ht(this,Oa,Nn).call(this,{type:"pause"})},onContinue:()=>{Ht(this,Oa,Nn).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0})),ye(this,ws).start()}},ml=new WeakMap,pl=new WeakMap,xa=new WeakMap,ti=new WeakMap,ws=new WeakMap,Wo=new WeakMap,si=new WeakMap,Oa=new WeakSet,Nn=function(s){const n=i=>{switch(s.type){case"failed":return{...i,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...GE(i.data,this.options),fetchMeta:s.meta??null};case"success":return{...i,data:s.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:s.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=s.error;return Vf(l)&&l.revert&&ye(this,pl)?{...ye(this,pl),fetchStatus:"idle"}:{...i,error:l,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...s.state}}};this.state=n(this.state),fs.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),ye(this,xa).notify({query:this,type:"updated",action:s})})},Zj);function GE(t,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:w0(s.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function QE(t){const s=typeof t.initialData=="function"?t.initialData():t.initialData,n=s!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Wa,Wj,XE=(Wj=class extends ac{constructor(s={}){super();tt(this,Wa);this.config=s,Ye(this,Wa,new Map)}build(s,n,i){const l=n.queryKey,c=n.queryHash??Zm(l,n);let u=this.get(c);return u||(u=new VE({client:s,queryKey:l,queryHash:c,options:s.defaultQueryOptions(n),state:i,defaultOptions:s.getQueryDefaults(l)}),this.add(u)),u}add(s){ye(this,Wa).has(s.queryHash)||(ye(this,Wa).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const n=ye(this,Wa).get(s.queryHash);n&&(s.destroy(),n===s&&ye(this,Wa).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){fs.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return ye(this,Wa).get(s)}getAll(){return[...ye(this,Wa).values()]}find(s){const n={exact:!0,...s};return this.getAll().find(i=>px(n,i))}findAll(s={}){const n=this.getAll();return Object.keys(s).length>0?n.filter(i=>px(s,i)):n}notify(s){fs.batch(()=>{this.listeners.forEach(n=>{n(s)})})}onFocus(){fs.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){fs.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},Wa=new WeakMap,Wj),Ka,As,ai,Ja,rr,Kj,ZE=(Kj=class extends C0{constructor(s){super();tt(this,Ja);tt(this,Ka);tt(this,As);tt(this,ai);this.mutationId=s.mutationId,Ye(this,As,s.mutationCache),Ye(this,Ka,[]),this.state=s.state||A0(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){ye(this,Ka).includes(s)||(ye(this,Ka).push(s),this.clearGcTimeout(),ye(this,As).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){Ye(this,Ka,ye(this,Ka).filter(n=>n!==s)),this.scheduleGc(),ye(this,As).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){ye(this,Ka).length||(this.state.status==="pending"?this.scheduleGc():ye(this,As).remove(this))}continue(){var s;return((s=ye(this,ai))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var l,c,u,f,p,m,g,v,j,N,b,w,C,T,A,_,D,S,R,E;Ye(this,ai,E0({fn:()=>this.options.mutationFn?this.options.mutationFn(s):Promise.reject(new Error("No mutationFn found")),onFail:(k,I)=>{Ht(this,Ja,rr).call(this,{type:"failed",failureCount:k,error:I})},onPause:()=>{Ht(this,Ja,rr).call(this,{type:"pause"})},onContinue:()=>{Ht(this,Ja,rr).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ye(this,As).canRun(this)}));const n=this.state.status==="pending",i=!ye(this,ai).canStart();try{if(!n){Ht(this,Ja,rr).call(this,{type:"pending",variables:s,isPaused:i}),await((c=(l=ye(this,As).config).onMutate)==null?void 0:c.call(l,s,this));const I=await((f=(u=this.options).onMutate)==null?void 0:f.call(u,s));I!==this.state.context&&Ht(this,Ja,rr).call(this,{type:"pending",context:I,variables:s,isPaused:i})}const k=await ye(this,ai).start();return await((m=(p=ye(this,As).config).onSuccess)==null?void 0:m.call(p,k,s,this.state.context,this)),await((v=(g=this.options).onSuccess)==null?void 0:v.call(g,k,s,this.state.context)),await((N=(j=ye(this,As).config).onSettled)==null?void 0:N.call(j,k,null,this.state.variables,this.state.context,this)),await((w=(b=this.options).onSettled)==null?void 0:w.call(b,k,null,s,this.state.context)),Ht(this,Ja,rr).call(this,{type:"success",data:k}),k}catch(k){try{throw await((T=(C=ye(this,As).config).onError)==null?void 0:T.call(C,k,s,this.state.context,this)),await((_=(A=this.options).onError)==null?void 0:_.call(A,k,s,this.state.context)),await((S=(D=ye(this,As).config).onSettled)==null?void 0:S.call(D,void 0,k,this.state.variables,this.state.context,this)),await((E=(R=this.options).onSettled)==null?void 0:E.call(R,void 0,k,s,this.state.context)),k}finally{Ht(this,Ja,rr).call(this,{type:"error",error:k})}}finally{ye(this,As).runNext(this)}}},Ka=new WeakMap,As=new WeakMap,ai=new WeakMap,Ja=new WeakSet,rr=function(s){const n=i=>{switch(s.type){case"failed":return{...i,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...i,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:s.error,failureCount:i.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=n(this.state),fs.batch(()=>{ye(this,Ka).forEach(i=>{i.onMutationUpdate(s)}),ye(this,As).notify({mutation:this,type:"updated",action:s})})},Kj);function A0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Tn,Ia,Ko,Jj,WE=(Jj=class extends ac{constructor(s={}){super();tt(this,Tn);tt(this,Ia);tt(this,Ko);this.config=s,Ye(this,Tn,new Set),Ye(this,Ia,new Map),Ye(this,Ko,0)}build(s,n,i){const l=new ZE({mutationCache:this,mutationId:++bd(this,Ko)._,options:s.defaultMutationOptions(n),state:i});return this.add(l),l}add(s){ye(this,Tn).add(s);const n=wd(s);if(typeof n=="string"){const i=ye(this,Ia).get(n);i?i.push(s):ye(this,Ia).set(n,[s])}this.notify({type:"added",mutation:s})}remove(s){if(ye(this,Tn).delete(s)){const n=wd(s);if(typeof n=="string"){const i=ye(this,Ia).get(n);if(i)if(i.length>1){const l=i.indexOf(s);l!==-1&&i.splice(l,1)}else i[0]===s&&ye(this,Ia).delete(n)}}this.notify({type:"removed",mutation:s})}canRun(s){const n=wd(s);if(typeof n=="string"){const i=ye(this,Ia).get(n),l=i==null?void 0:i.find(c=>c.state.status==="pending");return!l||l===s}else return!0}runNext(s){var i;const n=wd(s);if(typeof n=="string"){const l=(i=ye(this,Ia).get(n))==null?void 0:i.find(c=>c!==s&&c.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){fs.batch(()=>{ye(this,Tn).forEach(s=>{this.notify({type:"removed",mutation:s})}),ye(this,Tn).clear(),ye(this,Ia).clear()})}getAll(){return Array.from(ye(this,Tn))}find(s){const n={exact:!0,...s};return this.getAll().find(i=>gx(n,i))}findAll(s={}){return this.getAll().filter(n=>gx(s,n))}notify(s){fs.batch(()=>{this.listeners.forEach(n=>{n(s)})})}resumePausedMutations(){const s=this.getAll().filter(n=>n.state.isPaused);return fs.batch(()=>Promise.all(s.map(n=>n.continue().catch(_a))))}},Tn=new WeakMap,Ia=new WeakMap,Ko=new WeakMap,Jj);function wd(t){var s;return(s=t.options.scope)==null?void 0:s.id}function xx(t){return{onFetch:(s,n)=>{var g,v,j,N,b;const i=s.options,l=(j=(v=(g=s.fetchOptions)==null?void 0:g.meta)==null?void 0:v.fetchMore)==null?void 0:j.direction,c=((N=s.state.data)==null?void 0:N.pages)||[],u=((b=s.state.data)==null?void 0:b.pageParams)||[];let f={pages:[],pageParams:[]},p=0;const m=async()=>{let w=!1;const C=_=>{Object.defineProperty(_,"signal",{enumerable:!0,get:()=>(s.signal.aborted?w=!0:s.signal.addEventListener("abort",()=>{w=!0}),s.signal)})},T=N0(s.options,s.fetchOptions),A=async(_,D,S)=>{if(w)return Promise.reject();if(D==null&&_.pages.length)return Promise.resolve(_);const R={client:s.client,queryKey:s.queryKey,pageParam:D,direction:S?"backward":"forward",meta:s.options.meta};C(R);const E=await T(R),{maxPages:k}=s.options,I=S?FE:BE;return{pages:I(_.pages,E,k),pageParams:I(_.pageParams,D,k)}};if(l&&c.length){const _=l==="backward",D=_?KE:jx,S={pages:c,pageParams:u},R=D(i,S);f=await A(S,R,_)}else{const _=t??c.length;do{const D=p===0?u[0]??i.initialPageParam:jx(i,f);if(p>0&&D==null)break;f=await A(f,D),p++}while(p<_)}return f};s.options.persister?s.fetchFn=()=>{var w,C;return(C=(w=s.options).persister)==null?void 0:C.call(w,m,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},n)}:s.fetchFn=m}}}function jx(t,{pages:s,pageParams:n}){const i=s.length-1;return s.length>0?t.getNextPageParam(s[i],s,n[i],n):void 0}function KE(t,{pages:s,pageParams:n}){var i;return s.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,s[0],s,n[0],n):void 0}var Bt,cr,dr,gl,yl,ur,vl,xl,e0,JE=(e0=class{constructor(t={}){tt(this,Bt);tt(this,cr);tt(this,dr);tt(this,gl);tt(this,yl);tt(this,ur);tt(this,vl);tt(this,xl);Ye(this,Bt,t.queryCache||new XE),Ye(this,cr,t.mutationCache||new WE),Ye(this,dr,t.defaultOptions||{}),Ye(this,gl,new Map),Ye(this,yl,new Map),Ye(this,ur,0)}mount(){bd(this,ur)._++,ye(this,ur)===1&&(Ye(this,vl,S0.subscribe(async t=>{t&&(await this.resumePausedMutations(),ye(this,Bt).onFocus())})),Ye(this,xl,tu.subscribe(async t=>{t&&(await this.resumePausedMutations(),ye(this,Bt).onOnline())})))}unmount(){var t,s;bd(this,ur)._--,ye(this,ur)===0&&((t=ye(this,vl))==null||t.call(this),Ye(this,vl,void 0),(s=ye(this,xl))==null||s.call(this),Ye(this,xl,void 0))}isFetching(t){return ye(this,Bt).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return ye(this,cr).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=ye(this,Bt).get(s.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const s=this.defaultQueryOptions(t),n=ye(this,Bt).build(this,s),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(mx(s.staleTime,n))&&this.prefetchQuery(s),Promise.resolve(i))}getQueriesData(t){return ye(this,Bt).findAll(t).map(({queryKey:s,state:n})=>{const i=n.data;return[s,i]})}setQueryData(t,s,n){const i=this.defaultQueryOptions({queryKey:t}),l=ye(this,Bt).get(i.queryHash),c=l==null?void 0:l.state.data,u=OE(s,c);if(u!==void 0)return ye(this,Bt).build(this,i).setData(u,{...n,manual:!0})}setQueriesData(t,s,n){return fs.batch(()=>ye(this,Bt).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,s,n)]))}getQueryState(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=ye(this,Bt).get(s.queryHash))==null?void 0:n.state}removeQueries(t){const s=ye(this,Bt);fs.batch(()=>{s.findAll(t).forEach(n=>{s.remove(n)})})}resetQueries(t,s){const n=ye(this,Bt);return fs.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},s)))}cancelQueries(t,s={}){const n={revert:!0,...s},i=fs.batch(()=>ye(this,Bt).findAll(t).map(l=>l.cancel(n)));return Promise.all(i).then(_a).catch(_a)}invalidateQueries(t,s={}){return fs.batch(()=>(ye(this,Bt).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},s)))}refetchQueries(t,s={}){const n={...s,cancelRefetch:s.cancelRefetch??!0},i=fs.batch(()=>ye(this,Bt).findAll(t).filter(l=>!l.isDisabled()).map(l=>{let c=l.fetch(void 0,n);return n.throwOnError||(c=c.catch(_a)),l.state.fetchStatus==="paused"?Promise.resolve():c}));return Promise.all(i).then(_a)}fetchQuery(t){const s=this.defaultQueryOptions(t);s.retry===void 0&&(s.retry=!1);const n=ye(this,Bt).build(this,s);return n.isStaleByTime(mx(s.staleTime,n))?n.fetch(s):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(_a).catch(_a)}fetchInfiniteQuery(t){return t.behavior=xx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(_a).catch(_a)}ensureInfiniteQueryData(t){return t.behavior=xx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return tu.isOnline()?ye(this,cr).resumePausedMutations():Promise.resolve()}getQueryCache(){return ye(this,Bt)}getMutationCache(){return ye(this,cr)}getDefaultOptions(){return ye(this,dr)}setDefaultOptions(t){Ye(this,dr,t)}setQueryDefaults(t,s){ye(this,gl).set(ci(t),{queryKey:t,defaultOptions:s})}getQueryDefaults(t){const s=[...ye(this,gl).values()],n={};return s.forEach(i=>{Po(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,s){ye(this,yl).set(ci(t),{mutationKey:t,defaultOptions:s})}getMutationDefaults(t){const s=[...ye(this,yl).values()],n={};return s.forEach(i=>{Po(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const s={...ye(this,dr).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return s.queryHash||(s.queryHash=Zm(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===Wm&&(s.enabled=!1),s}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...ye(this,dr).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){ye(this,Bt).clear(),ye(this,cr).clear()}},Bt=new WeakMap,cr=new WeakMap,dr=new WeakMap,gl=new WeakMap,yl=new WeakMap,ur=new WeakMap,vl=new WeakMap,xl=new WeakMap,e0),hr,fr,Rs,En,kn,Ld,bm,t0,e2=(t0=class extends ac{constructor(n,i){super();tt(this,kn);tt(this,hr);tt(this,fr);tt(this,Rs);tt(this,En);Ye(this,hr,n),this.setOptions(i),this.bindMethods(),Ht(this,kn,Ld).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var l;const i=this.options;this.options=ye(this,hr).defaultMutationOptions(n),ME(this.options,i)||ye(this,hr).getMutationCache().notify({type:"observerOptionsUpdated",mutation:ye(this,Rs),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&ci(i.mutationKey)!==ci(this.options.mutationKey)?this.reset():((l=ye(this,Rs))==null?void 0:l.state.status)==="pending"&&ye(this,Rs).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=ye(this,Rs))==null||n.removeObserver(this)}onMutationUpdate(n){Ht(this,kn,Ld).call(this),Ht(this,kn,bm).call(this,n)}getCurrentResult(){return ye(this,fr)}reset(){var n;(n=ye(this,Rs))==null||n.removeObserver(this),Ye(this,Rs,void 0),Ht(this,kn,Ld).call(this),Ht(this,kn,bm).call(this)}mutate(n,i){var l;return Ye(this,En,i),(l=ye(this,Rs))==null||l.removeObserver(this),Ye(this,Rs,ye(this,hr).getMutationCache().build(ye(this,hr),this.options)),ye(this,Rs).addObserver(this),ye(this,Rs).execute(n)}},hr=new WeakMap,fr=new WeakMap,Rs=new WeakMap,En=new WeakMap,kn=new WeakSet,Ld=function(){var i;const n=((i=ye(this,Rs))==null?void 0:i.state)??A0();Ye(this,fr,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},bm=function(n){fs.batch(()=>{var i,l,c,u,f,p,m,g;if(ye(this,En)&&this.hasListeners()){const v=ye(this,fr).variables,j=ye(this,fr).context;(n==null?void 0:n.type)==="success"?((l=(i=ye(this,En)).onSuccess)==null||l.call(i,n.data,v,j),(u=(c=ye(this,En)).onSettled)==null||u.call(c,n.data,null,v,j)):(n==null?void 0:n.type)==="error"&&((p=(f=ye(this,En)).onError)==null||p.call(f,n.error,v,j),(g=(m=ye(this,En)).onSettled)==null||g.call(m,void 0,n.error,v,j))}this.listeners.forEach(v=>{v(ye(this,fr))})})},t0),D0=x.createContext(void 0),k0=t=>{const s=x.useContext(D0);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},t2=({client:t,children:s})=>(x.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(D0.Provider,{value:t,children:s}));function s2(t,s){return typeof t=="function"?t(...s):!!t}function a2(){}function bx(t,s){const n=k0(),[i]=x.useState(()=>new e2(n,t));x.useEffect(()=>{i.setOptions(t)},[i,t]);const l=x.useSyncExternalStore(x.useCallback(u=>i.subscribe(fs.batchCalls(u)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),c=x.useCallback((u,f)=>{i.mutate(u,f).catch(a2)},[i]);if(l.error&&s2(i.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:c,mutateAsync:l.mutate}}const Nx=t=>{let s;const n=new Set,i=(m,g)=>{const v=typeof m=="function"?m(s):m;if(!Object.is(v,s)){const j=s;s=g??(typeof v!="object"||v===null)?v:Object.assign({},s,v),n.forEach(N=>N(s,j))}},l=()=>s,f={setState:i,getState:l,getInitialState:()=>p,subscribe:m=>(n.add(m),()=>n.delete(m))},p=s=t(i,l,f);return f},n2=t=>t?Nx(t):Nx,r2=t=>t;function i2(t,s=r2){const n=oi.useSyncExternalStore(t.subscribe,()=>s(t.getState()),()=>s(t.getInitialState()));return oi.useDebugValue(n),n}const Sx=t=>{const s=n2(t),n=i=>i2(s,i);return Object.assign(n,s),n},Fa=t=>t?Sx(t):Sx;function _0(t,s){return function(){return t.apply(s,arguments)}}const{toString:l2}=Object.prototype,{getPrototypeOf:Km}=Object,pu=(t=>s=>{const n=l2.call(s);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ua=t=>(t=t.toLowerCase(),s=>pu(s)===t),gu=t=>s=>typeof s===t,{isArray:Tl}=Array,qo=gu("undefined");function o2(t){return t!==null&&!qo(t)&&t.constructor!==null&&!qo(t.constructor)&&aa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const O0=Ua("ArrayBuffer");function c2(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&O0(t.buffer),s}const d2=gu("string"),aa=gu("function"),I0=gu("number"),yu=t=>t!==null&&typeof t=="object",u2=t=>t===!0||t===!1,Bd=t=>{if(pu(t)!=="object")return!1;const s=Km(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},h2=Ua("Date"),f2=Ua("File"),m2=Ua("Blob"),p2=Ua("FileList"),g2=t=>yu(t)&&aa(t.pipe),y2=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||aa(t.append)&&((s=pu(t))==="formdata"||s==="object"&&aa(t.toString)&&t.toString()==="[object FormData]"))},v2=Ua("URLSearchParams"),[x2,j2,b2,N2]=["ReadableStream","Request","Response","Headers"].map(Ua),S2=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nc(t,s,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,l;if(typeof t!="object"&&(t=[t]),Tl(t))for(i=0,l=t.length;i<l;i++)s.call(null,t[i],i,t);else{const c=n?Object.getOwnPropertyNames(t):Object.keys(t),u=c.length;let f;for(i=0;i<u;i++)f=c[i],s.call(null,t[f],f,t)}}function $0(t,s){s=s.toLowerCase();const n=Object.keys(t);let i=n.length,l;for(;i-- >0;)if(l=n[i],s===l.toLowerCase())return l;return null}const Kr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,R0=t=>!qo(t)&&t!==Kr;function Nm(){const{caseless:t}=R0(this)&&this||{},s={},n=(i,l)=>{const c=t&&$0(s,l)||l;Bd(s[c])&&Bd(i)?s[c]=Nm(s[c],i):Bd(i)?s[c]=Nm({},i):Tl(i)?s[c]=i.slice():s[c]=i};for(let i=0,l=arguments.length;i<l;i++)arguments[i]&&nc(arguments[i],n);return s}const w2=(t,s,n,{allOwnKeys:i}={})=>(nc(s,(l,c)=>{n&&aa(l)?t[c]=_0(l,n):t[c]=l},{allOwnKeys:i}),t),T2=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),E2=(t,s,n,i)=>{t.prototype=Object.create(s.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),n&&Object.assign(t.prototype,n)},C2=(t,s,n,i)=>{let l,c,u;const f={};if(s=s||{},t==null)return s;do{for(l=Object.getOwnPropertyNames(t),c=l.length;c-- >0;)u=l[c],(!i||i(u,t,s))&&!f[u]&&(s[u]=t[u],f[u]=!0);t=n!==!1&&Km(t)}while(t&&(!n||n(t,s))&&t!==Object.prototype);return s},A2=(t,s,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=s.length;const i=t.indexOf(s,n);return i!==-1&&i===n},D2=t=>{if(!t)return null;if(Tl(t))return t;let s=t.length;if(!I0(s))return null;const n=new Array(s);for(;s-- >0;)n[s]=t[s];return n},k2=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&Km(Uint8Array)),_2=(t,s)=>{const i=(t&&t[Symbol.iterator]).call(t);let l;for(;(l=i.next())&&!l.done;){const c=l.value;s.call(t,c[0],c[1])}},O2=(t,s)=>{let n;const i=[];for(;(n=t.exec(s))!==null;)i.push(n);return i},I2=Ua("HTMLFormElement"),$2=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,l){return i.toUpperCase()+l}),wx=(({hasOwnProperty:t})=>(s,n)=>t.call(s,n))(Object.prototype),R2=Ua("RegExp"),M0=(t,s)=>{const n=Object.getOwnPropertyDescriptors(t),i={};nc(n,(l,c)=>{let u;(u=s(l,c,t))!==!1&&(i[c]=u||l)}),Object.defineProperties(t,i)},M2=t=>{M0(t,(s,n)=>{if(aa(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(aa(i)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},z2=(t,s)=>{const n={},i=l=>{l.forEach(c=>{n[c]=!0})};return Tl(t)?i(t):i(String(t).split(s)),n},L2=()=>{},B2=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function F2(t){return!!(t&&aa(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const U2=t=>{const s=new Array(10),n=(i,l)=>{if(yu(i)){if(s.indexOf(i)>=0)return;if(!("toJSON"in i)){s[l]=i;const c=Tl(i)?[]:{};return nc(i,(u,f)=>{const p=n(u,l+1);!qo(p)&&(c[f]=p)}),s[l]=void 0,c}}return i};return n(t,0)},P2=Ua("AsyncFunction"),q2=t=>t&&(yu(t)||aa(t))&&aa(t.then)&&aa(t.catch),z0=((t,s)=>t?setImmediate:s?((n,i)=>(Kr.addEventListener("message",({source:l,data:c})=>{l===Kr&&c===n&&i.length&&i.shift()()},!1),l=>{i.push(l),Kr.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",aa(Kr.postMessage)),H2=typeof queueMicrotask<"u"?queueMicrotask.bind(Kr):typeof process<"u"&&process.nextTick||z0,xe={isArray:Tl,isArrayBuffer:O0,isBuffer:o2,isFormData:y2,isArrayBufferView:c2,isString:d2,isNumber:I0,isBoolean:u2,isObject:yu,isPlainObject:Bd,isReadableStream:x2,isRequest:j2,isResponse:b2,isHeaders:N2,isUndefined:qo,isDate:h2,isFile:f2,isBlob:m2,isRegExp:R2,isFunction:aa,isStream:g2,isURLSearchParams:v2,isTypedArray:k2,isFileList:p2,forEach:nc,merge:Nm,extend:w2,trim:S2,stripBOM:T2,inherits:E2,toFlatObject:C2,kindOf:pu,kindOfTest:Ua,endsWith:A2,toArray:D2,forEachEntry:_2,matchAll:O2,isHTMLForm:I2,hasOwnProperty:wx,hasOwnProp:wx,reduceDescriptors:M0,freezeMethods:M2,toObjectSet:z2,toCamelCase:$2,noop:L2,toFiniteNumber:B2,findKey:$0,global:Kr,isContextDefined:R0,isSpecCompliantForm:F2,toJSONObject:U2,isAsyncFn:P2,isThenable:q2,setImmediate:z0,asap:H2};function Qe(t,s,n,i,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),n&&(this.config=n),i&&(this.request=i),l&&(this.response=l,this.status=l.status?l.status:null)}xe.inherits(Qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:xe.toJSONObject(this.config),code:this.code,status:this.status}}});const L0=Qe.prototype,B0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{B0[t]={value:t}});Object.defineProperties(Qe,B0);Object.defineProperty(L0,"isAxiosError",{value:!0});Qe.from=(t,s,n,i,l,c)=>{const u=Object.create(L0);return xe.toFlatObject(t,u,function(p){return p!==Error.prototype},f=>f!=="isAxiosError"),Qe.call(u,t.message,s,n,i,l),u.cause=t,u.name=t.name,c&&Object.assign(u,c),u};const Y2=null;function Sm(t){return xe.isPlainObject(t)||xe.isArray(t)}function F0(t){return xe.endsWith(t,"[]")?t.slice(0,-2):t}function Tx(t,s,n){return t?t.concat(s).map(function(l,c){return l=F0(l),!n&&c?"["+l+"]":l}).join(n?".":""):s}function V2(t){return xe.isArray(t)&&!t.some(Sm)}const G2=xe.toFlatObject(xe,{},null,function(s){return/^is[A-Z]/.test(s)});function vu(t,s,n){if(!xe.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,n=xe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,C){return!xe.isUndefined(C[w])});const i=n.metaTokens,l=n.visitor||g,c=n.dots,u=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&xe.isSpecCompliantForm(s);if(!xe.isFunction(l))throw new TypeError("visitor must be a function");function m(b){if(b===null)return"";if(xe.isDate(b))return b.toISOString();if(!p&&xe.isBlob(b))throw new Qe("Blob is not supported. Use a Buffer instead.");return xe.isArrayBuffer(b)||xe.isTypedArray(b)?p&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function g(b,w,C){let T=b;if(b&&!C&&typeof b=="object"){if(xe.endsWith(w,"{}"))w=i?w:w.slice(0,-2),b=JSON.stringify(b);else if(xe.isArray(b)&&V2(b)||(xe.isFileList(b)||xe.endsWith(w,"[]"))&&(T=xe.toArray(b)))return w=F0(w),T.forEach(function(_,D){!(xe.isUndefined(_)||_===null)&&s.append(u===!0?Tx([w],D,c):u===null?w:w+"[]",m(_))}),!1}return Sm(b)?!0:(s.append(Tx(C,w,c),m(b)),!1)}const v=[],j=Object.assign(G2,{defaultVisitor:g,convertValue:m,isVisitable:Sm});function N(b,w){if(!xe.isUndefined(b)){if(v.indexOf(b)!==-1)throw Error("Circular reference detected in "+w.join("."));v.push(b),xe.forEach(b,function(T,A){(!(xe.isUndefined(T)||T===null)&&l.call(s,T,xe.isString(A)?A.trim():A,w,j))===!0&&N(T,w?w.concat(A):[A])}),v.pop()}}if(!xe.isObject(t))throw new TypeError("data must be an object");return N(t),s}function Ex(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return s[i]})}function Jm(t,s){this._pairs=[],t&&vu(t,this,s)}const U0=Jm.prototype;U0.append=function(s,n){this._pairs.push([s,n])};U0.toString=function(s){const n=s?function(i){return s.call(this,i,Ex)}:Ex;return this._pairs.map(function(l){return n(l[0])+"="+n(l[1])},"").join("&")};function Q2(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function P0(t,s,n){if(!s)return t;const i=n&&n.encode||Q2;xe.isFunction(n)&&(n={serialize:n});const l=n&&n.serialize;let c;if(l?c=l(s,n):c=xe.isURLSearchParams(s)?s.toString():new Jm(s,n).toString(i),c){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+c}return t}class Cx{constructor(){this.handlers=[]}use(s,n,i){return this.handlers.push({fulfilled:s,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){xe.forEach(this.handlers,function(i){i!==null&&s(i)})}}const q0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},X2=typeof URLSearchParams<"u"?URLSearchParams:Jm,Z2=typeof FormData<"u"?FormData:null,W2=typeof Blob<"u"?Blob:null,K2={isBrowser:!0,classes:{URLSearchParams:X2,FormData:Z2,Blob:W2},protocols:["http","https","file","blob","url","data"]},ep=typeof window<"u"&&typeof document<"u",wm=typeof navigator=="object"&&navigator||void 0,J2=ep&&(!wm||["ReactNative","NativeScript","NS"].indexOf(wm.product)<0),eC=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",tC=ep&&window.location.href||"http://localhost",sC=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ep,hasStandardBrowserEnv:J2,hasStandardBrowserWebWorkerEnv:eC,navigator:wm,origin:tC},Symbol.toStringTag,{value:"Module"})),Ts={...sC,...K2};function aC(t,s){return vu(t,new Ts.classes.URLSearchParams,Object.assign({visitor:function(n,i,l,c){return Ts.isNode&&xe.isBuffer(n)?(this.append(i,n.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},s))}function nC(t){return xe.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function rC(t){const s={},n=Object.keys(t);let i;const l=n.length;let c;for(i=0;i<l;i++)c=n[i],s[c]=t[c];return s}function H0(t){function s(n,i,l,c){let u=n[c++];if(u==="__proto__")return!0;const f=Number.isFinite(+u),p=c>=n.length;return u=!u&&xe.isArray(l)?l.length:u,p?(xe.hasOwnProp(l,u)?l[u]=[l[u],i]:l[u]=i,!f):((!l[u]||!xe.isObject(l[u]))&&(l[u]=[]),s(n,i,l[u],c)&&xe.isArray(l[u])&&(l[u]=rC(l[u])),!f)}if(xe.isFormData(t)&&xe.isFunction(t.entries)){const n={};return xe.forEachEntry(t,(i,l)=>{s(nC(i),l,n,0)}),n}return null}function iC(t,s,n){if(xe.isString(t))try{return(s||JSON.parse)(t),xe.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const rc={transitional:q0,adapter:["xhr","http","fetch"],transformRequest:[function(s,n){const i=n.getContentType()||"",l=i.indexOf("application/json")>-1,c=xe.isObject(s);if(c&&xe.isHTMLForm(s)&&(s=new FormData(s)),xe.isFormData(s))return l?JSON.stringify(H0(s)):s;if(xe.isArrayBuffer(s)||xe.isBuffer(s)||xe.isStream(s)||xe.isFile(s)||xe.isBlob(s)||xe.isReadableStream(s))return s;if(xe.isArrayBufferView(s))return s.buffer;if(xe.isURLSearchParams(s))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let f;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return aC(s,this.formSerializer).toString();if((f=xe.isFileList(s))||i.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return vu(f?{"files[]":s}:s,p&&new p,this.formSerializer)}}return c||l?(n.setContentType("application/json",!1),iC(s)):s}],transformResponse:[function(s){const n=this.transitional||rc.transitional,i=n&&n.forcedJSONParsing,l=this.responseType==="json";if(xe.isResponse(s)||xe.isReadableStream(s))return s;if(s&&xe.isString(s)&&(i&&!this.responseType||l)){const u=!(n&&n.silentJSONParsing)&&l;try{return JSON.parse(s)}catch(f){if(u)throw f.name==="SyntaxError"?Qe.from(f,Qe.ERR_BAD_RESPONSE,this,null,this.response):f}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ts.classes.FormData,Blob:Ts.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};xe.forEach(["delete","get","head","post","put","patch"],t=>{rc.headers[t]={}});const lC=xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),oC=t=>{const s={};let n,i,l;return t&&t.split(`
`).forEach(function(u){l=u.indexOf(":"),n=u.substring(0,l).trim().toLowerCase(),i=u.substring(l+1).trim(),!(!n||s[n]&&lC[n])&&(n==="set-cookie"?s[n]?s[n].push(i):s[n]=[i]:s[n]=s[n]?s[n]+", "+i:i)}),s},Ax=Symbol("internals");function _o(t){return t&&String(t).trim().toLowerCase()}function Fd(t){return t===!1||t==null?t:xe.isArray(t)?t.map(Fd):String(t)}function cC(t){const s=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)s[i[1]]=i[2];return s}const dC=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Gf(t,s,n,i,l){if(xe.isFunction(i))return i.call(this,s,n);if(l&&(s=n),!!xe.isString(s)){if(xe.isString(i))return s.indexOf(i)!==-1;if(xe.isRegExp(i))return i.test(s)}}function uC(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,n,i)=>n.toUpperCase()+i)}function hC(t,s){const n=xe.toCamelCase(" "+s);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(l,c,u){return this[i].call(this,s,l,c,u)},configurable:!0})})}let Ps=class{constructor(s){s&&this.set(s)}set(s,n,i){const l=this;function c(f,p,m){const g=_o(p);if(!g)throw new Error("header name must be a non-empty string");const v=xe.findKey(l,g);(!v||l[v]===void 0||m===!0||m===void 0&&l[v]!==!1)&&(l[v||p]=Fd(f))}const u=(f,p)=>xe.forEach(f,(m,g)=>c(m,g,p));if(xe.isPlainObject(s)||s instanceof this.constructor)u(s,n);else if(xe.isString(s)&&(s=s.trim())&&!dC(s))u(oC(s),n);else if(xe.isHeaders(s))for(const[f,p]of s.entries())c(p,f,i);else s!=null&&c(n,s,i);return this}get(s,n){if(s=_o(s),s){const i=xe.findKey(this,s);if(i){const l=this[i];if(!n)return l;if(n===!0)return cC(l);if(xe.isFunction(n))return n.call(this,l,i);if(xe.isRegExp(n))return n.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,n){if(s=_o(s),s){const i=xe.findKey(this,s);return!!(i&&this[i]!==void 0&&(!n||Gf(this,this[i],i,n)))}return!1}delete(s,n){const i=this;let l=!1;function c(u){if(u=_o(u),u){const f=xe.findKey(i,u);f&&(!n||Gf(i,i[f],f,n))&&(delete i[f],l=!0)}}return xe.isArray(s)?s.forEach(c):c(s),l}clear(s){const n=Object.keys(this);let i=n.length,l=!1;for(;i--;){const c=n[i];(!s||Gf(this,this[c],c,s,!0))&&(delete this[c],l=!0)}return l}normalize(s){const n=this,i={};return xe.forEach(this,(l,c)=>{const u=xe.findKey(i,c);if(u){n[u]=Fd(l),delete n[c];return}const f=s?uC(c):String(c).trim();f!==c&&delete n[c],n[f]=Fd(l),i[f]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const n=Object.create(null);return xe.forEach(this,(i,l)=>{i!=null&&i!==!1&&(n[l]=s&&xe.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,n])=>s+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...n){const i=new this(s);return n.forEach(l=>i.set(l)),i}static accessor(s){const i=(this[Ax]=this[Ax]={accessors:{}}).accessors,l=this.prototype;function c(u){const f=_o(u);i[f]||(hC(l,u),i[f]=!0)}return xe.isArray(s)?s.forEach(c):c(s),this}};Ps.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);xe.reduceDescriptors(Ps.prototype,({value:t},s)=>{let n=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(i){this[n]=i}}});xe.freezeMethods(Ps);function Qf(t,s){const n=this||rc,i=s||n,l=Ps.from(i.headers);let c=i.data;return xe.forEach(t,function(f){c=f.call(n,c,l.normalize(),s?s.status:void 0)}),l.normalize(),c}function Y0(t){return!!(t&&t.__CANCEL__)}function El(t,s,n){Qe.call(this,t??"canceled",Qe.ERR_CANCELED,s,n),this.name="CanceledError"}xe.inherits(El,Qe,{__CANCEL__:!0});function V0(t,s,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):s(new Qe("Request failed with status code "+n.status,[Qe.ERR_BAD_REQUEST,Qe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function fC(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function mC(t,s){t=t||10;const n=new Array(t),i=new Array(t);let l=0,c=0,u;return s=s!==void 0?s:1e3,function(p){const m=Date.now(),g=i[c];u||(u=m),n[l]=p,i[l]=m;let v=c,j=0;for(;v!==l;)j+=n[v++],v=v%t;if(l=(l+1)%t,l===c&&(c=(c+1)%t),m-u<s)return;const N=g&&m-g;return N?Math.round(j*1e3/N):void 0}}function pC(t,s){let n=0,i=1e3/s,l,c;const u=(m,g=Date.now())=>{n=g,l=null,c&&(clearTimeout(c),c=null),t.apply(null,m)};return[(...m)=>{const g=Date.now(),v=g-n;v>=i?u(m,g):(l=m,c||(c=setTimeout(()=>{c=null,u(l)},i-v)))},()=>l&&u(l)]}const su=(t,s,n=3)=>{let i=0;const l=mC(50,250);return pC(c=>{const u=c.loaded,f=c.lengthComputable?c.total:void 0,p=u-i,m=l(p),g=u<=f;i=u;const v={loaded:u,total:f,progress:f?u/f:void 0,bytes:p,rate:m||void 0,estimated:m&&f&&g?(f-u)/m:void 0,event:c,lengthComputable:f!=null,[s?"download":"upload"]:!0};t(v)},n)},Dx=(t,s)=>{const n=t!=null;return[i=>s[0]({lengthComputable:n,total:t,loaded:i}),s[1]]},kx=t=>(...s)=>xe.asap(()=>t(...s)),gC=Ts.hasStandardBrowserEnv?((t,s)=>n=>(n=new URL(n,Ts.origin),t.protocol===n.protocol&&t.host===n.host&&(s||t.port===n.port)))(new URL(Ts.origin),Ts.navigator&&/(msie|trident)/i.test(Ts.navigator.userAgent)):()=>!0,yC=Ts.hasStandardBrowserEnv?{write(t,s,n,i,l,c){const u=[t+"="+encodeURIComponent(s)];xe.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),xe.isString(i)&&u.push("path="+i),xe.isString(l)&&u.push("domain="+l),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read(t){const s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function vC(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function xC(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function G0(t,s,n){let i=!vC(s);return t&&(i||n==!1)?xC(t,s):s}const _x=t=>t instanceof Ps?{...t}:t;function di(t,s){s=s||{};const n={};function i(m,g,v,j){return xe.isPlainObject(m)&&xe.isPlainObject(g)?xe.merge.call({caseless:j},m,g):xe.isPlainObject(g)?xe.merge({},g):xe.isArray(g)?g.slice():g}function l(m,g,v,j){if(xe.isUndefined(g)){if(!xe.isUndefined(m))return i(void 0,m,v,j)}else return i(m,g,v,j)}function c(m,g){if(!xe.isUndefined(g))return i(void 0,g)}function u(m,g){if(xe.isUndefined(g)){if(!xe.isUndefined(m))return i(void 0,m)}else return i(void 0,g)}function f(m,g,v){if(v in s)return i(m,g);if(v in t)return i(void 0,m)}const p={url:c,method:c,data:c,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:f,headers:(m,g,v)=>l(_x(m),_x(g),v,!0)};return xe.forEach(Object.keys(Object.assign({},t,s)),function(g){const v=p[g]||l,j=v(t[g],s[g],g);xe.isUndefined(j)&&v!==f||(n[g]=j)}),n}const Q0=t=>{const s=di({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:l,xsrfCookieName:c,headers:u,auth:f}=s;s.headers=u=Ps.from(u),s.url=P0(G0(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),f&&u.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):"")));let p;if(xe.isFormData(n)){if(Ts.hasStandardBrowserEnv||Ts.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((p=u.getContentType())!==!1){const[m,...g]=p?p.split(";").map(v=>v.trim()).filter(Boolean):[];u.setContentType([m||"multipart/form-data",...g].join("; "))}}if(Ts.hasStandardBrowserEnv&&(i&&xe.isFunction(i)&&(i=i(s)),i||i!==!1&&gC(s.url))){const m=l&&c&&yC.read(c);m&&u.set(l,m)}return s},jC=typeof XMLHttpRequest<"u",bC=jC&&function(t){return new Promise(function(n,i){const l=Q0(t);let c=l.data;const u=Ps.from(l.headers).normalize();let{responseType:f,onUploadProgress:p,onDownloadProgress:m}=l,g,v,j,N,b;function w(){N&&N(),b&&b(),l.cancelToken&&l.cancelToken.unsubscribe(g),l.signal&&l.signal.removeEventListener("abort",g)}let C=new XMLHttpRequest;C.open(l.method.toUpperCase(),l.url,!0),C.timeout=l.timeout;function T(){if(!C)return;const _=Ps.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders()),S={data:!f||f==="text"||f==="json"?C.responseText:C.response,status:C.status,statusText:C.statusText,headers:_,config:t,request:C};V0(function(E){n(E),w()},function(E){i(E),w()},S),C=null}"onloadend"in C?C.onloadend=T:C.onreadystatechange=function(){!C||C.readyState!==4||C.status===0&&!(C.responseURL&&C.responseURL.indexOf("file:")===0)||setTimeout(T)},C.onabort=function(){C&&(i(new Qe("Request aborted",Qe.ECONNABORTED,t,C)),C=null)},C.onerror=function(){i(new Qe("Network Error",Qe.ERR_NETWORK,t,C)),C=null},C.ontimeout=function(){let D=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const S=l.transitional||q0;l.timeoutErrorMessage&&(D=l.timeoutErrorMessage),i(new Qe(D,S.clarifyTimeoutError?Qe.ETIMEDOUT:Qe.ECONNABORTED,t,C)),C=null},c===void 0&&u.setContentType(null),"setRequestHeader"in C&&xe.forEach(u.toJSON(),function(D,S){C.setRequestHeader(S,D)}),xe.isUndefined(l.withCredentials)||(C.withCredentials=!!l.withCredentials),f&&f!=="json"&&(C.responseType=l.responseType),m&&([j,b]=su(m,!0),C.addEventListener("progress",j)),p&&C.upload&&([v,N]=su(p),C.upload.addEventListener("progress",v),C.upload.addEventListener("loadend",N)),(l.cancelToken||l.signal)&&(g=_=>{C&&(i(!_||_.type?new El(null,t,C):_),C.abort(),C=null)},l.cancelToken&&l.cancelToken.subscribe(g),l.signal&&(l.signal.aborted?g():l.signal.addEventListener("abort",g)));const A=fC(l.url);if(A&&Ts.protocols.indexOf(A)===-1){i(new Qe("Unsupported protocol "+A+":",Qe.ERR_BAD_REQUEST,t));return}C.send(c||null)})},NC=(t,s)=>{const{length:n}=t=t?t.filter(Boolean):[];if(s||n){let i=new AbortController,l;const c=function(m){if(!l){l=!0,f();const g=m instanceof Error?m:this.reason;i.abort(g instanceof Qe?g:new El(g instanceof Error?g.message:g))}};let u=s&&setTimeout(()=>{u=null,c(new Qe(`timeout ${s} of ms exceeded`,Qe.ETIMEDOUT))},s);const f=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(m=>{m.unsubscribe?m.unsubscribe(c):m.removeEventListener("abort",c)}),t=null)};t.forEach(m=>m.addEventListener("abort",c));const{signal:p}=i;return p.unsubscribe=()=>xe.asap(f),p}},SC=function*(t,s){let n=t.byteLength;if(n<s){yield t;return}let i=0,l;for(;i<n;)l=i+s,yield t.slice(i,l),i=l},wC=async function*(t,s){for await(const n of TC(t))yield*SC(n,s)},TC=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:n,value:i}=await s.read();if(n)break;yield i}}finally{await s.cancel()}},Ox=(t,s,n,i)=>{const l=wC(t,s);let c=0,u,f=p=>{u||(u=!0,i&&i(p))};return new ReadableStream({async pull(p){try{const{done:m,value:g}=await l.next();if(m){f(),p.close();return}let v=g.byteLength;if(n){let j=c+=v;n(j)}p.enqueue(new Uint8Array(g))}catch(m){throw f(m),m}},cancel(p){return f(p),l.return()}},{highWaterMark:2})},xu=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",X0=xu&&typeof ReadableStream=="function",EC=xu&&(typeof TextEncoder=="function"?(t=>s=>t.encode(s))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Z0=(t,...s)=>{try{return!!t(...s)}catch{return!1}},CC=X0&&Z0(()=>{let t=!1;const s=new Request(Ts.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!s}),Ix=64*1024,Tm=X0&&Z0(()=>xe.isReadableStream(new Response("").body)),au={stream:Tm&&(t=>t.body)};xu&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!au[s]&&(au[s]=xe.isFunction(t[s])?n=>n[s]():(n,i)=>{throw new Qe(`Response type '${s}' is not supported`,Qe.ERR_NOT_SUPPORT,i)})})})(new Response);const AC=async t=>{if(t==null)return 0;if(xe.isBlob(t))return t.size;if(xe.isSpecCompliantForm(t))return(await new Request(Ts.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(xe.isArrayBufferView(t)||xe.isArrayBuffer(t))return t.byteLength;if(xe.isURLSearchParams(t)&&(t=t+""),xe.isString(t))return(await EC(t)).byteLength},DC=async(t,s)=>{const n=xe.toFiniteNumber(t.getContentLength());return n??AC(s)},kC=xu&&(async t=>{let{url:s,method:n,data:i,signal:l,cancelToken:c,timeout:u,onDownloadProgress:f,onUploadProgress:p,responseType:m,headers:g,withCredentials:v="same-origin",fetchOptions:j}=Q0(t);m=m?(m+"").toLowerCase():"text";let N=NC([l,c&&c.toAbortSignal()],u),b;const w=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let C;try{if(p&&CC&&n!=="get"&&n!=="head"&&(C=await DC(g,i))!==0){let S=new Request(s,{method:"POST",body:i,duplex:"half"}),R;if(xe.isFormData(i)&&(R=S.headers.get("content-type"))&&g.setContentType(R),S.body){const[E,k]=Dx(C,su(kx(p)));i=Ox(S.body,Ix,E,k)}}xe.isString(v)||(v=v?"include":"omit");const T="credentials"in Request.prototype;b=new Request(s,{...j,signal:N,method:n.toUpperCase(),headers:g.normalize().toJSON(),body:i,duplex:"half",credentials:T?v:void 0});let A=await fetch(b);const _=Tm&&(m==="stream"||m==="response");if(Tm&&(f||_&&w)){const S={};["status","statusText","headers"].forEach(I=>{S[I]=A[I]});const R=xe.toFiniteNumber(A.headers.get("content-length")),[E,k]=f&&Dx(R,su(kx(f),!0))||[];A=new Response(Ox(A.body,Ix,E,()=>{k&&k(),w&&w()}),S)}m=m||"text";let D=await au[xe.findKey(au,m)||"text"](A,t);return!_&&w&&w(),await new Promise((S,R)=>{V0(S,R,{data:D,headers:Ps.from(A.headers),status:A.status,statusText:A.statusText,config:t,request:b})})}catch(T){throw w&&w(),T&&T.name==="TypeError"&&/fetch/i.test(T.message)?Object.assign(new Qe("Network Error",Qe.ERR_NETWORK,t,b),{cause:T.cause||T}):Qe.from(T,T&&T.code,t,b)}}),Em={http:Y2,xhr:bC,fetch:kC};xe.forEach(Em,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const $x=t=>`- ${t}`,_C=t=>xe.isFunction(t)||t===null||t===!1,W0={getAdapter:t=>{t=xe.isArray(t)?t:[t];const{length:s}=t;let n,i;const l={};for(let c=0;c<s;c++){n=t[c];let u;if(i=n,!_C(n)&&(i=Em[(u=String(n)).toLowerCase()],i===void 0))throw new Qe(`Unknown adapter '${u}'`);if(i)break;l[u||"#"+c]=i}if(!i){const c=Object.entries(l).map(([f,p])=>`adapter ${f} `+(p===!1?"is not supported by the environment":"is not available in the build"));let u=s?c.length>1?`since :
`+c.map($x).join(`
`):" "+$x(c[0]):"as no adapter specified";throw new Qe("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return i},adapters:Em};function Xf(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new El(null,t)}function Rx(t){return Xf(t),t.headers=Ps.from(t.headers),t.data=Qf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),W0.getAdapter(t.adapter||rc.adapter)(t).then(function(i){return Xf(t),i.data=Qf.call(t,t.transformResponse,i),i.headers=Ps.from(i.headers),i},function(i){return Y0(i)||(Xf(t),i&&i.response&&(i.response.data=Qf.call(t,t.transformResponse,i.response),i.response.headers=Ps.from(i.response.headers))),Promise.reject(i)})}const K0="1.8.4",ju={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{ju[t]=function(i){return typeof i===t||"a"+(s<1?"n ":" ")+t}});const Mx={};ju.transitional=function(s,n,i){function l(c,u){return"[Axios v"+K0+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,f)=>{if(s===!1)throw new Qe(l(u," has been removed"+(n?" in "+n:"")),Qe.ERR_DEPRECATED);return n&&!Mx[u]&&(Mx[u]=!0,console.warn(l(u," has been deprecated since v"+n+" and will be removed in the near future"))),s?s(c,u,f):!0}};ju.spelling=function(s){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${s}`),!0)};function OC(t,s,n){if(typeof t!="object")throw new Qe("options must be an object",Qe.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let l=i.length;for(;l-- >0;){const c=i[l],u=s[c];if(u){const f=t[c],p=f===void 0||u(f,c,t);if(p!==!0)throw new Qe("option "+c+" must be "+p,Qe.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Qe("Unknown option "+c,Qe.ERR_BAD_OPTION)}}const Ud={assertOptions:OC,validators:ju},Qa=Ud.validators;let ri=class{constructor(s){this.defaults=s,this.interceptors={request:new Cx,response:new Cx}}async request(s,n){try{return await this._request(s,n)}catch(i){if(i instanceof Error){let l={};Error.captureStackTrace?Error.captureStackTrace(l):l=new Error;const c=l.stack?l.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(s,n){typeof s=="string"?(n=n||{},n.url=s):n=s||{},n=di(this.defaults,n);const{transitional:i,paramsSerializer:l,headers:c}=n;i!==void 0&&Ud.assertOptions(i,{silentJSONParsing:Qa.transitional(Qa.boolean),forcedJSONParsing:Qa.transitional(Qa.boolean),clarifyTimeoutError:Qa.transitional(Qa.boolean)},!1),l!=null&&(xe.isFunction(l)?n.paramsSerializer={serialize:l}:Ud.assertOptions(l,{encode:Qa.function,serialize:Qa.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Ud.assertOptions(n,{baseUrl:Qa.spelling("baseURL"),withXsrfToken:Qa.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&xe.merge(c.common,c[n.method]);c&&xe.forEach(["delete","get","head","post","put","patch","common"],b=>{delete c[b]}),n.headers=Ps.concat(u,c);const f=[];let p=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(n)===!1||(p=p&&w.synchronous,f.unshift(w.fulfilled,w.rejected))});const m=[];this.interceptors.response.forEach(function(w){m.push(w.fulfilled,w.rejected)});let g,v=0,j;if(!p){const b=[Rx.bind(this),void 0];for(b.unshift.apply(b,f),b.push.apply(b,m),j=b.length,g=Promise.resolve(n);v<j;)g=g.then(b[v++],b[v++]);return g}j=f.length;let N=n;for(v=0;v<j;){const b=f[v++],w=f[v++];try{N=b(N)}catch(C){w.call(this,C);break}}try{g=Rx.call(this,N)}catch(b){return Promise.reject(b)}for(v=0,j=m.length;v<j;)g=g.then(m[v++],m[v++]);return g}getUri(s){s=di(this.defaults,s);const n=G0(s.baseURL,s.url,s.allowAbsoluteUrls);return P0(n,s.params,s.paramsSerializer)}};xe.forEach(["delete","get","head","options"],function(s){ri.prototype[s]=function(n,i){return this.request(di(i||{},{method:s,url:n,data:(i||{}).data}))}});xe.forEach(["post","put","patch"],function(s){function n(i){return function(c,u,f){return this.request(di(f||{},{method:s,headers:i?{"Content-Type":"multipart/form-data"}:{},url:c,data:u}))}}ri.prototype[s]=n(),ri.prototype[s+"Form"]=n(!0)});let IC=class J0{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(c){n=c});const i=this;this.promise.then(l=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](l);i._listeners=null}),this.promise.then=l=>{let c;const u=new Promise(f=>{i.subscribe(f),c=f}).then(l);return u.cancel=function(){i.unsubscribe(c)},u},s(function(c,u,f){i.reason||(i.reason=new El(c,u,f),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const s=new AbortController,n=i=>{s.abort(i)};return this.subscribe(n),s.signal.unsubscribe=()=>this.unsubscribe(n),s.signal}static source(){let s;return{token:new J0(function(l){s=l}),cancel:s}}};function $C(t){return function(n){return t.apply(null,n)}}function RC(t){return xe.isObject(t)&&t.isAxiosError===!0}const Cm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Cm).forEach(([t,s])=>{Cm[s]=t});function eb(t){const s=new ri(t),n=_0(ri.prototype.request,s);return xe.extend(n,ri.prototype,s,{allOwnKeys:!0}),xe.extend(n,s,null,{allOwnKeys:!0}),n.create=function(l){return eb(di(t,l))},n}const Ut=eb(rc);Ut.Axios=ri;Ut.CanceledError=El;Ut.CancelToken=IC;Ut.isCancel=Y0;Ut.VERSION=K0;Ut.toFormData=vu;Ut.AxiosError=Qe;Ut.Cancel=Ut.CanceledError;Ut.all=function(s){return Promise.all(s)};Ut.spread=$C;Ut.isAxiosError=RC;Ut.mergeConfig=di;Ut.AxiosHeaders=Ps;Ut.formToJSON=t=>H0(xe.isHTMLForm(t)?new FormData(t):t);Ut.getAdapter=W0.getAdapter;Ut.HttpStatusCode=Cm;Ut.default=Ut;const{Axios:MC,AxiosError:zC,CanceledError:LC,isCancel:BC,CancelToken:FC,VERSION:UC,all:PC,Cancel:qC,isAxiosError:HC,spread:YC,toFormData:VC,AxiosHeaders:GC,HttpStatusCode:QC,formToJSON:XC,getAdapter:ZC,mergeConfig:WC}=Ut,KC=Object.freeze(Object.defineProperty({__proto__:null,Axios:MC,AxiosError:zC,AxiosHeaders:GC,Cancel:qC,CancelToken:FC,CanceledError:LC,HttpStatusCode:QC,VERSION:UC,all:PC,default:Ut,formToJSON:XC,getAdapter:ZC,isAxiosError:HC,isCancel:BC,mergeConfig:WC,spread:YC,toFormData:VC},Symbol.toStringTag,{value:"Module"})),JC=[/ValidationError:/i,/CastError:/i,/MongoError:/i,/mongoose/i,/TypeError:/i,/ReferenceError:/i,/SyntaxError:/i,/Failed to bulk create/i,/duplicate key error/i,/E11000/i,/must be one of/i,/Path .* is required/i,/Cast to ObjectId failed/i,/bufferedMaxEntries/i,/Connection/i,/timeout/i,/ECONNREFUSED/i,/ENOTFOUND/i,/stack trace/i,/\bat\s+.*\.(js|ts):\d+/i,/נמצאו התנגשויות.*תאוריה/i,/שיעורים\s+ביום\s+ראשון/i,/חדר\s+תאוריה\s+\d+/i,/תאריך:\s+\d{4}-\d{2}-\d{2}/i,/\d{4}-\d{2}-\d{2}/i,/\d{2}:\d{2}\s*-\s*\d{2}:\d{2}/i],eA={validation:"נתונים לא תקינים. אנא בדוק את המידע שהוזן ונסה שוב.",network:"בעיה בחיבור לשרת. אנא נסה שוב בעוד מספר רגעים.",server:"שגיאה פנימית בשרת. אנא נסה שוב מאוחר יותר.",notFound:"המשאב המבוקש לא נמצא.",unauthorized:"אין לך הרשאות לבצע פעולה זו. אנא פנה למנהל המערכת.",forbidden:"הגישה נדחתה. אין לך הרשאות מתאימות.",timeout:"הפעולה ארכה זמן רב מדי. אנא נסה שוב.",conflict:"קיים קונפליקט בנתונים. אנא רענן את הדף ונסה שוב.",tokenExpired:"פג תוקף ההתחברות. אנא התחבר מחדש.",invalidToken:"אימות לא תקין. אנא התחבר מחדש.",sessionExpired:"פג תוקף הפעלה. אנא התחבר מחדש.",authenticationFailed:"שגיאה בהתחברות. אנא בדוק את הנתונים ונסה שוב.",missingPasswords:"יש למלא את הסיסמה הנוכחית והסיסמה החדשה",incorrectCurrentPassword:"הסיסמה הנוכחית שגויה",weakPassword:"הסיסמה חייבת להכיל לפחות 6 תווים",samePassword:"הסיסמה החדשה חייבת להיות שונה מהסיסמה הנוכחית",missingEmail:"יש להזין כתובת אימייל",missingResetData:"נתוני איפוס הסיסמה חסרים",resetTokenExpired:"פג תוקף הקישור לאיפוס סיסמה. אנא בקש קישור חדש.",invalidResetToken:"הקישור לאיפוס סיסמה לא תקין או פג תוקפו",duplicateEmail:"כתובת האימייל הזו כבר קיימת במערכת. אנא השתמש בכתובת אימייל אחרת.",duplicatePhone:"מספר הטלפון הזה כבר קיים במערכת. אנא השתמש במספר טלפון אחר.",duplicateStudent:"תלמיד עם פרטים אלו כבר קיים במערכת.",duplicateOrchestra:"תזמורת עם שם זה כבר קיימת במערכת.",duplicateTheory:"שיעור תאוריה עם פרטים אלו כבר קיים במערכת.",theoryConflict:"קיים שיעור תאוריה באותו זמן. בחר זמן אחר.",notAuthorizedToUpdate:"אין לך הרשאות לעדכן תלמיד זה. רק המורה הקבוע או המנהל יכולים לעדכן.",notAuthorizedToDelete:"אין לך הרשאות למחוק תלמיד זה. רק המנהל יכול למחוק תלמידים.",notAuthorizedToView:"אין לך הרשאות לצפות בתלמיד זה.",studentNotAssigned:"תלמיד זה לא מוקצה אליך. פנה למנהל המערכת.",notAuthorizedToUpdateTeacher:"אין לך הרשאות לעדכן מורה זה. רק המנהל יכול לעדכן מורים אחרים.",notAuthorizedToDeleteTeacher:"אין לך הרשאות למחוק מורה זה. רק המנהל יכול למחוק מורים.",notAuthorizedToViewTeacher:"אין לך הרשאות לצפות במורה זה.",notAuthorizedToAddTeacher:"אין לך הרשאות להוסיף מורה חדש. רק המנהל יכול להוסיף מורים.",canOnlyEditOwnProfile:"אתה יכול לערוך רק את הפרופיל שלך.",duplicateNamePhone:"מורה עם שם מלא ומספר טלפון זהים כבר קיים במערכת.",duplicateNameAddress:"מורה עם שם מלא וכתובת דומים כבר קיים במערכת.",duplicatePhoneAddress:"מורה עם מספר טלפון וכתובת זהים כבר קיים במערכת.",duplicateFullProfile:"מורה עם פרטים זהים (שם, טלפון וכתובת) כבר קיים במערכת.",duplicateSimilarName:"נמצאו מורים עם שמות דומים במערכת.",duplicateTeacherBlocked:"לא ניתן להוסיף מורה זה - נמצאו כפילויות משמעותיות במערכת.",generic:"אירעה שגיאה. אנא נסה שוב מאוחר יותר."};function tA(t){return JC.some(s=>s.test(t))}function sA(t){const s=t.toLowerCase();return s.includes("token expired")||s.includes("jwt expired")||s.includes("token has expired")||s.includes("התחברות פגה")||s.includes("פג תוקף")?"tokenExpired":s.includes("invalid token")||s.includes("malformed token")||s.includes("jwt malformed")||s.includes("אימות לא תקין")?"invalidToken":s.includes("session expired")||s.includes("session invalid")||s.includes("פג תוקף הפעלה")?"sessionExpired":s.includes("authentication failed")||s.includes("login failed")||s.includes("שגיאה בהתחברות")||s.includes("התחברות נכשלה")?"authenticationFailed":s.includes("missing_passwords")||s.includes("missing passwords")||s.includes("חסרים נתוני סיסמה")?"missingPasswords":s.includes("incorrect_current_password")||s.includes("incorrect current password")||s.includes("current password is wrong")||s.includes("הסיסמה הנוכחית שגויה")?"incorrectCurrentPassword":s.includes("weak_password")||s.includes("weak password")||s.includes("password too short")||s.includes("סיסמה חלשה")?"weakPassword":s.includes("same_password")||s.includes("same password")||s.includes("new password same as current")||s.includes("סיסמה זהה")?"samePassword":s.includes("missing_email")||s.includes("missing email")||s.includes("חסר אימייל")?"missingEmail":s.includes("missing_reset_data")||s.includes("missing reset data")||s.includes("חסרים נתוני איפוס")?"missingResetData":s.includes("reset_token_expired")||s.includes("reset token expired")||s.includes("token has expired")||s.includes("פג תוקף הקישור")?"resetTokenExpired":s.includes("invalid_reset_token")||s.includes("invalid reset token")||s.includes("invalid or malformed token")||s.includes("קישור לא תקין")?"invalidResetToken":s.includes("not authorized to update student")||s.includes("not authorized to update")||s.includes("לא מורשה לעדכן תלמיד")||s.includes("not authorized")&&s.includes("update")?"notAuthorizedToUpdate":s.includes("not authorized to delete student")||s.includes("not authorized to delete")||s.includes("לא מורשה למחוק תלמיד")||s.includes("not authorized")&&s.includes("delete")?"notAuthorizedToDelete":s.includes("not authorized to view student")||s.includes("not authorized to view")||s.includes("לא מורשה לצפות בתלמיד")||s.includes("not authorized")&&s.includes("view")?"notAuthorizedToView":s.includes("student not assigned to you")||s.includes("student not assigned")||s.includes("תלמיד לא מוקצה אליך")?"studentNotAssigned":s.includes("not authorized to update teacher")||s.includes("לא מורשה לעדכן מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("update")?"notAuthorizedToUpdateTeacher":s.includes("not authorized to delete teacher")||s.includes("לא מורשה למחוק מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("delete")?"notAuthorizedToDeleteTeacher":s.includes("not authorized to view teacher")||s.includes("לא מורשה לצפות במורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("view")?"notAuthorizedToViewTeacher":s.includes("not authorized to add teacher")||s.includes("לא מורשה להוסיף מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("add")?"notAuthorizedToAddTeacher":s.includes("can only edit own profile")||s.includes("יכול לערוך רק את הפרופיל שלך")||s.includes("own profile")?"canOnlyEditOwnProfile":s.includes("full_profile_duplicate")||s.includes("name")&&s.includes("phone")&&s.includes("address")?"duplicateFullProfile":s.includes("name_phone_duplicate")||s.includes("name")&&s.includes("phone")&&!s.includes("address")?"duplicateNamePhone":s.includes("name_address_duplicate")||s.includes("name")&&s.includes("address")&&!s.includes("phone")?"duplicateNameAddress":s.includes("phone_address_duplicate")||s.includes("phone")&&s.includes("address")&&!s.includes("name")?"duplicatePhoneAddress":s.includes("similar_name_duplicate")?"duplicateSimilarName":s.includes("duplicate teacher detected")||s.includes("duplicate_teacher_detected")?"duplicateTeacherBlocked":s.includes("teacher with email")&&s.includes("already exists")||s.includes("user with email")&&s.includes("already exists")||s.includes("email")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateEmail":s.includes("phone")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicatePhone":s.includes("student")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateStudent":s.includes("orchestra")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateOrchestra":s.includes("theory")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateTheory":null}function aA(t){return t.length<80&&!tA(t)&&!t.includes("Error:")&&!t.includes("ValidationError")&&!t.includes("MongoError")&&!t.includes("CastError")}function nA(t){const s=t.match(/יום\s+(ראשון|שני|שלישי|רביעי|חמישי|שישי|שבת)/i),n=t.match(/(\d{2}:\d{2})\s*-\s*(\d{2}:\d{2})/i),i=t.match(/חדר\s*תאוריה\s*(\d+|[א-ת]+)/i);if(s||n||i){const l=[];if(s&&l.push(`יום ${s[1]}`),n&&l.push(`שעה ${n[1]}`),i&&l.push(`חדר ${i[1]}`),l.length>0)return`קיים שיעור באותו ${l.join(" ו")}. שנה אחד מהפרטים.`}return"קיים שיעור תאוריה באותו זמן. בחר זמן או מקום אחר."}function rA(){return`ERR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function iA(t){const{status:s,message:n}=t;if(s)switch(s){case 400:return"validation";case 401:return"unauthorized";case 403:return"forbidden";case 404:return"notFound";case 409:return"conflict";case 408:case 504:return"timeout";case 500:case 502:case 503:return"server";default:if(s>=500)return"server";if(s>=400)return"validation"}if(n){const i=n.toLowerCase(),l=sA(n);if(l)return l;if(i.includes("נמצאו התנגשויות")||i.includes("תאוריה")||i.includes("שיעורים ביום")||i.includes("חדר תאוריה"))return"theoryConflict";if(i.includes("validation")||i.includes("required")||i.includes("invalid"))return"validation";if(i.includes("network")||i.includes("connection")||i.includes("timeout"))return"network";if(i.includes("unauthorized")||i.includes("token"))return"unauthorized";if(i.includes("forbidden")||i.includes("access denied"))return"forbidden";if(i.includes("not found"))return"notFound";if(i.includes("conflict")||i.includes("duplicate"))return"conflict"}return"generic"}function ts(t){var f;const s=rA(),n=new Date;let i;(f=t==null?void 0:t.response)!=null&&f.data?i={message:t.response.data.message||t.response.data.error||t.message||"Unknown error",status:t.response.status,code:t.response.data.code,details:t.response.data}:t!=null&&t.message?i={message:t.message,status:t.status||t.statusCode,code:t.code,details:t}:typeof t=="string"?i={message:t}:i={message:"Unknown error occurred",details:t};let l;if(aA(i.message))l=i.message;else{const p=iA(i);p==="theoryConflict"?l=nA(i.message):l=eA[p]}const c=lA(i),u=`[${s}] ${i.message}${i.status?` (Status: ${i.status})`:""}`;return console.error(`Error ${s}:`,u),{userMessage:l,developerMessage:u,errorId:s,timestamp:n,duplicateInfo:c||void 0}}function Ms(t,s){const n=ts(t);return s&&console.error(`API Error in ${s}:`,n.developerMessage),n}function lA(t){if(!t||!t.details)return null;const s=t.details;return s.blocked!==void 0||s.duplicates||s.warnings||s.potentialDuplicates?{blocked:s.blocked||!1,reason:s.reason||"Duplicate detection triggered",duplicates:s.duplicates||[],warnings:s.warnings||s.potentialDuplicates||[],canOverride:s.canOverride||!1,adminOverride:s.adminOverride||!1}:null}const oA=()=>"/api/",cA=oA(),ol=Ut.create({baseURL:cA,withCredentials:!0,timeout:15e3}),dA=2,uA=1e3,hA=t=>new Promise(s=>setTimeout(s,t)),Am=t=>t?t.includes("/teacher/invitation/validate")||t.includes("/teacher/invitation/accept")||t.includes("/teacher/invitation/resend"):!1;ol.interceptors.request.use(async t=>{var n,i;if((n=t.url)!=null&&n.includes("auth/refresh")||(i=t.url)!=null&&i.includes("auth/login")||Am(t.url))return t;const s=Fs.getToken();if(s)if(Fs.isTokenExpired(s))try{const l=await Fs.refreshToken();t.headers.Authorization=`Bearer ${l}`}catch{Fs.clearAuthData()}else t.headers.Authorization=`Bearer ${s}`;return t},t=>Promise.reject(t));ol.interceptors.response.use(t=>t,async t=>{var n,i,l;const s=t.config;if(!s)return Promise.reject(t);if(s._retry===void 0&&(s._retry=0),((n=t.response)==null?void 0:n.status)===401){if((i=s.url)!=null&&i.includes("auth/refresh")||(l=s.url)!=null&&l.includes("auth/login")||Am(s.url))return Promise.reject(t);if(s._retry===0)try{s._retry=1;const c=await Fs.refreshToken();return s.headers||(s.headers={}),s.headers.Authorization=`Bearer ${c}`,ol(s)}catch(c){return Fs.clearAuthData(),window.location.pathname!=="/login"&&!Am(s.url)&&(window.location.href="/login"),Promise.reject(c)}}if((t.code==="ECONNABORTED"||t.message.includes("timeout")||t.code==="ERR_NETWORK"||t.response&&t.response.status>=500)&&s._retry<dA){s._retry+=1;const c=uA*2**(s._retry-1);return await hA(c),ol(s)}return Promise.reject(t)});ol.interceptors.response.use(t=>t,t=>{var s;if(((s=t.response)==null?void 0:s.status)===403){const n=t.response.data;if((n==null?void 0:n.code)==="PASSWORD_CHANGE_REQUIRED")return localStorage.setItem("requiresPasswordChange","true"),window.location.href="/profile?forcePasswordChange=true",Promise.reject(new Error("Redirecting to password change"))}return Promise.reject(t)});const ge={async get(t,s=null,n={}){return Td("GET",t,null,s,n)},async post(t,s=null,n={}){return Td("POST",t,s,null,n)},async put(t,s=null,n={}){return Td("PUT",t,s,null,n)},async delete(t,s=null,n={}){return Td("DELETE",t,s,null,n)}};async function Td(t,s,n=null,i=null,l={}){var c;try{return(await ol({method:t,url:s,data:n,params:i,...l})).data}catch(u){if(((c=u==null?void 0:u.response)==null?void 0:c.status)===404&&s.includes("schedule/time-blocks/")&&!s.includes("/teacher/")){const g=new Error("Not Found");throw g.originalError=u,g}const p=Ms(u,`${t} ${s}`),m=new Error(p.userMessage);throw m.errorId=p.errorId,m.developerMessage=p.developerMessage,m.originalError=u,m}}let al=null;function tb(t){var c,u,f,p,m;const s=((c=t.personalInfo)==null?void 0:c.fullName)||t.fullName||"Unknown User",n=((u=t.personalInfo)==null?void 0:u.email)||t.email||((f=t.credentials)==null?void 0:f.email)||"",i=((p=t.personalInfo)==null?void 0:p.phone)||"",l=((m=t.personalInfo)==null?void 0:m.address)||"";return{_id:t._id,fullName:s,email:n,phone:i,address:l,roles:t.roles||[],professionalInfo:t.professionalInfo}}const Fs={login:fA,logout:mA,getCurrentUser:pA,isLoggedIn:gA,validateSession:yA,isTokenExpired:tp,refreshToken:sb,getToken:sp,setToken:ap,clearAuthData:Ho};async function fA(t,s){var n;try{const i=await ge.post("auth/login",{email:t,password:s});ap(i.accessToken),i.refreshToken&&localStorage.setItem("refreshToken",i.refreshToken);const l=tb(i.teacher);return localStorage.setItem("user",JSON.stringify(l)),(n=i.teacher.credentials)!=null&&n.requiresPasswordChange&&(localStorage.setItem("requiresPasswordChange","true"),setTimeout(()=>{window.location.href="/profile?forcePasswordChange=true"},100)),l}catch(i){throw console.error("Login failed:",i),i}}async function mA(){try{await ge.post("auth/logout")}catch(t){console.error("Logout failed:",t)}finally{Ho()}}function pA(){const t=localStorage.getItem("user");if(!t)return null;try{const s=JSON.parse(t);return s.personalInfo&&!s.fullName?tb(s):s}catch{return null}}function gA(){const t=sp();return!!(t&&!tp(t))}async function yA(){const t=sp();if(!t)return!1;if(tp(t))try{return await sb(),!0}catch{return Ho(),!1}try{return await ge.get("auth/validate"),!0}catch(s){return console.error("Session validation failed:",s),Ho(),!1}}function tp(t){try{const s=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return s.exp<n}catch{return!0}}async function sb(){if(al)return al;const t=localStorage.getItem("refreshToken");if(!t)throw new Error("No refresh token available");return al=(async()=>{try{const s=await ge.post("auth/refresh",{refreshToken:t});return ap(s.accessToken),s.accessToken}catch(s){throw Ho(),s}finally{al=null}})(),al}function sp(){return localStorage.getItem("accessToken")}function ap(t){localStorage.setItem("accessToken",t)}function Ho(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),al=null}const cl=Fa(t=>({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!1,error:null,initialize:async()=>{t({isLoading:!0,isInitialized:!1});try{if(await Fs.validateSession()){const n=Fs.getCurrentUser();t({user:n,isAuthenticated:!0,isLoading:!1,isInitialized:!0})}else t({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0})}catch(s){console.error("Session validation failed:",s),t({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0})}},login:async(s,n)=>{t({isLoading:!0,error:null});try{const i=await Fs.login(s,n);return t({user:i,isAuthenticated:!0,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Login failed";throw t({error:l,isLoading:!1}),i}},logout:async()=>{t({isLoading:!0});try{await Fs.logout()}catch(s){console.error("Logout failed:",s)}finally{t({user:null,isAuthenticated:!1,isLoading:!1})}},clearError:()=>{t({error:null})}}));function vs(){var w;const t=k0(),s=Ot(),{user:n,isAuthenticated:i,isLoading:l,error:c,login:u,logout:f,clearError:p}=cl(),m=bx({mutationFn:C=>u(C.email,C.password),onSuccess:()=>{t.invalidateQueries({queryKey:["user"]}),s("/dashboard")}}),g=bx({mutationFn:()=>f(),onSuccess:()=>{t.clear(),s("/login")}});function v(C,T){return p(),m.mutate({email:C,password:T})}function j(){return g.mutate()}const N=l||m.isPending||g.isPending,b=c||((w=m.error)==null?void 0:w.message)||void 0;return{user:n,isAuthenticated:i,isLoading:N,error:b,login:v,logout:j,clearError:p}}const np={async changePassword(t){try{return await ge.post("auth/change-password",t)}catch(s){throw console.error("Change password failed:",s),s}},async forgotPassword(t){try{return await ge.post("auth/forgot-password",t)}catch(s){throw console.error("Forgot password failed:",s),s}},async resetPassword(t){try{return await ge.post("auth/reset-password",t)}catch(s){throw console.error("Reset password failed:",s),s}}};function vA(){const[t,s]=x.useState(""),[n,i]=x.useState(""),[l,c]=x.useState(!1),[u,f]=x.useState(""),[p,m]=x.useState(!1),[g,v]=x.useState(null),[j,N]=x.useState(null),{login:b,isAuthenticated:w,isLoading:C,error:T,clearError:A}=vs();if(w)return e.jsx(eu,{to:"/dashboard",replace:!0});function _(I){I.preventDefault(),!(!t||!n)&&b(t,n)}function D(I){A(),s(I.target.value)}function S(I){A(),i(I.target.value)}async function R(I){if(I.preventDefault(),!!u){m(!0),v(null),N(null);try{await np.forgotPassword({email:u}),N("נשלח אימייל עם הוראות לאיפוס סיסמה"),f("")}catch(M){const z=ts(M);v(z.userMessage)}finally{m(!1)}}}function E(){c(!0),f(t),v(null),N(null)}function k(){c(!1),v(null),N(null),f("")}return e.jsx("div",{className:"login-page","data-theme":"dark",children:e.jsx("div",{className:"login-form",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"back-button-container",children:e.jsxs("button",{type:"button",onClick:k,className:"back-button",children:[e.jsx(Bs,{className:"icon"}),"חזרה להתחברות"]})}),e.jsx("h1",{children:"שכחת סיסמה?"}),e.jsx("p",{className:"forgot-password-description",children:"הזן את כתובת המייל שלך ונשלח לך הוראות לאיפוס הסיסמה"}),g&&e.jsx("div",{className:"error-message",children:g}),j&&e.jsx("div",{className:"success-message",children:j}),e.jsxs("form",{className:"form-section",onSubmit:R,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"email",id:"forgot-email",className:u?"has-value":"",placeholder:"",autoComplete:"off",required:!0,value:u,onChange:I=>f(I.target.value)}),e.jsx("label",{htmlFor:"forgot-email",children:"כתובת מייל"}),e.jsx(On,{className:"input-icon"})]}),e.jsx("button",{className:"btn",type:"submit",disabled:p,children:p?"שולח...":"שלח הוראות איפוס"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"התחברות"}),T&&e.jsx("div",{className:"error-message",children:T}),e.jsxs("form",{className:"form-section",onSubmit:_,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"email",id:"email",className:t?"has-value":"",placeholder:"",autoComplete:"off",required:!0,value:t,onChange:D}),e.jsx("label",{htmlFor:"email",children:"מייל"}),e.jsx(On,{className:"input-icon"})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"password",id:"password",className:n?"has-value":"",placeholder:"",required:!0,value:n,onChange:S}),e.jsx("label",{htmlFor:"password",children:"סיסמה"}),e.jsx(mr,{className:"input-icon"})]}),e.jsx("button",{className:"btn",type:"submit",disabled:C,children:C?"מתחבר...":"התחבר"}),e.jsxs("div",{className:"forgot-password",children:[e.jsx("p",{children:"שכחת סיסמה?"}),e.jsx("button",{type:"button",onClick:E,className:"forgot-password-link",children:"לחץ כאן"})]})]})]})})})}const ab=x.createContext(void 0);function xA({children:t}){const[s,n]=x.useState(()=>{const l=localStorage.getItem("theme");return l||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});x.useEffect(()=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)},[s]),x.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)"),c=u=>{localStorage.getItem("theme")||n(u.matches?"dark":"light")};return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=()=>{n(l=>l==="light"?"dark":"light")};return e.jsx(ab.Provider,{value:{theme:s,toggleTheme:i},children:t})}function jA(){const t=x.useContext(ab);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const zx={async validateInvitation(t){try{const s=await ge.get(`/teacher/invitation/validate/${t}`);let n=s;return s&&s.success&&s.data&&(n=s.data),n}catch(s){throw console.error("Error validating invitation:",s),s}},async acceptInvitation(t,s){try{const n=await ge.post(`/teacher/invitation/accept/${t}`,s);let i=n;return n&&n.success&&n.data&&(i=n.data),i}catch(n){throw console.error("Error accepting invitation:",n),n}},async resendInvitation(t,s){try{return await ge.post(`/teacher/invitation/resend/${t}`,s)}catch(n){throw console.error("Error resending invitation:",n),n}}},bA=({id:t,message:s,type:n,onClose:i,onUndo:l,autoClose:c=!0,autoCloseTime:u=3e3})=>{x.useEffect(()=>{if(c){const p=setTimeout(()=>{i(t)},u);return()=>clearTimeout(p)}},[c,u,t,i]);const f=()=>{switch(n){case"success":return e.jsx(Et,{size:20});case"warning":return e.jsx(yr,{size:20});case"danger":return e.jsx(Ro,{size:20});case"info":default:return e.jsx($o,{size:20})}};return e.jsxs("div",{className:`toast toast-${n}`,role:"alert",children:[e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-icon",children:f()}),e.jsx("div",{className:"toast-message",children:s}),e.jsxs("div",{className:"toast-actions",children:[l&&e.jsxs("button",{className:"toast-undo-btn",onClick:()=>{l(),i(t)},children:[e.jsx(jE,{size:16}),e.jsx("span",{children:"Undo"})]}),e.jsx("button",{className:"toast-close-btn",onClick:()=>i(t),children:e.jsx(Ro,{size:16})})]})]}),c&&e.jsx("div",{className:"toast-progress",style:{animationDuration:`${u}ms`}})]})},NA=({toasts:t,position:s="bottom-left",onClose:n})=>e.jsx("div",{className:`toast-container toast-position-${s}`,children:t.map(i=>e.jsx(bA,{...i,onClose:n},i.id))}),hs=[];for(let t=0;t<256;++t)hs.push((t+256).toString(16).slice(1));function SA(t,s=0){return(hs[t[s+0]]+hs[t[s+1]]+hs[t[s+2]]+hs[t[s+3]]+"-"+hs[t[s+4]]+hs[t[s+5]]+"-"+hs[t[s+6]]+hs[t[s+7]]+"-"+hs[t[s+8]]+hs[t[s+9]]+"-"+hs[t[s+10]]+hs[t[s+11]]+hs[t[s+12]]+hs[t[s+13]]+hs[t[s+14]]+hs[t[s+15]]).toLowerCase()}let Zf;const wA=new Uint8Array(16);function TA(){if(!Zf){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zf=crypto.getRandomValues.bind(crypto)}return Zf(wA)}const EA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Lx={randomUUID:EA};function CA(t,s,n){var l;if(Lx.randomUUID&&!t)return Lx.randomUUID();t=t||{};const i=t.random??((l=t.rng)==null?void 0:l.call(t))??TA();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,SA(i)}const nb=x.createContext(void 0),It=()=>{const t=x.useContext(nb);if(!t)throw new Error("useToast must be used within a ToastProvider");return t},AA=({children:t,position:s="bottom-right"})=>{const[n,i]=x.useState([]),l=x.useCallback(v=>{const j=CA();return i(N=>[...N,{id:j,...v}]),j},[]),c=x.useCallback(v=>{i(j=>j.filter(N=>N.id!==v))},[]),u=x.useCallback(()=>{i([])},[]),f=x.useCallback(v=>{let j,N,b;return typeof v=="string"?j=v:"userMessage"in v?(j=v.userMessage,N=v.errorId,b=v.developerMessage):"message"in v?(j=v.message,N=v.errorId,b=v.developerMessage):j="אירעה שגיאה. אנא נסה שוב מאוחר יותר.",l({type:"danger",message:j,errorId:N,developerMessage:b,autoClose:!0,autoCloseTime:6e3})},[l]),p=x.useCallback(v=>l({type:"success",message:v,autoClose:!0,autoCloseTime:4e3}),[l]),m=x.useCallback(v=>l({type:"warning",message:v,autoClose:!0,autoCloseTime:5e3}),[l]),g=x.useCallback(v=>l({type:"info",message:v,autoClose:!0,autoCloseTime:4e3}),[l]);return e.jsxs(nb.Provider,{value:{addToast:l,removeToast:c,removeAllToasts:u,showError:f,showSuccess:p,showWarning:m,showInfo:g},children:[t,e.jsx(NA,{toasts:n.map(v=>({...v,onClose:c})),position:s,onClose:c})]})};function DA(){var W;const{token:t}=Nr(),s=Ot(),{theme:n,toggleTheme:i}=jA(),{showSuccess:l,showError:c}=It(),[u,f]=x.useState(""),[p,m]=x.useState(""),[g,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[C,T]=x.useState(!0),[A,_]=x.useState(!1),[D,S]=x.useState(null),[R,E]=x.useState(null),[k,I]=x.useState({length:!1,match:!1});x.useEffect(()=>{t?M():(E("קישור ההזמנה לא תקין"),T(!1))},[t]),x.useEffect(()=>{I({length:u.length>=6,match:u===p&&u.length>0})},[u,p]);async function M(){var K,Q;if(t)try{T(!0);const ne=await zx.validateInvitation(t);w(ne.teacher),E(null)}catch(ne){console.error("Error validating invitation:",ne);const X=((Q=(K=ne==null?void 0:ne.response)==null?void 0:K.data)==null?void 0:Q.message)||"הזמנה לא תקפה או פג תוקפה";E(X),setTimeout(()=>{s("/login?error=invalid_invitation")},3e3)}finally{T(!1)}}async function z(K){var Q,ne,X,se;if(K.preventDefault(),!(!t||!b)){if(u.length<6){S("הסיסמה חייבת להכיל לפחות 6 תווים");return}if(u!==p){S("הסיסמאות אינן תואמות");return}try{_(!0),S(null);const O=await zx.acceptInvitation(t,{password:u});if(!O||!O.teacher||!O.accessToken)throw new Error("Invalid response structure from server");localStorage.setItem("accessToken",O.accessToken),O.refreshToken&&localStorage.setItem("refreshToken",O.refreshToken),localStorage.setItem("user",JSON.stringify(O.teacher));const B=((ne=(Q=O.teacher)==null?void 0:Q.personalInfo)==null?void 0:ne.fullName)||"מורה";l(`ברוכים הבאים, ${B}! החשבון שלך הוקם בהצלחה.`),s("/dashboard")}catch(O){console.error("Error accepting invitation:",O);let B="אירעה שגיאה בהגדרת הסיסמה";O!=null&&O.message?B=O.message:(se=(X=O==null?void 0:O.response)==null?void 0:X.data)!=null&&se.message&&(B=O.response.data.message),B.includes("Invalid or expired invitation token")?B="קישור ההזמנה לא תקף או פג תוקפו":B.includes("Password")&&(B="בעיה בהגדרת הסיסמה"),S(B),c(new Error(B))}finally{_(!1)}}}function Z(K){S(null),f(K.target.value)}function ee(K){S(null),m(K.target.value)}return C?e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"בודק הזמנה..."}),e.jsx("div",{className:"subtitle",children:"אנא המתן בזמן שאנו מאמתים את ההזמנה"}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]})}):R?e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"שגיאה בהזמנה"}),e.jsxs("div",{className:"error-message",children:[e.jsx(Us,{size:20}),e.jsx("span",{children:R})]}),e.jsx("div",{className:"subtitle",children:"מעביר אותך לדף ההתחברות..."})]})}):e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"הגדרת סיסמה"}),e.jsxs("div",{className:"subtitle",children:[(W=b==null?void 0:b.personalInfo)==null?void 0:W.fullName,e.jsx("br",{}),"אנא הגדירו את הסיסמה שלכם"]}),D&&e.jsxs("div",{className:"error-message",children:[e.jsx(Us,{size:20}),e.jsx("span",{children:D})]}),e.jsxs("form",{className:"form-section",onSubmit:z,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:g?"text":"password",id:"password",className:u?"has-value":"",placeholder:"",required:!0,value:u,onChange:Z,minLength:6}),e.jsx("label",{htmlFor:"password",children:"סיסמה"}),e.jsx(mr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>v(!g),"aria-label":g?"הסתר סיסמה":"הצג סיסמה",children:g?e.jsx(ni,{size:16}):e.jsx(ba,{size:16})})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:j?"text":"password",id:"confirmPassword",className:p?"has-value":"",placeholder:"",required:!0,value:p,onChange:ee,minLength:6}),e.jsx("label",{htmlFor:"confirmPassword",children:"אימות סיסמה"}),e.jsx(mr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>N(!j),"aria-label":j?"הסתר סיסמה":"הצג סיסמה",children:j?e.jsx(ni,{size:16}):e.jsx(ba,{size:16})})]}),(u||p)&&e.jsxs("div",{className:"password-validation",children:[e.jsxs("div",{className:`validation-item ${k.length?"valid":"invalid"}`,children:[e.jsx(Et,{size:16}),e.jsx("span",{children:"לפחות 6 תווים"})]}),e.jsxs("div",{className:`validation-item ${k.match?"valid":"invalid"}`,children:[e.jsx(Et,{size:16}),e.jsx("span",{children:"הסיסמאות תואמות"})]})]}),e.jsx("button",{className:"btn",type:"submit",disabled:A||!k.length||!k.match,children:A?"מגדיר סיסמה...":"הגדר סיסמה והתחבר"}),e.jsx("div",{className:"invitation-info",children:e.jsx("p",{children:"לאחר הגדרת הסיסמה תועבר לדף הראשי"})})]})]})})}function rb(t){const s={};if(t._id&&(s._id=t._id),t.personalInfo&&(s.personalInfo={...t.personalInfo}),t.roles&&(console.log("Including roles for update:",t.roles),s.roles=Array.isArray(t.roles)?[...t.roles]:[]),t.professionalInfo&&(s.professionalInfo={...t.professionalInfo}),t.isActive!==void 0&&(s.isActive=t.isActive),t.conducting&&(s.conducting={orchestraIds:Array.isArray(t.conducting.orchestraIds)?[...t.conducting.orchestraIds]:[]}),t.ensemblesIds&&(s.ensemblesIds=Array.isArray(t.ensemblesIds)?[...t.ensemblesIds]:[]),t.schoolYears&&(s.schoolYears=[...t.schoolYears]),t.teaching){if(s.teaching={},Array.isArray(t.teaching.studentIds)&&(s.teaching.studentIds=[...t.teaching.studentIds]),t.teaching.schedule&&t.teaching.schedule.length>0){const n=t.teaching.schedule.filter(i=>i.studentId&&i.day&&i.time&&typeof i.duration=="number"&&[30,45,60].includes(i.duration));n.length>0&&(s.teaching.schedule=n.map(i=>({studentId:i.studentId,day:i.day,time:i.time,duration:i.duration,...i.isActive!==void 0?{isActive:i.isActive}:{}})))}t.teaching.timeBlocks&&Array.isArray(t.teaching.timeBlocks)&&(s.teaching.timeBlocks=[...t.teaching.timeBlocks])}return console.log("Prepared teacher data for update:",JSON.stringify(s,null,2)),s}function kA(t){var n,i;const s=rb(t);return s.credentials={email:((n=t.personalInfo)==null?void 0:n.email)||((i=t.credentials)==null?void 0:i.email)||""},s.teaching||(s.teaching={studentIds:[],schedule:[]}),s}function Ed(t){return{_id:t,personalInfo:{fullName:"מורה לא זמין",phone:"",email:""},professionalInfo:{instrument:"",isActive:!1},roles:["teacher"],isActive:!1,teaching:{studentIds:[],schedule:[]},placeholder:!0}}const Jt={async getTeacherLessons(t){try{const s=await ge.get(`teachers/${t}/lessons`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher lessons for ${t}:`,s),new Error("Failed to load teacher lessons. Please try again later.")}},async getTeacherWeeklySchedule(t){try{const s=await ge.get(`teachers/${t}/weekly-schedule`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher weekly schedule for ${t}:`,s),new Error("Failed to load teacher weekly schedule. Please try again later.")}},async getTeacherDaySchedule(t,s){try{const n=await ge.get(`teachers/${t}/day-schedule/${encodeURIComponent(s)}`);return n&&n.success&&n.data?n.data:n}catch(n){throw console.error(`Failed to get teacher day schedule for ${t}, day ${s}:`,n),new Error("Failed to load teacher day schedule. Please try again later.")}},async getTeacherLessonStats(t){try{const s=await ge.get(`teachers/${t}/lesson-stats`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher lesson stats for ${t}:`,s),new Error("Failed to load teacher lesson statistics. Please try again later.")}},async getTeachers(t={}){try{const s=await ge.get("teacher",t);let n=s;return s&&s.success&&s.data&&(n=s.data),Array.isArray(n)?n:(console.warn("Teachers response is not an array:",n),[])}catch(s){throw console.error("Failed to get teachers:",s),new Error("Failed to load teachers. Please try again later.")}},async getTeacherById(t){if(!t||typeof t!="string")return console.error("Invalid teacher ID provided:",t),null;try{console.log(`Fetching teacher with ID: ${t}`);const s=await ge.get(`teacher/${t}`);let n=s;return s&&s.success&&s.data&&(n=s.data),!n||!n._id?(console.warn(`No valid teacher data found for ID ${t}`),Ed(t)):(console.log("Teacher data received:",n),n)}catch(s){return console.error(`Failed to get teacher with ID ${t}:`,s),Ed(t)}},async getTeachersByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getTeacherById(l).catch(c=>(console.error(`Failed to fetch teacher ${l}:`,c),Ed(l))));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Failed to fetch teachers by IDs:",s),t.map(n=>Ed(n))}},async getTeachersByRole(t){try{console.log(`Fetching teachers with role '${t}' from API`);const s=await ge.get(`teacher/role/${t}`);let n=s;if(s&&s.success&&s.data&&(n=s.data),!Array.isArray(n))return console.warn("API response for getTeachersByRole is not an array:",n),[];const i=n.filter(l=>l.isActive!==!1&&l.roles&&l.roles.includes(t));return console.log(`Found ${i.length} active teachers with role '${t}'`),i}catch(s){throw console.error(`Failed to get teachers with role ${t}:`,s),new Error(`Failed to load teachers with role ${t}. Please try again later.`)}},async getTeachersByOrchestraId(t){return this.getTeachers({orchestraId:t})},async getTeachersByStudentId(t){return this.getTeachers({studentId:t})},async addTeacher(t){const s=kA(t);console.log("Creating new teacher with data:",s);try{const n=await ge.post("teacher",s);let i=n;if(n&&n.success&&n.data&&(i=n.data),!i||!i._id||!i.personalInfo)throw console.error("Invalid teacher response structure:",{originalResponse:n,extractedData:i}),new Error("Invalid teacher data received from server");return console.log("Successfully created teacher:",i),i}catch(n){throw console.error("Failed to add new teacher:",n),new Error("Failed to create new teacher. Please check your inputs and try again.")}},async updateTeacher(t,s){const n=rb(s);console.log("Updating teacher with prepared data:",n);try{const i=await ge.put(`teacher/${t}`,n);let l=i;if(i&&i.success&&i.data&&(l=i.data),!l||!l._id||!l.personalInfo)throw console.error("Invalid teacher update response structure:",{originalResponse:i,extractedData:l}),new Error("Invalid teacher data received from server");return console.log("Successfully updated teacher:",l),l}catch(i){throw console.error(`Failed to update teacher ${t}:`,i),new Error("Failed to update teacher information. Please try again later.")}},async removeTeacher(t){try{return await ge.delete(`teacher/${t}`)}catch(s){throw console.error(`Failed to remove teacher ${t}:`,s),new Error("Failed to remove teacher. Please try again later.")}},async addOrchestra(t,s){try{return await ge.post(`teacher/${t}/orchestra`,{orchestraId:s})}catch(n){throw console.error(`Failed to add orchestra ${s} to teacher ${t}:`,n),new Error("Failed to associate orchestra with teacher. Please try again later.")}},async removeOrchestra(t,s){try{return await ge.delete(`teacher/${t}/orchestra/${s}`)}catch(n){throw console.error(`Failed to remove orchestra ${s} from teacher ${t}:`,n),new Error("Failed to remove orchestra from teacher. Please try again later.")}},async removeStudentFromTeacher(t,s){try{return await ge.delete(`teacher/${t}/student/${s}`)}catch(n){throw console.error(`Failed to remove student ${s} from teacher ${t}:`,n),new Error("Failed to remove student from teacher. Please try again later.")}}},Pd=Object.freeze(Object.defineProperty({__proto__:null,teacherService:Jt},Symbol.toStringTag,{value:"Module"})),Ds=Fa((t,s)=>({teachers:[],selectedTeacher:null,isLoading:!1,error:null,dataInitialized:!1,loadTeachers:async(n={})=>{t({isLoading:!0,error:null});try{const i=await Jt.getTeachers(n);return t({teachers:i,isLoading:!1,dataInitialized:!0}),i}catch(i){const l=i instanceof Error?i.message:"Failed to load teachers";throw t({error:l,isLoading:!1}),i}},loadBasicTeacherData:async()=>{if(!s().dataInitialized){console.log("Initializing basic teacher data..."),t({isLoading:!0,error:null});try{const n=await Jt.getTeachers({isActive:!0});t({teachers:n,isLoading:!1,dataInitialized:!0}),console.log(`Loaded ${n.length} teachers successfully`)}catch(n){const i=n instanceof Error?n.message:"Failed to load essential teacher data";t({error:i,isLoading:!1}),console.error("Teacher data initialization failed:",i)}}},loadTeacherByRole:async n=>{console.log(`Loading teachers with role: ${n}`),t({isLoading:!0,error:null});try{const i=s().teachers.filter(f=>f.roles&&f.roles.includes(n)&&f.isActive);if(i.length>0)return console.log(`Found ${i.length} cached teachers with role ${n}`),t({isLoading:!1}),i;console.log(`Fetching teachers with role ${n} from API`);const l=await Jt.getTeachersByRole(n),u=[...s().teachers];return l.forEach(f=>{const p=u.findIndex(m=>m._id===f._id);p>=0?u[p]=f:u.push(f)}),t({teachers:u,isLoading:!1}),l}catch(i){const l=i instanceof Error?i.message:`Failed to load teachers with role ${n}`;return t({error:l,isLoading:!1}),console.error(`Error loading teachers with role ${n}:`,i),[]}},loadTeacherById:async n=>{t({isLoading:!0,error:null});try{const i=s().teachers.find(u=>u._id===n);if(i)return t({selectedTeacher:i,isLoading:!1}),i;const l=await Jt.getTeacherById(n),c=[...s().teachers];if(l){const u=c.findIndex(f=>f._id===l._id);u>=0?c[u]=l:c.push(l)}return t({selectedTeacher:l,teachers:c,isLoading:!1}),l}catch(i){const l=i instanceof Error?i.message:"Failed to load teacher";throw t({error:l,isLoading:!1}),i}},saveTeacher:async(n,i)=>{var l,c,u,f,p;t({isLoading:!0,error:null});try{let m;const g=i||n._id;if(g?(console.log("🎯 FORCE UPDATE MODE - teacherId:",g),m=await Jt.updateTeacher(g,n)):(console.log("🎯 CREATE MODE - no ID found"),m=await Jt.addTeacher(n)),!g&&m.invitationInfo){const{invitationInfo:b}=m;b.mode==="DEFAULT_PASSWORD"&&console.log("Teacher created with default password:",{email:((l=m.credentials)==null?void 0:l.email)||m.personalInfo.email,password:b.defaultPassword,requiresPasswordChange:b.requiresPasswordChange})}if(!m||!m._id||!m.personalInfo)throw console.error("Invalid teacher structure returned from API:",{hasData:!!m,hasId:!!(m!=null&&m._id),hasPersonalInfo:!!(m!=null&&m.personalInfo),fullData:m}),new Error("Invalid teacher data received from server");console.log("Teacher saved successfully with structure:",{id:m._id,personalInfo:m.personalInfo,roles:m.roles});let v=m;if(g){console.log("🔄 Reloading complete teacher data after save to get time block assignments...");try{const b=await Jt.getTeacherById(g);b&&!b.placeholder&&(v=b,console.log("✅ Teacher data refreshed with time blocks:",{timeBlocks:((u=(c=v.teaching)==null?void 0:c.timeBlocks)==null?void 0:u.length)||0,totalAssignedLessons:((p=(f=v.teaching)==null?void 0:f.timeBlocks)==null?void 0:p.reduce((w,C)=>{var T;return w+(((T=C.assignedLessons)==null?void 0:T.length)||0)},0))||0}))}catch(b){console.warn("Failed to refresh teacher data after save, using response data:",b)}}const j=[...s().teachers],N=j.findIndex(b=>b._id===v._id);return N>=0?j[N]=v:j.push(v),t({teachers:j,selectedTeacher:null,isLoading:!1}),console.log("Teacher saved successfully, cleared selectedTeacher"),v}catch(m){const g=m instanceof Error?m.message:"Failed to save teacher";throw t({error:g,isLoading:!1}),m}},removeTeacher:async n=>{var i;t({isLoading:!0,error:null});try{await Jt.removeTeacher(n);const l=s().teachers.filter(c=>c._id!==n);t({teachers:l,selectedTeacher:((i=s().selectedTeacher)==null?void 0:i._id)===n?null:s().selectedTeacher,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove teacher";throw t({error:c,isLoading:!1}),l}},setSelectedTeacher:n=>{var i;console.log("Setting selected teacher:",((i=n==null?void 0:n.personalInfo)==null?void 0:i.fullName)||"null"),t({selectedTeacher:n})},clearError:()=>{t({error:null})},clearSelectedTeacher:()=>{console.log("Clearing selected teacher"),t({selectedTeacher:null})}})),_A=["Workshop","Seminar","Conference","Networking Event","Other"],OA=["Morning (9AM - 12PM)","Afternoon (1PM - 4PM)","Evening (5PM - 8PM)"];function IA(){const[t,s]=x.useState({firstName:"",lastName:"",email:"",phone:"",topic:"",preferredSlot:""}),[n,i]=x.useState(!1),l=u=>{const{name:f,value:p}=u.target;s(m=>({...m,[f]:p}))},c=async u=>{u.preventDefault(),i(!0);try{await new Promise(f=>setTimeout(f,1e3)),s({firstName:"",lastName:"",email:"",phone:"",topic:"",preferredSlot:""}),alert("Registration successful!")}catch{alert("Registration failed. Please try again.")}finally{i(!1)}};return e.jsx("div",{className:"event-registration-page",children:e.jsxs("div",{className:"glass-form",children:[e.jsx("h2",{children:"Event Registration"}),e.jsx("p",{children:"Register with us to get more details."}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Name"}),e.jsxs("div",{className:"form-row two-columns",children:[e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"firstName",value:t.firstName,onChange:l,placeholder:"First",required:!0})}),e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"lastName",value:t.lastName,onChange:l,placeholder:"Last",required:!0})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:l,placeholder:"email@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:l,placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Topic"}),e.jsxs("select",{name:"topic",value:t.topic,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select a topic"}),_A.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Preferred Slot"}),e.jsxs("select",{name:"preferredSlot",value:t.preferredSlot,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select a time"}),OA.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn-submit",disabled:n,children:n?"Submitting...":"Sign me up"})})]})]})})}const $A=()=>{const{addToast:t}=It(),s=()=>{t({type:"success",message:"This is a success toast",onUndo:()=>console.log("Undo clicked")})},n=()=>{t({type:"warning",message:"This is a warning toast"})},i=()=>{t({type:"danger",message:"This is a danger toast"})},l=()=>{t({type:"info",message:"This is an info toast"})};return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx("h2",{children:"Toast Test"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:s,children:"Success Toast"}),e.jsx("button",{onClick:n,children:"Warning Toast"}),e.jsx("button",{onClick:i,children:"Danger Toast"}),e.jsx("button",{onClick:l,children:"Info Toast"})]})]})},RA="/assets/logo-reKfKP0d.png",na=Fa((t,s)=>({schoolYears:[],currentSchoolYear:null,isLoading:!1,error:null,loadSchoolYears:async()=>{t({isLoading:!0,error:null});try{const n=await ge.get("school-year");return t({schoolYears:n,isLoading:!1}),n}catch(n){const i=n instanceof Error?n.message:"Failed to load school years";return t({error:i,isLoading:!1}),console.error("Error loading school years:",n),[]}},loadCurrentSchoolYear:async()=>{var n;return(n=s().currentSchoolYear)!=null&&n._id?(console.log("Using cached school year:",s().currentSchoolYear),s().currentSchoolYear):s().fetchCurrentSchoolYear()},fetchCurrentSchoolYear:async()=>{t({isLoading:!0,error:null});try{console.log("Fetching current school year from API...");const n=await ge.get("school-year/current");if(console.log("API returned school year:",n),!n||!n._id)throw new Error("Failed to load current school year - API returned empty data");return t({currentSchoolYear:n,isLoading:!1}),n}catch(n){const i=n instanceof Error?n.message:"Failed to load current school year";return t({error:i,isLoading:!1}),console.error("Error loading current school year:",n),null}},setCurrentSchoolYear:async n=>{t({isLoading:!0,error:null});try{const i=await ge.put(`school-year/${n}/set-current`);t({currentSchoolYear:i});const c=s().schoolYears.map(u=>({...u,isCurrent:u._id===n}));t({schoolYears:c,isLoading:!1}),window.location.reload()}catch(i){const l=i instanceof Error?i.message:"Failed to set current school year";t({error:l,isLoading:!1}),console.error("Error setting current school year:",i)}},clearError:()=>{t({error:null})}}));function MA(){const{schoolYears:t,currentSchoolYear:s,isLoading:n,error:i,loadSchoolYears:l,setCurrentSchoolYear:c,clearError:u}=na(),[f,p]=x.useState(!1);x.useEffect(()=>{l()},[l]),x.useEffect(()=>{t.length>0&&!s&&na.getState().fetchCurrentSchoolYear()},[t,s]),x.useEffect(()=>{function v(j){j.target.closest(".school-year-selector")||p(!1)}if(f)return document.addEventListener("click",v),()=>document.removeEventListener("click",v)},[f]);const m=async v=>{if(v===(s==null?void 0:s._id)){p(!1);return}try{await c(v)}catch(j){console.error("Failed to change school year:",j)}finally{p(!1)}},g=()=>{i&&u(),p(!f)};return!s&&!n?e.jsx("div",{className:"school-year-selector",children:e.jsx("div",{className:"school-year-button",children:e.jsx("span",{className:"school-year-text",children:"טוען שנת לימודים..."})})}):e.jsxs("div",{className:"school-year-selector",children:[e.jsxs("button",{className:`school-year-button ${f?"active":""} ${n?"loading":""}`,onClick:g,disabled:n,"aria-label":"בחר שנת לימודים",type:"button",children:[e.jsx("span",{className:"school-year-text",children:n?"טוען...":(s==null?void 0:s.name)||"שנת לימודים"}),e.jsx(gt,{className:`school-year-icon ${f?"rotated":""}`,size:14})]}),f&&e.jsxs("div",{className:"school-year-dropdown",children:[i&&e.jsx("div",{className:"school-year-error",children:"שגיאה בטעינת שנות הלימודים"}),t.length>0?e.jsx("ul",{className:"school-year-list",children:t.map(v=>e.jsx("li",{children:e.jsxs("button",{className:`school-year-option ${v._id===(s==null?void 0:s._id)?"current":""}`,onClick:()=>m(v._id),disabled:n,type:"button",children:[e.jsx("span",{className:"school-year-name",children:v.name}),v._id===(s==null?void 0:s._id)&&e.jsx("span",{className:"current-indicator",children:"נוכחי"})]})},v._id))}):!i&&e.jsx("div",{className:"no-school-years",children:"לא נמצאו שנות לימודים"})]})]})}function Rn(){const[t,s]=x.useState(!1),{user:n,logout:i}=vs(),l=x.useRef(null);x.useEffect(()=>{function p(m){l.current&&!l.current.contains(m.target)&&s(!1)}return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[]);function c(){i()}function u(){s(p=>!p)}const f=n!=null&&n.fullName?n.fullName.trim().split(" ").filter(p=>p.length>0).map(p=>p[0]).join("").substring(0,2).toUpperCase():"U";return e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-container",children:[e.jsxs("div",{className:"right-section",style:{display:"flex",alignItems:"center"},children:[n&&e.jsxs("div",{className:"user-container",ref:l,children:[e.jsx("div",{className:"avatar-wrapper",onClick:u,children:e.jsx("div",{className:"avatar-circle",children:n.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:"Avatar",className:"user-avatar"}):e.jsx("div",{className:"avatar-placeholder",children:f})})}),t&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:n.fullName}),e.jsx("div",{className:"user-email",children:n.email})]}),e.jsxs(Wr,{to:"/profile",className:"dropdown-item",children:[e.jsx(We,{className:"dropdown-icon",strokeWidth:2}),e.jsx("span",{children:"פרופיל אישי"})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item logout-btn",onClick:c,children:[e.jsx(QT,{className:"dropdown-icon",strokeWidth:2}),e.jsx("span",{children:"התנתק"})]})]})]}),e.jsx(Wr,{to:"/dashboard",className:"dashboard-link","aria-label":"Dashboard",children:e.jsx(ym,{className:"icon"})}),n&&e.jsx(Wr,{to:"/profile?openSchedule=true",className:"schedule-link","aria-label":"מערכת שעות שבועית",title:"מערכת שעות שבועית",children:e.jsx($e,{className:"icon"})})]}),e.jsx("div",{className:"center-section",children:e.jsx(MA,{})}),e.jsx("div",{className:"logo-container",children:e.jsx(Wr,{to:"/dashboard",className:"logo-link",children:e.jsx("img",{src:RA,alt:"Logo",className:"logo-image"})})})]})})}function mi(){const s=ys().pathname,n=[{path:"/teachers",label:"מורים",icon:pr},{path:"/students",label:"תלמידים",icon:ps},{path:"/theory",label:"תאוריה",icon:Vt},{path:"/bagrut",label:"בגרות",icon:ms},{path:"/orchestras",label:"תזמורות",icon:Je},{path:"/rehearsals",label:"לוח חזרות",icon:$e}];return e.jsx("nav",{className:"bottom-nav visible",children:e.jsx("div",{className:"nav-items",children:n.map(i=>{const l=s===i.path||i.path==="/theory"&&s==="/"||s.startsWith(i.path);return e.jsxs(Wr,{to:i.path,className:`nav-item ${l?"active":""}`,"aria-label":i.label,children:[e.jsx(i.icon,{className:"nav-icon",strokeWidth:2}),e.jsx("span",{className:"nav-label",children:i.label})]},i.path)})})})}const Wf={async getStudentAttendanceStats(t,s){return ge.get(`orchestra/${t}/student/${s}/attendance`)},async getAttendanceDashboardData(){try{const[t,s]=await Promise.all([ge.get("rehearsal"),ge.get("orchestra")]),n=this.calculateOverallStats(t,s),i=this.calculateOrchestraOverviews(t,s),l=this.findRecentLowAttendance(t,s);return{overallStats:n,orchestraOverviews:i,recentLowAttendance:l}}catch(t){throw console.error("Failed to fetch attendance dashboard data:",t),t}},async getOrchestraAttendanceOverview(t){try{const[s,n]=await Promise.all([ge.get(`rehearsal/orchestra/${t}`),ge.get(`orchestra/${t}`)]);return this.calculateSingleOrchestraOverview(s,n)}catch(s){throw console.error("Failed to fetch orchestra attendance overview:",s),s}},calculateOverallStats(t,s){const n=s.length,i=t.length;let l=0,c=0,u=0;t.forEach(p=>{if(p.attendance&&Array.isArray(p.attendance.present)){const m=s.find(g=>g._id===p.groupId);if(m&&m.memberIds){const g=m.memberIds.length,v=p.attendance.present.length,j=g>0?v/g*100:0;l+=j,c++,j<60&&u++}}});const f=c>0?Math.round(l/c):0;return{totalOrchestras:n,totalRehearsals:i,averageAttendanceRate:f,lowAttendanceCount:u}},calculateOrchestraOverviews(t,s){return s.map(n=>this.calculateSingleOrchestraOverview(t.filter(i=>i.groupId===n._id),n))},calculateSingleOrchestraOverview(t,s){const n=s.memberIds?s.memberIds.length:0,i=t.length;let l=0,c=0;const u=[],f=[];[...t].sort((g,v)=>new Date(v.date).getTime()-new Date(g.date).getTime()).forEach(g=>{if(g.attendance&&Array.isArray(g.attendance.present)){const v=g.attendance.present.length,j=g.attendance.absent?g.attendance.absent.length:0,N=n>0?Math.round(v/n*100):0;l+=N,c++,u.length<5&&u.push({rehearsalId:g._id,date:g.date,presentCount:v,absentCount:j,attendanceRate:N}),N<60&&f.push({rehearsalId:g._id,date:g.date,attendanceRate:N})}});const m=c>0?Math.round(l/c):0;return{orchestraId:s._id,orchestraName:s.name,totalRehearsals:i,averageAttendanceRate:m,totalStudents:n,recentRehearsals:u,lowAttendanceAlerts:f.slice(0,3)}},findRecentLowAttendance(t,s){const n=[],i=new Date;return t.forEach(l=>{const c=new Date(l.date),u=l.attendance&&(Array.isArray(l.attendance.present)||Array.isArray(l.attendance.absent));if(c<i&&u){const f=s.find(p=>p._id===l.groupId);if(f&&f.memberIds){const p=f.memberIds.length,m=l.attendance.present?l.attendance.present.length:0,g=p>0?Math.round(m/p*100):0;n.push({orchestraName:f.name,rehearsalDate:l.date,attendanceRate:g,rehearsalId:l._id,orchestraId:f._id})}}}),n.sort((l,c)=>new Date(c.rehearsalDate).getTime()-new Date(l.rehearsalDate).getTime()).slice(0,5)}},zA=Fa((t,s)=>({dashboardData:null,orchestraOverviews:[],studentAttendanceStats:{},isLoadingDashboard:!1,isLoadingOrchestraOverview:!1,isLoadingStudentStats:!1,error:null,loadDashboardData:async()=>{t({isLoadingDashboard:!0,error:null});try{const n=await Wf.getAttendanceDashboardData();t({dashboardData:n,orchestraOverviews:n.orchestraOverviews,isLoadingDashboard:!1})}catch(n){console.error("Failed to load attendance dashboard data:",n),t({error:n.message||"Failed to load attendance data",isLoadingDashboard:!1})}},loadOrchestraAttendanceOverview:async n=>{t({isLoadingOrchestraOverview:!0,error:null});try{const i=await Wf.getOrchestraAttendanceOverview(n),c=s().orchestraOverviews.filter(u=>u.orchestraId!==n);c.push(i),t({orchestraOverviews:c,isLoadingOrchestraOverview:!1})}catch(i){console.error("Failed to load orchestra attendance overview:",i),t({error:i.message||"Failed to load orchestra attendance data",isLoadingOrchestraOverview:!1})}},loadStudentAttendanceStats:async(n,i)=>{t({isLoadingStudentStats:!0,error:null});try{const l=await Wf.getStudentAttendanceStats(n,i),c=`${n}-${i}`;t(u=>({studentAttendanceStats:{...u.studentAttendanceStats,[c]:l},isLoadingStudentStats:!1}))}catch(l){console.error("Failed to load student attendance stats:",l),t({error:l.message||"Failed to load student attendance stats",isLoadingStudentStats:!1})}},clearError:()=>{t({error:null})},clearDashboardData:()=>{t({dashboardData:null,orchestraOverviews:[],studentAttendanceStats:{}})}}));function Ta({isOpen:t,onClose:s,children:n,className:i=""}){const[l,c]=x.useState(!1),[u,f]=x.useState(null);if(x.useEffect(()=>{let g=document.getElementById("modal-portal-root");return g||(g=document.createElement("div"),g.id="modal-portal-root",g.className="modal-portal",document.body.appendChild(g)),f(g),()=>{const v=document.getElementById("modal-portal-root");v&&!v.hasChildNodes()&&document.body.removeChild(v)}},[]),x.useEffect(()=>{if(t){document.body.style.overflow="hidden",document.body.style.paddingRight=`${window.innerWidth-document.documentElement.clientWidth}px`;const g=document.getElementById("modal-portal-root");g&&g.classList.add("modal-active"),requestAnimationFrame(()=>{c(!0)})}else{c(!1);const g=document.getElementById("modal-portal-root");g&&g.classList.remove("modal-active");const v=setTimeout(()=>{document.body.style.overflow="",document.body.style.paddingRight=""},300);return()=>clearTimeout(v)}},[t]),x.useEffect(()=>{const g=v=>{v.key==="Escape"&&t&&s()};if(t)return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,s]),!t||!u)return null;const p=g=>{g.target===g.currentTarget&&s()},m=e.jsx("div",{className:`modal-overlay ${l?"modal-overlay-visible":""}`,onClick:p,children:e.jsx("div",{className:`modal-content ${i}`,children:n})});return aT.createPortal(m,u)}const Ws={async getRehearsals(t={}){return ge.get("rehearsal",t)},async getRehearsalById(t){return ge.get(`rehearsal/${t}`)},async getRehearsalsByOrchestraId(t){return this.getRehearsals({groupId:t})},async addRehearsal(t){if(t.type||(t.type="תזמורת"),t.date&&!t.dayOfWeek){const s=new Date(t.date);t.dayOfWeek=s.getDay()}if(!t.schoolYearId)throw new Error("School year ID is required for rehearsal creation");return console.log("Adding rehearsal with data:",t),ge.post("rehearsal",t)},async updateRehearsal(t,s){const{_id:n,...i}=s;if(s.date&&!s.dayOfWeek){const l=new Date(s.date);i.dayOfWeek=l.getDay()}return ge.put(`rehearsal/${t}`,i)},async removeRehearsal(t){if(!t)throw new Error("Invalid rehearsal ID");return ge.delete(`rehearsal/${t}`)},async removeRehearsalsByOrchestra(t){var s;if(!t)throw new Error("Invalid orchestra ID");try{console.log("Attempting bulk delete for orchestra:",t);const n=await ge.delete(`rehearsal/orchestra/${t}`);return console.log("Bulk delete successful:",n),n}catch(n){if(console.log("Bulk delete failed, error:",n),n.status===404||((s=n.response)==null?void 0:s.status)===404){console.log("Bulk delete endpoint not available (404), falling back to individual deletions");const i=await this.getRehearsals({groupId:t});if(console.log(`Found ${i.length} rehearsals to delete for orchestra ${t}`),i.length===0)return{deletedCount:0};let l=0;const c=i.map(async u=>{try{await this.removeRehearsal(u._id),l++,console.log(`Successfully deleted rehearsal ${u._id}`)}catch(f){console.error(`Failed to delete rehearsal ${u._id}:`,f)}});return await Promise.allSettled(c),console.log(`Fallback deletion completed: ${l} out of ${i.length} rehearsals deleted`),{deletedCount:l}}throw n}},async updateRehearsalsByOrchestra(t,s){var n;if(!t)throw new Error("Invalid orchestra ID");try{console.log("Attempting bulk update for orchestra:",t,"with updates:",s);const i=await ge.put(`rehearsal/orchestra/${t}`,s);return console.log("Bulk update successful:",i),i}catch(i){if(console.log("Bulk update failed, error:",i),i.status===404||((n=i.response)==null?void 0:n.status)===404){console.log("Bulk update endpoint not available (404), falling back to individual updates");const l=await this.getRehearsals({groupId:t});if(console.log(`Found ${l.length} rehearsals to update for orchestra ${t}`),l.length===0)return{updatedCount:0};let c=0;const u=l.map(async f=>{try{await this.updateRehearsal(f._id,s),c++,console.log(`Successfully updated rehearsal ${f._id}`)}catch(p){console.error(`Failed to update rehearsal ${f._id}:`,p)}});return await Promise.allSettled(u),console.log(`Fallback update completed: ${c} out of ${l.length} rehearsals updated`),{updatedCount:c}}throw i}},async bulkCreateRehearsals(t){try{if(!t.orchestraId)throw new Error("Orchestra ID is required for bulk rehearsal creation");if(!t.schoolYearId)throw new Error("School year ID is required for bulk rehearsal creation");if(!t.startDate||!t.endDate)throw new Error("Start date and end date are required for bulk rehearsal creation");const s=Number(t.dayOfWeek);if(isNaN(s)||s<0||s>6)throw new Error("Day of week must be a number between 0 and 6");const n={orchestraId:t.orchestraId,startDate:t.startDate,endDate:t.endDate,dayOfWeek:s,startTime:t.startTime,endTime:t.endTime,location:t.location,notes:t.notes||"",excludeDates:t.excludeDates||[],schoolYearId:t.schoolYearId};console.log("Sending bulk create data:",n);const i=localStorage.getItem("accessToken");if(!i)throw new Error("Authentication required for bulk rehearsal creation");return await ge.post("rehearsal/bulk-create",n,{headers:{Authorization:`Bearer ${i}`}})}catch(s){throw console.error("Error in bulk create:",s),s}},async updateAttendance(t,s){return ge.put(`rehearsal/${t}/attendance`,s)},async getAttendance(t){return ge.get(`rehearsal/${t}/attendance`)},formatDate(t){return t.toISOString().split("T")[0]},formatTime(t){return t.toTimeString().slice(0,5)},formatDateForDisplay(t){return new Date(t).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"})},formatTimeForDisplay(t){return t},calculateDuration(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u}},ot={async getStudents(t={}){return ge.get("student",t)},async getStudentById(t){return ge.get(`student/${t}`)},async getStudentsByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getStudentById(l).catch(c=>(console.error(`Failed to fetch student ${l}:`,c),null)));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Error fetching students by IDs:",s),[]}},async getStudentsByOrchestraId(t){return this.getStudents({orchestraId:t})},async getStudentsByTeacherId(t){return this.getStudents({teacherId:t})},async addStudent(t){const{_id:s,...n}=t;return ge.post("student",n)},async updateStudent(t,s){const{createdAt:n,updatedAt:i,...l}=s;return l._id&&delete l._id,l.teacherAssignments&&(l.teacherAssignments=l.teacherAssignments.map(c=>{const{createdAt:u,updatedAt:f,...p}=c;return p})),l.theoryLessonAssignments&&(l.theoryLessonAssignments=l.theoryLessonAssignments.map(c=>{const{createdAt:u,updatedAt:f,...p}=c;return p})),console.log(`Updating student with ID: ${t}`),console.log("Clean update data:",l),ge.put(`student/${t}`,l)},async removeStudent(t){return ge.delete(`student/${t}`)},async getStudentAttendanceStats(t,s){try{return ge.get(`orchestra/${t}/student/${s}/attendance`)}catch(n){return console.error("Failed to get student attendance stats:",n),{attendanceRate:0,attended:0,totalRehearsals:0,recentHistory:[],message:"Failed to load attendance data"}}},async updateStudentTest(t,s,n,i){try{console.log(`Sending test update request: Student ID ${t}, Instrument: ${s}, Test Type: ${n}, Status: ${i}`);const l={instrumentName:s,testType:n,status:i},c=await ge.put(`student/${t}/test`,l);return console.log("Test update successful, server response:",c),c}catch(l){throw console.error("Failed to update student test status:",l),new Error(l instanceof Error?l.message:"Failed to update test status")}},async updateStudentStage(t,s,n){console.log(`Sending stage update request: Student ID ${t}, Instrument: ${s}, Stage: ${n}`),console.log("Backend endpoints for stage update not available, using local update approach");try{const i=await this.getStudentById(t),l={...i,academicInfo:{...i.academicInfo,instrumentProgress:i.academicInfo.instrumentProgress.map(c=>c.instrumentName===s?{...c,currentStage:n}:c)}};return console.log("Stage update applied locally (UI will show the change)"),console.log("Note: Backend persistence requires implementing PUT /student/:id/stage endpoint"),l}catch(i){throw console.error("Failed to update student instrument stage:",i),new Error(i instanceof Error?i.message:"Failed to update instrument stage")}}},Ra={async getOrchestras(t={}){return ge.get("orchestra",t)},async getOrchestraById(t){return ge.get(`orchestra/${t}`)},async getOrchestrasByIds(t){return!t||t.length===0?[]:(await this.getOrchestras()).filter(n=>t.includes(n._id))},async getOrchestrasByConductorId(t){return this.getOrchestras({conductorId:t})},async getOrchestrasByStudentId(t){return this.getOrchestras({memberIds:t})},async addOrchestra(t){return ge.post("orchestra",t)},async updateOrchestra(t,s){const{_id:n,...i}=s;return ge.put(`orchestra/${t}`,i)},async removeOrchestra(t){return ge.delete(`orchestra/${t}`)},async addMember(t,s){try{const n=await ge.post(`orchestra/${t}/members`,{studentId:s}),i=await ot.getStudentById(s);return i.enrollments.orchestraIds.includes(t)||await ot.updateStudent(s,{enrollments:{...i.enrollments,orchestraIds:[...i.enrollments.orchestraIds,t]}}),n}catch(n){throw console.error("Error adding member to orchestra:",n),n}},async removeMember(t,s){try{const n=await ge.delete(`orchestra/${t}/members/${s}`),i=await ot.getStudentById(s);return await ot.updateStudent(s,{enrollments:{...i.enrollments,orchestraIds:i.enrollments.orchestraIds.filter(l=>l!==t)}}),n}catch(n){throw console.error("Error removing member from orchestra:",n),n}},async updateMembers(t,s,n=[]){try{const i=await this.updateOrchestra(t,{memberIds:s}),l=s.filter(u=>!n.includes(u)),c=n.filter(u=>!s.includes(u));for(const u of l){const f=await ot.getStudentById(u);f.enrollments.orchestraIds.includes(t)||await ot.updateStudent(u,{enrollments:{...f.enrollments,orchestraIds:[...f.enrollments.orchestraIds,t]}})}for(const u of c){const f=await ot.getStudentById(u);await ot.updateStudent(u,{enrollments:{...f.enrollments,orchestraIds:f.enrollments.orchestraIds.filter(p=>p!==t)}})}return i}catch(i){throw console.error("Error updating orchestra members:",i),i}},async getRehearsalAttendance(t,s){return ge.get(`orchestra/${t}/rehearsals/${s}/attendance`)},async updateRehearsalAttendance(t,s,n){return ge.put(`orchestra/${t}/rehearsals/${s}/attendance`,n)},async getStudentAttendanceStats(t,s){return ge.get(`orchestra/${t}/student/${s}/attendance`)},async syncOrchestraMembers(t){try{const s=await this.getOrchestraById(t),l=(await ot.getStudents()).filter(f=>f.enrollments.orchestraIds.includes(t)).map(f=>f._id),c=l.filter(f=>!s.memberIds.includes(f)),u=s.memberIds.filter(f=>!l.includes(f));if(c.length>0){const f=[...s.memberIds,...c];await this.updateOrchestra(t,{memberIds:f})}for(const f of u){const p=await ot.getStudentById(f);await ot.updateStudent(f,{enrollments:{...p.enrollments,orchestraIds:p.enrollments.orchestraIds.filter(m=>m!==t)}})}}catch(s){throw console.error("Error syncing orchestra members:",s),s}},getOrchestraTypeDisplay(t){return{תזמורת:"תזמורת",הרכב:"הרכב"}[t]||t},getValidOrchestraTypes(){return["תזמורת","הרכב"]},getValidOrchestraNames(){return["תזמורת מתחילים נשיפה","תזמורת עתודה נשיפה","תזמורת צעירה נשיפה","תזמורת יצוגית נשיפה","תזמורת סימפונית"]}};function LA({isOpen:t,onClose:s,orchestraId:n,orchestraName:i,mode:l}){const[c,u]=x.useState(null),[f,p]=x.useState([]),[m,g]=x.useState(""),[v,j]=x.useState(!1),[N,b]=x.useState(null);x.useEffect(()=>{t&&(u(null),A(null),g(""),b(null),l==="last"?w():l==="by-date"&&C())},[t,n,l]);const w=async()=>{j(!0),b(null);try{const E=await Ws.getRehearsals({groupId:n});if(E.length===0){b("לא נמצאו חזרות עבור תזמורת זו");return}const k=new Date,I=E.filter(z=>{const ee=new Date(z.date)<k,W=z.attendance&&(z.attendance.present||z.attendance.absent);return ee&&W}).sort((z,Z)=>new Date(Z.date).getTime()-new Date(z.date).getTime());if(I.length===0){b("לא נמצאו חזרות שכבר התקיימו עם נתוני נוכחות עבור תזמורת זו");return}const M=I[0];await _(M._id)}catch(E){console.error("Failed to load last rehearsal attendance:",E),b("שגיאה בטעינת נתוני הנוכחות האחרונים")}finally{j(!1)}},C=async()=>{j(!0),b(null);try{const E=await Ws.getRehearsals({groupId:n}),k=new Date,I=E.filter(M=>{const Z=new Date(M.date)<k,ee=M.attendance&&(M.attendance.present||M.attendance.absent);return Z&&ee}).sort((M,z)=>new Date(z.date).getTime()-new Date(M.date).getTime());p(I),I.length===0&&b("לא נמצאו חזרות שכבר התקיימו עם נתוני נוכחות עבור תזמורת זו")}catch(E){console.error("Failed to load available rehearsals:",E),b("שגיאה בטעינת רשימת החזרות")}finally{j(!1)}},[T,A]=x.useState(null),_=async E=>{j(!0),b(null);try{const[k,I]=await Promise.all([Ws.getRehearsalById(E),Ra.getOrchestraById(n)]);if(A(k),!k.attendance||!k.attendance.present&&!k.attendance.absent){b("לא נמצאו נתוני נוכחות עבור חזרה זו");return}const M=[...k.attendance.present||[],...k.attendance.absent||[]];console.log("All student IDs:",M);const z=M.map(async se=>{try{const O=await ot.getStudentById(se);return console.log("Fetched student:",O),O}catch(O){return console.error("Failed to fetch student:",se,O),{_id:se,personalInfo:{fullName:`תלמיד ${se.slice(-4)}`},academicInfo:{instrumentProgress:[],class:""},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}}),Z=await Promise.all(z),ee=new Map(Z.map(se=>[se._id,se])),W=se=>({_id:se,personalInfo:{fullName:`תלמיד ${se.slice(-4)}`},academicInfo:{instrumentProgress:[],class:""},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),K=(k.attendance.present||[]).map(se=>{const O=ee.get(se)||W(se);return console.log("Present student mapped:",O),O}),Q=(k.attendance.absent||[]).map(se=>{const O=ee.get(se)||W(se);return console.log("Absent student mapped:",O),O}),ne=I.memberIds?I.memberIds.length:K.length+Q.length,X=ne>0?Math.round(K.length/ne*100):0;u({rehearsalId:k._id,rehearsalDate:k.date,orchestraName:I.name,present:K,absent:Q,totalStudents:ne,attendanceRate:X})}catch(k){console.error("Failed to load attendance data:",k),b("שגיאה בטעינת נתוני הנוכחות")}finally{j(!1)}},D=E=>{g(E),_(E)},S=E=>new Date(E).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),R=E=>E.startTime&&E.endTime?`${E.startTime} - ${E.endTime}`:new Date(E.date).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"});return e.jsx(Ta,{isOpen:t,onClose:s,children:e.jsxs("div",{className:"attendance-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title-section",children:[e.jsxs("h3",{className:"modal-title",children:["נוכחות - ",i]}),e.jsx("p",{className:"modal-subtitle",children:l==="last"?"נוכחות אחרונה":"נוכחות לפי תאריך"})]}),e.jsx("button",{className:"modal-close-btn",onClick:s,children:e.jsx(yt,{size:20})})]}),l==="by-date"&&!c&&e.jsxs("div",{className:"rehearsal-selector",children:[e.jsx("h4",{children:"בחר חזרה:"}),v?e.jsx("div",{className:"loading-state",children:"טוען חזרות..."}):N?e.jsx("div",{className:"error-state",children:N}):e.jsx("div",{className:"rehearsal-list",children:f.map(E=>e.jsxs("button",{className:"rehearsal-item",onClick:()=>D(E._id),children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:16}),e.jsx("span",{children:S(E.date)})]}),e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:R(E)})]})]},E._id))})]}),c&&e.jsxs("div",{className:"attendance-details",children:[e.jsxs("div",{className:"attendance-header",children:[e.jsxs("div",{className:"rehearsal-info",children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:18}),e.jsx("span",{children:S(c.rehearsalDate)})]}),e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:16}),e.jsx("span",{children:R(T||{date:c.rehearsalDate})})]})]}),e.jsxs("div",{className:"attendance-summary",children:[e.jsxs("div",{className:`attendance-rate ${c.attendanceRate>=80?"success":c.attendanceRate>=60?"warning":"danger"}`,children:[c.attendanceRate,"%"]}),e.jsx("div",{className:"attendance-stats",children:e.jsxs("span",{children:[c.present.length," נוכחים מתוך ",c.totalStudents]})})]})]}),e.jsxs("div",{className:"attendance-lists",children:[e.jsxs("div",{className:"present-students",children:[e.jsxs("div",{className:"list-header",children:[e.jsx(wE,{size:18,className:"present-icon"}),e.jsxs("h4",{children:["נוכחים (",c.present.length,")"]})]}),e.jsx("div",{className:"students-list",children:c.present.map(E=>{var k;return console.log("Present student:",E),e.jsx("div",{className:"student-item present",children:e.jsx("div",{className:"student-name",children:((k=E.personalInfo)==null?void 0:k.fullName)||`תלמיד ${E._id.slice(-4)}`})},E._id)})})]}),e.jsxs("div",{className:"absent-students",children:[e.jsxs("div",{className:"list-header",children:[e.jsx(AE,{size:18,className:"absent-icon"}),e.jsxs("h4",{children:["נעדרים (",c.absent.length,")"]})]}),e.jsx("div",{className:"students-list",children:c.absent.map(E=>{var k;return console.log("Absent student:",E),e.jsx("div",{className:"student-item absent",children:e.jsx("div",{className:"student-name",children:((k=E.personalInfo)==null?void 0:k.fullName)||`תלמיד ${E._id.slice(-4)}`})},E._id)})})]})]}),l==="by-date"&&e.jsx("button",{className:"back-btn",onClick:()=>{u(null),g("")},children:"חזור לבחירת חזרה"})]}),v&&l==="last"&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען נתוני נוכחות..."})]}),N&&l==="last"&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:N}),e.jsx("button",{onClick:w,children:"נסה שוב"})]})]})})}const dl={markAttendance:async(t,s)=>{if(!t)throw new Error("מזהה שיעור חסר או לא תקין");if(!s.status)throw new Error("סטטוס נוכחות חסר");try{return await ge.put(`lessons/${t}/attendance`,s)}catch(n){console.error("Error marking attendance:",n);const i=Ms(n);throw new Error(i.userMessage||"שגיאה בעידכון הנוכחות")}},getLessonAttendance:async t=>{var s;if(!t)throw new Error("מזהה שיעור חסר או לא תקין");try{return await ge.get(`lessons/${t}/attendance`)}catch(n){if(((s=n==null?void 0:n.response)==null?void 0:s.status)===404||(n==null?void 0:n.status)===404)return null;console.error("Error loading lesson attendance:",n);const i=Ms(n);throw new Error(i.userMessage||"שגיאה בטעינת נתוני הנוכחות")}},getStudentStats:async(t,s)=>{if(!t)throw new Error("מזהה תלמיד חסר או לא תקין");try{const n=s?{teacherId:s}:{};return await ge.get(`students/${t}/private-lesson-attendance`,n)}catch(n){console.error("Error loading student attendance stats:",n);const i=Ms(n);throw new Error(i.userMessage||"שגיאה בטעינת סטטיסטיקות הנוכחות")}},getTeacherDashboard:async(t,s)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");try{return await ge.get(`analytics/teachers/${t}/attendance`,s||{})}catch(n){console.error("Error loading teacher dashboard:",n);const i=Ms(n);throw new Error(i.userMessage||"שגיאה בטעינת לוח הבקרה")}},getStudentAttendanceHistory:async(t,s,n)=>{if(!t)throw new Error("מזהה תלמיד חסר או לא תקין");try{const i={};return s&&(i.teacherId=s),n&&n>0&&(i.limit=Math.min(n,1e3)),await ge.get(`students/${t}/attendance-history`,i)}catch(i){console.error("Error loading attendance history:",i);const l=Ms(i);throw new Error(l.userMessage||"שגיאה בטעינת היסטוריית הנוכחות")}},bulkMarkAttendance:async(t,s)=>{if(!t)throw new Error("מזהה שיעור חסר או לא תקין");if(!s||s.length===0)throw new Error("רשימת נוכחות ריקה");for(const n of s){if(!n.studentId)throw new Error("מזהה תלמיד חסר ברשימת הנוכחות");if(!n.status)throw new Error("סטטוס נוכחות חסר ברשימת הנוכחות")}try{return await ge.put(`attendance/lessons/${t}/bulk`,{attendanceList:s})}catch(n){console.error("Error bulk marking attendance:",n);const i=Ms(n);throw new Error(i.userMessage||"שגיאה בעידכון נוכחות קבוצתי")}},getTeacherAttendanceOverview:async(t,s,n)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");try{const i={};s&&(i.startDate=s),n&&(i.endDate=n);const l=await ge.get(`teachers/${t}/lesson-attendance-summary`,i);return!l||typeof l!="object"?(console.warn("Invalid response format from teacher attendance overview API:",l),{teacherId:t,dateRange:{startDate:"",endDate:""},overallStats:{totalLessons:0,attendedLessons:0,missedLessons:0,cancelledLessons:0,attendanceRate:0},studentStats:{}}):l}catch(i){console.error("Error loading teacher attendance overview:",i);const l=Ms(i);throw new Error(l.userMessage||"שגיאה בטעינת סקירת נוכחות המורה")}},getAttendanceSummary:async(t,s,n)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");if(!s||!n)throw new Error("תאריכי טווח חסרים");const i=new Date(s),l=new Date(n);if(isNaN(i.getTime())||isNaN(l.getTime()))throw new Error("פורמט תאריך לא תקין");if(i>l)throw new Error("תאריך התחלה חייב להיות לפני תאריך הסיום");const c=365*24*60*60*1e3;if(l.getTime()-i.getTime()>c)throw new Error("טווח תאריכים גדול מדי (מקסימום שנה)");try{return await ge.get(`analytics/teachers/${t}/attendance/summary`,{startDate:s,endDate:n})}catch(u){console.error("Error loading attendance summary:",u);const f=Ms(u);throw new Error(f.userMessage||"שגיאה בטעינת סיכום הנוכחות")}},getAllTeachers:async()=>{try{return await ge.get("teacher")}catch(t){console.error("Error loading teachers:",t);const s=Ms(t);throw new Error(s.userMessage||"שגיאה בטעינת רשימת המורים")}}},BA=({isOpen:t,onClose:s,teacherId:n,teacherName:i})=>{const[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState(null);x.useEffect(()=>{t&&n?g():(c(null),m(null))},[t,n]);const g=async()=>{var C,T,A,_,D;f(!0),m(null);try{console.log(`Loading teacher attendance modal data for: ${i} (${n})`);const S=await dl.getTeacherAttendanceOverview(n);if(console.log(`Teacher modal data for ${i}:`,JSON.stringify(S,null,2)),S&&typeof S=="object"){const R={teacherId:S.teacherId||n,dateRange:S.dateRange||{startDate:"",endDate:""},overallStats:{totalLessons:((C=S.overallStats)==null?void 0:C.totalLessons)||0,attendedLessons:((T=S.overallStats)==null?void 0:T.attendedLessons)||0,missedLessons:((A=S.overallStats)==null?void 0:A.missedLessons)||0,cancelledLessons:((_=S.overallStats)==null?void 0:_.cancelledLessons)||0,attendanceRate:((D=S.overallStats)==null?void 0:D.attendanceRate)||0},studentStats:S.studentStats||{}};c(R)}else console.warn(`Invalid response format for teacher ${i}:`,S),m("מבנה נתונים לא תקין מהשרת")}catch(S){console.error(`Error loading teacher modal data for ${i}:`,S),m(S.message||"שגיאה בטעינת נתוני נוכחות המורה")}finally{f(!1)}},v=C=>typeof C=="string"?C:`${Math.round(C)}%`,j=C=>{const T=typeof C=="string"?parseFloat(C):C;return T>=90?"success":T>=80?"warning":(T>=70,"danger")},N=C=>(typeof C=="string"?parseFloat(C):C)>=80?e.jsx(ll,{size:16,className:"attendance-icon success"}):e.jsx(zd,{size:16,className:"attendance-icon danger"}),b=C=>{const T=new Date(C.startDate),A=new Date(C.endDate),_=D=>D.toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"});return`${_(T)} - ${_(A)}`},w=()=>{if(!(l!=null&&l.studentStats))return e.jsxs("div",{className:"no-students",children:[e.jsx(ps,{size:48,className:"no-data-icon"}),e.jsx("p",{children:"אין נתוני נוכחות זמינים"})]});const C=Object.entries(l.studentStats);return C.length===0?e.jsxs("div",{className:"no-students",children:[e.jsx(ps,{size:48,className:"no-data-icon"}),e.jsx("p",{children:"אין תלמידים עם נתוני נוכחות בתקופה זו"})]}):e.jsx("div",{className:"students-grid",children:C.map(([T,A])=>e.jsxs("div",{className:"student-attendance-card",children:[e.jsxs("div",{className:"student-header",children:[e.jsx("div",{className:"student-avatar",children:e.jsx(We,{size:24})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h4",{className:"student-name",children:A.studentName}),e.jsxs("div",{className:`attendance-rate ${j(A.attendanceRate)}`,children:[N(parseFloat(A.attendanceRate)),e.jsx("span",{children:v(A.attendanceRate)})]})]})]}),e.jsxs("div",{className:"student-metrics",children:[e.jsx("div",{className:"metric-row",children:e.jsxs("div",{className:"metric",children:[e.jsx(Vt,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:'סה"כ שיעורים'}),e.jsx("span",{className:"metric-value",children:A.totalLessons})]})}),e.jsxs("div",{className:"metric-row",children:[e.jsxs("div",{className:"metric success",children:[e.jsx(ll,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:"הגיעו"}),e.jsx("span",{className:"metric-value",children:A.attendedLessons})]}),e.jsxs("div",{className:"metric danger",children:[e.jsx(zd,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:"חסרו"}),e.jsx("span",{className:"metric-value",children:A.missedLessons})]})]})]})]},T))})};return e.jsx(Ta,{isOpen:t,onClose:s,children:e.jsxs("div",{className:"teacher-attendance-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("div",{className:"teacher-avatar",children:e.jsx(We,{size:32})}),e.jsxs("div",{className:"teacher-details",children:[e.jsx("h2",{children:i}),e.jsx("span",{className:"teacher-label",children:"נוכחות שיעורים פרטיים"})]})]}),(l==null?void 0:l.dateRange)&&e.jsxs("div",{className:"date-range",children:[e.jsx($e,{size:16}),e.jsx("span",{children:b(l.dateRange)})]})]}),e.jsx("button",{className:"close-btn",onClick:s,children:e.jsx(yt,{size:24})})]}),e.jsxs("div",{className:"modal-content",children:[u&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"טוען נתוני נוכחות..."})]}),p&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:p}),e.jsx("button",{onClick:g,className:"retry-btn",children:"נסה שוב"})]}),l&&!u&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-section",children:[e.jsx("h3",{children:"סטטיסטיקות כלליות"}),l.overallStats.totalLessons>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Vt,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.totalLessons}),e.jsx("div",{className:"stat-label",children:'סה"כ שיעורים'})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ll,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.attendedLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שהתקיימו"})]})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(zd,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.missedLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שלא התקיימו"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.cancelledLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שבוטלו"})]})]})]}),e.jsx("div",{className:"overall-attendance-rate",children:e.jsxs("div",{className:`attendance-rate-display ${j(l.overallStats.attendanceRate)}`,children:[N(l.overallStats.attendanceRate),e.jsx("span",{className:"rate-value",children:v(l.overallStats.attendanceRate)}),e.jsx("span",{className:"rate-label",children:"אחוז נוכחות כללי"})]})})]}):e.jsxs("div",{className:"no-data-state",style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[e.jsx(Vt,{size:48,style:{marginBottom:"16px",opacity:.5}}),e.jsx("h4",{children:"אין נתוני נוכחות"}),e.jsx("p",{children:"לא נמצאו שיעורים פרטיים עבור המורה בתקופה זו"})]})]}),l.overallStats.totalLessons>0&&e.jsxs("div",{className:"students-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"נוכחות תלמידים"}),e.jsxs("span",{className:"students-count",children:[Object.keys(l.studentStats||{}).length," תלמידים"]})]}),w()]})]})]})]})})},FA=({className:t=""})=>{var se;const[s,n]=x.useState([]),[i,l]=x.useState(""),[c,u]=x.useState(""),[f,p]=x.useState(null),[m,g]=x.useState([]),[v,j]=x.useState({}),[N,b]=x.useState(!1),[w,C]=x.useState(!1),[T,A]=x.useState(null),[_,D]=x.useState({isOpen:!1,teacherId:"",teacherName:""});x.useEffect(()=>{S()},[]),x.useEffect(()=>{s.length>0&&R()},[s]);const S=async()=>{try{b(!0),console.log("Loading all teachers...");const O=await dl.getAllTeachers();console.log("Raw teachers data:",O);const B=O.filter(L=>L.isActive);console.log("Active teachers:",B.map(L=>({name:L.personalInfo.fullName,id:L._id}))),n(B)}catch(O){console.error("Error loading teachers:",O),A(O.message||"שגיאה בטעינת רשימת המורים")}finally{b(!1)}},R=()=>{if(s.length===0)return;const B=[...s].sort(()=>.5-Math.random()).slice(0,Math.min(5,s.length));g(B),E(B)},E=async O=>{var L,Y;const B={};C(!0),console.log("Loading data for teachers:",O.map(H=>{var P;return((P=H.personalInfo)==null?void 0:P.fullName)||H._id}));for(const H of O)try{const P=((L=H.personalInfo)==null?void 0:L.fullName)||H._id;console.log(`Loading attendance data for teacher: ${P} (${H._id})`);const q=await dl.getTeacherAttendanceOverview(H._id);console.log(`Attendance data for ${P}:`,JSON.stringify(q,null,2)),q&&q.overallStats&&q.studentStats?B[H._id]=q:console.warn(`Invalid data structure for teacher ${P}:`,q)}catch(P){const q=((Y=H.personalInfo)==null?void 0:Y.fullName)||H._id;console.error(`Error loading data for teacher ${q} (${H._id}):`,P)}console.log("Final random teachers data:",B),j(B),C(!1)},k=async O=>{if(!O)return;const B=s.find(Y=>Y._id===O),L=(B==null?void 0:B.personalInfo.fullName)||O;try{b(!0),A(null),console.log(`Loading selected teacher data for: ${L} (${O})`);const Y=await dl.getTeacherAttendanceOverview(O);console.log(`Selected teacher data for ${L}:`,Y),p(Y)}catch(Y){console.error(`Error loading teacher attendance data for ${L}:`,Y),A(Y.message||"שגיאה בטעינת נתוני נוכחות המורה"),p(null)}finally{b(!1)}},I=x.useMemo(()=>{if(!c.trim())return[];const O=c.toLowerCase().trim();return s.filter(B=>{var H,P,q,F;const L=((P=(H=B.personalInfo)==null?void 0:H.fullName)==null?void 0:P.toLowerCase())||"",Y=((F=(q=B.personalInfo)==null?void 0:q.email)==null?void 0:F.toLowerCase())||"";return L.includes(O)||Y.includes(O)}).slice(0,10)},[s,c]),M=O=>{l(O),u(""),A(null),k(O)},z=O=>{O.key==="Escape"?u(""):O.key==="Enter"&&I.length===1&&M(I[0]._id)},Z=(O,B)=>{D({isOpen:!0,teacherId:O,teacherName:B})},ee=()=>{D({isOpen:!1,teacherId:"",teacherName:""})},W=O=>typeof O=="string"?O:`${Math.round(O)}%`,K=O=>{const B=typeof O=="string"?parseFloat(O):O;return B>=90?"text-green-500":B>=80?"text-yellow-500":B>=70?"text-orange-500":"text-red-500"},Q=O=>(typeof O=="string"?parseFloat(O):O)>=80?e.jsx(ll,{size:16,className:"text-green-500"}):e.jsx(zd,{size:16,className:"text-red-500"}),ne=(O,B)=>{var P;const L=B?Object.keys(B.studentStats).length:0,Y=(B==null?void 0:B.overallStats.attendanceRate)||0,H=B&&B.overallStats.totalLessons>0;return e.jsxs("div",{className:"teacher-card",onClick:()=>Z(O._id,O.personalInfo.fullName),children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("h4",{className:"teacher-name",children:((P=O.personalInfo)==null?void 0:P.fullName)||"ללא שם"}),e.jsx("div",{className:"teacher-stats",children:H?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(ps,{size:14}),e.jsxs("span",{children:[L," תלמידים"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(Vt,{size:14}),e.jsxs("span",{children:[B.overallStats.totalLessons," שיעורים"]})]}),e.jsxs("div",{className:`stat-item attendance-rate ${K(Y)}`,children:[Q(Y),e.jsx("span",{children:W(Y)})]})]}):e.jsx("div",{className:"stat-item no-data",children:e.jsx("span",{style:{color:"#666",fontSize:"0.9em"},children:"אין נתוני נוכחות"})})})]}),e.jsx("div",{className:"click-hint",children:"לחץ לפרטים מלאים"})]},O._id)},X=O=>{const B=Object.entries(O);return B.length===0?e.jsx("div",{className:"no-students",children:"אין תלמידים בתקופה זו"}):e.jsx("div",{className:"student-stats-grid",children:B.map(([L,Y])=>e.jsxs("div",{className:"student-stat-card",children:[e.jsx("div",{className:"student-name",children:Y.studentName}),e.jsxs("div",{className:"student-attendance-details",children:[e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"שיעורים:"}),e.jsx("span",{className:"metric-value",children:Y.totalLessons})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"הגיעו:"}),e.jsx("span",{className:"metric-value text-green-500",children:Y.attendedLessons})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"חסרו:"}),e.jsx("span",{className:"metric-value text-red-500",children:Y.missedLessons})]}),e.jsxs("div",{className:`attendance-rate ${K(Y.attendanceRate)}`,children:[Q(parseFloat(Y.attendanceRate)),e.jsx("span",{children:W(Y.attendanceRate)})]})]})]},L))})};return e.jsxs("div",{className:`teacher-attendance-section ${t}`,children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"נוכחות מורים ותלמידים"}),e.jsx("span",{className:"section-count",children:s.length})]}),e.jsxs("div",{className:"teacher-selection",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(gr,{size:18,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"חפש מורה לפי שם או אימייל...",value:c,onChange:O=>u(O.target.value),onKeyDown:z,className:"teacher-search-input",autoComplete:"off"})]}),c&&e.jsx("div",{className:"search-results",children:I.length>0?e.jsx("div",{className:"teacher-list",children:I.map(O=>{var B,L;return e.jsxs("button",{className:"teacher-option",onClick:()=>M(O._id),children:[e.jsx("span",{className:"teacher-name",children:((B=O.personalInfo)==null?void 0:B.fullName)||"ללא שם"}),((L=O.personalInfo)==null?void 0:L.email)&&e.jsx("span",{className:"teacher-email",children:O.personalInfo.email})]},O._id)})}):e.jsxs("div",{className:"no-results",children:['לא נמצאו מורים התואמים לחיפוש "',c,'"']})})]}),i&&f&&e.jsxs("div",{className:"selected-teacher-details",children:[e.jsxs("div",{className:"selected-teacher-header",children:[e.jsxs("h4",{children:["פרטי נוכחות - ",(se=s.find(O=>O._id===i))==null?void 0:se.personalInfo.fullName]}),e.jsx("button",{className:"close-details",onClick:()=>{l(""),p(null)},children:"✕"})]}),e.jsxs("div",{className:"overall-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:'סה"כ שיעורים'}),e.jsx("div",{className:"stat-value",children:f.overallStats.totalLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"שיעורים שהתקיימו"}),e.jsx("div",{className:"stat-value text-green-500",children:f.overallStats.attendedLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"שיעורים שלא התקיימו"}),e.jsx("div",{className:"stat-value text-red-500",children:f.overallStats.missedLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"אחוז נוכחות"}),e.jsx("div",{className:`stat-value ${K(f.overallStats.attendanceRate)}`,children:W(f.overallStats.attendanceRate)})]})]}),e.jsxs("div",{className:"student-stats-section",children:[e.jsx("h5",{children:"נוכחות תלמידים"}),X(f.studentStats)]})]}),!i&&e.jsxs("div",{className:"random-teachers-section",children:[e.jsxs("div",{className:"section-subheader",children:[e.jsx("h4",{children:"מורים נבחרים"}),e.jsx("button",{className:"refresh-btn",onClick:R,disabled:N,children:"↻ רענן"})]}),N?e.jsx("div",{className:"loading-state",children:"טוען נתוני מורים..."}):T?e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:T}),e.jsx("button",{onClick:S,className:"retry-btn",children:"נסה שוב"})]}):e.jsxs(e.Fragment,{children:[w&&e.jsx("div",{className:"loading-notice",style:{padding:"12px",backgroundColor:"#e7f3ff",border:"1px solid #b3d9ff",borderRadius:"6px",marginBottom:"16px",textAlign:"center",color:"#0066cc"},children:"טוען נתוני נוכחות..."}),e.jsx("div",{className:"teachers-grid",children:m.map(O=>ne(O,v[O._id]))})]})]}),e.jsx(BA,{isOpen:_.isOpen,onClose:ee,teacherId:_.teacherId,teacherName:_.teacherName})]})};function Kf({title:t,value:s,subtitle:n,icon:i,variant:l="default",onClick:c}){const u={default:"attendance-card-default",success:"attendance-card-success",warning:"attendance-card-warning",danger:"attendance-card-danger"};return e.jsxs("div",{className:`attendance-overview-card ${u[l]} ${c?"clickable":""}`,onClick:c,children:[e.jsx("div",{className:"card-icon",children:e.jsx(i,{size:24})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"card-value",children:s}),e.jsx("div",{className:"card-title",children:t}),n&&e.jsx("div",{className:"card-subtitle",children:n})]}),c&&e.jsx(Xm,{size:16,className:"card-arrow"})]})}function UA({orchestraName:t,orchestraId:s,attendanceRate:n,totalRehearsals:i,totalStudents:l,lowAttendanceCount:c,onViewLastAttendance:u,onViewByDate:f}){const p=m=>m>=80?"success":m>=60?"warning":"danger";return e.jsxs("div",{className:"orchestra-attendance-card",children:[e.jsxs("div",{className:"orchestra-header",children:[e.jsxs("div",{className:"orchestra-info",children:[e.jsx("h4",{className:"orchestra-name",children:t}),e.jsxs("div",{className:"orchestra-stats",children:[e.jsxs("span",{children:[l," תלמידים"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i," חזרות"]})]})]}),e.jsxs("div",{className:`attendance-rate ${p(n)}`,children:[n,"%"]})]}),c>0&&e.jsxs("div",{className:"low-attendance-alert",children:[e.jsx(yr,{size:14}),e.jsxs("span",{children:[c," חזרות עם נוכחות נמוכה"]})]}),e.jsx("div",{className:"orchestra-actions",children:e.jsxs("div",{className:"attendance-buttons",children:[e.jsxs("button",{className:"attendance-btn last-attendance",onClick:()=>u(s,t),children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"נוכחות אחרונה"})]}),e.jsxs("button",{className:"attendance-btn by-date",onClick:()=>f(s,t),children:[e.jsx(mT,{size:14}),e.jsx("span",{children:"לפי תאריך"})]})]})})]})}function PA({orchestraName:t,rehearsalDate:s,attendanceRate:n,onViewRehearsal:i,rehearsalId:l,isNewlyAdded:c=!1}){const u=f=>new Date(f).toLocaleDateString("he-IL",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:`low-attendance-item clickable ${c?"newly-added":""}`,onClick:()=>i(l),children:[e.jsxs("div",{className:"low-attendance-info",children:[e.jsx("div",{className:"orchestra-name",children:t}),e.jsx("div",{className:"rehearsal-date",children:u(s)})]}),e.jsxs("div",{className:"attendance-rate danger",children:[n,"%"]})]})}function qA(){const t=Ot(),{dashboardData:s,isLoadingDashboard:n,error:i,loadDashboardData:l,clearError:c}=zA(),[u,f]=x.useState(5),[p,m]=x.useState(!1),[g,v]=x.useState(new Set),[j,N]=x.useState({isOpen:!1,orchestraId:"",orchestraName:"",mode:"last"});x.useEffect(()=>{l()},[l]),x.useEffect(()=>{s&&(f(5),v(new Set))},[s]);const b=E=>{t(`/rehearsals/${E}`)},w=()=>{t("/rehearsals")},C=(E,k)=>{N({isOpen:!0,orchestraId:E,orchestraName:k,mode:"last"})},T=(E,k)=>{N({isOpen:!0,orchestraId:E,orchestraName:k,mode:"by-date"})},A=()=>{N({isOpen:!1,orchestraId:"",orchestraName:"",mode:"last"})},_=async()=>{if(!s||p)return;m(!0),await new Promise(M=>setTimeout(M,500));const E=u,k=Math.min(E+5,s.recentLowAttendance.length),I=new Set;for(let M=E;M<k;M++)I.add(M);v(I),f(k),m(!1),setTimeout(()=>{v(new Set)},600)};if(n)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsx("div",{className:"loading-state",children:"טוען נתוני נוכחות..."})]});if(i)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:i}),e.jsx("button",{onClick:()=>{c(),l()},children:"נסה שוב"})]})]});if(!s)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsx("div",{className:"empty-state",children:"אין נתוני נוכחות זמינים"})]});const{overallStats:D,orchestraOverviews:S,recentLowAttendance:R}=s;return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"נוכחות ותחזוקה"}),e.jsx("div",{className:"dashboard-subtitle",children:"סקירה כללית של נוכחות בחזרות"})]}),e.jsxs("div",{className:"overview-cards",children:[e.jsx(Kf,{title:"תזמורות פעילות",value:D.totalOrchestras,icon:Je}),e.jsx(Kf,{title:"חזרות החודש",value:D.totalRehearsals,icon:$e,onClick:w}),e.jsx(Kf,{title:"ממוצע נוכחות",value:`${D.averageAttendanceRate}%`,icon:ll,variant:D.averageAttendanceRate>=80?"success":D.averageAttendanceRate>=60?"warning":"danger"})]}),e.jsxs("div",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"נוכחות לפי תזמורת"})}),S.length>0?e.jsx("div",{className:"orchestra-cards",children:S.map(E=>e.jsx(UA,{orchestraName:E.orchestraName,orchestraId:E.orchestraId,attendanceRate:E.averageAttendanceRate,totalRehearsals:E.totalRehearsals,totalStudents:E.totalStudents,lowAttendanceCount:E.lowAttendanceAlerts.length,onViewLastAttendance:C,onViewByDate:T},E.orchestraId))}):e.jsx("div",{className:"empty-section",children:"אין תזמורות זמינות"})]}),R.length>0&&e.jsxs("div",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"חזרות אחרונות"}),e.jsx("span",{className:"section-count",children:R.length})]}),e.jsx("div",{className:"low-attendance-list",children:R.slice(0,u).map((E,k)=>e.jsx(PA,{orchestraName:E.orchestraName,rehearsalDate:E.rehearsalDate,attendanceRate:E.attendanceRate,rehearsalId:E.rehearsalId,onViewRehearsal:b,isNewlyAdded:g.has(k)},`${E.rehearsalId}-${k}`))}),u<R.length&&e.jsx("button",{className:`view-more-btn ${p?"loading":""}`,onClick:_,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"טוען..."]}):`הצג עוד ${Math.min(5,R.length-u)} חזרות`})]}),e.jsx("div",{className:"dashboard-section",children:e.jsx(FA,{})}),e.jsx(LA,{isOpen:j.isOpen,onClose:A,orchestraId:j.orchestraId,orchestraName:j.orchestraName,mode:j.mode})]})}const HA={async getPastActivities(t={}){try{if(t.type==="private-lessons"&&!t.teacherId)throw new Error("Teacher ID is required when filtering by private lessons");if(t.startDate&&!Bx(t.startDate))throw new Error("Start date must be in YYYY-MM-DD format");if(t.endDate&&!Bx(t.endDate))throw new Error("End date must be in YYYY-MM-DD format");if(t.teacherId&&!Jf(t.teacherId))throw new Error("Invalid teacher ID format");if(t.studentId&&!Jf(t.studentId))throw new Error("Invalid student ID format");if(t.orchestraId&&!Jf(t.orchestraId))throw new Error("Invalid orchestra ID format");const s={};t.type&&t.type!=="all"&&(s.type=t.type),t.teacherId&&(s.teacherId=t.teacherId),t.studentId&&(s.studentId=t.studentId),t.orchestraId&&(s.orchestraId=t.orchestraId),t.category&&(s.category=t.category),t.startDate&&(s.startDate=t.startDate),t.endDate&&(s.endDate=t.endDate),t.limit&&(s.limit=Math.min(t.limit,1e3)),t.page&&(s.page=Math.max(1,t.page));const n=await ge.get("admin/past-activities",s);if(n&&n.success&&n.data)return n;if(Array.isArray(n))return{success:!0,data:n,pagination:{currentPage:1,totalPages:1,totalCount:n.length,hasNextPage:!1,hasPreviousPage:!1},summary:{totalCount:n.length,rehearsalsCount:n.filter(i=>i.activityType==="rehearsal").length,theoryCount:n.filter(i=>i.activityType==="theory").length,privateLessonsCount:n.filter(i=>i.activityType==="private-lesson").length,dateRange:{from:t.startDate||"",to:t.endDate||""}}};throw new Error("Unexpected response format from past activities API")}catch(s){throw console.error("Failed to get past activities:",s),s instanceof Error?s:new Error("Failed to load past activities. Please try again later.")}},async getPastActivitiesByType(t,s={}){try{if(t==="private-lessons"&&!s.teacherId)throw new Error("Teacher ID is required when fetching private lessons");const n={...s};Object.keys(n).forEach(c=>{n[c]===void 0&&delete n[c]});const i=`admin/past-activities/${t}`,l=await ge.get(i,n);if(l&&l.success&&l.data)return l;if(Array.isArray(l))return{success:!0,data:l,pagination:{currentPage:1,totalPages:1,totalCount:l.length,hasNextPage:!1,hasPreviousPage:!1},summary:{totalCount:l.length,rehearsalsCount:t==="rehearsals"?l.length:0,theoryCount:t==="theory"?l.length:0,privateLessonsCount:t==="private-lessons"?l.length:0,dateRange:{from:s.startDate||"",to:s.endDate||""}}};throw new Error("Unexpected response format from past activities API")}catch(n){throw console.error(`Failed to get past activities for type ${t}:`,n),n instanceof Error?n:new Error(`Failed to load ${t} activities. Please try again later.`)}}};function Bx(t){if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;const n=new Date(t),i=n.getTime();return typeof i!="number"||Number.isNaN(i)?!1:t===n.toISOString().split("T")[0]}function Jf(t){return/^[0-9a-fA-F]{24}$/.test(t)}function Cd({title:t,count:s,icon:n,variant:i="default"}){const l={default:"summary-card-default",success:"summary-card-success",info:"summary-card-info",warning:"summary-card-warning"};return e.jsxs("div",{className:`past-activities-summary-card ${l[i]}`,children:[e.jsx("div",{className:"summary-card-icon",children:e.jsx(n,{size:20})}),e.jsxs("div",{className:"summary-card-content",children:[e.jsx("div",{className:"summary-card-count",children:s}),e.jsx("div",{className:"summary-card-title",children:t})]})]})}function YA({activity:t,onViewDetails:s}){const[n,i]=x.useState(!1),l=w=>{switch(w){case"rehearsal":return Je;case"theory":return Vt;case"private-lesson":return pr;default:return $e}},c=w=>{switch(w){case"rehearsal":return"חזרה";case"theory":return"תאוריה";case"private-lesson":return"שיעור פרטי";default:return w}},u=w=>new Date(w).toLocaleDateString("he-IL",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),f=l(t.activityType),p=t.attendance;let m=[];Array.isArray(p)?m=p:p&&typeof p=="object"?(m=p.records||p.data||p.students||[],Array.isArray(m)||(m=[])):m=[];const g=m.length,v=Array.isArray(m)?m.filter(w=>w&&(w.status==="present"||w.status==="הגיע/ה")).length:0,j=Array.isArray(m)?m.filter(w=>w&&(w.status==="absent"||w.status==="לא הגיע/ה")).length:0,N=g>0?Math.round(v/g*100):0,b=w=>w>=80?"success":w>=60?"warning":"danger";return e.jsxs("div",{className:"past-activity-item",children:[e.jsx("div",{className:"activity-icon",children:e.jsx(f,{size:18})}),e.jsxs("div",{className:"activity-content",children:[e.jsxs("div",{className:"activity-header",children:[e.jsx("div",{className:"activity-title",children:t.title}),e.jsxs("div",{className:"activity-header-actions",children:[e.jsx("div",{className:"activity-date",children:u(t.date)}),g>0&&e.jsx("button",{className:"attendance-toggle",onClick:w=>{w.stopPropagation(),i(!n)},title:"הצג פרטי נוכחות",children:n?e.jsx(Ft,{size:14}):e.jsx(gt,{size:14})})]})]}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-type",children:c(t.activityType)}),e.jsxs("div",{className:"activity-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:t.time})]}),t.location&&e.jsxs("div",{className:"activity-location",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:t.location})]}),t.orchestraName&&e.jsxs("div",{className:"activity-orchestra",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:t.orchestraName})]}),t.teacherName&&e.jsxs("div",{className:"activity-teacher",children:[e.jsx(pr,{size:12}),e.jsx("span",{children:t.teacherName})]})]}),e.jsxs("div",{className:"activity-meta",children:[g>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"attendance-summary",children:[e.jsx(ps,{size:12}),e.jsxs("span",{children:[g," משתתפים"]})]}),e.jsxs("div",{className:`attendance-rate ${b(N)}`,children:[N,"% נוכחות"]}),e.jsxs("div",{className:"attendance-breakdown",children:[e.jsxs("span",{className:"present-count",children:["✓ ",v]}),e.jsxs("span",{className:"absent-count",children:["✗ ",j]})]})]}):e.jsxs("div",{className:"no-attendance",children:[e.jsx(ps,{size:12}),e.jsx("span",{children:"אין נתוני נוכחות"})]}),t.notes&&e.jsxs("div",{className:"has-notes",children:[e.jsx(tc,{size:12}),e.jsx("span",{children:"הערות"})]})]}),n&&g>0&&e.jsxs("div",{className:"attendance-details",children:[e.jsxs("div",{className:"attendance-section",children:[e.jsxs("h5",{className:"attendance-section-title",children:["✓ נוכחים (",v,")"]}),e.jsx("div",{className:"attendance-list",children:Array.isArray(m)?m.filter(w=>w&&(w.status==="present"||w.status==="הגיע/ה")).map(w=>e.jsx("div",{className:"attendance-student present",children:e.jsx("span",{className:"student-name",children:w.studentName||w.name||"משתתף"})},w.studentId||w.id||Math.random())):e.jsx("div",{className:"no-data",children:"אין נתונים"})})]}),j>0&&e.jsxs("div",{className:"attendance-section",children:[e.jsxs("h5",{className:"attendance-section-title",children:["✗ נעדרים (",j,")"]}),e.jsx("div",{className:"attendance-list",children:Array.isArray(m)?m.filter(w=>w&&(w.status==="absent"||w.status==="לא הגיע/ה")).map(w=>e.jsx("div",{className:"attendance-student absent",children:e.jsx("span",{className:"student-name",children:w.studentName||w.name||"משתתף"})},w.studentId||w.id||Math.random())):e.jsx("div",{className:"no-data",children:"אין נתונים"})})]})]})]})]})}function VA({currentPage:t,totalPages:s,onPageChange:n,hasNextPage:i,hasPreviousPage:l}){const c=()=>{const u=[];let p=Math.max(1,t-Math.floor(2.5));const m=Math.min(s,p+5-1);m-p+1<5&&(p=Math.max(1,m-5+1));for(let g=p;g<=m;g++)u.push(e.jsx("button",{className:`pagination-number ${g===t?"active":""}`,onClick:()=>n(g),children:g},g));return u};return s<=1?null:e.jsxs("div",{className:"past-activities-pagination",children:[e.jsxs("button",{className:"pagination-btn",onClick:()=>n(t-1),disabled:!l,children:[e.jsx(Xm,{size:16}),e.jsx("span",{children:"הקודם"})]}),e.jsx("div",{className:"pagination-numbers",children:c()}),e.jsxs("button",{className:"pagination-btn",onClick:()=>n(t+1),disabled:!i,children:[e.jsx("span",{children:"הבא"}),e.jsx(x0,{size:16})]})]})}function GA({className:t=""}){var R,E;const[s,n]=x.useState(null),[i,l]=x.useState(!1),[c,u]=x.useState(null),[f,p]=x.useState([]),[m,g]=x.useState(!1),[v,j]=x.useState({type:"all",limit:50,page:1}),[N,b]=x.useState(!1),w=Fs.getCurrentUser(),C=((R=w==null?void 0:w.roles)==null?void 0:R.includes("מנהל"))||((E=w==null?void 0:w.roles)==null?void 0:E.includes("admin")),T=x.useCallback(async()=>{if(!(m||f.length>0)){g(!0);try{const k=await Jt.getTeachers({isActive:!0});p(k)}catch(k){console.error("Failed to load teachers:",k)}finally{g(!1)}}},[m,f.length]),A=x.useCallback(async()=>{if(v.type==="private-lessons"&&!v.teacherId){u("יש לבחור מורה עבור שיעורים פרטיים");return}l(!0),u(null);try{const k=await HA.getPastActivities(v);n(k)}catch(k){const I=k instanceof Error?k.message:"שגיאה בטעינת הפעילויות";u(I)}finally{l(!1)}},[v]);x.useEffect(()=>{C&&(A(),v.type==="private-lessons"&&T())},[C,A,v.type,T]);const _=k=>{j(I=>({...I,...k,page:1}))},D=k=>{j(I=>({...I,page:k}))},S=k=>{const I={type:k};k!=="private-lessons"&&(I.teacherId=void 0),_(I),k==="private-lessons"&&T()};return C?e.jsxs("div",{className:`past-activities-section ${t}`,children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"פעילויות קודמות"}),e.jsx("div",{className:"header-actions",children:e.jsxs("button",{className:`filter-toggle ${N?"active":""}`,onClick:()=>b(!N),children:[e.jsx(hi,{size:16}),e.jsx("span",{children:"מסננים"}),e.jsx(gt,{size:14,className:N?"rotated":""})]})})]}),N&&e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"סוג פעילות:"}),e.jsxs("select",{value:v.type||"all",onChange:k=>S(k.target.value),children:[e.jsx("option",{value:"all",children:"כל הפעילויות"}),e.jsx("option",{value:"rehearsals",children:"חזרות"}),e.jsx("option",{value:"theory",children:"שיעורי תאוריה"}),e.jsx("option",{value:"private-lessons",children:"שיעורים פרטיים"})]})]}),v.type==="private-lessons"&&e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"מורה: *"}),m?e.jsx("div",{className:"loading-teachers",children:"טוען מורים..."}):e.jsxs("select",{value:v.teacherId||"",onChange:k=>_({teacherId:k.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"בחר מורה"}),f.map(k=>e.jsx("option",{value:k._id,children:k.personalInfo.fullName},k._id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"מתאריך:"}),e.jsx("input",{type:"date",value:v.startDate||"",onChange:k=>_({startDate:k.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"עד תאריך:"}),e.jsx("input",{type:"date",value:v.endDate||"",onChange:k=>_({endDate:k.target.value})})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsxs("button",{className:"apply-filters-btn",onClick:A,disabled:i,children:[e.jsx(gr,{size:14}),e.jsx("span",{children:"חפש"})]}),e.jsx("button",{className:"clear-filters-btn",onClick:()=>{j({type:"all",limit:50,page:1}),u(null)},children:"נקה מסננים"})]})]}),c&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:c}),e.jsx("button",{onClick:A,children:"נסה שוב"})]}),i&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען פעילויות..."})]}),s&&!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-cards",children:[e.jsx(Cd,{title:"סה״כ פעילויות",count:s.summary.totalCount,icon:$e,variant:"default"}),e.jsx(Cd,{title:"חזרות",count:s.summary.rehearsalsCount,icon:Je,variant:"info"}),e.jsx(Cd,{title:"שיעורי תאוריה",count:s.summary.theoryCount,icon:Vt,variant:"success"}),e.jsx(Cd,{title:"שיעורים פרטיים",count:s.summary.privateLessonsCount,icon:pr,variant:"warning"})]}),s.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"activities-list",children:s.data.map(k=>e.jsx(YA,{activity:k,onViewDetails:I=>{console.log("View activity details:",I)}},k._id))}),e.jsx(VA,{currentPage:s.pagination.currentPage,totalPages:s.pagination.totalPages,hasNextPage:s.pagination.hasNextPage,hasPreviousPage:s.pagination.hasPreviousPage,onPageChange:D})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx($e,{size:48}),e.jsx("h4",{children:"אין פעילויות להצגה"}),e.jsx("p",{children:"לא נמצאו פעילויות התואמות את הקריטריונים שנבחרו"})]})]})]}):e.jsxs("div",{className:`past-activities-section ${t}`,children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"פעילויות קודמות"})}),e.jsx("div",{className:"access-denied",children:e.jsx("p",{children:"גישה לסקירת פעילויות קודמות מוגבלת למנהלי המערכת בלבד"})})]})}function QA(){return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[e.jsx(qA,{}),e.jsx(GA,{})]}),e.jsx(mi,{})]})}const Fx=(t,s)=>{const n=s[t._id];return!n||Object.keys(n).length===0?t:{...t,academicInfo:{...t.academicInfo,instrumentProgress:t.academicInfo.instrumentProgress.map(i=>{const l=n[i.instrumentName];return l!==void 0?{...i,currentStage:l}:i})}}},La=Fa((t,s)=>({students:[],selectedStudent:null,filterBy:{},isLoading:!1,error:null,localStageChanges:{},loadStudents:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await ot.getStudents(i),c=s(),u=l.map(f=>Fx(f,c.localStageChanges));t({students:u,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load students";t({error:l,isLoading:!1}),console.error("Error loading students:",i)}},loadStudentById:async n=>{t({isLoading:!0,error:null});try{const i=await ot.getStudentById(n),l=s(),c=Fx(i,l.localStageChanges);t({selectedStudent:c,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load student";t({error:l,isLoading:!1}),console.error("Error loading student:",i)}},saveStudent:async n=>{t({isLoading:!0,error:null});try{let i;if(n._id){const l=n._id;i=await ot.updateStudent(l,n);const c=s().students.map(u=>u._id===i._id?i:u);t({students:c,selectedStudent:i,isLoading:!1})}else i=await ot.addStudent(n),t({students:[...s().students,i],selectedStudent:i,isLoading:!1});return i}catch(i){const l=i instanceof Error?i.message:"Failed to save student";throw t({error:l,isLoading:!1}),console.error("Error saving student:",i),i}},removeStudent:async n=>{var i;t({isLoading:!0,error:null});try{const l=s().students.find(u=>u._id===n)||s().selectedStudent,c=(l==null?void 0:l.teacherIds)||[];if(c.length>0){const u=c.map(f=>Jt.removeStudentFromTeacher(f,n).catch(p=>(console.error(`Failed to remove student ${n} from teacher ${f}:`,p),null)));await Promise.allSettled(u)}await ot.removeStudent(n),t({students:s().students.filter(u=>u._id!==n),selectedStudent:((i=s().selectedStudent)==null?void 0:i._id)===n?null:s().selectedStudent,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove student";throw t({error:c,isLoading:!1}),console.error("Error removing student:",l),l}},getStudentsByIds:async n=>{if(!n||n.length===0)return[];t({isLoading:!0,error:null});try{const l=s().students,c=l.map(m=>m._id),u=n.filter(m=>!c.includes(m));let f=[...l];if(u.length>0){const m=await ot.getStudentsByIds(u);f=[...l],m.forEach(g=>{f.some(v=>v._id===g._id)||f.push(g)}),t({students:f})}const p=f.filter(m=>n.includes(m._id));return t({isLoading:!1}),p}catch(i){const l=i instanceof Error?i.message:"Failed to load students by IDs";return t({error:l,isLoading:!1}),console.error("Error loading students by IDs:",i),[]}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedStudent:()=>{t({selectedStudent:null})},clearError:()=>{t({error:null})},updateStudentStage:(n,i,l)=>{const c=s(),u={...c.localStageChanges,[n]:{...c.localStageChanges[n],[i]:l}},f=c.students.map(m=>m._id===n?{...m,academicInfo:{...m.academicInfo,instrumentProgress:m.academicInfo.instrumentProgress.map(g=>g.instrumentName===i?{...g,currentStage:l}:g)}}:m);let p=c.selectedStudent;c.selectedStudent&&c.selectedStudent._id===n&&(p={...c.selectedStudent,academicInfo:{...c.selectedStudent.academicInfo,instrumentProgress:c.selectedStudent.academicInfo.instrumentProgress.map(m=>m.instrumentName===i?{...m,currentStage:l}:m)}}),t({students:f,selectedStudent:p,localStageChanges:u}),console.log(`Updated stage in student store: ${i} -> ${l} for student ${n}`),console.log("Local stage changes:",u)}})),XA=Object.freeze(Object.defineProperty({__proto__:null,useStudentStore:La},Symbol.toStringTag,{value:"Module"})),Oo={ADMIN:"מנהל",TEACHER:"מורה",CONDUCTOR:"מנצח",ENSEMBLE_INSTRUCTOR:"מדריך הרכב",STUDENT:"תלמיד"};class ib{constructor(s){this.context=s}hasRole(s){return this.context.user?(Array.isArray(s)?s:[s]).some(i=>this.context.user.roles.includes(i)):!1}isAdmin(){return this.hasRole(Oo.ADMIN)}isTeacher(){return this.hasRole(Oo.TEACHER)}isStudent(){return this.hasRole(Oo.STUDENT)}isConductor(){return this.hasRole(Oo.CONDUCTOR)}isEnsembleInstructor(){return this.hasRole(Oo.ENSEMBLE_INSTRUCTOR)}canAddStudent(){return this.isAdmin()||this.isTeacher()}canAddTeacher(){return this.isAdmin()}canViewStudent(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?this.isStudentAssignedToTeacher(s,this.context.user._id):this.isStudent()?s._id===this.context.user._id:!1:!1}canEditStudent(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?this.isStudentAssignedToTeacher(s,this.context.user._id):!1:!1}canDeleteStudent(s){return this.context.user?this.isAdmin():!1}canUpdateStudent(s){return this.canEditStudent(s)}canViewTeacher(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canEditTeacher(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canDeleteTeacher(s){return this.context.user?this.isAdmin():!1}canUpdateTeacher(s){return this.canEditTeacher(s)}canManageTeacherSchedule(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canViewOrchestras(){return this.isAdmin()||this.isConductor()||this.isEnsembleInstructor()||this.isTeacher()}canCreateOrchestra(){return this.isAdmin()}canEditOrchestra(s){return!this.context.user||!s?!1:this.isAdmin()?!0:this.isConductor()||this.isEnsembleInstructor()?s.conductorId===this.context.user._id:!1}canDeleteOrchestra(s){return this.context.user?this.isAdmin():!1}canUpdateOrchestra(s){return this.canEditOrchestra(s)}isStudentAssignedToTeacher(s,n){return!s.teacherIds||!Array.isArray(s.teacherIds)?!1:s.teacherIds.includes(n)}getAuthorizationErrorMessage(s,n="תלמיד"){const i={view:`אין לך הרשאות לצפות ב${n} זה.`,edit:`אין לך הרשאות לערוך ${n} זה. רק המורה הקבוע או המנהל יכולים לערוך.`,update:`אין לך הרשאות לעדכן ${n} זה. רק המורה הקבוע או המנהל יכולים לעדכן.`,delete:`אין לך הרשאות למחוק ${n} זה. רק המנהל יכול למחוק.`,add:`אין לך הרשאות להוסיף ${n} חדש.`,default:"אין לך הרשאות לבצע פעולה זו."};return i[s]||i.default}getStudentActionPermissions(s){return{canView:this.canViewStudent(s),canEdit:this.canEditStudent(s),canDelete:this.canDeleteStudent(s),canUpdate:this.canUpdateStudent(s),showEditButton:this.canEditStudent(s),showDeleteButton:this.canDeleteStudent(s)}}getTeacherActionPermissions(s){return{canView:this.canViewTeacher(s),canEdit:this.canEditTeacher(s),canDelete:this.canDeleteTeacher(s),canUpdate:this.canUpdateTeacher(s),showEditButton:this.canEditTeacher(s),showDeleteButton:this.canDeleteTeacher(s)}}getOrchestraActionPermissions(s){return{canView:this.canViewOrchestras(),canEdit:this.canEditOrchestra(s),canDelete:this.canDeleteOrchestra(s),canUpdate:this.canUpdateOrchestra(s),showEditButton:this.canEditOrchestra(s),showDeleteButton:this.canDeleteOrchestra(s)}}validateAction(s,n,i){if(!this.context.user)throw new Error("אין לך הרשאות לבצע פעולה זו. אנא התחבר למערכת.");const l=i==="teacher",c=l?"מורה":"תלמיד";switch(s){case"add":if(l&&!this.canAddTeacher())throw new Error(this.getAuthorizationErrorMessage("add",c));if(!l&&!this.canAddStudent())throw new Error(this.getAuthorizationErrorMessage("add",c));break;case"view":if(n){if(l&&!this.canViewTeacher(n))throw new Error(this.getAuthorizationErrorMessage("view",c));if(!l&&!this.canViewStudent(n))throw new Error(this.getAuthorizationErrorMessage("view",c))}break;case"edit":case"update":if(n){if(l&&!this.canUpdateTeacher(n))throw new Error(this.getAuthorizationErrorMessage("update",c));if(!l&&!this.canUpdateStudent(n))throw new Error(this.getAuthorizationErrorMessage("update",c))}break;case"delete":if(n){if(l&&!this.canDeleteTeacher(n))throw new Error(this.getAuthorizationErrorMessage("delete",c));if(!l&&!this.canDeleteStudent(n))throw new Error(this.getAuthorizationErrorMessage("delete",c))}break;default:throw new Error(this.getAuthorizationErrorMessage("default"))}}}function Sr(t){return new ib(t)}function Cl(t,s){return{user:t,isAuthenticated:s}}function ZA({student:t,onView:s,onEdit:n,onRemove:i,authContext:l}){var R,E,k,I,M,z;const[c,u]=x.useState(t),[f,p]=x.useState([]),m=l?Sr(l):null;x.useEffect(()=>{u(t)},[t]),x.useEffect(()=>{var ee;if(!((ee=c==null?void 0:c.enrollments)!=null&&ee.orchestraIds)||c.enrollments.orchestraIds.length===0){p([]);return}(async()=>{try{const K=(await Ra.getOrchestrasByIds(c.enrollments.orchestraIds)).map(Q=>Q.name);p(K)}catch(W){console.error("Error fetching orchestra data:",W),p([])}})()},[(R=c==null?void 0:c.enrollments)==null?void 0:R.orchestraIds]);const g=Z=>{const ee=["var(--stage-1)","var(--stage-2)","var(--stage-3)","var(--stage-4)","var(--stage-5)","var(--stage-6)","var(--stage-7)","var(--stage-8)"];return ee[Z-1]||ee[0]},v=Z=>{switch(Z){case"עבר/ה":case"עבר/ה בהצטיינות":case"עבר/ה בהצטיינות יתרה":return"var(--success)";case"לא עבר/ה":return"var(--danger)";default:return"var(--text-muted)"}},j=Z=>Z?Z.split(" ").map(ee=>ee[0]).join("").toUpperCase().substring(0,2):"",N=()=>f.length===0?"ללא תזמורת":f.join(" || "),b=()=>{var ee;return!((ee=c==null?void 0:c.academicInfo)!=null&&ee.instrumentProgress)||c.academicInfo.instrumentProgress.length===0?"ללא כלי נגינה":c.academicInfo.instrumentProgress.slice(0,2).map(W=>W.instrumentName).join(" - ")},C=(()=>{var Z;return(Z=c==null?void 0:c.academicInfo)!=null&&Z.instrumentProgress?c.academicInfo.instrumentProgress.find(ee=>ee.isPrimary)||(c.academicInfo.instrumentProgress.length>0?c.academicInfo.instrumentProgress[0]:null):null})(),T=(C==null?void 0:C.currentStage)||1,A=((k=(E=C==null?void 0:C.tests)==null?void 0:E.technicalTest)==null?void 0:k.status)||"לא נבחן",_=((M=(I=C==null?void 0:C.tests)==null?void 0:I.stageTest)==null?void 0:M.status)||"לא נבחן",D=c||t;if(!D||!D.personalInfo)return null;const S=(m==null?void 0:m.getStudentActionPermissions(D))||{showEditButton:!0,showDeleteButton:!0};return e.jsxs("div",{className:"student-preview",onClick:()=>s(D._id),children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsxs("div",{className:"student-details",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:g(T)},children:j(D.personalInfo.fullName)})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{className:"student-name",children:D.personalInfo.fullName}),e.jsxs("div",{className:"student-subject",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:b()})]})]})]}),e.jsxs("div",{className:"badges-container",children:[((z=D.academicInfo)==null?void 0:z.instrumentProgress)&&D.academicInfo.instrumentProgress.length>0&&e.jsx("div",{className:"instrument-badges",children:D.academicInfo.instrumentProgress.map(Z=>e.jsxs("div",{className:"instrument-stage-badge",style:{backgroundColor:g(Z.currentStage)},children:[Z.instrumentName,": שלב"," ",Z.currentStage]},Z.instrumentName))}),e.jsx("div",{className:"grade-badge",style:{backgroundColor:"#348b49"},children:e.jsxs("span",{children:["כיתה ",D.academicInfo.class]})})]})]})}),e.jsxs("div",{className:"preview-content",children:[e.jsx("div",{className:"info-row",children:e.jsxs("div",{className:"info-item",children:[e.jsx(ms,{size:16}),e.jsx("span",{children:N()})]})}),C&&e.jsxs("div",{className:"tests-section",children:[e.jsxs("div",{className:"test-item",children:[e.jsx("div",{className:"test-label",children:"מבחן טכני:"}),e.jsx("div",{className:"test-status",style:{color:v(A)},children:A})]}),e.jsxs("div",{className:"test-item",children:[e.jsx("div",{className:"test-label",children:"מבחן שלב:"}),e.jsx("div",{className:"test-status",style:{color:v(_)},children:_})]})]})]}),e.jsxs("div",{className:"preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[S.showEditButton&&e.jsx("button",{className:"action-btn edit",onClick:Z=>{Z.stopPropagation(),n(D._id)},"aria-label":"ערוך תלמיד",children:e.jsx(Sa,{size:20})}),S.showDeleteButton&&i&&e.jsx("button",{className:"action-btn delete",onClick:Z=>{Z.stopPropagation(),i(D._id)},"aria-label":"מחק תלמיד",children:e.jsx(_t,{size:20})})]}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(D.createdAt).toLocaleDateString("he-IL")})]})]})]})}function WA({students:t,isLoading:s,onEdit:n,onView:i,onRemove:l,authContext:c}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען תלמידים..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו תלמידים להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף תלמידים חדשים"})]}):e.jsx("div",{className:"student-grid",children:t.map(u=>e.jsx(ZA,{student:u,onEdit:n,onView:i||n,onRemove:l,authContext:c},u._id))})}function ic({onSearch:t,placeholder:s="חיפוש...",className:n=""}){const[i,l]=x.useState(""),c=u=>{const f=u.target.value;l(f),t(f)};return e.jsx("div",{className:`search-bar-container ${n}`,children:e.jsxs("div",{className:"search-bar",children:[e.jsx(gr,{className:"search-icon",size:18}),e.jsx("input",{type:"text",value:i,onChange:c,placeholder:s,className:"search-input"})]})})}function bu(t,s,n,i,l,c){const[u,f]=x.useState(""),[p,m]=x.useState({instruments:[],stageLevel:null,classRange:null,sortOrder:null}),g=Array.isArray(t)?t:[],v=x.useMemo(()=>{const T={instruments:[],classRange:null};if(g.forEach(A=>{const _=n(A);(Array.isArray(_)?_:[_]).forEach(S=>{S&&typeof S=="string"&&S.trim()!==""&&!T.instruments.includes(S)&&T.instruments.push(S)})}),l){const A=g.map(_=>l(_)).filter(_=>_&&!isNaN(_)).sort((_,D)=>_-D);A.length>0&&(T.classRange=[A[0],A[A.length-1]])}return T.instruments.sort((A,_)=>A.localeCompare(_,"he")),T},[g,n,l]),j=x.useMemo(()=>{let T=[...g];if(u){const A=u.toLowerCase();T=T.filter(_=>{try{const D=typeof s=="function"?s(_):s.map(S=>{const R=_[S];return R?String(R):""});return Array.isArray(D)?D.some(S=>{if(typeof S!="string")return!1;const R=S.toLowerCase();return R.includes(A)?!0:R.split(/\s+/).some(k=>k.startsWith(A))}):(console.error("Expected fieldsToSearch to be an array but got:",typeof D),!1)}catch(D){return console.error("Error filtering entity:",D),!1}})}return p.instruments&&p.instruments.length>0&&(T=T.filter(A=>{const _=n(A);return(Array.isArray(_)?_:[_]).some(S=>S&&p.instruments.includes(S))})),p.stageLevel&&i&&(T=T.filter(A=>{const _=i(A);return!_||isNaN(_)?!1:_===p.stageLevel})),p.classRange&&l&&(T=T.filter(A=>{const _=l(A);return!_||isNaN(_)?!1:_>=p.classRange[0]&&_<=p.classRange[1]})),p.sortOrder&&c&&T.sort((A,_)=>{const D=c(A),S=c(_),R=D.localeCompare(S,"he");return p.sortOrder==="asc"?R:-R}),T},[g,u,p,s,n,i,l,c]),N=T=>{f(T)},b=T=>{m(T)},w=()=>{m({instruments:[],stageLevel:null,classRange:null,sortOrder:null})},C=p.instruments&&p.instruments.length>0||p.stageLevel!==null||p.classRange!==null||p.sortOrder!==null;return{filteredEntities:j,handleSearch:N,searchQuery:u,filters:p,handleApplyFilters:b,clearFilters:w,hasActiveFilters:C,availableInstruments:v.instruments,classRange:v.classRange}}function Nu({isOpen:t,onToggle:s,onApplyFilters:n,availableInstruments:i=[],classRange:l,currentFilters:c,hasActiveFilters:u,entityType:f}){var C,T,A,_;const p=x.useRef(null),[m,g]=x.useState(c);x.useEffect(()=>{function D(S){p.current&&!p.current.contains(S.target)&&s()}return t&&document.addEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}},[t,s]),x.useEffect(()=>{g(c)},[c]);const v=D=>{const S=m.instruments||[],R=S.includes(D)?S.filter(k=>k!==D):[...S,D],E={...m,instruments:R};g(E),n(E)},j=D=>{const S={...m,stageLevel:D};g(S),n(S)},N=D=>{const S={...m,classRange:D};g(S),n(S)},b=D=>{const S={...m,sortOrder:D};g(S),n(S)},w=()=>{const D={instruments:[],stageLevel:null,classRange:null,sortOrder:null};g(D),n(D)};return t?e.jsxs("div",{ref:p,className:"filter-dropdown",children:[e.jsxs("div",{className:"filter-dropdown-header",children:[e.jsx("span",{className:"filter-title",children:"סינון"}),u&&e.jsx("button",{className:"clear-filters-btn",onClick:w,title:"נקה סינונים",children:e.jsx(yt,{size:14})})]}),e.jsxs("div",{className:"filter-dropdown-content",children:[i.length>0&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:f==="orchestras"?"סוג":"כלי"}),e.jsx("div",{className:"filter-options",children:i.map(D=>e.jsxs("div",{className:"toggle-option",children:[e.jsx("span",{className:"toggle-option-text",children:D}),e.jsx("div",{className:`toggle-switch ${(m.instruments||[]).includes(D)?"active":""}`,onClick:()=>v(D),children:e.jsx("div",{className:"toggle-slider"})})]},D))})]}),f==="students"&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"שלב"}),e.jsx("div",{className:"stage-select-container",children:e.jsxs("select",{value:m.stageLevel||"",onChange:D=>{const S=D.target.value;j(S?parseInt(S):null)},className:"stage-select",children:[e.jsx("option",{value:"",children:"כל השלבים"}),[1,2,3,4,5,6,7,8].map(D=>e.jsxs("option",{value:D,children:["שלב ",D]},D))]})})]}),f==="students"&&l&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"כיתה"}),e.jsxs("div",{className:"range-slider-container",children:[e.jsxs("div",{className:"range-values",children:[e.jsxs("span",{children:["מ-",((C=m.classRange)==null?void 0:C[0])||l[0]]}),e.jsxs("span",{children:["עד-",((T=m.classRange)==null?void 0:T[1])||l[1]]})]}),e.jsxs("div",{className:"dual-range-wrapper",children:[e.jsx("input",{type:"range",min:l[0],max:l[1],value:((A=m.classRange)==null?void 0:A[0])||l[0],className:"blue-slider class-slider range-min",onChange:D=>{var E;const S=parseInt(D.target.value),R=((E=m.classRange)==null?void 0:E[1])||l[1];N([S,Math.max(S,R)])}}),e.jsx("input",{type:"range",min:l[0],max:l[1],value:((_=m.classRange)==null?void 0:_[1])||l[1],className:"blue-slider class-slider range-max",onChange:D=>{var E;const S=parseInt(D.target.value),R=((E=m.classRange)==null?void 0:E[0])||l[0];N([Math.min(R,S),S])}})]})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"מיון א-ת"}),e.jsxs("div",{className:"sort-options",children:[e.jsx("button",{className:`sort-btn ${m.sortOrder==="asc"?"active":""}`,onClick:()=>b(m.sortOrder==="asc"?null:"asc"),children:"עולה"}),e.jsx("button",{className:`sort-btn ${m.sortOrder==="desc"?"active":""}`,onClick:()=>b(m.sortOrder==="desc"?null:"desc"),children:"יורד"})]})]})]})]}):null}const Al=({isOpen:t,onClose:s,modalId:n="modal",restoreFocusOnClose:i=!0})=>{const l=x.useRef(null),c=x.useRef(null),u=x.useRef(!0);x.useEffect(()=>{t&&u.current&&(c.current=document.activeElement,u.current=!1)},[t]);const f=x.useCallback(j=>{j.key==="Escape"&&t&&(j.preventDefault(),s())},[t,s]),p=x.useCallback(j=>{if(!(!t||!l.current)&&j.key==="Tab"){const N=l.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),b=N[0],w=N[N.length-1];j.shiftKey?document.activeElement===b&&(j.preventDefault(),w==null||w.focus()):document.activeElement===w&&(j.preventDefault(),b==null||b.focus())}},[t]);x.useEffect(()=>(t&&(document.addEventListener("keydown",f),document.addEventListener("keydown",p),document.body.style.overflow==="hidden"||(document.body.style.overflow="hidden"),setTimeout(()=>{if(l.current){const N=l.current.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');N?N.focus():l.current.focus()}},100)),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keydown",p),document.querySelector(".modal-active")||(document.body.style.overflow="")}),[t,f,p]),x.useEffect(()=>{if(!t&&i&&c.current){const j=c.current;j&&typeof j.focus=="function"&&setTimeout(()=>{j.focus()},100),c.current=null,u.current=!0}},[t,i]);const m={ref:l,role:"dialog","aria-modal":!0,"aria-labelledby":`${n}-title`,"aria-describedby":`${n}-description`,tabIndex:-1},g={id:`${n}-title`},v={id:`${n}-description`};return{modalProps:m,titleProps:g,descriptionProps:v,modalRef:l}};var KA=function(s){return JA(s)&&!eD(s)};function JA(t){return!!t&&typeof t=="object"}function eD(t){var s=Object.prototype.toString.call(t);return s==="[object RegExp]"||s==="[object Date]"||aD(t)}var tD=typeof Symbol=="function"&&Symbol.for,sD=tD?Symbol.for("react.element"):60103;function aD(t){return t.$$typeof===sD}function nD(t){return Array.isArray(t)?[]:{}}function nu(t,s){return s.clone!==!1&&s.isMergeableObject(t)?Yo(nD(t),t,s):t}function rD(t,s,n){return t.concat(s).map(function(i){return nu(i,n)})}function iD(t,s,n){var i={};return n.isMergeableObject(t)&&Object.keys(t).forEach(function(l){i[l]=nu(t[l],n)}),Object.keys(s).forEach(function(l){!n.isMergeableObject(s[l])||!t[l]?i[l]=nu(s[l],n):i[l]=Yo(t[l],s[l],n)}),i}function Yo(t,s,n){n=n||{},n.arrayMerge=n.arrayMerge||rD,n.isMergeableObject=n.isMergeableObject||KA;var i=Array.isArray(s),l=Array.isArray(t),c=i===l;return c?i?n.arrayMerge(t,s,n):iD(t,s,n):nu(s,n)}Yo.all=function(s,n){if(!Array.isArray(s))throw new Error("first argument should be an array");return s.reduce(function(i,l){return Yo(i,l,n)},{})};var Dm=Yo,lb=typeof global=="object"&&global&&global.Object===Object&&global,lD=typeof self=="object"&&self&&self.Object===Object&&self,tn=lb||lD||Function("return this")(),vr=tn.Symbol,ob=Object.prototype,oD=ob.hasOwnProperty,cD=ob.toString,Io=vr?vr.toStringTag:void 0;function dD(t){var s=oD.call(t,Io),n=t[Io];try{t[Io]=void 0;var i=!0}catch{}var l=cD.call(t);return i&&(s?t[Io]=n:delete t[Io]),l}var uD=Object.prototype,hD=uD.toString;function fD(t){return hD.call(t)}var mD="[object Null]",pD="[object Undefined]",Ux=vr?vr.toStringTag:void 0;function pi(t){return t==null?t===void 0?pD:mD:Ux&&Ux in Object(t)?dD(t):fD(t)}function cb(t,s){return function(n){return t(s(n))}}var rp=cb(Object.getPrototypeOf,Object);function gi(t){return t!=null&&typeof t=="object"}var gD="[object Object]",yD=Function.prototype,vD=Object.prototype,db=yD.toString,xD=vD.hasOwnProperty,jD=db.call(Object);function Px(t){if(!gi(t)||pi(t)!=gD)return!1;var s=rp(t);if(s===null)return!0;var n=xD.call(s,"constructor")&&s.constructor;return typeof n=="function"&&n instanceof n&&db.call(n)==jD}function bD(){this.__data__=[],this.size=0}function ub(t,s){return t===s||t!==t&&s!==s}function Su(t,s){for(var n=t.length;n--;)if(ub(t[n][0],s))return n;return-1}var ND=Array.prototype,SD=ND.splice;function wD(t){var s=this.__data__,n=Su(s,t);if(n<0)return!1;var i=s.length-1;return n==i?s.pop():SD.call(s,n,1),--this.size,!0}function TD(t){var s=this.__data__,n=Su(s,t);return n<0?void 0:s[n][1]}function ED(t){return Su(this.__data__,t)>-1}function CD(t,s){var n=this.__data__,i=Su(n,t);return i<0?(++this.size,n.push([t,s])):n[i][1]=s,this}function Mn(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}Mn.prototype.clear=bD;Mn.prototype.delete=wD;Mn.prototype.get=TD;Mn.prototype.has=ED;Mn.prototype.set=CD;function AD(){this.__data__=new Mn,this.size=0}function DD(t){var s=this.__data__,n=s.delete(t);return this.size=s.size,n}function kD(t){return this.__data__.get(t)}function _D(t){return this.__data__.has(t)}function lc(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var OD="[object AsyncFunction]",ID="[object Function]",$D="[object GeneratorFunction]",RD="[object Proxy]";function hb(t){if(!lc(t))return!1;var s=pi(t);return s==ID||s==$D||s==OD||s==RD}var em=tn["__core-js_shared__"],qx=function(){var t=/[^.]+$/.exec(em&&em.keys&&em.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function MD(t){return!!qx&&qx in t}var zD=Function.prototype,LD=zD.toString;function yi(t){if(t!=null){try{return LD.call(t)}catch{}try{return t+""}catch{}}return""}var BD=/[\\^$.*+?()[\]{}|]/g,FD=/^\[object .+?Constructor\]$/,UD=Function.prototype,PD=Object.prototype,qD=UD.toString,HD=PD.hasOwnProperty,YD=RegExp("^"+qD.call(HD).replace(BD,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function VD(t){if(!lc(t)||MD(t))return!1;var s=hb(t)?YD:FD;return s.test(yi(t))}function GD(t,s){return t==null?void 0:t[s]}function vi(t,s){var n=GD(t,s);return VD(n)?n:void 0}var Vo=vi(tn,"Map"),Go=vi(Object,"create");function QD(){this.__data__=Go?Go(null):{},this.size=0}function XD(t){var s=this.has(t)&&delete this.__data__[t];return this.size-=s?1:0,s}var ZD="__lodash_hash_undefined__",WD=Object.prototype,KD=WD.hasOwnProperty;function JD(t){var s=this.__data__;if(Go){var n=s[t];return n===ZD?void 0:n}return KD.call(s,t)?s[t]:void 0}var ek=Object.prototype,tk=ek.hasOwnProperty;function sk(t){var s=this.__data__;return Go?s[t]!==void 0:tk.call(s,t)}var ak="__lodash_hash_undefined__";function nk(t,s){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Go&&s===void 0?ak:s,this}function ui(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}ui.prototype.clear=QD;ui.prototype.delete=XD;ui.prototype.get=JD;ui.prototype.has=sk;ui.prototype.set=nk;function rk(){this.size=0,this.__data__={hash:new ui,map:new(Vo||Mn),string:new ui}}function ik(t){var s=typeof t;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?t!=="__proto__":t===null}function wu(t,s){var n=t.__data__;return ik(s)?n[typeof s=="string"?"string":"hash"]:n.map}function lk(t){var s=wu(this,t).delete(t);return this.size-=s?1:0,s}function ok(t){return wu(this,t).get(t)}function ck(t){return wu(this,t).has(t)}function dk(t,s){var n=wu(this,t),i=n.size;return n.set(t,s),this.size+=n.size==i?0:1,this}function wr(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}wr.prototype.clear=rk;wr.prototype.delete=lk;wr.prototype.get=ok;wr.prototype.has=ck;wr.prototype.set=dk;var uk=200;function hk(t,s){var n=this.__data__;if(n instanceof Mn){var i=n.__data__;if(!Vo||i.length<uk-1)return i.push([t,s]),this.size=++n.size,this;n=this.__data__=new wr(i)}return n.set(t,s),this.size=n.size,this}function Dl(t){var s=this.__data__=new Mn(t);this.size=s.size}Dl.prototype.clear=AD;Dl.prototype.delete=DD;Dl.prototype.get=kD;Dl.prototype.has=_D;Dl.prototype.set=hk;function fk(t,s){for(var n=-1,i=t==null?0:t.length;++n<i&&s(t[n],n,t)!==!1;);return t}var Hx=function(){try{var t=vi(Object,"defineProperty");return t({},"",{}),t}catch{}}();function fb(t,s,n){s=="__proto__"&&Hx?Hx(t,s,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[s]=n}var mk=Object.prototype,pk=mk.hasOwnProperty;function mb(t,s,n){var i=t[s];(!(pk.call(t,s)&&ub(i,n))||n===void 0&&!(s in t))&&fb(t,s,n)}function Tu(t,s,n,i){var l=!n;n||(n={});for(var c=-1,u=s.length;++c<u;){var f=s[c],p=void 0;p===void 0&&(p=t[f]),l?fb(n,f,p):mb(n,f,p)}return n}function gk(t,s){for(var n=-1,i=Array(t);++n<t;)i[n]=s(n);return i}var yk="[object Arguments]";function Yx(t){return gi(t)&&pi(t)==yk}var pb=Object.prototype,vk=pb.hasOwnProperty,xk=pb.propertyIsEnumerable,jk=Yx(function(){return arguments}())?Yx:function(t){return gi(t)&&vk.call(t,"callee")&&!xk.call(t,"callee")},oc=Array.isArray;function bk(){return!1}var gb=typeof ta=="object"&&ta&&!ta.nodeType&&ta,Vx=gb&&typeof sa=="object"&&sa&&!sa.nodeType&&sa,Nk=Vx&&Vx.exports===gb,Gx=Nk?tn.Buffer:void 0,Sk=Gx?Gx.isBuffer:void 0,yb=Sk||bk,wk=9007199254740991,Tk=/^(?:0|[1-9]\d*)$/;function Ek(t,s){var n=typeof t;return s=s??wk,!!s&&(n=="number"||n!="symbol"&&Tk.test(t))&&t>-1&&t%1==0&&t<s}var Ck=9007199254740991;function vb(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ck}var Ak="[object Arguments]",Dk="[object Array]",kk="[object Boolean]",_k="[object Date]",Ok="[object Error]",Ik="[object Function]",$k="[object Map]",Rk="[object Number]",Mk="[object Object]",zk="[object RegExp]",Lk="[object Set]",Bk="[object String]",Fk="[object WeakMap]",Uk="[object ArrayBuffer]",Pk="[object DataView]",qk="[object Float32Array]",Hk="[object Float64Array]",Yk="[object Int8Array]",Vk="[object Int16Array]",Gk="[object Int32Array]",Qk="[object Uint8Array]",Xk="[object Uint8ClampedArray]",Zk="[object Uint16Array]",Wk="[object Uint32Array]",wt={};wt[qk]=wt[Hk]=wt[Yk]=wt[Vk]=wt[Gk]=wt[Qk]=wt[Xk]=wt[Zk]=wt[Wk]=!0;wt[Ak]=wt[Dk]=wt[Uk]=wt[kk]=wt[Pk]=wt[_k]=wt[Ok]=wt[Ik]=wt[$k]=wt[Rk]=wt[Mk]=wt[zk]=wt[Lk]=wt[Bk]=wt[Fk]=!1;function Kk(t){return gi(t)&&vb(t.length)&&!!wt[pi(t)]}function ip(t){return function(s){return t(s)}}var xb=typeof ta=="object"&&ta&&!ta.nodeType&&ta,Mo=xb&&typeof sa=="object"&&sa&&!sa.nodeType&&sa,Jk=Mo&&Mo.exports===xb,tm=Jk&&lb.process,jl=function(){try{var t=Mo&&Mo.require&&Mo.require("util").types;return t||tm&&tm.binding&&tm.binding("util")}catch{}}(),Qx=jl&&jl.isTypedArray,e_=Qx?ip(Qx):Kk,t_=Object.prototype,s_=t_.hasOwnProperty;function jb(t,s){var n=oc(t),i=!n&&jk(t),l=!n&&!i&&yb(t),c=!n&&!i&&!l&&e_(t),u=n||i||l||c,f=u?gk(t.length,String):[],p=f.length;for(var m in t)(s||s_.call(t,m))&&!(u&&(m=="length"||l&&(m=="offset"||m=="parent")||c&&(m=="buffer"||m=="byteLength"||m=="byteOffset")||Ek(m,p)))&&f.push(m);return f}var a_=Object.prototype;function lp(t){var s=t&&t.constructor,n=typeof s=="function"&&s.prototype||a_;return t===n}var n_=cb(Object.keys,Object),r_=Object.prototype,i_=r_.hasOwnProperty;function l_(t){if(!lp(t))return n_(t);var s=[];for(var n in Object(t))i_.call(t,n)&&n!="constructor"&&s.push(n);return s}function bb(t){return t!=null&&vb(t.length)&&!hb(t)}function op(t){return bb(t)?jb(t):l_(t)}function o_(t,s){return t&&Tu(s,op(s),t)}function c_(t){var s=[];if(t!=null)for(var n in Object(t))s.push(n);return s}var d_=Object.prototype,u_=d_.hasOwnProperty;function h_(t){if(!lc(t))return c_(t);var s=lp(t),n=[];for(var i in t)i=="constructor"&&(s||!u_.call(t,i))||n.push(i);return n}function cp(t){return bb(t)?jb(t,!0):h_(t)}function f_(t,s){return t&&Tu(s,cp(s),t)}var Nb=typeof ta=="object"&&ta&&!ta.nodeType&&ta,Xx=Nb&&typeof sa=="object"&&sa&&!sa.nodeType&&sa,m_=Xx&&Xx.exports===Nb,Zx=m_?tn.Buffer:void 0,Wx=Zx?Zx.allocUnsafe:void 0;function p_(t,s){if(s)return t.slice();var n=t.length,i=Wx?Wx(n):new t.constructor(n);return t.copy(i),i}function Sb(t,s){var n=-1,i=t.length;for(s||(s=Array(i));++n<i;)s[n]=t[n];return s}function g_(t,s){for(var n=-1,i=t==null?0:t.length,l=0,c=[];++n<i;){var u=t[n];s(u,n,t)&&(c[l++]=u)}return c}function wb(){return[]}var y_=Object.prototype,v_=y_.propertyIsEnumerable,Kx=Object.getOwnPropertySymbols,dp=Kx?function(t){return t==null?[]:(t=Object(t),g_(Kx(t),function(s){return v_.call(t,s)}))}:wb;function x_(t,s){return Tu(t,dp(t),s)}function Tb(t,s){for(var n=-1,i=s.length,l=t.length;++n<i;)t[l+n]=s[n];return t}var j_=Object.getOwnPropertySymbols,Eb=j_?function(t){for(var s=[];t;)Tb(s,dp(t)),t=rp(t);return s}:wb;function b_(t,s){return Tu(t,Eb(t),s)}function Cb(t,s,n){var i=s(t);return oc(t)?i:Tb(i,n(t))}function N_(t){return Cb(t,op,dp)}function S_(t){return Cb(t,cp,Eb)}var km=vi(tn,"DataView"),_m=vi(tn,"Promise"),Om=vi(tn,"Set"),Im=vi(tn,"WeakMap"),Jx="[object Map]",w_="[object Object]",ej="[object Promise]",tj="[object Set]",sj="[object WeakMap]",aj="[object DataView]",T_=yi(km),E_=yi(Vo),C_=yi(_m),A_=yi(Om),D_=yi(Im),wn=pi;(km&&wn(new km(new ArrayBuffer(1)))!=aj||Vo&&wn(new Vo)!=Jx||_m&&wn(_m.resolve())!=ej||Om&&wn(new Om)!=tj||Im&&wn(new Im)!=sj)&&(wn=function(t){var s=pi(t),n=s==w_?t.constructor:void 0,i=n?yi(n):"";if(i)switch(i){case T_:return aj;case E_:return Jx;case C_:return ej;case A_:return tj;case D_:return sj}return s});var k_=Object.prototype,__=k_.hasOwnProperty;function O_(t){var s=t.length,n=new t.constructor(s);return s&&typeof t[0]=="string"&&__.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var nj=tn.Uint8Array;function up(t){var s=new t.constructor(t.byteLength);return new nj(s).set(new nj(t)),s}function I_(t,s){var n=s?up(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var $_=/\w*$/;function R_(t){var s=new t.constructor(t.source,$_.exec(t));return s.lastIndex=t.lastIndex,s}var rj=vr?vr.prototype:void 0,ij=rj?rj.valueOf:void 0;function M_(t){return ij?Object(ij.call(t)):{}}function z_(t,s){var n=s?up(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var L_="[object Boolean]",B_="[object Date]",F_="[object Map]",U_="[object Number]",P_="[object RegExp]",q_="[object Set]",H_="[object String]",Y_="[object Symbol]",V_="[object ArrayBuffer]",G_="[object DataView]",Q_="[object Float32Array]",X_="[object Float64Array]",Z_="[object Int8Array]",W_="[object Int16Array]",K_="[object Int32Array]",J_="[object Uint8Array]",eO="[object Uint8ClampedArray]",tO="[object Uint16Array]",sO="[object Uint32Array]";function aO(t,s,n){var i=t.constructor;switch(s){case V_:return up(t);case L_:case B_:return new i(+t);case G_:return I_(t,n);case Q_:case X_:case Z_:case W_:case K_:case J_:case eO:case tO:case sO:return z_(t,n);case F_:return new i;case U_:case H_:return new i(t);case P_:return R_(t);case q_:return new i;case Y_:return M_(t)}}var lj=Object.create,nO=function(){function t(){}return function(s){if(!lc(s))return{};if(lj)return lj(s);t.prototype=s;var n=new t;return t.prototype=void 0,n}}();function rO(t){return typeof t.constructor=="function"&&!lp(t)?nO(rp(t)):{}}var iO="[object Map]";function lO(t){return gi(t)&&wn(t)==iO}var oj=jl&&jl.isMap,oO=oj?ip(oj):lO,cO="[object Set]";function dO(t){return gi(t)&&wn(t)==cO}var cj=jl&&jl.isSet,uO=cj?ip(cj):dO,hO=1,fO=2,mO=4,Ab="[object Arguments]",pO="[object Array]",gO="[object Boolean]",yO="[object Date]",vO="[object Error]",Db="[object Function]",xO="[object GeneratorFunction]",jO="[object Map]",bO="[object Number]",kb="[object Object]",NO="[object RegExp]",SO="[object Set]",wO="[object String]",TO="[object Symbol]",EO="[object WeakMap]",CO="[object ArrayBuffer]",AO="[object DataView]",DO="[object Float32Array]",kO="[object Float64Array]",_O="[object Int8Array]",OO="[object Int16Array]",IO="[object Int32Array]",$O="[object Uint8Array]",RO="[object Uint8ClampedArray]",MO="[object Uint16Array]",zO="[object Uint32Array]",Nt={};Nt[Ab]=Nt[pO]=Nt[CO]=Nt[AO]=Nt[gO]=Nt[yO]=Nt[DO]=Nt[kO]=Nt[_O]=Nt[OO]=Nt[IO]=Nt[jO]=Nt[bO]=Nt[kb]=Nt[NO]=Nt[SO]=Nt[wO]=Nt[TO]=Nt[$O]=Nt[RO]=Nt[MO]=Nt[zO]=!0;Nt[vO]=Nt[Db]=Nt[EO]=!1;function zo(t,s,n,i,l,c){var u,f=s&hO,p=s&fO,m=s&mO;if(u!==void 0)return u;if(!lc(t))return t;var g=oc(t);if(g){if(u=O_(t),!f)return Sb(t,u)}else{var v=wn(t),j=v==Db||v==xO;if(yb(t))return p_(t,f);if(v==kb||v==Ab||j&&!l){if(u=p||j?{}:rO(t),!f)return p?b_(t,f_(u,t)):x_(t,o_(u,t))}else{if(!Nt[v])return l?t:{};u=aO(t,v,f)}}c||(c=new Dl);var N=c.get(t);if(N)return N;c.set(t,u),uO(t)?t.forEach(function(C){u.add(zo(C,s,n,C,t,c))}):oO(t)&&t.forEach(function(C,T){u.set(T,zo(C,s,n,T,t,c))});var b=m?p?S_:N_:p?cp:op,w=g?void 0:b(t);return fk(w||t,function(C,T){w&&(T=C,C=t[T]),mb(u,T,zo(C,s,n,T,t,c))}),u}var LO=1,BO=4;function Ad(t){return zo(t,LO|BO)}var sm,dj;function FO(){if(dj)return sm;dj=1;var t=Array.isArray,s=Object.keys,n=Object.prototype.hasOwnProperty,i=typeof Element<"u";function l(c,u){if(c===u)return!0;if(c&&u&&typeof c=="object"&&typeof u=="object"){var f=t(c),p=t(u),m,g,v;if(f&&p){if(g=c.length,g!=u.length)return!1;for(m=g;m--!==0;)if(!l(c[m],u[m]))return!1;return!0}if(f!=p)return!1;var j=c instanceof Date,N=u instanceof Date;if(j!=N)return!1;if(j&&N)return c.getTime()==u.getTime();var b=c instanceof RegExp,w=u instanceof RegExp;if(b!=w)return!1;if(b&&w)return c.toString()==u.toString();var C=s(c);if(g=C.length,g!==s(u).length)return!1;for(m=g;m--!==0;)if(!n.call(u,C[m]))return!1;if(i&&c instanceof Element&&u instanceof Element)return c===u;for(m=g;m--!==0;)if(v=C[m],!(v==="_owner"&&c.$$typeof)&&!l(c[v],u[v]))return!1;return!0}return c!==c&&u!==u}return sm=function(u,f){try{return l(u,f)}catch(p){if(p.message&&p.message.match(/stack|recursion/i)||p.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",p.name,p.message),!1;throw p}},sm}var UO=FO();const Zr=en(UO);var PO=4;function uj(t){return zo(t,PO)}function _b(t,s){for(var n=-1,i=t==null?0:t.length,l=Array(i);++n<i;)l[n]=s(t[n],n,t);return l}var qO="[object Symbol]";function hp(t){return typeof t=="symbol"||gi(t)&&pi(t)==qO}var HO="Expected a function";function fp(t,s){if(typeof t!="function"||s!=null&&typeof s!="function")throw new TypeError(HO);var n=function(){var i=arguments,l=s?s.apply(this,i):i[0],c=n.cache;if(c.has(l))return c.get(l);var u=t.apply(this,i);return n.cache=c.set(l,u)||c,u};return n.cache=new(fp.Cache||wr),n}fp.Cache=wr;var YO=500;function VO(t){var s=fp(t,function(i){return n.size===YO&&n.clear(),i}),n=s.cache;return s}var GO=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,QO=/\\(\\)?/g,XO=VO(function(t){var s=[];return t.charCodeAt(0)===46&&s.push(""),t.replace(GO,function(n,i,l,c){s.push(l?c.replace(QO,"$1"):i||n)}),s});function ZO(t){if(typeof t=="string"||hp(t))return t;var s=t+"";return s=="0"&&1/t==-1/0?"-0":s}var hj=vr?vr.prototype:void 0,fj=hj?hj.toString:void 0;function Ob(t){if(typeof t=="string")return t;if(oc(t))return _b(t,Ob)+"";if(hp(t))return fj?fj.call(t):"";var s=t+"";return s=="0"&&1/t==-1/0?"-0":s}function WO(t){return t==null?"":Ob(t)}function Ib(t){return oc(t)?_b(t,ZO):hp(t)?[t]:Sb(XO(WO(t)))}var am={exports:{}},ct={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mj;function KO(){if(mj)return ct;mj=1;var t=typeof Symbol=="function"&&Symbol.for,s=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,i=t?Symbol.for("react.fragment"):60107,l=t?Symbol.for("react.strict_mode"):60108,c=t?Symbol.for("react.profiler"):60114,u=t?Symbol.for("react.provider"):60109,f=t?Symbol.for("react.context"):60110,p=t?Symbol.for("react.async_mode"):60111,m=t?Symbol.for("react.concurrent_mode"):60111,g=t?Symbol.for("react.forward_ref"):60112,v=t?Symbol.for("react.suspense"):60113,j=t?Symbol.for("react.suspense_list"):60120,N=t?Symbol.for("react.memo"):60115,b=t?Symbol.for("react.lazy"):60116,w=t?Symbol.for("react.block"):60121,C=t?Symbol.for("react.fundamental"):60117,T=t?Symbol.for("react.responder"):60118,A=t?Symbol.for("react.scope"):60119;function _(S){if(typeof S=="object"&&S!==null){var R=S.$$typeof;switch(R){case s:switch(S=S.type,S){case p:case m:case i:case c:case l:case v:return S;default:switch(S=S&&S.$$typeof,S){case f:case g:case b:case N:case u:return S;default:return R}}case n:return R}}}function D(S){return _(S)===m}return ct.AsyncMode=p,ct.ConcurrentMode=m,ct.ContextConsumer=f,ct.ContextProvider=u,ct.Element=s,ct.ForwardRef=g,ct.Fragment=i,ct.Lazy=b,ct.Memo=N,ct.Portal=n,ct.Profiler=c,ct.StrictMode=l,ct.Suspense=v,ct.isAsyncMode=function(S){return D(S)||_(S)===p},ct.isConcurrentMode=D,ct.isContextConsumer=function(S){return _(S)===f},ct.isContextProvider=function(S){return _(S)===u},ct.isElement=function(S){return typeof S=="object"&&S!==null&&S.$$typeof===s},ct.isForwardRef=function(S){return _(S)===g},ct.isFragment=function(S){return _(S)===i},ct.isLazy=function(S){return _(S)===b},ct.isMemo=function(S){return _(S)===N},ct.isPortal=function(S){return _(S)===n},ct.isProfiler=function(S){return _(S)===c},ct.isStrictMode=function(S){return _(S)===l},ct.isSuspense=function(S){return _(S)===v},ct.isValidElementType=function(S){return typeof S=="string"||typeof S=="function"||S===i||S===m||S===c||S===l||S===v||S===j||typeof S=="object"&&S!==null&&(S.$$typeof===b||S.$$typeof===N||S.$$typeof===u||S.$$typeof===f||S.$$typeof===g||S.$$typeof===C||S.$$typeof===T||S.$$typeof===A||S.$$typeof===w)},ct.typeOf=_,ct}var pj;function JO(){return pj||(pj=1,am.exports=KO()),am.exports}var nm,gj;function eI(){if(gj)return nm;gj=1;var t=JO(),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},c={};c[t.ForwardRef]=i,c[t.Memo]=l;function u(b){return t.isMemo(b)?l:c[b.$$typeof]||s}var f=Object.defineProperty,p=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,g=Object.getOwnPropertyDescriptor,v=Object.getPrototypeOf,j=Object.prototype;function N(b,w,C){if(typeof w!="string"){if(j){var T=v(w);T&&T!==j&&N(b,T,C)}var A=p(w);m&&(A=A.concat(m(w)));for(var _=u(b),D=u(w),S=0;S<A.length;++S){var R=A[S];if(!n[R]&&!(C&&C[R])&&!(D&&D[R])&&!(_&&_[R])){var E=g(w,R);try{f(b,R,E)}catch{}}}}return b}return nm=N,nm}eI();function Tt(){return Tt=Object.assign||function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Tt.apply(this,arguments)}function nl(t,s){if(t==null)return{};var n={},i=Object.keys(t),l,c;for(c=0;c<i.length;c++)l=i[c],!(s.indexOf(l)>=0)&&(n[l]=t[l]);return n}var Eu=x.createContext(void 0);Eu.displayName="FormikContext";var tI=Eu.Provider;Eu.Consumer;function Tr(){var t=x.useContext(Eu);return t}var Ks=function(s){return typeof s=="function"},cc=function(s){return s!==null&&typeof s=="object"},sI=function(s){return String(Math.floor(Number(s)))===s},rm=function(s){return Object.prototype.toString.call(s)==="[object String]"},aI=function(s){return x.Children.count(s)===0},im=function(s){return cc(s)&&Ks(s.then)};function Zs(t,s,n,i){i===void 0&&(i=0);for(var l=Ib(s);t&&i<l.length;)t=t[l[i++]];return i!==l.length&&!t||t===void 0?n:t}function ii(t,s,n){for(var i=uj(t),l=i,c=0,u=Ib(s);c<u.length-1;c++){var f=u[c],p=Zs(t,u.slice(0,c+1));if(p&&(cc(p)||Array.isArray(p)))l=l[f]=uj(p);else{var m=u[c+1];l=l[f]=sI(m)&&Number(m)>=0?[]:{}}}return(c===0?t:l)[u[c]]===n?t:(n===void 0?delete l[u[c]]:l[u[c]]=n,c===0&&n===void 0&&delete i[u[c]],i)}function $b(t,s,n,i){n===void 0&&(n=new WeakMap),i===void 0&&(i={});for(var l=0,c=Object.keys(t);l<c.length;l++){var u=c[l],f=t[u];cc(f)?n.get(f)||(n.set(f,!0),i[u]=Array.isArray(f)?[]:{},$b(f,s,n,i[u])):i[u]=s}return i}function nI(t,s){switch(s.type){case"SET_VALUES":return Tt({},t,{values:s.payload});case"SET_TOUCHED":return Tt({},t,{touched:s.payload});case"SET_ERRORS":return Zr(t.errors,s.payload)?t:Tt({},t,{errors:s.payload});case"SET_STATUS":return Tt({},t,{status:s.payload});case"SET_ISSUBMITTING":return Tt({},t,{isSubmitting:s.payload});case"SET_ISVALIDATING":return Tt({},t,{isValidating:s.payload});case"SET_FIELD_VALUE":return Tt({},t,{values:ii(t.values,s.payload.field,s.payload.value)});case"SET_FIELD_TOUCHED":return Tt({},t,{touched:ii(t.touched,s.payload.field,s.payload.value)});case"SET_FIELD_ERROR":return Tt({},t,{errors:ii(t.errors,s.payload.field,s.payload.value)});case"RESET_FORM":return Tt({},t,s.payload);case"SET_FORMIK_STATE":return s.payload(t);case"SUBMIT_ATTEMPT":return Tt({},t,{touched:$b(t.values,!0),isSubmitting:!0,submitCount:t.submitCount+1});case"SUBMIT_FAILURE":return Tt({},t,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Tt({},t,{isSubmitting:!1});default:return t}}var Xr={},Dd={};function rI(t){var s=t.validateOnChange,n=s===void 0?!0:s,i=t.validateOnBlur,l=i===void 0?!0:i,c=t.validateOnMount,u=c===void 0?!1:c,f=t.isInitialValid,p=t.enableReinitialize,m=p===void 0?!1:p,g=t.onSubmit,v=nl(t,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),j=Tt({validateOnChange:n,validateOnBlur:l,validateOnMount:u,onSubmit:g},v),N=x.useRef(j.initialValues),b=x.useRef(j.initialErrors||Xr),w=x.useRef(j.initialTouched||Dd),C=x.useRef(j.initialStatus),T=x.useRef(!1),A=x.useRef({});x.useEffect(function(){return T.current=!0,function(){T.current=!1}},[]);var _=x.useState(0),D=_[1],S=x.useRef({values:Ad(j.initialValues),errors:Ad(j.initialErrors)||Xr,touched:Ad(j.initialTouched)||Dd,status:Ad(j.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),R=S.current,E=x.useCallback(function(V){var ue=S.current;S.current=nI(ue,V),ue!==S.current&&D(function(ve){return ve+1})},[]),k=x.useCallback(function(V,ue){return new Promise(function(ve,Ne){var _e=j.validate(V,ue);_e==null?ve(Xr):im(_e)?_e.then(function(Ie){ve(Ie||Xr)},function(Ie){Ne(Ie)}):ve(_e)})},[j.validate]),I=x.useCallback(function(V,ue){var ve=j.validationSchema,Ne=Ks(ve)?ve(ue):ve,_e=ue&&Ne.validateAt?Ne.validateAt(ue,V):lI(V,Ne);return new Promise(function(Ie,Ue){_e.then(function(){Ie(Xr)},function($t){$t.name==="ValidationError"?Ie(iI($t)):Ue($t)})})},[j.validationSchema]),M=x.useCallback(function(V,ue){return new Promise(function(ve){return ve(A.current[V].validate(ue))})},[]),z=x.useCallback(function(V){var ue=Object.keys(A.current).filter(function(Ne){return Ks(A.current[Ne].validate)}),ve=ue.length>0?ue.map(function(Ne){return M(Ne,Zs(V,Ne))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(ve).then(function(Ne){return Ne.reduce(function(_e,Ie,Ue){return Ie==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||Ie&&(_e=ii(_e,ue[Ue],Ie)),_e},{})})},[M]),Z=x.useCallback(function(V){return Promise.all([z(V),j.validationSchema?I(V):{},j.validate?k(V):{}]).then(function(ue){var ve=ue[0],Ne=ue[1],_e=ue[2],Ie=Dm.all([ve,Ne,_e],{arrayMerge:oI});return Ie})},[j.validate,j.validationSchema,z,k,I]),ee=va(function(V){return V===void 0&&(V=R.values),E({type:"SET_ISVALIDATING",payload:!0}),Z(V).then(function(ue){return T.current&&(E({type:"SET_ISVALIDATING",payload:!1}),E({type:"SET_ERRORS",payload:ue})),ue})});x.useEffect(function(){u&&T.current===!0&&Zr(N.current,j.initialValues)&&ee(N.current)},[u,ee]);var W=x.useCallback(function(V){var ue=V&&V.values?V.values:N.current,ve=V&&V.errors?V.errors:b.current?b.current:j.initialErrors||{},Ne=V&&V.touched?V.touched:w.current?w.current:j.initialTouched||{},_e=V&&V.status?V.status:C.current?C.current:j.initialStatus;N.current=ue,b.current=ve,w.current=Ne,C.current=_e;var Ie=function(){E({type:"RESET_FORM",payload:{isSubmitting:!!V&&!!V.isSubmitting,errors:ve,touched:Ne,status:_e,values:ue,isValidating:!!V&&!!V.isValidating,submitCount:V&&V.submitCount&&typeof V.submitCount=="number"?V.submitCount:0}})};if(j.onReset){var Ue=j.onReset(R.values,re);im(Ue)?Ue.then(Ie):Ie()}else Ie()},[j.initialErrors,j.initialStatus,j.initialTouched,j.onReset]);x.useEffect(function(){T.current===!0&&!Zr(N.current,j.initialValues)&&m&&(N.current=j.initialValues,W(),u&&ee(N.current))},[m,j.initialValues,W,u,ee]),x.useEffect(function(){m&&T.current===!0&&!Zr(b.current,j.initialErrors)&&(b.current=j.initialErrors||Xr,E({type:"SET_ERRORS",payload:j.initialErrors||Xr}))},[m,j.initialErrors]),x.useEffect(function(){m&&T.current===!0&&!Zr(w.current,j.initialTouched)&&(w.current=j.initialTouched||Dd,E({type:"SET_TOUCHED",payload:j.initialTouched||Dd}))},[m,j.initialTouched]),x.useEffect(function(){m&&T.current===!0&&!Zr(C.current,j.initialStatus)&&(C.current=j.initialStatus,E({type:"SET_STATUS",payload:j.initialStatus}))},[m,j.initialStatus,j.initialTouched]);var K=va(function(V){if(A.current[V]&&Ks(A.current[V].validate)){var ue=Zs(R.values,V),ve=A.current[V].validate(ue);return im(ve)?(E({type:"SET_ISVALIDATING",payload:!0}),ve.then(function(Ne){return Ne}).then(function(Ne){E({type:"SET_FIELD_ERROR",payload:{field:V,value:Ne}}),E({type:"SET_ISVALIDATING",payload:!1})})):(E({type:"SET_FIELD_ERROR",payload:{field:V,value:ve}}),Promise.resolve(ve))}else if(j.validationSchema)return E({type:"SET_ISVALIDATING",payload:!0}),I(R.values,V).then(function(Ne){return Ne}).then(function(Ne){E({type:"SET_FIELD_ERROR",payload:{field:V,value:Zs(Ne,V)}}),E({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),Q=x.useCallback(function(V,ue){var ve=ue.validate;A.current[V]={validate:ve}},[]),ne=x.useCallback(function(V){delete A.current[V]},[]),X=va(function(V,ue){E({type:"SET_TOUCHED",payload:V});var ve=ue===void 0?l:ue;return ve?ee(R.values):Promise.resolve()}),se=x.useCallback(function(V){E({type:"SET_ERRORS",payload:V})},[]),O=va(function(V,ue){var ve=Ks(V)?V(R.values):V;E({type:"SET_VALUES",payload:ve});var Ne=ue===void 0?n:ue;return Ne?ee(ve):Promise.resolve()}),B=x.useCallback(function(V,ue){E({type:"SET_FIELD_ERROR",payload:{field:V,value:ue}})},[]),L=va(function(V,ue,ve){E({type:"SET_FIELD_VALUE",payload:{field:V,value:ue}});var Ne=ve===void 0?n:ve;return Ne?ee(ii(R.values,V,ue)):Promise.resolve()}),Y=x.useCallback(function(V,ue){var ve=ue,Ne=V,_e;if(!rm(V)){V.persist&&V.persist();var Ie=V.target?V.target:V.currentTarget,Ue=Ie.type,$t=Ie.name,qe=Ie.id,mt=Ie.value,Rt=Ie.checked;Ie.outerHTML;var Pt=Ie.options,xt=Ie.multiple;ve=ue||$t||qe,Ne=/number|range/.test(Ue)?(_e=parseFloat(mt),isNaN(_e)?"":_e):/checkbox/.test(Ue)?dI(Zs(R.values,ve),Rt,mt):Pt&&xt?cI(Pt):mt}ve&&L(ve,Ne)},[L,R.values]),H=va(function(V){if(rm(V))return function(ue){return Y(ue,V)};Y(V)}),P=va(function(V,ue,ve){ue===void 0&&(ue=!0),E({type:"SET_FIELD_TOUCHED",payload:{field:V,value:ue}});var Ne=ve===void 0?l:ve;return Ne?ee(R.values):Promise.resolve()}),q=x.useCallback(function(V,ue){V.persist&&V.persist();var ve=V.target,Ne=ve.name,_e=ve.id;ve.outerHTML;var Ie=ue||Ne||_e;P(Ie,!0)},[P]),F=va(function(V){if(rm(V))return function(ue){return q(ue,V)};q(V)}),te=x.useCallback(function(V){Ks(V)?E({type:"SET_FORMIK_STATE",payload:V}):E({type:"SET_FORMIK_STATE",payload:function(){return V}})},[]),ae=x.useCallback(function(V){E({type:"SET_STATUS",payload:V})},[]),oe=x.useCallback(function(V){E({type:"SET_ISSUBMITTING",payload:V})},[]),ce=va(function(){return E({type:"SUBMIT_ATTEMPT"}),ee().then(function(V){var ue=V instanceof Error,ve=!ue&&Object.keys(V).length===0;if(ve){var Ne;try{if(Ne=pe(),Ne===void 0)return}catch(_e){throw _e}return Promise.resolve(Ne).then(function(_e){return T.current&&E({type:"SUBMIT_SUCCESS"}),_e}).catch(function(_e){if(T.current)throw E({type:"SUBMIT_FAILURE"}),_e})}else if(T.current&&(E({type:"SUBMIT_FAILURE"}),ue))throw V})}),G=va(function(V){V&&V.preventDefault&&Ks(V.preventDefault)&&V.preventDefault(),V&&V.stopPropagation&&Ks(V.stopPropagation)&&V.stopPropagation(),ce().catch(function(ue){console.warn("Warning: An unhandled error was caught from submitForm()",ue)})}),re={resetForm:W,validateForm:ee,validateField:K,setErrors:se,setFieldError:B,setFieldTouched:P,setFieldValue:L,setStatus:ae,setSubmitting:oe,setTouched:X,setValues:O,setFormikState:te,submitForm:ce},pe=va(function(){return g(R.values,re)}),me=va(function(V){V&&V.preventDefault&&Ks(V.preventDefault)&&V.preventDefault(),V&&V.stopPropagation&&Ks(V.stopPropagation)&&V.stopPropagation(),W()}),je=x.useCallback(function(V){return{value:Zs(R.values,V),error:Zs(R.errors,V),touched:!!Zs(R.touched,V),initialValue:Zs(N.current,V),initialTouched:!!Zs(w.current,V),initialError:Zs(b.current,V)}},[R.errors,R.touched,R.values]),Oe=x.useCallback(function(V){return{setValue:function(ve,Ne){return L(V,ve,Ne)},setTouched:function(ve,Ne){return P(V,ve,Ne)},setError:function(ve){return B(V,ve)}}},[L,P,B]),De=x.useCallback(function(V){var ue=cc(V),ve=ue?V.name:V,Ne=Zs(R.values,ve),_e={name:ve,value:Ne,onChange:H,onBlur:F};if(ue){var Ie=V.type,Ue=V.value,$t=V.as,qe=V.multiple;Ie==="checkbox"?Ue===void 0?_e.checked=!!Ne:(_e.checked=!!(Array.isArray(Ne)&&~Ne.indexOf(Ue)),_e.value=Ue):Ie==="radio"?(_e.checked=Ne===Ue,_e.value=Ue):$t==="select"&&qe&&(_e.value=_e.value||[],_e.multiple=!0)}return _e},[F,H,R.values]),be=x.useMemo(function(){return!Zr(N.current,R.values)},[N.current,R.values]),Te=x.useMemo(function(){return typeof f<"u"?be?R.errors&&Object.keys(R.errors).length===0:f!==!1&&Ks(f)?f(j):f:R.errors&&Object.keys(R.errors).length===0},[f,be,R.errors,j]),Be=Tt({},R,{initialValues:N.current,initialErrors:b.current,initialTouched:w.current,initialStatus:C.current,handleBlur:F,handleChange:H,handleReset:me,handleSubmit:G,resetForm:W,setErrors:se,setFormikState:te,setFieldTouched:P,setFieldValue:L,setFieldError:B,setStatus:ae,setSubmitting:oe,setTouched:X,setValues:O,submitForm:ce,validateForm:ee,validateField:K,isValid:Te,dirty:be,unregisterField:ne,registerField:Q,getFieldProps:De,getFieldMeta:je,getFieldHelpers:Oe,validateOnBlur:l,validateOnChange:n,validateOnMount:u});return Be}function xr(t){var s=rI(t),n=t.component,i=t.children,l=t.render,c=t.innerRef;return x.useImperativeHandle(c,function(){return s}),x.createElement(tI,{value:s},n?x.createElement(n,s):l?l(s):i?Ks(i)?i(s):aI(i)?null:x.Children.only(i):null)}function iI(t){var s={};if(t.inner){if(t.inner.length===0)return ii(s,t.path,t.message);for(var l=t.inner,n=Array.isArray(l),i=0,l=n?l:l[Symbol.iterator]();;){var c;if(n){if(i>=l.length)break;c=l[i++]}else{if(i=l.next(),i.done)break;c=i.value}var u=c;Zs(s,u.path)||(s=ii(s,u.path,u.message))}}return s}function lI(t,s,n,i){n===void 0&&(n=!1);var l=$m(t);return s[n?"validateSync":"validate"](l,{abortEarly:!1,context:l})}function $m(t){var s=Array.isArray(t)?[]:{};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=String(n);Array.isArray(t[i])===!0?s[i]=t[i].map(function(l){return Array.isArray(l)===!0||Px(l)?$m(l):l!==""?l:void 0}):Px(t[i])?s[i]=$m(t[i]):s[i]=t[i]!==""?t[i]:void 0}return s}function oI(t,s,n){var i=t.slice();return s.forEach(function(c,u){if(typeof i[u]>"u"){var f=n.clone!==!1,p=f&&n.isMergeableObject(c);i[u]=p?Dm(Array.isArray(c)?[]:{},c,n):c}else n.isMergeableObject(c)?i[u]=Dm(t[u],c,n):t.indexOf(c)===-1&&i.push(c)}),i}function cI(t){return Array.from(t).filter(function(s){return s.selected}).map(function(s){return s.value})}function dI(t,s,n){if(typeof t=="boolean")return!!s;var i=[],l=!1,c=-1;if(Array.isArray(t))i=t,c=t.indexOf(n),l=c>=0;else if(!n||n=="true"||n=="false")return!!s;return s&&n&&!l?i.concat(n):l?i.slice(0,c).concat(i.slice(c+1)):i}var uI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?x.useLayoutEffect:x.useEffect;function va(t){var s=x.useRef(t);return uI(function(){s.current=t}),x.useCallback(function(){for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return s.current.apply(void 0,i)},[])}function Rb(t){var s=Tr(),n=s.getFieldProps,i=s.getFieldMeta,l=s.getFieldHelpers,c=s.registerField,u=s.unregisterField,f=cc(t),p=f?t:{name:t},m=p.name,g=p.validate;x.useEffect(function(){return m&&c(m,{validate:g}),function(){m&&u(m)}},[c,u,m,g]);var v=x.useMemo(function(){return l(m)},[l,m]);return[n(p),i(m),v]}function $a(t){var s=t.validate,n=t.name,i=t.render,l=t.children,c=t.as,u=t.component,f=t.className,p=nl(t,["validate","name","render","children","as","component","className"]),m=Tr(),g=nl(m,["validate","validationSchema"]),v=g.registerField,j=g.unregisterField;x.useEffect(function(){return v(n,{validate:s}),function(){j(n)}},[v,j,n,s]);var N=g.getFieldProps(Tt({name:n},p)),b=g.getFieldMeta(n),w={field:N,form:g};if(i)return i(Tt({},w,{meta:b}));if(Ks(l))return l(Tt({},w,{meta:b}));if(u){if(typeof u=="string"){var C=p.innerRef,T=nl(p,["innerRef"]);return x.createElement(u,Tt({ref:C},N,T,{className:f}),l)}return x.createElement(u,Tt({field:N,form:g},p,{className:f}),l)}var A=c||"input";if(typeof A=="string"){var _=p.innerRef,D=nl(p,["innerRef"]);return x.createElement(A,Tt({ref:_},N,D,{className:f}),l)}return x.createElement(A,Tt({},N,p,{className:f}),l)}var $n=x.forwardRef(function(t,s){var n=t.action,i=nl(t,["action"]),l=n??"#",c=Tr(),u=c.handleReset,f=c.handleSubmit;return x.createElement("form",Tt({onSubmit:f,ref:s,onReset:u,action:l},i))});$n.displayName="Form";const Le=({label:t,name:s,required:n=!1,className:i="",errorMessage:l,labelIcon:c,style:u,disabled:f,children:p,searchable:m=!1,...g})=>{const[v,j]=Rb(s),N=j.touched&&j.error,[b,w]=x.useState(!1),[C,T]=x.useState(""),[A,_]=x.useState(-1),D=x.useRef(null),S=x.useRef(null),R=`${i||""} ${N?"is-invalid":""}`,E=oi.Children.toArray(p).filter(z=>oi.isValidElement(z)&&z.type==="option"),k=m?E.filter(z=>{var ee;return(((ee=z.props.children)==null?void 0:ee.toString().toLowerCase())||"").includes(C.toLowerCase())}):E,I=E.find(z=>z.props.value===v.value),M=(I==null?void 0:I.props.children)||g.placeholder||"בחר אפשרות...";return x.useEffect(()=>{const z=Z=>{D.current&&!D.current.contains(Z.target)&&(w(!1),T(""),_(-1))};if(m)return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[m]),x.useEffect(()=>{const z=Z=>{if(!(!m||!b))switch(Z.key){case"ArrowDown":Z.preventDefault(),_(ee=>ee<k.length-1?ee+1:ee);break;case"ArrowUp":Z.preventDefault(),_(ee=>ee>0?ee-1:ee);break;case"Enter":if(Z.preventDefault(),A>=0&&k[A]){const ee=k[A].props.value;v.onChange({target:{name:v.name,value:ee}}),w(!1),T(""),_(-1)}break;case"Escape":w(!1),T(""),_(-1);break}};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[m,b,A,k,v]),e.jsxs("div",{className:"form-group",style:u,children:[e.jsxs("div",{className:"field-header",children:[e.jsxs("label",{htmlFor:g.id||s,className:n?"required-field":"",children:[c&&e.jsx("span",{className:"label-icon",children:c}),t]}),N&&e.jsx("div",{className:"form-error-inline",children:l||j.error})]}),g.as==="select"?m?e.jsxs("div",{ref:D,className:"searchable-select-field",children:[e.jsxs("div",{className:`searchable-select-display ${R} ${b?"open":""}`,onClick:()=>{f||(w(!b),b||setTimeout(()=>{var z;return(z=S.current)==null?void 0:z.focus()},100))},children:[e.jsx("span",{className:`display-text ${v.value?"":"placeholder"}`,children:v.value?M:g.placeholder||"בחר אפשרות..."}),e.jsx(gt,{className:`select-chevron ${b?"open":""}`,size:14})]}),b&&e.jsxs("div",{className:"searchable-dropdown",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(gr,{size:14,className:"search-icon"}),e.jsx("input",{ref:S,type:"text",value:C,onChange:z=>{T(z.target.value),_(-1)},placeholder:"חיפוש...",className:"search-input"})]}),e.jsx("div",{className:"options-container",children:k.length>0?k.map((z,Z)=>e.jsx("div",{className:`option ${Z===A?"highlighted":""} ${z.props.value===v.value?"selected":""}`,onClick:()=>{v.onChange({target:{name:v.name,value:z.props.value}}),w(!1),T(""),_(-1)},onMouseEnter:()=>_(Z),children:z.props.children},z.props.value||Z)):e.jsx("div",{className:"no-options",children:"אין תוצאות"})})]})]}):e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{id:g.id||s,className:R,disabled:f,value:v.value===void 0||v.value===null?"":v.value,onChange:v.onChange,onBlur:v.onBlur,name:v.name,...g,children:p}),e.jsx(gt,{className:"select-chevron",size:14})]}):g.as==="textarea"?e.jsx("textarea",{id:g.id||s,className:R,disabled:f,...v,...g}):e.jsx("input",{id:g.id||s,className:R,type:g.type||"text",disabled:f,value:v.value===void 0?(g.type==="number",""):v.value,onChange:v.onChange,onBlur:v.onBlur,name:v.name,...g})]})},Js={SUNDAY:"ראשון",MONDAY:"שני",TUESDAY:"שלישי",WEDNESDAY:"רביעי",THURSDAY:"חמישי",FRIDAY:"שישי",SATURDAY:"שבת"},Mb={[Js.SUNDAY]:0,[Js.MONDAY]:1,[Js.TUESDAY]:2,[Js.WEDNESDAY]:3,[Js.THURSDAY]:4,[Js.FRIDAY]:5,[Js.SATURDAY]:6},Qo=["א","ב","ג","ד","ה","ו","ז","ח","ט","י","יא","יב","אחר"],Cu=["חלילית","חליל צד","אבוב","בסון","סקסופון","קלרינט","חצוצרה","קרן יער","טרומבון","טובה/בריטון","שירה","כינור","ויולה","צ'לו","קונטרבס","פסנתר","גיטרה","גיטרה בס","תופים"],Rm=["לא נבחן","עבר/ה","לא עבר/ה","עבר/ה בהצטיינות","עבר/ה בהצטיינות יתרה"],hI=[Js.SUNDAY,Js.MONDAY,Js.TUESDAY,Js.WEDNESDAY,Js.THURSDAY,Js.FRIDAY],fI=[30,45,60];function mI(){Tr();const[t,s,n]=Rb("personalInfo.age");return e.jsxs("div",{className:"form-section personal-info-section",children:[e.jsx("h3",{children:"פרטים אישיים"}),e.jsxs("div",{className:"form-row four-columns-mixed",children:[e.jsx(Le,{label:"שם מלא",name:"personalInfo.fullName",type:"text",required:!0,className:"wide-field"}),e.jsx(Le,{label:"טלפון",name:"personalInfo.phone",type:"tel",placeholder:"05XXXXXXXX",required:!0,className:"wide-field"}),e.jsxs("div",{className:"form-group narrow-field",children:[e.jsx("label",{htmlFor:"age-select",className:"required-field",children:"גיל"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{id:"age-select",name:t.name,value:t.value||"",onChange:t.onChange,onBlur:t.onBlur,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:2,cursor:"pointer"},children:[e.jsx("option",{value:"",children:"בחר גיל"}),Array.from({length:97},(i,l)=>l+3).map(i=>e.jsx("option",{value:i.toString(),children:i},i))]}),e.jsx("div",{className:"age-select-display",style:{position:"relative",zIndex:1,cursor:"pointer",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23a0aec0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"16px"},children:t.value||"בחר גיל"})]}),s.touched&&s.error&&e.jsx("div",{style:{color:"var(--danger, #e74c3c)",fontSize:"0.85rem",marginTop:"0.35rem"},children:s.error})]}),e.jsx(Le,{label:"כיתה",name:"academicInfo.class",as:"select",required:!0,className:"class-select narrow-field",children:Qo.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"כתובת",name:"personalInfo.address",type:"text",required:!0})}),e.jsx("h4",{children:"פרטי הורה"}),e.jsxs("div",{className:"form-row two-columns",children:[e.jsx(Le,{label:"שם הורה",name:"personalInfo.parentName",type:"text"}),e.jsx(Le,{label:"טלפון הורה",name:"personalInfo.parentPhone",type:"tel",placeholder:"05XXXXXXXX"})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"אימייל תלמיד",name:"personalInfo.studentEmail",type:"email",required:!0})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"אימייל הורה",name:"personalInfo.parentEmail",type:"email"})})]})}function pI({isEditMode:t=!1}){var Z,ee,W,K,Q,ne,X,se;const[s,n]=x.useState(!1),[i,l]=x.useState(null),[c,u]=x.useState({instrumentName:"",currentStage:1,isPrimary:!1,tests:{stageTest:{status:"לא נבחן",notes:""},technicalTest:{status:"לא נבחן",notes:""}}}),[f,p]=x.useState(!1),[m,g]=x.useState(""),[v,j]=x.useState(""),{values:N,setFieldValue:b}=Tr(),w=N.academicInfo.instrumentProgress,C=[1,2,3,4,5,6,7,8],T=Rm;x.useEffect(()=>{let O;return f&&(O=window.setTimeout(()=>{p(!1)},3e3)),()=>{O&&clearTimeout(O)}},[f]);const A=O=>{const{name:B,value:L}=O.target;if(j(""),B.includes(".")){const[Y,H,P]=B.split(".");u(q=>{const F=q[Y]||{},ae={...F[H]||{},[P]:L},oe={...F,[H]:ae};return{...q,[Y]:oe}})}else u(B==="isPrimary"?Y=>({...Y,isPrimary:O.target.checked}):Y=>({...Y,[B]:B==="currentStage"?parseInt(L,10):L}))},_=()=>c.instrumentName?w.some((O,B)=>O.instrumentName===c.instrumentName&&B!==i)?(j("כלי נגינה זה כבר קיים ברשימה"),!1):!0:(j("יש לבחור כלי נגינה"),!1),D=()=>{var L,Y,H,P,q,F,te,ae;if(!_())return;const O={instrumentName:c.instrumentName,currentStage:c.currentStage||1,isPrimary:c.isPrimary||!1,tests:{stageTest:{status:((Y=(L=c.tests)==null?void 0:L.stageTest)==null?void 0:Y.status)||"לא נבחן",notes:((P=(H=c.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((F=(q=c.tests)==null?void 0:q.technicalTest)==null?void 0:F.status)||"לא נבחן",notes:((ae=(te=c.tests)==null?void 0:te.technicalTest)==null?void 0:ae.notes)||""}}};g(O.instrumentName);const B=[...w,O];O.isPrimary&&B.forEach((oe,ce)=>{oe.instrumentName!==O.instrumentName&&(B[ce].isPrimary=!1)}),b("academicInfo.instrumentProgress",B),p(!0),E(),n(!1)},S=O=>{var L,Y,H,P,q,F,te,ae;const B=w[O];l(O),u({instrumentName:B.instrumentName,currentStage:B.currentStage,isPrimary:B.isPrimary,tests:{stageTest:{status:((Y=(L=B.tests)==null?void 0:L.stageTest)==null?void 0:Y.status)||"לא נבחן",notes:((P=(H=B.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((F=(q=B.tests)==null?void 0:q.technicalTest)==null?void 0:F.status)||"לא נבחן",notes:((ae=(te=B.tests)==null?void 0:te.technicalTest)==null?void 0:ae.notes)||""}}}),n(!0)},R=()=>{var L,Y,H,P,q,F,te,ae;if(!_()||i===null)return;const O={instrumentName:c.instrumentName,currentStage:c.currentStage||1,isPrimary:c.isPrimary||!1,tests:{stageTest:{status:((Y=(L=c.tests)==null?void 0:L.stageTest)==null?void 0:Y.status)||"לא נבחן",notes:((P=(H=c.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((F=(q=c.tests)==null?void 0:q.technicalTest)==null?void 0:F.status)||"לא נבחן",notes:((ae=(te=c.tests)==null?void 0:te.technicalTest)==null?void 0:ae.notes)||""}}};g(O.instrumentName);const B=[...w];B[i]=O,O.isPrimary&&B.forEach((oe,ce)=>{ce!==i&&(B[ce].isPrimary=!1)}),b("academicInfo.instrumentProgress",B),p(!0),E(),n(!1),l(null)},E=()=>{u({instrumentName:"",currentStage:1,isPrimary:!1,tests:{stageTest:{status:"לא נבחן",notes:""},technicalTest:{status:"לא נבחן",notes:""}}}),j("")},k=()=>{n(!1),l(null),E()},I=O=>{const B=w.filter(L=>L.instrumentName!==O);b("academicInfo.instrumentProgress",B)},M=O=>{const B=w.map(L=>({...L,isPrimary:L.instrumentName===O}));b("academicInfo.instrumentProgress",B)},z=O=>{switch(O){case"עבר/ה":return"status-passed";case"עבר/ה בהצלחה":return"status-success";case"עבר/ה בהצטיינות":return"status-excellent";case"עבר/ה בהצטיינות יתרה":return"status-excellent";case"לא עבר/ה":return"status-failed";default:return"status-pending"}};return e.jsxs("div",{className:"form-section instrument-section",children:[e.jsx("h3",{children:"כלי נגינה"}),f&&e.jsxs("div",{className:"success-message",children:[e.jsx(Bo,{size:16}),e.jsxs("span",{children:["הכלי ",m," נוסף בהצלחה"]})]}),w.length>0&&e.jsx("div",{className:"instruments-list",children:w.map((O,B)=>{var L,Y,H,P,q,F,te,ae,oe,ce,G,re,pe,me,je,Oe;return e.jsx("div",{className:"instrument-card",children:e.jsxs("div",{className:"instrument-header",children:[e.jsxs("div",{className:"instrument-info",children:[e.jsxs("div",{className:"instrument-name-wrapper",children:[e.jsxs("div",{className:"instrument-name",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:O.instrumentName}),O.isPrimary&&e.jsxs("span",{className:"primary-badge",children:[e.jsx(In,{size:12}),"ראשי"]})]}),e.jsxs("div",{className:"stage-badge",children:["שלב ",O.currentStage]})]}),t&&e.jsxs("div",{className:"test-badges",children:[e.jsxs("div",{className:`test-badge ${z(((Y=(L=O.tests)==null?void 0:L.technicalTest)==null?void 0:Y.status)||"לא נבחן")}`,children:[e.jsx("span",{className:"test-label",children:"טכני:"}),e.jsx("span",{className:"test-value",children:((P=(H=O.tests)==null?void 0:H.technicalTest)==null?void 0:P.status)||"לא נבחן"})]}),e.jsxs("div",{className:`test-badge ${z(((F=(q=O.tests)==null?void 0:q.stageTest)==null?void 0:F.status)||"לא נבחן")}`,children:[e.jsx("span",{className:"test-label",children:"שלב:"}),e.jsx("span",{className:"test-value",children:((ae=(te=O.tests)==null?void 0:te.stageTest)==null?void 0:ae.status)||"לא נבחן"})]})]}),t&&(((ce=(oe=O.tests)==null?void 0:oe.stageTest)==null?void 0:ce.notes)||((re=(G=O.tests)==null?void 0:G.technicalTest)==null?void 0:re.notes))&&e.jsx("div",{className:"test-notes",children:e.jsx("span",{children:((me=(pe=O.tests)==null?void 0:pe.stageTest)==null?void 0:me.notes)||((Oe=(je=O.tests)==null?void 0:je.technicalTest)==null?void 0:Oe.notes)})})]}),e.jsxs("div",{className:"instrument-actions",children:[e.jsx("button",{type:"button",className:"edit-btn",onClick:()=>S(B),"aria-label":"ערוך כלי נגינה",title:"ערוך כלי נגינה",children:e.jsx(Fo,{size:14})}),!O.isPrimary&&e.jsx("button",{type:"button",className:"set-primary-btn",onClick:()=>M(O.instrumentName),title:"הגדר כראשי",children:e.jsx(In,{size:14})}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>I(O.instrumentName),"aria-label":"הסר כלי נגינה",title:"הסר כלי נגינה",children:e.jsx(_t,{size:14})})]})]})},`${O.instrumentName}-${O.currentStage}-${B}`)})}),s?e.jsxs("div",{className:"add-instrument-form",children:[e.jsx("h4",{children:i!==null?"עריכת כלי נגינה":"הוספת כלי נגינה"}),v&&e.jsxs("div",{className:"form-error-message",children:[e.jsx(Us,{size:16}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"instrumentName",className:"required-field",children:"כלי נגינה"}),e.jsxs("select",{id:"instrumentName",name:"instrumentName",value:c.instrumentName,onChange:A,className:v?"is-invalid":"",children:[e.jsx("option",{value:"",children:"בחר כלי נגינה"}),Cu.map(O=>e.jsx("option",{value:O,children:O},O))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentStage",children:"שלב"}),e.jsx("select",{id:"currentStage",name:"currentStage",value:c.currentStage,onChange:A,children:C.map(O=>e.jsx("option",{value:O,children:O},O))})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stageTestStatus",children:"מבחן שלב"}),e.jsx("select",{id:"stageTestStatus",name:"tests.stageTest.status",value:((ee=(Z=c.tests)==null?void 0:Z.stageTest)==null?void 0:ee.status)||"לא נבחן",onChange:A,children:T.map(O=>e.jsx("option",{value:O,children:O},O))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"technicalTestStatus",children:"מבחן טכני"}),e.jsx("select",{id:"technicalTestStatus",name:"tests.technicalTest.status",value:((K=(W=c.tests)==null?void 0:W.technicalTest)==null?void 0:K.status)||"לא נבחן",onChange:A,children:T.map(O=>e.jsx("option",{value:O,children:O},O))})]})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stageTestNotes",children:"הערות מבחן שלב"}),e.jsx("input",{type:"text",id:"stageTestNotes",name:"tests.stageTest.notes",value:((ne=(Q=c.tests)==null?void 0:Q.stageTest)==null?void 0:ne.notes)||"",onChange:A,placeholder:"הערות אופציונליות למבחן שלב"})]})}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"technicalTestNotes",children:"הערות מבחן טכני"}),e.jsx("input",{type:"text",id:"technicalTestNotes",name:"tests.technicalTest.notes",value:((se=(X=c.tests)==null?void 0:X.technicalTest)==null?void 0:se.notes)||"",onChange:A,placeholder:"הערות אופציונליות למבחן טכני"})]})})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"primary-checkbox",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",name:"isPrimary",checked:c.isPrimary,onChange:A}),e.jsx("label",{htmlFor:"isPrimary",children:"כלי נגינה ראשי"})]})}),e.jsxs("div",{className:"form-actions-row",children:[e.jsxs("button",{type:"button",className:"add-instrument-btn",onClick:i!==null?R:D,children:[e.jsx(Bo,{size:16}),i!==null?"עדכן":"הוסף"]}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:k,children:"ביטול"})]})]}):e.jsx("div",{className:"add-more-instruments",children:e.jsxs("button",{type:"button",className:"add-more-btn",onClick:()=>n(!0),children:[e.jsx(ls,{size:16}),"הוסף כלי נגינה"]})})]})}function gI({teachers:t,selectedTeacherId:s,onSelect:n,newTeacherInfo:i,isLoading:l=!1,disabled:c=!1,placeholder:u="בחר מורה",className:f=""}){const[p,m]=x.useState(!1),[g,v]=x.useState(""),[j,N]=x.useState(-1),b=x.useRef(null),w=x.useRef(null),C=x.useRef(null),T=oi.useMemo(()=>{const I=t.filter(M=>M.isActive).map(M=>{var z;return{id:M._id,name:M.personalInfo.fullName,instrument:(z=M.professionalInfo)==null?void 0:z.instrument,isNew:!1}});return i&&I.unshift({id:"new-teacher",name:i.fullName,instrument:i.instrument,isNew:!0}),I},[t,i]),A=oi.useMemo(()=>{if(!g.trim())return T;const I=g.toLowerCase();return T.filter(M=>M.name.toLowerCase().includes(I)||M.instrument&&M.instrument.toLowerCase().includes(I))},[T,g]),_=T.find(I=>I.id===s),D=_?_.name:"";x.useEffect(()=>{const I=M=>{b.current&&!b.current.contains(M.target)&&(m(!1),v(""),N(-1))};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const S=I=>{if(!c)switch(I.key){case"ArrowDown":I.preventDefault(),p?N(M=>M<A.length-1?M+1:0):m(!0);break;case"ArrowUp":I.preventDefault(),p&&N(M=>M>0?M-1:A.length-1);break;case"Enter":I.preventDefault(),p&&j>=0&&A[j]?R(A[j].id):p||m(!0);break;case"Escape":I.preventDefault(),m(!1),v(""),N(-1);break}},R=I=>{n(I),m(!1),v(""),N(-1)},E=()=>{c||m(!0)},k=I=>{const M=I.target.value;v(M),N(-1),p||m(!0)};return x.useEffect(()=>{if(j>=0&&C.current){const I=C.current.children[j];I&&I.scrollIntoView({block:"nearest",behavior:"smooth"})}},[j]),e.jsxs("div",{className:`searchable-teacher-select ${f} ${p?"open":""} ${c?"disabled":""}`,ref:b,children:[e.jsxs("div",{className:"select-input-container",children:[e.jsxs("div",{className:"select-input-wrapper",children:[e.jsx(We,{size:16,className:"input-icon"}),e.jsx("input",{ref:w,type:"text",className:"select-input",value:p?g:D,onChange:k,onFocus:E,onKeyDown:S,placeholder:s?D:u,disabled:c||l,autoComplete:"off"}),e.jsx("button",{type:"button",className:"dropdown-toggle",onClick:()=>!c&&m(!p),disabled:c||l,"aria-label":"פתח רשימת מורים",children:l?e.jsx("div",{className:"spinner"}):e.jsx(gt,{size:16,className:`chevron ${p?"rotated":""}`})})]}),p&&e.jsx("div",{className:"dropdown-menu",ref:C,children:A.length===0?e.jsx("div",{className:"no-results",children:g?"לא נמצאו מורים התואמים לחיפוש":"אין מורים זמינים"}):e.jsxs(e.Fragment,{children:[!s&&e.jsx("div",{className:"dropdown-item placeholder-item",onClick:()=>R(""),children:u}),A.map((I,M)=>e.jsxs("div",{className:`dropdown-item ${I.id===s?"selected":""} ${M===j?"highlighted":""} ${I.isNew?"new-teacher":""}`,onClick:()=>R(I.id),onMouseEnter:()=>N(M),children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("span",{className:"teacher-name",children:I.name}),I.instrument&&e.jsxs("span",{className:"teacher-instrument",children:["(",I.instrument,")"]}),I.isNew&&e.jsx("span",{className:"new-badge",children:"מורה חדש"})]}),I.id===s&&e.jsx(Bo,{size:16,className:"check-icon"})]},I.id))]})})]}),g&&p&&e.jsxs("div",{className:"search-info",children:[e.jsx(gr,{size:12}),e.jsxs("span",{children:['מחפש: "',g,'" (',A.length," תוצאות)"]})]})]})}const yI="modulepreload",vI=function(t){return"/"+t},yj={},rl=function(s,n,i){let l=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));l=Promise.allSettled(n.map(p=>{if(p=vI(p),p in yj)return;yj[p]=!0;const m=p.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${g}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":yI,m||(v.as="script"),v.crossOrigin="",v.href=p,f&&v.setAttribute("nonce",f),document.head.appendChild(v),m)return new Promise((j,N)=>{v.addEventListener("load",j),v.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return l.then(u=>{for(const f of u||[])f.status==="rejected"&&c(f.reason);return s().catch(c)})},Cn=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],zb=[30,45,60],$s={async createTimeBlock(t,s){try{return await ge.post(`schedule/time-blocks/teacher/${t}/time-block`,s)}catch(n){throw console.error("Failed to create time block:",n),n instanceof Error?n.message.includes("conflict")||n.message.includes("409")?new Error(`יום הלימוד מתנגש עם לוח זמנים קיים ביום ${s.day} בזמן ${s.startTime}-${s.endTime}. אנא בדוק את הלוח הקיים ובחר זמן אחר.`):n:new Error("שגיאה ביצירת יום לימוד חדש")}},async getAvailableSlots(t,s){var n,i,l,c,u,f,p;try{const m=(await rl(async()=>{const{default:C}=await Promise.resolve().then(()=>KC);return{default:C}},[])).default,g=new URLSearchParams;g.append("duration",s.duration.toString()),(n=s.preferredDays)!=null&&n.length&&g.append("preferredDays",s.preferredDays.join(",")),(i=s.preferredTimeRange)!=null&&i.startTime&&g.append("preferredStartTime",s.preferredTimeRange.startTime),(l=s.preferredTimeRange)!=null&&l.endTime&&g.append("preferredEndTime",s.preferredTimeRange.endTime),s.studentPreferences&&(s.studentPreferences.morningPreference!==void 0&&g.append("morningPreference",s.studentPreferences.morningPreference.toString()),s.studentPreferences.afternoonPreference!==void 0&&g.append("afternoonPreference",s.studentPreferences.afternoonPreference.toString()),s.studentPreferences.avoidBackToBack!==void 0&&g.append("avoidBackToBack",s.studentPreferences.avoidBackToBack.toString()));const v=g.toString(),N=`/api/schedule/time-blocks/teacher/${t}/available-slots${v?`?${v}`:""}`,b=localStorage.getItem("accessToken");return console.log("Original criteria:",s),console.log("Built full URL:",N),console.log("Query params:",v),(await m.get(N,{headers:{Authorization:b?`Bearer ${b}`:"","Content-Type":"application/json"},timeout:15e3,withCredentials:!0})).data}catch(m){throw console.error("Failed to get available slots:",m),((c=m.response)==null?void 0:c.status)===400&&((p=(f=(u=m.response)==null?void 0:u.data)==null?void 0:f.message)!=null&&p.includes("schoolYearId"))?new Error("שגיאת אימות פרמטרים - נסה שוב או פנה למנהל המערכת"):new Error("שגיאה בטעינת השעות הזמינות")}},async getTeacherTimeBlocks(t){try{return(await ge.get(`teacher/${t}/time-blocks`)).timeBlocks||[]}catch(s){return console.error("Failed to get teacher time blocks:",s),[]}},async assignLesson(t){try{return await ge.post("schedule/time-blocks/assign-lesson",t)}catch(s){throw console.error("Failed to assign lesson:",s),new Error("שגיאה בהקצאת השיעור")}},async getTeacherScheduleWithBlocks(t){var s,n;try{const{teacherService:i}=await rl(async()=>{const{teacherService:f}=await Promise.resolve().then(()=>Pd);return{teacherService:f}},void 0),l=await i.getTeacherById(t);if(!l)throw new Error("Teacher not found");const c=((s=l==null?void 0:l.teaching)==null?void 0:s.timeBlocks)||[],u={teacherId:t,teacherName:((n=l.personalInfo)==null?void 0:n.fullName)||"Unknown Teacher",timeBlocks:c.map(f=>({_id:f._id||f.id,teacherId:t,day:f.day,startTime:f.startTime,endTime:f.endTime,totalDuration:f.totalDuration||this.calculateTotalDuration(f.startTime,f.endTime),location:f.location||"",notes:f.notes||"",assignedLessons:f.assignedLessons||[],availableMinutes:f.availableMinutes||this.calculateTotalDuration(f.startTime,f.endTime),utilizationPercentage:f.utilizationPercentage||0,isActive:f.isActive!==!1,createdAt:f.createdAt||new Date().toISOString(),updatedAt:f.updatedAt||new Date().toISOString()})),weeklyStats:{totalTimeBlocks:c.length,totalAvailableMinutes:c.reduce((f,p)=>f+(p.availableMinutes||this.calculateTotalDuration(p.startTime,p.endTime)),0),totalAssignedMinutes:c.reduce((f,p)=>{var m;return f+(((m=p.assignedLessons)==null?void 0:m.reduce((g,v)=>g+v.duration,0))||0)},0),utilizationPercentage:0,averageBlockSize:0}};return u.weeklyStats.totalAvailableMinutes>0&&(u.weeklyStats.utilizationPercentage=Math.round(u.weeklyStats.totalAssignedMinutes/u.weeklyStats.totalAvailableMinutes*100)),u.timeBlocks.length>0&&(u.weeklyStats.averageBlockSize=Math.round(u.weeklyStats.totalAvailableMinutes/u.timeBlocks.length)),u}catch(i){throw console.error("Failed to get teacher schedule with blocks:",i),new Error("שגיאה בטעינת מערכת השעות עם ימי לימוד")}},calculateTotalDuration(t,s){const n=this.timeToMinutes(t);return this.timeToMinutes(s)-n},async updateTimeBlock(t,s){var n,i,l;try{console.log("Updating time block:",t,"with data:",s);try{return await ge.put(`schedule/time-blocks/${t}`,s)}catch(c){throw((n=c==null?void 0:c.response)==null?void 0:n.status)===404||(c==null?void 0:c.status)===404||((i=c==null?void 0:c.message)==null?void 0:i.includes("404"))||((l=c==null?void 0:c.message)==null?void 0:l.includes("Not Found"))||(c==null?void 0:c.message)==="Not Found"&&(c==null?void 0:c.name)!=="ValidationError"?(console.debug("Time block API endpoint not available, using teacher-based update fallback"),new Error("updateTimeBlockViaTeacher")):(console.error("Unexpected error in time block update:",c),c)}}catch(c){throw c instanceof Error&&c.message==="updateTimeBlockViaTeacher"||console.error("Failed to update time block:",c),c}},async updateTimeBlockViaTeacher(t,s,n){var i;try{const{teacherService:l}=await rl(async()=>{const{teacherService:j}=await Promise.resolve().then(()=>Pd);return{teacherService:j}},void 0),c=await l.getTeacherById(t);if(!c)throw new Error("Teacher not found");const u=((i=c==null?void 0:c.teaching)==null?void 0:i.timeBlocks)||[],f=u.findIndex(j=>j._id===s);if(f===-1)throw new Error("Time block not found in teacher data");const p={...u[f],...n,updatedAt:new Date().toISOString()},m=[...u];m[f]=p;const g={...c,teaching:{...c.teaching,timeBlocks:m}};return await l.updateTeacher(t,g),{success:!0,updatedTimeBlock:{_id:s,teacherId:t,day:p.day,startTime:p.startTime,endTime:p.endTime,totalDuration:p.totalDuration||this.calculateTotalDuration(p.startTime,p.endTime),location:p.location||"",notes:p.notes||"",assignedLessons:p.assignedLessons||[],availableMinutes:p.availableMinutes||this.calculateTotalDuration(p.startTime,p.endTime),utilizationPercentage:p.utilizationPercentage||0,isActive:p.isActive!==!1,createdAt:p.createdAt||new Date().toISOString(),updatedAt:p.updatedAt||new Date().toISOString()},affectedAssignments:[],message:"יום הלימוד עודכן בהצלחה"}}catch(l){throw console.error("Failed to update time block via teacher service:",l),new Error("שגיאה בעדכון יום הלימוד")}},async deleteTimeBlock(t){var s,n,i;try{console.log("TimeBlockService: Deleting time block:",t);const l=`schedule/time-blocks/${t}`;console.log("Delete endpoint:",l);try{const c=await ge.delete(l);return console.log("Delete response:",c),c}catch(c){throw((s=c==null?void 0:c.response)==null?void 0:s.status)===404||(c==null?void 0:c.status)===404||((n=c==null?void 0:c.message)==null?void 0:n.includes("404"))||((i=c==null?void 0:c.message)==null?void 0:i.includes("Not Found"))||(c==null?void 0:c.message)==="Not Found"&&(c==null?void 0:c.name)!=="ValidationError"?(console.debug("Time block delete API endpoint not available, using teacher-based delete fallback"),new Error("deleteTimeBlockViaTeacher")):(console.error("Unexpected error in time block delete:",c),c)}}catch(l){throw l instanceof Error&&l.message==="deleteTimeBlockViaTeacher"||console.error("TimeBlockService delete error:",l),l}},async deleteTimeBlockViaTeacher(t,s){var n;try{const{teacherService:i}=await rl(async()=>{const{teacherService:v}=await Promise.resolve().then(()=>Pd);return{teacherService:v}},void 0),l=await i.getTeacherById(t);if(!l)throw new Error("Teacher not found");const c=((n=l==null?void 0:l.teaching)==null?void 0:n.timeBlocks)||[],u=c.findIndex(v=>v._id===s);if(u===-1)throw new Error("Time block not found in teacher data");const p=c[u].assignedLessons||[],m=c.filter(v=>v._id!==s),g={...l,teaching:{...l.teaching,timeBlocks:m}};return await i.updateTeacher(t,g),{success:!0,affectedAssignments:p,message:"יום הלימוד נמחק בהצלחה"}}catch(i){throw console.error("Failed to delete time block via teacher service:",i),new Error("שגיאה במחיקת יום הלימוד")}},async cancelLessonAssignment(t){try{return await ge.delete(`schedule/time-blocks/lesson-assignment/${t}`)}catch(s){throw console.error("Failed to cancel lesson assignment:",s),new Error("שגיאה בביטול השיעור")}},calculateDynamicAvailability(t,s){const n=[];for(const i of t){if(!i.isActive||i.availableMinutes<s)continue;const l=this.timeToMinutes(i.startTime),c=this.timeToMinutes(i.endTime),u=[...i.assignedLessons].sort((m,g)=>this.timeToMinutes(m.lessonStartTime)-this.timeToMinutes(g.lessonStartTime));let f=l;for(const m of u){const g=this.timeToMinutes(m.lessonStartTime),v=this.timeToMinutes(m.lessonEndTime);if(g-f>=s){const N=this.generateSlotsInRange(f,g,s,i);n.push(...N)}f=v}if(c-f>=s){const m=this.generateSlotsInRange(f,c,s,i);n.push(...m)}}return n.sort((i,l)=>l.optimalScore-i.optimalScore)},generateSlotsInRange(t,s,n,i){const l=[];for(let u=t;u+n<=s;u+=15){const f=this.minutesToTime(u),p=this.minutesToTime(u+n),m=u-t,g=s-(u+n);let v=50;m>=15&&m<=30&&(v+=15),g>=15&&g<=30&&(v+=15),m>0&&g>0&&(v+=10),n>=60&&(v+=5),Math.floor(u/60)<14&&(v+=5);const N={timeBlockId:i._id,teacherId:i.teacherId,possibleStartTime:f,possibleEndTime:p,duration:n,day:i.day,location:i.location,optimalScore:Math.min(100,Math.round(v)),gapMinutesBefore:m,gapMinutesAfter:g};l.push(N)}return l},timeToMinutes(t){const[s,n]=t.split(":").map(Number);return s*60+n},minutesToTime(t){const s=Math.floor(t/60),n=t%60;return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},isValidDuration(t){return zb.includes(t)},isValidDay(t){return Cn.includes(t)},numericToHebrewDay(t){return t>=0&&t<Cn.length?Cn[t]:null},hebrewToNumericDay(t){return Cn.indexOf(t)},validateTimeBlockConflicts(t,s){const n=[];let i="";const l=this.timeToMinutes(t.startTime),c=this.timeToMinutes(t.endTime),u=s.filter(f=>f.day===t.day&&f.isActive);for(const f of u){const p=this.timeToMinutes(f.startTime),m=this.timeToMinutes(f.endTime);l<m&&c>p&&(n.push(f),l===p&&c===m?i="exact_duplicate":l>=p&&c<=m?i="contained_within":l<=p&&c>=m?i="contains_existing":i="partial_overlap")}return{hasConflict:n.length>0,conflictingBlocks:n,conflictType:i}},getConflictDescription(t,s,n){const i=s[0];switch(t){case"exact_duplicate":return`קיים כבר יום לימוד זהה ביום ${n.day} בשעות ${n.startTime}-${n.endTime}`;case"contained_within":return`הזמן המבוקש ${n.startTime}-${n.endTime} נמצא בתוך יום לימוד קיים: ${i.startTime}-${i.endTime}`;case"contains_existing":return`הזמן המבוקש ${n.startTime}-${n.endTime} מכיל יום לימוד קיים: ${i.startTime}-${i.endTime}`;case"partial_overlap":return`הזמן המבוקש ${n.startTime}-${n.endTime} חופף עם יום לימוד קיים: ${i.startTime}-${i.endTime}`;default:return`קיימת התנגשות עם יום לימוד קיים ביום ${n.day}`}}},kl=Fa((t,s)=>({currentTeacherSchedule:null,teacherTimeBlocks:{},availableSlots:[],recommendedSlots:[],selectedTimeBlock:null,isLoading:!1,isCalculatingSlots:!1,error:null,lastSearchResults:null,get totalAvailableSlots(){return s().availableSlots.length},get currentUtilization(){var i;const n=s().currentTeacherSchedule;return((i=n==null?void 0:n.weeklyStats)==null?void 0:i.utilizationPercentage)||0},createTimeBlock:async(n,i)=>{t({isLoading:!0,error:null});try{const l=await $s.createTimeBlock(n,i);return await s().loadTeacherSchedule(n),t({isLoading:!1}),l}catch(l){const c=l instanceof Error?l.message:"שגיאה ביצירת יום לימוד";return t({error:c,isLoading:!1}),null}},updateTimeBlock:async(n,i)=>{t({isLoading:!0,error:null});try{let l;try{l=await $s.updateTimeBlock(n,i)}catch(c){if((c==null?void 0:c.message)==="updateTimeBlockViaTeacher"){console.debug("Using teacher-based workaround for time block update");const u=s().currentTeacherSchedule;if(!u)throw new Error("Cannot update time block: teacher information not available");l=await $s.updateTimeBlockViaTeacher(u.teacherId,n,i)}else throw c}if(l.success){const c=s().currentTeacherSchedule;if(c){const u=c.timeBlocks.map(f=>f._id===n?l.updatedTimeBlock:f);t({currentTeacherSchedule:{...c,timeBlocks:u},isLoading:!1})}return l.updatedTimeBlock}else throw new Error(l.message||"שגיאה בעדכון יום הלימוד")}catch(l){const c=l instanceof Error?l.message:"שגיאה בעדכון יום לימוד";return t({error:c,isLoading:!1}),null}},deleteTimeBlock:async n=>{var i;t({isLoading:!0,error:null});try{let l;try{l=await $s.deleteTimeBlock(n)}catch(c){if((c==null?void 0:c.message)==="deleteTimeBlockViaTeacher"){console.debug("Using teacher-based workaround for time block delete");const u=s().currentTeacherSchedule;if(!u)throw new Error("Cannot delete time block: teacher information not available");l=await $s.deleteTimeBlockViaTeacher(u.teacherId,n)}else throw c}if(l.success){const c=s().currentTeacherSchedule;if(c){const u=c.timeBlocks.filter(f=>f._id!==n);t({currentTeacherSchedule:{...c,timeBlocks:u},selectedTimeBlock:((i=s().selectedTimeBlock)==null?void 0:i._id)===n?null:s().selectedTimeBlock,isLoading:!1})}return!0}else throw new Error(l.message||"שגיאה במחיקת יום הלימוד")}catch(l){console.error("TimeBlockStore delete error:",l);let c="שגיאה במחיקת יום לימוד";return l instanceof Error&&(l.message.includes("404")||l.message.includes("Not Found")?c="יום הלימוד לא נמצא במערכת. ייתכן שכבר נמחק.":c=l.message),t({error:c,isLoading:!1}),!1}},loadTeacherSchedule:async n=>{t({isLoading:!0,error:null});try{const i=await $s.getTeacherScheduleWithBlocks(n);t({currentTeacherSchedule:i,isLoading:!1})}catch(i){console.warn("Failed to load teacher schedule, continuing without conflict detection:",i),t({currentTeacherSchedule:null,isLoading:!1})}},loadTeacherTimeBlocks:async n=>{t({isLoading:!0,error:null});try{const i=await $s.getTeacherTimeBlocks(n);t(l=>({teacherTimeBlocks:{...l.teacherTimeBlocks,[n]:i},isLoading:!1}))}catch(i){const l=i instanceof Error?i.message:"שגיאה בטעינת ימי לימוד";t({error:l,isLoading:!1})}},findAvailableSlots:async(n,i)=>{t({isLoading:!0,error:null});try{console.log("timeBlockStore - findAvailableSlots called with criteria:",i),console.log("timeBlockStore - criteria keys:",Object.keys(i)),"schoolYearId"in i&&(console.error("CONTAMINATION DETECTED in timeBlockStore - criteria contains schoolYearId:",i),console.trace());const l=await $s.getAvailableSlots(n,i);t({availableSlots:l.availableSlots||[],recommendedSlots:l.recommendedSlots||[],isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"שגיאה בחיפוש שעות זמינות";t({error:c,isLoading:!1})}},refreshAvailableSlots:async(n,i)=>{const l={duration:i};await s().findAvailableSlots(n,l)},assignLesson:async n=>{t({isLoading:!0,error:null});try{const i=await $s.assignLesson(n);if(i.success){const l=s().currentTeacherSchedule;if(l){const c=l.timeBlocks.map(u=>u._id===i.updatedTimeBlock._id?i.updatedTimeBlock:u);t({currentTeacherSchedule:{...l,timeBlocks:c},availableSlots:i.newAvailableSlots,isLoading:!1})}return i.assignment}else throw new Error(i.message||"שגיאה בהקצאת השיעור")}catch(i){const l=i instanceof Error?i.message:"שגיאה בהקצאת השיעור";return t({error:l,isLoading:!1}),null}},cancelLessonAssignment:async n=>{t({isLoading:!0,error:null});try{const i=await $s.cancelLessonAssignment(n);if(i.success){const l=s().currentTeacherSchedule;if(l){const c=l.timeBlocks.map(u=>u._id===i.updatedTimeBlock._id?i.updatedTimeBlock:u);t({currentTeacherSchedule:{...l,timeBlocks:c},availableSlots:i.newAvailableSlots,isLoading:!1})}return!0}else throw new Error(i.message||"שגיאה בביטול השיעור")}catch(i){const l=i instanceof Error?i.message:"שגיאה בביטול השיעור";return t({error:l,isLoading:!1}),!1}},clearError:()=>t({error:null}),setSelectedTimeBlock:n=>t({selectedTimeBlock:n}),assignRecurringLesson:async n=>{console.log("assignRecurringLesson called with:",n)},updateLessonAttendance:async(n,i)=>{console.log("updateLessonAttendance called with:",n,i)},calculateDynamicAvailability:n=>{const i=s().currentTeacherSchedule;return!i||!i.timeBlocks?[]:$s.calculateDynamicAvailability(i.timeBlocks,n)}}));function gs({isOpen:t,onClose:s,onConfirm:n,title:i,message:l,confirmText:c="אישור",cancelText:u="ביטול",type:f="danger"}){if(!t)return null;const p=()=>{n(),s()};return e.jsxs("div",{className:"confirm-dialog",children:[e.jsx("div",{className:"overlay",onClick:s}),e.jsxs("div",{className:"dialog-content",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(yt,{size:20})}),e.jsx("h3",{className:`dialog-title ${f}`,children:i}),e.jsx("div",{className:"dialog-message",children:l}),e.jsxs("div",{className:"dialog-actions",children:[e.jsx("button",{type:"button",className:`btn ${f}`,onClick:p,children:c}),e.jsx("button",{type:"button",className:"btn secondary",onClick:s,children:u})]})]})]})}const vj={duration:60},xI=({teacherId:t,studentId:s,onSlotSelect:n,onSlotsFound:i,initialDuration:l=60,showAdvancedFilters:c=!0,maxResults:u=20,compact:f=!1,selectedSlot:p=null,refreshTrigger:m=0,currentStudentAssignments:g=[],onSlotListCollapse:v})=>{const[j,N]=x.useState({...vj,duration:l}),[b,w]=x.useState(!1),[C,T]=x.useState(!1),[A,_]=x.useState([]),[D,S]=x.useState([]),[R,E]=x.useState(!1),{availableSlots:k,recommendedSlots:I,findAvailableSlots:M,isLoading:z,error:Z}=kl();x.useEffect(()=>{N(F=>({...F,duration:l}))},[l]);const ee=x.useCallback(async()=>{if(!(!t||!j.duration))try{w(!0),"schoolYearId"in j&&(console.error("CONTAMINATION DETECTED in AvailableSlotsFinder - criteria contains schoolYearId:",j),console.trace()),await M(t,j)}catch(F){console.error("❌ SEARCH FAILED:",F)}finally{w(!1)}},[t,j,M]);x.useEffect(()=>{if(j.duration&&t){const F=setTimeout(()=>{ee()},300);return()=>clearTimeout(F)}},[j.duration,j.preferredDays,j.preferredTimeRange,t,ee]),x.useEffect(()=>{k&&i&&i(k)},[k,i]),x.useEffect(()=>{_(I)},[I]),x.useEffect(()=>{if(t&&m>0){const F=setTimeout(()=>{W()},100);return()=>clearTimeout(F)}},[t,m]),x.useEffect(()=>{t&&W()},[t]);const W=async()=>{try{const F=await ot.getStudents({});if(F.length===0){console.warn("⚠️ No students returned from API - trying alternative approach");try{const{useStudentStore:ae}=await rl(async()=>{const{useStudentStore:ce}=await Promise.resolve().then(()=>XA);return{useStudentStore:ce}},void 0),oe=ae.getState();if(oe.students.length>0)return oe.students}catch(ae){console.error("❌ Student store fallback failed:",ae)}}const te=[];(F||[]).forEach(ae=>{ae.teacherAssignments&&Array.isArray(ae.teacherAssignments)&&ae.teacherAssignments.forEach(oe=>{var ce;oe.teacherId===t&&oe.isActive!==!1&&oe.day&&oe.time&&oe.duration&&te.push({day:oe.day,time:oe.time,duration:oe.duration,studentId:ae._id,studentName:((ce=ae.personalInfo)==null?void 0:ce.fullName)||"תלמיד לא ידוע"})})}),S(te)}catch(F){console.error("❌ ASSIGNMENT LOAD FAILED:",F),S([])}},K=F=>{const[te,ae]=F.split(":").map(Number);return te*60+ae},Q=(F,te)=>{if(F.day!==te.day)return!1;const ae=F.possibleStartTime||F.startTime||F.lessonStartTime||"";if(!ae)return!1;const oe=K(ae),ce=oe+F.duration,G=K(te.time),re=G+te.duration;return oe<re&&ce>G},ne=x.useCallback(F=>{"schoolYearId"in F&&(console.error("CONTAMINATION DETECTED: schoolYearId in updates",F),console.trace()),N(te=>({...te,...F}))},[]),X=()=>{N({...vj,duration:l}),_([])},se=F=>{F.possibleStartTime||F.startTime||F.lessonStartTime,n==null||n(F),E(!1),v==null||v()},O=x.useMemo(()=>{var ae;if(!k||!Array.isArray(k))return console.warn("Available slots is not an array:",typeof k),[];let F=[...k];const te=[...D.map(oe=>({...oe,source:"database"})),...g.filter(oe=>oe.teacherId===t).map(oe=>({day:oe.day,time:oe.time,duration:oe.duration,studentName:"Current Student",source:"current-form"}))];if(te.length>0&&(F=F.filter(oe=>(oe.possibleStartTime||oe.startTime||oe.lessonStartTime,!te.some(G=>Q(oe,G))))),(ae=j.preferredDays)!=null&&ae.length&&(F=F.filter(oe=>j.preferredDays.includes(oe.day))),j.preferredTimeRange){const{startTime:oe,endTime:ce}=j.preferredTimeRange;F=F.filter(G=>{const re=G.possibleStartTime||G.startTime||G.lessonStartTime||"",pe=G.possibleEndTime||G.endTime||G.lessonEndTime||"";return re>=oe&&pe<=ce})}return F.sort((oe,ce)=>ce.optimalScore-oe.optimalScore),F},[k,j,D,g,t]),B=x.useMemo(()=>{const F={};return O.forEach(te=>{F[te.day]||(F[te.day]=[]),F[te.day].push(te)}),F},[O]),L=()=>e.jsxs("div",{className:"search-controls",children:[!f&&e.jsx("div",{className:"control-group",children:e.jsxs("button",{type:"button",className:`filter-toggle ${C?"active":""}`,onClick:()=>T(!C),children:[e.jsx(hi,{size:14}),"מסננים מתקדמים"]})}),e.jsx("div",{className:"control-group",children:e.jsx("button",{type:"button",className:"reset-btn",onClick:X,title:"איפוס חיפוש",children:e.jsx(Uo,{size:14})})})]}),Y=()=>{var F,te;return e.jsxs("div",{className:"advanced-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{className:"filter-label",children:[e.jsx($e,{size:14}),"ימים מועדפים"]}),e.jsx("div",{className:"day-selector",children:Cn.map(ae=>{var oe;return e.jsx("button",{type:"button",className:`day-btn ${(oe=j.preferredDays)!=null&&oe.includes(ae)?"selected":""}`,onClick:()=>{const ce=j.preferredDays||[],G=ce.includes(ae)?ce.filter(re=>re!==ae):[...ce,ae];ne({preferredDays:G.length>0?G:void 0})},children:ae},ae)})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{className:"filter-label",children:[e.jsx(Ve,{size:14}),"טווח שעות מועדף"]}),e.jsxs("div",{className:"time-range",children:[e.jsx("input",{type:"time",className:"time-input",value:((F=j.preferredTimeRange)==null?void 0:F.startTime)||"09:00",onChange:ae=>{const oe=j.preferredTimeRange||{startTime:"09:00",endTime:"17:00"};ne({preferredTimeRange:{...oe,startTime:ae.target.value}})}}),e.jsx("span",{className:"time-separator",children:"—"}),e.jsx("input",{type:"time",className:"time-input",value:((te=j.preferredTimeRange)==null?void 0:te.endTime)||"17:00",onChange:ae=>{const oe=j.preferredTimeRange||{startTime:"09:00",endTime:"17:00"};ne({preferredTimeRange:{...oe,endTime:ae.target.value}})}})]})]})]})},H=()=>!A||!Array.isArray(A)||A.length===0?null:e.jsx("div",{className:"optimal-suggestions",children:e.jsxs("div",{className:"suggestion-section",children:[e.jsxs("h4",{className:"suggestion-title",children:[e.jsx(In,{size:16}),"המלצות מתקדמות"]}),e.jsx("div",{className:"suggestion-slots",children:A.slice(0,3).map((F,te)=>{const ae=F.possibleStartTime||F.startTime||F.lessonStartTime||"unknown",oe=`recommended-${F.timeBlockId||"noId"}-${F.day}-${ae}-${F.duration}-${te}`;return e.jsxs("div",{className:`suggestion-slot optimal ${(p==null?void 0:p.timeBlockId)===F.timeBlockId&&((p==null?void 0:p.possibleStartTime)||(p==null?void 0:p.startTime))===ae?"selected":""}`,onClick:ce=>{ce.preventDefault(),ce.stopPropagation(),se(F)},children:[e.jsxs("div",{className:"slot-rank",children:["#",te+1]}),e.jsxs("div",{className:"slot-info",children:[e.jsxs("div",{className:"slot-day-time",children:[F.day," • ",F.possibleStartTime||F.startTime||F.lessonStartTime||"N/A"]}),e.jsxs("div",{className:"slot-score",children:["ציון: ",F.optimalScore,"/100"]})]}),e.jsx("div",{className:"slot-action",children:e.jsx(dx,{size:14})})]},oe)})})]})}),P=F=>{const te=F.possibleStartTime||F.startTime||F.lessonStartTime;let ae=F.possibleEndTime||F.endTime||F.lessonEndTime;if(!ae&&te&&F.duration){const G=te.split(":"),pe=parseInt(G[0])*60+parseInt(G[1])+F.duration,me=Math.floor(pe/60),je=pe%60;ae=`${me.toString().padStart(2,"0")}:${je.toString().padStart(2,"0")}`}const oe=(p==null?void 0:p.possibleStartTime)||(p==null?void 0:p.startTime),ce=(p==null?void 0:p.timeBlockId)===F.timeBlockId&&oe===te;return e.jsxs("div",{className:`slot-card ${ce?"selected":""} ${F.optimalScore>=80?"high-score":F.optimalScore>=60?"medium-score":"low-score"}`,children:[e.jsxs("div",{className:"slot-main-info",children:[e.jsxs("div",{className:"slot-day-time",children:[e.jsx("div",{className:"day-name",children:F.day}),e.jsxs("div",{className:"time-range",children:[te||"N/A"," - ",ae||"N/A"]})]}),e.jsxs("div",{className:"slot-duration-badge",children:[F.duration," דקות"]})]}),F.location&&e.jsxs("div",{className:"slot-location-info",children:[e.jsx(vt,{size:14}),e.jsx("span",{children:F.location})]}),e.jsx("div",{className:"slot-actions",children:e.jsx("button",{type:"button",className:"select-btn",onClick:G=>{G.preventDefault(),G.stopPropagation(),se(F)},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(Et,{size:14}),"נבחר"]}):e.jsxs(e.Fragment,{children:["בחר",e.jsx(dx,{size:14})]})})})]})},q=()=>b||z?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"מחפש שעות זמינות..."})]}):O.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Us,{size:48,color:"#f59e0b"}),e.jsx("h3",{children:"לא נמצאו שעות זמינות"}),e.jsx("p",{children:"נסה לשנות את קריטריוני החיפוש או בחר משכי שיעור שונים"}),e.jsxs("button",{type:"button",className:"retry-btn",onClick:X,children:[e.jsx(Uo,{size:16}),"איפוס חיפוש"]})]}):f?e.jsx("div",{className:"slots-list compact",children:O.map((F,te)=>{const ae=F.possibleStartTime||F.startTime||F.lessonStartTime||"unknown",oe=`compact-slot-${F.timeBlockId||"noId"}-${F.day}-${ae}-${F.duration}-${te}`;return e.jsx("div",{children:P(F)},oe)})}):e.jsx("div",{className:"slots-grouped",children:Object.entries(B).map(([F,te])=>e.jsxs("div",{className:"day-group",children:[e.jsxs("h4",{className:"day-header",children:[e.jsx($e,{size:16}),F,e.jsxs("span",{className:"day-count",children:["(",te.length," זמינות)"]})]}),e.jsx("div",{className:"day-slots",children:te.map((ae,oe)=>{const ce=ae.possibleStartTime||ae.startTime||ae.lessonStartTime||"unknown",G=`grouped-slot-${ae.timeBlockId||"noId"}-${ae.day}-${ce}-${ae.duration}-${oe}`;return e.jsx("div",{children:P(ae)},G)})})]},F))});return e.jsxs("div",{className:`available-slots-finder ${f?"compact":""}`,children:[!f&&L(),c&&Y(),H(),e.jsxs("div",{className:"slots-container",children:[e.jsxs("div",{className:"slots-header collapsible-header",onClick:()=>E(!R),children:[e.jsx("div",{className:"header-content",children:e.jsx("p",{children:"לחץ על שעה כדי לבחור אותה"})}),e.jsx("button",{type:"button",className:"chevron-button","aria-label":R?"כווץ רשימה":"הרחב רשימה",children:R?e.jsx(Ft,{size:20}):e.jsx(gt,{size:20})})]}),R&&q()]})]})};function jI({newTeacherInfo:t}){const{values:s,setFieldValue:n,errors:i,touched:l,isSubmitting:c}=Tr(),{teachers:u,loadTeachers:f,isLoading:p}=Ds(),{findAvailableSlots:m,isLoading:g}=kl(),[v,j]=x.useState(!1),[N,b]=x.useState(""),[w,C]=x.useState(null),[T,A]=x.useState([]),[_,D]=x.useState(!1),[S,R]=x.useState(""),[E,k]=x.useState(!1),[I,M]=x.useState(60),[z,Z]=x.useState(0),[ee,W]=x.useState(!1);x.useEffect(()=>{u.length===0&&f()},[u.length,f]);const K=(P,q)=>{if(!P)return"";const[F,te]=P.split(":").map(Number),oe=F*60+te+q,ce=Math.floor(oe/60),G=oe%60;return`${String(ce).padStart(2,"0")}:${String(G).padStart(2,"0")}`};x.useEffect(()=>{if(s.teacherAssignments&&s.teacherAssignments.length>0){const P=s.teacherAssignments.map((q,F)=>{const te=q.time||"",ae=q.duration||60,oe=K(te,ae);return{id:`${q.teacherId}-${q.day}-${q.time}-${F}`,teacherId:q.teacherId,teacherName:Q(q.teacherId),instrument:ne(q.teacherId),day:q.day||"",startTime:te,endTime:oe,duration:ae,location:q.location,timeBlockId:q.scheduleSlotId||"",status:"confirmed",notes:q.notes}});JSON.stringify(P)!==JSON.stringify(T)&&A(P)}else T.length>0&&setTimeout(()=>{s.teacherAssignments.length===0&&A([])},50)},[s.teacherAssignments]),x.useEffect(()=>{var P,q;console.log("🔍 Form data synchronization check:"),console.log("📝 Form teacherAssignments:",((P=s.teacherAssignments)==null?void 0:P.length)||0),console.log("🎯 Local assignments:",T.length),console.log("👨‍🏫 Teacher IDs in form:",((q=s.teacherIds)==null?void 0:q.length)||0)},[s.teacherAssignments,T,s.teacherIds]);const Q=P=>{var F;if(P==="new-teacher"&&t)return t.fullName;const q=u.find(te=>te._id===P);return((F=q==null?void 0:q.personalInfo)==null?void 0:F.fullName)||"מורה לא ידוע"},ne=P=>{var F;if(P==="new-teacher"&&t)return t.instrument;const q=u.find(te=>te._id===P);return(F=q==null?void 0:q.professionalInfo)==null?void 0:F.instrument},X=P=>{b(P),C(null),k(P!==""&&P!=="new-teacher")},se=P=>{C(P),(!P.timeBlockId||!P.possibleStartTime)&&console.warn("⚠️ Selected slot is missing required properties:",{timeBlockId:P.timeBlockId,possibleStartTime:P.possibleStartTime})},O=()=>{if(!w||!N){console.log("❌ Missing selectedSlot or selectedTeacherId");return}const P=w.possibleStartTime||w.startTime||w.lessonStartTime,q=w.possibleEndTime||w.endTime||w.lessonEndTime;if(!P){console.error("❌ No start time available in slot:",w),alert("שגיאה: לא נמצאה שעת התחלה בזמן הנבחר");return}const F={id:`${N}-${w.day}-${P}-${Date.now()}`,teacherId:N,teacherName:Q(N),instrument:ne(N),day:w.day,startTime:P,endTime:q||K(P,w.duration),duration:w.duration,location:w.location,timeBlockId:w.timeBlockId,optimalScore:w.optimalScore,status:"pending",notes:""},te=[...T,F];A(te);const ae=te.filter(G=>G.startTime).map(G=>({teacherId:G.teacherId,scheduleSlotId:G.timeBlockId,day:G.day,time:G.startTime,duration:G.duration||60,notes:G.notes||""}));try{n("teacherAssignments",ae),console.log("✅ Added lesson assignment successfully")}catch(G){console.error("❌ setFieldValue(teacherAssignments) failed:",G)}const oe=[...new Set(te.map(G=>G.teacherId))];try{n("teacherIds",oe)}catch(G){console.error("❌ setFieldValue(teacherIds) failed:",G)}const ce=()=>{s.teacherAssignments.length===0&&ae.length>0&&(console.log("🚨 FORM DATA LOST! Restoring assignments immediately..."),n("teacherAssignments",ae),n("teacherIds",oe))};ce(),setTimeout(ce,50),C(null),b(""),k(!1),j(!1),setTimeout(()=>{Z(G=>G+1)},200)},B=P=>{R(P),D(!0)},L=()=>{try{console.log("🗑️ Starting lesson removal process for ID:",S),console.log("📋 Current assignments before removal:",T.map(ce=>({id:ce.id,teacher:ce.teacherName,time:ce.startTime})));const P=T.find(ce=>ce.id===S);if(!P){console.error("❌ Assignment to remove not found:",S),D(!1),R("");return}console.log("🎯 Found assignment to remove:",{id:P.id,teacher:P.teacherName,teacherId:P.teacherId,day:P.day,time:P.startTime,duration:P.duration});const q=T.filter(ce=>ce.id!==S);A(q);const F=s.teacherAssignments||[],te=F.filter(ce=>{const G=ce.teacherId===P.teacherId&&ce.day===P.day&&ce.time===P.startTime;return G&&console.log("🎯 Removing form assignment:",{teacher:ce.teacherId,day:ce.day,time:ce.time,duration:ce.duration}),!G});F.length===te.length&&(console.warn("⚠️ Warning: No matching form assignment found to remove"),console.log("Current form assignments:",F.map(ce=>({teacherId:ce.teacherId,day:ce.day,time:ce.time})))),console.log("📝 Updated form assignments:",te.length,"remaining (was",F.length,")");const ae=te.filter(ce=>{const G=ce.teacherId&&ce.day&&ce.time&&ce.duration&&typeof ce.duration=="number";return G||console.warn("⚠️ Filtering out invalid assignment:",ce),G});console.log("✅ Validated assignments:",ae.length,"valid assignments"),n("teacherAssignments",ae);const oe=[...new Set(ae.map(ce=>ce.teacherId).filter(Boolean))];console.log("👨‍🏫 Updated teacher IDs:",oe),n("teacherIds",oe),D(!1),R(""),console.log("✅ Lesson removal completed successfully"),console.log("📊 Final state - Assignments:",ae.length,"Teachers:",oe.length),setTimeout(()=>{Z(ce=>ce+1),console.log("🔄 Triggered delayed slot refresh after lesson removal")},500)}catch(P){console.error("💥 Error during lesson removal:",P),D(!1),R(""),alert("שגיאה בהסרת השיעור. אנא נסה שוב.")}},Y=T.reduce((P,q)=>(P[q.teacherId]||(P[q.teacherId]=[]),P[q.teacherId].push(q),P),{}),H=l.teacherAssignments&&i.teacherAssignments;return e.jsxs("div",{className:"student-lesson-scheduler",children:[e.jsxs("div",{className:"scheduler-header",children:[e.jsxs("h3",{children:[e.jsx($e,{size:20}),"מערכת שיעורים"]}),e.jsx("p",{className:"scheduler-description",children:"בחר מורים ושעות שיעור עבור התלמיד"})]}),H&&typeof i.teacherAssignments=="string"&&e.jsxs("div",{className:"error-banner",children:[e.jsx(Us,{size:16}),e.jsx("span",{children:i.teacherAssignments})]}),Object.keys(Y).length>0&&e.jsxs("div",{className:"current-lessons",children:[e.jsxs("h4",{children:["שיעורים מתוכננים (",T.length,")"]}),e.jsx("div",{className:"lessons-grid",children:Object.entries(Y).map(([P,q])=>e.jsxs("div",{className:"teacher-lessons-card",children:[e.jsxs("div",{className:"teacher-card-header",children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx(We,{size:16}),e.jsxs("div",{className:"teacher-details",children:[e.jsx("span",{className:"teacher-name",children:q[0].teacherName}),q[0].instrument&&e.jsx("span",{className:"teacher-instrument",children:q[0].instrument})]})]}),e.jsxs("div",{className:"lessons-count",children:[q.length," שיעורים"]})]}),e.jsx("div",{className:"lessons-list",children:q.map((F,te)=>e.jsxs("div",{className:`lesson-card ${F.status}`,children:[e.jsxs("div",{className:"lesson-main-info",children:[e.jsxs("div",{className:"lesson-time",children:[e.jsxs("span",{className:"lesson-day",children:[e.jsx(Ve,{size:14}),F.day]}),e.jsxs("span",{children:[F.startTime," - ",F.endTime]})]}),e.jsxs("div",{className:"lesson-duration",children:[F.duration," דקות"]})]}),F.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:F.location})]}),F.optimalScore&&e.jsxs("div",{className:"lesson-score",children:[e.jsx(In,{size:12}),e.jsxs("span",{children:["ציון: ",F.optimalScore,"/100"]})]}),e.jsxs("div",{className:"lesson-actions",children:[e.jsxs("div",{className:`lesson-status ${F.status}`,children:[F.status==="pending"&&"ממתין לאישור",F.status==="confirmed"&&"מאושר",F.status==="cancelled"&&"מבוטל"]}),e.jsx("button",{type:"button",className:"remove-lesson-btn",onClick:()=>B(F.id),disabled:c,"aria-label":"הסר שיעור",children:e.jsx(_t,{size:14})})]})]},F.id))})]},P))})]}),!v&&e.jsx("div",{className:"add-lesson-section",children:e.jsxs("button",{type:"button",className:"add-lesson-btn primary",onClick:()=>j(!0),disabled:c,children:[e.jsx(ls,{size:16}),T.length>0?"הוסף שיעור נוסף":"הוסף שיעור ראשון"]})}),v&&e.jsxs("div",{className:"teacher-selection-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h4",{children:"בחירת מורה"}),e.jsx("p",{children:"בחר מורה כדי לראות את השעות הזמינות שלו"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"teacherSelect",className:"form-label",children:[e.jsx(We,{size:16}),"מורה"]}),e.jsx(gI,{teachers:u,selectedTeacherId:N,onSelect:X,newTeacherInfo:t,isLoading:p,disabled:p||c,placeholder:"בחר מורה",className:"teacher-select-input"})]}),e.jsxs("div",{className:"duration-selection",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(Ve,{size:16}),"משך השיעור"]}),e.jsx("div",{className:"duration-buttons",children:zb.map(P=>e.jsxs("button",{type:"button",className:`duration-btn ${I===P?"active":""}`,onClick:()=>{M(P),Z(q=>q+1)},children:[P," דקות"]},P))}),e.jsxs("div",{className:"duration-controls",children:[e.jsxs("button",{type:"button",className:`filter-toggle ${ee?"active":""}`,onClick:()=>W(P=>!P),title:"מסננים מתקדמים",children:[e.jsx(hi,{size:14}),"מסננים מתקדמים"]}),e.jsx("button",{type:"button",className:"reset-btn",onClick:()=>{M(60),W(!1),Z(P=>P+1)},title:"איפוס חיפוש",children:e.jsx(Uo,{size:14})})]})]})]}),E&&N&&N!=="new-teacher"&&e.jsxs("div",{className:"slots-finder-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h4",{children:["שעות זמינות עבור ",Q(N)]}),e.jsxs("p",{children:["שיעורי ",I," דקות - בחר שעה מהרשימה למטה"]})]}),e.jsx(xI,{teacherId:N,onSlotSelect:se,initialDuration:I,compact:!0,maxResults:20,selectedSlot:w,refreshTrigger:z,showAdvancedFilters:ee,currentStudentAssignments:T.map(P=>({teacherId:P.teacherId,day:P.day,time:P.startTime,duration:P.duration})),onSlotListCollapse:()=>{}},`${N}-${I}-${z}`),w&&e.jsxs("div",{className:"selected-slot-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Et,{size:16,color:"#28a745"}),e.jsx("span",{children:"שיעור נבחר"})]}),e.jsxs("div",{className:"preview-details",children:[e.jsxs("div",{className:"preview-item",children:[e.jsx($e,{size:14}),e.jsx("span",{children:w.day})]}),e.jsxs("div",{className:"preview-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:(()=>{const P=w.possibleStartTime||w.startTime||w.lessonStartTime,q=w.possibleEndTime||w.endTime||w.lessonEndTime||(P?K(P,w.duration):"");return P&&q?`${P} - ${q}`:"זמן לא זמין"})()})]}),e.jsx("div",{className:"preview-item",children:e.jsxs("span",{children:[w.duration," דקות"]})}),w.location&&e.jsxs("div",{className:"preview-item",children:[e.jsx(vt,{size:14}),e.jsx("span",{children:w.location})]}),w.optimalScore&&e.jsxs("div",{className:"preview-item",children:[e.jsx(In,{size:14}),e.jsxs("span",{children:["ציון אופטימלי: ",w.optimalScore,"/100"]})]})]})]})]}),v&&e.jsxs("div",{className:"panel-actions",children:[w?e.jsxs("button",{type:"button",className:"confirm-lesson-btn",onClick:P=>{P.preventDefault(),P.stopPropagation(),console.log("🚨 BUTTON CLICKED! About to call handleAddLesson"),console.log("selectedSlot exists:",!!w),console.log("selectedTeacherId exists:",!!N),O()},disabled:c,children:[e.jsx(Et,{size:16}),"אשר שיעור"]}):N==="new-teacher"?e.jsxs("div",{className:"new-teacher-notice",children:[e.jsx(Us,{size:16,color:"#ffc107"}),e.jsx("span",{children:"עבור מורה חדש, יש לתאם שעות בנפרד"})]}):null,e.jsx("button",{type:"button",className:"cancel-selection-btn secondary",onClick:P=>{P.preventDefault(),P.stopPropagation(),j(!1),b(""),C(null),k(!1)},disabled:c,children:"ביטול"})]}),e.jsx(gs,{isOpen:_,onClose:()=>D(!1),onConfirm:L,title:"הסרת שיעור",message:"האם אתה בטוח שברצונך להסיר את השיעור הזה?",confirmText:"הסר",cancelText:"ביטול",type:"warning"})]})}const jr=Fa((t,s)=>({orchestras:[],selectedOrchestra:null,filterBy:{},isLoading:!1,error:null,loadOrchestras:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await Ra.getOrchestras(i);t({orchestras:l,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestras";t({error:l,isLoading:!1}),console.error("Error loading orchestras:",i)}},loadOrchestraById:async n=>{t({isLoading:!0,error:null});try{const i=await Ra.getOrchestraById(n);t({selectedOrchestra:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestra";t({error:l,isLoading:!1}),console.error("Error loading orchestra:",i)}},saveOrchestra:async n=>{t({isLoading:!0,error:null});try{let i;if(n._id){i=await Ra.updateOrchestra(n._id,n);const l=s().orchestras.map(c=>c._id===i._id?i:c);t({orchestras:l,selectedOrchestra:i,isLoading:!1})}else i=await Ra.addOrchestra(n),t({orchestras:[...s().orchestras,i],selectedOrchestra:i,isLoading:!1});return i}catch(i){const l=i instanceof Error?i.message:"Failed to save orchestra";throw t({error:l,isLoading:!1}),console.error("Error saving orchestra:",i),i}},removeOrchestra:async n=>{var i;t({isLoading:!0,error:null});try{await Ra.removeOrchestra(n),t({orchestras:s().orchestras.filter(l=>l._id!==n),selectedOrchestra:((i=s().selectedOrchestra)==null?void 0:i._id)===n?null:s().selectedOrchestra,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove orchestra";throw t({error:c,isLoading:!1}),console.error("Error removing orchestra:",l),l}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedOrchestra:()=>{t({selectedOrchestra:null})},clearError:()=>{t({error:null})}})),_l=Fa((t,s)=>({rehearsals:[],selectedRehearsal:null,filterBy:{},isLoading:!1,error:null,loadRehearsals:async(n={})=>{t({isLoading:!0,error:null});try{const i=await Ws.getRehearsals(n);t({rehearsals:i,filterBy:n,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load rehearsals";t({error:l,isLoading:!1}),console.error("Error loading rehearsals:",i)}},loadRehearsalById:async n=>{t({isLoading:!0,error:null});try{const i=await Ws.getRehearsalById(n);t({selectedRehearsal:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load rehearsal";t({error:l,isLoading:!1}),console.error("Error loading rehearsal:",i)}},loadRehearsalsByOrchestraId:async n=>{t({isLoading:!0,error:null});try{const i=await Ws.getRehearsalsByOrchestraId(n);t({rehearsals:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestra rehearsals";t({error:l,isLoading:!1}),console.error("Error loading orchestra rehearsals:",i)}},saveRehearsal:async n=>{var i;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const u=(i=na.getState().currentSchoolYear)==null?void 0:i._id;if(!u)throw new Error("School year ID is required but not available");n.schoolYearId=u}let l;if(n._id){l=await Ws.updateRehearsal(n._id,n);const c=s().rehearsals.map(u=>u._id===l._id?l:u);t({rehearsals:c,selectedRehearsal:l,isLoading:!1})}else console.log("Adding new rehearsal with data:",n),l=await Ws.addRehearsal(n),t({rehearsals:[...s().rehearsals,l],selectedRehearsal:l,isLoading:!1});return l}catch(l){const c=l instanceof Error?l.message:"Failed to save rehearsal";throw t({error:c,isLoading:!1}),console.error("Error saving rehearsal:",l),l}},removeRehearsal:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid rehearsal ID");await Ws.removeRehearsal(n),t({rehearsals:s().rehearsals.filter(l=>l._id!==n),selectedRehearsal:((i=s().selectedRehearsal)==null?void 0:i._id)===n?null:s().selectedRehearsal,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove rehearsal";throw t({error:c,isLoading:!1}),console.error("Error removing rehearsal:",l),l}},removeRehearsalsByOrchestra:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid orchestra ID");const l=await Ws.removeRehearsalsByOrchestra(n);return t({rehearsals:s().rehearsals.filter(c=>c.groupId!==n),selectedRehearsal:((i=s().selectedRehearsal)==null?void 0:i.groupId)===n?null:s().selectedRehearsal,isLoading:!1}),l}catch(l){const c=l instanceof Error?l.message:"Failed to remove orchestra rehearsals";throw t({error:c,isLoading:!1}),console.error("Error removing orchestra rehearsals:",l),l}},updateRehearsalsByOrchestra:async(n,i)=>{t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid orchestra ID");const{_id:l,createdAt:c,updatedAt:u,groupId:f,date:p,schoolYearId:m,...g}=i,v=await Ws.updateRehearsalsByOrchestra(n,g);return await s().loadRehearsals(s().filterBy),t({isLoading:!1}),v}catch(l){const c=l instanceof Error?l.message:"Failed to update orchestra rehearsals";throw t({error:c,isLoading:!1}),console.error("Error updating orchestra rehearsals:",l),l}},bulkCreateRehearsals:async n=>{var i,l;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const p=na.getState();let m=(i=p.currentSchoolYear)==null?void 0:i._id;if(!m){console.log("Current school year not found, attempting to load...");try{await p.loadCurrentSchoolYear(),m=(l=p.currentSchoolYear)==null?void 0:l._id}catch(g){console.error("Failed to load current school year:",g)}}if(!m)throw new Error("School year ID is required for bulk rehearsal creation but not available");n.schoolYearId=m}if(console.log("Using school year ID for bulk create:",n.schoolYearId),!n.orchestraId)throw new Error("Orchestra ID is required for bulk rehearsal creation");if(!n.startDate||!n.endDate)throw new Error("Start date and end date are required");if(n.dayOfWeek===void 0||n.dayOfWeek===null)throw new Error("Day of week is required");if(!n.startTime||!n.endTime)throw new Error("Start time and end time are required");if(!n.location)throw new Error("Location is required");const c=typeof n.dayOfWeek=="string"?parseInt(n.dayOfWeek,10):n.dayOfWeek;if(isNaN(c)||c<0||c>6)throw new Error("Day of week must be a number between 0 and 6");const u={orchestraId:n.orchestraId,startDate:n.startDate,endDate:n.endDate,dayOfWeek:c,startTime:n.startTime,endTime:n.endTime,location:n.location,notes:n.notes||"",excludeDates:n.excludeDates||[],schoolYearId:n.schoolYearId};console.log("Formatted data for bulk create:",u);const f=await Ws.bulkCreateRehearsals(u);return console.log("Bulk create result:",f),u.orchestraId?await s().loadRehearsalsByOrchestraId(u.orchestraId):await s().loadRehearsals(),t({isLoading:!1}),f}catch(c){const u=c instanceof Error?c.message:"Failed to create bulk rehearsals";throw t({error:u,isLoading:!1}),console.error("Error creating bulk rehearsals:",c),c}},updateAttendance:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Ws.updateAttendance(n,i),u=s().rehearsals.map(f=>f._id===n?c:f);t({rehearsals:u,selectedRehearsal:((l=s().selectedRehearsal)==null?void 0:l._id)===n?c:s().selectedRehearsal,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to update attendance";throw t({error:u,isLoading:!1}),console.error("Error updating attendance:",c),c}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedRehearsal:()=>{t({selectedRehearsal:null})},clearError:()=>{t({error:null})}}));function bI(){const{values:t,setFieldValue:s,isSubmitting:n}=Tr(),{orchestras:i,loadOrchestras:l,isLoading:c}=jr(),{teachers:u,loadTeachers:f}=Ds(),{rehearsals:p,loadRehearsals:m}=_l(),g=Ot(),[v,j]=x.useState("");x.useEffect(()=>{l(),f(),m()},[l,f,m]);const N=D=>{var R;const S=u.find(E=>E._id===D);return((R=S==null?void 0:S.personalInfo)==null?void 0:R.fullName)||"מנצח לא ידוע"},b=D=>{const S=p.filter(E=>E.groupId===D);if(S.length>0){const E=S[0],I=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][E.dayOfWeek]||"לא ידוע";return{dayOfWeek:E.dayOfWeek,dayName:`יום ${I}`,startTime:E.startTime,endTime:E.endTime,timeRange:`${E.startTime}-${E.endTime}`,fullSchedule:`יום ${I} ${E.startTime}-${E.endTime}`}}const R=i.find(E=>E._id===D);if(R){let E=null;return R.name.includes("מתחילים")?E={dayOfWeek:0,dayName:"יום ראשון",startTime:"14:00",endTime:"15:00",timeRange:"14:00-15:00",fullSchedule:"יום ראשון 14:00-15:00"}:R.name.includes("מתקדמים")?E={dayOfWeek:0,dayName:"יום ראשון",startTime:"16:00",endTime:"18:00",timeRange:"16:00-18:00",fullSchedule:"יום ראשון 16:00-18:00"}:R.type==="הרכב"?E={dayOfWeek:2,dayName:"יום שלישי",startTime:"17:00",endTime:"18:30",timeRange:"17:00-18:30",fullSchedule:"יום שלישי 17:00-18:30"}:E={dayOfWeek:0,dayName:"יום ראשון",startTime:"15:00",endTime:"17:00",timeRange:"15:00-17:00",fullSchedule:"יום ראשון 15:00-17:00"},E}return null},w=D=>{g(`/orchestras/${D}`)},C=i.reduce((D,S)=>{const R=S.type||"אחר";return D[R]||(D[R]=[]),D[R].push(S),D},{}),T=t.orchestraAssignments.map(D=>{var E;const S=i.find(k=>k._id===D.orchestraId),R=b(D.orchestraId);return{id:D.orchestraId,name:(S==null?void 0:S.name)||"תזמורת לא ידועה",type:(S==null?void 0:S.type)||"",conductorId:(S==null?void 0:S.conductorId)||"",conductorName:S!=null&&S.conductorId?N(S.conductorId):"",location:(S==null?void 0:S.location)||"",memberCount:((E=S==null?void 0:S.memberIds)==null?void 0:E.length)||0,isActive:(S==null?void 0:S.isActive)??!0,rehearsalTimes:R}}),A=D=>{const S=D.target.value;if(j(S),S&&!t.orchestraAssignments.some(E=>E.orchestraId===S)){const E=[...t.orchestraAssignments,{orchestraId:S}];s("orchestraAssignments",E),s("enrollments.orchestraIds",[...t.enrollments.orchestraIds,S]),j("")}},_=D=>{const S=t.orchestraAssignments.filter(E=>E.orchestraId!==D);s("orchestraAssignments",S);const R=t.enrollments.orchestraIds.filter(E=>E!==D);s("enrollments.orchestraIds",R)};return e.jsxs("div",{className:"form-section orchestra-assignment-section",children:[e.jsx("h3",{children:"שיוך לתזמורת"}),T.length>0&&e.jsxs("div",{className:"assigned-orchestras",children:[e.jsx("h4",{children:"תזמורות משוייכות"}),e.jsx("div",{className:"assignments-list",children:T.map(D=>e.jsxs("div",{className:"assignment-card clickable",onClick:()=>w(D.id),children:[e.jsxs("div",{className:"assignment-header",children:[e.jsxs("div",{className:"orchestra-name",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:D.name}),D.type&&e.jsxs("span",{className:"orchestra-type",children:["(",D.type,")"]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:S=>{S.stopPropagation(),_(D.id)},"aria-label":"הסר תזמורת",disabled:n,children:e.jsx(_t,{size:12})})]}),e.jsxs("div",{className:"assignment-details",children:[D.conductorName&&e.jsxs("div",{className:"conductor-name",children:[e.jsx(We,{size:12}),e.jsxs("span",{children:["מנצח: ",D.conductorName]})]}),D.rehearsalTimes&&e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:D.rehearsalTimes.fullSchedule})]}),D.location&&e.jsxs("div",{className:"location",children:[e.jsx(vt,{size:12}),e.jsxs("span",{children:["מיקום: ",D.location]})]}),D.memberCount>0&&e.jsxs("div",{className:"member-count",children:[e.jsx(ps,{size:12}),e.jsxs("span",{children:[D.memberCount," חברים"]})]}),!D.isActive&&e.jsx("div",{className:"status-inactive",children:"תזמורת לא פעילה"})]})]},D.id))})]}),e.jsxs("div",{className:"add-orchestra-section",children:[e.jsx("h4",{children:"הוספת תזמורת"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orchestra",children:"בחר תזמורת"}),e.jsxs("select",{id:"orchestra",name:"orchestra",value:v,onChange:A,disabled:c||n,children:[e.jsx("option",{value:"",children:"בחר תזמורת"}),Object.entries(C).map(([D,S])=>e.jsx("optgroup",{label:D,children:S.map(R=>{var I;const E=R.conductorId?N(R.conductorId):"",k=b(R._id);return e.jsxs("option",{value:R._id,children:[R.name," - ",R.location||"ללא מיקום",k&&` | ${k.fullSchedule}`,E&&` | מנצח: ${E}`,((I=R.memberIds)==null?void 0:I.length)>0&&` | ${R.memberIds.length} חברים`]},R._id)})},D))]}),c&&e.jsx("div",{className:"loading-indicator",children:"טוען תזמורות..."})]})})]})]})}const Xo=["תלמידים חדשים צעירים","תלמידים חדשים בוגרים (ה - ט)","מתחילים","מתחילים ב","תלמידים חדשים ב-ד","מתקדמים א","מתקדמים ב","מתקדמים ג","מתחילים ד","הכנה לרסיטל קלאסי יא","הכנה לרסיטל רוק\\פופ\\ג'אז יא","הכנה לרסיטל רוק\\פופ\\ג'אז יב","מגמה"],Zo=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר תאוריה א","חדר תאוריה ב","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26"],Ss={async getTheoryLessons(t={}){return await ge.get("theory",t)},async getTheoryLessonById(t){return ge.get(`theory/${t}`)},async getTheoryLessonsByCategory(t,s={}){return ge.get(`theory/category/${t}`,s)},async getTheoryLessonsByTeacher(t,s={}){return ge.get(`theory/teacher/${t}`,s)},async getTheoryLessonsByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getTheoryLessonById(l).catch(c=>(console.error(`Failed to fetch theory lesson ${l}:`,c),null)));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Error fetching theory lessons by IDs:",s),[]}},async addTheoryLesson(t){if(t.date&&!t.dayOfWeek){const n=new Date(t.date);t.dayOfWeek=n.getDay()}if(!t.schoolYearId)throw new Error("School year ID is required for theory lesson creation");console.log("Adding theory lesson with data:",t);const s=await ge.post("theory",t);return s&&typeof s=="object"&&"data"in s?(console.log("Backend returned wrapped response:",s),s.data):s},async updateTheoryLesson(t,s){const{_id:n,...i}=s;if(s.date&&!s.dayOfWeek){const c=new Date(s.date);i.dayOfWeek=c.getDay()}const l=await ge.put(`theory/${t}`,i);return l&&typeof l=="object"&&"data"in l?(console.log("Backend returned wrapped update response:",l),l.data):l},async removeTheoryLesson(t){if(!t)throw new Error("Invalid theory lesson ID");return ge.delete(`theory/${t}`)},async bulkDeleteTheoryLessonsByDate(t,s){try{if(!t||!s)throw new Error("Start date and end date are required for bulk deletion");return await ge.delete("theory/bulk-delete-by-date",{startDate:t,endDate:s})}catch(n){const i=Ms(n,"bulkDeleteTheoryLessonsByDate"),l=new Error(i.userMessage);throw l.errorId=i.errorId,l.developerMessage=i.developerMessage,l}},async bulkDeleteTheoryLessonsByCategory(t){try{if(!t)throw new Error("Category is required for bulk deletion");return await ge.delete(`theory/bulk-delete-by-category/${t}`)}catch(s){const n=Ms(s,"bulkDeleteTheoryLessonsByCategory"),i=new Error(n.userMessage);throw i.errorId=n.errorId,i.developerMessage=n.developerMessage,i}},async bulkDeleteTheoryLessonsByTeacher(t){try{if(!t)throw new Error("Teacher ID is required for bulk deletion");return await ge.delete(`theory/bulk-delete-by-teacher/${t}`)}catch(s){const n=Ms(s,"bulkDeleteTheoryLessonsByTeacher"),i=new Error(n.userMessage);throw i.errorId=n.errorId,i.developerMessage=n.developerMessage,i}},async bulkCreateTheoryLessons(t){try{if(!t.category)throw new Error("Category is required for bulk theory lesson creation");if(!t.teacherId)throw new Error("Teacher ID is required for bulk theory lesson creation");if(!t.schoolYearId)throw new Error("School year ID is required for bulk theory lesson creation");if(!t.startDate||!t.endDate)throw new Error("Start date and end date are required for bulk theory lesson creation");const s=Number(t.dayOfWeek);if(isNaN(s)||s<0||s>6)throw new Error("Day of week must be a number between 0 and 6");const n={category:t.category,teacherId:t.teacherId,startDate:t.startDate,endDate:t.endDate,dayOfWeek:s,startTime:t.startTime,endTime:t.endTime,location:t.location,studentIds:t.studentIds||[],notes:t.notes||"",syllabus:t.syllabus||"",excludeDates:t.excludeDates||[],schoolYearId:t.schoolYearId};console.log("Sending bulk create data:",n);const i=localStorage.getItem("accessToken");if(!i)throw new Error("Authentication required for bulk theory lesson creation");const l=await ge.post("theory/bulk-create",n,{headers:{Authorization:`Bearer ${i}`}});return l&&typeof l=="object"&&"data"in l?(console.log("Backend returned wrapped bulk response:",l),l.data):l}catch(s){const n=Ms(s,"bulkCreateTheoryLessons"),i=new Error(n.userMessage);throw i.errorId=n.errorId,i.developerMessage=n.developerMessage,i}},async updateAttendance(t,s){const n=await ge.put(`theory/${t}/attendance`,s);return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped attendance response:",n),n.data):n},async getAttendance(t){return ge.get(`theory/${t}/attendance`)},async addStudentToTheory(t,s){const n=await ge.post(`theory/${t}/student`,{studentId:s});return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped add student response:",n),n.data):n},async removeStudentFromTheory(t,s){const n=await ge.delete(`theory/${t}/student/${s}`);return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped remove student response:",n),n.data):n},async getStudentTheoryAttendanceStats(t,s){const n=s?{category:s}:{};return ge.get(`theory/student/${t}/stats`,n)},formatDate(t){return t.toISOString().split("T")[0]},formatTime(t){return t.toTimeString().slice(0,5)},formatDateForDisplay(t){return new Date(t).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"})},formatTimeForDisplay(t){return t},calculateDuration(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u},formatDuration(t){const s=Math.floor(t/60),n=t%60;return s===0?`${n} דקות`:s===1&&n===0?"שעה אחת":s===1?`שעה ו-${n} דקות`:n===0?`${s} שעות`:`${s} שעות ו-${n} דקות`}},kd=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},Lb=(t,s,n,i)=>{const l=kd(t),c=kd(s),u=kd(n),f=kd(i);return l<f&&c>u},NI=(t,s,n,i=[])=>{const l=[],c=new Date(t),u=new Date(s),f=new Date(c);for(;f.getDay()!==n&&f<=u;)f.setDate(f.getDate()+1);for(;f<=u;){const p=f.toISOString().split("T")[0];i.includes(p)||l.push(p),f.setDate(f.getDate()+7)}return l},SI=(t,s)=>{const n=[];return NI(s.startDate,s.endDate,s.dayOfWeek,s.excludeDates).forEach(l=>{t.forEach(c=>{c.date.split("T")[0]!==l||!Lb(s.startTime,s.endTime,c.startTime,c.endTime)||(c.location===s.location&&n.push({type:"room",existingLesson:c,newLesson:{date:l,startTime:s.startTime,endTime:s.endTime,location:s.location,teacherId:s.teacherId},conflictDate:l,description:`Room conflict: ${s.location} is already booked on ${l} from ${c.startTime}-${c.endTime} (existing lesson) vs ${s.startTime}-${s.endTime} (new lesson)`}),c.teacherId===s.teacherId&&c.location!==s.location&&n.push({type:"teacher",existingLesson:c,newLesson:{date:l,startTime:s.startTime,endTime:s.endTime,location:s.location,teacherId:s.teacherId},conflictDate:l,description:`Teacher conflict: Teacher is already scheduled on ${l} from ${c.startTime}-${c.endTime} in ${c.location} vs ${s.startTime}-${s.endTime} in ${s.location}`}))})}),n},wI=(t,s)=>{const n=[];if(!s.date||!s.startTime||!s.endTime||!s.location)return n;const i=s.date.split("T")[0];return t.forEach(l=>{l.date.split("T")[0]!==i||!Lb(s.startTime,s.endTime,l.startTime,l.endTime)||(l.location===s.location&&n.push({type:"room",existingLesson:l,newLesson:s,conflictDate:i,description:`Room conflict: ${s.location} is already booked on ${i} from ${l.startTime}-${l.endTime}`}),l.teacherId===s.teacherId&&l.location!==s.location&&n.push({type:"teacher",existingLesson:l,newLesson:s,conflictDate:i,description:`Teacher conflict: Teacher is already scheduled on ${i} from ${l.startTime}-${l.endTime} in ${l.location}`}))}),n},xj=t=>{if(t.length===0)return"";const s=t.filter(l=>l.type==="room"),n=t.filter(l=>l.type==="teacher");let i=`נמצאו התנגשויות בלוח הזמנים:

`;return s.length>0&&(i+=`התנגשויות חדרים (${s.length}):
`,s.forEach((l,c)=>{i+=`${c+1}. ${l.conflictDate} - ${l.existingLesson.location}
`}),i+=`
`),n.length>0&&(i+=`התנגשויות מורים (${n.length}):
`,n.forEach((l,c)=>{i+=`${c+1}. ${l.conflictDate}
`})),i+=`
האם ברצונך להמשיך למרות ההתנגשויות?`,i},mp=Fa((t,s)=>({theoryLessons:[],selectedTheoryLesson:null,filterBy:{},isLoading:!1,error:null,loadTheoryLessons:async(n={})=>{t({isLoading:!0,error:null});try{console.log("TheoryStore: Loading theory lessons with filter:",n);const i=await Ss.getTheoryLessons(n);console.log("TheoryStore: Loaded",i.length,"theory lessons"),console.log("TheoryStore: First few lessons:",i.slice(0,3)),t({theoryLessons:i,filterBy:n,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load theory lessons";t({error:l,isLoading:!1}),console.error("Error loading theory lessons:",i)}},loadTheoryLessonById:async n=>{t({isLoading:!0,error:null});try{const i=await Ss.getTheoryLessonById(n);t({selectedTheoryLesson:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load theory lesson";t({error:l,isLoading:!1}),console.error("Error loading theory lesson:",i)}},loadTheoryLessonsByCategory:async(n,i={})=>{t({isLoading:!0,error:null});try{const l=await Ss.getTheoryLessonsByCategory(n,i);t({theoryLessons:l,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to load category theory lessons";t({error:c,isLoading:!1}),console.error("Error loading category theory lessons:",l)}},loadTheoryLessonsByTeacher:async(n,i={})=>{t({isLoading:!0,error:null});try{const l=await Ss.getTheoryLessonsByTeacher(n,i);t({theoryLessons:l,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to load teacher theory lessons";t({error:c,isLoading:!1}),console.error("Error loading teacher theory lessons:",l)}},saveTheoryLesson:async n=>{var i;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const u=(i=na.getState().currentSchoolYear)==null?void 0:i._id;if(!u)throw new Error("School year ID is required but not available");n.schoolYearId=u}let l;if(n._id){l=await Ss.updateTheoryLesson(n._id,n);const c=s().theoryLessons.map(u=>u._id===l._id?l:u);t({theoryLessons:c,selectedTheoryLesson:l,isLoading:!1})}else{console.log("Adding new theory lesson with data:",n);const c=s().theoryLessons,u=wI(c,n);if(u.length>0){const f=xj(u);throw console.warn("Single theory lesson conflicts detected:",u),console.warn("Conflict message for user:",f),new Error(f)}if(l=await Ss.addTheoryLesson(n),console.log("Theory lesson saved, returned data:",l),!l||!l._id)throw console.error("Backend returned invalid theory lesson data:",l),new Error("שגיאה: השרת לא החזיר מזהה תקין לשיעור התאוריה החדש");t({theoryLessons:[...s().theoryLessons,l],selectedTheoryLesson:l,isLoading:!1})}return l}catch(l){const c=l instanceof Error?l.message:"Failed to save theory lesson";throw t({error:c,isLoading:!1}),console.error("Error saving theory lesson:",l),l}},removeTheoryLesson:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid theory lesson ID");await Ss.removeTheoryLesson(n),t({theoryLessons:s().theoryLessons.filter(l=>l._id!==n),selectedTheoryLesson:((i=s().selectedTheoryLesson)==null?void 0:i._id)===n?null:s().selectedTheoryLesson,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to permanently delete theory lesson";throw t({error:c,isLoading:!1}),console.error("Error deleting theory lesson:",l),l}},bulkCreateTheoryLessons:async n=>{var i,l;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const g=na.getState();let v=(i=g.currentSchoolYear)==null?void 0:i._id;if(!v){console.log("Current school year not found, attempting to load...");try{await g.loadCurrentSchoolYear(),v=(l=g.currentSchoolYear)==null?void 0:l._id}catch(j){console.error("Failed to load current school year:",j)}}if(!v)throw new Error("School year ID is required for bulk theory lesson creation but not available");n.schoolYearId=v}if(console.log("Using school year ID for bulk create:",n.schoolYearId),!n.category)throw new Error("Category is required for bulk theory lesson creation");if(!n.teacherId)throw new Error("Teacher ID is required for bulk theory lesson creation");if(!n.startDate||!n.endDate)throw new Error("Start date and end date are required");if(n.dayOfWeek===void 0||n.dayOfWeek===null)throw new Error("Day of week is required");if(!n.startTime||!n.endTime)throw new Error("Start time and end time are required");if(!n.location)throw new Error("Location is required");const c=typeof n.dayOfWeek=="string"?parseInt(n.dayOfWeek,10):n.dayOfWeek;if(isNaN(c)||c<0||c>6)throw new Error("Day of week must be a number between 0 and 6");const u={category:n.category,teacherId:n.teacherId,startDate:n.startDate,endDate:n.endDate,dayOfWeek:c,startTime:n.startTime,endTime:n.endTime,location:n.location,studentIds:n.studentIds||[],notes:n.notes||"",syllabus:n.syllabus||"",excludeDates:n.excludeDates||[],schoolYearId:n.schoolYearId};console.log("Formatted data for bulk create:",u);const f=s().theoryLessons,p=SI(f,u);if(p.length>0){const g=xj(p);throw console.warn("Theory lesson conflicts detected:",p),console.warn("Conflict message for user:",g),new Error(g)}const m=await Ss.bulkCreateTheoryLessons(u);if(console.log("Bulk create result:",m),!m||typeof m.insertedCount!="number"||!Array.isArray(m.theoryLessonIds))throw console.error("Backend returned invalid bulk creation result:",m),new Error("שגיאה: השרת לא החזיר תוצאה תקינה ליצירת שיעורי התאוריה");return t({isLoading:!1}),m}catch(c){const u=c instanceof Error?c.message:"Failed to create bulk theory lessons";throw t({error:u,isLoading:!1}),console.error("Error creating bulk theory lessons:",c),c}},bulkDeleteTheoryLessonsByDate:async(n,i)=>{t({isLoading:!0,error:null});try{const l=await Ss.bulkDeleteTheoryLessonsByDate(n,i);return await s().loadTheoryLessons(s().filterBy),t({isLoading:!1}),l}catch(l){const c=l instanceof Error?l.message:"Failed to bulk delete theory lessons by date";throw t({error:c,isLoading:!1}),console.error("Error bulk deleting theory lessons by date:",l),l}},bulkDeleteTheoryLessonsByCategory:async n=>{t({isLoading:!0,error:null});try{const i=await Ss.bulkDeleteTheoryLessonsByCategory(n);return await s().loadTheoryLessons(s().filterBy),t({isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to bulk delete theory lessons by category";throw t({error:l,isLoading:!1}),console.error("Error bulk deleting theory lessons by category:",i),i}},bulkDeleteTheoryLessonsByTeacher:async n=>{t({isLoading:!0,error:null});try{const i=await Ss.bulkDeleteTheoryLessonsByTeacher(n);return await s().loadTheoryLessons(s().filterBy),t({isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to bulk delete theory lessons by teacher";throw t({error:l,isLoading:!1}),console.error("Error bulk deleting theory lessons by teacher:",i),i}},updateAttendance:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Ss.updateAttendance(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to update attendance";throw t({error:u,isLoading:!1}),console.error("Error updating attendance:",c),c}},addStudentToTheory:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Ss.addStudentToTheory(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to add student to theory lesson";throw t({error:u,isLoading:!1}),console.error("Error adding student to theory lesson:",c),c}},removeStudentFromTheory:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Ss.removeStudentFromTheory(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to remove student from theory lesson";throw t({error:u,isLoading:!1}),console.error("Error removing student from theory lesson:",c),c}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedTheoryLesson:()=>{t({selectedTheoryLesson:null})},clearError:()=>{t({error:null})}}));function TI(){const{values:t,setFieldValue:s,isSubmitting:n}=Tr(),{theoryLessons:i,loadTheoryLessons:l,isLoading:c}=mp(),{teachers:u,loadTeachers:f}=Ds(),p=Ot(),[m,g]=x.useState("");x.useEffect(()=>{l(),f()},[l,f]);const v=D=>{var R;const S=u.find(E=>E._id===D);return((R=S==null?void 0:S.personalInfo)==null?void 0:R.fullName)||"מורה לא ידוע"},j=D=>{p(`/theory/${D}`)},N=i.reduce((D,S)=>{const R=`${S.category||"אחר"}-${S.dayOfWeek}-${S.startTime}-${S.endTime}-${S.location}`;return D[R]?D[R].allInstanceIds.push(S._id):D[R]={...S,allInstanceIds:[S._id],representativeId:S._id},D},{}),b=Object.values(N).reduce((D,S)=>{const R=S.category||"אחר";return D[R]||(D[R]=[]),D[R].push(S),D},{}),w=t.theoryLessonAssignments.reduce((D,S)=>{const R=i.find(E=>E._id===S.theoryLessonId);if(R){const E=Object.values(N).find(k=>k.allInstanceIds.includes(S.theoryLessonId));if(E){const k=E.representativeId;D[k]||(D[k]={representativeId:k,category:R.category||"שיעור העשרה לא ידוע",dayTime:T(R.dayOfWeek,R.startTime,R.endTime),location:R.location||"",teacherId:R.teacherId,teacherName:v(R.teacherId),assignedInstances:[],totalInstances:E.allInstanceIds.length}),D[k].assignedInstances.push(S.theoryLessonId)}}return D},{}),C=Object.values(w);function T(D,S,R){return D===void 0||!S||!R?"":`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][D]||"לא ידוע"} ${S}-${R}`}const A=D=>{const S=D.target.value;if(g(S),S){const R=Object.values(N).find(E=>E.representativeId===S);if(R){const E=R.allInstanceIds,k=t.theoryLessonAssignments.map(M=>M.theoryLessonId).filter(M=>E.includes(M)),I=E.filter(M=>!k.includes(M));if(I.length>0){const M=I.map(Z=>({theoryLessonId:Z})),z=[...t.theoryLessonAssignments,...M];s("theoryLessonAssignments",z),s("enrollments.theoryLessonIds",[...t.enrollments.theoryLessonIds,...I]),console.log(`📚 Added ${I.length} theory lesson instances for recurring pattern:`,{category:R.category,dayTime:T(R.dayOfWeek,R.startTime,R.endTime),location:R.location,totalInstances:E.length,newInstances:I.length,alreadyAssigned:k.length})}else console.log("⚠️ All instances of this theory lesson pattern are already assigned");g("")}}},_=D=>{const S=Object.values(N).find(R=>R.allInstanceIds.includes(D));if(S){const R=S.allInstanceIds,E=t.theoryLessonAssignments.filter(I=>!R.includes(I.theoryLessonId));s("theoryLessonAssignments",E);const k=t.enrollments.theoryLessonIds.filter(I=>!R.includes(I));s("enrollments.theoryLessonIds",k),console.log(`🗑️ Removed ${R.length} theory lesson instances for recurring pattern:`,{category:S.category,dayTime:T(S.dayOfWeek,S.startTime,S.endTime),location:S.location,removedInstances:R.length})}else{const R=t.theoryLessonAssignments.filter(k=>k.theoryLessonId!==D);s("theoryLessonAssignments",R);const E=t.enrollments.theoryLessonIds.filter(k=>k!==D);s("enrollments.theoryLessonIds",E),console.log("🗑️ Removed single theory lesson instance (fallback):",D)}};return e.jsxs("div",{className:"form-section theory-lessons-assignment-section",children:[e.jsx("h3",{children:"שיוך לשיעורי העשרה"}),C.length>0&&e.jsxs("div",{className:"assigned-theory-lessons",children:[e.jsx("h4",{children:"שיעורי העשרה משויכים"}),e.jsx("div",{className:"assignments-list",children:C.map(D=>e.jsxs("div",{className:"assignment-card clickable",onClick:()=>j(D.assignedInstances[0]),children:[e.jsxs("div",{className:"assignment-header",children:[e.jsxs("div",{className:"theory-lesson-name",children:[e.jsx(Vt,{size:12}),e.jsx("span",{children:D.category}),D.totalInstances>1&&e.jsxs("span",{className:"instance-count",children:["(",D.assignedInstances.length,"/",D.totalInstances," שיעורים)"]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:S=>{S.stopPropagation(),_(D.assignedInstances[0])},"aria-label":"הסר שיעור העשרה",disabled:n,children:e.jsx(_t,{size:12})})]}),e.jsxs("div",{className:"assignment-details",children:[D.teacherName&&e.jsxs("div",{className:"teacher-name",children:[e.jsx(We,{size:12}),e.jsxs("span",{children:["מורה: ",D.teacherName]})]}),D.dayTime&&e.jsx("div",{className:"day-time",children:D.dayTime}),D.location&&e.jsxs("div",{className:"location",children:["מיקום: ",D.location]}),D.totalInstances>1&&e.jsx("div",{className:"enrollment-info",children:"רישום לכל השיעורים השבועיים"})]})]},D.representativeId))})]}),e.jsxs("div",{className:"add-theory-lesson-section",children:[e.jsx("h4",{children:"הוספת שיעור העשרה"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"theoryLesson",children:"בחר שיעור העשרה"}),e.jsxs("select",{id:"theoryLesson",name:"theoryLesson",value:m,onChange:A,disabled:c||n,children:[e.jsx("option",{value:"",children:"בחר שיעור העשרה"}),Object.entries(b).map(([D,S])=>e.jsx("optgroup",{label:D,children:S.map(R=>e.jsxs("option",{value:R.representativeId,children:[R.category," - ",R.location," | ",T(R.dayOfWeek,R.startTime,R.endTime),v(R.teacherId)!=="מורה לא ידוע"&&` | מורה: ${v(R.teacherId)}`,R.allInstanceIds.length>1&&` | ${R.allInstanceIds.length} שיעורים`]},R.representativeId))},D))]}),c&&e.jsx("div",{className:"loading-indicator",children:"טוען שיעורי העשרה..."})]})})]})]})}var lm,jj;function EI(){if(jj)return lm;jj=1;function t(T){this._maxSize=T,this.clear()}t.prototype.clear=function(){this._size=0,this._values=Object.create(null)},t.prototype.get=function(T){return this._values[T]},t.prototype.set=function(T,A){return this._size>=this._maxSize&&this.clear(),T in this._values||this._size++,this._values[T]=A};var s=/[^.^\]^[]+|(?=\[\]|\.\.)/g,n=/^\d+$/,i=/^\d/,l=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,c=/^\s*(['"]?)(.*?)(\1)\s*$/,u=512,f=new t(u),p=new t(u),m=new t(u);lm={Cache:t,split:v,normalizePath:g,setter:function(T){var A=g(T);return p.get(T)||p.set(T,function(D,S){for(var R=0,E=A.length,k=D;R<E-1;){var I=A[R];if(I==="__proto__"||I==="constructor"||I==="prototype")return D;k=k[A[R++]]}k[A[R]]=S})},getter:function(T,A){var _=g(T);return m.get(T)||m.set(T,function(S){for(var R=0,E=_.length;R<E;)if(S!=null||!A)S=S[_[R++]];else return;return S})},join:function(T){return T.reduce(function(A,_){return A+(N(_)||n.test(_)?"["+_+"]":(A?".":"")+_)},"")},forEach:function(T,A,_){j(Array.isArray(T)?T:v(T),A,_)}};function g(T){return f.get(T)||f.set(T,v(T).map(function(A){return A.replace(c,"$2")}))}function v(T){return T.match(s)||[""]}function j(T,A,_){var D=T.length,S,R,E,k;for(R=0;R<D;R++)S=T[R],S&&(C(S)&&(S='"'+S+'"'),k=N(S),E=!k&&/^\d+$/.test(S),A.call(_,S,k,E,R,T))}function N(T){return typeof T=="string"&&T&&["'",'"'].indexOf(T.charAt(0))!==-1}function b(T){return T.match(i)&&!T.match(n)}function w(T){return l.test(T)}function C(T){return!N(T)&&(b(T)||w(T))}return lm}var li=EI(),om,bj;function CI(){if(bj)return om;bj=1;const t=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,s=g=>g.match(t)||[],n=g=>g[0].toUpperCase()+g.slice(1),i=(g,v)=>s(g).join(v).toLowerCase(),l=g=>s(g).reduce((v,j)=>`${v}${v?j[0].toUpperCase()+j.slice(1).toLowerCase():j.toLowerCase()}`,"");return om={words:s,upperFirst:n,camelCase:l,pascalCase:g=>n(l(g)),snakeCase:g=>i(g,"_"),kebabCase:g=>i(g,"-"),sentenceCase:g=>n(i(g," ")),titleCase:g=>s(g).map(n).join(" ")},om}var cm=CI(),_d={exports:{}},Nj;function AI(){if(Nj)return _d.exports;Nj=1,_d.exports=function(l){return t(s(l),l)},_d.exports.array=t;function t(l,c){var u=l.length,f=new Array(u),p={},m=u,g=n(c),v=i(l);for(c.forEach(function(N){if(!v.has(N[0])||!v.has(N[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});m--;)p[m]||j(l[m],m,new Set);return f;function j(N,b,w){if(w.has(N)){var C;try{C=", node was:"+JSON.stringify(N)}catch{C=""}throw new Error("Cyclic dependency"+C)}if(!v.has(N))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(N));if(!p[b]){p[b]=!0;var T=g.get(N)||new Set;if(T=Array.from(T),b=T.length){w.add(N);do{var A=T[--b];j(A,v.get(A),w)}while(b);w.delete(N)}f[--u]=N}}}function s(l){for(var c=new Set,u=0,f=l.length;u<f;u++){var p=l[u];c.add(p[0]),c.add(p[1])}return Array.from(c)}function n(l){for(var c=new Map,u=0,f=l.length;u<f;u++){var p=l[u];c.has(p[0])||c.set(p[0],new Set),c.has(p[1])||c.set(p[1],new Set),c.get(p[0]).add(p[1])}return c}function i(l){for(var c=new Map,u=0,f=l.length;u<f;u++)c.set(l[u],u);return c}return _d.exports}var DI=AI();const kI=en(DI),_I=Object.prototype.toString,OI=Error.prototype.toString,II=RegExp.prototype.toString,$I=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",RI=/^Symbol\((.*)\)(.*)$/;function MI(t){return t!=+t?"NaN":t===0&&1/t<0?"-0":""+t}function Sj(t,s=!1){if(t==null||t===!0||t===!1)return""+t;const n=typeof t;if(n==="number")return MI(t);if(n==="string")return s?`"${t}"`:t;if(n==="function")return"[Function "+(t.name||"anonymous")+"]";if(n==="symbol")return $I.call(t).replace(RI,"Symbol($1)");const i=_I.call(t).slice(8,-1);return i==="Date"?isNaN(t.getTime())?""+t:t.toISOString(t):i==="Error"||t instanceof Error?"["+OI.call(t)+"]":i==="RegExp"?II.call(t):null}function Dn(t,s){let n=Sj(t,s);return n!==null?n:JSON.stringify(t,function(i,l){let c=Sj(this[i],s);return c!==null?c:l},2)}function Bb(t){return t==null?[]:[].concat(t)}let Fb,Ub,Pb,zI=/\$\{\s*(\w+)\s*\}/g;Fb=Symbol.toStringTag;class wj{constructor(s,n,i,l){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[Fb]="Error",this.name="ValidationError",this.value=n,this.path=i,this.type=l,this.errors=[],this.inner=[],Bb(s).forEach(c=>{if(zs.isError(c)){this.errors.push(...c.errors);const u=c.inner.length?c.inner:[c];this.inner.push(...u)}else this.errors.push(c)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}Ub=Symbol.hasInstance;Pb=Symbol.toStringTag;class zs extends Error{static formatError(s,n){const i=n.label||n.path||"this";return n=Object.assign({},n,{path:i,originalPath:n.path}),typeof s=="string"?s.replace(zI,(l,c)=>Dn(n[c])):typeof s=="function"?s(n):s}static isError(s){return s&&s.name==="ValidationError"}constructor(s,n,i,l,c){const u=new wj(s,n,i,l);if(c)return u;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[Pb]="Error",this.name=u.name,this.message=u.message,this.type=u.type,this.value=u.value,this.path=u.path,this.errors=u.errors,this.inner=u.inner,Error.captureStackTrace&&Error.captureStackTrace(this,zs)}static[Ub](s){return wj[Symbol.hasInstance](s)||super[Symbol.hasInstance](s)}}let Xa={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:t,type:s,value:n,originalValue:i})=>{const l=i!=null&&i!==n?` (cast from the value \`${Dn(i,!0)}\`).`:".";return s!=="mixed"?`${t} must be a \`${s}\` type, but the final value was: \`${Dn(n,!0)}\``+l:`${t} must match the configured type. The validated value was: \`${Dn(n,!0)}\``+l}},Is={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},ir={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},Mm={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},zm={isValue:"${path} field must be ${value}"},qd={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},Hd={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},LI={notType:t=>{const{path:s,value:n,spec:i}=t,l=i.types.length;if(Array.isArray(n)){if(n.length<l)return`${s} tuple value has too few items, expected a length of ${l} but got ${n.length} for value: \`${Dn(n,!0)}\``;if(n.length>l)return`${s} tuple value has too many items, expected a length of ${l} but got ${n.length} for value: \`${Dn(n,!0)}\``}return zs.formatError(Xa.notType,t)}};Object.assign(Object.create(null),{mixed:Xa,string:Is,number:ir,date:Mm,object:qd,array:Hd,boolean:zm,tuple:LI});const Au=t=>t&&t.__isYupSchema__;class ru{static fromOptions(s,n){if(!n.then&&!n.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:i,then:l,otherwise:c}=n,u=typeof i=="function"?i:(...f)=>f.every(p=>p===i);return new ru(s,(f,p)=>{var m;let g=u(...f)?l:c;return(m=g==null?void 0:g(p))!=null?m:p})}constructor(s,n){this.fn=void 0,this.refs=s,this.refs=s,this.fn=n}resolve(s,n){let i=this.refs.map(c=>c.getValue(n==null?void 0:n.value,n==null?void 0:n.parent,n==null?void 0:n.context)),l=this.fn(i,s,n);if(l===void 0||l===s)return s;if(!Au(l))throw new TypeError("conditions must return a schema object");return l.resolve(n)}}const Od={context:"$",value:"."};function BI(t,s){return new Er(t,s)}class Er{constructor(s,n={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof s!="string")throw new TypeError("ref must be a string, got: "+s);if(this.key=s.trim(),s==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===Od.context,this.isValue=this.key[0]===Od.value,this.isSibling=!this.isContext&&!this.isValue;let i=this.isContext?Od.context:this.isValue?Od.value:"";this.path=this.key.slice(i.length),this.getter=this.path&&li.getter(this.path,!0),this.map=n.map}getValue(s,n,i){let l=this.isContext?i:this.isValue?s:n;return this.getter&&(l=this.getter(l||{})),this.map&&(l=this.map(l)),l}cast(s,n){return this.getValue(s,n==null?void 0:n.parent,n==null?void 0:n.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(s){return s&&s.__isYupRef}}Er.prototype.__isYupRef=!0;const Ma=t=>t==null;function tl(t){function s({value:n,path:i="",options:l,originalValue:c,schema:u},f,p){const{name:m,test:g,params:v,message:j,skipAbsent:N}=t;let{parent:b,context:w,abortEarly:C=u.spec.abortEarly,disableStackTrace:T=u.spec.disableStackTrace}=l;function A(z){return Er.isRef(z)?z.getValue(n,b,w):z}function _(z={}){const Z=Object.assign({value:n,originalValue:c,label:u.spec.label,path:z.path||i,spec:u.spec,disableStackTrace:z.disableStackTrace||T},v,z.params);for(const W of Object.keys(Z))Z[W]=A(Z[W]);const ee=new zs(zs.formatError(z.message||j,Z),n,Z.path,z.type||m,Z.disableStackTrace);return ee.params=Z,ee}const D=C?f:p;let S={path:i,parent:b,type:m,from:l.from,createError:_,resolve:A,options:l,originalValue:c,schema:u};const R=z=>{zs.isError(z)?D(z):z?p(null):D(_())},E=z=>{zs.isError(z)?D(z):f(z)};if(N&&Ma(n))return R(!0);let I;try{var M;if(I=g.call(S,n,S),typeof((M=I)==null?void 0:M.then)=="function"){if(l.sync)throw new Error(`Validation test of type: "${S.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(I).then(R,E)}}catch(z){E(z);return}R(I)}return s.OPTIONS=t,s}function FI(t,s,n,i=n){let l,c,u;return s?(li.forEach(s,(f,p,m)=>{let g=p?f.slice(1,f.length-1):f;t=t.resolve({context:i,parent:l,value:n});let v=t.type==="tuple",j=m?parseInt(g,10):0;if(t.innerType||v){if(v&&!m)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${u}" must contain an index to the tuple element, e.g. "${u}[0]"`);if(n&&j>=n.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${f}, in the path: ${s}. because there is no value at that index. `);l=n,n=n&&n[j],t=v?t.spec.types[j]:t.innerType}if(!m){if(!t.fields||!t.fields[g])throw new Error(`The schema does not contain the path: ${s}. (failed at: ${u} which is a type: "${t.type}")`);l=n,n=n&&n[g],t=t.fields[g]}c=g,u=p?"["+f+"]":"."+f}),{schema:t,parent:l,parentPath:c}):{parent:l,parentPath:s,schema:t}}class iu extends Set{describe(){const s=[];for(const n of this.values())s.push(Er.isRef(n)?n.describe():n);return s}resolveAll(s){let n=[];for(const i of this.values())n.push(s(i));return n}clone(){return new iu(this.values())}merge(s,n){const i=this.clone();return s.forEach(l=>i.add(l)),n.forEach(l=>i.delete(l)),i}}function il(t,s=new Map){if(Au(t)||!t||typeof t!="object")return t;if(s.has(t))return s.get(t);let n;if(t instanceof Date)n=new Date(t.getTime()),s.set(t,n);else if(t instanceof RegExp)n=new RegExp(t),s.set(t,n);else if(Array.isArray(t)){n=new Array(t.length),s.set(t,n);for(let i=0;i<t.length;i++)n[i]=il(t[i],s)}else if(t instanceof Map){n=new Map,s.set(t,n);for(const[i,l]of t.entries())n.set(i,il(l,s))}else if(t instanceof Set){n=new Set,s.set(t,n);for(const i of t)n.add(il(i,s))}else if(t instanceof Object){n={},s.set(t,n);for(const[i,l]of Object.entries(t))n[i]=il(l,s)}else throw Error(`Unable to clone ${t}`);return n}class qs{constructor(s){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new iu,this._blacklist=new iu,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Xa.notType)}),this.type=s.type,this._typeCheck=s.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},s==null?void 0:s.spec),this.withMutation(n=>{n.nonNullable()})}get _type(){return this.type}clone(s){if(this._mutate)return s&&Object.assign(this.spec,s),this;const n=Object.create(Object.getPrototypeOf(this));return n.type=this.type,n._typeCheck=this._typeCheck,n._whitelist=this._whitelist.clone(),n._blacklist=this._blacklist.clone(),n.internalTests=Object.assign({},this.internalTests),n.exclusiveTests=Object.assign({},this.exclusiveTests),n.deps=[...this.deps],n.conditions=[...this.conditions],n.tests=[...this.tests],n.transforms=[...this.transforms],n.spec=il(Object.assign({},this.spec,s)),n}label(s){let n=this.clone();return n.spec.label=s,n}meta(...s){if(s.length===0)return this.spec.meta;let n=this.clone();return n.spec.meta=Object.assign(n.spec.meta||{},s[0]),n}withMutation(s){let n=this._mutate;this._mutate=!0;let i=s(this);return this._mutate=n,i}concat(s){if(!s||s===this)return this;if(s.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${s.type}`);let n=this,i=s.clone();const l=Object.assign({},n.spec,i.spec);return i.spec=l,i.internalTests=Object.assign({},n.internalTests,i.internalTests),i._whitelist=n._whitelist.merge(s._whitelist,s._blacklist),i._blacklist=n._blacklist.merge(s._blacklist,s._whitelist),i.tests=n.tests,i.exclusiveTests=n.exclusiveTests,i.withMutation(c=>{s.tests.forEach(u=>{c.test(u.OPTIONS)})}),i.transforms=[...n.transforms,...i.transforms],i}isType(s){return s==null?!!(this.spec.nullable&&s===null||this.spec.optional&&s===void 0):this._typeCheck(s)}resolve(s){let n=this;if(n.conditions.length){let i=n.conditions;n=n.clone(),n.conditions=[],n=i.reduce((l,c)=>c.resolve(l,s),n),n=n.resolve(s)}return n}resolveOptions(s){var n,i,l,c;return Object.assign({},s,{from:s.from||[],strict:(n=s.strict)!=null?n:this.spec.strict,abortEarly:(i=s.abortEarly)!=null?i:this.spec.abortEarly,recursive:(l=s.recursive)!=null?l:this.spec.recursive,disableStackTrace:(c=s.disableStackTrace)!=null?c:this.spec.disableStackTrace})}cast(s,n={}){let i=this.resolve(Object.assign({value:s},n)),l=n.assert==="ignore-optionality",c=i._cast(s,n);if(n.assert!==!1&&!i.isType(c)){if(l&&Ma(c))return c;let u=Dn(s),f=Dn(c);throw new TypeError(`The value of ${n.path||"field"} could not be cast to a value that satisfies the schema type: "${i.type}". 

attempted value: ${u} 
`+(f!==u?`result of cast: ${f}`:""))}return c}_cast(s,n){let i=s===void 0?s:this.transforms.reduce((l,c)=>c.call(this,l,s,this),s);return i===void 0&&(i=this.getDefault(n)),i}_validate(s,n={},i,l){let{path:c,originalValue:u=s,strict:f=this.spec.strict}=n,p=s;f||(p=this._cast(p,Object.assign({assert:!1},n)));let m=[];for(let g of Object.values(this.internalTests))g&&m.push(g);this.runTests({path:c,value:p,originalValue:u,options:n,tests:m},i,g=>{if(g.length)return l(g,p);this.runTests({path:c,value:p,originalValue:u,options:n,tests:this.tests},i,l)})}runTests(s,n,i){let l=!1,{tests:c,value:u,originalValue:f,path:p,options:m}=s,g=w=>{l||(l=!0,n(w,u))},v=w=>{l||(l=!0,i(w,u))},j=c.length,N=[];if(!j)return v([]);let b={value:u,originalValue:f,path:p,options:m,schema:this};for(let w=0;w<c.length;w++){const C=c[w];C(b,g,function(A){A&&(Array.isArray(A)?N.push(...A):N.push(A)),--j<=0&&v(N)})}}asNestedTest({key:s,index:n,parent:i,parentPath:l,originalParent:c,options:u}){const f=s??n;if(f==null)throw TypeError("Must include `key` or `index` for nested validations");const p=typeof f=="number";let m=i[f];const g=Object.assign({},u,{strict:!0,parent:i,value:m,originalValue:c[f],key:void 0,[p?"index":"key"]:f,path:p||f.includes(".")?`${l||""}[${p?f:`"${f}"`}]`:(l?`${l}.`:"")+s});return(v,j,N)=>this.resolve(g)._validate(m,g,j,N)}validate(s,n){var i;let l=this.resolve(Object.assign({},n,{value:s})),c=(i=n==null?void 0:n.disableStackTrace)!=null?i:l.spec.disableStackTrace;return new Promise((u,f)=>l._validate(s,n,(p,m)=>{zs.isError(p)&&(p.value=m),f(p)},(p,m)=>{p.length?f(new zs(p,m,void 0,void 0,c)):u(m)}))}validateSync(s,n){var i;let l=this.resolve(Object.assign({},n,{value:s})),c,u=(i=n==null?void 0:n.disableStackTrace)!=null?i:l.spec.disableStackTrace;return l._validate(s,Object.assign({},n,{sync:!0}),(f,p)=>{throw zs.isError(f)&&(f.value=p),f},(f,p)=>{if(f.length)throw new zs(f,s,void 0,void 0,u);c=p}),c}isValid(s,n){return this.validate(s,n).then(()=>!0,i=>{if(zs.isError(i))return!1;throw i})}isValidSync(s,n){try{return this.validateSync(s,n),!0}catch(i){if(zs.isError(i))return!1;throw i}}_getDefault(s){let n=this.spec.default;return n==null?n:typeof n=="function"?n.call(this,s):il(n)}getDefault(s){return this.resolve(s||{})._getDefault(s)}default(s){return arguments.length===0?this._getDefault():this.clone({default:s})}strict(s=!0){return this.clone({strict:s})}nullability(s,n){const i=this.clone({nullable:s});return i.internalTests.nullable=tl({message:n,name:"nullable",test(l){return l===null?this.schema.spec.nullable:!0}}),i}optionality(s,n){const i=this.clone({optional:s});return i.internalTests.optionality=tl({message:n,name:"optionality",test(l){return l===void 0?this.schema.spec.optional:!0}}),i}optional(){return this.optionality(!0)}defined(s=Xa.defined){return this.optionality(!1,s)}nullable(){return this.nullability(!0)}nonNullable(s=Xa.notNull){return this.nullability(!1,s)}required(s=Xa.required){return this.clone().withMutation(n=>n.nonNullable(s).defined(s))}notRequired(){return this.clone().withMutation(s=>s.nullable().optional())}transform(s){let n=this.clone();return n.transforms.push(s),n}test(...s){let n;if(s.length===1?typeof s[0]=="function"?n={test:s[0]}:n=s[0]:s.length===2?n={name:s[0],test:s[1]}:n={name:s[0],message:s[1],test:s[2]},n.message===void 0&&(n.message=Xa.default),typeof n.test!="function")throw new TypeError("`test` is a required parameters");let i=this.clone(),l=tl(n),c=n.exclusive||n.name&&i.exclusiveTests[n.name]===!0;if(n.exclusive&&!n.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return n.name&&(i.exclusiveTests[n.name]=!!n.exclusive),i.tests=i.tests.filter(u=>!(u.OPTIONS.name===n.name&&(c||u.OPTIONS.test===l.OPTIONS.test))),i.tests.push(l),i}when(s,n){!Array.isArray(s)&&typeof s!="string"&&(n=s,s=".");let i=this.clone(),l=Bb(s).map(c=>new Er(c));return l.forEach(c=>{c.isSibling&&i.deps.push(c.key)}),i.conditions.push(typeof n=="function"?new ru(l,n):ru.fromOptions(l,n)),i}typeError(s){let n=this.clone();return n.internalTests.typeError=tl({message:s,name:"typeError",skipAbsent:!0,test(i){return this.schema._typeCheck(i)?!0:this.createError({params:{type:this.schema.type}})}}),n}oneOf(s,n=Xa.oneOf){let i=this.clone();return s.forEach(l=>{i._whitelist.add(l),i._blacklist.delete(l)}),i.internalTests.whiteList=tl({message:n,name:"oneOf",skipAbsent:!0,test(l){let c=this.schema._whitelist,u=c.resolveAll(this.resolve);return u.includes(l)?!0:this.createError({params:{values:Array.from(c).join(", "),resolved:u}})}}),i}notOneOf(s,n=Xa.notOneOf){let i=this.clone();return s.forEach(l=>{i._blacklist.add(l),i._whitelist.delete(l)}),i.internalTests.blacklist=tl({message:n,name:"notOneOf",test(l){let c=this.schema._blacklist,u=c.resolveAll(this.resolve);return u.includes(l)?this.createError({params:{values:Array.from(c).join(", "),resolved:u}}):!0}}),i}strip(s=!0){let n=this.clone();return n.spec.strip=s,n}describe(s){const n=(s?this.resolve(s):this).clone(),{label:i,meta:l,optional:c,nullable:u}=n.spec;return{meta:l,label:i,optional:c,nullable:u,default:n.getDefault(s),type:n.type,oneOf:n._whitelist.describe(),notOneOf:n._blacklist.describe(),tests:n.tests.map(p=>({name:p.OPTIONS.name,params:p.OPTIONS.params})).filter((p,m,g)=>g.findIndex(v=>v.name===p.name)===m)}}}qs.prototype.__isYupSchema__=!0;for(const t of["validate","validateSync"])qs.prototype[`${t}At`]=function(s,n,i={}){const{parent:l,parentPath:c,schema:u}=FI(this,s,n,i.context);return u[t](l&&l[c],Object.assign({},i,{parent:l,path:s}))};for(const t of["equals","is"])qs.prototype[t]=qs.prototype.oneOf;for(const t of["not","nope"])qs.prototype[t]=qs.prototype.notOneOf;const UI=()=>!0;function Lm(t){return new qb(t)}class qb extends qs{constructor(s){super(typeof s=="function"?{type:"mixed",check:s}:Object.assign({type:"mixed",check:UI},s))}}Lm.prototype=qb.prototype;function za(){return new Hb}class Hb extends qs{constructor(){super({type:"boolean",check(s){return s instanceof Boolean&&(s=s.valueOf()),typeof s=="boolean"}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(i.spec.coerce&&!i.isType(s)){if(/^(true|1)$/i.test(String(s)))return!0;if(/^(false|0)$/i.test(String(s)))return!1}return s})})}isTrue(s=zm.isValue){return this.test({message:s,name:"is-value",exclusive:!0,params:{value:"true"},test(n){return Ma(n)||n===!0}})}isFalse(s=zm.isValue){return this.test({message:s,name:"is-value",exclusive:!0,params:{value:"false"},test(n){return Ma(n)||n===!1}})}default(s){return super.default(s)}defined(s){return super.defined(s)}optional(){return super.optional()}required(s){return super.required(s)}notRequired(){return super.notRequired()}nullable(){return super.nullable()}nonNullable(s){return super.nonNullable(s)}strip(s){return super.strip(s)}}za.prototype=Hb.prototype;const PI=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function qI(t){const s=Bm(t);if(!s)return Date.parse?Date.parse(t):Number.NaN;if(s.z===void 0&&s.plusMinus===void 0)return new Date(s.year,s.month,s.day,s.hour,s.minute,s.second,s.millisecond).valueOf();let n=0;return s.z!=="Z"&&s.plusMinus!==void 0&&(n=s.hourOffset*60+s.minuteOffset,s.plusMinus==="+"&&(n=0-n)),Date.UTC(s.year,s.month,s.day,s.hour,s.minute+n,s.second,s.millisecond)}function Bm(t){var s,n;const i=PI.exec(t);return i?{year:bn(i[1]),month:bn(i[2],1)-1,day:bn(i[3],1),hour:bn(i[4]),minute:bn(i[5]),second:bn(i[6]),millisecond:i[7]?bn(i[7].substring(0,3)):0,precision:(s=(n=i[7])==null?void 0:n.length)!=null?s:void 0,z:i[8]||void 0,plusMinus:i[9]||void 0,hourOffset:bn(i[10]),minuteOffset:bn(i[11])}:null}function bn(t,s=0){return Number(t)||s}let HI=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,YI=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,VI=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,GI="^\\d{4}-\\d{2}-\\d{2}",QI="\\d{2}:\\d{2}:\\d{2}",XI="(([+-]\\d{2}(:?\\d{2})?)|Z)",ZI=new RegExp(`${GI}T${QI}(\\.\\d+)?${XI}$`),WI=t=>Ma(t)||t===t.trim(),KI={}.toString();function Ae(){return new Yb}class Yb extends qs{constructor(){super({type:"string",check(s){return s instanceof String&&(s=s.valueOf()),typeof s=="string"}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(!i.spec.coerce||i.isType(s)||Array.isArray(s))return s;const l=s!=null&&s.toString?s.toString():s;return l===KI?s:l})})}required(s){return super.required(s).withMutation(n=>n.test({message:s||Xa.required,name:"required",skipAbsent:!0,test:i=>!!i.length}))}notRequired(){return super.notRequired().withMutation(s=>(s.tests=s.tests.filter(n=>n.OPTIONS.name!=="required"),s))}length(s,n=Is.length){return this.test({message:n,name:"length",exclusive:!0,params:{length:s},skipAbsent:!0,test(i){return i.length===this.resolve(s)}})}min(s,n=Is.min){return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i.length>=this.resolve(s)}})}max(s,n=Is.max){return this.test({name:"max",exclusive:!0,message:n,params:{max:s},skipAbsent:!0,test(i){return i.length<=this.resolve(s)}})}matches(s,n){let i=!1,l,c;return n&&(typeof n=="object"?{excludeEmptyString:i=!1,message:l,name:c}=n:l=n),this.test({name:c||"matches",message:l||Is.matches,params:{regex:s},skipAbsent:!0,test:u=>u===""&&i||u.search(s)!==-1})}email(s=Is.email){return this.matches(HI,{name:"email",message:s,excludeEmptyString:!0})}url(s=Is.url){return this.matches(YI,{name:"url",message:s,excludeEmptyString:!0})}uuid(s=Is.uuid){return this.matches(VI,{name:"uuid",message:s,excludeEmptyString:!1})}datetime(s){let n="",i,l;return s&&(typeof s=="object"?{message:n="",allowOffset:i=!1,precision:l=void 0}=s:n=s),this.matches(ZI,{name:"datetime",message:n||Is.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:n||Is.datetime_offset,params:{allowOffset:i},skipAbsent:!0,test:c=>{if(!c||i)return!0;const u=Bm(c);return u?!!u.z:!1}}).test({name:"datetime_precision",message:n||Is.datetime_precision,params:{precision:l},skipAbsent:!0,test:c=>{if(!c||l==null)return!0;const u=Bm(c);return u?u.precision===l:!1}})}ensure(){return this.default("").transform(s=>s===null?"":s)}trim(s=Is.trim){return this.transform(n=>n!=null?n.trim():n).test({message:s,name:"trim",test:WI})}lowercase(s=Is.lowercase){return this.transform(n=>Ma(n)?n:n.toLowerCase()).test({message:s,name:"string_case",exclusive:!0,skipAbsent:!0,test:n=>Ma(n)||n===n.toLowerCase()})}uppercase(s=Is.uppercase){return this.transform(n=>Ma(n)?n:n.toUpperCase()).test({message:s,name:"string_case",exclusive:!0,skipAbsent:!0,test:n=>Ma(n)||n===n.toUpperCase()})}}Ae.prototype=Yb.prototype;let JI=t=>t!=+t;function Pa(){return new Vb}class Vb extends qs{constructor(){super({type:"number",check(s){return s instanceof Number&&(s=s.valueOf()),typeof s=="number"&&!JI(s)}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(!i.spec.coerce)return s;let l=s;if(typeof l=="string"){if(l=l.replace(/\s/g,""),l==="")return NaN;l=+l}return i.isType(l)||l===null?l:parseFloat(l)})})}min(s,n=ir.min){return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i>=this.resolve(s)}})}max(s,n=ir.max){return this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(i){return i<=this.resolve(s)}})}lessThan(s,n=ir.lessThan){return this.test({message:n,name:"max",exclusive:!0,params:{less:s},skipAbsent:!0,test(i){return i<this.resolve(s)}})}moreThan(s,n=ir.moreThan){return this.test({message:n,name:"min",exclusive:!0,params:{more:s},skipAbsent:!0,test(i){return i>this.resolve(s)}})}positive(s=ir.positive){return this.moreThan(0,s)}negative(s=ir.negative){return this.lessThan(0,s)}integer(s=ir.integer){return this.test({name:"integer",message:s,skipAbsent:!0,test:n=>Number.isInteger(n)})}truncate(){return this.transform(s=>Ma(s)?s:s|0)}round(s){var n;let i=["ceil","floor","round","trunc"];if(s=((n=s)==null?void 0:n.toLowerCase())||"round",s==="trunc")return this.truncate();if(i.indexOf(s.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+i.join(", "));return this.transform(l=>Ma(l)?l:Math[s](l))}}Pa.prototype=Vb.prototype;let Gb=new Date(""),e$=t=>Object.prototype.toString.call(t)==="[object Date]";function Ls(){return new dc}class dc extends qs{constructor(){super({type:"date",check(s){return e$(s)&&!isNaN(s.getTime())}}),this.withMutation(()=>{this.transform((s,n,i)=>!i.spec.coerce||i.isType(s)||s===null?s:(s=qI(s),isNaN(s)?dc.INVALID_DATE:new Date(s)))})}prepareParam(s,n){let i;if(Er.isRef(s))i=s;else{let l=this.cast(s);if(!this._typeCheck(l))throw new TypeError(`\`${n}\` must be a Date or a value that can be \`cast()\` to a Date`);i=l}return i}min(s,n=Mm.min){let i=this.prepareParam(s,"min");return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(l){return l>=this.resolve(i)}})}max(s,n=Mm.max){let i=this.prepareParam(s,"max");return this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(l){return l<=this.resolve(i)}})}}dc.INVALID_DATE=Gb;Ls.prototype=dc.prototype;Ls.INVALID_DATE=Gb;function t$(t,s=[]){let n=[],i=new Set,l=new Set(s.map(([u,f])=>`${u}-${f}`));function c(u,f){let p=li.split(u)[0];i.add(p),l.has(`${f}-${p}`)||n.push([f,p])}for(const u of Object.keys(t)){let f=t[u];i.add(u),Er.isRef(f)&&f.isSibling?c(f.path,u):Au(f)&&"deps"in f&&f.deps.forEach(p=>c(p,u))}return kI.array(Array.from(i),n).reverse()}function Tj(t,s){let n=1/0;return t.some((i,l)=>{var c;if((c=s.path)!=null&&c.includes(i))return n=l,!0}),n}function Qb(t){return(s,n)=>Tj(t,s)-Tj(t,n)}const Xb=(t,s,n)=>{if(typeof t!="string")return t;let i=t;try{i=JSON.parse(t)}catch{}return n.isType(i)?i:t};function Yd(t){if("fields"in t){const s={};for(const[n,i]of Object.entries(t.fields))s[n]=Yd(i);return t.setFields(s)}if(t.type==="array"){const s=t.optional();return s.innerType&&(s.innerType=Yd(s.innerType)),s}return t.type==="tuple"?t.optional().clone({types:t.spec.types.map(Yd)}):"optional"in t?t.optional():t}const s$=(t,s)=>{const n=[...li.normalizePath(s)];if(n.length===1)return n[0]in t;let i=n.pop(),l=li.getter(li.join(n),!0)(t);return!!(l&&i in l)};let Ej=t=>Object.prototype.toString.call(t)==="[object Object]";function Cj(t,s){let n=Object.keys(t.fields);return Object.keys(s).filter(i=>n.indexOf(i)===-1)}const a$=Qb([]);function at(t){return new Zb(t)}class Zb extends qs{constructor(s){super({type:"object",check(n){return Ej(n)||typeof n=="function"}}),this.fields=Object.create(null),this._sortErrors=a$,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{s&&this.shape(s)})}_cast(s,n={}){var i;let l=super._cast(s,n);if(l===void 0)return this.getDefault(n);if(!this._typeCheck(l))return l;let c=this.fields,u=(i=n.stripUnknown)!=null?i:this.spec.noUnknown,f=[].concat(this._nodes,Object.keys(l).filter(v=>!this._nodes.includes(v))),p={},m=Object.assign({},n,{parent:p,__validating:n.__validating||!1}),g=!1;for(const v of f){let j=c[v],N=v in l;if(j){let b,w=l[v];m.path=(n.path?`${n.path}.`:"")+v,j=j.resolve({value:w,context:n.context,parent:p});let C=j instanceof qs?j.spec:void 0,T=C==null?void 0:C.strict;if(C!=null&&C.strip){g=g||v in l;continue}b=!n.__validating||!T?j.cast(l[v],m):l[v],b!==void 0&&(p[v]=b)}else N&&!u&&(p[v]=l[v]);(N!==v in p||p[v]!==l[v])&&(g=!0)}return g?p:l}_validate(s,n={},i,l){let{from:c=[],originalValue:u=s,recursive:f=this.spec.recursive}=n;n.from=[{schema:this,value:u},...c],n.__validating=!0,n.originalValue=u,super._validate(s,n,i,(p,m)=>{if(!f||!Ej(m)){l(p,m);return}u=u||m;let g=[];for(let v of this._nodes){let j=this.fields[v];!j||Er.isRef(j)||g.push(j.asNestedTest({options:n,key:v,parent:m,parentPath:n.path,originalParent:u}))}this.runTests({tests:g,value:m,originalValue:u,options:n},i,v=>{l(v.sort(this._sortErrors).concat(p),m)})})}clone(s){const n=super.clone(s);return n.fields=Object.assign({},this.fields),n._nodes=this._nodes,n._excludedEdges=this._excludedEdges,n._sortErrors=this._sortErrors,n}concat(s){let n=super.concat(s),i=n.fields;for(let[l,c]of Object.entries(this.fields)){const u=i[l];i[l]=u===void 0?c:u}return n.withMutation(l=>l.setFields(i,[...this._excludedEdges,...s._excludedEdges]))}_getDefault(s){if("default"in this.spec)return super._getDefault(s);if(!this._nodes.length)return;let n={};return this._nodes.forEach(i=>{var l;const c=this.fields[i];let u=s;(l=u)!=null&&l.value&&(u=Object.assign({},u,{parent:u.value,value:u.value[i]})),n[i]=c&&"getDefault"in c?c.getDefault(u):void 0}),n}setFields(s,n){let i=this.clone();return i.fields=s,i._nodes=t$(s,n),i._sortErrors=Qb(Object.keys(s)),n&&(i._excludedEdges=n),i}shape(s,n=[]){return this.clone().withMutation(i=>{let l=i._excludedEdges;return n.length&&(Array.isArray(n[0])||(n=[n]),l=[...i._excludedEdges,...n]),i.setFields(Object.assign(i.fields,s),l)})}partial(){const s={};for(const[n,i]of Object.entries(this.fields))s[n]="optional"in i&&i.optional instanceof Function?i.optional():i;return this.setFields(s)}deepPartial(){return Yd(this)}pick(s){const n={};for(const i of s)this.fields[i]&&(n[i]=this.fields[i]);return this.setFields(n,this._excludedEdges.filter(([i,l])=>s.includes(i)&&s.includes(l)))}omit(s){const n=[];for(const i of Object.keys(this.fields))s.includes(i)||n.push(i);return this.pick(n)}from(s,n,i){let l=li.getter(s,!0);return this.transform(c=>{if(!c)return c;let u=c;return s$(c,s)&&(u=Object.assign({},c),i||delete u[s],u[n]=l(c)),u})}json(){return this.transform(Xb)}exact(s){return this.test({name:"exact",exclusive:!0,message:s||qd.exact,test(n){if(n==null)return!0;const i=Cj(this.schema,n);return i.length===0||this.createError({params:{properties:i.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(s=!0,n=qd.noUnknown){typeof s!="boolean"&&(n=s,s=!0);let i=this.test({name:"noUnknown",exclusive:!0,message:n,test(l){if(l==null)return!0;const c=Cj(this.schema,l);return!s||c.length===0||this.createError({params:{unknown:c.join(", ")}})}});return i.spec.noUnknown=s,i}unknown(s=!0,n=qd.noUnknown){return this.noUnknown(!s,n)}transformKeys(s){return this.transform(n=>{if(!n)return n;const i={};for(const l of Object.keys(n))i[s(l)]=n[l];return i})}camelCase(){return this.transformKeys(cm.camelCase)}snakeCase(){return this.transformKeys(cm.snakeCase)}constantCase(){return this.transformKeys(s=>cm.snakeCase(s).toUpperCase())}describe(s){const n=(s?this.resolve(s):this).clone(),i=super.describe(s);i.fields={};for(const[c,u]of Object.entries(n.fields)){var l;let f=s;(l=f)!=null&&l.value&&(f=Object.assign({},f,{parent:f.value,value:f.value[c]})),i.fields[c]=u.describe(f)}return i}}at.prototype=Zb.prototype;function es(t){return new Wb(t)}class Wb extends qs{constructor(s){super({type:"array",spec:{types:s},check(n){return Array.isArray(n)}}),this.innerType=void 0,this.innerType=s}_cast(s,n){const i=super._cast(s,n);if(!this._typeCheck(i)||!this.innerType)return i;let l=!1;const c=i.map((u,f)=>{const p=this.innerType.cast(u,Object.assign({},n,{path:`${n.path||""}[${f}]`}));return p!==u&&(l=!0),p});return l?c:i}_validate(s,n={},i,l){var c;let u=this.innerType,f=(c=n.recursive)!=null?c:this.spec.recursive;n.originalValue!=null&&n.originalValue,super._validate(s,n,i,(p,m)=>{var g;if(!f||!u||!this._typeCheck(m)){l(p,m);return}let v=new Array(m.length);for(let N=0;N<m.length;N++){var j;v[N]=u.asNestedTest({options:n,index:N,parent:m,parentPath:n.path,originalParent:(j=n.originalValue)!=null?j:s})}this.runTests({value:m,tests:v,originalValue:(g=n.originalValue)!=null?g:s,options:n},i,N=>l(N.concat(p),m))})}clone(s){const n=super.clone(s);return n.innerType=this.innerType,n}json(){return this.transform(Xb)}concat(s){let n=super.concat(s);return n.innerType=this.innerType,s.innerType&&(n.innerType=n.innerType?n.innerType.concat(s.innerType):s.innerType),n}of(s){let n=this.clone();if(!Au(s))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+Dn(s));return n.innerType=s,n.spec=Object.assign({},n.spec,{types:s}),n}length(s,n=Hd.length){return this.test({message:n,name:"length",exclusive:!0,params:{length:s},skipAbsent:!0,test(i){return i.length===this.resolve(s)}})}min(s,n){return n=n||Hd.min,this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i.length>=this.resolve(s)}})}max(s,n){return n=n||Hd.max,this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(i){return i.length<=this.resolve(s)}})}ensure(){return this.default(()=>[]).transform((s,n)=>this._typeCheck(s)?s:n==null?[]:[].concat(n))}compact(s){let n=s?(i,l,c)=>!s(i,l,c):i=>!!i;return this.transform(i=>i!=null?i.filter(n):i)}describe(s){const n=(s?this.resolve(s):this).clone(),i=super.describe(s);if(n.innerType){var l;let c=s;(l=c)!=null&&l.value&&(c=Object.assign({},c,{parent:c.value,value:c.value[0]})),i.innerType=n.innerType.describe(c)}return i}}es.prototype=Wb.prototype;const lu=/^05\d{8}$/,ou=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Kb=at({instrumentName:Ae().oneOf(Cu,"כלי נגינה לא תקין"),isPrimary:za(),currentStage:Pa().min(1,"שלב חייב להיות מספר בין 1 ל-8").max(8,"שלב חייב להיות מספר בין 1 ל-8"),tests:at({stageTest:at({status:Ae().oneOf(Rm,"סטטוס מבחן לא תקין"),notes:Ae(),lastTestDate:Ls().nullable(),nextTestDate:Ls().nullable()}),technicalTest:at({status:Ae().oneOf(Rm,"סטטוס מבחן לא תקין"),notes:Ae(),lastTestDate:Ls().nullable(),nextTestDate:Ls().nullable()})})}),Jb=at({teacherId:Ae(),day:Ae().oneOf(hI,"יום לא תקין"),time:Ae().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין"),duration:Pa().oneOf(fI,"משך שיעור לא תקין")}),n$=(t=!1,s=!1)=>at({personalInfo:at({fullName:Ae().required("שם מלא הוא שדה חובה"),phone:Ae().required("טלפון הוא שדה חובה").matches(lu,{message:"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),age:Pa().nullable().transform((n,i)=>i===""||i===null||i===void 0?null:n).min(5,"גיל מינימלי הוא 5").max(99,"גיל מקסימלי הוא 99"),address:Ae().required("כתובת היא שדה חובה"),parentName:Ae(),parentPhone:Ae().nullable().transform(n=>n||null).matches(lu,{message:"מספר טלפון הורה לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),parentEmail:Ae().nullable().transform(n=>n||null).matches(ou,{message:"כתובת אימייל הורה לא תקינה",excludeEmptyString:!0}),studentEmail:Ae().nullable().transform(n=>n||null).matches(ou,{message:"כתובת אימייל תלמיד לא תקינה",excludeEmptyString:!0})}),academicInfo:at({instrumentProgress:es().of(Kb),class:t||s?Ae().nullable().transform(n=>n||null).oneOf([...Qo,null],"כיתה לא תקינה"):Ae().required("כיתה היא שדה חובה").oneOf(Qo,"כיתה לא תקינה")}),teacherAssignments:es().of(Jb),orchestraAssignments:es().of(at({orchestraId:Ae()})),isActive:za()});at({personalInfo:at({fullName:Ae().required("שם מלא הוא שדה חובה"),phone:Ae().required("טלפון הוא שדה חובה").matches(lu,{message:"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),age:Pa().nullable().transform((t,s)=>s===""||s===null||s===void 0?null:t).min(5,"גיל מינימלי הוא 5").max(99,"גיל מקסימלי הוא 99"),address:Ae().required("כתובת היא שדה חובה"),parentName:Ae(),parentPhone:Ae().nullable().transform(t=>t||null).matches(lu,{message:"מספר טלפון הורה לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),parentEmail:Ae().nullable().transform(t=>t||null).matches(ou,{message:"כתובת אימייל הורה לא תקינה",excludeEmptyString:!0}),studentEmail:Ae().nullable().transform(t=>t||null).matches(ou,{message:"כתובת אימייל תלמיד לא תקינה",excludeEmptyString:!0})}),academicInfo:at({instrumentProgress:es().of(Kb),class:Ae().required("כיתה היא שדה חובה").oneOf(Qo,"כיתה לא תקינה")}),teacherAssignments:es().of(Jb),orchestraAssignments:es().of(at({orchestraId:Ae()})),isActive:za()});const r$=({onClose:t,onStudentCreated:s,onError:n}={})=>{const[i,l]=x.useState(!1),[c,u]=x.useState(null),{addToast:f}=It(),[p,m]=x.useState(null),g=async(j,N)=>{var b,w,C,T,A,_,D,S,R,E,k;l(!0),u(null);try{console.log("Starting saveStudentData with:",{studentId:j._id,teacherAssignments:N.teacherAssignments.length,teacherIds:N.teacherIds});const I=Array.isArray(N.teacherIds)?[...new Set(N.teacherIds.filter(Boolean))]:[];console.log("TeacherIds after processing:",I);const M={...j,teacherIds:I,teacherAssignments:N.teacherAssignments||[],enrollments:{...N.enrollments,orchestraIds:N.orchestraAssignments.map(ee=>ee.orchestraId)}};console.log("API data being sent:",{teacherIds:M.teacherIds,teacherAssignments:M.teacherAssignments,teacherAssignmentsLength:N.teacherAssignments.length,note:"teacherAssignments included in API - backend now supports this field"});let z;j._id?(console.log(`UPDATING existing student with ID: ${j._id}`),z=await ot.updateStudent(j._id,M)):(console.log("Creating NEW student"),z=await ot.addStudent(M)),console.log(`${j._id?"Updated":"New"} student ${z._id} created successfully:`,z),m(z),s&&s(z),t&&t();const Z=j._id?`התלמיד ${(b=z.personalInfo)==null?void 0:b.fullName} עודכן בהצלחה`:`התלמיד ${(w=z.personalInfo)==null?void 0:w.fullName} נוסף בהצלחה`;return f({type:"success",message:Z,onUndo:j._id?void 0:()=>v(z._id)}),l(!1),z}catch(I){console.error("💥 Error saving student data:",I),console.error("📊 Student data that failed to save:",{studentId:j._id,teacherAssignments:((C=N.teacherAssignments)==null?void 0:C.length)||0,teacherIds:((T=N.teacherIds)==null?void 0:T.length)||0,orchestraAssignments:((A=N.orchestraAssignments)==null?void 0:A.length)||0,isUpdate:!!j._id}),(((_=I==null?void 0:I.response)==null?void 0:_.status)===500||(I==null?void 0:I.status)===500)&&console.error("🚨 500 Internal Server Error Details:",{url:((D=I==null?void 0:I.config)==null?void 0:D.url)||"unknown",method:((S=I==null?void 0:I.config)==null?void 0:S.method)||"unknown",data:(R=I==null?void 0:I.config)!=null&&R.data?JSON.parse(I.config.data):"no data",response:((E=I==null?void 0:I.response)==null?void 0:E.data)||"no response data"});const M=ts(I),z=new Error(M.userMessage);u(z),l(!1);const Z=((k=I==null?void 0:I.response)==null?void 0:k.status)===500?"שגיאת שרת (500). נמצאת בעיה בעיבוד הנתונים. אנא בדוק את הקונסול ונסה שוב.":M.userMessage;throw f({type:"danger",message:Z,autoCloseTime:8e3}),n&&n(z),z}},v=async j=>{if(j)try{await ot.removeStudent(j),f({type:"info",message:"הוספת התלמיד בוטלה בהצלחה"}),m(null)}catch(N){console.error("Error undoing student creation:",N);const b=ts(N);f({type:"danger",message:b.userMessage,autoCloseTime:5e3})}};return{isSubmitting:i,error:c,saveStudentData:g,lastSavedStudent:p}};function eN({isOpen:t,onClose:s,student:n,onStudentCreated:i,newTeacherInfo:l}){const{currentSchoolYear:c}=na(),[u,f]=x.useState(null),{user:p,isAuthenticated:m}=vs(),{saveStudentData:g,isSubmitting:v,error:j}=r$({onClose:s,onStudentCreated:i}),N=Cl(p,m),b=Sr(N),w=b.isAdmin(),C=!!(n!=null&&n._id),{modalProps:T,titleProps:A,descriptionProps:_}=Al({isOpen:t,onClose:s,modalId:"student-form",restoreFocusOnClose:!0}),D=()=>{var E,k,I,M,z,Z,ee,W,K,Q,ne,X,se,O,B,L,Y,H;if(n!=null&&n._id)return{_id:n._id,personalInfo:{fullName:((E=n.personalInfo)==null?void 0:E.fullName)||"",phone:((k=n.personalInfo)==null?void 0:k.phone)||"",age:(I=n.personalInfo)!=null&&I.age?n.personalInfo.age.toString():void 0,address:((M=n.personalInfo)==null?void 0:M.address)||"",parentName:((z=n.personalInfo)==null?void 0:z.parentName)||"",parentPhone:((Z=n.personalInfo)==null?void 0:Z.parentPhone)||"",parentEmail:((ee=n.personalInfo)==null?void 0:ee.parentEmail)||"",studentEmail:((W=n.personalInfo)==null?void 0:W.studentEmail)||""},academicInfo:{instrumentProgress:((K=n.academicInfo)==null?void 0:K.instrumentProgress)||[],class:((Q=n.academicInfo)==null?void 0:Q.class)||Qo[0]},enrollments:{orchestraIds:((ne=n.enrollments)==null?void 0:ne.orchestraIds)||[],ensembleIds:((X=n.enrollments)==null?void 0:X.ensembleIds)||[],schoolYears:((se=n.enrollments)==null?void 0:se.schoolYears)||[],theoryLessonIds:((O=n.enrollments)==null?void 0:O.theoryLessonIds)||[]},teacherIds:n.teacherIds||[],teacherAssignments:(n.teacherAssignments||[]).map(P=>({...P,day:P.day,duration:P.duration})),orchestraAssignments:((L=(B=n.enrollments)==null?void 0:B.orchestraIds)==null?void 0:L.map(P=>({orchestraId:P})))||[],theoryLessonAssignments:((H=(Y=n.enrollments)==null?void 0:Y.theoryLessonIds)==null?void 0:H.map(P=>({theoryLessonId:P})))||[],isActive:n.isActive!==!1};{const P={personalInfo:{fullName:"",phone:"",age:"",address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[],class:"א"},enrollments:{orchestraIds:[],ensembleIds:[],schoolYears:[],theoryLessonIds:[]},teacherIds:[],teacherAssignments:[],orchestraAssignments:[],theoryLessonAssignments:[],isActive:!0};return c&&(P.enrollments.schoolYears=[{schoolYearId:c._id,isActive:!0}]),P}},S=async(E,k)=>{var I,M;console.log("🚀 StudentForm.handleSubmit called");try{f(null),n!=null&&n._id?b.validateAction("update",n,"student"):b.validateAction("add",void 0,"student");const z=(E.teacherAssignments||[]).filter(K=>{const Q=K.teacherId&&K.day&&K.time&&K.duration&&typeof K.duration=="number"&&[30,45,60].includes(K.duration);return Q||console.warn("🚨 Filtering out invalid teacher assignment:",K),Q}),Z=(E.teacherIds||[]).filter(Boolean);console.log("✅ Validation results:",{originalAssignments:((I=E.teacherAssignments)==null?void 0:I.length)||0,validAssignments:z.length,originalTeacherIds:((M=E.teacherIds)==null?void 0:M.length)||0,validTeacherIds:Z.length});const ee={_id:E._id,personalInfo:{...E.personalInfo,age:E.personalInfo.age&&E.personalInfo.age!==""&&parseInt(E.personalInfo.age.toString())||void 0,parentName:E.personalInfo.parentName||"לא צוין",parentPhone:E.personalInfo.parentPhone||"0500000000",parentEmail:E.personalInfo.parentEmail||"parent@example.com",studentEmail:E.personalInfo.studentEmail||"student@example.com"},academicInfo:{instrumentProgress:E.academicInfo.instrumentProgress||[],class:E.academicInfo.class},isActive:E.isActive};console.log("📝 Submitting student with",z.length,"validated teacher assignments");const W={...E,teacherAssignments:z,teacherIds:Z};await g(ee,W),k.resetForm()}catch(z){console.error("Error during form submission:",z);const Z=ts(z);f(Z.userMessage),k.setSubmitting(!1)}},R=()=>{s()};return t?e.jsx(Ta,{isOpen:t,onClose:R,className:"student-form responsive-form",children:e.jsxs("div",{className:"form-modal",...T,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:R,"aria-label":"סגור",type:"button",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...A,children:n!=null&&n._id?"עריכת תלמיד":"הוספת תלמיד חדש"})]}),e.jsx("div",{..._,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי תלמיד קיים במערכת":"טופס הוספת תלמיד חדש למערכת"}),j&&e.jsx("div",{className:"error-message",children:j.message||String(j)}),u&&e.jsx("div",{className:"error-message",children:u}),e.jsx(xr,{initialValues:D(),validationSchema:n$(w,C),onSubmit:S,enableReinitialize:!0,validateOnMount:!0,validateOnChange:!0,children:({isSubmitting:E,errors:k,touched:I,isValid:M,values:z})=>e.jsxs($n,{children:[e.jsx("div",{className:"form-section-full-width",children:e.jsx(mI,{})}),e.jsx("div",{className:"form-section-full-width",children:e.jsx(jI,{newTeacherInfo:l})}),e.jsxs("div",{className:"form-sections-two-columns",children:[e.jsx("div",{className:"form-section-column",children:e.jsx(pI,{isEditMode:C})}),e.jsx("div",{className:"form-section-column",children:e.jsx(bI,{})})]}),e.jsx("div",{className:"form-section-full-width",children:e.jsx(TI,{})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",disabled:v||E,onClick:Z=>{M||(k.academicInfo&&console.log("📚 Academic info validation errors:",k.academicInfo),k.personalInfo&&console.log("👤 Personal info validation errors:",k.personalInfo),k.teacherAssignments&&console.log("👨‍🏫 Teacher assignment validation errors:",k.teacherAssignments),alert("יש שגיאות בטופס. אנא בדוק את השדות המסומנים באדום ותקן אותם לפני השליחה."))},children:v||E?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:R,disabled:v||E,children:"ביטול"})]})]})})]})}):null}const ea=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},dm=t=>{const s=Math.floor(t/60),n=t%60;return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},i$=(t,s)=>{if(t.dayOfWeek!==s.dayOfWeek)return!1;const n=ea(t.startTime),i=ea(t.endTime),l=ea(s.startTime),c=ea(s.endTime);return n<c&&i>l},Id=t=>{const s=[];for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++)i$(t[n],t[i])&&s.push({slotA:t[n].id,slotB:t[i].id});return s},tN=t=>Mb[t],l$=(t,s)=>{const[n,i]=t.split(":").map(Number),c=n*60+i+s,u=Math.floor(c/60),f=c%60;return`${u.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},Sn=t=>{const s=tN(t.day),n=l$(t.time,t.duration);return{id:t._id,teacherId:t.teacherId,teacherName:t.teacherName,studentId:t.studentId,studentName:t.studentName,dayOfWeek:s,startTime:t.time,endTime:n,duration:t.duration,location:t.location,notes:t.notes,isRecurring:!0,isActive:t.isActive,createdAt:t.createdAt,updatedAt:t.updatedAt}},Aj=(t,s,n)=>{const i={};for(let u=0;u<7;u++)i[u]=[];Object.entries(t.schedule).forEach(([u,f])=>{if(f&&f.length>0){const p=tN(u);i[p]=f.map(Sn)}});const l=Object.values(i).flat(),c=l.filter(u=>u.studentId).length;return{teacherId:t.teacherId,teacherName:s||"מורה לא ידוע",instrument:n,weeklySchedule:i,totalSlots:l.length,occupiedSlots:c,availableSlots:l.length-c}},$d=t=>{const s=[];return Object.values(t).forEach(n=>{s.push(...n)}),s},Xs={async getTeacherWeeklySchedule(t,s=!0){try{const n=await ge.get(`schedule/teacher/${t}/weekly`,{includeStudentInfo:s});return Aj(n).weeklySchedule}catch(n){throw console.error("Failed to get teacher weekly schedule:",n),new Error("שגיאה בטעינת מערכת השעות של המורה")}},async getTeacherSchedule(t,s=!0){try{const n=await ge.get(`schedule/teacher/${t}`,{includeStudentInfo:s});return Aj(n)}catch(n){throw console.error("Failed to get teacher schedule:",n),new Error("שגיאה בטעינת מערכת השעות של המורה")}},async getAvailableSlots(t,s){var n;try{const i={teacherId:t,...s};let l=[];try{l=await ge.get(`schedule/teacher/${t}/available`,i)}catch{}if(l.length===0)try{const{teacherService:c}=await rl(async()=>{const{teacherService:p}=await Promise.resolve().then(()=>Pd);return{teacherService:p}},void 0),u=await c.getTeacherById(t),f=(u==null?void 0:u.timeBlocks)||((n=u==null?void 0:u.teaching)==null?void 0:n.timeBlocks);if(u&&f&&f.length>0)return f.flatMap(m=>{var C,T;const g=(s==null?void 0:s.duration)||60,v=m.totalDuration||0,j=Math.floor(v/g),N=[],w={ראשון:0,שני:1,שלישי:2,רביעי:3,חמישי:4,שישי:5,שבת:6}[m.day]??0;for(let A=0;A<j;A++){const[_,D]=m.startTime.split(":").map(Number),S=_*60+D+A*g,R=S+g,[E,k]=m.endTime.split(":").map(Number),I=E*60+k;if(R<=I){const M=Math.floor(S/60),z=S%60,Z=Math.floor(R/60),ee=R%60,W=`${M.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`,K=`${Z.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`;N.push({id:`${m._id}-slot-${A}`,teacherId:t,teacherName:((C=u.personalInfo)==null?void 0:C.fullName)||"",dayOfWeek:w,startTime:W,endTime:K,duration:g,location:m.location||"",isRecurring:((T=m.recurring)==null?void 0:T.isRecurring)||!1,isActive:m.isActive,studentId:void 0,studentName:void 0,notes:m.notes||""})}}return N})}catch(c){console.warn("Failed to load time blocks, using empty slots array:",c)}return l.map(Sn)}catch(i){throw console.error("Failed to get available slots:",i),new Error("שגיאה בטעינת השעות הזמינות")}},async createScheduleSlot(t,s){try{const n=await ge.post(`schedule/teacher/${t}/slot`,s);return Sn(n)}catch(n){throw console.error("Failed to create schedule slot:",n),new Error("שגיאה ביצירת משבצת זמן חדשה")}},async updateScheduleSlot(t,s){try{const n=await ge.put(`schedule/slot/${t}`,s);return Sn(n)}catch(n){throw console.error("Failed to update schedule slot:",n),new Error("שגיאה בעדכון משבצת הזמן")}},async deleteScheduleSlot(t){try{return await ge.delete(`schedule/slot/${t}`),!0}catch(s){throw console.error("Failed to delete schedule slot:",s),new Error("שגיאה במחיקת משבצת הזמן")}},async assignStudentToSlot(t){try{const s=await ge.post("schedule/assign",t);return Sn(s)}catch(s){throw console.error("Failed to assign student to slot:",s),new Error("שגיאה בשיוך התלמיד למשבצת הזמן")}},async removeStudentFromSlot(t){try{const s=await ge.delete(`schedule/assign/${t}`);return Sn(s)}catch(s){throw console.error("Failed to remove student from slot:",s),new Error("שגיאה בהסרת התלמיד ממשבצת הזמן")}},async getStudentSchedule(t){try{return await ge.get(`schedule/student/${t}`)}catch(s){throw console.error("Failed to get student schedule:",s),new Error("שגיאה בטעינת מערכת השעות של התלמיד")}},async searchScheduleSlots(t){try{return(await ge.get("schedule/search",t)).map(Sn)}catch(s){throw console.error("Failed to search schedule slots:",s),new Error("שגיאה בחיפוש משבצות זמן")}},async getScheduleConflicts(t){try{return(await ge.get(`schedule/teacher/${t}/conflicts`)).map(Sn)}catch(s){throw console.error("Failed to get schedule conflicts:",s),new Error("שגיאה בטעינת התנגשויות במערכת השעות")}},async bulkAssignStudents(t){try{return(await ge.post("schedule/bulk-assign",{assignments:t})).slots.map(Sn)}catch(s){throw console.error("Failed to bulk assign students:",s),new Error("שגיאה בשיוך מרובה של תלמידים")}},async getTeacherScheduleStats(t){try{return await ge.get(`schedule/teacher/${t}/stats`)}catch(s){throw console.error("Failed to get teacher schedule stats:",s),new Error("שגיאה בטעינת סטטיסטיקות מערכת השעות")}}},sl={async createTimeBlock(t,s){try{const[n,i]=s.startTime.split(":").map(Number),[l,c]=s.endTime.split(":").map(Number),u=l*60+c-(n*60+i),f={יום:s.day,שעה:s.startTime,"משך השיעור":u,מיקום:s.location||"",הערות:s.notes||""},p=await ge.post(`schedule/teacher/${t}/slot`,f);return{_id:p._id||p.id||`temp-${Date.now()}`,teacherId:t,day:s.day,startTime:s.startTime,endTime:s.endTime,location:s.location,notes:s.notes,isActive:!0,assignedLessons:[],availableMinutes:u,utilizationPercentage:0,createdAt:new Date,updatedAt:new Date}}catch(n){throw console.error("Failed to create time block:",n),new Error("שגיאה ביצירת יום לימוד חדש")}},calculateAvailableMinutes(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u},async updateTimeBlock(t,s){try{return await ge.put(`schedule/time-block/${t}`,s)}catch(n){throw console.error("Failed to update time block:",n),new Error("שגיאה בעדכון יום הלימוד")}},async deleteTimeBlock(t){try{return await ge.delete(`schedule/time-block/${t}`)}catch(s){throw console.error("Failed to delete time block:",s),new Error("שגיאה במחיקת יום הלימוד")}},async getTeacherTimeBlocks(t,s=!0){try{return await ge.get(`schedule/teacher/${t}/time-blocks`,{includeStats:s})}catch(n){throw console.error("Failed to get teacher time blocks:",n),new Error("שגיאה בטעינת ימי הלימוד של המורה")}},async getAvailableSlotsEnhanced(t){try{return await ge.get(`schedule/teacher/${t.teacherId}/available-slots-enhanced`,t)}catch(s){throw console.error("Failed to get enhanced available slots:",s),new Error("שגיאה בטעינת השעות הזמינות המשופרות")}},async calculateDynamicSlots(t,s,n){try{const l=(await this.getTeacherTimeBlocks(t)).timeBlocks,c=[];for(const u of l){const f=this.calculateSlotsFromTimeBlock(u,s);c.push(...f)}return c.sort((u,f)=>f.optimalScore-u.optimalScore)}catch(i){return console.error("Failed to calculate dynamic slots:",i),[]}},calculateSlotsFromTimeBlock(t,s){const n=[],i=ea(t.startTime),l=ea(t.endTime);if(l-i<s)return n;const u=[...t.assignedLessons||[]].sort((m,g)=>ea(m.lessonStartTime)-ea(g.lessonStartTime));let f=i;for(const m of u){const g=ea(m.lessonStartTime),v=ea(m.lessonEndTime);if(g-f>=s){const N=this.generateSlotsInRange(f,g,s,t);n.push(...N)}f=v}if(l-f>=s){const m=this.generateSlotsInRange(f,l,s,t);n.push(...m)}return n},generateSlotsInRange(t,s,n,i){const l=[];for(let u=t;u+n<=s;u+=15){const f=dm(u),p=dm(u+n),m=u-t,g=s-(u+n);let v=50;m>=15&&m<=30&&(v+=20),g>=15&&g<=30&&(v+=20),m>0&&g>0&&(v+=10),n>=60&&(v+=10),v+=Math.random()*5;const j={timeBlockId:i._id,possibleStartTime:f,possibleEndTime:p,duration:n,teacherId:i.teacherId,day:i.day,location:i.location,optimalScore:Math.min(100,Math.round(v)),gapMinutesBefore:m,gapMinutesAfter:g};l.push(j)}return l},async assignLessonAndRefreshSlots(t){try{const s=dm(ea(t.lessonStartTime)+t.duration),n={timeBlockId:t.timeBlockId,studentId:t.studentId,lessonStartTime:t.lessonStartTime,duration:t.duration,notes:t.notes},i=await this.assignLessonToSlot(n);if(!i.success)throw new Error("Failed to assign lesson");const l=i.updatedTimeBlock,c=this.calculateSlotsFromTimeBlock(l,t.duration);return{success:!0,assignment:i.assignment,updatedSlots:c,message:"השיעור נוסף בהצלחה והשעות הזמינות עודכנו"}}catch(s){throw console.error("Failed to assign lesson and refresh slots:",s),new Error("שגיאה בהקצאת השיעור")}},async assignLessonToSlot(t){try{return await ge.post("schedule/assign-lesson",t)}catch(s){throw console.error("Failed to assign lesson to slot:",s),new Error("שגיאה בשיוך השיעור ליום הלימוד")}},async rescheduleLesson(t){try{return await ge.put("schedule/reschedule-lesson",t)}catch(s){throw console.error("Failed to reschedule lesson:",s),new Error("שגיאה בשינוי מועד השיעור")}},async cancelLessonAssignment(t){try{return await ge.delete(`schedule/lesson-assignment/${t}`)}catch(s){throw console.error("Failed to cancel lesson assignment:",s),new Error("שגיאה בביטול שיוך השיעור")}},async findOptimalSlots(t,s){try{return await ge.post(`schedule/teacher/${t}/find-optimal-slots`,s)}catch(n){throw console.error("Failed to find optimal slots:",n),new Error("שגיאה במציאת השעות האופטימליות")}},async getTeacherScheduleStats(t,s){try{const n=s?{...s}:{};return await ge.get(`schedule/teacher/${t}/stats-enhanced`,n)}catch(n){throw console.error("Failed to get teacher schedule stats:",n),new Error("שגיאה בטעינת סטטיסטיקות מערכת השעות")}},async batchCreateTimeBlocks(t,s){try{return await ge.post(`schedule/teacher/${t}/time-blocks/batch`,{timeBlocks:s})}catch(n){throw console.error("Failed to batch create time blocks:",n),new Error("שגיאה ביצירה מרובה של ימי לימוד")}},async getOptimizationSuggestions(t){try{return await ge.get(`schedule/teacher/${t}/optimization-suggestions`)}catch(s){throw console.error("Failed to get optimization suggestions:",s),new Error("שגיאה בטעינת הצעות אופטימיזציה")}},async validateTimeBlock(t,s){try{return await ge.post("schedule/validate-time-block",{timeBlockData:t,existingBlocks:s})}catch(n){throw console.error("Failed to validate time block:",n),new Error("שגיאה בבדיקת תקינות יום הלימוד")}}},o$=5*60*1e3,c$=t=>Date.now()-t<o$;Fa((t,s)=>({currentTeacherSchedule:null,currentTeacherScheduleMetadata:null,availableSlots:[],selectedSlot:null,currentStudentSchedule:null,conflicts:[],lastConflictCheck:null,isLoadingTeacherSchedule:!1,isLoadingStudentSchedule:!1,isLoadingAvailableSlots:!1,isCreatingSlot:!1,isUpdatingSlot:!1,isAssigningStudent:!1,isCheckingConflicts:!1,error:null,errorDetails:null,cacheTimestamp:0,teacherTimeBlocks:{},selectedTimeBlock:null,timeBlockStats:{},availableTimeSlots:[],slotSearchCriteria:null,lastSearchResults:null,activeAssignments:[],assignmentConflicts:[],recentAssignmentHistory:[],selectedDuration:60,selectedDay:null,isCreatingTimeBlock:!1,isCalculatingSlots:!1,isAssigningLesson:!1,viewMode:"blocks",lastUpdated:{},pendingOperations:[],loadTeacherSchedule:async(n,i=!0)=>{const l=s();if(!(l.currentTeacherSchedule&&c$(l.cacheTimestamp)))try{t({isLoadingTeacherSchedule:!0,error:null});const c=await Xs.getTeacherWeeklySchedule(n,i),u=$d(c),f=Id(u);t({currentTeacherSchedule:c,isLoadingTeacherSchedule:!1,conflicts:f.map(p=>({type:"overlap",slotA:u.find(m=>m.id===p.slotA),slotB:u.find(m=>m.id===p.slotB),message:"משבצות זמן חופפות",severity:"error"})),cacheTimestamp:Date.now(),lastConflictCheck:new Date().toISOString()})}catch(c){console.error("Failed to load teacher schedule:",c),t({error:c instanceof Error?c.message:"שגיאה בטעינת מערכת השעות של המורה",errorDetails:c,isLoadingTeacherSchedule:!1})}},loadTeacherScheduleMetadata:async(n,i=!0)=>{try{t({isLoadingTeacherSchedule:!0,error:null});const l=await Xs.getTeacherSchedule(n,i);t({currentTeacherScheduleMetadata:l,currentTeacherSchedule:l.weeklySchedule,isLoadingTeacherSchedule:!1,cacheTimestamp:Date.now()})}catch(l){console.error("Failed to load teacher schedule metadata:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת נתוני מערכת השעות",errorDetails:l,isLoadingTeacherSchedule:!1})}},loadAvailableSlots:async(n,i)=>{try{t({isLoadingAvailableSlots:!0,error:null});const l=await Xs.getAvailableSlots(n,i);return t({availableSlots:l,isLoadingAvailableSlots:!1}),l}catch(l){return console.error("Failed to load available slots:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת השעות הזמינות",errorDetails:l,isLoadingAvailableSlots:!1}),[]}},createTimeSlot:async(n,i)=>{try{t({isCreatingSlot:!0,error:null});const l=await Xs.createScheduleSlot(n,i),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[];u[l.dayOfWeek]=[...f,l].sort((g,v)=>g.startTime.localeCompare(v.startTime));const p=$d(u),m=Id(p);t({currentTeacherSchedule:u,conflicts:m.map(g=>({type:"overlap",slotA:p.find(v=>v.id===g.slotA),slotB:p.find(v=>v.id===g.slotB),message:"משבצות זמן חופפות",severity:"error"})),isCreatingSlot:!1,cacheTimestamp:Date.now()})}else t({isCreatingSlot:!1});return l}catch(l){return console.error("Failed to create time slot:",l),t({error:l instanceof Error?l.message:"שגיאה ביצירת משבצת זמן חדשה",errorDetails:l,isCreatingSlot:!1}),null}},updateTimeSlot:async(n,i)=>{var l;try{t({isUpdatingSlot:!0,error:null});const c=await Xs.updateScheduleSlot(n,i),u=s().currentTeacherSchedule;if(u){const f={...u};Object.keys(f).forEach(v=>{const j=Number(v);f[j]=f[j].filter(N=>N.id!==n)});const p=f[c.dayOfWeek]||[];f[c.dayOfWeek]=[...p,c].sort((v,j)=>v.startTime.localeCompare(j.startTime));const m=$d(f),g=Id(m);t({currentTeacherSchedule:f,conflicts:g.map(v=>({type:"overlap",slotA:m.find(j=>j.id===v.slotA),slotB:m.find(j=>j.id===v.slotB),message:"משבצות זמן חופפות",severity:"error"})),isUpdatingSlot:!1,selectedSlot:((l=s().selectedSlot)==null?void 0:l.id)===n?c:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isUpdatingSlot:!1});return c}catch(c){return console.error("Failed to update time slot:",c),t({error:c instanceof Error?c.message:"שגיאה בעדכון משבצת הזמן",errorDetails:c,isUpdatingSlot:!1}),null}},deleteTimeSlot:async n=>{var i;try{t({isUpdatingSlot:!0,error:null}),await Xs.deleteScheduleSlot(n);const l=s().currentTeacherSchedule;if(l){const c={...l};Object.keys(c).forEach(p=>{const m=Number(p);c[m]=c[m].filter(g=>g.id!==n)});const u=$d(c),f=Id(u);t({currentTeacherSchedule:c,conflicts:f.map(p=>({type:"overlap",slotA:u.find(m=>m.id===p.slotA),slotB:u.find(m=>m.id===p.slotB),message:"משבצות זמן חופפות",severity:"error"})),isUpdatingSlot:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===n?null:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isUpdatingSlot:!1});return!0}catch(l){return console.error("Failed to delete time slot:",l),t({error:l instanceof Error?l.message:"שגיאה במחיקת משבצת הזמן",errorDetails:l,isUpdatingSlot:!1}),!1}},assignStudent:async n=>{var i;try{t({isAssigningStudent:!0,error:null});const l=await Xs.assignStudentToSlot(n),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[],p=f.findIndex(m=>m.id===l.id);if(p!==-1){const m=[...f];m[p]=l,u[l.dayOfWeek]=m}else u[l.dayOfWeek]=[...f,l].sort((m,g)=>m.startTime.localeCompare(g.startTime));t({currentTeacherSchedule:u,isAssigningStudent:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===l.id?l:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return l}catch(l){return console.error("Failed to assign student:",l),t({error:l instanceof Error?l.message:"שגיאה בשיוך התלמיד למשבצת הזמן",errorDetails:l,isAssigningStudent:!1}),null}},removeStudent:async n=>{var i;try{t({isAssigningStudent:!0,error:null});const l=await Xs.removeStudentFromSlot(n),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[],p=f.findIndex(m=>m.id===l.id);if(p!==-1){const m=[...f];m[p]=l,u[l.dayOfWeek]=m}t({currentTeacherSchedule:u,isAssigningStudent:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===l.id?l:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return l}catch(l){return console.error("Failed to remove student:",l),t({error:l instanceof Error?l.message:"שגיאה בהסרת התלמיד ממשבצת הזמן",errorDetails:l,isAssigningStudent:!1}),null}},bulkAssignStudents:async n=>{try{t({isAssigningStudent:!0,error:null});const i=await Xs.bulkAssignStudents(n),l=s().currentTeacherSchedule;if(l){const c={...l};i.forEach(u=>{const f=c[u.dayOfWeek]||[],p=f.findIndex(m=>m.id===u.id);if(p!==-1){const m=[...f];m[p]=u,c[u.dayOfWeek]=m}else c[u.dayOfWeek]=[...f,u].sort((m,g)=>m.startTime.localeCompare(g.startTime))}),t({currentTeacherSchedule:c,isAssigningStudent:!1,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return i}catch(i){return console.error("Failed to bulk assign students:",i),t({error:i instanceof Error?i.message:"שגיאה בשיוך מרובה של תלמידים",errorDetails:i,isAssigningStudent:!1}),[]}},loadStudentSchedule:async n=>{try{t({isLoadingStudentSchedule:!0,error:null});const i=await Xs.getStudentSchedule(n);t({currentStudentSchedule:i,isLoadingStudentSchedule:!1})}catch(i){console.error("Failed to load student schedule:",i),t({error:i instanceof Error?i.message:"שגיאה בטעינת מערכת השעות של התלמיד",errorDetails:i,isLoadingStudentSchedule:!1})}},checkScheduleConflicts:async n=>{if(n)try{t({isCheckingConflicts:!0,error:null});const l=(await Xs.getScheduleConflicts(n)).map(c=>({type:"overlap",slotA:c,message:"משבצת זמן עם התנגשות",severity:"error"}));t({conflicts:l,isCheckingConflicts:!1,lastConflictCheck:new Date().toISOString()})}catch(i){console.error("Failed to check schedule conflicts:",i),t({error:i instanceof Error?i.message:"שגיאה בבדיקת התנגשויות",errorDetails:i,isCheckingConflicts:!1})}},resolveConflict:async n=>{console.log("Resolving conflict:",n)},searchScheduleSlots:async n=>{try{return await Xs.searchScheduleSlots(n)}catch(i){return console.error("Failed to search schedule slots:",i),t({error:i instanceof Error?i.message:"שגיאה בחיפוש משבצות זמן",errorDetails:i}),[]}},setSelectedSlot:n=>{t({selectedSlot:n})},clearErrors:()=>{t({error:null,errorDetails:null})},clearCache:()=>{t({cacheTimestamp:0})},resetState:()=>{t({currentTeacherSchedule:null,currentTeacherScheduleMetadata:null,availableSlots:[],selectedSlot:null,currentStudentSchedule:null,conflicts:[],lastConflictCheck:null,isLoadingTeacherSchedule:!1,isLoadingStudentSchedule:!1,isLoadingAvailableSlots:!1,isCreatingSlot:!1,isUpdatingSlot:!1,isAssigningStudent:!1,isCheckingConflicts:!1,error:null,errorDetails:null,cacheTimestamp:0,teacherTimeBlocks:{},selectedTimeBlock:null,timeBlockStats:{},availableTimeSlots:[],slotSearchCriteria:null,lastSearchResults:null,activeAssignments:[],assignmentConflicts:[],recentAssignmentHistory:[],selectedDuration:60,selectedDay:null,isCreatingTimeBlock:!1,isCalculatingSlots:!1,isAssigningLesson:!1,viewMode:"blocks",lastUpdated:{},pendingOperations:[]})},getAvailableSlots:async(n,i)=>s().loadAvailableSlots(n,i),isSlotConflicting:n=>s().conflicts.some(l=>(typeof l.slotA=="string"?l.slotA===n.id:l.slotA.id===n.id)||l.slotB&&(typeof l.slotB=="string"?l.slotB===n.id:l.slotB.id===n.id)),getTeacherScheduleStats:async n=>{try{return await Xs.getTeacherScheduleStats(n)}catch(i){return console.error("Failed to get teacher schedule stats:",i),t({error:i instanceof Error?i.message:"שגיאה בטעינת סטטיסטיקות",errorDetails:i}),null}},createTimeBlock:async(n,i)=>{try{t({isCreatingTimeBlock:!0,error:null});const l=await sl.createTimeBlock(n,i),u=[...s().teacherTimeBlocks[n]||[],l].sort((f,p)=>{const m=Object.keys(Mb),g=m.indexOf(f.day),v=m.indexOf(p.day);return g!==v?g-v:f.startTime.localeCompare(p.startTime)});return t({teacherTimeBlocks:{...s().teacherTimeBlocks,[n]:u},isCreatingTimeBlock:!1,lastUpdated:{...s().lastUpdated,[n]:new Date}}),l}catch(l){return console.error("Failed to create time block:",l),t({error:l instanceof Error?l.message:"שגיאה ביצירת יום לימוד חדש",errorDetails:l,isCreatingTimeBlock:!1}),null}},updateTimeBlock:async(n,i)=>{var l;try{t({isCreatingTimeBlock:!0,error:null});const c=await sl.updateTimeBlock(n,i),u=s().teacherTimeBlocks,f=c.teacherId,m=(u[f]||[]).map(g=>g._id===n?c:g);return t({teacherTimeBlocks:{...u,[f]:m},selectedTimeBlock:((l=s().selectedTimeBlock)==null?void 0:l._id)===n?c:s().selectedTimeBlock,isCreatingTimeBlock:!1,lastUpdated:{...s().lastUpdated,[f]:new Date}}),c}catch(c){return console.error("Failed to update time block:",c),t({error:c instanceof Error?c.message:"שגיאה בעדכון יום הלימוד",errorDetails:c,isCreatingTimeBlock:!1}),null}},deleteTimeBlock:async n=>{var i;try{t({isCreatingTimeBlock:!0,error:null});const l=await sl.deleteTimeBlock(n);if(l.success){const c=s().teacherTimeBlocks,u={};Object.keys(c).forEach(f=>{u[f]=c[f].filter(p=>p._id!==n)}),t({teacherTimeBlocks:u,selectedTimeBlock:((i=s().selectedTimeBlock)==null?void 0:i._id)===n?null:s().selectedTimeBlock,isCreatingTimeBlock:!1})}return l.success}catch(l){return console.error("Failed to delete time block:",l),t({error:l instanceof Error?l.message:"שגיאה במחיקת יום הלימוד",errorDetails:l,isCreatingTimeBlock:!1}),!1}},loadTeacherTimeBlocks:async(n,i=!0)=>{try{t({isLoadingTeacherSchedule:!0,error:null});const l=await sl.getTeacherTimeBlocks(n,i);t({teacherTimeBlocks:{...s().teacherTimeBlocks,[n]:l.timeBlocks},timeBlockStats:i&&l.stats?{...s().timeBlockStats,[n]:l.stats}:s().timeBlockStats,isLoadingTeacherSchedule:!1,lastUpdated:{...s().lastUpdated,[n]:new Date}})}catch(l){console.error("Failed to load teacher time blocks:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת ימי הלימוד של המורה",errorDetails:l,isLoadingTeacherSchedule:!1})}},searchAvailableSlots:async n=>{try{t({isCalculatingSlots:!0,error:null});const i={...n,sortBy:"optimal"},l=await sl.getAvailableSlotsEnhanced(i);return t({availableTimeSlots:l.slots,slotSearchCriteria:n,lastSearchResults:l,isCalculatingSlots:!1}),l.slots}catch(i){return console.error("Failed to search available slots:",i),t({error:i instanceof Error?i.message:"שגיאה בחיפוש השעות הזמינות",errorDetails:i,isCalculatingSlots:!1}),[]}},assignLessonToTimeBlock:async n=>{try{t({isAssigningLesson:!0,error:null});const i={timeBlockId:n.timeBlockId,studentId:n.studentId,lessonStartTime:n.lessonStartTime,duration:n.duration},l=await sl.assignLessonToSlot(i);if(l.success){const c=s().teacherTimeBlocks,u=l.updatedTimeBlock.teacherId,p=(c[u]||[]).map(v=>v._id===n.timeBlockId?l.updatedTimeBlock:v),m=s().recentAssignmentHistory,g=[l.assignment,...m.slice(0,9)];return t({teacherTimeBlocks:{...c,[u]:p},activeAssignments:[...s().activeAssignments,l.assignment],recentAssignmentHistory:g,isAssigningLesson:!1,lastUpdated:{...s().lastUpdated,[u]:new Date}}),l.assignment}return null}catch(i){return console.error("Failed to assign lesson to time block:",i),t({error:i instanceof Error?i.message:"שגיאה בשיוך השיעור ליום הלימוד",errorDetails:i,isAssigningLesson:!1}),null}},setSelectedTimeBlock:n=>{t({selectedTimeBlock:n})},setSelectedDuration:n=>{t({selectedDuration:n})},setSelectedDay:n=>{t({selectedDay:n})},setViewMode:n=>{t({viewMode:n})}}));at().shape({dayOfWeek:Pa().required("Day of week is required").min(0,"Invalid day").max(6,"Invalid day"),startTime:Ae().required("Start time is required").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),endTime:Ae().required("End time is required").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)").test("is-after-start","End time must be after start time",function(t){const{startTime:s}=this.parent;if(!s||!t)return!0;const n=ea(s);return ea(t)>n}),location:Ae().nullable(),notes:Ae().nullable(),isRecurring:za().required("Please specify if this is a recurring slot")});at().shape({scheduleSlotId:Ae().required("Schedule slot is required"),studentId:Ae().required("Student is required")});function d$(){const{students:t,isLoading:s,error:n,loadStudents:i,removeStudent:l}=La(),{loadCurrentSchoolYear:c}=na(),[u,f]=x.useState(!1),[p,m]=x.useState(null),[g,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[C,T]=x.useState(!1),A=F=>[F.personalInfo.fullName,F.academicInfo.instrument,F.academicInfo.class,F.personalInfo.parentName||"",F.personalInfo.studentEmail||""].filter(ae=>typeof ae=="string"),{filteredEntities:_,handleSearch:D,filters:S,handleApplyFilters:R,hasActiveFilters:E,availableInstruments:k,classRange:I}=bu(t,A,F=>{const te=[];if(F.academicInfo.instrument&&te.push(F.academicInfo.instrument),F.academicInfo.instrumentProgress){const oe=F.academicInfo.instrumentProgress.map(ce=>ce.instrumentName).filter(Boolean);te.push(...oe)}const ae=[...new Set(te)];return ae.length>1?ae:ae[0]||""},F=>{var oe,ce;if(F.academicInfo.currentStage)return typeof F.academicInfo.currentStage=="number"?F.academicInfo.currentStage:parseInt(F.academicInfo.currentStage)||0;const te=(oe=F.academicInfo.instrumentProgress)==null?void 0:oe.find(G=>G.isPrimary);if(te!=null&&te.currentStage)return te.currentStage;const ae=(ce=F.academicInfo.instrumentProgress)==null?void 0:ce[0];return(ae==null?void 0:ae.currentStage)||0},F=>parseInt(F.academicInfo.class||"0")||0,F=>F.personalInfo.fullName),M=Ot(),z=ys(),{user:Z,isAuthenticated:ee}=vs(),{addToast:W}=It(),K=Cl(Z,ee),Q=Sr(K);Q.isAdmin();const ne=z.pathname.includes("/students/")&&!z.pathname.endsWith("/students/");x.useEffect(()=>{i(),c()},[i,c]),x.useEffect(()=>{g&&i().then(()=>{console.log("Student list refreshed successfully"),v(!1)}).catch(F=>{console.error("Failed to refresh student list:",F),v(!1)})},[g,i]),x.useEffect(()=>{!ne&&z.pathname==="/students"&&v(!0)},[z.pathname,ne]),x.useEffect(()=>{const F=z.state;if(F!=null&&F.editStudentId){const te=t.find(ae=>ae._id===F.editStudentId)||null;m(te),f(!0),M("/students",{replace:!0,state:{}})}},[z.state,M,t]);const X=()=>{try{Q.validateAction("add",void 0,"student"),m(null),f(!0)}catch(F){const te=ts(F);W({type:"warning",message:te.userMessage,autoCloseTime:4e3})}},se=x.useCallback(()=>{f(!1),m(null),v(!0)},[]),O=x.useCallback(()=>{console.log("Student created/updated, refreshing list"),v(!0)},[]),B=F=>{const te=t.find(ae=>ae._id===F)||null;if(te)try{Q.validateAction("edit",te,"student"),m(te),f(!0)}catch(ae){const oe=ts(ae);W({type:"warning",message:oe.userMessage,autoCloseTime:4e3})}},L=F=>{M(`/students/${F}`)},Y=F=>{const te=t.find(ae=>ae._id===F);if(te)try{Q.validateAction("delete",te,"student"),w(F),N(!0)}catch(ae){const oe=ts(ae);W({type:"warning",message:oe.userMessage,autoCloseTime:4e3})}},H=async()=>{if(b)try{await l(b),w(null),v(!0),W({type:"success",message:"התלמיד נמחק בהצלחה",autoCloseTime:3e3})}catch(F){console.error("Failed to remove student:",F);const te=ts(F);W({type:"danger",message:te.userMessage,autoCloseTime:5e3})}},P=()=>{T(!C)},q=Q.canAddStudent();return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!ne&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(ic,{onSearch:D,placeholder:"חיפוש תלמידים..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${E?"active":""}`,onClick:P,"aria-label":"סנן תלמידים",children:[e.jsx(hi,{className:"icon"}),E&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:C,onToggle:()=>T(!C),onApplyFilters:R,availableInstruments:k,classRange:I||void 0,currentFilters:S,hasActiveFilters:E,entityType:"students"})]}),q&&e.jsx("button",{className:"btn-icon add-btn",onClick:X,"aria-label":"הוספת תלמיד חדש",children:e.jsx(ls,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!ne&&e.jsx(WA,{students:_,isLoading:s,onEdit:B,onView:L,onRemove:Y,authContext:K}),e.jsx(wl,{context:{loadStudents:i,refreshList:()=>v(!0)}}),e.jsx(eN,{isOpen:u,onClose:se,onStudentCreated:O,student:p||void 0}),e.jsx(gs,{isOpen:j,onClose:()=>N(!1),onConfirm:H,title:"מחיקת תלמיד",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התלמיד?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}),!ne&&!u&&e.jsx(mi,{})]})}function u$(){var me,je,Oe,De;const{studentId:t}=Nr(),[s,n]=x.useState(null),{updateStudentStage:i}=La(),[l,c]=x.useState(!0),[u,f]=x.useState(null),[p,m]=x.useState(!1),[g,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState({}),C=be=>Object.keys(b).length===0?be:{...be,academicInfo:{...be.academicInfo,instrumentProgress:be.academicInfo.instrumentProgress.map(Te=>{const Be=b[Te.instrumentName];return Be!==void 0?{...Te,currentStage:Be}:Te})}},[T,A]=x.useState({teachers:[],assignments:[]}),[_,D]=x.useState(!1),[S,R]=x.useState(null),[E,k]=x.useState([]),[I,M]=x.useState(!1),[z,Z]=x.useState([]),[ee,W]=x.useState(!1),[K,Q]=x.useState({instruments:!1,teachers:!1,orchestras:!1,tests:!1,bagrut:!1,attendance:!1,personalInfo:!0,parentInfo:!0,theoryLessons:!1,schedule:!0}),ne=Ot();x.useEffect(()=>{let be=!0;const Te=async()=>{var Be,V;c(!0),f(null);try{console.log(`Fetching student data for ID: ${t}`);const{students:ue,selectedStudent:ve}=La.getState(),Ne=ue.find(Ie=>Ie._id===t)||((ve==null?void 0:ve._id)===t?ve:null);let _e;if(Ne)console.log("Using student data from store (with local changes):",Ne),_e=Ne;else{console.log("Student not found in store, fetching from API");const Ie=await ot.getStudentById(t||"");_e=C(Ie)}if(!be)return;if(_e){console.log("Student data loaded successfully:",_e),n(_e),_e.teacherIds&&_e.teacherIds.length>0&&X(_e.teacherIds);const Ie=[..._e.academicInfo.orchestraIds||[],...((Be=_e.enrollments)==null?void 0:Be.orchestraIds)||[]].filter(Ue=>Ue);Ie.length>0&&B(Ie),(V=_e.enrollments)!=null&&V.theoryLessonIds&&_e.enrollments.theoryLessonIds.length>0&&O(_e.enrollments.theoryLessonIds)}else f("לא נמצא תלמיד")}catch(ue){if(console.error("Error fetching student:",ue),!be)return;f(ue instanceof Error?ue.message:"שגיאה בטעינת נתוני תלמיד")}finally{be&&c(!1)}};return t?(console.log("Student fetch effect running, studentId:",t),Te()):(f("חסר מספר מזהה של תלמיד"),c(!1)),()=>{be=!1}},[t]);const X=async be=>{if(!(!be||be.length===0)){D(!0),R(null);try{const Te=await Jt.getTeachersByIds(be);A({teachers:Te,assignments:[]})}catch(Te){console.error("Error loading teachers:",Te),R("שגיאה בטעינת נתוני מורים")}finally{D(!1)}}},se=()=>{s&&s.teacherIds&&X(s.teacherIds)},O=async be=>{if(!(!be||be.length===0)){W(!0);try{const Te=await Ss.getTheoryLessonsByIds(be);Z(Te)}catch(Te){console.error("Error loading theory lessons:",Te)}finally{W(!1)}}},B=async be=>{if(!(!be||be.length===0)){M(!0);try{const Te=await Ra.getOrchestrasByIds(be);k(Te)}catch(Te){console.error("Error loading orchestras:",Te)}finally{M(!1)}}},L=()=>{m(!p)},Y=()=>{ne("/students")},H=be=>{Q(Te=>({...Te,[be]:!Te[be]}))},P=be=>{ne(`/teachers/${be}`)},q=be=>{ne(`/orchestras/${be}`)},F=be=>{ne(`/theory/${be}`)},te=()=>{s!=null&&s._id&&ne("/students",{state:{editStudentId:s._id}})},ae=be=>be?be.split(" ").map(Te=>Te[0]).join("").substring(0,2):"",oe=be=>be?new Date(be).toLocaleDateString("he-IL"):"",ce=be=>{const Te=["#4D55CC","#6C63FF","#8A84FF","#A79DFF","#C2BAFF","#7952B3","#5E3B9A","#472980"];return Te[be-1]||Te[0]},G=((je=(me=s==null?void 0:s.academicInfo)==null?void 0:me.instrumentProgress)==null?void 0:je.find(be=>be.isPrimary))||((De=(Oe=s==null?void 0:s.academicInfo)==null?void 0:Oe.instrumentProgress)==null?void 0:De[0])||null;return{student:s,isLoading:l,error:u,flipped:p,toggleFlip:L,goBack:Y,getInitials:ae,getStageColor:ce,primaryInstrument:G,openSections:K,toggleSection:H,formatDate:oe,navigateToTeacher:P,navigateToOrchestra:q,navigateToTheoryLesson:F,navigateToStudentEdit:te,teachersData:T,teachersLoading:_,teachersError:S,orchestras:E,orchestrasLoading:I,theoryLessons:z,theoryLessonsLoading:ee,retryLoadTeachers:se,updateStudentTest:async(be,Te,Be)=>{var V,ue;if(!s||!t){console.error("Cannot update test: No student or studentId available");return}v(!0);try{console.log(`Updating ${Te} for ${be} to status: ${Be}`);const ve=Be,Ne=s.academicInfo.instrumentProgress.findIndex(Pt=>Pt.instrumentName===be);if(Ne===-1){console.error(`Instrument ${be} not found in student data`);return}const Ie=((ue=(V=s.academicInfo.instrumentProgress[Ne].tests)==null?void 0:V[Te])==null?void 0:ue.status)||"לא נבחן";console.log(`Previous status: ${Ie}, New status: ${Be}`);const Ue=JSON.parse(JSON.stringify(s));Ue.academicInfo.instrumentProgress[Ne].tests||(Ue.academicInfo.instrumentProgress[Ne].tests={}),Ue.academicInfo.instrumentProgress[Ne].tests[Te]||(Ue.academicInfo.instrumentProgress[Ne].tests[Te]={status:"לא נבחן",notes:""}),Ue.academicInfo.instrumentProgress[Ne].tests[Te].status=Be,Ue.academicInfo.instrumentProgress[Ne].tests[Te].lastTestDate=new Date().toISOString();const $t=["עבר/ה","עבר/ה בהצטיינות","עבר/ה בהצטיינות יתרה"],qe=["לא נבחן","לא עבר/ה"],mt=Ue.academicInfo.instrumentProgress[Ne].currentStage;Te==="stageTest"&&$t.includes(Be)&&qe.includes(Ie)&&mt<8&&(console.log(`Incrementing stage for ${be} from ${Ue.academicInfo.instrumentProgress[Ne].currentStage} to ${Ue.academicInfo.instrumentProgress[Ne].currentStage+1}`),Ue.academicInfo.instrumentProgress[Ne].currentStage+=1),n(Ue);const Rt=await ot.updateStudentTest(t,be,Te,ve);return Rt?(console.log("Server update successful, updating component state",Rt),n(Rt),Rt):(console.warn("Server returned empty result for test update"),Ue)}catch(ve){console.error("Error updating test status:",ve);return}finally{v(!1)}},isUpdatingTest:g,updateStudentStage:async(be,Te)=>{if(!s||!t){console.error("Cannot update stage: No student or studentId available");return}N(!0);try{console.log(`Updating stage for ${be} to ${Te}`);const Be=s.academicInfo.instrumentProgress.findIndex(Ie=>Ie.instrumentName===be);if(Be===-1){console.error(`Instrument ${be} not found in student data`);return}const ue=s.academicInfo.instrumentProgress[Be].currentStage;console.log(`Previous stage: ${ue}, New stage: ${Te}`),w(Ie=>({...Ie,[be]:Te})),t&&i(t,be,Te);const ve=C({...s,academicInfo:{...s.academicInfo,instrumentProgress:s.academicInfo.instrumentProgress.map(Ie=>Ie.instrumentName===be?{...Ie,currentStage:Te}:Ie)}});n(ve);const Ne=await ot.updateStudentStage(t,be,Te);console.log("Stage update successful:",Ne),w(Ie=>{const Ue={...Ie};return delete Ue[be],Ue});const _e=C(Ne);return n(_e),_e}catch(Be){if(console.error("Failed to update instrument stage:",Be),w(ue=>{const ve={...ue};return delete ve[be],ve}),t){const ue=s.academicInfo.instrumentProgress.find(ve=>ve.instrumentName===be);ue&&i(t,be,ue.currentStage)}const V=C(s);n(V),console.log("Reverted stage change due to error");return}finally{N(!1)}},isUpdatingStage:j}}function h$({student:t,isOpen:s,onToggle:n,getStageColor:i,updateStudentStage:l,isUpdatingStage:c=!1,canEditStage:u=!1}){const[f,p]=x.useState(null),m=[1,2,3,4,5,6,7,8],g=b=>{c||!u||p(f===b?null:b)},v=async(b,w)=>{if(c||!l)return;const C=t.academicInfo.instrumentProgress.find(T=>T.instrumentName===b);if(!C||C.currentStage===w){p(null);return}p(null);try{await l(b,w),console.log(`Updated stage for ${b} to ${w}`)}catch(T){console.error(`Failed to update stage for ${b}:`,T)}};if(!t||!t.academicInfo||!t.academicInfo.instrumentProgress)return null;const j=b=>b==="עבר/ה בהצטיינות יתרה"?"var(--success-emphasis)":b==="עבר/ה בהצטיינות"||b==="עבר/ה"?"var(--success)":b==="לא עבר/ה"?"var(--danger)":"var(--text-muted)",N=b=>b==="לא נבחן"?"not-tested":b==="לא עבר/ה"?"failed":b==="עבר/ה בהצטיינות יתרה"?"excellent-plus":b==="עבר/ה בהצטיינות"?"excellent":"passed";return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"כלי נגינה"}),s?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsx("div",{className:"sd-section-content",children:t.academicInfo.instrumentProgress.length>0?e.jsx("div",{className:"sd-compact-instruments-list",children:t.academicInfo.instrumentProgress.map(b=>{var w,C,T,A,_,D,S,R,E,k,I,M,z,Z,ee,W,K,Q,ne,X;return e.jsxs("div",{className:"sd-compact-instrument-card",children:[e.jsxs("div",{className:"sd-instrument-header",children:[e.jsxs("div",{className:"sd-instrument-name-container",children:[e.jsx(Je,{size:14,className:"sd-instrument-icon"}),e.jsx("span",{className:"sd-instrument-name",children:b.instrumentName}),b.isPrimary&&e.jsxs("span",{className:"sd-primary-badge",children:[e.jsx(In,{size:10})," ראשי"]})]}),e.jsxs("div",{className:"sd-stage-badge-container",children:[e.jsxs("div",{className:`sd-stage-badge ${u?"sd-clickable":""} ${c?"disabled":""}`,style:{backgroundColor:i(b.currentStage)},onClick:()=>g(b.instrumentName),children:["שלב ",b.currentStage]}),!c&&u&&f===b.instrumentName&&e.jsx("div",{className:"sd-stage-dropdown",children:m.map(se=>e.jsxs("div",{className:`sd-dropdown-item ${b.currentStage===se?"selected":""}`,onClick:()=>v(b.instrumentName,se),children:[b.currentStage===se&&e.jsx(In,{size:12}),"שלב ",se]},se))})]})]}),e.jsxs("div",{className:"sd-test-status-row",children:[e.jsxs("div",{className:"sd-test-item",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן טכני:"}),e.jsx("span",{className:`sd-test-value ${N(((C=(w=b.tests)==null?void 0:w.technicalTest)==null?void 0:C.status)||"לא נבחן")}`,style:{color:j(((A=(T=b.tests)==null?void 0:T.technicalTest)==null?void 0:A.status)||"לא נבחן")},children:((D=(_=b.tests)==null?void 0:_.technicalTest)==null?void 0:D.status)||"לא נבחן"})]}),e.jsxs("div",{className:"sd-test-item",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן שלב:"}),e.jsx("span",{className:`sd-test-value ${N(((R=(S=b.tests)==null?void 0:S.stageTest)==null?void 0:R.status)||"לא נבחן")}`,style:{color:j(((k=(E=b.tests)==null?void 0:E.stageTest)==null?void 0:k.status)||"לא נבחן")},children:((M=(I=b.tests)==null?void 0:I.stageTest)==null?void 0:M.status)||"לא נבחן"})]})]}),(((Z=(z=b.tests)==null?void 0:z.stageTest)==null?void 0:Z.notes)||((W=(ee=b.tests)==null?void 0:ee.technicalTest)==null?void 0:W.notes))&&e.jsx("div",{className:"sd-notes-row",children:e.jsx("span",{className:"sd-notes-text",children:((Q=(K=b.tests)==null?void 0:K.stageTest)==null?void 0:Q.notes)||((X=(ne=b.tests)==null?void 0:ne.technicalTest)==null?void 0:X.notes)})})]},b.instrumentName)})}):e.jsx("div",{className:"sd-no-data",children:"אין כלי נגינה"})})]})}function f$({student:t,isOpen:s,onToggle:n,formatDate:i}){var l,c;return!t||!t.personalInfo?null:e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(We,{size:16}),e.jsx("span",{children:"פרטים אישיים"})]}),s&&e.jsx("div",{className:"section-content",children:t.personalInfo.phone||t.personalInfo.address||t.personalInfo.studentEmail||t.createdAt||(l=t.academicInfo)!=null&&l.class?e.jsxs("div",{className:"info-grid",children:[t.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון"}),e.jsx("span",{className:"info-value",children:t.personalInfo.phone})]})]}),t.personalInfo.address&&e.jsxs("div",{className:"info-item",children:[e.jsx(vt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כתובת"}),e.jsx("span",{className:"info-value",children:t.personalInfo.address})]})]}),t.personalInfo.studentEmail&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל"}),e.jsx("span",{className:"info-value",children:t.personalInfo.studentEmail})]})]}),t.createdAt&&e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:i(t.createdAt)})]})]}),((c=t.academicInfo)==null?void 0:c.class)&&e.jsxs("div",{className:"info-item",children:[e.jsx(Vt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כיתה"}),e.jsx("span",{className:"info-value",children:t.academicInfo.class})]})]}),t.personalInfo.age!==void 0&&e.jsxs("div",{className:"info-item",children:[e.jsx(We,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"גיל"}),e.jsx("span",{className:"info-value",children:t.personalInfo.age})]})]})]}):e.jsx("div",{className:"no-data-message",children:"אין פרטים אישיים"})})]})}function m$({student:t,isOpen:s,onToggle:n}){if(!t||!t.personalInfo)return null;const i=p=>p?!["לא צוין","0500000000","parent@example.com"].includes(p):!1,l=i(t.personalInfo.parentName),c=i(t.personalInfo.parentPhone),u=i(t.personalInfo.parentEmail),f=l||c||u;return e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(We,{size:16}),e.jsx("span",{children:"פרטי הורה"})]}),s&&e.jsx("div",{className:"section-content",children:f?e.jsxs("div",{className:"info-grid",children:[l&&e.jsxs("div",{className:"info-item",children:[e.jsx(We,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"שם הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentName})]})]}),c&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentPhone})]})]}),u&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentEmail})]})]})]}):e.jsx("div",{className:"no-data-message",children:"אין פרטי הורה"})})]})}function p$({teachersData:t,teachersLoading:s,teachersError:n,isOpen:i,onToggle:l,onTeacherClick:c,onRetryLoadTeachers:u,studentTeacherIds:f=[],teacherAssignments:p=[]}){const m=x.useRef(!1),[g,v]=x.useState([]),j=(t==null?void 0:t.teachers)&&t.teachers.length>0||f&&f.length>0;x.useEffect(()=>{if(f&&f.length>0&&(!t.teachers||t.teachers.length===0)&&!s&&!m.current){const A=f.map(_=>({_id:_,teacherId:_,personalInfo:{fullName:`מורה ${_.slice(-4)}`},professionalInfo:{instrument:""},isPlaceholder:!0}));v(A),m.current=!0}},[f,t.teachers,s]),x.useEffect(()=>()=>{m.current=!1},[f.join(",")]);const N=A=>A?A.split(" ").map(_=>_[0]||"").join("").substring(0,2):"מ",b=A=>p.filter(_=>_.teacherId===A),w=(A,_)=>{const[D,S]=A.split(":").map(Number),R=D*60+S+_,E=Math.floor(R/60),k=R%60;return`${E.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`},C=(A,_)=>{const D=w(A,_);return`${A} - ${D}`},T=f&&f.length>0&&(!t.teachers||t.teachers.length===0)&&g.length>0;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(We,{size:16}),e.jsxs("span",{children:["מורים"," ",T?`(${f.length})`:t.teachers?`(${t.teachers.length})`:""]}),i?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:s?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען מורים..."})]}):n?e.jsxs("div",{className:"sd-error-state small",children:[e.jsx("p",{children:n}),e.jsx("button",{onClick:u,className:"sd-retry-btn",children:"נסה שוב"})]}):j?T?e.jsx("div",{className:"sd-teachers-grid",children:g.map((A,_)=>{var S,R;const D=b(A._id);return e.jsxs("div",{className:"sd-teacher-card sd-teacher-modern-card clickable",onClick:()=>c(A._id),children:[e.jsxs("div",{className:"sd-teacher-main",children:[e.jsxs("div",{className:"sd-teacher-identity",children:[e.jsx("div",{className:"sd-teacher-avatar",style:{backgroundColor:"#6c757d"},children:N(((S=A.personalInfo)==null?void 0:S.fullName)||"")}),e.jsxs("div",{className:"sd-teacher-info",children:[e.jsx("div",{className:"sd-teacher-name",children:((R=A.personalInfo)==null?void 0:R.fullName)||`מורה ${A._id.slice(-4)}`}),e.jsxs("div",{className:"sd-teacher-instrument",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:"כלי נגינה לא ידוע"})]})]})]}),e.jsx("button",{onClick:E=>{E.stopPropagation(),u()},className:"sd-load-details-btn",title:"טען פרטי מורה",children:e.jsx(Yt,{size:14})})]}),D.length>0&&e.jsxs("div",{className:"sd-teacher-lessons",children:[e.jsxs("div",{className:"sd-lessons-header",children:[e.jsx($e,{size:12}),e.jsxs("span",{children:["שיעורים (",D.length,")"]})]}),e.jsx("div",{className:"sd-lessons-list",children:D.map((E,k)=>e.jsxs("div",{className:"sd-lesson-item",children:[e.jsx("div",{className:"sd-lesson-day",children:E.day}),e.jsxs("div",{className:"sd-lesson-time",children:[e.jsx(Ve,{size:10}),e.jsx("span",{children:C(E.time,E.duration)})]}),e.jsxs("div",{className:"sd-lesson-duration",children:[E.duration,"ד'"]})]},`assignment-${k}`))})]})]},`teacher-id-${_}-${A._id}`)})}):e.jsx("div",{className:"sd-teachers-grid",children:t.teachers.map((A,_)=>{var S,R,E;const D=b(A._id);return e.jsxs("div",{className:"sd-teacher-card sd-teacher-modern-card clickable",onClick:()=>c(A._id),children:[e.jsxs("div",{className:"sd-teacher-main",children:[e.jsxs("div",{className:"sd-teacher-identity",children:[e.jsx("div",{className:"sd-teacher-avatar",style:{backgroundColor:"#4D55CC"},children:N(((S=A.personalInfo)==null?void 0:S.fullName)||"")}),e.jsxs("div",{className:"sd-teacher-info",children:[e.jsx("div",{className:"sd-teacher-name",children:((R=A.personalInfo)==null?void 0:R.fullName)||"מורה לא ידוע"}),e.jsxs("div",{className:"sd-teacher-instrument",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:((E=A.professionalInfo)==null?void 0:E.instrument)||"כלי נגינה לא ידוע"})]})]})]}),D.length>0&&e.jsx("div",{className:"sd-teacher-badge",children:e.jsxs("span",{children:[D.length," שיעורים"]})})]}),D.length>0&&e.jsxs("div",{className:"sd-teacher-lessons",children:[e.jsxs("div",{className:"sd-lessons-header",children:[e.jsx($e,{size:12}),e.jsx("span",{children:"מערכת שיעורים"})]}),e.jsx("div",{className:"sd-lessons-list",children:D.map((k,I)=>e.jsxs("div",{className:"sd-lesson-item",children:[e.jsx("div",{className:"sd-lesson-day",children:k.day}),e.jsxs("div",{className:"sd-lesson-time",children:[e.jsx(Ve,{size:10}),e.jsx("span",{children:C(k.time,k.duration)})]}),e.jsxs("div",{className:"sd-lesson-duration",children:[k.duration,"ד'"]})]},`assignment-${I}`))})]})]},`teacher-${_}-${A._id}`)})}):e.jsx("div",{className:"sd-empty-state",children:e.jsx("p",{children:"לא נמצאו מורים לתלמיד זה"})})})]})}function g$({student:t,orchestras:s,orchestrasLoading:n,isOpen:i,onToggle:l,onOrchestraClick:c}){const u=x.useRef(!1),[f,p]=x.useState([]),[m,g]=x.useState({}),v=x.useMemo(()=>{var b;return t?[...((b=t.enrollments)==null?void 0:b.orchestraIds)||[]].filter(w=>w):[]},[t]),j=v.length>0;x.useEffect(()=>{if(v.length>0&&s.length===0&&!n&&!u.current){const b=v.map(w=>({_id:w,name:`תזמורת ${w.slice(-4)}`,type:"",conductorId:"",memberIds:[],rehearsalIds:[],schoolYearId:"",location:"",isActive:!0}));p(b),u.current=!0}},[v,s.length,n]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{(async()=>{if(s.length===0)return;const w={};for(const C of s)if(C.conductorId&&!m[C.conductorId])try{const T=await Jt.getTeacherById(C.conductorId);T&&(w[C.conductorId]=T.personalInfo.fullName)}catch(T){console.error(`Error loading conductor ${C.conductorId}:`,T),w[C.conductorId]="מנצח לא ידוע"}Object.keys(w).length>0&&g(C=>({...C,...w}))})()},[s,m]);const N=v.length>0&&s.length===0&&!n&&f.length>0;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:["תזמורות/הרכב ",j?`(${v.length})`:""]}),i?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:n?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען נתוני תזמורת..."})]}):j?N?e.jsx("div",{className:"sd-orchestras-swiper",children:f.map(b=>e.jsxs("div",{className:"sd-orchestra-compact-card clickable sd-orchestra-placeholder",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"sd-orchestra-card-header",children:[e.jsx("div",{className:"sd-orchestra-card-icon",children:e.jsx(ms,{size:16})}),e.jsxs("div",{className:"sd-orchestra-card-info",children:[e.jsx("div",{className:"sd-orchestra-card-title",children:b.name}),e.jsx("div",{className:"sd-orchestra-card-type",children:"טוען..."})]})]}),e.jsx("div",{className:"sd-orchestra-card-details",children:e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(Yt,{size:12,className:"spin"}),e.jsx("span",{children:"טוען פרטים..."})]})})]},b._id))}):e.jsx("div",{className:"sd-orchestras-swiper",children:s.map(b=>e.jsxs("div",{className:"sd-orchestra-compact-card clickable",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"sd-orchestra-card-header",children:[e.jsx("div",{className:"sd-orchestra-card-icon",children:e.jsx(ms,{size:16})}),e.jsxs("div",{className:"sd-orchestra-card-info",children:[e.jsx("div",{className:"sd-orchestra-card-title",children:b.name}),b.type&&e.jsx("div",{className:"sd-orchestra-card-type",children:b.type})]})]}),e.jsxs("div",{className:"sd-orchestra-card-details",children:[b.memberIds&&b.memberIds.length>0&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(ps,{size:12}),e.jsxs("span",{children:[b.memberIds.length," משתתפים"]})]}),b.rehearsalIds&&b.rehearsalIds.length>0&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx($e,{size:12}),e.jsxs("span",{children:[b.rehearsalIds.length," חזרות"]})]}),b.location&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:b.location})]}),b.conductorId&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(We,{size:12}),e.jsxs("span",{children:["מנצח: ",m[b.conductorId]||"טוען..."]})]}),e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:b.isActive?"פעיל":"לא פעיל"})]})]})]},b._id))}):e.jsx("div",{className:"sd-empty-state",children:"התלמיד אינו משתתף בתזמורות"})})]})}function y$({student:t,isOpen:s,onToggle:n,formatDate:i,updateStudentTest:l,isUpdatingTest:c=!1,getStageColor:u}){const[f,p]=x.useState(null),[m,g]=x.useState(null),[v,j]=x.useState(!1),N=[{value:"לא נבחן",label:"לא נבחן"},{value:"עבר/ה",label:"עבר/ה"},{value:"לא עבר/ה",label:"לא עבר/ה"},{value:"עבר/ה בהצטיינות",label:"עבר/ה בהצטיינות"},{value:"עבר/ה בהצטיינות יתרה",label:"עבר/ה בהצטיינות יתרה"}];if(x.useEffect(()=>{let _;return v&&(_=window.setTimeout(()=>{j(!1)},5e3)),()=>{_&&clearTimeout(_)}},[v]),!t||!t.academicInfo)return null;const b=(_,D)=>{c||(f&&f.instrumentName===_&&f.testType===D?p(null):p({instrumentName:_,testType:D}))},w=async(_,D,S)=>{var k,I;if(c)return;const R=t.academicInfo.instrumentProgress.find(M=>M.instrumentName===_);if(!R)return;const E=((I=(k=R.tests)==null?void 0:k[D])==null?void 0:I.status)||"לא נבחן";if(E===S){p(null);return}p(null);try{g({instrumentName:_,testType:D,oldStatus:E,newStatus:S,timestamp:Date.now()}),j(!0),await l(_,D,S),console.log(`Updated ${D} for ${_} to ${S}`)}catch(M){console.error(`Failed to update ${D} for ${_}:`,M)}},C=async()=>{if(!(!m||c))try{await l(m.instrumentName,m.testType,m.oldStatus),console.log(`Undid update for ${m.testType} for ${m.instrumentName}, restored to ${m.oldStatus}`),g(null),j(!1)}catch(_){console.error("Failed to undo test update:",_)}},T=_=>_==="עבר/ה בהצטיינות יתרה"?"var(--success-emphasis)":_==="עבר/ה בהצטיינות"||_==="עבר/ה"?"var(--success)":_==="לא עבר/ה"?"var(--danger)":"var(--text-muted)",A=_=>_==="לא נבחן"?"not-tested":_==="לא עבר/ה"?"failed":_==="עבר/ה בהצטיינות יתרה"?"excellent-plus":_==="עבר/ה בהצטיינות"?"excellent":"passed";return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(ms,{size:16}),e.jsx("span",{children:"מבחנים"}),s?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsxs("div",{className:"sd-section-content",children:[c&&e.jsxs("div",{className:"sd-updating-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"מעדכן נתונים..."})]}),e.jsx("div",{className:"sd-tests-grid",children:t.academicInfo.instrumentProgress.map(_=>{var D,S,R,E,k,I,M,z,Z,ee,W,K,Q,ne,X,se,O,B,L,Y,H,P,q,F;return e.jsxs("div",{className:"sd-instrument-test-card",children:[e.jsxs("div",{className:"sd-instrument-test-header",children:[e.jsx("h3",{children:_.instrumentName}),e.jsxs("div",{className:"sd-stage-badge",style:{backgroundColor:u(_.currentStage)},children:["שלב ",_.currentStage]})]}),e.jsxs("div",{className:"sd-test-items",children:[e.jsxs("div",{className:"sd-test-item",children:[e.jsxs("div",{className:"sd-test-item-content",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן טכני:"}),e.jsxs("div",{className:"sd-test-value-container",children:[e.jsx("span",{className:`sd-test-value sd-clickable ${c?"disabled":""} ${A(((S=(D=_.tests)==null?void 0:D.technicalTest)==null?void 0:S.status)||"לא נבחן")}`,style:{color:T(((E=(R=_.tests)==null?void 0:R.technicalTest)==null?void 0:E.status)||"לא נבחן")},onClick:()=>b(_.instrumentName,"technicalTest"),children:((I=(k=_.tests)==null?void 0:k.technicalTest)==null?void 0:I.status)||"לא נבחן"}),!c&&f&&f.instrumentName===_.instrumentName&&f.testType==="technicalTest"&&e.jsx("div",{className:"sd-test-dropdown",children:N.map(te=>{var ae,oe,ce,G;return e.jsxs("div",{className:`sd-dropdown-item ${(((oe=(ae=_.tests)==null?void 0:ae.technicalTest)==null?void 0:oe.status)||"לא נבחן")===te.value?"selected":""}`,onClick:()=>w(_.instrumentName,"technicalTest",te.value),children:[(((G=(ce=_.tests)==null?void 0:ce.technicalTest)==null?void 0:G.status)||"לא נבחן")===te.value&&e.jsx(ms,{size:12}),te.label]},te.value)})})]})]}),((z=(M=_.tests)==null?void 0:M.technicalTest)==null?void 0:z.lastTestDate)&&e.jsxs("div",{className:"sd-test-date",children:[e.jsx($e,{size:12}),e.jsx("span",{children:i(_.tests.technicalTest.lastTestDate)})]})]}),e.jsxs("div",{className:"sd-test-item",children:[e.jsxs("div",{className:"sd-test-item-content",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן שלב:"}),e.jsxs("div",{className:"sd-test-value-container",children:[e.jsx("span",{className:`sd-test-value sd-clickable ${c?"disabled":""} ${A(((ee=(Z=_.tests)==null?void 0:Z.stageTest)==null?void 0:ee.status)||"לא נבחן")}`,style:{color:T(((K=(W=_.tests)==null?void 0:W.stageTest)==null?void 0:K.status)||"לא נבחן")},onClick:()=>b(_.instrumentName,"stageTest"),children:((ne=(Q=_.tests)==null?void 0:Q.stageTest)==null?void 0:ne.status)||"לא נבחן"}),!c&&f&&f.instrumentName===_.instrumentName&&f.testType==="stageTest"&&e.jsx("div",{className:"sd-test-dropdown",children:N.map(te=>{var ae,oe,ce,G;return e.jsxs("div",{className:`sd-dropdown-item ${(((oe=(ae=_.tests)==null?void 0:ae.stageTest)==null?void 0:oe.status)||"לא נבחן")===te.value?"selected":""}`,onClick:()=>w(_.instrumentName,"stageTest",te.value),children:[(((G=(ce=_.tests)==null?void 0:ce.stageTest)==null?void 0:G.status)||"לא נבחן")===te.value&&e.jsx(ms,{size:12}),te.label]},te.value)})})]})]}),((se=(X=_.tests)==null?void 0:X.stageTest)==null?void 0:se.lastTestDate)&&e.jsxs("div",{className:"sd-test-date",children:[e.jsx($e,{size:12}),e.jsx("span",{children:i(_.tests.stageTest.lastTestDate)})]})]})]}),(((B=(O=_.tests)==null?void 0:O.stageTest)==null?void 0:B.notes)||((Y=(L=_.tests)==null?void 0:L.technicalTest)==null?void 0:Y.notes))&&e.jsx("div",{className:"sd-notes-row",children:e.jsx("span",{className:"sd-notes-text",children:((P=(H=_.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||((F=(q=_.tests)==null?void 0:q.technicalTest)==null?void 0:F.notes)})})]},_.instrumentName)})})]}),v&&m&&e.jsxs("div",{className:"sd-undo-toast",children:[e.jsx("span",{children:m.newStatus}),e.jsxs("button",{className:"sd-undo-btn",onClick:C,children:[e.jsx(Uo,{size:14}),e.jsx("span",{children:"ביטול"})]})]})]})}const v$=()=>({playingSkills:{grade:"לא הוערך",points:null,maxPoints:20,comments:"אין הערות"},musicalUnderstanding:{grade:"לא הוערך",points:null,maxPoints:40,comments:"אין הערות"},textKnowledge:{grade:"לא הוערך",points:null,maxPoints:30,comments:"אין הערות"},playingByHeart:{grade:"לא הוערך",points:null,maxPoints:10,comments:"אין הערות"}}),x$=t=>{const s=(t.playingSkills.points||0)+(t.musicalUnderstanding.points||0)+(t.textKnowledge.points||0)+(t.playingByHeart.points||0);return Math.min(s,100)},St={async getBagruts(t={}){return ge.get("bagrut",t)},async getBagrutById(t){return ge.get(`bagrut/${t}`)},async getBagrutByStudentId(t){var s;try{return await ge.get(`bagrut/student/${t}`)}catch(n){if(((s=n.response)==null?void 0:s.status)===404)return null;throw n}},async createBagrut(t){return ge.post("bagrut",t)},async updatePresentation(t,s,n){return ge.put(`bagrut/${t}/presentation/${s}`,n)},async updateMagenBagrut(t,s){return ge.put(`bagrut/${t}/magenBagrut`,s)},async updateGradingDetails(t,s){return ge.put(`bagrut/${t}/gradingDetails`,s)},async calculateFinalGrade(t){return ge.put(`bagrut/${t}/calculateFinalGrade`,{})},async completeBagrut(t,s){const n=s?{teacherSignature:s}:{};return ge.put(`bagrut/${t}/complete`,n)},async addProgramPiece(t,s){return ge.post(`bagrut/${t}/program`,s)},async updateProgramPiece(t,s,n){return ge.put(`bagrut/${t}/program/${s}`,n)},async updateProgram(t,s){return ge.put(`bagrut/${t}/program`,{program:s})},async removeProgramPiece(t,s){return ge.delete(`bagrut/${t}/program/${s}`)},async addAccompanist(t,s){return ge.post(`bagrut/${t}/accompanist`,s)},async removeAccompanist(t,s){return ge.delete(`bagrut/${t}/accompanist/${s}`)},async uploadDocument(t,s,n){const i=new FormData;return i.append("document",s),n&&i.append("title",n),ge.post(`bagrut/${t}/document`,i)},async removeDocument(t,s){return ge.delete(`bagrut/${t}/document/${s}`)},async updateBagrut(t,s){return ge.put(`bagrut/${t}`,s)},async deleteBagrut(t){return ge.delete(`bagrut/${t}`)}};function j$({student:t,isOpen:s,onToggle:n,formatDate:i}){var R,E,k,I,M,z,Z;const[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState(null),g=Ot(),{addToast:v}=It(),j=((E=(R=t.academicInfo)==null?void 0:R.tests)==null?void 0:E.bagrutId)!==null&&((I=(k=t.academicInfo)==null?void 0:k.tests)==null?void 0:I.bagrutId)!==void 0;x.useEffect(()=>{var ee,W;s&&j&&((W=(ee=t.academicInfo)==null?void 0:ee.tests)!=null&&W.bagrutId)&&N()},[s,j,(z=(M=t.academicInfo)==null?void 0:M.tests)==null?void 0:z.bagrutId]);const N=async()=>{var ee,W;if((W=(ee=t.academicInfo)==null?void 0:ee.tests)!=null&&W.bagrutId){f(!0),m(null);try{const K=await St.getBagrutById(t.academicInfo.tests.bagrutId);c(K)}catch(K){console.error("Failed to load bagrut:",K),m("שגיאה בטעינת נתוני הבגרות");try{const Q=await St.getBagrutByStudentId(t._id);c(Q),m(null)}catch(Q){console.error("Fallback bagrut lookup failed:",Q)}}finally{f(!1)}}},b=()=>{if(C()<5){v({type:"warning",message:"רק תלמידים בשלב 5 ומעלה יכולים ליצור בגרות",autoCloseTime:4e3});return}g(`/bagrut/new?studentId=${t._id}`)},w=()=>{var ee,W;j&&((W=(ee=t.academicInfo)==null?void 0:ee.tests)!=null&&W.bagrutId)?g(`/bagrut/${t.academicInfo.tests.bagrutId}`):l&&g(`/bagrut/${l._id}`)},C=()=>{var K,Q;if(t.academicInfo.currentStage)return typeof t.academicInfo.currentStage=="number"?t.academicInfo.currentStage:parseInt(t.academicInfo.currentStage)||0;const ee=(K=t.academicInfo.instrumentProgress)==null?void 0:K.find(ne=>ne.isPrimary);if(ee!=null&&ee.currentStage)return ee.currentStage;const W=(Q=t.academicInfo.instrumentProgress)==null?void 0:Q[0];return(W==null?void 0:W.currentStage)||0},T=()=>{var K;if(!l)return null;if(l.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const ee=(l.presentations||[]).filter(Q=>Q.completed).length,W=((K=l.magenBagrut)==null?void 0:K.completed)||!1;return ee>0||W?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},A=C(),_=A>=5,D=T(),S=D==null?void 0:D.icon;return e.jsxs("section",{className:"info-section",children:[e.jsxs("div",{className:"section-header",onClick:n,children:[e.jsxs("div",{className:"header-content",children:[e.jsx(ms,{size:20}),e.jsx("h3",{children:"בגרות במוזיקה"}),j&&e.jsx("div",{className:"status-indicator",children:D&&S&&e.jsxs(e.Fragment,{children:[e.jsx(S,{size:16,style:{color:D.color}}),e.jsx("span",{style:{color:D.color},children:D.text})]})})]}),e.jsx("div",{className:"section-controls",children:s?e.jsx(Ft,{size:20}):e.jsx(gt,{size:20})})]}),s&&e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"eligibility-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"שלב נוכחי:"}),e.jsxs("span",{className:`value ${_?"eligible":"not-eligible"}`,children:[A," ",_?"(זכאי לבגרות)":"(לא זכאי לבגרות)"]})]}),!_&&e.jsxs("div",{className:"warning-message",children:[e.jsx(Us,{size:16}),e.jsx("span",{children:"רק תלמידים בשלב 5 ומעלה יכולים ליצור בגרות"})]})]}),e.jsx("div",{className:"bagrut-connection",children:j?e.jsxs("div",{className:"has-bagrut",children:[e.jsxs("div",{className:"connection-info",children:[e.jsx(Et,{size:16,style:{color:"var(--success)"}}),e.jsx("span",{children:"לתלמיד יש בגרות במערכת"})]}),u?e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{size:16,className:"spinning"}),e.jsx("span",{children:"טוען נתוני בגרות..."})]}):p?e.jsxs("div",{className:"error-state",children:[e.jsx(Us,{size:16,style:{color:"var(--danger)"}}),e.jsx("span",{children:p}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:N,children:"נסה שוב"})]}):l?e.jsxs("div",{className:"bagrut-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"label",children:"קונסרבטוריון:"}),e.jsx("span",{className:"value",children:l.conservatoryName||"לא צוין"})]}),l.testDate&&e.jsxs("div",{className:"summary-row",children:[e.jsx($e,{size:14}),e.jsx("span",{className:"label",children:"מועד מבחן:"}),e.jsx("span",{className:"value",children:new Date(l.testDate).toLocaleDateString("he-IL")})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"label",children:"התקדמות:"}),e.jsxs("span",{className:"value",children:[(l.presentations||[]).filter(ee=>ee.completed).length+((Z=l.magenBagrut)!=null&&Z.completed?1:0),"/5 השמעות"]})]}),l.finalGrade&&e.jsxs("div",{className:"summary-row",children:[e.jsx(ms,{size:14}),e.jsx("span",{className:"label",children:"ציון סופי:"}),e.jsxs("span",{className:"value",children:[l.finalGrade," (",l.finalGradeLevel,")"]})]})]}):null,e.jsx("div",{className:"action-buttons",children:e.jsxs("button",{className:"btn btn-primary",onClick:w,disabled:u,children:[e.jsx(ba,{size:16}),"צפה בבגרות"]})})]}):e.jsxs("div",{className:"no-bagrut",children:[e.jsxs("div",{className:"connection-info",children:[e.jsx(Us,{size:16,style:{color:"var(--text-muted)"}}),e.jsx("span",{children:"לתלמיד אין בגרות במערכת"})]}),_&&e.jsx("div",{className:"action-buttons",children:e.jsxs("button",{className:"btn btn-primary",onClick:b,children:[e.jsx(ls,{size:16}),"צור בגרות חדשה"]})})]})})]})]})}function b$({student:t,attendanceStats:s,loadingAttendance:n,isOpen:i,onToggle:l,formatDate:c}){var u,f,p;return t?e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx($e,{size:16}),e.jsx("span",{children:"נוכחות"}),i?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:(((f=(u=t.academicInfo)==null?void 0:u.orchestraIds)==null?void 0:f.length)||0)>0?e.jsx("div",{className:"sd-attendance-container",children:n?e.jsxs("div",{className:"sd-loading-attendance",children:[e.jsx(Yt,{size:16,className:"sd-loading-icon"}),e.jsx("span",{children:"טוען נתוני נוכחות..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sd-attendance-summary",children:[e.jsxs("div",{className:"sd-attendance-stat",children:[e.jsx("span",{className:"sd-stat-label",children:"שיעור נוכחות"}),e.jsxs("div",{className:"sd-attendance-rate",children:[Math.round(s.attendanceRate),"%"]})]}),e.jsxs("div",{className:"sd-attendance-stat",children:[e.jsx("span",{className:"sd-stat-label",children:"נוכח"}),e.jsxs("div",{className:"sd-attendance-count",children:[s.attended," /"," ",s.totalRehearsals]})]})]}),((p=s.recentHistory)==null?void 0:p.length)>0?e.jsxs("div",{className:"sd-attendance-history",children:[e.jsx("h3",{className:"sd-history-title",children:"היסטוריית נוכחות אחרונה"}),e.jsx("div",{className:"sd-history-entries",children:s.recentHistory.map((m,g)=>e.jsxs("div",{className:"sd-history-entry",children:[e.jsx("div",{className:`sd-status-indicator ${m.status==="הגיע/ה"?"present":"absent"}`}),e.jsx("span",{className:"sd-history-date",children:c(m.date)}),e.jsx("span",{className:`sd-history-status ${m.status==="הגיע/ה"?"present":"absent"}`,children:m.status})]},g))})]}):e.jsx("div",{className:"sd-no-attendance-history",children:"אין היסטוריית נוכחות זמינה"}),s.message&&e.jsx("div",{className:"sd-attendance-message sd-warning",children:s.message})]}):e.jsx("div",{className:"sd-no-attendance-data",children:"אין נתוני נוכחות זמינים"})}):e.jsx("div",{className:"sd-no-orchestra-warning",children:"אין נתוני נוכחות עבור תלמיד שאינו משתתף בתזמורות"})})]}):null}function N$({student:t,theoryLessons:s,theoryLessonsLoading:n,isOpen:i,onToggle:l,onTheoryLessonClick:c}){var w;const u=x.useRef(!1),[f,p]=x.useState([]),[m,g]=x.useState({}),v=t&&((w=t.enrollments)!=null&&w.theoryLessonIds)?t.enrollments.theoryLessonIds.filter(C=>C):[],j=v.length>0;x.useEffect(()=>{if(v.length>0&&s.length===0&&!n&&!u.current){const C=v.map(T=>({_id:T,category:"שיעור העשרה",isPlaceholder:!0}));p(C),u.current=!0}},[v,s.length,n]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{async function C(){if(!s||s.length===0)return;const T=[...new Set(s.map(A=>A.teacherId))];if(T.length!==0)try{const A=await Jt.getTeachersByIds(T),_={};A.forEach(D=>{var S;D&&D._id&&((S=D.personalInfo)!=null&&S.fullName)&&(_[D._id]=D.personalInfo.fullName)}),g(_)}catch(A){console.error("Failed to load teacher names for theory lessons:",A)}}C()},[s]);const N=v.length>0&&s.length===0&&!n&&f.length>0,b=(C,T,A)=>`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][C]||"לא ידוע"} ${T}-${A}`;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Vt,{size:16}),e.jsxs("span",{children:["שיעורי העשרה ",j?`(${s.reduce((T,A)=>{const _=`${A.category}-${A.teacherId}-${A.dayOfWeek}-${A.startTime}-${A.endTime}-${A.location}`;return T.add(_),T},new Set).size})`:""]}),i?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:n?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען שיעורי העשרה..."})]}):j?N?e.jsx("div",{className:"sd-theory-lessons-grid",children:f.map(C=>e.jsxs("div",{className:"sd-theory-lesson-card clickable sd-theory-lesson-placeholder",onClick:()=>c(C._id),children:[e.jsx(Vt,{size:20}),e.jsx("span",{children:C.category})]},C._id))}):e.jsx("div",{className:"sd-theory-lessons-swiper",children:(()=>{const C=s.reduce((T,A)=>{const _=`${A.category}-${A.teacherId}-${A.dayOfWeek}-${A.startTime}-${A.endTime}-${A.location}`;return T[_]||(T[_]={category:A.category,teacherId:A.teacherId,teacherName:m[A.teacherId]||"לא ידוע",dayOfWeek:A.dayOfWeek,startTime:A.startTime,endTime:A.endTime,location:A.location,lessonCount:0,lessons:[]}),T[_].lessonCount++,T[_].lessons.push(A),T},{});return Object.values(C).map((T,A)=>e.jsxs("div",{className:"sd-theory-lesson-compact-card clickable",onClick:()=>c(T.lessons[0]._id),children:[e.jsxs("div",{className:"sd-theory-card-header",children:[e.jsx("div",{className:"sd-theory-card-icon",children:e.jsx(Vt,{size:16})}),e.jsxs("div",{className:"sd-theory-card-info",children:[e.jsx("div",{className:"sd-theory-card-title",children:T.category}),e.jsxs("div",{className:"sd-theory-card-count",children:[T.lessonCount," מפגשים"]})]})]}),e.jsxs("div",{className:"sd-theory-card-details",children:[e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(We,{size:12}),e.jsx("span",{children:T.teacherName})]}),T.dayOfWeek!==void 0&&T.startTime&&T.endTime&&e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:b(T.dayOfWeek,T.startTime,T.endTime)})]}),T.location&&e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:T.location})]})]})]},`theory-group-${A}`))})()}):e.jsx("div",{className:"sd-empty-state",children:"התלמיד אינו משתתף בשיעורי העשרה"})})]})}const um=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];function S$({student:t,isOpen:s,onToggle:n,onEditSchedule:i}){const{teachers:l,loadTeachers:c}=Ds(),[u,f]=x.useState([]),[p,m]=x.useState(new Date);x.useEffect(()=>{if(t!=null&&t.teacherIds&&l.length>0){const b=[];t.teacherAssignments&&t.teacherAssignments.forEach((w,C)=>{var S,R;const T=l.find(E=>E._id===w.teacherId),A=((S=T==null?void 0:T.personalInfo)==null?void 0:S.fullName)||"מורה לא ידוע",_=(R=T==null?void 0:T.professionalInfo)==null?void 0:R.instrument,D=w.isActive===!1?"cancelled":"active";b.push({id:w.scheduleSlotId||`lesson-${C}`,teacherId:w.teacherId,teacherName:A,instrument:_,day:w.day,startTime:w.time,endTime:g(w.time,w.duration),duration:w.duration,location:w.location,timeBlockId:w.scheduleSlotId,status:D,notes:w.notes})}),b.sort((w,C)=>{const T=um.indexOf(w.day),A=um.indexOf(C.day);return T!==A?T-A:w.startTime.localeCompare(C.startTime)}),f(b)}},[t,l]),x.useEffect(()=>{var b;((b=t==null?void 0:t.teacherIds)==null?void 0:b.length)>0&&l.length===0&&c()},[t==null?void 0:t.teacherIds,l.length,c]);const g=(b,w)=>{const[C,T]=b.split(":").map(Number),A=C*60+T+w,_=Math.floor(A/60),D=A%60;return`${_.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`},v=u.reduce((b,w)=>(b[w.day]||(b[w.day]=[]),b[w.day].push(w),b),{}),j=u.filter(b=>b.status==="active"),N={totalLessons:j.length,totalWeeklyMinutes:j.reduce((b,w)=>b+w.duration,0),uniqueTeachers:new Set(j.map(b=>b.teacherId)).size,daysWithLessons:Object.keys(v).length};return e.jsxs("div",{className:"sd-section lesson-schedule-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx($e,{size:16}),e.jsxs("span",{children:["מערכת שיעורים"," ",N.totalLessons>0&&`(${N.totalLessons})`]}),s?e.jsx(Ft,{size:18,className:"sd-toggle-icon"}):e.jsx(gt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsx("div",{className:"sd-section-content",children:u.length===0?e.jsxs("div",{className:"empty-schedule-state",children:[e.jsx($e,{size:48,color:"#ffc107"}),e.jsxs("div",{className:"empty-content",children:[e.jsx("h4",{children:"אין שיעורים מתוכננים"}),e.jsx("p",{children:"התלמיד עדיין לא שויך לשיעורים במערכת"}),i&&e.jsxs("button",{className:"add-lessons-btn",onClick:i,children:[e.jsx(ls,{size:16}),"הוסף שיעורים"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx($e,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.totalLessons}),e.jsx("span",{className:"stat-label",children:"שיעורים בשבוע"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.totalWeeklyMinutes}),e.jsx("span",{className:"stat-label",children:"דקות בשבוע"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(We,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.uniqueTeachers}),e.jsx("span",{className:"stat-label",children:"מורים"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Et,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.daysWithLessons}),e.jsx("span",{className:"stat-label",children:"ימים עם שיעורים"})]})]})]}),e.jsxs("div",{className:"weekly-schedule",children:[e.jsx("h4",{children:"מערכת שבועית"}),Object.keys(v).length===0?e.jsx("div",{className:"no-schedule-days",children:e.jsx("p",{children:"אין שיעורים מתוכננים השבוע"})}):e.jsx("div",{className:"schedule-grid",children:um.filter(b=>(v[b]||[]).length>0).map(b=>{const w=v[b]||[];return e.jsxs("div",{className:"day-column has-lessons",children:[e.jsxs("div",{className:"day-header",children:[e.jsx("span",{className:"day-name",children:b}),e.jsx("span",{className:"lessons-count",children:w.length})]}),e.jsx("div",{className:"day-lessons",children:w.map(C=>e.jsxs("div",{className:`lesson-slot ${C.status}`,children:[e.jsxs("div",{className:"lesson-time",children:[e.jsx(Ve,{size:12}),e.jsxs("span",{children:[C.startTime," - ",C.endTime]})]}),e.jsxs("div",{className:"lesson-teacher",children:[e.jsx(We,{size:12}),e.jsx("span",{children:C.teacherName})]}),C.instrument&&e.jsx("div",{className:"lesson-instrument",children:e.jsx("span",{children:C.instrument})}),C.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:C.location})]}),e.jsxs("div",{className:"lesson-duration",children:[C.duration," דקות"]}),e.jsxs("div",{className:`lesson-status ${C.status}`,children:[C.status==="active"&&e.jsx(Et,{size:12}),C.status==="cancelled"&&e.jsx(Us,{size:12}),e.jsxs("span",{children:[C.status==="active"&&"פעיל",C.status==="cancelled"&&"מבוטל",C.status==="completed"&&"הושלם"]})]})]},C.id))})]},b)})})]}),e.jsxs("div",{className:"section-footer",children:[e.jsx("div",{className:"last-updated",children:e.jsxs("span",{children:["עודכן לאחרונה: ",p.toLocaleString("he-IL")]})}),i&&e.jsxs("button",{className:"edit-schedule-btn",onClick:i,children:[e.jsx(Sa,{size:14}),"ערוך מערכת שיעורים"]})]})]})})]})}function Dj(){var K,Q;const{student:t,isLoading:s,error:n,flipped:i,toggleFlip:l,goBack:c,getInitials:u,getStageColor:f,primaryInstrument:p,openSections:m,toggleSection:g,formatDate:v,navigateToTeacher:j,navigateToOrchestra:N,navigateToTheoryLesson:b,navigateToStudentEdit:w,teachersData:C,teachersLoading:T,teachersError:A,orchestras:_,orchestrasLoading:D,theoryLessons:S,theoryLessonsLoading:R,retryLoadTeachers:E,updateStudentTest:k,isUpdatingTest:I,updateStudentStage:M,isUpdatingStage:z}=u$(),{user:Z}=vs(),ee=!!(Z&&(Z.roles.includes("מנהל")||Z.roles.includes("מורה")&&((K=t==null?void 0:t.teacherIds)!=null&&K.includes(Z._id))));if(s)return e.jsxs("div",{className:"sd-loading-state",children:[e.jsx(Yt,{className:"sd-loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי תלמיד..."})]});if(n||!t)return e.jsxs("div",{className:"sd-error-state",children:[e.jsx("p",{children:n||"לא ניתן לטעון את פרטי התלמיד"}),e.jsx("button",{onClick:c,className:"btn primary",children:"חזרה לרשימת התלמידים"})]});const W=t.teacherIds||[];return e.jsx("div",{className:"student-details-content",children:e.jsx("div",{className:"student-details-page",children:e.jsx("div",{className:"student-card-container",children:e.jsxs("div",{className:`sd-card-content ${i?"flipped":""}`,children:[e.jsxs("div",{className:"sd-card-side sd-card-front",children:[e.jsxs("div",{className:"sd-card-header",children:[e.jsxs("div",{className:"sd-student-identity",children:[e.jsx("div",{className:"sd-avatar sd-avatar-clickable",style:{backgroundColor:p?f(p.currentStage):"#4158d0"},children:u(t.personalInfo.fullName)}),e.jsxs("div",{className:"sd-header-text",children:[e.jsx("h1",{className:"sd-student-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"sd-instrument",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:p.instrumentName})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{size:14}),e.jsx("span",{children:"תלמיד"})]})})]})]}),e.jsxs("div",{className:"sd-header-badges",children:[e.jsxs("div",{className:"sd-class-badge",children:["כיתה ",t.academicInfo.class]}),e.jsx("button",{className:"sd-back-button",onClick:c,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})})]})]}),e.jsxs("div",{className:"sd-card-scroll-area",children:[((Q=t.academicInfo.instrumentProgress)==null?void 0:Q.length)>0&&e.jsx(h$,{student:t,isOpen:m.instruments,onToggle:()=>g("instruments"),getStageColor:f,updateStudentStage:M,isUpdatingStage:z,canEditStage:ee}),e.jsx(p$,{teachersData:C,teachersLoading:T,teachersError:A,isOpen:m.teachers,onToggle:()=>g("teachers"),onTeacherClick:j,onRetryLoadTeachers:E,studentTeacherIds:W,teacherAssignments:t.teacherAssignments||[]}),e.jsx(S$,{student:t,isOpen:m.schedule,onToggle:()=>g("schedule"),onEditSchedule:w}),e.jsx(g$,{student:t,orchestras:_,orchestrasLoading:D,isOpen:m.orchestras,onToggle:()=>g("orchestras"),onOrchestraClick:N}),e.jsx(y$,{student:t,isOpen:m.tests,onToggle:()=>g("tests"),formatDate:v,updateStudentTest:k,isUpdatingTest:I,getStageColor:f}),e.jsx(j$,{student:t,isOpen:m.bagrut,onToggle:()=>g("bagrut"),formatDate:v}),e.jsx(b$,{student:t,attendanceStats:null,loadingAttendance:!1,isOpen:m.attendance,onToggle:()=>g("attendance"),formatDate:v}),e.jsx(N$,{student:t,theoryLessons:S,theoryLessonsLoading:R,isOpen:m.theoryLessons,onToggle:()=>g("theoryLessons"),onTheoryLessonClick:b})]}),e.jsxs("button",{className:"sd-flip-button",onClick:l,children:[e.jsx("span",{children:"הצג פרטים אישיים"}),e.jsx(Bs,{size:14})]})]}),e.jsxs("div",{className:"sd-card-side sd-card-back",children:[e.jsxs("div",{className:"sd-card-header",children:[e.jsxs("div",{className:"sd-student-identity",children:[e.jsx("div",{className:"sd-avatar sd-avatar-clickable",style:{backgroundColor:p?f(p.currentStage):"#4158d0"},children:u(t.personalInfo.fullName)}),e.jsxs("div",{className:"sd-header-text",children:[e.jsx("h1",{className:"sd-student-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"sd-instrument",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:p.instrumentName})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{size:14}),e.jsx("span",{children:"תלמיד"})]})})]})]}),e.jsxs("div",{className:"sd-header-badges",children:[e.jsxs("div",{className:"sd-class-badge",children:["כיתה ",t.academicInfo.class]}),e.jsx("button",{className:"sd-back-button",onClick:c,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})})]})]}),e.jsxs("div",{className:"sd-card-scroll-area",children:[e.jsx(f$,{student:t,isOpen:m.personalInfo,onToggle:()=>g("personalInfo"),formatDate:v}),e.jsx(m$,{student:t,isOpen:m.parentInfo,onToggle:()=>g("parentInfo")})]}),e.jsxs("button",{className:"sd-flip-button",onClick:l,children:[e.jsx("span",{children:"הצג מידע לימודי"}),e.jsx(Bs,{size:14})]})]})]})})})})}const w$=t=>{let s=t.replace(/\D/g,"");return s.startsWith("0")&&(s=`972${s.substring(1)}`),s},T$=(t,s="")=>{const n=w$(t),i=encodeURIComponent(s),l=`https://wa.me/${n}?text=${i}`;window.open(l,"_blank")};function E$({teacher:t,onView:s,onEdit:n,onRemove:i,studentCount:l,authContext:c}){var N,b,w,C;if(!t||!t.personalInfo)return console.error("TeacherPreview: Invalid teacher data",t),null;const u=c?Sr(c):null,f=T=>T?T.split(" ").map(A=>A[0]).join("").toUpperCase().substring(0,2):"NA",p=T=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545",מגמה:"#FF6B35"})[T]||"#6c757d",m=T=>T===0?"אין תלמידים":T===1?"תלמיד אחד":`${T} תלמידים`,g=(T,A)=>{T.stopPropagation(),T$(A)},v=l!==void 0?l:((b=(N=t.teaching)==null?void 0:N.studentIds)==null?void 0:b.length)||0,j=t.roles&&t.roles.length>0?t.roles[0]:"מורה";return e.jsxs("div",{className:"teacher-preview",onClick:()=>s(t._id),style:{cursor:"pointer"},children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsx("div",{className:"badges-container",children:t.roles&&t.roles.map(T=>e.jsx("div",{className:"role-badge",style:{backgroundColor:p(T)},children:e.jsx("span",{children:T})},T))}),e.jsxs("div",{className:"teacher-header-container",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:p(j)},children:f(t.personalInfo.fullName)})}),e.jsxs("div",{className:"teacher-info",children:[e.jsx("h3",{className:"teacher-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"teacher-subject",children:(w=t.professionalInfo)!=null&&w.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:t.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(pr,{size:14}),e.jsx("span",{children:j})]})})]})]})]})}),e.jsx("div",{className:"preview-content",children:e.jsxs("div",{className:"info-row",children:[t.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:16}),e.jsx("span",{className:"clickable-phone",onClick:T=>t.personalInfo.phone&&g(T,t.personalInfo.phone),title:"לחץ לפתיחת שיחה בוואטסאפ",children:t.personalInfo.phone})]}),t.personalInfo.email&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:16}),e.jsx("span",{children:t.personalInfo.email})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(ps,{size:16}),e.jsx("span",{children:m(v)})]}),((C=t.conducting)==null?void 0:C.orchestraIds)&&t.conducting.orchestraIds.length>0&&e.jsxs("div",{className:"info-item",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:t.conducting.orchestraIds.length===1?"מנצח על תזמורת אחת":`מנצח על ${t.conducting.orchestraIds.length} תזמורות`})]})]})}),e.jsxs("div",{className:"preview-footer",children:[e.jsx("div",{className:"action-buttons",children:(()=>{const T=(u==null?void 0:u.getTeacherActionPermissions(t))||{showEditButton:!0,showDeleteButton:!0};return e.jsxs(e.Fragment,{children:[T.showEditButton&&e.jsx("button",{className:"action-btn edit",onClick:A=>{A.stopPropagation(),n(t._id)},"aria-label":"ערוך מורה",children:e.jsx(Sa,{size:20})}),T.showDeleteButton&&i&&e.jsx("button",{className:"action-btn delete",onClick:A=>{A.stopPropagation(),i(t._id)},"aria-label":"מחק מורה",children:e.jsx(_t,{size:20})})]})})()}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(t.createdAt||Date.now()).toLocaleDateString("he-IL")})]})]})]})}function C$({teachers:t,isLoading:s,onEdit:n,onView:i,onRemove:l,authContext:c}){const[u,f]=x.useState({}),[p,m]=x.useState(!1);x.useEffect(()=>{t.length>0&&!p&&g()},[t,p]);const g=async()=>{try{console.log("Loading student counts for teachers...");const v=await ot.getStudents();console.log("Total students loaded for count calculation:",v.length);const j={};t.forEach(N=>{const b=v.filter(w=>{const C=w.teacherIds&&w.teacherIds.includes(N._id),T=w.teacherAssignments&&w.teacherAssignments.some(A=>A.teacherId===N._id);return C||T}).length;j[N._id]=b,b>0&&console.log(`Teacher ${N.personalInfo.fullName}: ${b} students`)}),f(j),m(!0)}catch(v){console.error("Failed to load student counts:",v)}};return Array.isArray(t)?s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען מורים..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו מורים להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף מורים חדשים"})]}):e.jsx("div",{className:"teacher-grid",children:t.filter(v=>v&&v._id&&v.personalInfo).map(v=>e.jsx(E$,{teacher:v,onEdit:n,onView:i||n,onRemove:l,studentCount:u[v._id]||0,authContext:c},v._id))}):(console.error("Expected teachers to be an array but got:",typeof t,t),e.jsx("div",{className:"error-state",children:"שגיאה בטעינת נתונים"}))}const A$=({initialStudentIds:t=[],onStudentIdsChange:s,onAddScheduleItem:n,onRemoveScheduleItem:i})=>{const[l,c]=x.useState([]),[u,f]=x.useState([]),[p,m]=x.useState(!1),[g,v]=x.useState(!1),[j,N]=x.useState("");x.useEffect(()=>{(async()=>{m(!0);try{const _=await ot.getStudents({isActive:!0});console.log(`Loaded ${_.length} students for selection`),c(_)}catch(_){console.error("Failed to load students:",_)}finally{m(!1)}})()},[]),x.useEffect(()=>{(async()=>{if(t.length>0){console.log("Loading selected students for IDs:",t),m(!0);try{const _=await ot.getStudentsByIds(t);console.log("Loaded selected students:",_),f(_)}catch(_){console.error("Failed to load selected students:",_)}finally{m(!1)}}else f([])})()},[t]);const b=x.useCallback(A=>{N(A)},[]),w=x.useCallback(()=>j.trim()?l.filter(A=>u.some(D=>D._id===A._id)?!1:[A.personalInfo.fullName,A.academicInfo.instrument,A.academicInfo.class].some(D=>(D==null?void 0:D.toLowerCase().includes(j.toLowerCase()))||!1)).slice(0,10):[],[j,l,u]),C=x.useCallback(A=>{if(u.some(D=>D._id===A._id)){console.log(`Student ${A._id} already selected, skipping`);return}console.log(`🎯 Adding student ${A._id} (${A.personalInfo.fullName}) to teacher selection`),f(D=>[...D,A]);const _=[...u.map(D=>D._id),A._id];s(_),console.log(`📅 Creating schedule item for student ${A._id}`),n(A._id),console.log("✅ Student assignment complete - IDs now:",_),N(""),v(!1)},[u,s,n]),T=x.useCallback(A=>{console.log(`🔄 Removing student ${A} from selection`);const _=u.filter(S=>S._id!==A);f(_);const D=_.map(S=>S._id);console.log("📋 Updated student IDs after removal:",D),s(D),console.log(`🗑️ Removing schedule for student ${A}`),i(A),console.log(`✅ Student ${A} removal completed`)},[u,s,i]);return{students:l,selectedStudents:u,loadingStudents:p,showStudentSearch:g,searchQuery:j,setShowStudentSearch:v,handleStudentSearch:b,getFilteredStudents:w,handleAddStudent:C,handleRemoveStudent:T}};function D$({isOpen:t,onClose:s,duplicateInfo:n,onConfirm:i,onCancel:l,isAdmin:c=!1,isSubmitting:u=!1}){const[f,p]=x.useState(!1),[m,g]=x.useState("");if(!t)return null;const v=A=>{switch(A){case"CRITICAL":return e.jsx(Us,{className:"text-red-600",size:20});case"HIGH":return e.jsx(yr,{className:"text-orange-600",size:20});case"MEDIUM":return e.jsx($o,{className:"text-yellow-600",size:20});case"LOW":return e.jsx(Et,{className:"text-blue-600",size:20});default:return e.jsx($o,{className:"text-gray-600",size:20})}},j=A=>{switch(A){case"CRITICAL":return"border-red-500 bg-red-50";case"HIGH":return"border-orange-500 bg-orange-50";case"MEDIUM":return"border-yellow-500 bg-yellow-50";case"LOW":return"border-blue-500 bg-blue-50";default:return"border-gray-500 bg-gray-50"}},N=A=>{switch(A){case"fullName":return e.jsx(We,{size:16});case"phone":return e.jsx(fi,{size:16});case"email":return e.jsx(On,{size:16});case"address":return e.jsx(vt,{size:16});default:return e.jsx($o,{size:16})}},b=A=>{switch(A){case"fullName":return"שם מלא";case"phone":return"טלפון";case"email":return'דוא"ל';case"address":return"כתובת";default:return A}},w=(A,_)=>e.jsxs("div",{className:`duplicate-match ${j(A.severity)}`,children:[e.jsxs("div",{className:"match-header",children:[e.jsxs("div",{className:"severity-info",children:[v(A.severity),e.jsx("span",{className:"severity-label",children:A.severity})]}),e.jsx("div",{className:"match-message",children:A.message})]}),e.jsxs("div",{className:"conflicting-fields",children:[e.jsx("span",{className:"fields-label",children:"שדות מתנגשים:"}),e.jsx("div",{className:"fields-list",children:A.conflictingFields.map((D,S)=>e.jsxs("div",{className:"field-item",children:[N(D),e.jsx("span",{children:b(D)})]},S))})]}),A.note&&e.jsxs("div",{className:"match-note",children:[e.jsx($o,{size:14}),e.jsx("span",{children:A.note})]}),A.matches&&A.matches.length>0&&e.jsxs("div",{className:"existing-matches",children:[e.jsx("span",{className:"matches-label",children:"מורים קיימים:"}),A.matches.map((D,S)=>{var R,E,k;return e.jsxs("div",{className:"existing-teacher",children:[e.jsx(We,{size:14}),e.jsx("span",{children:((R=D.personalInfo)==null?void 0:R.fullName)||"לא מצוין"}),e.jsxs("span",{className:"teacher-details",children:[(E=D.personalInfo)==null?void 0:E.phone," | ",(k=D.personalInfo)==null?void 0:k.email]})]},S)})]})]},_),C=()=>{c&&f?i(!0):n.blocked||i(!1)},T=()=>{m.trim()&&i(!0)};return e.jsxs("div",{className:"duplicate-confirmation-modal",children:[e.jsx("div",{className:"modal-overlay",onClick:s}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"זיהוי כפילויות"}),e.jsx("button",{className:"close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(yt,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"duplicate-summary",children:[e.jsx("div",{className:"summary-icon",children:n.blocked?e.jsx(Us,{className:"text-red-600",size:24}):e.jsx(yr,{className:"text-orange-600",size:24})}),e.jsxs("div",{className:"summary-text",children:[e.jsx("h3",{children:n.blocked?"יצירה חסומה":"אזהרת כפילות"}),e.jsx("p",{children:n.reason})]})]}),n.duplicates&&n.duplicates.length>0&&e.jsxs("div",{className:"duplicates-section",children:[e.jsx("h4",{children:"כפילויות זוהו:"}),n.duplicates.map((A,_)=>w(A,_))]}),n.warnings&&n.warnings.length>0&&e.jsxs("div",{className:"warnings-section",children:[e.jsx("h4",{children:"אזהרות:"}),n.warnings.map((A,_)=>w(A,_))]}),c&&n.blocked&&e.jsxs("div",{className:"admin-override-section",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx(j0,{className:"text-blue-600",size:20}),e.jsx("span",{children:"עקיפת מנהל"})]}),f?e.jsxs("div",{className:"override-form",children:[e.jsx("label",{htmlFor:"override-reason",children:"סיבה לעקיפה:"}),e.jsx("textarea",{id:"override-reason",value:m,onChange:A=>g(A.target.value),placeholder:"הסבר מדוע יש צורך ליצור מורה זה למרות הכפילות...",rows:3,disabled:u}),e.jsxs("div",{className:"override-actions",children:[e.jsx("button",{className:"btn danger",onClick:T,disabled:!m.trim()||u,children:u?"יוצר...":"עקוף ויצור"}),e.jsx("button",{className:"btn secondary",onClick:()=>p(!1),disabled:u,children:"ביטול"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>p(!0),disabled:u,children:"הצג אפשרויות מנהל"})]})]}),e.jsx("div",{className:"modal-footer",children:n.blocked&&!f?e.jsxs("div",{className:"blocked-actions",children:[e.jsx("button",{className:"btn secondary",onClick:l,disabled:u,children:"חזור לעריכה"}),e.jsx("button",{className:"btn secondary",onClick:s,disabled:u,children:"ביטול"})]}):e.jsxs("div",{className:"warning-actions",children:[e.jsx("button",{className:"btn primary",onClick:C,disabled:u,children:u?"יוצר...":"המשך בכל זאת"}),e.jsx("button",{className:"btn secondary",onClick:l,disabled:u,children:"חזור לעריכה"})]})})]})]})}const sN=["הרכב","תזמורת"],br=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26"],aN=t=>["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][t],Fm=[{value:0,label:"יום ראשון"},{value:1,label:"יום שני"},{value:2,label:"יום שלישי"},{value:3,label:"יום רביעי"},{value:4,label:"יום חמישי"},{value:5,label:"יום שישי"},{value:6,label:"יום שבת"}],k$=[{id:"day-selection",title:"בחירת יום",description:"בחר את הימים ליום הלימוד",component:"DaySelectionStep",isComplete:!1,isActive:!0},{id:"time-range",title:"טווח זמן",description:"הגדר את שעות תחילת וסיום יום הלימוד",component:"TimeRangeStep",isComplete:!1,isActive:!1},{id:"details",title:"פרטים נוספים",description:"מיקום, הערות והגדרות חזרה",component:"DetailsStep",isComplete:!1,isActive:!1},{id:"review",title:"סקירה",description:"בדוק את פרטי יום הלימוד לפני יצירה",component:"ReviewStep",isComplete:!1,isActive:!1}],nN=({teacherId:t,onBlockCreated:s,onCancel:n,initialData:i,isOpen:l=!0})=>{const c=!!i,{createTimeBlock:u,updateTimeBlock:f,isLoading:p,error:m,clearError:g,currentTeacherSchedule:v,loadTeacherSchedule:j}=kl(),[N,b]=x.useState({currentStep:0,steps:k$,formData:{day:(i==null?void 0:i.day)||Cn[0],startTime:(i==null?void 0:i.startTime)||"14:00",endTime:(i==null?void 0:i.endTime)||"18:00",location:(i==null?void 0:i.location)||"",notes:(i==null?void 0:i.notes)||"",isRecurring:(i==null?void 0:i.isRecurring)||!1,recurringDays:(i==null?void 0:i.recurringDays)||[]},validationErrors:{},isSubmitting:!1});if(!l)return null;const w=(E,k)=>{const[I,M]=E.split(":").map(Number),[z,Z]=k.split(":").map(Number),ee=I*60+M;return z*60+Z-ee},C=E=>{const k=Math.floor(E/60),I=E%60;return k===0?`${I} דקות`:k===1&&I===0?"שעה אחת":k===1?`שעה ו-${I} דקות`:I===0?`${k} שעות`:`${k} שעות ו-${I} דקות`},T=E=>{b(k=>({...k,formData:{...k.formData,...E},validationErrors:{}}))},A=E=>{const k={},{formData:I}=N;switch(E){case 0:I.day||(k.day="יש לבחור יום");break;case 1:if(I.startTime||(k.startTime="יש להזין שעת התחלה"),I.endTime||(k.endTime="יש להזין שעת סיום"),I.startTime&&I.endTime){const M=w(I.startTime,I.endTime);if(M<=0&&(k.timeRange="שעת הסיום חייבת להיות אחרי שעת ההתחלה"),M<30&&(k.timeRange="יום לימוד חייב להיות לפחות 30 דקות"),(!c||i&&(I.day!==i.day||I.startTime!==i.startTime||I.endTime!==i.endTime))&&(v!=null&&v.timeBlocks)&&v.timeBlocks.length>0){const Z={day:I.day,startTime:I.startTime,endTime:I.endTime,location:I.location,notes:I.notes},ee=c?v.timeBlocks.filter(K=>!(K.day===(i==null?void 0:i.day)&&K.startTime===(i==null?void 0:i.startTime)&&K.endTime===(i==null?void 0:i.endTime))):v.timeBlocks,W=$s.validateTimeBlockConflicts(Z,ee);if(W.hasConflict){const K=$s.getConflictDescription(W.conflictType,W.conflictingBlocks,Z);k.timeRange=K}}}break;case 3:if(!c&&I.isRecurring&&I.recurringDays.length>0&&(v!=null&&v.timeBlocks)&&v.timeBlocks.length>0){const M=[];for(const z of I.recurringDays){const Z={day:z,startTime:I.startTime,endTime:I.endTime,location:I.location,notes:I.notes};$s.validateTimeBlockConflicts(Z,v.timeBlocks).hasConflict&&M.push(z)}M.length>0&&(k.submit=`קיימות התנגשות בימים הבאים: ${M.join(", ")}. אנא בחר ימים אחרים או שנה את שעות יום הלימוד.`)}break}return b(M=>({...M,validationErrors:k})),Object.keys(k).length===0},_=()=>{if(A(N.currentStep)){const E=[...N.steps];E[N.currentStep].isComplete=!0,E[N.currentStep].isActive=!1,N.currentStep<E.length-1&&(E[N.currentStep+1].isActive=!0,b(k=>({...k,currentStep:k.currentStep+1,steps:E})))}},D=()=>{if(N.currentStep>0){const E=[...N.steps];E[N.currentStep].isActive=!1,E[N.currentStep-1].isActive=!0,E[N.currentStep-1].isComplete=!1,b(k=>({...k,currentStep:k.currentStep-1,steps:E}))}},S=async()=>{if(A(N.currentStep)){b(E=>({...E,isSubmitting:!0})),g();try{if(c&&(i!=null&&i._id)){const E={day:N.formData.day,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes},k=await f(i._id,E);k&&(s==null||s(k))}else if(N.formData.isRecurring&&N.formData.recurringDays.length>0){const E=[],k=[N.formData.day,...N.formData.recurringDays];console.log("🔄 Creating time blocks for all days:",{originalDay:N.formData.day,recurringDays:N.formData.recurringDays,allDaysToCreate:k});for(const I of k){const M={day:I,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes};console.log(`📅 Creating time block for day: ${I}`);const z=await u(t,M);z?(E.push(z),console.log(`✅ Time block created successfully for ${I}`)):console.error(`❌ Failed to create time block for ${I}`)}console.log(`🎉 Created ${E.length} time blocks total:`,E.map(I=>I.day)),E.length>0&&(s==null||s(E))}else{const E={day:N.formData.day,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes},k=await u(t,E);k&&(s==null||s(k))}}catch(E){console.error(`Failed to ${c?"update":"create"} time block:`,E),b(k=>({...k,validationErrors:{submit:String((E instanceof Error?E.message:E)||`שגיאה ב${c?"עדכון":"יצירת"} יום הלימוד`)}}))}finally{b(E=>({...E,isSubmitting:!1}))}}},R=()=>{const{currentStep:E,formData:k,validationErrors:I}=N;switch(E){case 0:return e.jsxs("div",{className:"day-selection-step",children:[e.jsx("h3",{children:"בחר יום ליום הלימוד"}),e.jsx("div",{className:"day-selector",children:Cn.map(M=>e.jsxs("button",{type:"button",className:`day-button ${k.day===M?"selected":""}`,onClick:()=>T({day:M}),children:[e.jsx($e,{className:"day-icon",size:20}),e.jsx("span",{children:M})]},M))}),I.day&&e.jsx("div",{className:"error-message",children:I.day})]});case 1:return e.jsxs("div",{className:"time-range-step",children:[e.jsx("h3",{children:"הגדר טווח זמן ליום הלימוד"}),(v==null?void 0:v.timeBlocks)&&(()=>{const M=v.timeBlocks.filter(z=>z.day===k.day&&z.isActive);return M.length>0?e.jsxs("div",{className:"existing-blocks-info",children:[e.jsxs("h4",{children:["ימי לימוד קיימים ביום ",k.day,":"]}),e.jsx("div",{className:"existing-blocks-list",children:M.map(z=>e.jsxs("div",{className:"existing-block-item",children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[z.startTime," - ",z.endTime]}),z.location&&e.jsxs("span",{children:["(",z.location,")"]})]},z._id))})]}):null})(),e.jsxs("div",{className:"time-inputs",children:[e.jsxs("div",{className:"time-input-group",children:[e.jsxs("label",{children:[e.jsx(Ve,{size:16}),"שעת התחלה"]}),e.jsx("input",{type:"time",value:k.startTime,onChange:M=>T({startTime:M.target.value}),className:`time-input ${I.startTime?"error":""}`}),I.startTime&&e.jsx("div",{className:"field-error",children:I.startTime})]}),e.jsx("div",{className:"time-separator",children:"-"}),e.jsxs("div",{className:"time-input-group",children:[e.jsxs("label",{children:[e.jsx(Ve,{size:16}),"שעת סיום"]}),e.jsx("input",{type:"time",value:k.endTime,onChange:M=>T({endTime:M.target.value}),className:`time-input ${I.endTime?"error":""}`}),I.endTime&&e.jsx("div",{className:"field-error",children:I.endTime})]})]}),k.startTime&&k.endTime&&e.jsx("div",{className:"duration-info",children:e.jsxs("div",{className:"duration-display",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:C(w(k.startTime,k.endTime))})]})}),I.timeRange&&e.jsx("div",{className:"error-message",children:I.timeRange})]});case 2:return e.jsxs("div",{className:"details-step",children:[e.jsx("h3",{children:"פרטים נוספים"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(vt,{size:16}),"מיקום (אופציונלי)"]}),e.jsxs("select",{value:k.location||"",onChange:M=>T({location:M.target.value}),className:"select-input",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),br.map(M=>e.jsx("option",{value:M,children:M},M))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"הערות (אופציונלי)"}),e.jsx("textarea",{value:k.notes||"",onChange:M=>T({notes:M.target.value}),placeholder:"הערות נוספות על יום הלימוד...",className:"textarea-input",rows:3})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"recurring-toggle",children:e.jsxs("label",{className:"recurring-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.isRecurring,onChange:M=>T({isRecurring:M.target.checked}),className:"recurring-checkbox"}),e.jsx("div",{className:"recurring-checkbox-custom",children:e.jsx(AT,{size:16})}),e.jsxs("div",{className:"recurring-text",children:[e.jsx("span",{className:"recurring-title",children:"שכפול לימים נוספים"}),e.jsx("span",{className:"recurring-description",children:"צור יום לימוד זהה בימים אחרים בשבוع"})]})]})}),k.isRecurring&&e.jsxs("div",{className:"recurring-days",children:[e.jsx("h4",{children:"בחר ימים נוספים:"}),e.jsx("div",{className:"recurring-day-selector",children:Cn.filter(M=>M!==k.day).map(M=>e.jsxs("label",{className:"day-checkbox",children:[e.jsx("input",{type:"checkbox",checked:k.recurringDays.includes(M),onChange:z=>{const Z=z.target.checked?[...k.recurringDays,M]:k.recurringDays.filter(ee=>ee!==M);T({recurringDays:Z})}}),e.jsx("span",{className:"checkbox-label",children:M})]},M))})]})]})]});case 3:return e.jsxs("div",{className:"review-step",children:[e.jsx("h3",{children:"סקירה לפני יצירה"}),e.jsxs("div",{className:"review-summary",children:[e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"זמן ומיקום"}),e.jsxs("div",{className:"summary-item",children:[e.jsx($e,{size:16}),e.jsx("span",{children:k.day})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Ve,{size:16}),e.jsxs("span",{children:[k.startTime," - ",k.endTime]}),e.jsxs("span",{children:["(",C(w(k.startTime,k.endTime)),")"]})]}),k.location&&e.jsxs("div",{className:"summary-item",children:[e.jsx(vt,{size:16}),e.jsx("span",{children:k.location})]})]}),k.isRecurring&&k.recurringDays.length>0&&e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"כל הימים שייווצרו"}),e.jsxs("div",{className:"recurring-days-list",children:[e.jsxs("span",{className:"recurring-day-tag original-day",children:[k.day," (מקורי)"]},k.day),k.recurringDays.map(M=>e.jsx("span",{className:"recurring-day-tag",children:M},M))]}),e.jsxs("div",{className:"total-days-info",children:['📅 סה"כ ייווצרו ',k.recurringDays.length+1," ימי לימוד"]})]}),k.notes&&e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"הערות"}),e.jsx("div",{className:"summary-item",children:e.jsx("span",{children:k.notes})})]})]}),I.submit&&e.jsx("div",{className:"error-message",children:I.submit})]});default:return null}};return e.jsx("div",{className:"time-block-creator-overlay",children:e.jsxs("div",{className:"time-block-creator",children:[e.jsxs("div",{className:"creator-header",children:[e.jsx("h2",{children:c?"עריכת יום לימוד":"יצירת יום לימוד חדש"}),e.jsx("button",{type:"button",className:"btn-icon close-btn",onClick:n,disabled:N.isSubmitting,"aria-label":"סגור",children:e.jsx(yt,{size:20})})]}),m&&e.jsxs("div",{className:"error-banner",children:[e.jsx("span",{children:m}),e.jsx("button",{type:"button",onClick:g,children:"×"})]}),e.jsx("div",{className:"wizard-progress",children:N.steps.map((E,k)=>e.jsxs("div",{className:`progress-step ${E.isActive?"active":""} ${E.isComplete?"completed":""}`,children:[e.jsx("div",{className:"step-indicator",children:E.isComplete?e.jsx(Bo,{size:16}):k+1}),e.jsxs("div",{className:"step-info",children:[e.jsx("div",{className:"step-title",children:E.title}),e.jsx("div",{className:"step-description",children:E.description})]})]},E.id))}),e.jsx("div",{className:"wizard-content",children:e.jsx("div",{className:"wizard-step",children:R()})}),e.jsxs("div",{className:"wizard-navigation",children:[e.jsx("button",{type:"button",className:"nav-btn prev-btn",onClick:D,disabled:N.currentStep===0||N.isSubmitting,children:"הקודם"}),N.currentStep<N.steps.length-1?e.jsx("button",{type:"button",className:"nav-btn next-btn",onClick:_,disabled:N.isSubmitting,children:"הבא"}):e.jsx("button",{type:"button",className:"nav-btn create-btn",onClick:S,disabled:N.isSubmitting||p,children:N.isSubmitting||p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner"}),c?"מעדכן...":"יוצר..."]}):c?"עדכן יום לימוד":N.formData.isRecurring&&N.formData.recurringDays.length>0?`צור ${N.formData.recurringDays.length+1} ימי לימוד`:"צור יום לימוד"})]})]})})};function rN({teacherId:t,teacherName:s,onTimeBlockChange:n}){var O;const{currentTeacherSchedule:i,selectedTimeBlock:l,isLoading:c,error:u,loadTeacherSchedule:f,createTimeBlock:p,updateTimeBlock:m,deleteTimeBlock:g,setSelectedTimeBlock:v,clearError:j}=kl(),{teachers:N}=Ds(),[b,w]=x.useState(!1),[C,T]=x.useState(null),[A,_]=x.useState(!1),[D,S]=x.useState(null),[R,E]=x.useState(new Set),[k,I]=x.useState(!1);x.useEffect(()=>{t&&f(t)},[t,f]),x.useEffect(()=>{var L,Y,H,P,q,F,te,ae,oe;const B=N.find(ce=>ce._id===t);if(B&&t){console.log("🔄 Teacher data changed, refreshing time block schedule...");const ce=((Y=(L=B.teaching)==null?void 0:L.studentIds)==null?void 0:Y.length)||0,G=((P=(H=B.teaching)==null?void 0:H.schedule)==null?void 0:P.length)||0,re=((F=(q=B.teaching)==null?void 0:q.timeBlocks)==null?void 0:F.length)||0,pe=((ae=(te=B.teaching)==null?void 0:te.timeBlocks)==null?void 0:ae.reduce((me,je)=>{var Oe;return me+(((Oe=je.assignedLessons)==null?void 0:Oe.length)||0)},0))||0;console.log("📊 Teacher-Student Sync Status:",{teacherId:t,teacherName:(oe=B.personalInfo)==null?void 0:oe.fullName,studentIds:ce,scheduleItems:G,timeBlocks:re,assignedLessons:pe,syncWorking:pe>0&&ce>0}),f(t)}},[N,t,s,f]),x.useEffect(()=>{i!=null&&i.timeBlocks&&n&&n(i.timeBlocks)},[i==null?void 0:i.timeBlocks,n]);const M=B=>{const L=Math.floor(B/60),Y=B%60;return L===0?`${Y} דקות`:L===1&&Y===0?"שעה אחת":L===1?`שעה ו-${Y} דקות`:Y===0?`${L} שעות`:`${L} שעות ו-${Y} דקות`};x.useEffect(()=>{j()},[j]),x.useEffect(()=>{const B=()=>{I(window.innerWidth<768)};return B(),window.addEventListener("resize",B),()=>{window.removeEventListener("resize",B)}},[]);const z=()=>{T(null),w(!0)},Z=B=>{T(B),w(!0)},ee=B=>{S(B),_(!0)},W=async()=>{if(D)try{await g(D._id),_(!1),S(null)}catch(B){console.error("Failed to delete time block:",B)}},K=B=>{console.log("Time block created successfully:",B),w(!1),T(null),f(t)},Q=()=>{if(!(i!=null&&i.timeBlocks))return{};const B={};return i.timeBlocks.forEach(L=>{B[L.day]||(B[L.day]=[]),B[L.day].push(L)}),Object.keys(B).forEach(L=>{B[L].sort((Y,H)=>Y.startTime.localeCompare(H.startTime))}),B},ne=B=>e.jsxs("div",{className:"lesson-assignment",children:[e.jsxs("div",{className:"assignment-info",children:[e.jsx("div",{className:"student-info",children:e.jsx("span",{children:B.studentName})}),e.jsx("div",{className:"assignment-time",children:e.jsxs("span",{children:[B.lessonStartTime," - ",B.lessonEndTime," (",M(B.duration),")"]})})]}),B.notes&&e.jsx("div",{className:"assignment-notes",title:B.notes,children:B.notes.length>30?`${B.notes.substring(0,30)}...`:B.notes})]},B._id),X=B=>{const L=R.has(B._id),Y=B.assignedLessons.length>0;return e.jsxs("div",{className:`time-block-card ${B.isActive?"":"inactive"}`,children:[e.jsx("div",{className:"card-day-header",children:e.jsx("h4",{children:B.day})}),e.jsxs("div",{className:"time-block-header",children:[e.jsx("div",{className:"block-time-info",children:e.jsxs("span",{children:[B.startTime," - ",B.endTime]})}),e.jsxs("div",{className:"block-actions",children:[e.jsx("button",{type:"button",className:"action-btn edit-btn",onClick:()=>Z(B),title:"ערוך יום לימוד",children:e.jsx(Fo,{size:14})}),e.jsx("button",{type:"button",className:"action-btn delete-btn",onClick:()=>ee(B),title:"מחק יום לימוד",children:e.jsx(_t,{size:14})})]})]}),B.location&&e.jsx("div",{className:"block-location",children:e.jsx("span",{children:B.location})}),L&&e.jsxs("div",{className:"block-details",children:[Y?e.jsxs("div",{className:"assigned-lessons",children:[e.jsx("h5",{children:"שיעורים מוקצים:"}),B.assignedLessons.map(ne)]}):e.jsx("div",{className:"no-assignments",children:e.jsx("span",{children:"אין שיעורים מוקצים"})}),B.notes&&e.jsxs("div",{className:"block-notes",children:[e.jsx("strong",{children:"הערות:"}),e.jsx("span",{children:B.notes})]})]})]},B._id)};Q();const se=((O=i==null?void 0:i.timeBlocks)==null?void 0:O.length)||0;return c&&!i?e.jsx("div",{className:"time-block-manager loading",children:e.jsx("span",{children:"טוען ימי לימוד..."})}):e.jsxs("div",{className:"teacher-time-block-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("div",{className:"header-info",children:e.jsxs("h3",{children:["ימי לימוד - ",s]})}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{type:"button",className:"btn primary",onClick:z,disabled:c,children:"הוסף יום לימוד"})})]}),u&&e.jsx("div",{className:"error-banner",children:e.jsx("span",{children:u})}),se===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h4",{children:"אין ימי לימוד"}),e.jsx("p",{children:"לא הוגדרו עדיין ימי לימוד עבור המורה הזה"}),e.jsx("button",{type:"button",className:"btn primary",onClick:z,children:"צור יום לימוד ראשון"})]}):e.jsx("div",{className:"time-blocks-container",children:i==null?void 0:i.timeBlocks.map(X)}),b&&e.jsx(nN,{teacherId:t,onBlockCreated:K,onCancel:()=>w(!1),initialData:C?{_id:C._id,day:C.day,startTime:C.startTime,endTime:C.endTime,location:C.location,notes:C.notes}:void 0,isOpen:b}),e.jsx(gs,{isOpen:A,onClose:()=>_(!1),onConfirm:W,title:"מחיקת יום לימוד",message:`האם אתה בטוח שברצונך למחוק את יום הלימוד ביום ${D==null?void 0:D.day} בשעה ${D==null?void 0:D.startTime}?`,confirmText:"מחק",cancelText:"ביטול",type:"danger"})]})}const iN=["מורה","מנצח","מדריך הרכב","מנהל","מורה תאוריה","מגמה"],_$=Cu,lN=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],O$=[30,45,60],kj=(t,s)=>Lm().when("roles",{is:n=>n&&Array.isArray(n)&&t.some(i=>n.includes(i)),then:()=>s,otherwise:()=>Lm().notRequired()}),I$=at().shape({studentId:Ae().required("קוד תלמיד הוא שדה חובה"),day:Ae().required("יום הוא שדה חובה").oneOf(lN,"יום לא תקין"),time:Ae().required("שעה היא שדה חובה").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט זמן לא תקין (HH:MM)"),duration:Pa().required("משך הוא שדה חובה").oneOf(O$,"משך שיעור לא תקין"),isActive:za().default(!0)}),$$=at().shape({personalInfo:at().shape({fullName:Ae().required("שם מלא הוא שדה חובה"),phone:Ae().required("טלפון הוא שדה חובה").matches(/^05\d{8}$/,"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)"),email:Ae().required('דוא"ל הוא שדה חובה').email('כתובת דוא"ל לא תקינה'),address:Ae().required("כתובת היא שדה חובה")}),roles:es().of(Ae().oneOf(iN)).min(1,"יש לבחור לפחות תפקיד אחד").required("תפקידים הם שדה חובה"),professionalInfo:at().shape({instrument:kj(["מורה","מורה תאוריה"],Ae().required("כלי נגינה הוא שדה חובה למורה").oneOf(Cu,"כלי נגינה לא תקין")),isActive:za().default(!0)}),teaching:at().shape({studentIds:es().of(Ae()),schedule:es().of(I$)}),conducting:at().shape({orchestraIds:kj(["מנצח"],es().of(Ae()))}),ensemblesIds:es().of(Ae()),schoolYears:es().of(at().shape({schoolYearId:Ae().required("קוד שנת לימוד הוא שדה חובה"),isActive:za().default(!0)})),credentials:at().when("_id",{is:t=>!t,then:()=>at().shape({email:Ae().required('דוא"ל הוא שדה חובה').email('כתובת דוא"ל לא תקינה')}),otherwise:()=>at()}),isActive:za().default(!0)}),_j={personalInfo:{fullName:"",phone:"",email:"",address:""},roles:["מורה"],professionalInfo:{instrument:"",isActive:!0},teaching:{studentIds:[],schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[],schoolYears:[],credentials:{email:""},isActive:!0};function R$({isOpen:t,onClose:s,teacher:n,onSave:i,onAddNewStudent:l,newlyCreatedStudent:c}){console.log("TeacherForm received teacher:",n||"none (new teacher)");const{modalProps:u,titleProps:f,descriptionProps:p}=Al({isOpen:t,onClose:s,modalId:"teacher-form",restoreFocusOnClose:!0}),[m,g]=x.useState("teacher_form"),[v,j]=x.useState(!1),[N,b]=x.useState([]),[w,C]=x.useState(!1),[T,A]=x.useState(!1),[_,D]=x.useState(null),[S,R]=x.useState(null),[E,k]=x.useState(!1),[I,M]=x.useState(null),[z,Z]=x.useState(!1),{saveTeacher:ee,isLoading:W}=Ds(),{currentSchoolYear:K}=na(),{addToast:Q,showError:ne}=It(),{user:X,isAuthenticated:se}=vs(),O=Cl(X,se),B=Sr(O),L=()=>B.isAdmin(),Y=()=>{R(null),k(!1),M(null),Z(!1)},H=async G=>{if(I){Z(G),k(!1);try{const re={...I,forceCreate:G,adminOverride:G&&L()};await ae(re)}catch(re){console.error("Error in duplicate confirmation:",re),ne(re)}}},P=()=>{Y()},q=!(n!=null&&n._id),F=()=>{g("teacher_form"),s()};x.useEffect(()=>{t&&g("teacher_form")},[t]);const te=x.useCallback(()=>{var G,re,pe,me,je,Oe,De,be,Te,Be;return n!=null&&n._id?{_id:n._id,personalInfo:{fullName:((G=n.personalInfo)==null?void 0:G.fullName)||"",phone:((re=n.personalInfo)==null?void 0:re.phone)||"",email:((pe=n.personalInfo)==null?void 0:pe.email)||"",address:((me=n.personalInfo)==null?void 0:me.address)||""},roles:n.roles||["מורה"],professionalInfo:{instrument:((je=n.professionalInfo)==null?void 0:je.instrument)||"",isActive:((Oe=n.professionalInfo)==null?void 0:Oe.isActive)!==!1},teaching:{studentIds:((De=n.teaching)==null?void 0:De.studentIds)||[],schedule:((be=n.teaching)==null?void 0:be.schedule)||[]},conducting:{orchestraIds:((Te=n.conducting)==null?void 0:Te.orchestraIds)||[]},ensemblesIds:n.ensemblesIds||[],schoolYears:n.schoolYears||[],credentials:{email:((Be=n.personalInfo)==null?void 0:Be.email)||""},isActive:n.isActive!==!1}:{..._j,credentials:{..._j.credentials,email:""},schoolYears:K?[{schoolYearId:K._id,isActive:!0}]:[]}},[n,K]);x.useEffect(()=>{const G=()=>{A(window.innerWidth<768)};return G(),window.addEventListener("resize",G),()=>{window.removeEventListener("resize",G)}},[]),x.useEffect(()=>{(async()=>{C(!0);try{const re=await Ra.getOrchestras({isActive:!0});b(re)}catch(re){console.error("Failed to load orchestras:",re)}finally{C(!1)}})()},[]);const ae=async G=>{var me,je,Oe,De,be,Te;const re=G._id;let pe;if(re?pe=await ee(G,re):pe=await ee(G),re)Q({type:"success",message:`המורה ${((me=G.personalInfo)==null?void 0:me.fullName)||"המורה"} עודכן בהצלחה`});else if(((je=pe.invitationInfo)==null?void 0:je.mode)==="DEFAULT_PASSWORD"){const Be=((Oe=pe.credentials)==null?void 0:Oe.email)||pe.personalInfo.email,V=pe.invitationInfo.defaultPassword;Q({type:"success",message:`מורה נוצר בהצלחה!
פרטי התחברות:
אימייל: ${Be}
סיסמה: ${V}
(המורה יידרש לשנות סיסמה בכניسה הראשונה)`,autoClose:!1})}else Q({type:"success",message:`הזמנה נשלחה בהצלחה ל-${((De=G.personalInfo)==null?void 0:De.email)||"המורה"}`});return Y(),re&&((Te=(be=G.teaching)==null?void 0:be.studentIds)==null?void 0:Te.length)>0&&console.log("🔄 Teacher updated with student assignments, will refresh time blocks in UI"),i&&i(),F(),pe},oe=async(G,{setSubmitting:re,setValues:pe})=>{var je,Oe,De;D(null),Y();try{G._id?B.validateAction("update",n,"teacher"):B.validateAction("add",void 0,"teacher")}catch(be){const Te=ts(be);D(Te.userMessage),re(!1);return}let me;try{q&&G.credentials.email!==G.personalInfo.email&&(G={...G,credentials:{...G.credentials,email:G.personalInfo.email}},pe(G,!1));const be=G._id;if(be)console.log("🔧 FIXED VERSION LOADED - Update path with _id:",be),console.log("👤 Current user ID:",X==null?void 0:X._id),console.log("👤 Current user roles:",X==null?void 0:X.roles),console.log("🎯 Target teacher ID:",be),console.log("🛡️ Is admin:",L()),console.log("🛡️ Can edit teacher:",B.canEditTeacher({_id:be})),me={_id:be,personalInfo:G.personalInfo,roles:G.roles,professionalInfo:G.professionalInfo,isActive:G.isActive},G.teaching&&G.teaching.studentIds.length>0&&(me.teaching={studentIds:G.teaching.studentIds},G.teaching.schedule.length>0&&(me.teaching.schedule=G.teaching.schedule)),G.conducting&&G.conducting.orchestraIds.length>0&&(me.conducting={orchestraIds:G.conducting.orchestraIds}),G.ensemblesIds&&G.ensemblesIds.length>0&&(me.ensemblesIds=G.ensemblesIds);else{const{_id:Te,...Be}=G;me=Be}K&&!((je=me.schoolYears)!=null&&je.some(Te=>Te.schoolYearId===K._id))&&(me.schoolYears=[...me.schoolYears||[],{schoolYearId:K._id,isActive:!0}]),z&&(me.forceCreate=!0,me.adminOverride=L()),await ae(me)}catch(be){if(console.error("Error saving teacher:",be),((Oe=be==null?void 0:be.response)==null?void 0:Oe.status)===403||(be==null?void 0:be.status)===403){console.error("🚨 Permission denied error:",be),Q({type:"danger",message:"אין לך הרשאה לערוך מורה זה. רק מנהלים יכולים לערוך מורים אחרים, או שהמורה יכול לערוך את עצמו."});return}const Te=((De=be==null?void 0:be.response)==null?void 0:De.data)||be;if((Te==null?void 0:Te.code)==="DUPLICATE_TEACHER_DETECTED"&&(Te!=null&&Te.details)){const Be=Te.details;R({blocked:Be.blocked||!1,reason:Be.reason||"נמצאו כפילויות במערכת",duplicates:Be.duplicates||[],warnings:Be.warnings||Be.potentialDuplicates||[],canOverride:Be.canOverride||L(),adminOverride:Be.adminOverride||!1}),M(JSON.parse(JSON.stringify(me))),k(!0)}else ne(be),D(null)}finally{re(!1)}};if(!t)return null;const ce=()=>{switch(m){case"teacher_form":default:return e.jsxs("div",{className:"teacher-form-view",children:[e.jsxs("div",{className:"teacher-modal-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:F,"aria-label":"סגור",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...f,children:n!=null&&n._id?"עריכת מורה":"הוספת מורה חדש"})]}),_&&e.jsxs("div",{className:"api-error-banner",children:[e.jsxs("div",{className:"error-content",children:[e.jsx(Us,{size:16}),e.jsx("span",{children:_})]}),e.jsx("button",{type:"button",onClick:()=>D(null),className:"error-close-btn","aria-label":"סגור הודעת שגיאה",children:e.jsx(yt,{size:14})})]}),e.jsx(xr,{initialValues:te(),validationSchema:$$,onSubmit:oe,enableReinitialize:!0,validateOnMount:!1,children:({isSubmitting:G,values:re,setFieldValue:pe,errors:me,touched:je})=>{var Ne,_e,Ie,Ue,$t;const Oe=re.roles.includes("מנצח"),De=re.roles.includes("מורה")||re.roles.includes("מורה תאוריה"),{selectedStudents:be,getFilteredStudents:Te,handleAddStudent:Be,handleRemoveStudent:V}=A$({initialStudentIds:re.teaching.studentIds,onStudentIdsChange:qe=>{console.log("📝 Updating form studentIds:",qe),pe("teaching.studentIds",qe)},onAddScheduleItem:qe=>{const mt={studentId:qe,day:lN[0],time:"08:00",duration:45,isActive:!0};console.log("➕ Adding schedule item for student:",qe),pe("teaching.schedule",[...re.teaching.schedule,mt])},onRemoveScheduleItem:qe=>{const mt=re.teaching.schedule.filter(Rt=>Rt.studentId!==qe);console.log("🗑️ Removing schedule item for student:",qe),console.log("📋 Updated schedule items:",mt.length),pe("teaching.schedule",mt)}});x.useEffect(()=>{c&&(console.log("Adding newly created student:",c),Be(c))},[c]),Te();const ue=qe=>{console.log("🔄 Starting student removal process for:",qe),V(qe),setTimeout(()=>{ve(),console.log("✅ Student removal completed for:",qe)},100)};x.useEffect(()=>{q&&pe("credentials.email",re.personalInfo.email,!1)},[re.personalInfo.email,q,pe]);const ve=()=>q&&re.credentials.email!==re.personalInfo.email?(pe("credentials.email",re.personalInfo.email,!0),!1):!0;return e.jsxs($n,{children:[e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"פרטים אישיים"}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"שם מלא",name:"personalInfo.fullName",type:"text",required:!0,disabled:G})}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsx(Le,{label:"טלפון",name:"personalInfo.phone",type:"tel",placeholder:"05XXXXXXXX",required:!0,disabled:G}),e.jsx(Le,{label:'דוא"ל',name:"personalInfo.email",type:"email",required:!0,disabled:G})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"כתובת",name:"personalInfo.address",type:"text",required:!0,disabled:G})})]}),e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"תפקידים"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:me.roles&&je.roles?"required-field is-invalid":"required-field",children:["תפקידים ",!L()&&(n==null?void 0:n._id)&&e.jsx("span",{className:"readonly-indicator",children:"(צפייה בלבד)"})]}),e.jsx("div",{className:"checkbox-group",children:iN.map(qe=>e.jsxs("div",{className:"checkbox-item",children:[e.jsx("input",{type:"checkbox",id:`role-${qe}`,name:"roles",value:qe,checked:re.roles.includes(qe),onChange:mt=>{const{value:Rt,checked:Pt}=mt.target;let xt=[...re.roles];Pt?xt.includes(Rt)||xt.push(Rt):(xt=xt.filter(xi=>xi!==Rt),xt.length===0&&(xt=["מורה"])),pe("roles",xt)},disabled:G||!L()&&!!(n!=null&&n._id)}),e.jsx("label",{htmlFor:`role-${qe}`,children:qe})]},qe))}),me.roles&&je.roles&&e.jsx("div",{className:"form-error",children:me.roles})]})}),e.jsxs("div",{className:"form-row narrow-fields",children:[De&&e.jsxs(Le,{label:"כלי נגינה (למורה)",name:"professionalInfo.instrument",as:"select",required:De,disabled:G,children:[e.jsx("option",{value:"",disabled:!0,children:"בחר כלי נגינה"}),_$.map(qe=>e.jsx("option",{value:qe,children:qe},qe))]}),Oe&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orchestras",children:"תזמורות (למנצח)"}),e.jsx("select",{id:"orchestras",name:"conducting.orchestraIds",multiple:!0,value:re.conducting.orchestraIds,onChange:qe=>{const mt=Array.from(qe.target.selectedOptions).map(Rt=>Rt.value);pe("conducting.orchestraIds",mt)},className:(Ne=me.conducting)!=null&&Ne.orchestraIds&&((_e=je.conducting)!=null&&_e.orchestraIds)?"is-invalid":"",disabled:G||w,children:w?e.jsx("option",{disabled:!0,children:"טוען תזמורות..."}):N.length>0?N.map(qe=>e.jsx("option",{value:qe._id,children:qe.name},qe._id)):e.jsx("option",{disabled:!0,children:"אין תזמורות זמינות"})}),e.jsx("small",{className:"select-hint",children:T?"לחץ והחזק על מספר אפשרויות לבחירה מרובה":"ניתן לבחור מספר תזמורות (לחיצה על CTRL + לחיצה על תזמורת)"}),((Ie=me.conducting)==null?void 0:Ie.orchestraIds)&&((Ue=je.conducting)==null?void 0:Ue.orchestraIds)&&e.jsx("div",{className:"form-error",children:me.conducting.orchestraIds})]})]})]}),De&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"תלמידים"}),be.length>0?e.jsx("div",{className:"teacher-students-responsive-grid",children:be.map(qe=>{var Rt;const mt=(Rt=qe.teacherAssignments)==null?void 0:Rt.find(Pt=>Pt.teacherId===(n==null?void 0:n._id));return e.jsx("div",{className:"student-card-preview",children:e.jsxs("div",{className:"preview-header",children:[e.jsxs("div",{className:"student-info",children:[e.jsx("h4",{className:"student-name",children:qe.personalInfo.fullName}),e.jsx("div",{className:"student-lesson-details",children:mt?e.jsxs("span",{children:[mt.day," ",mt.time," | ",mt.duration," דקות"]}):e.jsx("span",{children:"לא מוקצה זמן שיעור"})})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{type:"button",className:"action-btn edit",onClick:Pt=>{Pt.stopPropagation(),window.location.href=`/students/${qe._id}`},"aria-label":"עדכן שיעור",disabled:G,children:e.jsx("span",{style:{display:"flex",width:"14px",height:"14px"},children:e.jsx(Sa,{size:14,style:{width:"14px",height:"14px",minWidth:"14px",minHeight:"14px"}})})}),e.jsx("button",{type:"button",className:"action-btn delete",onClick:Pt=>{Pt.stopPropagation(),ue(qe._id)},"aria-label":"מחק שיעור",disabled:G,children:e.jsx("span",{style:{display:"flex",width:"14px",height:"14px"},children:e.jsx(_t,{size:14,style:{width:"14px",height:"14px",minWidth:"14px",minHeight:"14px"}})})})]})]})},qe._id)})}):e.jsx("div",{className:"no-students-message",children:e.jsx("p",{children:"אין תלמידים מוקצים למורה זה"})})]}),(n==null?void 0:n._id)&&De&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"ימי לימוד"}),e.jsx("div",{className:"teacher-timeblocks-responsive-grid",children:e.jsx(rN,{teacherId:n._id,teacherName:(($t=n.personalInfo)==null?void 0:$t.fullName)||"מורה לא ידוע",onTimeBlockChange:qe=>{console.log("Time blocks updated:",qe)}})})]}),q&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"הזמנה למערכת"}),e.jsxs("div",{className:"invitation-info-card",children:[e.jsx("div",{className:"invitation-icon",children:e.jsx(On,{size:24})}),e.jsxs("div",{className:"invitation-content",children:[e.jsx("h4",{children:"הזמנה תישלח אוטומטית"}),e.jsxs("p",{children:['לאחר שמירת המורה, תישלח הזמנה אוטומטית לכתובת הדוא"ל ',e.jsx("strong",{children:re.personalInfo.email})]}),e.jsx("p",{children:"המורה יקבל קישור להגדרת סיסמה ויוכל להתחבר למערכת"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",onClick:()=>ve(),disabled:W||G,children:W||G?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:F,disabled:G,children:"ביטול"})]})]})}})]})}};return e.jsxs(Ta,{isOpen:t,onClose:F,className:"teacher-form responsive-form",children:[e.jsxs("div",{className:"form-modal",...u,children:[e.jsx("div",{...p,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי מורה קיים במערכת":"טופס הוספת מורה חדש למערכת"}),ce()]}),S&&e.jsx(D$,{isOpen:E,onClose:()=>k(!1),duplicateInfo:S,onConfirm:H,onCancel:P,isAdmin:L(),isSubmitting:W})]})}function M$(){const{teachers:t,isLoading:s,error:n,loadTeachers:i,removeTeacher:l,clearSelectedTeacher:c,setSelectedTeacher:u,selectedTeacher:f}=Ds(),p=Ot(),m=ys(),{user:g,isAuthenticated:v}=vs(),{addToast:j}=It(),[N,b]=x.useState(!1),[w,C]=x.useState(!1),[T,A]=x.useState(null),[_,D]=x.useState(!1),[S,R]=x.useState(null),[E,k]=x.useState(null),[I,M]=x.useState(null),[z,Z]=x.useState(!1),ee=x.useMemo(()=>je=>{var Oe;return[je.personalInfo.fullName,((Oe=je.professionalInfo)==null?void 0:Oe.instrument)||"",je.personalInfo.email||"",je.personalInfo.phone||""]},[]),W=x.useMemo(()=>t.filter(je=>je._id!==(g==null?void 0:g._id)),[t,g==null?void 0:g._id]),{filteredEntities:K,handleSearch:Q,filters:ne,handleApplyFilters:X,hasActiveFilters:se,availableInstruments:O}=bu(W,ee,je=>{var Oe;return((Oe=je.professionalInfo)==null?void 0:Oe.instrument)||""},void 0,void 0,je=>je.personalInfo.fullName),B=Cl(g,v),L=Sr(B);L.isAdmin();const Y=m.pathname.includes("/teachers/")&&!m.pathname.endsWith("/teachers/");x.useEffect(()=>{i()},[i]),x.useEffect(()=>{var je;console.log("Current selectedTeacher state in store:",f?(je=f.personalInfo)==null?void 0:je.fullName:"null")},[f]),x.useEffect(()=>{N||(console.log("Form closed, clearing teacher state"),A(null),c(),k(null))},[N,c]);const H=()=>{try{L.validateAction("add",void 0,"teacher"),console.log("Adding new teacher, clearing previous teacher data"),c(),A(null),k(null),b(!1),setTimeout(()=>{console.log("Opening empty teacher form"),b(!0)},10)}catch(je){const Oe=ts(je);j({type:"warning",message:Oe.userMessage,autoCloseTime:4e3})}},P=()=>{console.log("Closing teacher form"),b(!1)},q=je=>{je&&M({fullName:je.fullName,instrument:je.instrument}),C(!0)},F=()=>{C(!1),M(null)},te=je=>{k(je),C(!1),b(!0)},ae=je=>{var De;const Oe=t.find(be=>be._id===je)||null;if(Oe)try{L.validateAction("edit",Oe,"teacher"),console.log("Editing teacher:",(De=Oe==null?void 0:Oe.personalInfo)==null?void 0:De.fullName),A(Oe),u(Oe),b(!0)}catch(be){const Te=ts(be);j({type:"warning",message:Te.userMessage,autoCloseTime:4e3})}},oe=je=>{p(`/teachers/${je}`)},ce=je=>{const Oe=t.find(De=>De._id===je);if(Oe)try{L.validateAction("delete",Oe,"teacher"),R(je),D(!0)}catch(De){const be=ts(De);j({type:"warning",message:be.userMessage,autoCloseTime:4e3})}},G=async()=>{if(S)try{await l(S),R(null),D(!1),j({type:"success",message:"המורה נמחק בהצלחה",autoCloseTime:3e3})}catch(je){console.error("Failed to remove teacher:",je);const Oe=ts(je);j({type:"danger",message:Oe.userMessage,autoCloseTime:5e3})}},re=()=>{Z(!z)},pe=L.canAddTeacher(),me=()=>{console.log("Teacher saved successfully, cleaning up form state"),b(!1),A(null),k(null),i()};return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!Y&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(ic,{onSearch:Q,placeholder:"חיפוש מורים..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${se?"active":""}`,onClick:re,"aria-label":"סנן מורים",children:[e.jsx(hi,{className:"icon"}),se&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:z,onToggle:()=>Z(!z),onApplyFilters:X,availableInstruments:O,classRange:void 0,currentFilters:ne,hasActiveFilters:se,entityType:"teachers"})]}),pe&&e.jsx("button",{className:"btn-icon add-btn",onClick:H,"aria-label":"הוספת מורה חדש",children:e.jsx(ls,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!Y&&e.jsx(C$,{teachers:K,isLoading:s,onEdit:ae,onView:oe,onRemove:ce,authContext:B}),e.jsx(wl,{context:{loadTeachers:i}}),e.jsx(gs,{isOpen:_,onClose:()=>D(!1),onConfirm:G,title:"מחיקת מורה",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המורה?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),N&&e.jsx(R$,{isOpen:N,onClose:P,teacher:T||void 0,onSave:me,onAddNewStudent:q,newlyCreatedStudent:E}),e.jsx(eN,{isOpen:w,onClose:F,onStudentCreated:te,newTeacherInfo:I})]}),!Y&&!N&&e.jsx(mi,{})]})}function z$({teacher:t,theoryLessons:s,theoryLessonsLoading:n,isOpen:i,onToggle:l,onTheoryLessonClick:c}){const u=x.useRef(!1),[f,p]=x.useState([]),[m,g]=x.useState({}),v=s&&s.length>0;x.useEffect(()=>{if(!n&&!u.current&&!v){const b=Array(3).fill(null).map((w,C)=>({_id:`placeholder-${C}`,category:"שיעור העשרה",isPlaceholder:!0}));p(b),u.current=!0}},[s,n,v]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{async function b(){if(!s||s.length===0)return;const w={};s.forEach(C=>{var T;w[C._id]=((T=C.studentIds)==null?void 0:T.length)||0}),g(w)}b()},[s]);const j=!v&&!n&&f.length>0,N=(b,w,C)=>`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][b]||"לא ידוע"} ${w}-${C}`;return e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Vt,{size:16}),e.jsxs("span",{children:["שיעורי העשרה ",v?`(${s.length})`:""]}),i?e.jsx(Ft,{size:18,className:"td-toggle-icon"}):e.jsx(gt,{size:18,className:"td-toggle-icon"})]}),i&&e.jsx("div",{className:"td-section-content",children:n?e.jsxs("div",{className:"td-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען שיעורי העשרה..."})]}):!v&&j?e.jsx("div",{className:"td-theory-lessons-grid",children:f.map(b=>e.jsxs("div",{className:"td-theory-lesson-card td-theory-lesson-placeholder",children:[e.jsx(Vt,{size:20}),e.jsx("span",{children:b.category})]},b._id))}):v?e.jsx("div",{className:"td-theory-lessons-grid",children:s.map(b=>e.jsxs("div",{className:"td-theory-lesson-card clickable",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"td-theory-lesson-header",children:[e.jsx(Vt,{size:20}),e.jsx("span",{className:"td-theory-lesson-category",children:b.category})]}),e.jsxs("div",{className:"td-theory-lesson-details",children:[b.dayOfWeek!==void 0&&b.startTime&&b.endTime&&e.jsx("div",{className:"td-theory-lesson-schedule",children:e.jsx("span",{children:N(b.dayOfWeek,b.startTime,b.endTime)})}),b.location&&e.jsx("div",{className:"td-theory-lesson-location",children:e.jsxs("span",{children:["מיקום: ",b.location]})}),e.jsx("div",{className:"td-theory-lesson-students",children:e.jsxs("span",{children:["תלמידים: ",m[b._id]||0]})})]})]},b._id))}):e.jsx("div",{className:"td-empty-state",children:"המורה אינו מלמד שיעורי העשרה"})})]})}const L$=({teacherId:t,teacherName:s,onTimeBlockChange:n,readOnly:i=!1,className:l="",isAdmin:c=!1})=>{const{currentTeacherSchedule:u,selectedTimeBlock:f,isLoading:p,error:m,loadTeacherSchedule:g,createTimeBlock:v,updateTimeBlock:j,deleteTimeBlock:N,setSelectedTimeBlock:b,clearError:w}=kl(),[C,T]=x.useState(!1),[A,_]=x.useState(null),[D,S]=x.useState(!1),[R,E]=x.useState(null),[k,I]=x.useState("blocks"),[M,z]=x.useState(null);x.useEffect(()=>{!c&&k==="stats"&&I("blocks")},[c,k]),x.useEffect(()=>{t&&g(t)},[t,g]),x.useEffect(()=>{u!=null&&u.timeBlocks&&n&&n(u.timeBlocks)},[u==null?void 0:u.timeBlocks,n]);const Z=H=>{const P=Math.floor(H/60),q=H%60;return P===0?`${q} דקות`:P===1&&q===0?"שעה אחת":P===1?`שעה ו-${q} דקות`:q===0?`${P} שעות`:`${P} שעות ו-${q} דקות`};x.useEffect(()=>{w()},[w]);const ee=()=>{_(null),T(!0)},W=H=>{_(H),T(!0)},K=H=>{E(H),S(!0)},Q=async()=>{if(R)try{console.log("Attempting to delete time block:",R._id);const H=await N(R._id);console.log("Delete result:",H),S(!1),E(null),g(t)}catch(H){console.error("Failed to delete time block:",H),console.error("Delete error details:",{timeBlockId:R._id,error:H}),S(!1),E(null)}},ne=()=>{T(!1),_(null),g(t)},X=()=>{if(!(u!=null&&u.timeBlocks))return{};const H={};return u.timeBlocks.forEach(P=>{H[P.day]||(H[P.day]=[]),H[P.day].push(P)}),Object.keys(H).forEach(P=>{H[P].sort((q,F)=>q.startTime.localeCompare(F.startTime))}),H},se=H=>{if(H.totalDuration===0)return 0;const P=H.totalDuration-H.availableMinutes;return Math.round(P/H.totalDuration*100)},O=H=>e.jsxs("div",{className:"lesson-assignment",children:[e.jsxs("div",{className:"assignment-info",children:[e.jsxs("div",{className:"student-info",children:[e.jsx(We,{size:12}),e.jsx("span",{children:H.studentName})]}),e.jsxs("div",{className:"assignment-time",children:[e.jsx(Ve,{size:12}),e.jsxs("span",{children:[H.lessonStartTime," - ",H.lessonEndTime]}),e.jsxs("span",{className:"duration",children:["(",Z(H.duration),")"]})]})]}),H.notes&&e.jsx("div",{className:"assignment-notes",title:H.notes,children:H.notes.length>30?`${H.notes.substring(0,30)}...`:H.notes})]},H._id),B=H=>{const P=(f==null?void 0:f._id)===H._id,q=se(H),F=H.assignedLessons.length>0;return e.jsxs("div",{className:`time-block-card ${P?"selected":""} ${H.isActive?"":"inactive"}`,onClick:()=>b(H),children:[e.jsxs("div",{className:"time-block-header",children:[e.jsxs("div",{className:"block-time",children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[H.startTime," - ",H.endTime]}),e.jsxs("span",{className:"duration",children:["(",Z(H.totalDuration),")"]})]}),e.jsx("div",{className:"block-actions",children:!i&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"edit-btn",onClick:te=>{te.stopPropagation(),W(H)},title:"ערוך יום לימוד",children:e.jsx(Fo,{size:14})}),e.jsx("button",{type:"button",className:"delete-btn",onClick:te=>{te.stopPropagation(),K(H)},title:"מחק יום לימוד",children:e.jsx(_t,{size:14})})]})})]}),e.jsxs("div",{className:"utilization-bar",children:[e.jsx("div",{className:"utilization-fill",style:{width:`${q}%`}}),e.jsxs("span",{className:"utilization-text",children:[q,"% תפוסה"]})]}),H.location&&e.jsxs("div",{className:"block-location",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:H.location})]}),e.jsx("div",{className:"availability-info",children:e.jsxs("span",{className:"available-time",children:["זמין: ",Z(H.availableMinutes)]})}),F?e.jsxs("div",{className:"assigned-lessons",children:[e.jsx("h5",{children:"שיעורים מוקצים:"}),H.assignedLessons.map(O)]}):e.jsxs("div",{className:"no-assignments",children:[e.jsx(Et,{size:14,color:"green"}),e.jsx("span",{children:"אין שיעורים מוקצים"})]}),H.notes&&e.jsx("div",{className:"block-notes",title:H.notes,children:e.jsx("span",{children:H.notes.length>50?`${H.notes.substring(0,50)}...`:H.notes})})]},H._id)},L=()=>{const H=X(),P=Cn.filter(q=>(H[q]||[]).length>0);return e.jsx("div",{className:"time-blocks-view",children:P.length===0?e.jsx("div",{className:"no-working-days",children:e.jsxs("div",{className:"no-blocks-message",children:[e.jsx($e,{size:32}),e.jsx("h4",{children:"אין ימי לימוד"}),e.jsx("p",{children:"למורה זה אין ימי לימוד מוגדרים"})]})}):P.map(q=>{const F=H[q]||[];return e.jsxs("div",{className:"day-column",children:[e.jsxs("div",{className:"day-header",children:[e.jsx("h4",{children:q}),e.jsxs("span",{className:"block-count",children:["(",F.length,")"]}),!i&&e.jsx("button",{type:"button",className:"add-block-btn",onClick:()=>{z(q),ee()},title:"הוסף יום לימוד",children:e.jsx(ls,{size:14})})]}),e.jsx("div",{className:"day-blocks",children:F.map(B)})]},q)})})},Y=()=>{if(!u)return null;const{weeklyStats:H}=u;return e.jsx("div",{className:"stats-view",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ym,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:'סה"כ ימי לימוד'}),e.jsx("span",{className:"stat-value",children:H.totalTimeBlocks})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"זמן זמין (דקות)"}),e.jsx("span",{className:"stat-value",children:H.totalAvailableMinutes})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(We,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"זמן מוקצה (דקות)"}),e.jsx("span",{className:"stat-value",children:H.totalAssignedMinutes})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ll,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"אחוז ניצול"}),e.jsxs("span",{className:"stat-value",children:[H.utilizationPercentage,"%"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(mE,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"גודל יום לימוד ממוצע"}),e.jsx("span",{className:"stat-value",children:Z(Math.round(H.averageBlockSize))})]})]})]})})};return p?e.jsxs("div",{className:"time-block-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען ימי לימוד..."})]}):e.jsxs("div",{className:`teacher-time-block-view ${l}`,children:[e.jsxs("div",{className:"time-block-header",children:[e.jsxs("div",{className:"header-info",children:[e.jsxs("h3",{children:["ימי לימוד - ",s]}),(u==null?void 0:u.weeklyStats)&&e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("span",{children:["ימי לימוד: ",u.weeklyStats.totalTimeBlocks]}),e.jsxs("span",{children:["ניצול: ",u.weeklyStats.utilizationPercentage,"%"]})]})]}),e.jsxs("div",{className:"header-actions",children:[c&&e.jsxs("div",{className:"view-controls",children:[e.jsxs("button",{type:"button",className:`view-btn ${k==="blocks"?"active":""}`,onClick:()=>I("blocks"),children:[e.jsx($e,{size:16}),"ימי לימוד"]}),e.jsxs("button",{type:"button",className:`view-btn ${k==="stats"?"active":""}`,onClick:()=>I("stats"),children:[e.jsx(ym,{size:16}),"סטטיסטיקות"]})]}),!i&&e.jsxs("button",{type:"button",className:"add-block-btn primary",onClick:ee,children:[e.jsx(ls,{size:16}),"הוסף יום לימוד"]})]})]}),m&&e.jsxs("div",{className:"time-block-error",children:[e.jsx(Us,{size:16,color:"red"}),e.jsx("span",{children:m})]}),e.jsx("div",{className:"time-block-content",children:k==="blocks"?L():Y()}),C&&e.jsx(nN,{teacherId:t,onBlockCreated:ne,onCancel:()=>T(!1),initialData:A?{day:A.day,startTime:A.startTime,endTime:A.endTime,location:A.location,notes:A.notes}:void 0,isOpen:C}),e.jsx(gs,{isOpen:D,onClose:()=>S(!1),onConfirm:Q,title:"מחיקת יום לימוד",message:`האם אתה בטוח שברצונך למחוק את יום הלימוד ביום ${R==null?void 0:R.day} בשעה ${R==null?void 0:R.startTime}?`,confirmText:"מחק",cancelText:"ביטול",type:"danger"})]})},Oj=t=>{var s,n,i,l;if((i=(n=(s=t.academicInfo)==null?void 0:s.instrumentProgress)==null?void 0:n[0])!=null&&i.instrumentName){const c=t.academicInfo.instrumentProgress[0].instrumentName;return typeof c=="string"?c:""}if((l=t.academicInfo)!=null&&l.instrument){const c=t.academicInfo.instrument;if(typeof c=="string")return c;if(typeof c=="object"&&(c!=null&&c.instrumentName))return typeof c.instrumentName=="string"?c.instrumentName:""}return""};function Ij(){var pe,me,je,Oe,De,be,Te,Be;const{teacherId:t}=Nr(),[s,n]=x.useState(null),[i,l]=x.useState(!1),[c,u]=x.useState(null),[f,p]=x.useState(!1),[m,g]=x.useState([]),[v,j]=x.useState([]),[N,b]=x.useState(!1),[w,C]=x.useState(0),[T,A]=x.useState([]),[_,D]=x.useState(!1),{rehearsals:S,loadRehearsals:R}=_l(),{user:E,isAuthenticated:k}=vs(),I=new ib({user:E,isAuthenticated:k}),[M,z]=x.useState({students:!1,orchestras:!1,theoryLessons:!1,personalInfo:!1,professionalInfo:!1,schedule:!0}),Z=Ot(),ee=x.useCallback(()=>{C(V=>V+1)},[]);x.useEffect(()=>{t&&!i&&(console.log("TeacherDetails useEffect triggered for teacherId:",t,"refreshTrigger:",w),W(t))},[t,w]);const W=async V=>{var ue,ve;l(!0),u(null);try{const Ne=await Jt.getTeacherById(V);if(console.log("Teacher data loaded:",Ne),n(Ne),Ne){await R(),await F(V);let _e=!1;try{await Q(V),_e=!0}catch{console.log("New API failed, trying fallback methods")}!_e&&((ue=Ne.teaching)!=null&&ue.studentIds)&&Ne.teaching.studentIds.length>0&&(await K(Ne.teaching.studentIds),_e=!0),_e||await ne(V),(ve=Ne.conducting)!=null&&ve.orchestraIds&&Ne.conducting.orchestraIds.length>0?(b(!0),await O(Ne.conducting.orchestraIds)):j([])}}catch(Ne){console.error("Failed to load teacher:",Ne),u(Ne instanceof Error?Ne.message:"שגיאה בטעינת פרטי המורה")}finally{l(!1)}},K=async V=>{try{if(!V||!Array.isArray(V)||V.length===0){console.log("No student IDs provided"),g([]);return}console.log("Loading students for IDs:",V);let ue=[];try{ue=await ot.getStudentsByIds(V),console.log(`Successfully loaded ${ue.length}/${V.length} students`)}catch(ve){console.error("Failed to load students by IDs:",ve),console.log("Falling back to individual student loading");const Ne=V.map(Ie=>ot.getStudentById(Ie).then(Ue=>(console.log(`Successfully loaded student ${Ie}`),Ue)).catch(Ue=>(console.error(`Failed to load student ${Ie}:`,Ue),null)));ue=(await Promise.allSettled(Ne)).filter(Ie=>Ie.status==="fulfilled"&&Ie.value!==null).map(Ie=>Ie.value),console.log(`Loaded ${ue.length}/${V.length} students individually`)}g(ue.map(ve=>{var Ne;return{_id:ve._id,fullName:((Ne=ve.personalInfo)==null?void 0:Ne.fullName)||"תלמיד ללא שם",instrument:Oj(ve)}}))}catch(ue){console.error("Failed to load students:",ue)}},Q=async V=>{try{console.log("Loading students from teacher lessons API for teacher:",V);const ue=await Jt.getTeacherLessons(V);if(console.log("Teacher lessons data received:",ue),!ue||!ue.lessons||ue.lessons.length===0){console.log("No lessons found for teacher"),g([]);return}const ve=new Map;ue.lessons.forEach(_e=>{var Ue;const Ie=_e.studentId;ve.has(Ie)||ve.set(Ie,{_id:Ie,fullName:_e.studentName||"תלמיד לא ידוע",instrument:_e.instrument||"",assignments:[]}),ve.get(Ie).assignments.push({teacherId:V,day:_e.day,time:_e.time,duration:_e.duration,scheduleSlotId:((Ue=_e.scheduleInfo)==null?void 0:Ue.scheduleSlotId)||null})});const Ne=Array.from(ve.values());console.log(`Found ${Ne.length} students with lessons for teacher ${V}`),g(Ne)}catch(ue){console.error("Failed to load students from teacher lessons:",ue),console.log("Falling back to old student loading method"),await ne(V)}},ne=async V=>{try{console.log("Searching for students with teacher assignment for teacher:",V);const ue=await ot.getStudents();console.log("Total students found:",ue.length);const ve=ue.filter(Ne=>{const _e=Ne.teacherIds&&Ne.teacherIds.includes(V),Ie=Ne.teacherAssignments&&Ne.teacherAssignments.some(Ue=>Ue.teacherId===V);return _e||Ie});console.log("Students with this teacher:",ve.length),g(ve.map(Ne=>{var Ie,Ue,$t,qe;const _e=((Ie=Ne.teacherAssignments)==null?void 0:Ie.filter(mt=>mt.teacherId===V&&mt.isActive!==!1))||[];return console.log(`Student: ${(Ue=Ne.personalInfo)==null?void 0:Ue.fullName} has ${_e.length} assignments for teacher ${V}`,{totalAssignments:(($t=Ne.teacherAssignments)==null?void 0:$t.length)||0,allAssignments:Ne.teacherAssignments,filteredAssignments:_e}),{_id:Ne._id,fullName:((qe=Ne.personalInfo)==null?void 0:qe.fullName)||"תלמיד לא ידוע",instrument:Oj(Ne),assignments:_e}}))}catch(ue){console.error("Failed to load students by teacher assignment:",ue),g([])}},X=V=>{const ue=S.filter(ve=>ve.groupId===V);if(ue.length>0){const ve=ue[0],_e=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][ve.dayOfWeek]||"לא ידוע";return{dayOfWeek:ve.dayOfWeek,dayName:`יום ${_e}`,startTime:ve.startTime,endTime:ve.endTime,timeRange:`${ve.startTime}-${ve.endTime}`,fullSchedule:`יום ${_e} ${ve.startTime}-${ve.endTime}`}}return null},se=V=>({Sunday:"ראשון",Monday:"שני",Tuesday:"שלישי",Wednesday:"רביעי",Thursday:"חמישי",Friday:"שישי",Saturday:"שבת",ראשון:"ראשון",שני:"שני",שלישי:"שלישי",רביעי:"רביעי",חמישי:"חמישי",שישי:"שישי",שבת:"שבת",0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"})[V]||V,O=async V=>{try{const ue=await Ra.getOrchestrasByIds(V);j(ue)}catch(ue){console.error("Failed to load orchestras:",ue)}finally{b(!1)}},B=V=>{z(ue=>({...ue,[V]:!ue[V]}))},L=()=>{p(!f)},Y=()=>{Z("/teachers")},H=V=>{Z(`/students/${V}`)},P=V=>{Z(`/orchestras/${V}`)},q=V=>{Z(`/theory/${V}`)},F=async V=>{if(V){D(!0);try{const ue=await Ss.getTheoryLessonsByTeacher(V);console.log("Loaded theory lessons for teacher:",ue),A(ue)}catch(ue){console.error("Failed to load theory lessons for teacher:",ue)}finally{D(!1)}}},te=V=>V?new Date(V).toLocaleDateString("he-IL"):"לא זמין";if(i)return e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{className:"loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי מורה..."})]});if(c||!s)return e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:c||"לא ניתן לטעון את פרטי המורה"}),e.jsx("button",{onClick:Y,className:"btn primary",children:"חזרה לרשימת המורים"})]});const ae=V=>V.split(" ").map(ue=>ue[0]).join("").toUpperCase().substring(0,2),oe=(V,ue)=>{const[ve,Ne]=V.split(":").map(Number),_e=ve*60+Ne+ue,Ie=Math.floor(_e/60),Ue=_e%60;return`${Ie.toString().padStart(2,"0")}:${Ue.toString().padStart(2,"0")}`},ce=(V,ue)=>{const ve=oe(V,ue);return`${V} - ${ve}`},G=V=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545",מגמה:"#FF6B35"})[V]||"#6c757d",re=s.roles&&s.roles.length>0?s.roles[0]:"מורה";return e.jsx("div",{className:"teacher-details-content",children:e.jsx("div",{className:"teacher-details-page",children:e.jsx("div",{className:"teacher-card-container",children:e.jsxs("div",{className:`card-content ${f?"flipped":""}`,children:[e.jsxs("div",{className:"card-side card-front",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"teacher-identity",children:[e.jsx("div",{className:"avatar avatar-clickable",style:{backgroundColor:G(re)},children:ae(s.personalInfo.fullName)}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{className:"teacher-name",children:s.personalInfo.fullName}),e.jsx("div",{className:"instrument",children:(pe=s.professionalInfo)!=null&&pe.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:s.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{size:14}),e.jsx("span",{children:re})]})})]})]}),e.jsxs("div",{className:"header-badges",children:[s.roles&&s.roles.map(V=>e.jsx("div",{className:"role-badge",style:{backgroundColor:G(V)},children:V},V)),e.jsx("button",{className:"back-button",onClick:Y,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${M.students?"active":""}`,onClick:()=>B("students"),children:[e.jsx(ps,{size:16}),e.jsxs("span",{children:["תלמידים (",m.length,")"]}),M.students?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),M.students&&e.jsx("div",{className:"section-content",children:m.length>0?e.jsx("div",{className:"compact-students-overview",children:m.map(V=>{const ue=V.assignments||[];return e.jsxs("div",{className:"compact-student-row clickable",onClick:()=>H(V._id),children:[e.jsxs("div",{className:"student-info-compact",children:[e.jsx("div",{className:"student-avatar-compact",children:typeof V.fullName=="string"&&V.fullName.length>0?V.fullName.charAt(0):"ת"}),e.jsxs("div",{className:"student-details-compact",children:[e.jsx("div",{className:"student-name-compact",children:typeof V.fullName=="string"?V.fullName:"תלמיד לא ידוע"}),V.instrument&&typeof V.instrument=="string"&&V.instrument.length>0&&e.jsx("div",{className:"student-instrument-compact",children:V.instrument})]})]}),e.jsx("div",{className:"lessons-compact",children:ue.length>0?e.jsxs("div",{className:"lessons-list-compact",children:[ue.slice(0,3).map((ve,Ne)=>e.jsxs("div",{className:"lesson-item-compact",children:[e.jsx("span",{className:"lesson-day-compact",children:se(ve.day)}),e.jsx("span",{className:"lesson-time-compact",children:ce(ve.time,ve.duration)}),e.jsxs("span",{className:"lesson-duration-compact",children:["(",ve.duration," דק')"]})]},Ne)),ue.length>3&&e.jsxs("div",{className:"more-lessons-compact",children:["+",ue.length-3]})]}):e.jsx("div",{className:"no-lessons-compact",children:"אין שיעורים מתוכננים"})})]},V._id)})}):(je=(me=s.teaching)==null?void 0:me.studentIds)!=null&&je.length?e.jsxs("div",{className:"loading-section",children:[e.jsx(Yt,{size:16,className:"loading-icon"}),e.jsx("span",{children:"טוען פרטי תלמידים..."}),e.jsx("button",{className:"refresh-btn",onClick:ee,"aria-label":"רענן נתונים",children:"לחץ לרענון"})]}):e.jsx("div",{className:"no-students-message",children:"למורה זה אין תלמידים מתוכננים כרגע"})})]}),((Oe=s.conducting)==null?void 0:Oe.orchestraIds)&&s.conducting.orchestraIds.length>0&&e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${M.orchestras?"active":""}`,onClick:()=>B("orchestras"),children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:["מנצח על תזמורות (",s.conducting.orchestraIds.length,")"]}),M.orchestras?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),M.orchestras&&e.jsx("div",{className:"section-content",children:N?e.jsxs("div",{className:"loading-section",children:[e.jsx(Yt,{size:16,className:"loading-icon"}),e.jsx("span",{children:"טוען נתוני תזמורת..."})]}):v.length>0?e.jsx("div",{className:"orchestras-grid",children:v.map(V=>{const ue=X(V._id);return e.jsxs("div",{className:"orchestra-card clickable",onClick:()=>P(V._id),children:[e.jsx("div",{className:"orchestra-header",children:e.jsxs("div",{className:"orchestra-name",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:V.name})]})}),e.jsxs("div",{className:"orchestra-details",children:[ue&&e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:ue.fullSchedule})]}),V.location&&e.jsxs("div",{className:"location",children:[e.jsx(vt,{size:12}),e.jsxs("span",{children:["מיקום: ",V.location]})]}),V.memberIds&&V.memberIds.length>0&&e.jsxs("div",{className:"member-count",children:[e.jsx(ps,{size:12}),e.jsxs("span",{children:[V.memberIds.length," חברים"]})]}),!V.isActive&&e.jsx("div",{className:"status-inactive",children:"תזמורת לא פעילה"})]})]},V._id)})}):e.jsx("div",{className:"no-orchestra-message",children:"לא נמצאו פרטי תזמורות"})})]}),T.length>0&&e.jsx(z$,{teacher:s,theoryLessons:T,theoryLessonsLoading:_,isOpen:M.theoryLessons,onToggle:()=>B("theoryLessons"),onTheoryLessonClick:q}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${M.schedule?"active":""}`,onClick:()=>B("schedule"),children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת שעות"}),M.schedule?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),M.schedule&&e.jsx("div",{className:"section-content",children:I.canManageTeacherSchedule(s)?e.jsx(rN,{teacherId:s._id,teacherName:((De=s.personalInfo)==null?void 0:De.fullName)||"מורה לא ידוע",onTimeBlockChange:()=>{}}):e.jsx("div",{className:"read-only-schedule",children:e.jsx(L$,{teacherId:s._id,teacherName:((be=s.personalInfo)==null?void 0:be.fullName)||"מורה לא ידוע",readOnly:!0,isAdmin:I.isAdmin(),onTimeBlockChange:()=>{}})})})]})]}),e.jsxs("button",{className:"flip-button",onClick:L,children:[e.jsx("span",{children:"הצג פרטים אישיים"}),e.jsx(Bs,{size:14})]})]}),e.jsxs("div",{className:"card-side card-back",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"teacher-identity",children:[e.jsx("div",{className:"avatar avatar-clickable",style:{backgroundColor:G(re)},children:ae(s.personalInfo.fullName)}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{className:"teacher-name",children:s.personalInfo.fullName}),e.jsx("div",{className:"instrument",children:(Te=s.professionalInfo)!=null&&Te.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:s.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{size:14}),e.jsx("span",{children:re})]})})]})]}),e.jsxs("div",{className:"header-badges",children:[s.roles&&s.roles.map(V=>e.jsx("div",{className:"role-badge",style:{backgroundColor:G(V)},children:V},V)),e.jsx("button",{className:"back-button",onClick:Y,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${M.personalInfo?"active":""}`,onClick:()=>B("personalInfo"),children:[e.jsx(We,{size:16}),e.jsx("span",{children:"פרטים אישיים"}),M.personalInfo?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),M.personalInfo&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"info-grid",children:[s.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון"}),e.jsx("span",{className:"info-value",children:s.personalInfo.phone})]})]}),s.personalInfo.address&&e.jsxs("div",{className:"info-item",children:[e.jsx(vt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כתובת"}),e.jsx("span",{className:"info-value",children:s.personalInfo.address})]})]}),s.personalInfo.email&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל"}),e.jsx("span",{className:"info-value",children:s.personalInfo.email})]})]}),s.createdAt&&e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:te(s.createdAt)})]})]})]})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${M.professionalInfo?"active":""}`,onClick:()=>B("professionalInfo"),children:[e.jsx(Vt,{size:16}),e.jsx("span",{children:"מידע מקצועי"}),M.professionalInfo?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),M.professionalInfo&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"info-grid",children:[((Be=s.professionalInfo)==null?void 0:Be.instrument)&&e.jsxs("div",{className:"info-item",children:[e.jsx(Je,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כלי נגינה"}),e.jsx("span",{className:"info-value",children:s.professionalInfo.instrument})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:te(s.createdAt||"")})]})]})]})})]})]}),e.jsxs("button",{className:"flip-button",onClick:L,children:[e.jsx("span",{children:"הצג מידע מקצועי"}),e.jsx(Bs,{size:14})]})]})]})})})})}function B$({orchestra:t,onView:s,onEdit:n,onRemove:i}){const[l,c]=x.useState("");x.useEffect(()=>{(async()=>{if(t.conductorId)try{const b=await Jt.getTeacherById(t.conductorId);c(b?b.personalInfo.fullName:"מנצח לא זמין")}catch(b){console.error("Error fetching conductor:",b),c("מנצח לא זמין")}})()},[t.conductorId]);const u=N=>({הרכב:"#4D55CC",תזמורת:"#28A745"})[N]||"#6c757d",f=N=>N===0?"0 תלמידים":N===1?"תלמיד אחד":`${N} תלמידים`,p=N=>N?N===1?"חזרה אחת":`${N} חזרות`:"אין חזרות",m=t.memberIds&&t.memberIds.length>0,g=t.rehearsalIds&&t.rehearsalIds.length>0,v=m?t.memberIds.length:0,j=g?t.rehearsalIds.length:0;return e.jsxs("div",{className:"orchestra-preview",onClick:()=>s(t._id),style:{cursor:"pointer"},children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"orchestra-header-container",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:u(t.type)},children:e.jsx(Je,{size:20})})}),e.jsxs("div",{className:"orchestra-info",children:[e.jsxs("div",{className:"orchestra-main-info",children:[e.jsx("h3",{className:"orchestra-name",children:t.name}),e.jsxs("div",{className:"orchestra-type",children:[e.jsx(Je,{size:14}),e.jsx("span",{children:t.type})]})]}),l&&e.jsxs("div",{className:"conductor-badge",children:[e.jsx(We,{size:12}),e.jsx("span",{children:l})]})]})]})}),e.jsx("div",{className:"preview-content",children:e.jsxs("div",{className:"info-row",children:[e.jsxs("div",{className:"info-item",children:[e.jsx(ps,{size:16}),e.jsx("span",{children:f(v)})]}),e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:16}),e.jsx("span",{children:p(j)})]})]})}),e.jsxs("div",{className:"preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[n&&e.jsx("button",{className:"action-btn edit",onClick:N=>{N.stopPropagation(),n(t._id)},"aria-label":"ערוך תזמורת",children:e.jsx(Sa,{size:16})}),i&&e.jsx("button",{className:"action-btn delete",onClick:N=>{N.stopPropagation(),i(t._id)},"aria-label":"מחק תזמורת",children:e.jsx(_t,{size:16})})]}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(t.createdAt||Date.now()).toLocaleDateString("he-IL")})]})]})]})}function F$({orchestras:t,isLoading:s,onEdit:n,onView:i,onRemove:l}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען תזמורות..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו תזמורות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף תזמורות חדשות"})]}):e.jsx("div",{className:"orchestra-grid",children:t.map(c=>e.jsx(B$,{orchestra:c,onEdit:n,onView:i,onRemove:l},c._id))})}const U$=(t=[],s)=>Ae().required("שם הוא שדה חובה").min(2,"שם חייב להכיל לפחות 2 תווים").test("unique-name","שם זהה כבר קיים",function(n){if(!n||s&&s===n)return!0;const i=n.trim().toLowerCase(),l=s?t.filter(p=>p.toLowerCase()!==s.toLowerCase()):t,c=l.find(p=>p.toLowerCase()===i);if(c)return this.createError({message:`שם זהה כבר קיים: "${c}"`});const u=i.replace(/\s+/g,""),f=l.find(p=>p.toLowerCase().replace(/\s+/g,"")===u);return f?this.createError({message:`שם דומה כבר קיים (הבדלי רווחים): "${f}"`}):!0}),P$={name:"",type:"תזמורת",conductorId:"",memberIds:[],rehearsalIds:[],schoolYearId:"",location:"חדר 1",isActive:!0},q$=(t=[],s)=>at().shape({_id:Ae(),name:U$(t,s),type:Ae().required("סוג הוא שדה חובה").oneOf(sN,"סוג לא תקין"),conductorId:Ae().required("מנצח/מדריך הוא שדה חובה"),memberIds:es().of(Ae()),rehearsalIds:es().of(Ae()),schoolYearId:Ae().required("שנת לימודים היא שדה חובה"),location:Ae().required("מקום הוא שדה חובה").oneOf(br,"מקום לא תקין"),isActive:za().default(!0)});function oN({isOpen:t,onClose:s,orchestra:n,onSave:i}){const{modalProps:l,titleProps:c,descriptionProps:u}=Al({isOpen:t,onClose:s,modalId:"orchestra-form",restoreFocusOnClose:!0}),[f,p]=x.useState([]),[m,g]=x.useState(!1),[v,j]=x.useState([]),[N,b]=x.useState(""),[w,C]=x.useState(!1),[T,A]=x.useState(!1),[_,D]=x.useState(null),S=x.useRef(null),{orchestras:R,saveOrchestra:E,isLoading:k}=jr(),{currentSchoolYear:I}=na(),{students:M,saveStudent:z,loadStudents:Z}=La(),{loadTeacherByRole:ee,loadTeachers:W}=Ds(),{showSuccess:K,showError:Q}=It(),ne=R.map(q=>q.name),X=x.useCallback(()=>n!=null&&n._id?{_id:n._id,name:n.name||"",type:n.type||"תזמורת",conductorId:n.conductorId||"",memberIds:n.memberIds||[],rehearsalIds:n.rehearsalIds||[],schoolYearId:n.schoolYearId||(I==null?void 0:I._id)||"",location:n.location||"חדר 1",isActive:n.isActive!==!1}:{...P$,schoolYearId:(I==null?void 0:I._id)||""},[n,I]);x.useEffect(()=>{M.length===0&&Z({isActive:!0})},[M.length,Z]),x.useEffect(()=>{if(M.length>0&&(n!=null&&n.memberIds)&&n.memberIds.length>0){A(!0);const q=M.filter(F=>{var te;return(te=n==null?void 0:n.memberIds)==null?void 0:te.includes(F._id)});j(q),A(!1)}else j([])},[n==null?void 0:n.memberIds,M]),x.useEffect(()=>{function q(F){S.current&&!S.current.contains(F.target)&&C(!1)}return document.addEventListener("mousedown",q),()=>{document.removeEventListener("mousedown",q)}},[]);const se=x.useCallback(async q=>{g(!0),p([]);try{const F=q==="תזמורת"?"מנצח":"מדריך הרכב";if(console.log(`Fetching teachers with role: ${F}`),typeof ee=="function"){const te=await ee(F);Array.isArray(te)?(console.log(`Found ${te.length} teachers with role ${F}`),p(te)):(console.error("Expected array of teachers, but got:",te),p([]))}else{const te=await W({role:F,isActive:!0});if(Array.isArray(te)){const ae=te.filter(oe=>oe.roles&&oe.roles.includes(F));console.log(`Filtered ${ae.length} teachers with role ${F}`),p(ae)}else console.error("Expected array of teachers, but got:",te),p([])}}catch(F){console.error("Failed to load teachers for role:",F),p([])}finally{g(!1)}},[ee,W]),O=x.useCallback(q=>{b(q.target.value),C(q.target.value.length>0)},[]),B=x.useCallback(()=>N?M.filter(q=>q.personalInfo.fullName.includes(N)&&!v.some(F=>F._id===q._id)).slice(0,10):[],[N,M,v]),L=x.useCallback((q,F)=>{const te=[...v,q];j(te),F("memberIds",te.map(ae=>ae._id)),b(""),C(!1)},[v]),Y=x.useCallback((q,F)=>{j(te=>{const ae=te.filter(oe=>oe._id!==q);return F("memberIds",ae.map(oe=>oe._id)),ae})},[]),H=async(q,F,te)=>{try{const ae=te.filter(ce=>!F.includes(ce)),oe=F.filter(ce=>!te.includes(ce));console.log("Updating student references:",{adding:ae.length,removing:oe.length});for(const ce of ae){const G=M.find(re=>re._id===ce);G&&!G.enrollments.orchestraIds.includes(q)&&await z({_id:G._id,enrollments:{...G.enrollments,orchestraIds:[...G.enrollments.orchestraIds,q]}})}for(const ce of oe){const G=M.find(re=>re._id===ce);G&&await z({_id:G._id,enrollments:{...G.enrollments,orchestraIds:G.enrollments.orchestraIds.filter(re=>re!==q)}})}}catch(ae){console.error("Error updating student references:",ae)}},P=async(q,{setSubmitting:F})=>{D(null);try{console.log("Submitting orchestra form with data:",q);const te=await E(q);console.log("Orchestra saved successfully:",te),await H(te._id,(n==null?void 0:n.memberIds)||[],q.memberIds);const ae=q.type==="תזמורת",oe=n!=null&&n._id?`${ae?"התזמורת עודכנה בהצלחה":"ההרכב עודכן בהצלחה"}`:`${ae?"התזמורת נוצרה בהצלחה":"ההרכב נוצר בהצלחה"}`;K(oe),i&&i(),s()}catch(te){console.error("Error saving orchestra:",te);const ae=te instanceof Error?te.message:"שגיאה לא ידועה בשמירת התזמורת/הרכב";D(ae),Q(ae)}finally{F(!1)}};return t?e.jsx(Ta,{isOpen:t,onClose:s,className:"orchestra-form responsive-form",children:e.jsxs("div",{className:"form-modal",...l,children:[e.jsx("div",{...u,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי הרכב קיים במערכת":"טופס הוספת הרכב חדש למערכת"}),e.jsx(xr,{initialValues:X(),validationSchema:q$(ne,n==null?void 0:n.name),onSubmit:P,enableReinitialize:!0,children:({values:q,errors:F,touched:te,isSubmitting:ae,setFieldValue:oe})=>{const ce=q.type==="תזמורת";x.useEffect(()=>{se(q.type)},[q.type]);const G=B();return e.jsxs($n,{children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...c,children:n!=null&&n._id?ce?"עריכת תזמורת":"עריכת הרכב":ce?"הוספת תזמורת חדשה":"הוספת הרכב חדש"})]}),_&&e.jsx("div",{className:"error-message",children:_}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:ce?"פרטי תזמורת":"פרטי הרכב"}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsxs(Le,{label:"סוג",name:"type",as:"select",required:!0,disabled:ae,children:[e.jsx("option",{value:"",children:"בחר סוג"}),sN.map(re=>e.jsx("option",{value:re,children:re},re))]}),e.jsx(Le,{label:ce?"שם התזמורת":"שם ההרכב",name:"name",type:"text",required:!0,placeholder:ce?"הכנס שם תזמורת...":"הכנס שם הרכב...",disabled:ae})]}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsxs(Le,{label:"מקום",name:"location",as:"select",required:!0,disabled:ae,children:[e.jsx("option",{value:"",children:"בחר מקום"}),br.map(re=>e.jsx("option",{value:re,children:re},re))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conductorId",className:F.conductorId&&te.conductorId?"required-field is-invalid":"required-field",children:ce?"מנצח":"מדריך הרכב"}),e.jsxs("select",{id:"conductorId",name:"conductorId",value:q.conductorId,onChange:re=>{oe("conductorId",re.target.value)},className:F.conductorId&&te.conductorId?"is-invalid":"",required:!0,disabled:m||ae,children:[e.jsx("option",{value:"",children:ce?"בחר מנצח":"בחר מדריך הרכב"}),f.map(re=>e.jsx("option",{value:re._id,children:re.personalInfo.fullName},re._id))]}),m&&e.jsx("div",{className:"loading-text",children:ce?"טוען מנצחים...":"טוען מדריכים..."}),F.conductorId&&te.conductorId&&e.jsx("div",{className:"form-error",children:F.conductorId})]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:ce?"תלמידים (חברי התזמורת)":"תלמידים (חברי ההרכב)"}),e.jsxs("div",{ref:S,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(gr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:N,onChange:O,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>N.length>0,disabled:ae})]}),w&&G.length>0&&!ae&&e.jsx("div",{className:"search-results-dropdown",children:G.map(re=>e.jsxs("div",{className:"search-result-item",onClick:()=>L(re,oe),children:[e.jsx(We,{size:16,className:"student-icon"}),e.jsx("span",{children:re.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:re.academicInfo.instrument})]},re._id))})]}),e.jsx("div",{className:"selected-members-list",children:T?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):v.length>0?v.map(re=>{var pe,me,je;return e.jsxs("div",{className:"member-badge",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:re.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:re.personalInfo.fullName}),((je=(me=(pe=re.academicInfo)==null?void 0:pe.instrumentProgress)==null?void 0:me[0])==null?void 0:je.instrumentName)&&e.jsx("div",{className:"member-instrument",children:re.academicInfo.instrumentProgress[0].instrumentName})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>Y(re._id,oe),"aria-label":`הסר את ${re.personalInfo.fullName}`,disabled:ae,children:e.jsx(yt,{size:14})})]},re._id)}):e.jsxs("div",{className:"no-members-message",children:["לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים"," ",ce?"לתזמורת":"להרכב","."]})})]})}),e.jsx("input",{type:"hidden",name:"schoolYearId",value:q.schoolYearId})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",disabled:k||ae,children:ae?"שומר...":k?"טוען...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:s,disabled:ae,children:"ביטול"})]})]})}})]})}):null}function H$(){const{orchestras:t,isLoading:s,error:n,loadOrchestras:i,removeOrchestra:l}=jr(),{loadCurrentSchoolYear:c}=na(),[u,f]=x.useState(!1),[p,m]=x.useState(null),[g,v]=x.useState(!1),[j,N]=x.useState(null),{showSuccess:b,showError:w}=It(),[C,T]=x.useState(!1),A=H=>[H.name,H.type],{filteredEntities:_,handleSearch:D,filters:S,handleApplyFilters:R,hasActiveFilters:E,availableInstruments:k}=bu(t,A,H=>H.type,void 0,void 0,H=>H.name),I=Ot(),M=ys(),{user:z}=vs(),Z=z==null?void 0:z.roles.includes("מנהל"),ee=z==null?void 0:z.roles.includes("מנצח"),W=M.pathname.includes("/orchestras/")&&!M.pathname.endsWith("/orchestras/");x.useEffect(()=>{i(),c()},[i,c]);const K=()=>{m(null),f(!0)},Q=()=>{f(!1),m(null)},ne=H=>{const P=t.find(q=>q._id===H)||null;m(P),f(!0)},X=H=>{I(`/orchestras/${H}`)},se=H=>{t.find(q=>q._id===H)&&(N(H),v(!0))},O=async()=>{if(j)try{await l(j),b("התזמורת נמחקה בהצלחה"),N(null)}catch(H){console.error("Failed to remove orchestra:",H),w("שגיאה במחיקת התזמורת. אנא נסה שוב.")}},B=()=>{T(!C)},L=Z,Y=Z||ee;return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!W&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(ic,{onSearch:D,placeholder:"חיפוש תזמורות..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsx("button",{className:`btn-icon filter-btn ${E?"active":""}`,onClick:B,"aria-label":"סנן תזמורות",children:e.jsx(hi,{className:"icon"})}),e.jsx(Nu,{isOpen:C,onToggle:()=>T(!C),onApplyFilters:R,availableInstruments:k,currentFilters:S,hasActiveFilters:E,entityType:"orchestras"})]}),L&&e.jsx("button",{className:"btn-icon add-btn",onClick:K,"aria-label":"הוספת תזמורת חדשה",children:e.jsx(ls,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!W&&e.jsx(F$,{orchestras:_,isLoading:s,onEdit:Y?ne:void 0,onView:X,onRemove:Z?se:void 0}),e.jsx(wl,{context:{loadOrchestras:i}}),e.jsx(gs,{isOpen:g,onClose:()=>v(!1),onConfirm:O,title:"מחיקת תזמורת",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התזמורת?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),u&&e.jsx(oN,{isOpen:u,onClose:Q,orchestra:p,onSave:i})]}),!W&&!u&&e.jsx(mi,{})]})}function Y$({isOpen:t,onClose:s,orchestraName:n,rehearsalCount:i,changes:l,onConfirmUpdate:c}){const[u,f]=x.useState(!1),p=()=>{f(!0)},m=()=>{c(),f(!1),s()},g=()=>{f(!1),s()};return u?e.jsx(gs,{isOpen:!0,onClose:()=>f(!1),onConfirm:m,title:"אישור עדכון כל החזרות",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsxs("strong",{children:["פעולה זו תעדכן את כל ",i,' החזרות של "',n,'"']})}),e.jsx("p",{children:"השינויים יוחלו על כל החזרות הקיימות. פעולה זו לא ניתנת לביטול."}),e.jsx("p",{className:"text-sm text-muted",children:"האם אתה בטוח שברצונך להמשיך?"})]}),confirmText:`עדכן ${i} חזרות`,cancelText:"ביטול",type:"warning"}):e.jsx(Ta,{isOpen:t,onClose:g,children:e.jsxs("div",{className:"rehearsal-bulk-update-dialog",children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx(yr,{size:24,className:"warning-icon"}),e.jsx("h3",{children:"עדכון כל החזרות"})]}),e.jsxs("div",{className:"dialog-content",children:[e.jsxs("div",{className:"orchestra-info",children:[e.jsx(Je,{size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"orchestra-name",children:n}),e.jsxs("div",{className:"rehearsal-count",children:[i," חזרות"]})]})]}),e.jsxs("div",{className:"changes-summary",children:[e.jsx("h4",{children:"השינויים שיוחלו:"}),e.jsx("ul",{className:"changes-list",children:l.map((v,j)=>e.jsx("li",{children:v},j))})]}),e.jsxs("div",{className:"warning-message",children:[e.jsx($e,{size:18}),e.jsxs("p",{children:["השינויים יוחלו על כל החזרות הקיימות של התזמורת. פעולה זו תשפיע על ",i," חזרות."]})]})]}),e.jsxs("div",{className:"dialog-actions",children:[e.jsx("button",{className:"btn primary",onClick:p,children:"בצע עבור כל החזרות"}),e.jsx("button",{className:"btn secondary",onClick:g,children:"ביטול"})]})]})})}const V$=at().shape({groupId:Ae().required("יש לבחור תזמורת"),date:Ae().required("תאריך חובה"),startTime:Ae().required("שעת התחלה חובה"),endTime:Ae().required("שעת סיום חובה").test("is-after-start","שעת סיום חייבת להיות אחרי שעת התחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ae().required("מיקום חובה"),notes:Ae(),isActive:za().default(!0),schoolYearId:Ae().required("שנת לימודים חובה"),type:Ae().default("תזמורת"),dayOfWeek:Pa().min(0).max(6)}),G$=at().shape({orchestraId:Ae().required("יש לבחור תזמורת"),startDate:Ae().required("תאריך התחלה חובה"),endDate:Ae().required("תאריך סיום חובה").test("is-after-start","תאריך סיום חייב להיות אחרי תאריך התחלה",function(t){const{startDate:s}=this.parent;return!s||!t?!0:new Date(t)>=new Date(s)}),dayOfWeek:Pa().min(0).max(6).required("יום בשבוע חובה"),startTime:Ae().required("שעת התחלה חובה"),endTime:Ae().required("שעת סיום חובה").test("is-after-start","שעת סיום חייבת להיות אחרי שעת התחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ae().required("מיקום חובה"),notes:Ae(),excludeDates:es().of(Ae()),schoolYearId:Ae().required("שנת לימודים חובה")}),cu=t=>t.toISOString().split("T")[0],Q$=(t,s="",n="")=>{const i=new Date;return t!=null&&t._id?{_id:t._id,groupId:t.groupId||s,date:t.date||cu(i),startTime:t.startTime||"16:00",endTime:t.endTime||"18:00",location:t.location||br[0],notes:t.notes||"",schoolYearId:t.schoolYearId||n,type:t.type||"תזמורת",dayOfWeek:t.dayOfWeek||i.getDay()}:{_id:void 0,groupId:s,date:cu(i),startTime:"16:00",endTime:"18:00",location:br[0],notes:"",schoolYearId:n,type:"תזמורת",dayOfWeek:i.getDay()}},X$=(t="",s="")=>{const n=new Date,i=new Date(n);return i.setDate(n.getDate()+30),{orchestraId:t,startDate:cu(n),endDate:cu(i),dayOfWeek:n.getDay(),startTime:"16:00",endTime:"18:00",location:br[0],notes:"",excludeDates:[],schoolYearId:s,excludedDate:""}};function pp({isOpen:t,onClose:s,rehearsal:n,orchestraId:i,onSave:l}){var H;const{modalProps:c,titleProps:u,descriptionProps:f}=Al({isOpen:t,onClose:s,modalId:"rehearsal-form",restoreFocusOnClose:!0}),p=_l(),m=jr(),g=na(),{addToast:v}=It(),{saveRehearsal:j,bulkCreateRehearsals:N,updateRehearsalsByOrchestra:b,rehearsals:w,isLoading:C,error:T,clearError:A}=p,{orchestras:_,loadOrchestras:D}=m,{currentSchoolYear:S,loadCurrentSchoolYear:R}=g,[E,k]=x.useState("bulk"),[I,M]=x.useState(""),[z,Z]=x.useState(""),[ee,W]=x.useState(!1),[K,Q]=x.useState(null);x.useEffect(()=>{(async()=>{if(!S)try{await R()}catch(q){console.error("Failed to load current school year:",q),Z("Failed to load current school year. Please try again.")}if(_.length===0)try{await D()}catch(q){console.error("Failed to load orchestras:",q),Z("Failed to load orchestras. Please try again.")}})(),A&&A(),n!=null&&n._id&&k("single")},[S,R,_.length,D,A,n]);const ne=P=>{n!=null&&n._id||k(P)},X=async P=>{Z("");try{const q=P.schoolYearId||(S==null?void 0:S._id);if(!q){Z("שנת הלימודים לא נטענה. אנא רענן את הדף.");return}const F={...P,schoolYearId:q};console.log("Saving single rehearsal:",F),await j(F),v({type:"success",message:n!=null&&n._id?"החזרה עודכנה בהצלחה":"החזרה נוספה בהצלחה"}),l&&l(),s()}catch(q){console.error("Error saving rehearsal:",q);const F=q instanceof Error?q.message:"שגיאה בשמירת החזרה";Z(F),v({type:"danger",message:F})}},se=async P=>{Z("");try{const q=P.schoolYearId||(S==null?void 0:S._id);if(!q){Z("שנת הלימודים לא נטענה. אנא רענן את הדף.");return}const F={...P,dayOfWeek:Number(P.dayOfWeek),schoolYearId:q};console.log("Creating bulk rehearsals:",F);const te=await N(F);v({type:"success",message:`נוצרו ${te.insertedCount} חזרות בהצלחה`}),l&&l(),s()}catch(q){console.error("Error creating bulk rehearsals:",q);const F=q instanceof Error?q.message:"שגיאה ביצירת חזרות מרובות";Z(F),v({type:"danger",message:F})}},O=P=>{if(!(n!=null&&n.groupId)){Z("לא ניתן לבצע עדכון קבוצתי - לא נמצא מזהה תזמורת");return}const{_id:q,createdAt:F,updatedAt:te,groupId:ae,date:oe,schoolYearId:ce,...G}=P,re=[],pe=n;if(G.startTime!==pe.startTime&&re.push(`שעת התחלה: ${G.startTime}`),G.endTime!==pe.endTime&&re.push(`שעת סיום: ${G.endTime}`),G.location!==pe.location&&re.push(`מיקום: ${G.location}`),G.notes!==pe.notes&&re.push(`הערות: ${G.notes||"ללא הערות"}`),re.length===0){Z("לא נמצאו שינויים לעדכון");return}Q({orchestraId:n.groupId,updates:G,changes:re}),W(!0)},B=async()=>{if(K)try{const P=await b(K.orchestraId,K.updates);v({type:"success",message:`עודכנו ${P.updatedCount} חזרות בהצלחה`}),l&&l(),s()}catch(P){console.error("Error updating rehearsals:",P);const q=P instanceof Error?P.message:"שגיאה בעדכון החזרות";Z(q),v({type:"danger",message:q})}finally{Q(null),W(!1)}},L=(P,q,F)=>{if(!P)return;const te=q.excludeDates||[];if(!te.includes(P)){const ae=[...te,P];F("excludeDates",ae),M("")}},Y=(P,q,F)=>{const ae=(q.excludeDates||[]).filter(oe=>oe!==P);F("excludeDates",ae)};return t?e.jsx(Ta,{isOpen:t,onClose:s,className:"rehearsal-form responsive-form",children:e.jsxs("div",{className:"form-modal",...c,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...u,children:n!=null&&n._id?"עריכת חזרה":"הוספת חזרה חדשה"})]}),e.jsx("div",{...f,className:"sr-only",children:n!=null&&n._id?"טופס עריכת חזרה קיימת במערכת":"טופס הוספת חזרה חדשה למערכת"}),T&&e.jsx("div",{className:"error-message",children:T}),z&&e.jsx("div",{className:"error-message",children:z}),!(n!=null&&n._id)&&e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{type:"button",className:E==="bulk"?"active primary":"secondary",onClick:()=>ne("bulk"),children:"חזרות מרובות"}),e.jsx("button",{type:"button",className:E==="single"?"active primary":"secondary",onClick:()=>ne("single"),children:"חזרה בודדת"})]}),E==="single"?e.jsx(xr,{initialValues:Q$(n,i,(S==null?void 0:S._id)||""),validationSchema:V$,onSubmit:X,enableReinitialize:!0,children:({values:P})=>e.jsxs($n,{children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי תזמורת"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Le,{label:"תזמורת/הרכב",name:"groupId",as:"select",required:!0,labelIcon:e.jsx(Je,{size:16}),children:[e.jsx("option",{value:"",children:"בחר תזמורת/הרכב"}),_.map(q=>e.jsx("option",{value:q._id,children:q.name},q._id))]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי חזרה"}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"תאריך",name:"date",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Le,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Le,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(vt,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מיקום"}),br.map(q=>e.jsx("option",{value:q,children:q},q))]})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx($a,{type:"hidden",name:"schoolYearId",value:(S==null?void 0:S._id)||""}),e.jsx($a,{type:"hidden",name:"isActive"}),e.jsx($a,{type:"hidden",name:"type"}),e.jsx($a,{type:"hidden",name:"dayOfWeek"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:C,children:C?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),(n==null?void 0:n._id)&&e.jsx("button",{type:"button",className:"warning",disabled:C,onClick:()=>O(P),children:"בצע עבור כל החזרות"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}):e.jsx(xr,{initialValues:X$(i,(S==null?void 0:S._id)||""),validationSchema:G$,onSubmit:se,enableReinitialize:!0,children:({values:P,setFieldValue:q})=>e.jsxs($n,{children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי תזמורת"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Le,{label:"תזמורת/הרכב",name:"orchestraId",as:"select",required:!0,labelIcon:e.jsx(Je,{size:16}),children:[e.jsx("option",{value:"",children:"בחר תזמורת/הרכב"}),_.map(F=>e.jsx("option",{value:F._id,children:F.name},F._id))]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי חזרה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"תאריך התחלה",name:"startDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})}),e.jsx(Le,{label:"תאריך סיום",name:"endDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})]}),e.jsxs("div",{className:"form-row full-width",children:[e.jsx(Le,{label:"יום בשבוע",name:"dayOfWeek",as:"select",required:!0,labelIcon:e.jsx(xm,{size:16}),children:Fm.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))}),e.jsxs("div",{className:"help-text",style:{marginTop:"-15px",paddingRight:"16px"},children:["חזרות ייווצרו בכל יום ",aN(Number(P.dayOfWeek))," ","בטווח התאריכים שנבחר"]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group excluded-dates",children:[e.jsxs("label",{children:[e.jsx($e,{size:16,className:"icon"}),"תאריכים לדילוג"]}),e.jsxs("div",{className:"date-input-group",children:[e.jsx("input",{type:"date",value:I,onChange:F=>M(F.target.value),min:P.startDate,max:P.endDate}),e.jsx("button",{type:"button",onClick:()=>L(I,P,q),className:"add-date-btn",disabled:!I,children:"הוסף"})]}),P.excludeDates&&P.excludeDates.length>0&&e.jsxs("div",{className:"excluded-dates-list",children:[e.jsx("div",{className:"list-title",children:"תאריכים שיידלגו:"}),e.jsx("ul",{children:P.excludeDates.map(F=>e.jsxs("li",{children:[new Date(F).toLocaleDateString("he-IL"),e.jsx("button",{type:"button",onClick:()=>Y(F,P,q),className:"remove-date-btn",children:e.jsx(yt,{size:14})})]},F))})]})]})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Le,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Le,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(vt,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מיקום"}),br.map(F=>e.jsx("option",{value:F,children:F},F))]})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx($a,{type:"hidden",name:"schoolYearId",value:(S==null?void 0:S._id)||""})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:C,children:C?"שומר...":"יצירת חזרות מרובות"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}),ee&&K&&e.jsx(Y$,{isOpen:ee,onClose:()=>{W(!1),Q(null)},orchestraName:((H=_.find(P=>P._id===K.orchestraId))==null?void 0:H.name)||"לא ידוע",rehearsalCount:w.filter(P=>P.groupId===K.orchestraId).length,changes:K.changes,onConfirmUpdate:B})]})}):null}function $j(){var Be;const{orchestraId:t}=Nr(),s=Ot(),{user:n}=vs(),{selectedOrchestra:i,loadOrchestraById:l,removeOrchestra:c,isLoading:u,error:f}=jr(),{loadTeacherById:p}=Ds(),{getStudentsByIds:m}=La(),{rehearsals:g,loadRehearsalsByOrchestraId:v,removeRehearsal:j,isLoading:N}=_l(),[b,w]=x.useState([]),[C,T]=x.useState(!1),[A,_]=x.useState(!1),[D,S]=x.useState(!1),[R,E]=x.useState(null),[k,I]=x.useState(!1),[M,z]=x.useState(!1),[Z,ee]=x.useState(null),[W,K]=x.useState(!1),[Q,ne]=x.useState(null),[X,se]=x.useState(!1),[O,B]=x.useState(!1),[L,Y]=x.useState(!1),H=Cl(n,!!n),P=Sr(H),q=i?P.getOrchestraActionPermissions(i):{canEdit:!1,canDelete:!1,showEditButton:!1,showDeleteButton:!1};q.canEdit,q.canDelete,P.isAdmin(),x.useEffect(()=>{t&&l(t)},[t,l]),x.useEffect(()=>{t&&v(t)},[t,v]),x.useEffect(()=>{(async()=>{if(i!=null&&i.conductorId){I(!0);try{await p(i.conductorId);const ve=Ds.getState().selectedTeacher;E(ve)}catch(ue){console.error("Failed to load conductor:",ue)}finally{I(!1)}}})()},[i,p]),x.useEffect(()=>{(async()=>{if(i&&i.memberIds&&i.memberIds.length>0){T(!0);try{const ve=(await m(i.memberIds)).map(Ne=>({_id:Ne._id,personalInfo:{fullName:Ne.personalInfo.fullName},academicInfo:{instrument:Ne.academicInfo.instrument}}));w(ve.map(Ne=>({...Ne,academicInfo:{...Ne.academicInfo,instrument:Ne.academicInfo.instrument||""}})))}catch(ue){console.error("Failed to load members:",ue)}finally{T(!1)}}else w([])})()},[i,m]);const F=V=>new Date(V).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"}),te=()=>{s("/orchestras")},ae=()=>{_(!0)},oe=()=>{S(!0)},ce=async()=>{if(i!=null&&i._id)try{await c(i._id),s("/orchestras")}catch(V){console.error("Failed to delete orchestra:",V)}S(!1)},G=()=>{ee(null),z(!0)},re=V=>{ee(V),z(!0)},pe=V=>{ne(V),K(!0)},me=async()=>{if(Q)try{await j(Q),v(t)}catch(V){console.error("Failed to delete rehearsal:",V)}K(!1),ne(null)},je=V=>{s(`/rehearsals/${V}`)},Oe=V=>{s(`/students/${V}`)},De=()=>{se(!X)},be=()=>{B(!O)},Te=()=>{Y(!L)};return u?e.jsx("div",{className:"loading-state",children:"טוען..."}):f?e.jsx("div",{className:"error-state",children:f}):i?e.jsxs("div",{className:"orchestra-details-content",children:[e.jsx("div",{className:"orchestra-details-page",children:e.jsx("div",{className:"orchestra-card-container",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"orchestra-header",children:[e.jsx("div",{className:"header-icon",children:e.jsx(Je,{className:"icon",size:20})}),e.jsx("h2",{className:"header-title",children:i.name}),e.jsxs("div",{className:"header-actions",children:[(q.showEditButton||q.showDeleteButton)&&e.jsxs("div",{className:"actions-dropdown",children:[e.jsx("button",{className:"actions-trigger",children:e.jsx($T,{size:18})}),e.jsxs("div",{className:"actions-menu",children:[q.showEditButton&&e.jsxs("button",{className:"action-item edit",onClick:ae,children:[e.jsx(Sa,{size:14}),e.jsx("span",{children:"עריכה"})]}),q.showDeleteButton&&e.jsxs("button",{className:"action-item delete",onClick:oe,children:[e.jsx(_t,{size:14}),e.jsx("span",{children:"מחיקה"})]})]})]}),e.jsx("button",{className:"back-button",onClick:te,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${X?"active":""}`,onClick:De,children:[e.jsx(Je,{size:16}),i.type==="הרכב"?"פרטי הרכב":"פרטי התזמורת",X?e.jsx(Ft,{className:"toggle-icon",size:20}):e.jsx(gt,{className:"toggle-icon",size:20})]}),X&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"orchestra-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(We,{size:14}),"מנצח:"]}),e.jsx("span",{className:"info-value",children:k?"טוען...":R&&"personalInfo"in R?R.personalInfo.fullName:"לא הוגדר"})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(vt,{size:14}),"מיקום:"]}),e.jsx("span",{className:"info-value",children:i.location||"לא הוגדר"})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(ps,{size:14}),"תלמידים:"]}),e.jsx("span",{className:"info-value",children:((Be=i.memberIds)==null?void 0:Be.length)||0})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx($e,{size:14}),"חזרות:"]}),e.jsx("span",{className:"info-value",children:(g==null?void 0:g.length)||0})]})]})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${O?"active":""}`,onClick:be,children:[e.jsx(ps,{size:18}),"חברי תזמורת",O?e.jsx(Ft,{className:"toggle-icon",size:20}):e.jsx(gt,{className:"toggle-icon",size:20})]}),O&&e.jsx("div",{className:"section-content",children:i.memberIds&&i.memberIds.length>0?e.jsx("div",{className:"members-list",children:C?e.jsx("div",{className:"loading-message",children:"טוען תלמידים..."}):b.length>0?e.jsx("ul",{className:"members-items",children:b.map(V=>e.jsx("li",{className:"member-item clickable",onClick:()=>Oe(V._id),children:e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:V.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:V.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:V.academicInfo.instrument})]})]})},V._id))}):e.jsx("div",{className:"message-box",children:"לא ניתן לטעון את נתוני התלמידים"})}):e.jsx("div",{className:"warning-box",children:"אין תלמידים בתזמורת זו"})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${L?"active":""}`,onClick:Te,children:[e.jsx($e,{size:18}),"חזרות",L?e.jsx(Ft,{className:"toggle-icon",size:20}):e.jsx(gt,{className:"toggle-icon",size:20})]}),L&&e.jsxs("div",{className:"section-content",children:[q.canEdit&&e.jsx("div",{className:"add-rehearsal-btn-container",children:e.jsxs("button",{className:"btn primary add-rehearsal-btn",onClick:G,children:[e.jsx(ls,{size:16}),"הוסף חזרה"]})}),N?e.jsx("div",{className:"loading-message",children:"טוען חזרות..."}):g&&g.length>0?e.jsx("div",{className:"rehearsals-list",children:g.sort((V,ue)=>new Date(V.date).getTime()-new Date(ue.date).getTime()).map(V=>e.jsxs("div",{className:"rehearsal-item",onClick:()=>je(V._id),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"rehearsal-header",children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:16}),e.jsx("span",{children:F(V.date)})]}),q.canEdit&&e.jsxs("div",{className:"rehearsal-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:ue=>{ue.stopPropagation(),re(V)},children:e.jsx(Sa,{size:14})}),e.jsx("button",{className:"action-btn delete",onClick:ue=>{ue.stopPropagation(),pe(V._id)},children:e.jsx(yt,{size:14})})]})]}),e.jsxs("div",{className:"rehearsal-details",children:[e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:16}),e.jsxs("span",{children:[V.startTime," - ",V.endTime]})]}),e.jsxs("div",{className:"rehearsal-location",children:[e.jsx(vt,{size:16}),e.jsx("span",{children:V.location})]}),V.notes&&e.jsxs("div",{className:"rehearsal-notes",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:V.notes})]})]})]},V._id))}):e.jsx("div",{className:"warning-box",children:"אין חזרות רשומות לתזמורת זו"})]})]})]})]})})}),A&&e.jsx(oN,{isOpen:A,onClose:()=>_(!1),orchestra:i,onSave:()=>{_(!1),t&&l(t)}}),M&&e.jsx(pp,{isOpen:M,onClose:()=>z(!1),rehearsal:Z,orchestraId:t,onSave:()=>{z(!1),t&&v(t)}}),e.jsx(gs,{isOpen:D,onClose:()=>S(!1),onConfirm:ce,title:"מחיקת תזמורת",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק את התזמורת "',i.name,'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),e.jsx(gs,{isOpen:W,onClose:()=>K(!1),onConfirm:me,title:"מחיקת חזרה",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק חזרה זו?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}):e.jsx("div",{className:"not-found-state",children:"תזמורת לא נמצאה"})}function Z$({rehearsal:t,orchestraName:s,onView:n,onEdit:i,onRemove:l,onRemoveOrchestra:c,isToday:u=!1}){const f=(g,v)=>{const[j,N]=g.split(":").map(Number),[b,w]=v.split(":").map(Number),C=j*60+N;return b*60+w-C},p=g=>{const v=Math.floor(g/60),j=g%60;return v===0?`${j} דקות`:v===1&&j===0?"שעה אחת":v===1?`שעה ו-${j} דקות`:j===0?`${v} שעות`:`${v} שעות ו-${j} דקות`},m=f(t.startTime,t.endTime);return e.jsxs("div",{className:`rehearsal-preview ${u?"today-rehearsal":""}`,onClick:()=>n(t._id),children:[u&&e.jsx("div",{className:"today-badge",children:"היום"}),e.jsxs("div",{className:"preview-header",children:[e.jsx("h4",{children:s}),e.jsxs("div",{className:"time-info",children:[e.jsxs("span",{className:"time-range",children:[e.jsx(Ve,{size:18}),t.startTime," - ",t.endTime]}),e.jsxs("span",{className:"duration",children:["(",p(m),")"]})]})]}),e.jsxs("div",{className:"preview-content",children:[e.jsxs("div",{className:"location-info",children:[e.jsx(vt,{size:16}),e.jsx("span",{className:"location",children:t.location})]}),t.notes&&e.jsxs("div",{className:"notes-info",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:t.notes})]})]}),e.jsx("div",{className:"preview-footer",children:e.jsxs("div",{className:"action-buttons",children:[i&&e.jsx("button",{className:"action-btn edit",onClick:g=>{g.stopPropagation(),i(t._id)},"aria-label":"ערוך חזרה",children:e.jsx(Sa,{size:20})}),c&&e.jsx("button",{className:"action-btn delete",onClick:g=>{g.stopPropagation(),c(t.groupId,t._id)},"aria-label":"מחק חזרה",title:"מחק חזרה (אפשרויות מחיקה)",children:e.jsx(_t,{size:20})}),l&&!c&&e.jsx("button",{className:"action-btn delete",onClick:g=>{g.stopPropagation(),l(t._id)},"aria-label":"מחק חזרה",children:e.jsx(_t,{size:20})})]})})]})}function W$({rehearsals:t,isLoading:s,orchestras:n,onEdit:i,onView:l,onRemove:c,onRemoveOrchestra:u}){const f=x.useMemo(()=>{if(!t.length)return[];const g=new Date().toISOString().split("T")[0],v=t.reduce((j,N)=>{const b=N.date;return j[b]||(j[b]={date:b,rehearsals:[],isToday:b===g}),j[b].rehearsals.push(N),j},{});return Object.values(v).forEach(j=>{j.rehearsals.sort((N,b)=>N.startTime.localeCompare(b.startTime))}),Object.values(v).sort((j,N)=>j.isToday&&!N.isToday?-1:!j.isToday&&N.isToday?1:new Date(j.date).getTime()-new Date(N.date).getTime())},[t]);if(s&&t.length===0)return e.jsx("div",{className:"loading-state",children:"טוען חזרות..."});if(t.length===0)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו חזרות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף חזרות חדשות"})]});const p=(g,v)=>v?"חזרות היום":new Date(g).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=g=>{const v=n.find(j=>j._id===g);return v?v.name:"תזמורת לא מוגדרת"};return e.jsx("div",{className:"rehearsal-list-container",children:f.map(({date:g,rehearsals:v,isToday:j})=>e.jsxs("div",{className:`rehearsal-date-group ${j?"today-group":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx($e,{size:20}),e.jsx("h2",{children:p(g,j)})]}),e.jsx("div",{className:"rehearsal-grid",children:v.map(N=>e.jsx(Z$,{rehearsal:N,orchestraName:m(N.groupId),onEdit:i,onView:l,onRemove:c,onRemoveOrchestra:u,isToday:j},N._id))})]},g))})}function K$({isOpen:t,onClose:s,orchestraName:n,orchestraRehearsalsCount:i,onDeleteSingle:l,onDeleteAll:c}){const[u,f]=x.useState(null),p=()=>{f("single")},m=()=>{f("all")},g=()=>{u==="single"?l():u==="all"&&c(),f(null),s()},v=()=>{f(null),s()};if(u){const j=u==="all";return e.jsx(gs,{isOpen:!0,onClose:()=>f(null),onConfirm:g,title:j?"מחיקת כל החזרות":"מחיקת חזרה",message:j?`האם אתה בטוח שברצונך למחוק את כל ${i} החזרות של "${n}"? פעולה זו לא ניתנת לביטול.`:"האם אתה בטוח שברצונך למחוק חזרה זו? פעולה זו לא ניתנת לביטול.",confirmText:j?`מחק ${i} חזרות`:"מחק חזרה",cancelText:"ביטול",type:"danger"})}return e.jsx(Ta,{isOpen:t,onClose:v,children:e.jsxs("div",{className:"rehearsal-delete-dialog",children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx(yr,{size:24,className:"warning-icon"}),e.jsx("h3",{children:"מחיקת חזרה"})]}),e.jsxs("div",{className:"dialog-content",children:[e.jsx("p",{children:"בחר את סוג המחיקה שברצונך לבצע:"}),e.jsxs("div",{className:"delete-options",children:[e.jsxs("button",{className:"delete-option-btn single",onClick:p,children:[e.jsx(_t,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsx("div",{className:"option-title",children:"מחק חזרה זו בלבד"}),e.jsx("div",{className:"option-description",children:"מחיקה של חזרה יחידה זו"})]})]}),e.jsxs("button",{className:"delete-option-btn bulk",onClick:m,children:[e.jsx($e,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsxs("div",{className:"option-title",children:['מחק את כל החזרות של "',n,'"']}),e.jsxs("div",{className:"option-description",children:["מחיקה של כל ",i," החזרות של התזמורת"]})]})]})]})]}),e.jsx("div",{className:"dialog-actions",children:e.jsx("button",{className:"btn secondary",onClick:v,children:"ביטול"})})]})})}function J$(){var re;const{rehearsals:t,isLoading:s,error:n,loadRehearsals:i,removeRehearsal:l,removeRehearsalsByOrchestra:c}=_l(),{orchestras:u,loadOrchestras:f}=jr(),{addToast:p}=It(),[m,g]=y0(),v=m.get("orchestraId"),j=m.get("fromDate"),[N,b]=x.useState(!1),[w,C]=x.useState(null),[T,A]=x.useState(!1),[_,D]=x.useState(null),[S,R]=x.useState(!1),[E,k]=x.useState(null),[I,M]=x.useState(v),[z,Z]=x.useState(j),ee=Ot(),W=ys(),{user:K}=vs(),Q=K==null?void 0:K.roles.includes("מנהל"),ne=K==null?void 0:K.roles.includes("מנצח"),X=W.pathname.includes("/rehearsals/")&&!W.pathname.endsWith("/rehearsals/");x.useEffect(()=>{f();const pe={};if(v&&(pe.groupId=v,M(v)),j)pe.fromDate=j,Z(j);else{const je=new Date().toISOString().split("T")[0];pe.fromDate=je,Z(je)}i(pe)},[i,f,v,j]),x.useEffect(()=>{const pe=new URLSearchParams(m);I?pe.set("orchestraId",I):pe.delete("orchestraId"),g(pe)},[I,g]);const se=t,O=()=>{C(null),b(!0)},B=()=>{b(!1),C(null)},L=pe=>{const me=t.find(je=>je._id===pe)||null;C(me),b(!0)},Y=pe=>{ee(`/rehearsals/${pe}`)},H=async()=>{if(_)try{await l(_),p({type:"success",message:"החזרה נמחקה לצמיתות בהצלחה"}),D(null)}catch(pe){console.error("Failed to remove rehearsal:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}A(!1)},P=(pe,me)=>{const je=t.find(Oe=>Oe._id===me);je&&(k(je),R(!0))},q=async()=>{if(E)try{await l(E._id),p({type:"success",message:"החזרה נמחקה בהצלחה"})}catch(pe){console.error("Failed to remove rehearsal:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}},F=async()=>{if(E)try{const pe=await c(E.groupId);p({type:"success",message:`נמחקו ${pe.deletedCount} חזרות בהצלחה`})}catch(pe){console.error("Failed to remove orchestra rehearsals:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרות"})}},te=pe=>{const me=pe.target.value||null;M(me);const je=new URLSearchParams(m);me?je.set("orchestraId",me):je.delete("orchestraId"),g(je),i({groupId:me||void 0,fromDate:z||void 0})},ae=pe=>{const me=pe.target.value||null;Z(me);const je=new URLSearchParams(m);me?je.set("fromDate",me):je.delete("fromDate"),g(je),i({groupId:I||void 0,fromDate:me||void 0})},oe=()=>{M(null),Z(null),g(new URLSearchParams),i({})},ce=Q||ne,G=Q||ne;return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!X&&e.jsxs("div",{className:"page-header",children:[e.jsx("div",{className:"page-title",children:e.jsxs("h1",{children:[e.jsx($e,{className:"title-icon"}),"לוח חזרות"]})}),e.jsx("div",{className:"search-action-container-rehearsal",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("div",{className:"filter-dropdown",children:e.jsxs("select",{value:I||"",onChange:te,className:"filter-select",children:[e.jsx("option",{value:"",children:"כל התזמורות"}),u.map(pe=>e.jsx("option",{value:pe._id,children:pe.name},pe._id))]})}),e.jsx("div",{className:"filter-date",children:e.jsx("input",{type:"date",value:z||"",onChange:ae,className:"date-picker"})}),(I||z)&&e.jsx("button",{className:"btn secondary",onClick:oe,children:"איפוס"}),ce&&e.jsx("button",{className:"btn-icon add-btn",onClick:O,"aria-label":"הוספת חזרה חדשה",children:e.jsx(ls,{className:"icon"})})]})})]}),n&&e.jsx("div",{className:"error-message",children:n}),!X&&e.jsx(W$,{rehearsals:se,isLoading:s,onEdit:G?L:void 0,onView:Y,onRemoveOrchestra:Q?P:void 0,orchestras:u}),e.jsx(wl,{}),e.jsx(gs,{isOpen:T,onClose:()=>A(!1),onConfirm:H,title:"⚠️ מחיקה לצמיתות",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"זהירות: פעולת מחיקה לצמיתות!"})}),e.jsx("p",{children:"החזרה תימחק לצמיתות מהמערכת."}),e.jsx("p",{children:"כל נתוני הנוכחות והמידע הקשור יימחקו גם כן."}),e.jsx("p",{className:"text-sm text-muted",children:e.jsx("strong",{children:"פעולה זו לא ניתנת לביטול!"})})]}),confirmText:"מחק לצמיתות",cancelText:"ביטול",type:"danger"}),S&&E&&e.jsx(K$,{isOpen:S,onClose:()=>{R(!1),k(null)},orchestraName:((re=u.find(pe=>pe._id===E.groupId))==null?void 0:re.name)||"לא ידוע",orchestraRehearsalsCount:t.filter(pe=>pe.groupId===E.groupId).length,onDeleteSingle:async()=>{await q(),R(!1),k(null)},onDeleteAll:async()=>{await F(),R(!1),k(null)}}),N&&e.jsx(pp,{isOpen:N,onClose:B,rehearsal:w,orchestraId:I||"",onSave:i})]}),!X&&!N&&e.jsx(mi,{})]})}function Rj(){var ae,oe;const{rehearsalId:t}=Nr(),s=Ot(),{user:n}=vs(),{addToast:i}=It(),{selectedRehearsal:l,loadRehearsalById:c,removeRehearsal:u,updateAttendance:f,isLoading:p,error:m}=_l(),{loadOrchestraById:g}=jr(),{getStudentsByIds:v}=La(),[j,N]=x.useState(null),[b,w]=x.useState([]),[C,T]=x.useState(!1),[A,_]=x.useState(!1),[D,S]=x.useState(!1),[R,E]=x.useState(!1),[k,I]=x.useState([]),[M,z]=x.useState([]),[Z,ee]=x.useState(!1),[W,K]=x.useState(!1),[Q,ne]=x.useState(!1),X=((ae=n==null?void 0:n.roles)==null?void 0:ae.includes("מנהל"))||!1,se=((oe=n==null?void 0:n.roles)==null?void 0:oe.includes("מנצח"))||!1,O=X||se,B=X||se;x.useEffect(()=>{t&&c(t)},[t,c]),x.useEffect(()=>{(async()=>{if(l!=null&&l.groupId){T(!0);try{await g(l.groupId);const G=jr.getState();N(G.selectedOrchestra)}catch(G){console.error("Failed to load orchestra:",G)}finally{T(!1)}}})()},[l,g]),x.useEffect(()=>{(async()=>{if(j!=null&&j.memberIds&&j.memberIds.length>0){_(!0);try{const G=await v(j.memberIds);w(G)}catch(G){console.error("Failed to load students:",G)}finally{_(!1)}}else w([])})()},[j,v]),x.useEffect(()=>{l!=null&&l.attendance?(I(l.attendance.present||[]),z(l.attendance.absent||[])):(I([]),z([])),ee(!1)},[l]);const L=ce=>new Date(ce).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Y=ce=>{let G=[...k],re=[...M];k.includes(ce)?(G=G.filter(pe=>pe!==ce),re.push(ce)):(M.includes(ce)&&(re=re.filter(pe=>pe!==ce)),G.push(ce)),I(G),z(re),ee(!0),ne(!1)},H=ce=>k.includes(ce),P=async()=>{if(!(!t||!l)){K(!0);try{await f(t,{present:k,absent:M}),ne(!0),ee(!1),i({type:"success",message:"נוכחות עודכנה בהצלחה"}),await c(t)}catch(ce){console.error("Failed to update attendance:",ce),i({type:"danger",message:"אירעה שגיאה בעידכון הנוכחות"})}finally{K(!1)}}},q=()=>{S(!0)},F=()=>{j!=null&&j._id?s(`/rehearsals?orchestraId=${j._id}`):s("/rehearsals")},te=async()=>{if(l!=null&&l._id)try{await u(l._id),i({type:"success",message:"החזרה נמחקה לצמיתות בהצלחה"}),s("/rehearsals")}catch(ce){console.error("Failed to delete rehearsal:",ce),i({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}E(!1)};return p?e.jsx("div",{className:"loading-state",children:"טוען..."}):m?e.jsx("div",{className:"error-state",children:m}):l?e.jsxs("div",{className:"rehearsal-details",children:[e.jsx("div",{className:"rehearsal-details-page",children:e.jsx("div",{className:"rehearsal-card-container",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"rehearsal-header",children:[e.jsx("button",{className:"back-button",onClick:F,"aria-label":"חזור",children:e.jsx(Bs,{className:"lucide lucide-arrow-right"})}),e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"דיווח נוכחות לחזרה"}),e.jsxs("div",{className:"date-display",children:[e.jsx($e,{size:18}),e.jsx("span",{children:L(l.date)})]})]}),e.jsx("div",{className:"header-actions",children:O&&e.jsxs("button",{className:"action-btn edit",onClick:q,children:[e.jsx(Sa,{size:16}),"עריכה"]})})]}),e.jsxs("div",{className:"orchestra-info-card",children:[e.jsx("h3",{children:C?"טוען...":(j==null?void 0:j.name)||"לא מוגדר"}),e.jsxs("div",{className:"rehearsal-details-row",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"מיקום:"}),e.jsx("span",{className:"detail-value",children:l.location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"זמן:"}),e.jsxs("span",{className:"detail-value",children:[l.startTime," - ",l.endTime]})]})]})]}),e.jsx("div",{className:"attendance-section",children:e.jsx("div",{className:"students-list-container",children:A?e.jsx("div",{className:"loading-students",children:"טוען רשימת תלמידים..."}):b.length>0?e.jsx("ul",{className:"students-list",children:b.map(ce=>e.jsxs("li",{className:`student-item ${H(ce._id)?"present":""}`,children:[e.jsxs("div",{className:"student-info",children:[e.jsx("div",{className:"student-name",children:ce.personalInfo.fullName}),e.jsx("div",{className:"student-instrument",children:ce.academicInfo.instrument})]}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:H(ce._id),onChange:()=>Y(ce._id)}),e.jsx("span",{className:"toggle-slider"})]})]},ce._id))}):e.jsx("div",{className:"empty-students",children:"אין תלמידים רשומים לתזמורת זו"})})}),B&&e.jsxs("div",{className:"attendance-footer",children:[Q&&e.jsx("span",{className:"save-success",children:"הנוכחות עודכנה בהצלחה!"}),e.jsx("button",{className:"save-attendance-btn",onClick:P,disabled:!Z||W,children:W?"שומר...":"עדכן נוכחות"})]})]})})}),D&&e.jsx(pp,{isOpen:D,onClose:()=>S(!1),rehearsal:l,orchestraId:l.groupId,onSave:()=>{S(!1),t&&c(t)}}),e.jsx(gs,{isOpen:R,onClose:()=>E(!1),onConfirm:te,title:"מחיקת חזרה",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק את החזרה בתאריך "',L(l.date),'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}):e.jsx("div",{className:"not-found-state",children:"חזרה לא נמצאה"})}var Vd={exports:{}},eR=Vd.exports,Mj;function tR(){return Mj||(Mj=1,function(t,s){(function(n,i){t.exports=i()})(eR,function(){var n=1e3,i=6e4,l=36e5,c="millisecond",u="second",f="minute",p="hour",m="day",g="week",v="month",j="quarter",N="year",b="date",w="Invalid Date",C=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,T=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,A={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(W){var K=["th","st","nd","rd"],Q=W%100;return"["+W+(K[(Q-20)%10]||K[Q]||K[0])+"]"}},_=function(W,K,Q){var ne=String(W);return!ne||ne.length>=K?W:""+Array(K+1-ne.length).join(Q)+W},D={s:_,z:function(W){var K=-W.utcOffset(),Q=Math.abs(K),ne=Math.floor(Q/60),X=Q%60;return(K<=0?"+":"-")+_(ne,2,"0")+":"+_(X,2,"0")},m:function W(K,Q){if(K.date()<Q.date())return-W(Q,K);var ne=12*(Q.year()-K.year())+(Q.month()-K.month()),X=K.clone().add(ne,v),se=Q-X<0,O=K.clone().add(ne+(se?-1:1),v);return+(-(ne+(Q-X)/(se?X-O:O-X))||0)},a:function(W){return W<0?Math.ceil(W)||0:Math.floor(W)},p:function(W){return{M:v,y:N,w:g,d:m,D:b,h:p,m:f,s:u,ms:c,Q:j}[W]||String(W||"").toLowerCase().replace(/s$/,"")},u:function(W){return W===void 0}},S="en",R={};R[S]=A;var E="$isDayjsObject",k=function(W){return W instanceof Z||!(!W||!W[E])},I=function W(K,Q,ne){var X;if(!K)return S;if(typeof K=="string"){var se=K.toLowerCase();R[se]&&(X=se),Q&&(R[se]=Q,X=se);var O=K.split("-");if(!X&&O.length>1)return W(O[0])}else{var B=K.name;R[B]=K,X=B}return!ne&&X&&(S=X),X||!ne&&S},M=function(W,K){if(k(W))return W.clone();var Q=typeof K=="object"?K:{};return Q.date=W,Q.args=arguments,new Z(Q)},z=D;z.l=I,z.i=k,z.w=function(W,K){return M(W,{locale:K.$L,utc:K.$u,x:K.$x,$offset:K.$offset})};var Z=function(){function W(Q){this.$L=I(Q.locale,null,!0),this.parse(Q),this.$x=this.$x||Q.x||{},this[E]=!0}var K=W.prototype;return K.parse=function(Q){this.$d=function(ne){var X=ne.date,se=ne.utc;if(X===null)return new Date(NaN);if(z.u(X))return new Date;if(X instanceof Date)return new Date(X);if(typeof X=="string"&&!/Z$/i.test(X)){var O=X.match(C);if(O){var B=O[2]-1||0,L=(O[7]||"0").substring(0,3);return se?new Date(Date.UTC(O[1],B,O[3]||1,O[4]||0,O[5]||0,O[6]||0,L)):new Date(O[1],B,O[3]||1,O[4]||0,O[5]||0,O[6]||0,L)}}return new Date(X)}(Q),this.init()},K.init=function(){var Q=this.$d;this.$y=Q.getFullYear(),this.$M=Q.getMonth(),this.$D=Q.getDate(),this.$W=Q.getDay(),this.$H=Q.getHours(),this.$m=Q.getMinutes(),this.$s=Q.getSeconds(),this.$ms=Q.getMilliseconds()},K.$utils=function(){return z},K.isValid=function(){return this.$d.toString()!==w},K.isSame=function(Q,ne){var X=M(Q);return this.startOf(ne)<=X&&X<=this.endOf(ne)},K.isAfter=function(Q,ne){return M(Q)<this.startOf(ne)},K.isBefore=function(Q,ne){return this.endOf(ne)<M(Q)},K.$g=function(Q,ne,X){return z.u(Q)?this[ne]:this.set(X,Q)},K.unix=function(){return Math.floor(this.valueOf()/1e3)},K.valueOf=function(){return this.$d.getTime()},K.startOf=function(Q,ne){var X=this,se=!!z.u(ne)||ne,O=z.p(Q),B=function(ae,oe){var ce=z.w(X.$u?Date.UTC(X.$y,oe,ae):new Date(X.$y,oe,ae),X);return se?ce:ce.endOf(m)},L=function(ae,oe){return z.w(X.toDate()[ae].apply(X.toDate("s"),(se?[0,0,0,0]:[23,59,59,999]).slice(oe)),X)},Y=this.$W,H=this.$M,P=this.$D,q="set"+(this.$u?"UTC":"");switch(O){case N:return se?B(1,0):B(31,11);case v:return se?B(1,H):B(0,H+1);case g:var F=this.$locale().weekStart||0,te=(Y<F?Y+7:Y)-F;return B(se?P-te:P+(6-te),H);case m:case b:return L(q+"Hours",0);case p:return L(q+"Minutes",1);case f:return L(q+"Seconds",2);case u:return L(q+"Milliseconds",3);default:return this.clone()}},K.endOf=function(Q){return this.startOf(Q,!1)},K.$set=function(Q,ne){var X,se=z.p(Q),O="set"+(this.$u?"UTC":""),B=(X={},X[m]=O+"Date",X[b]=O+"Date",X[v]=O+"Month",X[N]=O+"FullYear",X[p]=O+"Hours",X[f]=O+"Minutes",X[u]=O+"Seconds",X[c]=O+"Milliseconds",X)[se],L=se===m?this.$D+(ne-this.$W):ne;if(se===v||se===N){var Y=this.clone().set(b,1);Y.$d[B](L),Y.init(),this.$d=Y.set(b,Math.min(this.$D,Y.daysInMonth())).$d}else B&&this.$d[B](L);return this.init(),this},K.set=function(Q,ne){return this.clone().$set(Q,ne)},K.get=function(Q){return this[z.p(Q)]()},K.add=function(Q,ne){var X,se=this;Q=Number(Q);var O=z.p(ne),B=function(H){var P=M(se);return z.w(P.date(P.date()+Math.round(H*Q)),se)};if(O===v)return this.set(v,this.$M+Q);if(O===N)return this.set(N,this.$y+Q);if(O===m)return B(1);if(O===g)return B(7);var L=(X={},X[f]=i,X[p]=l,X[u]=n,X)[O]||1,Y=this.$d.getTime()+Q*L;return z.w(Y,this)},K.subtract=function(Q,ne){return this.add(-1*Q,ne)},K.format=function(Q){var ne=this,X=this.$locale();if(!this.isValid())return X.invalidDate||w;var se=Q||"YYYY-MM-DDTHH:mm:ssZ",O=z.z(this),B=this.$H,L=this.$m,Y=this.$M,H=X.weekdays,P=X.months,q=X.meridiem,F=function(oe,ce,G,re){return oe&&(oe[ce]||oe(ne,se))||G[ce].slice(0,re)},te=function(oe){return z.s(B%12||12,oe,"0")},ae=q||function(oe,ce,G){var re=oe<12?"AM":"PM";return G?re.toLowerCase():re};return se.replace(T,function(oe,ce){return ce||function(G){switch(G){case"YY":return String(ne.$y).slice(-2);case"YYYY":return z.s(ne.$y,4,"0");case"M":return Y+1;case"MM":return z.s(Y+1,2,"0");case"MMM":return F(X.monthsShort,Y,P,3);case"MMMM":return F(P,Y);case"D":return ne.$D;case"DD":return z.s(ne.$D,2,"0");case"d":return String(ne.$W);case"dd":return F(X.weekdaysMin,ne.$W,H,2);case"ddd":return F(X.weekdaysShort,ne.$W,H,3);case"dddd":return H[ne.$W];case"H":return String(B);case"HH":return z.s(B,2,"0");case"h":return te(1);case"hh":return te(2);case"a":return ae(B,L,!0);case"A":return ae(B,L,!1);case"m":return String(L);case"mm":return z.s(L,2,"0");case"s":return String(ne.$s);case"ss":return z.s(ne.$s,2,"0");case"SSS":return z.s(ne.$ms,3,"0");case"Z":return O}return null}(oe)||O.replace(":","")})},K.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},K.diff=function(Q,ne,X){var se,O=this,B=z.p(ne),L=M(Q),Y=(L.utcOffset()-this.utcOffset())*i,H=this-L,P=function(){return z.m(O,L)};switch(B){case N:se=P()/12;break;case v:se=P();break;case j:se=P()/3;break;case g:se=(H-Y)/6048e5;break;case m:se=(H-Y)/864e5;break;case p:se=H/l;break;case f:se=H/i;break;case u:se=H/n;break;default:se=H}return X?se:z.a(se)},K.daysInMonth=function(){return this.endOf(v).$D},K.$locale=function(){return R[this.$L]},K.locale=function(Q,ne){if(!Q)return this.$L;var X=this.clone(),se=I(Q,ne,!0);return se&&(X.$L=se),X},K.clone=function(){return z.w(this.$d,this)},K.toDate=function(){return new Date(this.valueOf())},K.toJSON=function(){return this.isValid()?this.toISOString():null},K.toISOString=function(){return this.$d.toISOString()},K.toString=function(){return this.$d.toUTCString()},W}(),ee=Z.prototype;return M.prototype=ee,[["$ms",c],["$s",u],["$m",f],["$H",p],["$W",m],["$M",v],["$y",N],["$D",b]].forEach(function(W){ee[W[1]]=function(K){return this.$g(K,W[0],W[1])}}),M.extend=function(W,K){return W.$i||(W(K,Z,M),W.$i=!0),M},M.locale=I,M.isDayjs=k,M.unix=function(W){return M(1e3*W)},M.en=R[S],M.Ls=R,M.p={},M})}(Vd)),Vd.exports}var sR=tR();const lt=en(sR);var Gd={exports:{}},aR=Gd.exports,zj;function nR(){return zj||(zj=1,function(t,s){(function(n,i){t.exports=i()})(aR,function(){var n="minute",i=/[+-]\d\d(?::?\d\d)?/g,l=/([+-]|\d\d)/g;return function(c,u,f){var p=u.prototype;f.utc=function(w){var C={date:w,utc:!0,args:arguments};return new u(C)},p.utc=function(w){var C=f(this.toDate(),{locale:this.$L,utc:!0});return w?C.add(this.utcOffset(),n):C},p.local=function(){return f(this.toDate(),{locale:this.$L,utc:!1})};var m=p.parse;p.parse=function(w){w.utc&&(this.$u=!0),this.$utils().u(w.$offset)||(this.$offset=w.$offset),m.call(this,w)};var g=p.init;p.init=function(){if(this.$u){var w=this.$d;this.$y=w.getUTCFullYear(),this.$M=w.getUTCMonth(),this.$D=w.getUTCDate(),this.$W=w.getUTCDay(),this.$H=w.getUTCHours(),this.$m=w.getUTCMinutes(),this.$s=w.getUTCSeconds(),this.$ms=w.getUTCMilliseconds()}else g.call(this)};var v=p.utcOffset;p.utcOffset=function(w,C){var T=this.$utils().u;if(T(w))return this.$u?0:T(this.$offset)?v.call(this):this.$offset;if(typeof w=="string"&&(w=function(S){S===void 0&&(S="");var R=S.match(i);if(!R)return null;var E=(""+R[0]).match(l)||["-",0,0],k=E[0],I=60*+E[1]+ +E[2];return I===0?0:k==="+"?I:-I}(w),w===null))return this;var A=Math.abs(w)<=16?60*w:w,_=this;if(C)return _.$offset=A,_.$u=w===0,_;if(w!==0){var D=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(_=this.local().add(A+D,n)).$offset=A,_.$x.$localOffset=D}else _=this.utc();return _};var j=p.format;p.format=function(w){var C=w||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return j.call(this,C)},p.valueOf=function(){var w=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*w},p.isUTC=function(){return!!this.$u},p.toISOString=function(){return this.toDate().toISOString()},p.toString=function(){return this.toDate().toUTCString()};var N=p.toDate;p.toDate=function(w){return w==="s"&&this.$offset?f(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():N.call(this)};var b=p.diff;p.diff=function(w,C,T){if(w&&this.$u===w.$u)return b.call(this,w,C,T);var A=this.local(),_=f(w).local();return b.call(A,_,C,T)}}})}(Gd)),Gd.exports}var rR=nR();const iR=en(rR);var Qd={exports:{}},lR=Qd.exports,Lj;function oR(){return Lj||(Lj=1,function(t,s){(function(n,i){t.exports=i()})(lR,function(){var n={year:0,month:1,day:2,hour:3,minute:4,second:5},i={};return function(l,c,u){var f,p=function(j,N,b){b===void 0&&(b={});var w=new Date(j),C=function(T,A){A===void 0&&(A={});var _=A.timeZoneName||"short",D=T+"|"+_,S=i[D];return S||(S=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:T,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:_}),i[D]=S),S}(N,b);return C.formatToParts(w)},m=function(j,N){for(var b=p(j,N),w=[],C=0;C<b.length;C+=1){var T=b[C],A=T.type,_=T.value,D=n[A];D>=0&&(w[D]=parseInt(_,10))}var S=w[3],R=S===24?0:S,E=w[0]+"-"+w[1]+"-"+w[2]+" "+R+":"+w[4]+":"+w[5]+":000",k=+j;return(u.utc(E).valueOf()-(k-=k%1e3))/6e4},g=c.prototype;g.tz=function(j,N){j===void 0&&(j=f);var b,w=this.utcOffset(),C=this.toDate(),T=C.toLocaleString("en-US",{timeZone:j}),A=Math.round((C-new Date(T))/1e3/60),_=15*-Math.round(C.getTimezoneOffset()/15)-A;if(!Number(_))b=this.utcOffset(0,N);else if(b=u(T,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(_,!0),N){var D=b.utcOffset();b=b.add(w-D,"minute")}return b.$x.$timezone=j,b},g.offsetName=function(j){var N=this.$x.$timezone||u.tz.guess(),b=p(this.valueOf(),N,{timeZoneName:j}).find(function(w){return w.type.toLowerCase()==="timezonename"});return b&&b.value};var v=g.startOf;g.startOf=function(j,N){if(!this.$x||!this.$x.$timezone)return v.call(this,j,N);var b=u(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return v.call(b,j,N).tz(this.$x.$timezone,!0)},u.tz=function(j,N,b){var w=b&&N,C=b||N||f,T=m(+u(),C);if(typeof j!="string")return u(j).tz(C);var A=function(R,E,k){var I=R-60*E*1e3,M=m(I,k);if(E===M)return[I,E];var z=m(I-=60*(M-E)*1e3,k);return M===z?[I,M]:[R-60*Math.min(M,z)*1e3,Math.max(M,z)]}(u.utc(j,w).valueOf(),T,C),_=A[0],D=A[1],S=u(_).utcOffset(D);return S.$x.$timezone=C,S},u.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},u.tz.setDefault=function(j){f=j}}})}(Qd)),Qd.exports}var cR=oR();const dR=en(cR);var Xd={exports:{}},uR=Xd.exports,Bj;function hR(){return Bj||(Bj=1,function(t,s){(function(n,i){t.exports=i()})(uR,function(){return function(n,i,l){n=n||{};var c=i.prototype,u={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function f(m,g,v,j){return c.fromToBase(m,g,v,j)}l.en.relativeTime=u,c.fromToBase=function(m,g,v,j,N){for(var b,w,C,T=v.$locale().relativeTime||u,A=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],_=A.length,D=0;D<_;D+=1){var S=A[D];S.d&&(b=j?l(m).diff(v,S.d,!0):v.diff(m,S.d,!0));var R=(n.rounding||Math.round)(Math.abs(b));if(C=b>0,R<=S.r||!S.r){R<=1&&D>0&&(S=A[D-1]);var E=T[S.l];N&&(R=N(""+R)),w=typeof E=="string"?E.replace("%d",R):E(R,g,S.l,C);break}}if(g)return w;var k=C?T.future:T.past;return typeof k=="function"?k(w):k.replace("%s",w)},c.to=function(m,g){return f(m,g,this,!0)},c.from=function(m,g){return f(m,g,this)};var p=function(m){return m.$u?l.utc():l()};c.toNow=function(m){return this.to(p(this),m)},c.fromNow=function(m){return this.from(p(this),m)}}})}(Xd)),Xd.exports}var fR=hR();const mR=en(fR);var Zd={exports:{}},pR=Zd.exports,Fj;function gR(){return Fj||(Fj=1,function(t,s){(function(n,i){t.exports=i()})(pR,function(){var n,i,l=1e3,c=6e4,u=36e5,f=864e5,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m=31536e6,g=2628e6,v=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,j={years:m,months:g,days:f,hours:u,minutes:c,seconds:l,milliseconds:1,weeks:6048e5},N=function(R){return R instanceof D},b=function(R,E,k){return new D(R,k,E.$l)},w=function(R){return i.p(R)+"s"},C=function(R){return R<0},T=function(R){return C(R)?Math.ceil(R):Math.floor(R)},A=function(R){return Math.abs(R)},_=function(R,E){return R?C(R)?{negative:!0,format:""+A(R)+E}:{negative:!1,format:""+R+E}:{negative:!1,format:""}},D=function(){function R(k,I,M){var z=this;if(this.$d={},this.$l=M,k===void 0&&(this.$ms=0,this.parseFromMilliseconds()),I)return b(k*j[w(I)],this);if(typeof k=="number")return this.$ms=k,this.parseFromMilliseconds(),this;if(typeof k=="object")return Object.keys(k).forEach(function(W){z.$d[w(W)]=k[W]}),this.calMilliseconds(),this;if(typeof k=="string"){var Z=k.match(v);if(Z){var ee=Z.slice(2).map(function(W){return W!=null?Number(W):0});return this.$d.years=ee[0],this.$d.months=ee[1],this.$d.weeks=ee[2],this.$d.days=ee[3],this.$d.hours=ee[4],this.$d.minutes=ee[5],this.$d.seconds=ee[6],this.calMilliseconds(),this}}return this}var E=R.prototype;return E.calMilliseconds=function(){var k=this;this.$ms=Object.keys(this.$d).reduce(function(I,M){return I+(k.$d[M]||0)*j[M]},0)},E.parseFromMilliseconds=function(){var k=this.$ms;this.$d.years=T(k/m),k%=m,this.$d.months=T(k/g),k%=g,this.$d.days=T(k/f),k%=f,this.$d.hours=T(k/u),k%=u,this.$d.minutes=T(k/c),k%=c,this.$d.seconds=T(k/l),k%=l,this.$d.milliseconds=k},E.toISOString=function(){var k=_(this.$d.years,"Y"),I=_(this.$d.months,"M"),M=+this.$d.days||0;this.$d.weeks&&(M+=7*this.$d.weeks);var z=_(M,"D"),Z=_(this.$d.hours,"H"),ee=_(this.$d.minutes,"M"),W=this.$d.seconds||0;this.$d.milliseconds&&(W+=this.$d.milliseconds/1e3,W=Math.round(1e3*W)/1e3);var K=_(W,"S"),Q=k.negative||I.negative||z.negative||Z.negative||ee.negative||K.negative,ne=Z.format||ee.format||K.format?"T":"",X=(Q?"-":"")+"P"+k.format+I.format+z.format+ne+Z.format+ee.format+K.format;return X==="P"||X==="-P"?"P0D":X},E.toJSON=function(){return this.toISOString()},E.format=function(k){var I=k||"YYYY-MM-DDTHH:mm:ss",M={Y:this.$d.years,YY:i.s(this.$d.years,2,"0"),YYYY:i.s(this.$d.years,4,"0"),M:this.$d.months,MM:i.s(this.$d.months,2,"0"),D:this.$d.days,DD:i.s(this.$d.days,2,"0"),H:this.$d.hours,HH:i.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:i.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:i.s(this.$d.seconds,2,"0"),SSS:i.s(this.$d.milliseconds,3,"0")};return I.replace(p,function(z,Z){return Z||String(M[z])})},E.as=function(k){return this.$ms/j[w(k)]},E.get=function(k){var I=this.$ms,M=w(k);return M==="milliseconds"?I%=1e3:I=M==="weeks"?T(I/j[M]):this.$d[M],I||0},E.add=function(k,I,M){var z;return z=I?k*j[w(I)]:N(k)?k.$ms:b(k,this).$ms,b(this.$ms+z*(M?-1:1),this)},E.subtract=function(k,I){return this.add(k,I,!0)},E.locale=function(k){var I=this.clone();return I.$l=k,I},E.clone=function(){return b(this.$ms,this)},E.humanize=function(k){return n().add(this.$ms,"ms").locale(this.$l).fromNow(!k)},E.valueOf=function(){return this.asMilliseconds()},E.milliseconds=function(){return this.get("milliseconds")},E.asMilliseconds=function(){return this.as("milliseconds")},E.seconds=function(){return this.get("seconds")},E.asSeconds=function(){return this.as("seconds")},E.minutes=function(){return this.get("minutes")},E.asMinutes=function(){return this.as("minutes")},E.hours=function(){return this.get("hours")},E.asHours=function(){return this.as("hours")},E.days=function(){return this.get("days")},E.asDays=function(){return this.as("days")},E.weeks=function(){return this.get("weeks")},E.asWeeks=function(){return this.as("weeks")},E.months=function(){return this.get("months")},E.asMonths=function(){return this.as("months")},E.years=function(){return this.get("years")},E.asYears=function(){return this.as("years")},R}(),S=function(R,E,k){return R.add(E.years()*k,"y").add(E.months()*k,"M").add(E.days()*k,"d").add(E.hours()*k,"h").add(E.minutes()*k,"m").add(E.seconds()*k,"s").add(E.milliseconds()*k,"ms")};return function(R,E,k){n=k,i=k().$utils(),k.duration=function(z,Z){var ee=k.locale();return b(z,{$l:ee},Z)},k.isDuration=N;var I=E.prototype.add,M=E.prototype.subtract;E.prototype.add=function(z,Z){return N(z)?S(this,z,1):I.bind(this)(z,Z)},E.prototype.subtract=function(z,Z){return N(z)?S(this,z,-1):M.bind(this)(z,Z)}}})}(Zd)),Zd.exports}var yR=gR();const vR=en(yR);var Wd={exports:{}},xR=Wd.exports,Uj;function jR(){return Uj||(Uj=1,function(t,s){(function(n,i){t.exports=i()})(xR,function(){return function(n,i){i.prototype.isSameOrBefore=function(l,c){return this.isSame(l,c)||this.isBefore(l,c)}}})}(Wd)),Wd.exports}var bR=jR();const NR=en(bR);var Kd={exports:{}},SR=Kd.exports,Pj;function wR(){return Pj||(Pj=1,function(t,s){(function(n,i){t.exports=i()})(SR,function(){return function(n,i){i.prototype.isSameOrAfter=function(l,c){return this.isSame(l,c)||this.isAfter(l,c)}}})}(Kd)),Kd.exports}var TR=wR();const ER=en(TR);lt.extend(iR);lt.extend(dR);lt.extend(mR);lt.extend(vR);lt.extend(NR);lt.extend(ER);const is="Asia/Jerusalem",Ns="DD/MM/YYYY",hm="DD/MM/YYYY HH:MM",fm={0:"יום ראשון",1:"יום שני",2:"יום שלישי",3:"יום רביעי",4:"יום חמישי",5:"יום שישי",6:"יום שבת"};class Za{static formatLesson(s){var l;if(s.formatted){const c=lt.utc(s.date).tz(is),u=fm[c.day()];return{displayDate:((l=s.formatted.date)==null?void 0:l.replace(/Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday/g,"").trim())||c.format(Ns),displayTime:s.formatted.timeRange,displayDateTime:s.formatted.dateTime,dayName:u,relative:s.formatted.relative,isToday:s.formatted.isToday,isPast:s.formatted.isPast,isFuture:s.formatted.isFuture,createdAt:s.formatted.createdAt,updatedAt:s.formatted.updatedAt,rawDate:s.date,rawStartTime:s.startTime,rawEndTime:s.endTime}}const n=lt.utc(s.date).tz(is),i=lt().tz(is);return{displayDate:n.format(Ns),displayTime:s.startTime&&s.endTime?`${s.startTime}-${s.endTime}`:"",displayDateTime:s.startTime?`${n.format(Ns)} ${s.startTime}`:n.format(Ns),dayName:fm[n.day()],relative:n.fromNow(),isToday:n.isSame(i,"day"),isPast:n.isBefore(i,"day"),isFuture:n.isAfter(i,"day"),createdAt:s.createdAt?lt.utc(s.createdAt).tz(is).format(hm):void 0,updatedAt:s.updatedAt?lt.utc(s.updatedAt).tz(is).format(hm):void 0,rawDate:s.date,rawStartTime:s.startTime,rawEndTime:s.endTime}}static formatAttendance(s){var l,c;if(s.formatted)return{displayDate:s.formatted.date,markedAt:s.formatted.markedAt,markedAtRelative:s.formatted.markedAtRelative,attendanceRate:s.formatted.attendanceRate,presentCount:s.formatted.presentCount,absentCount:s.formatted.absentCount,totalStudents:s.formatted.totalStudents};const n=s.date?lt.utc(s.date).tz(is):null,i=s.markedAt?lt.utc(s.markedAt).tz(is):null;return{displayDate:n?n.format(Ns):"",markedAt:i?i.format(hm):void 0,markedAtRelative:i?i.fromNow():void 0,attendanceRate:void 0,presentCount:s.present?s.present.length:0,absentCount:s.absent?s.absent.length:0,totalStudents:(((l=s.present)==null?void 0:l.length)||0)+(((c=s.absent)==null?void 0:c.length)||0)}}static formatForAPI(s){if(!s)return null;if(typeof s=="string"){if(s.match(/^\d{4}-\d{2}-\d{2}$/))return s;if(s.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[n,i,l]=s.split("/");return`${l}-${i.padStart(2,"0")}-${n.padStart(2,"0")}`}if(s.match(/^\d{2}-\d{2}-\d{4}$/)){const[n,i,l]=s.split("-");return`${l}-${i.padStart(2,"0")}-${n.padStart(2,"0")}`}}return lt(s).tz(is).format("YYYY-MM-DD")}static getHebrewDayName(s){let n=s;typeof s=="string"&&(n=s.replace(/Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday/g,"").trim());const i=lt(n).day();return fm[i]}static isUpcoming(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isSameOrAfter(i,"day")}static isPast(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isBefore(i,"day")}static isToday(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isSame(i,"day")}static parseUserDate(s){if(!s)return null;const n=["DD/MM/YYYY","DD-MM-YYYY","YYYY-MM-DD","DD/MM/YY","DD-MM-YY"];for(const l of n){const c=lt(s,l,!0);if(c.isValid())return c.tz(is)}const i=lt(s);return i.isValid()?i.tz(is):null}static validateDate(s){if(!s)return{valid:!1,error:"Date is required",errorCode:"REQUIRED"};const n=this.parseUserDate(String(s));if(!n)return{valid:!1,error:"Invalid date format. Please use DD/MM/YYYY or select from calendar",errorCode:"INVALID_FORMAT",expectedFormats:["DD/MM/YYYY","DD-MM-YYYY","YYYY-MM-DD"]};const i=lt().subtract(2,"years");if(n.isBefore(i))return{valid:!1,error:"Date cannot be more than 2 years in the past",errorCode:"TOO_OLD"};const l=lt().add(2,"years");return n.isAfter(l)?{valid:!1,error:"Date cannot be more than 2 years in the future",errorCode:"TOO_FUTURE"}:{valid:!0,parsed:n,formatted:n.format(Ns),apiFormat:n.format("YYYY-MM-DD")}}static validateTime(s){return s?/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(s)?{valid:!0,formatted:s,display:s}:{valid:!1,error:"Time must be in HH:MM format (e.g., 14:30)",errorCode:"INVALID_FORMAT"}:{valid:!1,error:"Time is required",errorCode:"REQUIRED"}}static validateTimeRange(s,n){const i=this.validateTime(s);if(!i.valid)return{valid:!1,error:`Start time error: ${i.error}`,field:"startTime"};const l=this.validateTime(n);if(!l.valid)return{valid:!1,error:`End time error: ${l.error}`,field:"endTime"};const c=lt(`2000-01-01 ${s}`),u=lt(`2000-01-01 ${n}`);return c.isSameOrAfter(u)?{valid:!1,error:"End time must be after start time",field:"endTime",errorCode:"INVALID_RANGE"}:u.diff(c,"minutes")<15?{valid:!1,error:"Lesson must be at least 15 minutes long",field:"endTime",errorCode:"TOO_SHORT"}:{valid:!0,duration:u.diff(c,"minutes"),durationDisplay:`${Math.floor(u.diff(c,"minutes")/60)}h ${u.diff(c,"minutes")%60}m`}}static getDateRanges(){const s=lt().tz(is);return{today:{label:"Today",labelHe:"היום",fromDate:s.format("YYYY-MM-DD"),toDate:s.format("YYYY-MM-DD"),display:s.format(Ns)},tomorrow:{label:"Tomorrow",labelHe:"מחר",fromDate:s.add(1,"day").format("YYYY-MM-DD"),toDate:s.add(1,"day").format("YYYY-MM-DD"),display:s.add(1,"day").format(Ns)},thisWeek:{label:"This Week",labelHe:"השבוע",fromDate:s.startOf("week").format("YYYY-MM-DD"),toDate:s.endOf("week").format("YYYY-MM-DD"),display:`${s.startOf("week").format(Ns)} - ${s.endOf("week").format(Ns)}`},nextWeek:{label:"Next Week",labelHe:"השבוע הבא",fromDate:s.add(1,"week").startOf("week").format("YYYY-MM-DD"),toDate:s.add(1,"week").endOf("week").format("YYYY-MM-DD"),display:`${s.add(1,"week").startOf("week").format(Ns)} - ${s.add(1,"week").endOf("week").format(Ns)}`},thisMonth:{label:"This Month",labelHe:"החודש",fromDate:s.startOf("month").format("YYYY-MM-DD"),toDate:s.endOf("month").format("YYYY-MM-DD"),display:s.format("MMMM YYYY")},nextMonth:{label:"Next Month",labelHe:"החודש הבא",fromDate:s.add(1,"month").startOf("month").format("YYYY-MM-DD"),toDate:s.add(1,"month").endOf("month").format("YYYY-MM-DD"),display:s.add(1,"month").format("MMMM YYYY")},next7Days:{label:"Next 7 Days",labelHe:"7 הימים הבאים",fromDate:s.format("YYYY-MM-DD"),toDate:s.add(7,"days").format("YYYY-MM-DD"),display:`${s.format(Ns)} - ${s.add(7,"days").format(Ns)}`},next30Days:{label:"Next 30 Days",labelHe:"30 הימים הבאים",fromDate:s.format("YYYY-MM-DD"),toDate:s.add(30,"days").format("YYYY-MM-DD"),display:`${s.format(Ns)} - ${s.add(30,"days").format(Ns)}`}}}static isSchoolDay(s){const n=lt(s).day();return n>=0&&n<=4}static getNextSchoolDay(s=null){let n=s?lt(s):lt();for(;!this.isSchoolDay(n);)n=n.add(1,"day");return n.tz(is)}static formatConflicts(s){if(!s)return null;const n={hasConflicts:!1,room:[],teacher:[],total:0};return s.room&&s.room.length>0&&(n.hasConflicts=!0,n.room=s.room.map(i=>({type:"room",description:i.description,lesson:i.conflictingLesson,severity:"high"}))),s.teacher&&s.teacher.length>0&&(n.hasConflicts=!0,n.teacher=s.teacher.map(i=>({type:"teacher",description:i.description,lesson:i.conflictingLesson,severity:"medium"}))),n.total=n.room.length+n.teacher.length,n}}const CR=oi.memo(function({theoryLesson:s,teacherName:n,onView:i,onEdit:l,onRemove:c,showRelativeTime:u=!1,compact:f=!1,isToday:p=!1}){var E;const m="שעה",g="שעות",v="דקות",j="אחת",N="ו-";if(!s||!s._id)return console.error("TheoryPreview: Invalid theory lesson data",s),null;const b=x.useMemo(()=>Za.formatLesson(s),[s]),w=x.useMemo(()=>{var z,Z;if(!s.attendance)return null;const k=((z=s.attendance.present)==null?void 0:z.length)||0,I=((Z=s.attendance.absent)==null?void 0:Z.length)||0,M=k+I;return{present:k,absent:I,total:M,rate:M>0?(k/M*100).toFixed(0):0}},[s.attendance]),C=(k,I)=>{try{const[M,z]=k.split(":").map(Number),[Z,ee]=I.split(":").map(Number),W=M*60+z;return Z*60+ee-W}catch(M){return console.error("Error calculating duration:",M,{startTime:k,endTime:I}),60}},T=k=>{const I=Math.floor(k/60),M=k%60;return I===0?`${M} ${v}`:I===1&&M===0?`${m} ${j}`:I===1?`${m} ${N}${M} ${v}`:M===0?`${I} ${g}`:`${I} ${g} ${N}${M} ${v}`},A=s.startTime||"09:00",_=s.endTime||"10:00",D=C(A,_),S=((E=s.studentIds)==null?void 0:E.length)||0,R=["theory-preview",b.isToday&&"today-theory",b.isPast&&"theory-preview--past",b.isFuture&&"theory-preview--future",f&&"theory-preview--compact"].filter(Boolean).join(" ");return e.jsxs("div",{className:R,onClick:()=>i(s._id),role:"button",tabIndex:0,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&i(s._id)},children:[e.jsxs("div",{className:"theory-preview__badges",children:[b.isToday&&e.jsx("div",{className:"today-badge",children:"היום"}),b.isPast&&e.jsx("div",{className:"past-badge",children:"עבר"}),b.isFuture&&e.jsx("div",{className:"future-badge",children:"עתיד"})]}),e.jsxs("div",{className:"preview-header",children:[e.jsx("div",{className:"category-section",children:e.jsx("h4",{className:"category-title",style:{color:"var(--text-primary) !important",webkitTextFillColor:"var(--text-primary) !important",backgroundClip:"initial !important",webkitBackgroundClip:"initial !important"},children:s.category&&s.category.trim()!==""?s.category:"שיעור תאוריה"})}),e.jsxs("div",{className:"time-section",children:[e.jsxs("div",{className:"main-time-badge",children:[e.jsx(Ve,{size:14}),e.jsxs("div",{className:"time-content",children:[e.jsx("span",{className:"time-range",children:b.displayTime}),e.jsx("span",{className:"duration",style:{fontFamily:"'Reisinger Amir', 'David', 'Noto Sans Hebrew', 'Arial Hebrew', sans-serif"},children:T(D)})]})]}),u&&b.relative&&e.jsx("div",{className:"relative-badge",children:e.jsx("span",{className:"relative-text",children:b.relative})})]})]}),e.jsxs("div",{className:"preview-content",children:[e.jsx("div",{className:"info-badge teacher-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"מורה"}),e.jsx("span",{className:"badge-value",children:n})]})}),e.jsx("div",{className:"info-badge location-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"מיקום"}),e.jsx("span",{className:"badge-value",children:s.location})]})}),e.jsx("div",{className:"info-badge students-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"תלמידים"}),e.jsxs("div",{className:"students-info",children:[e.jsx("span",{className:"student-count",children:S}),w&&w.total>0&&e.jsxs("span",{className:"attendance-rate",children:["(",w.present,"/",w.total,")"]})]})]})}),!f&&e.jsxs(e.Fragment,{children:[s.notes&&e.jsxs("div",{className:"notes-info",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:s.notes})]}),s.syllabus&&e.jsxs("div",{className:"syllabus-info",children:[e.jsx("span",{className:"syllabus-label",children:"סילבוס:"}),e.jsx("span",{className:"syllabus-text",children:s.syllabus})]})]})]}),e.jsxs("div",{className:"preview-footer",children:[!f&&b.updatedAt&&e.jsx("div",{className:"metadata",children:e.jsxs("span",{className:"updated-at",children:["עודכן: ",b.updatedAt]})}),e.jsxs("div",{className:"action-buttons",children:[l&&e.jsx("button",{className:"action-btn edit",onClick:k=>{k.stopPropagation(),l(s._id)},"aria-label":"ערוך שיעור",children:e.jsx(Sa,{size:14})}),c&&e.jsx("button",{className:"action-btn delete",onClick:k=>{k.stopPropagation(),c(s._id)},"aria-label":"מחק שיעור",children:e.jsx(_t,{size:14})})]})]})]})});function AR({theoryLessons:t,isLoading:s,teachers:n,onEdit:i,onView:l,onRemove:c}){const u=x.useMemo(()=>{if(!t.length)return[];const g=Za.formatForAPI(new Date),j=t.filter(N=>!Za.isPast(N.date)).reduce((N,b)=>{const w=Za.formatForAPI(b.date);return w&&(N[w]||(N[w]={date:w,theoryLessons:[],isToday:w===g,isPast:Za.isPast(w),isUpcoming:Za.isUpcoming(w)}),N[w].theoryLessons.push(b)),N},{});return Object.values(j).forEach(N=>{N.theoryLessons.sort((b,w)=>{const C=b.startTime||"00:00",T=w.startTime||"00:00";return C.localeCompare(T)})}),Object.values(j).sort((N,b)=>N.isToday&&!b.isToday?-1:!N.isToday&&b.isToday?1:new Date(N.date).getTime()-new Date(b.date).getTime())},[t]);if(s&&t.length===0)return e.jsx("div",{className:"loading-state",children:"טוען שיעורי תאוריה..."});const f=t.some(g=>{const v=g.date.split("T")[0];return!Za.isPast(v)});if(t.length===0)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו שיעורי תאוריה להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף שיעורים חדשים"})]});if(!f)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"אין שיעורי תאוריה עתידיים או נוכחיים"}),e.jsx("p",{children:"כל השיעורים הקיימים הם מהעבר. הוסף שיעורים חדשים או בדוק את המסננים"})]});const p=(g,v,j,N)=>{if(v)return"שיעורי תאוריה היום";const b=Za.getHebrewDayName(g),C=new Date(g).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"});return j?`${b}, ${C} (עבר)`:N?`${b}, ${C}`:`${b}, ${C}`},m=g=>{var j;if(!g||!n)return"מדריך לא מוגדר";const v=n.find(N=>N._id===g);return((j=v==null?void 0:v.personalInfo)==null?void 0:j.fullName)||"מדריך לא מוגדר"};return e.jsx("div",{className:"theory-list-container",children:u.map(({date:g,theoryLessons:v,isToday:j,isPast:N,isUpcoming:b})=>e.jsxs("div",{className:`theory-date-group ${j?"today-group":""} ${N?"past-group":""} ${b?"upcoming-group":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx(Vt,{size:18}),e.jsx("h2",{children:p(g,j,N,b)})]}),e.jsx("div",{className:"theory-grid",children:v.filter(w=>w&&w._id).map((w,C)=>e.jsx(CR,{theoryLesson:w,teacherName:m(w.teacherId),onEdit:i,onView:l,onRemove:c,isToday:j},w._id||`theory-${g}-${C}`))})]},g))})}const DR=at().shape({category:Ae().required("קטגוריה היא שדה חובה"),teacherId:Ae().required("יש לבחור מורה תאוריה"),date:Ls().required("תאריך הוא שדה חובה"),startTime:Ae().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת התחלה היא שדה חובה"),endTime:Ae().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת סיום היא שדה חובה").test("is-greater","שעת הסיום חייבת להיות אחרי שעת ההתחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ae().required("מיקום הוא שדה חובה"),notes:Ae(),syllabus:Ae(),homework:Ae(),schoolYearId:Ae().required("שנת לימודים חובה"),dayOfWeek:Pa().min(0).max(6)}),kR=at().shape({category:Ae().required("קטגוריה היא שדה חובה"),teacherId:Ae().required("יש לבחור מורה תאוריה"),startDate:Ls().required("תאריך התחלה הוא שדה חובה"),endDate:Ls().required("תאריך סיום הוא שדה חובה").min(BI("startDate"),"תאריך הסיום חייב להיות אחרי תאריך ההתחלה"),dayOfWeek:Pa().required("יום בשבוע הוא שדה חובה").min(0,"יום בשבוע חייב להיות בין 0 ל-6").max(6,"יום בשבוע חייב להיות בין 0 ל-6"),startTime:Ae().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת התחלה היא שדה חובה"),endTime:Ae().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת סיום היא שדה חובה").test("is-greater","שעת הסיום חייבת להיות אחרי שעת ההתחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ae().required("מיקום הוא שדה חובה"),notes:Ae(),syllabus:Ae(),excludeDates:es().of(Ae()),schoolYearId:Ae().required("שנת לימודים חובה")}),du=t=>t.toISOString().split("T")[0],_R=(t,s="")=>{const n=new Date;return t!=null&&t._id?{_id:t._id,category:t.category||Xo[0],teacherId:t.teacherId||"",date:t.date||du(n),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||Zo[0],notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||s,dayOfWeek:t.dayOfWeek||n.getDay(),studentIds:t.studentIds||[]}:{_id:void 0,category:Xo[0],teacherId:"",date:du(n),startTime:"14:00",endTime:"15:00",location:Zo[0],notes:"",syllabus:"",homework:"",schoolYearId:s,dayOfWeek:n.getDay(),studentIds:[]}},OR=(t="")=>{const s=new Date,n=new Date(s);return n.setMonth(s.getMonth()+3),{category:Xo[0],teacherId:"",startDate:du(s),endDate:du(n),dayOfWeek:s.getDay(),startTime:"14:00",endTime:"15:00",location:Zo[0],notes:"",syllabus:"",excludeDates:[],schoolYearId:t,studentIds:[]}};function cN({isOpen:t,onClose:s,onSubmit:n,onBulkSubmit:i,theoryLesson:l,theoryTeachers:c,isLoading:u=!1}){const{modalProps:f,titleProps:p,descriptionProps:m}=Al({isOpen:t,onClose:s,modalId:"theory-form",restoreFocusOnClose:!0}),{currentSchoolYear:g,loadCurrentSchoolYear:v}=na(),{students:j,saveStudent:N,loadStudents:b}=La(),[w,C]=x.useState("bulk"),[T,A]=x.useState(""),[_,D]=x.useState([]),[S,R]=x.useState(""),[E,k]=x.useState(!1),[I,M]=x.useState(!1),z=x.useRef(null),Z=x.useCallback(L=>{R(L.target.value),k(L.target.value.length>0)},[]),ee=x.useCallback(()=>S?j.filter(L=>L.personalInfo.fullName.includes(S)&&!_.some(Y=>Y._id===L._id)).slice(0,10):[],[S,j,_]),W=x.useCallback((L,Y)=>{const H=[..._,L];D(H),Y("studentIds",H.map(P=>P._id)),R(""),k(!1)},[_]),K=x.useCallback((L,Y)=>{D(H=>{const P=H.filter(q=>q._id!==L);return Y("studentIds",P.map(q=>q._id)),P})},[]);if(x.useEffect(()=>{l!=null&&l._id&&C("single"),(async()=>{try{console.log("Loading current school year...");const Y=await v();console.log("Loaded school year:",Y)}catch(Y){console.error("Failed to load school year:",Y)}})()},[l,v]),x.useEffect(()=>{j.length===0&&b()},[j.length,b]),x.useEffect(()=>{if(j.length>0&&(l!=null&&l.studentIds)&&l.studentIds.length>0){M(!0);const L=j.filter(Y=>{var H;return(H=l==null?void 0:l.studentIds)==null?void 0:H.includes(Y._id)});D(L),M(!1)}else D([])},[l==null?void 0:l.studentIds,j]),x.useEffect(()=>{function L(Y){z.current&&!z.current.contains(Y.target)&&k(!1)}return document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[]),!t)return null;const Q=L=>{l!=null&&l._id||C(L)},ne=async(L,Y,H)=>{try{const P=H.filter(F=>!Y.includes(F)),q=Y.filter(F=>!H.includes(F));console.log("Updating student references:",{adding:P.length,removing:q.length});for(const F of P){const te=j.find(ae=>ae._id===F);te&&(!te.enrollments.theoryLessonIds||!te.enrollments.theoryLessonIds.includes(L))&&await N({_id:te._id,enrollments:{...te.enrollments,theoryLessonIds:[...te.enrollments.theoryLessonIds||[],L]}})}for(const F of q){const te=j.find(ae=>ae._id===F);te&&te.enrollments.theoryLessonIds&&await N({_id:te._id,enrollments:{...te.enrollments,theoryLessonIds:te.enrollments.theoryLessonIds.filter(ae=>ae!==L)}})}}catch(P){console.error("Error updating student references:",P)}},X=async L=>{try{const Y=L.schoolYearId||(g==null?void 0:g._id);if(!Y)throw new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const H={...L,schoolYearId:Y},P=await n(H);P!=null&&P._id&&await ne(P._id,(l==null?void 0:l.studentIds)||[],L.studentIds)}catch(Y){throw Y}},se=async L=>{try{console.log("Bulk submit handler called with values:",L);const Y=L.schoolYearId||(g==null?void 0:g._id);if(!Y)throw new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const H={...L,dayOfWeek:Number(L.dayOfWeek),schoolYearId:Y};console.log("Calling onBulkSubmit with data:",H),await i(H),console.log("Bulk creation completed successfully")}catch(Y){throw console.error("Error in handleBulkSubmit:",Y),Y}},O=(L,Y,H)=>{if(L&&Y.excludeDates&&!Y.excludeDates.includes(L)){const P=[...Y.excludeDates||[],L];H("excludeDates",P),A("")}},B=(L,Y,H)=>{if(!Y.excludeDates)return;const P=Y.excludeDates.filter(q=>q!==L);H("excludeDates",P)};return e.jsx(Ta,{isOpen:t,onClose:s,className:"theory-form-overlay responsive-form",children:e.jsxs("div",{className:"form-modal",...f,onClick:L=>L.stopPropagation(),children:[e.jsx("div",{...m,className:"sr-only",children:l!=null&&l._id?"טופס עריכת שיעור תאוריה קיים במערכת":"טופס הוספת שיעור תאוריה חדש למערכת"}),e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"close-button",onClick:s,type:"button","aria-label":"סגור",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...p,children:l!=null&&l._id?"עריכת שיעור תאוריה":"הוספת שיעור תאוריה חדש"})]}),!(l!=null&&l._id)&&e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{type:"button",className:w==="bulk"?"active primary":"secondary",onClick:()=>Q("bulk"),children:"סדרת שיעורים"}),e.jsx("button",{type:"button",className:w==="single"?"active primary":"secondary",onClick:()=>Q("single"),children:"שיעור בודד"})]}),w==="single"?e.jsx(xr,{initialValues:_R(l||null,(g==null?void 0:g._id)||""),validationSchema:DR,onSubmit:X,enableReinitialize:!0,children:({setFieldValue:L,isSubmitting:Y})=>e.jsxs($n,{className:"theory-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי שיעור תאוריה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"קטגוריה",name:"category",as:"select",required:!0,labelIcon:e.jsx(Vt,{size:16}),children:Xo.map(H=>e.jsx("option",{value:H,children:H},H))}),e.jsxs(Le,{label:"מורה תאוריה",name:"teacherId",as:"select",required:!0,labelIcon:e.jsx(We,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מדריך..."}),c.map(H=>e.jsx("option",{value:H._id,children:H.personalInfo.fullName},H._id))]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"date",children:[e.jsx($e,{size:16}),"תאריך *"]}),e.jsx($a,{name:"date",type:"date",required:!0,onChange:H=>{const P=H.target.value;if(P){const F=new Date(P).getDay();L("dayOfWeek",F)}L("date",P)}})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"dayOfWeek",children:[e.jsx(xm,{size:16,className:"icon"}),"יום בשבוע (מחושב אוטומטית)"]}),e.jsx($a,{as:"select",name:"dayOfWeek",id:"dayOfWeek",disabled:!0,children:Fm.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Le,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(vt,{size:16}),children:Zo.map(H=>e.jsx("option",{value:H,children:H},H))})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"סילבוס",name:"syllabus",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"שיעורי בית",name:"homework",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תלמידים (משתתפי השיעור)"}),e.jsxs("div",{ref:z,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(gr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:S,onChange:Z,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>S.length>0,disabled:Y})]}),E&&ee().length>0&&!Y&&e.jsx("div",{className:"search-results-dropdown",children:ee().map(H=>e.jsxs("div",{className:"search-result-item",onClick:()=>W(H,L),children:[e.jsx(We,{size:16,className:"student-icon"}),e.jsx("span",{children:H.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:H.academicInfo.instrument})]},H._id))})]}),e.jsx("div",{className:"selected-members-list",children:I?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):_.length>0?e.jsx("ul",{className:"members-items",children:_.map(H=>e.jsxs("li",{className:"member-item",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:H.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:H.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:H.academicInfo.instrument})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>K(H._id,L),"aria-label":`הסר את ${H.personalInfo.fullName}`,disabled:Y,children:e.jsx(yt,{size:14})})]},H._id))}):e.jsx("div",{className:"no-members-message",children:"לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים לשיעור."})})]})}),e.jsx($a,{type:"hidden",name:"schoolYearId",value:(g==null?void 0:g._id)||""}),e.jsx($a,{type:"hidden",name:"studentIds"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:u,children:u?"שומר...":l!=null&&l._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}):e.jsx(xr,{initialValues:{...OR((g==null?void 0:g._id)||""),excludeDates:[]},validationSchema:kR,onSubmit:async(L,Y)=>{console.log("Formik onSubmit called with values:",L);try{if(!L.category)throw new Error("Category is required");if(!L.teacherId)throw new Error("Teacher is required");if(!L.startDate||!L.endDate)throw new Error("Start and end dates are required");if(L.dayOfWeek===void 0||L.dayOfWeek===null)throw new Error("Day of week is required");if(!L.startTime||!L.endTime)throw new Error("Start and end times are required");if(!L.location)throw new Error("Location is required");await se(L),console.log("Bulk submit succeeded"),Y.resetForm(),s()}catch(H){console.error("Bulk submit failed:",H)}finally{Y.setSubmitting(!1)}},enableReinitialize:!0,children:({values:L,setFieldValue:Y,handleSubmit:H,isSubmitting:P})=>e.jsxs($n,{className:"theory-form",onSubmit:q=>{console.log("Bulk form submit event triggered"),q.preventDefault(),H(q)},children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי שיעור תאוריה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"קטגוריה",name:"category",as:"select",required:!0,labelIcon:e.jsx(Vt,{size:16}),children:Xo.map(q=>e.jsx("option",{value:q,children:q},q))}),e.jsxs(Le,{label:"מורה תאוריה",name:"teacherId",as:"select",required:!0,labelIcon:e.jsx(We,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מדריך..."}),c.map(q=>e.jsx("option",{value:q._id,children:q.personalInfo.fullName},q._id))]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"תאריך התחלה",name:"startDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})}),e.jsx(Le,{label:"תאריך סיום",name:"endDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})]}),e.jsxs("div",{className:"form-row full-width",children:[e.jsx(Le,{label:"יום בשבוע",name:"dayOfWeek",as:"select",required:!0,labelIcon:e.jsx(xm,{size:16}),children:Fm.map(q=>e.jsx("option",{value:q.value,children:q.label},q.value))}),e.jsxs("div",{className:"help-text",style:{marginTop:"-15px",paddingRight:"16px"},children:["שיעורים ייווצרו בכל יום ",aN(Number(L.dayOfWeek))," ","בטווח התאריכים שנבחר"]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16,className:"icon"}),"תאריכים לדילוג"]}),e.jsxs("div",{className:"exclude-dates-input",children:[e.jsx("input",{type:"date",value:T,onChange:q=>A(q.target.value),min:L.startDate,max:L.endDate}),e.jsx("button",{type:"button",onClick:()=>O(T,L,Y),className:"add-date",disabled:!T,children:"הוסף"})]}),e.jsx("div",{className:"exclude-dates-list",children:L.excludeDates&&L.excludeDates.length>0?L.excludeDates.map(q=>e.jsxs("div",{className:"exclude-date-item",children:[e.jsx("span",{children:new Date(q).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",className:"remove-date",onClick:()=>B(q,L,Y),children:e.jsx(yt,{size:14})})]},q)):e.jsx("p",{className:"no-dates",children:"אין תאריכים להוציא"})})]})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Le,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Le,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(vt,{size:16}),children:Zo.map(q=>e.jsx("option",{value:q,children:q},q))})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Le,{label:"סילבוס",name:"syllabus",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תלמידים (משתתפי השיעור)"}),e.jsxs("div",{ref:z,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(gr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:S,onChange:Z,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>S.length>0,disabled:P})]}),E&&ee().length>0&&!P&&e.jsx("div",{className:"search-results-dropdown",children:ee().map(q=>e.jsxs("div",{className:"search-result-item",onClick:()=>W(q,Y),children:[e.jsx(We,{size:16,className:"student-icon"}),e.jsx("span",{children:q.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:q.academicInfo.instrument})]},q._id))})]}),e.jsx("div",{className:"selected-members-list",children:I?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):_.length>0?e.jsx("ul",{className:"members-items",children:_.map(q=>e.jsxs("li",{className:"member-item",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:q.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:q.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:q.academicInfo.instrument})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>K(q._id,Y),"aria-label":`הסר את ${q.personalInfo.fullName}`,disabled:P,children:e.jsx(yt,{size:14})})]},q._id))}):e.jsx("div",{className:"no-members-message",children:"לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים לשיעור."})})]})}),e.jsx($a,{type:"hidden",name:"schoolYearId",value:(g==null?void 0:g._id)||""}),e.jsx($a,{type:"hidden",name:"studentIds"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"primary",disabled:u,onClick:async()=>{if(console.log("Submit button clicked for bulk form"),!(g!=null&&g._id))throw console.error("No school year ID available"),new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const q={...L,dayOfWeek:Number(L.dayOfWeek),schoolYearId:g._id,studentIds:_.map(F=>F._id)};console.log("Direct submission with data:",q);try{const F=await i(q);if(F&&F.theoryLessonIds&&Array.isArray(F.theoryLessonIds)&&F.theoryLessonIds.length>0)for(const te of F.theoryLessonIds)te&&await ne(te,[],q.studentIds)}catch(F){throw console.error("Direct submission error:",F),F}},children:u?"יוצר...":"יצירת סדרת שיעורים"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})})]})})}function IR({isOpen:t,onClose:s,theoryLessonCategory:n,theoryLessonTeacherName:i,categorySameCount:l,teacherSameCount:c,onDeleteSingle:u,onDeleteByCategory:f,onDeleteByTeacher:p}){const[m,g]=x.useState(null),v=()=>{g("single")},j=()=>{g("category")},N=()=>{g("teacher")},b=()=>{m==="single"?u():m==="category"?f():m==="teacher"&&p(),g(null),s()},w=()=>{g(null),s()};if(m){const C=m==="category",T=m==="teacher",A=m==="single";let _,D,S;return A?(_="מחיקת שיעור תאוריה",D="האם אתה בטוח שברצונך למחוק שיעור תאוריה זה? פעולה זו לא ניתנת לביטול.",S="מחק שיעור"):C?(_="מחיקת כל שיעורי התאוריה בקטגוריה",D=`האם אתה בטוח שברצונך למחוק את כל ${l} שיעורי התאוריה בקטגוריה "${n}"? פעולה זו לא ניתנת לביטול.`,S=`מחק ${l} שיעורים`):T&&(_="מחיקת כל שיעורי התאוריה של המדריך",D=`האם אתה בטוח שברצונך למחוק את כל ${c} שיעורי התאוריה של המדריך "${i}"? פעולה זו לא ניתנת לביטול.`,S=`מחק ${c} שיעורים`),e.jsx(gs,{isOpen:!0,onClose:()=>g(null),onConfirm:b,title:_,message:D,confirmText:S,cancelText:"ביטול",type:"danger"})}return e.jsx(Ta,{isOpen:t,onClose:w,children:e.jsxs("div",{className:"theory-delete-dialog",children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx(yr,{size:24,className:"warning-icon"}),e.jsx("h3",{children:"מחיקת שיעור תאוריה"})]}),e.jsxs("div",{className:"dialog-content",children:[e.jsx("p",{children:"בחר את סוג המחיקה שברצונך לבצע:"}),e.jsxs("div",{className:"delete-options",children:[e.jsxs("button",{className:"delete-option-btn single",onClick:v,children:[e.jsx(_t,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsx("div",{className:"option-title",children:"מחק שיעור זה בלבד"}),e.jsx("div",{className:"option-description",children:"מחיקה של שיעור תאוריה יחיד זה"})]})]}),l>1&&e.jsxs("button",{className:"delete-option-btn bulk category",onClick:j,children:[e.jsx(Vt,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsxs("div",{className:"option-title",children:['מחק את כל שיעורי "',n,'"']}),e.jsxs("div",{className:"option-description",children:["מחיקה של כל ",l," שיעורי התאוריה בקטגוריה זו"]})]})]}),c>1&&e.jsxs("button",{className:"delete-option-btn bulk teacher",onClick:N,children:[e.jsx(We,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsxs("div",{className:"option-title",children:['מחק את כל השיעורים של "',i,'"']}),e.jsxs("div",{className:"option-description",children:["מחיקה של כל ",c," שיעורי התאוריה של המדריך"]})]})]})]})]}),e.jsx("div",{className:"dialog-actions",children:e.jsx("button",{className:"btn secondary",onClick:w,children:"ביטול"})})]})})}function $R(){const t=Ot(),s=ys(),{addToast:n,showError:i,showSuccess:l}=It(),{theoryLessons:c,isLoading:u,error:f,loadTheoryLessons:p,removeTheoryLesson:m,bulkCreateTheoryLessons:g,bulkDeleteTheoryLessonsByCategory:v,bulkDeleteTheoryLessonsByTeacher:j,saveTheoryLesson:N}=mp(),{teachers:b,loadTeachers:w}=Ds(),[C,T]=x.useState(!1),[A,_]=x.useState(null),[D,S]=x.useState({}),[R,E]=x.useState(!1),[k,I]=x.useState(null),M=b.filter(L=>{var Y;return(Y=L.roles)==null?void 0:Y.includes("מורה תאוריה")}),z=L=>c.filter(Y=>Y.category===L).length,Z=L=>c.filter(Y=>Y.teacherId===L).length,ee=L=>{var H;const Y=b.find(P=>P._id===L);return((H=Y==null?void 0:Y.personalInfo)==null?void 0:H.fullName)||"מדריך לא ידוע"};x.useEffect(()=>{p(),w()},[p,w]);const W=async L=>{try{const Y=await N(L);return l(L._id?"שיעור התאוריה עודכן בהצלחה":"שיעור התאוריה נוסף בהצלחה"),T(!1),_(null),await p(),Y&&Y._id&&!L._id&&s.pathname!==`/theory/${Y._id}`&&setTimeout(()=>{t(`/theory/${Y._id}`)},100),Y}catch(Y){throw console.error("Error saving theory lesson:",Y),i(Y),Y}},K=async L=>{console.log("TheoryIndex handleBulkSubmit called with data:",L);try{if(!L.category)throw new Error("Category is required");if(!L.teacherId)throw new Error("Teacher is required");if(!L.startDate||!L.endDate)throw new Error("Date range is required");if(L.dayOfWeek===void 0)throw new Error("Day of week is required");if(!L.startTime||!L.endTime)throw new Error("Time range is required");if(!L.location)throw new Error("Location is required");console.log("About to call bulkCreateTheoryLessons with data:",L);const Y=await g(L);return console.log("Bulk creation result:",Y),Y&&Y.insertedCount>0?l(`נוצרו ${Y.insertedCount} שיעורי תאוריה בהצלחה`):l("שיעורי התאוריה נוצרו בהצלחה"),T(!1),console.log("TheoryIndex: Forcing refresh of theory lessons after bulk create"),await p(),Y}catch(Y){throw console.error("Error bulk creating theory lessons:",Y),i(Y),Y}},Q=L=>{const Y=c.find(H=>H._id===L);Y&&(I(Y),E(!0))},ne=async()=>{if(k)try{await m(k._id),l("שיעור התאוריה נמחק בהצלחה"),s.pathname.includes(k._id)&&t("/theory")}catch(L){console.error("Failed to remove theory lesson:",L),i(L)}},X=async()=>{if(k)try{const L=await v(k.category);l(`נמחקו ${L.deletedCount} שיעורי תאוריה בקטגוריה "${k.category}"`)}catch(L){console.error("Failed to remove theory lessons by category:",L),i(L)}},se=async()=>{var L;if(k)try{const Y=await j(k.teacherId),H=b.find(q=>q._id===k.teacherId),P=((L=H==null?void 0:H.personalInfo)==null?void 0:L.fullName)||"מדריך לא ידוע";l(`נמחקו ${Y.deletedCount} שיעורי תאוריה של המדריך ${P}`)}catch(Y){console.error("Failed to remove theory lessons by teacher:",Y),i(Y)}},O=L=>{p()},B=s.pathname.includes("/theory/")&&!s.pathname.endsWith("/theory/");return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!B&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(ic,{onSearch:O,placeholder:"חפש שיעורי תאוריה..."}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn-icon add-btn",onClick:()=>{_(null),T(!0)},"aria-label":"הוספת שיעור תאוריה חדש",children:e.jsx(ls,{className:"icon",size:20})})})]})}),f&&e.jsx("div",{className:"error-message",children:f}),!B&&e.jsx(e.Fragment,{children:e.jsx(AR,{theoryLessons:c,isLoading:u,teachers:b,onEdit:L=>{const Y=c.find(H=>H._id===L);Y&&(_(Y),T(!0))},onView:L=>t(`/theory/${L}`),onRemove:Q})}),e.jsx(cN,{isOpen:C,onClose:()=>{T(!1),_(null)},onSubmit:W,onBulkSubmit:K,theoryLesson:A||void 0,theoryTeachers:M,isLoading:u}),e.jsx(IR,{isOpen:R,onClose:()=>E(!1),theoryLessonCategory:(k==null?void 0:k.category)||"",theoryLessonTeacherName:k?ee(k.teacherId):"",categorySameCount:k?z(k.category):0,teacherSameCount:k?Z(k.teacherId):0,onDeleteSingle:ne,onDeleteByCategory:X,onDeleteByTeacher:se})]}),!B&&!C&&e.jsx(mi,{})]})}function qj(){const t=Ot(),s=ys(),{theoryLessonId:n}=Nr(),{addToast:i}=It();vs();const{selectedTheoryLesson:l,isLoading:c,error:u,loadTheoryLessonById:f,saveTheoryLesson:p,removeTheoryLesson:m,updateAttendance:g}=mp(),{teachers:v,loadTeachers:j}=Ds(),{getStudentsByIds:N}=La(),[b,w]=x.useState(!1),[C,T]=x.useState(!1),[A,_]=x.useState([]),[D,S]=x.useState(!1),[R,E]=x.useState({present:[],absent:[]}),[k,I]=x.useState(!1),[M,z]=x.useState(!1),[Z,ee]=x.useState(!1),W=v.filter(L=>{var Y;return(Y=L.roles)==null?void 0:Y.includes("מורה תאוריה")});x.useEffect(()=>{n&&(f(n),j())},[n,f,j]),x.useEffect(()=>{async function L(){var Y;if((Y=l==null?void 0:l.studentIds)!=null&&Y.length){S(!0);try{const H=await N(l.studentIds);_(H)}catch(H){console.error("Error loading students:",H)}finally{S(!1)}}else _([])}L()},[l,N]),x.useEffect(()=>{l!=null&&l.attendance?E({present:l.attendance.present||[],absent:l.attendance.absent||[]}):E({present:[],absent:[]}),I(!1),ee(!1)},[l]);const K=()=>{if(!l)return"לא ידוע";const L=v.find(Y=>Y._id===l.teacherId);return L?L.personalInfo.fullName:"לא ידוע"},Q=async L=>{try{const Y=await p(L);return i({type:"success",message:"שיעור התאוריה עודכן בהצלחה"}),w(!1),Y}catch(Y){throw console.error("Error updating theory lesson:",Y),i({type:"danger",message:"אירעה שגיאה בעדכון שיעור התאוריה"}),Y}},ne=async()=>{if(n)try{await m(n),i({type:"success",message:"שיעור התאוריה נמחק לצמיתות בהצלחה"}),t("/theory")}catch(L){console.error("Error deleting theory lesson:",L),i({type:"danger",message:"אירעה שגיאה במחיקת שיעור התאוריה"})}finally{T(!1)}},X=async()=>{if(!(!n||!l)){z(!0);try{await g(n,R),i({type:"success",message:"נוכחות עודכנה בהצלחה"}),ee(!0),I(!1),await f(n)}catch(L){console.error("Error updating attendance:",L),i({type:"danger",message:"אירעה שגיאה בעדכון הנוכחות"})}finally{z(!1)}}},se=(L,Y)=>{E(H=>{const P=[...H.present],q=[...H.absent],F=P.indexOf(L);F!==-1&&P.splice(F,1);const te=q.indexOf(L);return te!==-1&&q.splice(te,1),Y?P.push(L):q.push(L),{present:P,absent:q}}),I(!0),ee(!1)},O=L=>new Date(L).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric",weekday:"long"});if(c)return e.jsx("div",{className:"loading-state",children:"טוען שיעור תאוריה..."});if(u)return e.jsx("div",{className:"error-message",children:u});if(!l)return e.jsx("div",{className:"not-found",children:"שיעור התאוריה לא נמצא"});const B=()=>{s.key?t(-1):t("/theory")};return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"theory-details",children:e.jsx("div",{className:"theory-details-page",children:e.jsx("div",{className:"theory-card-container",children:e.jsxs("div",{className:"tdy-card-content",children:[e.jsxs("div",{className:"tdy-card-header",children:[e.jsx("button",{className:"tdy-back-button",onClick:B,"aria-label":"חזור",children:e.jsx(Bs,{className:"lucide lucide-arrow-left"})}),e.jsxs("div",{className:"tdy-header-title",children:[e.jsx("h2",{children:"שיעור תאוריה"}),e.jsxs("div",{className:"tdy-date-display",children:[e.jsx($e,{size:18}),e.jsx("span",{children:O(l.date)})]})]}),e.jsxs("div",{className:"tdy-header-actions",children:[e.jsxs("button",{className:"tdy-action-btn edit",onClick:()=>w(!0),"aria-label":"ערוך",children:[e.jsx(Sa,{size:16}),"עריכה"]}),e.jsxs("button",{className:"tdy-action-btn delete",onClick:()=>T(!0),"aria-label":"מחק",children:[e.jsx(_t,{size:16}),"מחיקה"]})]})]}),e.jsxs("div",{className:"tdy-card-scroll-area",children:[e.jsxs("div",{className:"tdy-section",children:[e.jsxs("div",{className:"tdy-section-title",children:[e.jsx(Vt,{size:18}),e.jsx("span",{children:l.category||"שיעור תאוריה"})]}),e.jsxs("div",{className:"tdy-section-content",children:[e.jsxs("div",{className:"tdy-theory-details-row",children:[e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"מורה:"}),e.jsx("span",{className:"tdy-detail-value",children:K()})]}),e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"מיקום:"}),e.jsx("span",{className:"tdy-detail-value",children:l.location})]}),e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"זמן:"}),e.jsxs("span",{className:"tdy-detail-value",children:[l.startTime," - ",l.endTime]})]})]}),l.notes&&e.jsxs("div",{className:"tdy-theory-notes",children:[e.jsx("span",{className:"tdy-notes-label",children:"הערות:"}),e.jsx("p",{className:"tdy-notes-content",children:l.notes})]}),l.syllabus&&e.jsxs("div",{className:"tdy-theory-syllabus",children:[e.jsx("span",{className:"tdy-syllabus-label",children:"סילבוס:"}),e.jsx("p",{className:"tdy-syllabus-content",children:l.syllabus})]})]})]}),e.jsxs("div",{className:"tdy-section",children:[e.jsxs("div",{className:"tdy-section-title",children:[e.jsx(ps,{size:18}),e.jsx("span",{children:"נוכחות תלמידים"})]}),e.jsx("div",{className:"tdy-section-content",children:e.jsx("div",{className:"tdy-students-list-container",children:D?e.jsx("div",{className:"tdy-loading-students",children:"טוען רשימת תלמידים..."}):A.length>0?e.jsx("ul",{className:"tdy-students-list",children:A.map(L=>{var H,P;const Y=R.present.includes(L._id);return e.jsxs("li",{className:`tdy-student-item ${Y?"present":""}`,children:[e.jsxs("div",{className:"tdy-student-info",children:[e.jsx("div",{className:"tdy-student-name",children:L.personalInfo.fullName}),e.jsx("div",{className:"tdy-student-instrument",children:((P=(H=L.academicInfo.instrumentProgress)==null?void 0:H[0])==null?void 0:P.instrumentName)||L.academicInfo.instrument||"לא מוגדר"})]}),e.jsxs("label",{className:"tdy-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:()=>se(L._id,!Y)}),e.jsx("span",{className:"tdy-toggle-slider"})]})]},L._id)})}):e.jsx("div",{className:"tdy-empty-students",children:"אין תלמידים רשומים לשיעור זה"})})})]})]}),e.jsxs("div",{className:"tdy-attendance-footer",children:[Z&&e.jsx("span",{className:"tdy-save-success",children:"הנוכחות עודכנה בהצלחה!"}),e.jsx("button",{className:"tdy-save-attendance-btn",onClick:X,disabled:!k||M,children:M?"שומר...":"עדכן נוכחות"})]})]})})})})}),e.jsx(cN,{isOpen:b,onClose:()=>w(!1),onSubmit:Q,onBulkSubmit:async L=>(console.log("Bulk submit not applicable in details view",L),{insertedCount:0,theoryLessonIds:[]}),theoryLesson:l,theoryTeachers:W,isLoading:c}),e.jsx(gs,{isOpen:C,title:"מחיקת שיעור תאוריה",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק לצמיתות את שיעור התאוריה "',l.category,'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו תמחק לצמיתות את השיעור ואת כל הנתונים הקשורים אליו. פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",onConfirm:ne,onClose:()=>T(!1),type:"danger"})]})}const ja=Fa((t,s)=>({bagruts:[],selectedBagrut:null,filterBy:{},isLoading:!1,error:null,loadBagruts:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await St.getBagruts(i);t({bagruts:l,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load bagruts";t({error:l,isLoading:!1}),console.error("Error loading bagruts:",i)}},loadBagrutById:async n=>{t({isLoading:!0,error:null});try{const i=await St.getBagrutById(n);t({selectedBagrut:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load bagrut";t({error:l,isLoading:!1}),console.error("Error loading bagrut:",i)}},loadBagrutByStudentId:async n=>{t({isLoading:!0,error:null});try{const i=await St.getBagrutByStudentId(n);return t({selectedBagrut:i,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to load bagrut";return t({error:l,isLoading:!1}),console.error("Error loading bagrut by student ID:",i),null}},createBagrut:async n=>{t({isLoading:!0,error:null});try{const i=await St.createBagrut(n);return t({bagruts:[...s().bagruts,i],selectedBagrut:i,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to create bagrut";throw t({error:l,isLoading:!1}),console.error("Error creating bagrut:",i),i}},updatePresentation:async(n,i,l)=>{var c;try{console.log("Store: Calling API to update presentation",{bagrutId:n,presentationIndex:i,data:l});const u=await St.updatePresentation(n,i,l);console.log("Store: API returned updated bagrut:",u);const f=s().bagruts.map(p=>p._id===n?u:p);return console.log("Store: Updating Zustand state with new data"),t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),console.log("Store: State updated, selectedBagrut now:",s().selectedBagrut),u}catch(u){const f=u instanceof Error?u.message:"Failed to update presentation";throw t({error:f}),console.error("Error updating presentation:",u),u}},updateMagenBagrut:async(n,i)=>{var l;try{const c=await St.updateMagenBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update Magen Bagrut";throw t({error:u}),console.error("Error updating Magen Bagrut:",c),c}},updateGradingDetails:async(n,i)=>{var l;try{const c=await St.updateGradingDetails(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update grading details";throw t({error:u}),console.error("Error updating grading details:",c),c}},calculateFinalGrade:async n=>{var i;try{const l=await St.calculateFinalGrade(n),c=s().bagruts.map(u=>u._id===n?l:u);return t({bagruts:c,selectedBagrut:((i=s().selectedBagrut)==null?void 0:i._id)===n?l:s().selectedBagrut}),l}catch(l){const c=l instanceof Error?l.message:"Failed to calculate final grade";throw t({error:c}),console.error("Error calculating final grade:",l),l}},completeBagrut:async(n,i)=>{var l;try{const c=await St.completeBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to complete bagrut";throw t({error:u}),console.error("Error completing bagrut:",c),c}},addProgramPiece:async(n,i)=>{var l;try{const c=await St.addProgramPiece(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to add program piece";throw t({error:u}),console.error("Error adding program piece:",c),c}},updateProgramPiece:async(n,i,l)=>{var c;try{const u=await St.updateProgramPiece(n,i,l),f=s().bagruts.map(p=>p._id===n?u:p);return t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),u}catch(u){const f=u instanceof Error?u.message:"Failed to update program piece";throw t({error:f}),console.error("Error updating program piece:",u),u}},updateProgram:async(n,i)=>{var l;try{const c=await St.updateProgram(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update program";throw t({error:u}),console.error("Error updating program:",c),c}},removeProgramPiece:async(n,i)=>{var l;try{const c=await St.removeProgramPiece(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove program piece";throw t({error:u}),console.error("Error removing program piece:",c),c}},addAccompanist:async(n,i)=>{var l;try{const c=await St.addAccompanist(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to add accompanist";throw t({error:u}),console.error("Error adding accompanist:",c),c}},removeAccompanist:async(n,i)=>{var l;try{const c=await St.removeAccompanist(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove accompanist";throw t({error:u}),console.error("Error removing accompanist:",c),c}},uploadDocument:async(n,i,l)=>{var c;try{const u=await St.uploadDocument(n,i,l),f=s().bagruts.map(p=>p._id===n?u:p);return t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),u}catch(u){const f=u instanceof Error?u.message:"Failed to upload document";throw t({error:f}),console.error("Error uploading document:",u),u}},removeDocument:async(n,i)=>{var l;try{const c=await St.removeDocument(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove document";throw t({error:u}),console.error("Error removing document:",c),c}},updateBagrut:async(n,i)=>{var l;try{const c=await St.updateBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update bagrut";throw t({error:u}),console.error("Error updating bagrut:",c),c}},deleteBagrut:async n=>{var i;try{await St.deleteBagrut(n);const l=s().bagruts.filter(c=>c._id!==n);t({bagruts:l,selectedBagrut:((i=s().selectedBagrut)==null?void 0:i._id)===n?null:s().selectedBagrut})}catch(l){const c=l instanceof Error?l.message:"Failed to delete bagrut";throw t({error:c}),console.error("Error deleting bagrut:",l),l}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedBagrut:()=>{t({selectedBagrut:null})},clearError:()=>{t({error:null})}}));function RR({bagrut:t,onView:s,onEdit:n,onDelete:i,student:l,teacher:c,authContext:u}){var A,_,D,S;const f=u?Sr(u):null,p=()=>{var k;if(t.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const R=(t.presentations||[]).filter(I=>I.completed).length,E=((k=t.magenBagrut)==null?void 0:k.completed)||!1;return R>0||E?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},m=()=>{var I;const R=(t.presentations||[]).filter(M=>M.completed).length,E=(I=t.magenBagrut)!=null&&I.completed?1:0;return(R+E)/4*100},g=R=>R?R.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2):"?",v=R=>{if(!R)return"var(--text-muted)";switch(R){case"מעולה":return"var(--success)";case"טוב מאוד":return"var(--info)";case"טוב":return"var(--primary)";case"מספיק":return"var(--warning)";case"מספיק בקושי":return"var(--danger-light)";case"לא עבר/ה":return"var(--danger)";default:return"var(--text-muted)"}},j=p(),N=m(),b=j.icon,w=f?f.isAdmin()||f.isTeacher()||t.teacherId===((A=f==null?void 0:f.user)==null?void 0:A._id):!0,C=f?f.isAdmin()||t.teacherId===((_=f==null?void 0:f.user)==null?void 0:_._id):!0,T=f?f.isAdmin()||t.teacherId===((D=f==null?void 0:f.user)==null?void 0:D._id):!0;return w?e.jsxs("div",{className:"bagrut-preview",onClick:()=>s(t._id),children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsxs("div",{className:"student-details",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:j.color},children:g(l==null?void 0:l.personalInfo.fullName)})}),e.jsxs("div",{className:"bagrut-info",children:[e.jsx("h3",{className:"student-name",children:(l==null?void 0:l.personalInfo.fullName)||"תלמיד לא זמין"}),e.jsxs("div",{className:"teacher-info",children:[e.jsx(pr,{size:12}),e.jsx("span",{children:(c==null?void 0:c.personalInfo.fullName)||"מורה לא זמין"})]})]})]}),e.jsxs("div",{className:"badges-container",children:[e.jsxs("div",{className:"status-badge",style:{backgroundColor:j.color},children:[e.jsx(b,{size:12}),e.jsx("span",{children:j.text})]}),t.finalGradeLevel&&e.jsxs("div",{className:"grade-badge",style:{backgroundColor:v(t.finalGradeLevel)},children:[e.jsx(ms,{size:12}),e.jsx("span",{children:t.finalGradeLevel})]})]})]})}),e.jsxs("div",{className:"preview-content",children:[e.jsxs("div",{className:"progress-section",children:[e.jsx("div",{className:"progress-label",children:"התקדמות:"}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`,backgroundColor:j.color}})}),e.jsxs("div",{className:"progress-text",children:[(t.presentations||[]).filter(R=>R.completed).length+((S=t.magenBagrut)!=null&&S.completed?1:0),"/4"]})]}),t.conservatoryName&&e.jsx("div",{className:"info-row",children:e.jsx("div",{className:"info-item",children:e.jsx("span",{children:t.conservatoryName})})}),t.finalGrade&&e.jsx("div",{className:"grade-section",children:e.jsxs("div",{className:"grade-item",children:[e.jsx("div",{className:"grade-label",children:"ציון סופי:"}),e.jsxs("div",{className:"grade-value",style:{color:v(t.finalGradeLevel)},children:[t.finalGrade," (",t.finalGradeLevel,")"]})]})}),(t.program||[]).length>0&&e.jsx("div",{className:"program-info",children:e.jsxs("span",{children:[(t.program||[]).length," יצירות בתוכנית"]})})]}),e.jsxs("div",{className:"bagrut-preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn view",onClick:R=>{R.stopPropagation(),s(t._id)},"aria-label":"צפה בבגרות",children:e.jsx(ba,{size:18})}),C&&e.jsx("button",{className:"action-btn edit",onClick:R=>{R.stopPropagation(),n(t._id)},"aria-label":"ערוך בגרות",children:e.jsx(Sa,{size:16})}),T&&e.jsx("button",{className:"action-btn delete",onClick:R=>{R.stopPropagation(),i(t._id)},"aria-label":"מחק בגרות",children:e.jsx(_t,{size:16})})]}),e.jsxs("div",{className:"date-section",children:[e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:["נוצר: ",new Date(t.createdAt).toLocaleDateString("he-IL")]})]}),t.testDate&&e.jsxs("div",{className:"test-date-info",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:["מועד בחינה: ",new Date(t.testDate).toLocaleDateString("he-IL")]})]})]})]})]}):null}function MR({bagruts:t,isLoading:s,onView:n,onEdit:i,onDelete:l,students:c,teachers:u,authContext:f}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען בגרויות..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו בגרויות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או ליצור בגרות חדשה"})]}):e.jsx("div",{className:"bagrut-grid",children:t.map(p=>e.jsx(RR,{bagrut:p,onView:n,onEdit:i,onDelete:l,student:c.find(m=>m._id===p.studentId),teacher:u.find(m=>m._id===p.teacherId),authContext:f},p._id))})}const zR=at().shape({studentId:Ae().required("יש לבחור תלמיד"),teacherId:Ae().required("יש לבחור מורה"),conservatoryName:Ae().optional(),testDate:Ls().required("יש לבחור תאריך מבחן"),notes:Ae().optional(),programPieces:es().of(at().shape({pieceTitle:Ae().required("שם היצירה נדרש"),composer:Ae().required("שם המלחין נדרש"),duration:Ae().required("משך הביצוע נדרש"),movement:Ae().optional(),youtubeLink:Ae().url("קישור לא תקין").optional()})).min(1,"יש להוסיף לפחות יצירה אחת"),presentationDates:at().shape({presentation1Date:Ls().nullable().optional(),presentation2Date:Ls().nullable().optional(),presentation3Date:Ls().nullable().optional(),magenBagrutDate:Ls().nullable().optional()}),accompanists:es().of(at().shape({name:Ae().required("שם המלווה נדרש")})).min(1,"יש להוסיף לפחות מלווה אחד")}),LR={studentId:"",teacherId:"",conservatoryName:"",testDate:null,notes:"",programPieces:[{pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}],presentationDates:{presentation1Date:null,presentation2Date:null,presentation3Date:null,magenBagrutDate:null},accompanists:[{name:""}]};function BR({isOpen:t,onClose:s,students:n,teachers:i,editMode:l=!1,editingBagrutId:c=null}){console.log("🚀 BagrutForm rendered with props:",{isOpen:t,editMode:l,editingBagrutId:c,studentsCount:n.length,teachersCount:i.length});const[u,f]=x.useState(!1),[p,m]=x.useState(!1),[g,v]=x.useState(null),{createBagrut:j,updateBagrut:N,loadBagrutById:b}=ja(),{addToast:w}=It(),C=x.useMemo(()=>n.filter(E=>{var I,M;if(!E.isActive)return!1;let k=0;if(E.academicInfo.currentStage)k=typeof E.academicInfo.currentStage=="number"?E.academicInfo.currentStage:parseInt(E.academicInfo.currentStage)||0;else{const z=(I=E.academicInfo.instrumentProgress)==null?void 0:I.find(Z=>Z.isPrimary);if(z!=null&&z.currentStage)k=z.currentStage;else{const Z=(M=E.academicInfo.instrumentProgress)==null?void 0:M[0];k=(Z==null?void 0:Z.currentStage)||0}}return k>=5}),[n]),T=x.useMemo(()=>i.filter(E=>{var M,z;if(!E.isActive)return!1;const k=((M=E.professionalInfo)==null?void 0:M.instrument)==="פסנתר",I=(z=E.roles)==null?void 0:z.some(Z=>Z.includes("מלווה")||Z.includes("מורה לפסנתר"));return k||I}),[i]);x.useEffect(()=>{console.log("🔄 BagrutForm useEffect triggered:",{editMode:l,editingBagrutId:c,isOpen:t}),l&&c&&t?A():l||(console.log("🔄 Resetting edit data for create mode"),v(null))},[l,c,t]);const A=async()=>{console.log("🔄 Loading bagrut data for edit mode:",c),m(!0);try{await b(c);const E=ja.getState().selectedBagrut;console.log("✅ Loaded bagrut data:",E),v(E)}catch(E){console.error("❌ Failed to load bagrut data:",E),w({type:"danger",message:"שגיאה בטעינת נתוני הבגרות",autoCloseTime:4e3})}finally{m(!1)}},_=()=>{var E,k,I,M,z,Z,ee;return console.log("📝 getInitialValues called:",{editMode:l,editingBagrut:!!g}),l&&g?(console.log("📝 Converting bagrut data to form values:",g),{studentId:g.studentId||"",teacherId:g.teacherId||"",conservatoryName:g.conservatoryName||"",testDate:g.testDate?new Date(g.testDate):null,notes:g.notes||"",programPieces:g.program&&g.program.length>0?g.program.map(W=>({pieceTitle:W.pieceTitle||"",composer:W.composer||"",duration:W.duration||"",movement:W.movement||"",youtubeLink:W.youtubeLink||""})):[{pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}],presentationDates:{presentation1Date:(k=(E=g.presentations)==null?void 0:E[0])!=null&&k.date?new Date(g.presentations[0].date):null,presentation2Date:(M=(I=g.presentations)==null?void 0:I[1])!=null&&M.date?new Date(g.presentations[1].date):null,presentation3Date:(Z=(z=g.presentations)==null?void 0:z[2])!=null&&Z.date?new Date(g.presentations[2].date):null,magenBagrutDate:(ee=g.magenBagrut)!=null&&ee.date?new Date(g.magenBagrut.date):null},accompanists:g.accompaniment&&g.accompaniment.length>0?g.accompaniment.map(W=>({name:W.name||""})):[{name:""}]}):LR},{modalProps:D,titleProps:S}=Al({isOpen:t,onClose:s,modalId:"bagrut-form",restoreFocusOnClose:!0}),R=async E=>{var k,I,M;console.log("🚀 BagrutForm submission started with values:",E),f(!0);try{if(l)console.log("✏️ Edit mode - skipping duplicate check");else{console.log("🔍 Checking if student already has a bagrut...");try{const W=await ja.getState().loadBagrutByStudentId(E.studentId);if(console.log("🔍 Existing bagrut check result:",W),W){console.log("⚠️ Student already has bagrut - backend now enforces this rule"),w({type:"warning",message:"לתלמיד זה כבר קיימת בגרות. כל תלמיד יכול להחזיק בגרות אחת בלבד.",autoCloseTime:5e3}),f(!1);return}}catch(W){console.warn("⚠️ Could not check for existing bagrut:",W)}}let z,Z;if(console.log("🔍 Edit mode decision:",{editMode:l,editingBagrutId:c}),l&&c){console.log("📝 Step 1: Updating existing Bagrut...",c);const W={studentId:E.studentId,conservatoryName:E.conservatoryName||void 0,teacherId:E.teacherId,testDate:E.testDate||void 0,notes:E.notes||void 0};console.log("📝 Update data to send:",W),Z=await N(c,W),z=c,console.log("✅ Basic Bagrut updated successfully:",z)}else{console.log("📝 Step 1: Creating new Bagrut...");const W={studentId:E.studentId,teacherId:E.teacherId,conservatoryName:E.conservatoryName||void 0};if(console.log("📝 Bagrut data to send:",W),Z=await j(W),z=Z._id,console.log("✅ Basic Bagrut created successfully:",z),E.testDate||E.notes){console.log("📝 Step 1.5: Updating bagrut with testDate and notes...");const K={studentId:E.studentId,teacherId:E.teacherId,conservatoryName:E.conservatoryName||void 0,testDate:E.testDate||void 0,notes:E.notes||void 0};console.log("📝 Additional data to update:",K),Z=await N(z,K),console.log("✅ Bagrut updated with additional data successfully")}}if(l)console.log("✏️ Edit mode - skipping program pieces to avoid duplicates");else{console.log("🎵 Step 2: Adding program pieces...");const W=E.programPieces.filter(K=>K.pieceTitle.trim()&&K.composer.trim()&&K.duration.trim());console.log("🎵 Valid program pieces:",W.length,W);for(const K of W){const Q={pieceTitle:K.pieceTitle,composer:K.composer,duration:K.duration,movement:K.movement||void 0,youtubeLink:K.youtubeLink||void 0};console.log("🎵 Adding piece data:",Q),await St.addProgramPiece(z,Q),console.log("✅ Added program piece successfully:",K.pieceTitle)}}if(l)console.log("✏️ Edit mode - skipping accompanists to avoid duplicates");else{const W=E.accompanists.filter(K=>K.name.trim());for(const K of W){const Q=T.find(se=>se.personalInfo.fullName===K.name),ne=((k=Q==null?void 0:Q.professionalInfo)==null?void 0:k.instrument)||"פסנתר",X={name:K.name,instrument:ne,phone:void 0};await St.addAccompanist(z,X),console.log("✅ Added accompanist:",K.name)}}console.log("📅 Step 4: Processing presentation dates...");const ee=[E.presentationDates.presentation1Date,E.presentationDates.presentation2Date,E.presentationDates.presentation3Date];for(let W=0;W<ee.length;W++)ee[W]&&(console.log(`📅 Updating presentation ${W+1} date:`,ee[W]),await St.updatePresentation(z,W,{date:ee[W]}),console.log(`✅ Updated presentation ${W+1} date successfully`));E.presentationDates.magenBagrutDate&&(console.log("📅 Updating Magen Bagrut date:",E.presentationDates.magenBagrutDate),await St.updateMagenBagrut(z,{date:E.presentationDates.magenBagrutDate}),console.log("✅ Updated Magen Bagrut date successfully")),await ja.getState().loadBagruts(),w({type:"success",message:l?"בגרות עודכנה בהצלחה":`בגרות נוצרה בהצלחה עם ${E.programPieces.filter(W=>W.pieceTitle.trim()&&W.composer.trim()).length} יצירות ו-${E.accompanists.filter(W=>W.name.trim()).length} מלווים`,autoCloseTime:4e3}),s()}catch(z){console.error(`❌ Error ${l?"updating":"creating"} comprehensive bagrut:`,z),console.error("❌ Error details:",{message:z instanceof Error?z.message:String(z),stack:z instanceof Error?z.stack:void 0,response:((I=z==null?void 0:z.response)==null?void 0:I.data)||(z==null?void 0:z.response)||void 0,status:((M=z==null?void 0:z.response)==null?void 0:M.status)||void 0}),w({type:"danger",message:z instanceof Error?z.message:l?"שגיאה בעדכון בגרות":"שגיאה ביצירת בגרות",autoCloseTime:5e3})}finally{console.log("🏁 BagrutForm submission finished, setting loading to false"),f(!1)}};return t?e.jsx(Ta,{isOpen:t,onClose:s,className:"bagrut-form responsive-form",children:e.jsxs("div",{className:"form-modal",...D,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(yt,{size:20})}),e.jsx("h2",{...S,children:l?"עריכת בגרות":"יצירת בגרות חדשה"})]}),e.jsx("div",{className:"form-content",children:p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"טוען נתוני בגרות..."})]}):e.jsx(xr,{enableReinitialize:!0,initialValues:_(),validationSchema:zR,onSubmit:R,children:({errors:E,touched:k,values:I,setFieldValue:M})=>e.jsxs($n,{children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(ux,{size:20}),"מידע בסיסי"]}),e.jsx(Le,{name:"conservatoryName",label:"שם הקונסרבטוריון",icon:ux,children:e.jsx("input",{type:"text",name:"conservatoryName",value:I.conservatoryName,onChange:z=>M("conservatoryName",z.target.value),className:"form-input",placeholder:"הזן שם קונסרבטוריון (אופציונלי)"})}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsxs(Le,{name:"studentId",label:"תלמיד (שלב 5+)",labelIcon:e.jsx(We,{size:16}),as:"select",searchable:!0,required:!0,children:[e.jsx("option",{value:"",children:"בחר תלמיד..."}),C.map(z=>{var K,Q,ne,X,se,O;let Z=0;if(z.academicInfo.currentStage)Z=typeof z.academicInfo.currentStage=="number"?z.academicInfo.currentStage:parseInt(z.academicInfo.currentStage)||0;else{const B=(K=z.academicInfo.instrumentProgress)==null?void 0:K.find(L=>L.isPrimary);Z=(B==null?void 0:B.currentStage)||((ne=(Q=z.academicInfo.instrumentProgress)==null?void 0:Q[0])==null?void 0:ne.currentStage)||0}const ee=(X=z.academicInfo.instrumentProgress)==null?void 0:X.find(B=>B.isPrimary),W=(ee==null?void 0:ee.instrumentName)||((O=(se=z.academicInfo.instrumentProgress)==null?void 0:se[0])==null?void 0:O.instrumentName)||"";return e.jsxs("option",{value:z._id,children:[z.personalInfo.fullName," - ",W," - שלב ",Z]},z._id)})]}),e.jsxs(Le,{name:"teacherId",label:"מורה מנחה",labelIcon:e.jsx(pr,{size:16}),as:"select",searchable:!0,required:!0,children:[e.jsx("option",{value:"",children:"בחר מורה..."}),i.filter(z=>z.isActive).map(z=>{var Z,ee;return e.jsxs("option",{value:z._id,children:[z.personalInfo.fullName," - ",((Z=z.professionalInfo)==null?void 0:Z.instrument)||""," - ",((ee=z.roles)==null?void 0:ee.join(", "))||""]},z._id)})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx($e,{size:20}),"תכנון מבחן"]}),e.jsx("div",{className:"form-grid-2-cols",children:e.jsx(Le,{name:"testDate",label:"תאריך מבחן",labelIcon:e.jsx($e,{size:16}),type:"date",value:I.testDate?I.testDate.toISOString().split("T")[0]:"",onChange:z=>M("testDate",z.target.value?new Date(z.target.value):null),required:!0})}),e.jsx(Le,{name:"notes",label:"הערות והנחיות",labelIcon:e.jsx(tc,{size:16}),as:"textarea",placeholder:"הוסף הערות, הנחיות מיוחדות או מידע נוסף...",rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(Je,{size:20}),"תכנית מוזיקלית"]}),e.jsx("p",{className:"section-description",children:"הוסף לפחות יצירה אחת לתכנית הבגרות"}),I.programPieces.map((z,Z)=>e.jsxs("div",{className:"program-piece-item",children:[e.jsxs("div",{className:"piece-header",children:[e.jsxs("span",{className:"piece-number",children:["יצירה #",Z+1]}),I.programPieces.length>1&&e.jsx("button",{type:"button",onClick:()=>{const ee=I.programPieces.filter((W,K)=>K!==Z);M("programPieces",ee)},className:"btn-icon delete-btn","aria-label":"מחק יצירה",children:e.jsx(_t,{size:16})})]}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsx(Le,{name:`programPieces.${Z}.pieceTitle`,label:"שם היצירה",required:!0,children:e.jsx("input",{type:"text",value:z.pieceTitle,onChange:ee=>{const W=[...I.programPieces];W[Z].pieceTitle=ee.target.value,M("programPieces",W)},className:"form-input",placeholder:"למשל: סונטה מס' 1"})}),e.jsx(Le,{name:`programPieces.${Z}.composer`,label:"מלחין",required:!0,children:e.jsx("input",{type:"text",value:z.composer,onChange:ee=>{const W=[...I.programPieces];W[Z].composer=ee.target.value,M("programPieces",W)},className:"form-input",placeholder:"למשל: מוצרט"})})]}),e.jsxs("div",{className:"form-grid-3-cols",children:[e.jsx(Le,{name:`programPieces.${Z}.duration`,label:"משך זמן",required:!0,children:e.jsx("input",{type:"text",value:z.duration,onChange:ee=>{const W=[...I.programPieces];W[Z].duration=ee.target.value,M("programPieces",W)},className:"form-input",placeholder:"למשל: 4:30"})}),e.jsx(Le,{name:`programPieces.${Z}.movement`,label:"פרק (אופציונלי)",children:e.jsx("input",{type:"text",value:z.movement||"",onChange:ee=>{const W=[...I.programPieces];W[Z].movement=ee.target.value,M("programPieces",W)},className:"form-input",placeholder:"למשל: Allegro"})}),e.jsx(Le,{name:`programPieces.${Z}.youtubeLink`,label:"קישור YouTube",children:e.jsx("input",{type:"url",value:z.youtubeLink||"",onChange:ee=>{const W=[...I.programPieces];W[Z].youtubeLink=ee.target.value,M("programPieces",W)},className:"form-input",placeholder:"https://youtube.com/..."})})]})]},Z)),e.jsxs("button",{type:"button",onClick:()=>{const z={pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""};M("programPieces",[...I.programPieces,z])},className:"btn btn-secondary add-item-btn",children:[e.jsx(ls,{size:16}),"הוסף יצירה נוספת"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx($e,{size:20}),"תכנון השמעות"]}),e.jsx("p",{className:"section-description",children:"תאריכים מתוכננים ל-3 השמעות ומגן בגרות (אופציונלי)"}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsx(Le,{name:"presentationDates.presentation1Date",label:"השמעה 1",labelIcon:e.jsx($e,{size:16}),type:"date",value:I.presentationDates.presentation1Date?I.presentationDates.presentation1Date.toISOString().split("T")[0]:"",onChange:z=>M("presentationDates.presentation1Date",z.target.value?new Date(z.target.value):null)}),e.jsx(Le,{name:"presentationDates.presentation2Date",label:"השמעה 2",labelIcon:e.jsx($e,{size:16}),type:"date",value:I.presentationDates.presentation2Date?I.presentationDates.presentation2Date.toISOString().split("T")[0]:"",onChange:z=>M("presentationDates.presentation2Date",z.target.value?new Date(z.target.value):null)}),e.jsx(Le,{name:"presentationDates.presentation3Date",label:"השמעה 3",labelIcon:e.jsx($e,{size:16}),type:"date",value:I.presentationDates.presentation3Date?I.presentationDates.presentation3Date.toISOString().split("T")[0]:"",onChange:z=>M("presentationDates.presentation3Date",z.target.value?new Date(z.target.value):null)}),e.jsx(Le,{name:"presentationDates.magenBagrutDate",label:"מגן בגרות",labelIcon:e.jsx($e,{size:16}),type:"date",value:I.presentationDates.magenBagrutDate?I.presentationDates.magenBagrutDate.toISOString().split("T")[0]:"",onChange:z=>M("presentationDates.magenBagrutDate",z.target.value?new Date(z.target.value):null)})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(EE,{size:20}),"מלווים"]}),e.jsx("p",{className:"section-description",children:"הוסף לפחות מלווה אחד לביצועים"}),I.accompanists.map((z,Z)=>e.jsxs("div",{className:"accompanist-item",children:[e.jsxs("div",{className:"accompanist-header",children:[e.jsxs("span",{className:"accompanist-number",children:["מלווה #",Z+1]}),I.accompanists.length>1&&e.jsx("button",{type:"button",onClick:()=>{const ee=I.accompanists.filter((W,K)=>K!==Z);M("accompanists",ee)},className:"btn-icon delete-btn","aria-label":"מחק מלווה",children:e.jsx(_t,{size:16})})]}),e.jsx("div",{className:"form-grid-1-col accompanist-select-container",children:e.jsxs(Le,{name:`accompanists.${Z}.name`,label:"שם המלווה",as:"select",searchable:!0,value:z.name,onChange:ee=>{const W=[...I.accompanists];W[Z].name=ee.target.value,M("accompanists",W)},className:"accompanist-select",required:!0,children:[e.jsx("option",{value:"",children:"בחר שם מלווה"}),T.map(ee=>{var W;return e.jsxs("option",{value:ee.personalInfo.fullName,children:[ee.personalInfo.fullName," - ",((W=ee.professionalInfo)==null?void 0:W.instrument)||""]},ee._id)}),e.jsx("option",{value:"מלווה חיצוני",children:"מלווה חיצוני"})]})})]},Z)),e.jsxs("button",{type:"button",onClick:()=>{const z={name:""};M("accompanists",[...I.accompanists,z])},className:"btn btn-secondary add-item-btn",children:[e.jsx(ls,{size:16}),"הוסף מלווה נוסף"]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,disabled:u,children:"ביטול"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u,onClick:()=>console.log("🔘 Submit button clicked!"),children:u?l?"מעדכן בגרות...":"יוצר בגרות מקיפה...":l?"עדכן בגרות":"צור בגרות מלאה"})]})]})})})]})}):null}function FR(){const{bagruts:t,isLoading:s,error:n,loadBagruts:i,deleteBagrut:l,updateBagrut:c}=ja(),{students:u,loadStudents:f}=La(),{teachers:p,loadTeachers:m}=Ds(),[g,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(!1),[C,T]=x.useState(null),[A,_]=x.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),D=x.useMemo(()=>P=>{const q=u.find(te=>te._id===P.studentId),F=p.find(te=>te._id===P.teacherId);return[(q==null?void 0:q.personalInfo.fullName)||"",(F==null?void 0:F.personalInfo.fullName)||"",P.conservatoryName||"",P.finalGradeLevel||"",P.isCompleted?"הושלם":"בתהליך"].filter(te=>typeof te=="string")},[u,p]),{filteredEntities:S,handleSearch:R,filters:E,handleApplyFilters:k,hasActiveFilters:I}=bu(t,D,()=>"",void 0,void 0,P=>{const q=u.find(F=>F._id===P.studentId);return(q==null?void 0:q.personalInfo.fullName)||""}),M=Ot(),z=ys(),{user:Z,isAuthenticated:ee}=vs(),{addToast:W}=It(),K=Cl(Z,ee),Q=z.pathname.includes("/bagrut/")&&!z.pathname.endsWith("/bagrut/");x.useEffect(()=>{i(),f(),m()},[i,f,m]);const ne=()=>{if(!Z||!ee){W({type:"warning",message:"נדרשת התחברות למערכת",autoCloseTime:4e3});return}v(!0)},X=()=>{v(!1),w(!1),T(null),i()},se=P=>{M(`/bagrut/${P}`)},O=P=>{w(!0),T(P),v(!0)},B=P=>{const q=t.find(ae=>ae._id===P),F=u.find(ae=>ae._id===(q==null?void 0:q.studentId)),te=(F==null?void 0:F.personalInfo.fullName)||"תלמיד לא זמין";_({isOpen:!0,title:"מחיקת בגרות",message:`האם אתה בטוח שברצונך למחוק את הבגרות של "${te}"?

פעולה זו אינה הפיכה ותמחק את כל הנתונים הקשורים לבגרות זו.`,onConfirm:()=>L(P)})},L=async P=>{try{await l(P),W({type:"success",message:"הבגרות נמחקה בהצלחה",autoCloseTime:3e3}),_({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch{W({type:"danger",message:"שגיאה במחיקת הבגרות",autoCloseTime:5e3})}},Y=()=>{N(!j)},H=!!(Z&&ee);return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content",children:[!Q&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(ic,{onSearch:R,placeholder:"חיפוש בגרויות..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${I?"active":""}`,onClick:Y,"aria-label":"סנן בגרויות",children:[e.jsx(hi,{className:"icon"}),I&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:j,onToggle:()=>N(!j),onApplyFilters:k,availableInstruments:[],classRange:void 0,currentFilters:E,hasActiveFilters:I,entityType:"bagruts"})]}),H&&e.jsx("button",{className:"btn-icon add-btn",onClick:ne,"aria-label":"הוספת בגרות חדשה",type:"button",children:e.jsx(ls,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!Q&&e.jsx(MR,{bagruts:S,isLoading:s,onView:se,onEdit:O,onDelete:B,students:u,teachers:p,authContext:K}),e.jsx(wl,{context:{loadBagruts:i}}),e.jsx(BR,{isOpen:g,onClose:X,students:u,teachers:p,editMode:b,editingBagrutId:C}),e.jsx(gs,{isOpen:A.isOpen,title:A.title,message:A.message,onConfirm:A.onConfirm,onCancel:()=>_({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}),!Q&&!g&&e.jsx(mi,{})]})}const Hj={playingSkills:{min:0,max:20},musicalUnderstanding:{min:0,max:40},textKnowledge:{min:0,max:30},playingByHeart:{min:0,max:10}},UR={playingSkills:"מיומנות נגינה/שירה (20 נק')",musicalUnderstanding:"הבנה מוסיקלית (40 נק')",textKnowledge:"ידיעת הטקסט (30 נק')",playingByHeart:`נגן בע"פ (10 נק')`};function PR({detailedGrading:t,onChange:s,className:n=""}){const[i,l]=x.useState(t||v$());x.useEffect(()=>{t&&l(t)},[t]);const c=(g,v)=>{const j={...i,[g]:{...i[g],...v}};l(j),s(j)},u=(g,v)=>{const j=Hj[g];let N=v;v!==null&&(N=Math.max(j.min,Math.min(j.max,v))),c(g,{points:N})},f=()=>x$(i),p=(g,v)=>{const j=i[g],N=Hj[g];return e.jsxs("div",{className:"detailed-grading-category",children:[e.jsxs("h4",{className:"category-title",children:[e.jsx(In,{size:16}),v]}),e.jsx("div",{className:"category-form-grid",children:e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{htmlFor:`${g}-points`,children:["נקודות (0-",N.max,")"]}),e.jsx("input",{id:`${g}-points`,type:"number",min:N.min,max:N.max,value:j.points||"",onChange:b=>{const w=b.target.value?parseInt(b.target.value):null;u(g,w)},placeholder:`0-${N.max}`})]})}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:`${g}-comments`,children:"הערות"}),e.jsx("textarea",{id:`${g}-comments`,rows:2,value:j.comments,onChange:b=>c(g,{comments:b.target.value}),placeholder:"הוסף הערות על הקטגוריה..."})]})]},g)},m=f();return e.jsxs("div",{className:`detailed-grading-form ${n}`,children:[e.jsx("div",{className:"total-points-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:'סה"כ נקודות'}),e.jsxs("span",{className:`badge-value ${m>=55?"passing":"failing"}`,children:[m,"/100"]})]})}),e.jsxs("div",{className:"grading-scale-reference",children:[e.jsx("h4",{className:"reference-title",children:"סולם הערכה"}),e.jsxs("div",{className:"scale-table",children:[e.jsxs("div",{className:"scale-row scale-header",children:[e.jsx("span",{children:"דרגה"}),e.jsx("span",{children:"טווח ציונים"}),e.jsx("span",{children:"דרגה"}),e.jsx("span",{children:"טווח ציונים"}),e.jsx("span",{children:"דרגה"}),e.jsx("span",{children:"טווח ציונים"})]}),e.jsxs("div",{className:"scale-row",children:[e.jsx("span",{children:"מעולה"}),e.jsx("span",{children:"95-100"}),e.jsx("span",{children:"טוב מאוד"}),e.jsx("span",{children:"85-89"}),e.jsx("span",{children:"מספיק"}),e.jsx("span",{children:"65-74"})]}),e.jsxs("div",{className:"scale-row",children:[e.jsx("span",{children:"טוב מאוד"}),e.jsx("span",{children:"90-94"}),e.jsx("span",{children:"טוב"}),e.jsx("span",{children:"75-84"}),e.jsx("span",{children:"מספיק"}),e.jsx("span",{children:"55-64"})]}),e.jsxs("div",{className:"scale-row",children:[e.jsx("span",{children:"מספיק בקושי"}),e.jsx("span",{children:"46-53"}),e.jsx("span",{children:"בלתי מספיק"}),e.jsx("span",{children:"40-44"}),e.jsx("span",{}),e.jsx("span",{})]})]})]}),e.jsx("div",{className:"categories-container",children:Object.entries(UR).map(([g,v])=>p(g,v))})]})}function Yj({recordingLinks:t,onChange:s,className:n=""}){const[i,l]=x.useState(""),c=()=>{if(i.trim()&&p(i.trim())){const g=[...t,i.trim()];s(g),l("")}},u=g=>{const v=t.filter((j,N)=>N!==g);s(v)},f=(g,v)=>{const j=[...t];j[g]=v,s(j)},p=g=>{try{return new URL(g),!0}catch{return!1}},m=g=>{g.key==="Enter"&&(g.preventDefault(),c())};return e.jsx("div",{className:`recording-links-manager ${n}`,children:e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[e.jsx(YT,{size:16}),"קישורי תיעוד"]}),t.length>0&&e.jsx("div",{className:"existing-links",children:t.map((g,v)=>e.jsxs("div",{className:"link-item",children:[e.jsx("input",{type:"url",value:g,onChange:j=>f(v,j.target.value),placeholder:"https://...",className:!p(g)&&g.trim()?"invalid":""}),e.jsx("button",{type:"button",onClick:()=>u(v),className:"remove-link-btn","aria-label":"הסר קישור",children:e.jsx(yt,{size:16})})]},v))}),e.jsx("div",{className:"add-link-section",children:e.jsxs("div",{className:"add-link-input",children:[e.jsx("input",{type:"url",value:i,onChange:g=>l(g.target.value),onKeyPress:m,placeholder:"הוסף קישור חדש להקלטה...",className:i.trim()&&!p(i.trim())?"invalid":""}),e.jsx("button",{type:"button",onClick:c,disabled:!i.trim()||!p(i.trim()),className:"add-link-btn","aria-label":"הוסף קישור",children:e.jsx(ls,{size:16})})]})}),t.length===0&&!i&&e.jsx("div",{className:"no-links-placeholder",children:"אין קישורי תיעוד. הוסף קישור להקלטת ההשמעה."})]})})}const Vj=["לא נבחן","עבר/ה","לא עבר/ה"];function qR({presentation:t,presentationIndex:s,presentationType:n,onChange:i,className:l="",teachers:c=[],onHasChangesChange:u}){const[f,p]=x.useState(t),[m,g]=x.useState(!1),v=x.useRef(f),j=n==="magenBagrut",N=D=>{console.log("updateLocalPresentation called with:",D);const S={...f,...D};console.log("Updated presentation will be:",S),p(S),v.current=S,g(!0)},b=x.useCallback(()=>{const D=v.current;console.log("PresentationForm saveChanges called with:",D),i(D),g(!1)},[i]),w=x.useRef(t);x.useEffect(()=>{if(JSON.stringify(w.current)!==JSON.stringify(t)){console.log("New presentation data received, reinitializing:",t),w.current=t;const S={...t,completed:t.completed??!1,status:t.status??"לא נבחן",notes:t.notes??"",recordingLinks:t.recordingLinks??[],...j&&!t.detailedGrading&&{detailedGrading:{playingSkills:{grade:"לא הוערך",points:null,maxPoints:20,comments:"אין הערות"},musicalUnderstanding:{grade:"לא הוערך",points:null,maxPoints:40,comments:"אין הערות"},textKnowledge:{grade:"לא הוערך",points:null,maxPoints:30,comments:"אין הערות"},playingByHeart:{grade:"לא הוערך",points:null,maxPoints:10,comments:"אין הערות"}}}};p(S),v.current=S,g(!1)}},[t,j]),x.useEffect(()=>{u&&u(m,b)},[m]);const C=D=>{j&&N({detailedGrading:D,grade:null,gradeLevel:null})},T=()=>n==="magenBagrut"?"מגן בגרות":`השמעה ${s+1}`,A=()=>{const D=f;return e.jsxs("div",{className:"notes-only-form",children:[e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{htmlFor:"date",children:[e.jsx($e,{size:16}),"תאריך השמעה"]}),e.jsx("input",{id:"date",name:"date",type:"date",value:D.date?new Date(D.date).toISOString().split("T")[0]:"",onChange:S=>N({date:S.target.value?new Date(S.target.value):null})})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"status",children:"סטטוס"}),e.jsx("select",{id:"status",name:"status",value:D.status||"לא נבחן",onChange:S=>N({status:S.target.value}),children:Vj.map(S=>e.jsx("option",{value:S,children:S},S))})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{htmlFor:"notes",children:[e.jsx(tc,{size:16}),"הערות על ההשמעה"]}),e.jsx("textarea",{id:"notes",name:"notes",rows:4,value:D.notes||"",onChange:S=>{console.log("Notes input changed:",S.target.value),N({notes:S.target.value})},placeholder:"הוסף הערות, משוב ותצפיות על ההשמעה..."})]}),e.jsx(Yj,{recordingLinks:D.recordingLinks||[],onChange:S=>N({recordingLinks:S})}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"reviewedBy",children:"שם הבוחן"}),e.jsxs("select",{id:"reviewedBy",name:"reviewedBy",value:D.reviewedBy||"",onChange:S=>N({reviewedBy:S.target.value||null}),children:[e.jsx("option",{value:"",children:"בחר מורה/בוחן"}),c.map(S=>e.jsx("option",{value:S._id,children:S.personalInfo.fullName},S._id))]})]}),e.jsxs("div",{className:"completion-checkbox",children:[e.jsx("span",{className:"checkbox-label",children:"השמעה הושלמה"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:D.completed,onChange:S=>N({completed:S.target.checked})}),e.jsx("span",{className:"toggle-slider"})]})]})]})},_=()=>{const D=f;return e.jsxs("div",{className:"detailed-grading-presentation-form",children:[e.jsxs("div",{className:"basic-info-section",children:[e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{htmlFor:"exam-date",children:[e.jsx($e,{size:16}),"תאריך בחינה"]}),e.jsx("input",{id:"exam-date",name:"date",type:"date",value:D.date?new Date(D.date).toISOString().split("T")[0]:"",onChange:S=>N({date:S.target.value?new Date(S.target.value):null})})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{htmlFor:"exam-status",children:[e.jsx(ms,{size:16}),"סטטוס"]}),e.jsx("select",{id:"exam-status",name:"status",value:D.status||"לא נבחן",onChange:S=>N({status:S.target.value}),children:Vj.map(S=>e.jsx("option",{value:S,children:S},S))})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"exam-reviewedBy",children:"שם הבוחן"}),e.jsxs("select",{id:"exam-reviewedBy",name:"reviewedBy",value:D.reviewedBy||"",onChange:S=>N({reviewedBy:S.target.value||null}),children:[e.jsx("option",{value:"",children:"בחר בוחן"}),c.map(S=>e.jsx("option",{value:S._id,children:S.personalInfo.fullName},S._id))]})]}),e.jsx(Yj,{recordingLinks:D.recordingLinks||[],onChange:S=>N({recordingLinks:S})})]}),e.jsx("div",{className:"detailed-grading-section",children:e.jsx(PR,{detailedGrading:D.detailedGrading,onChange:C})}),D.grade&&D.gradeLevel&&e.jsx("div",{className:"calculated-grade-display",children:e.jsxs("div",{className:"grade-item",children:[e.jsx("span",{className:"grade-label",children:"ציון מחושב:"}),e.jsxs("span",{className:"grade-value",children:[D.grade," (",D.gradeLevel,")"]})]})}),e.jsxs("div",{className:"completion-checkbox",children:[e.jsx("span",{className:"checkbox-label",children:"בחינה הושלמה"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:D.completed,onChange:S=>N({completed:S.target.checked})}),e.jsx("span",{className:"toggle-slider"})]})]})]})};return e.jsxs("div",{className:`presentation-form ${l}`,children:[e.jsxs("div",{className:"presentation-header",children:[e.jsxs("h3",{className:"presentation-title",children:[T(),j&&e.jsx(ms,{size:18,className:"detailed-icon"})]}),e.jsx("div",{className:"presentation-type-badge",children:j?"הערכה מפורטת":"הערות בלבד"}),m&&e.jsxs("div",{className:"changes-indicator",children:[e.jsx("span",{className:"dot"}),"שינויים לא נשמרו"]})]}),e.jsx("div",{className:"presentation-content",children:j?_():A()})]})}function HR({bagrut:t,canEdit:s,teachers:n=[]}){const[i,l]=x.useState(null),[c,u]=x.useState(!1),[f,p]=x.useState(!1),m=x.useRef(null),{updatePresentation:g}=ja(),{addToast:v}=It(),j=(D,S)=>{l({index:D,type:S})},N=async D=>{if(i){u(!0);try{console.log("Saving presentation:",{bagrutId:t._id,index:i.index,data:D});const S=await g(t._id,i.index,D);console.log("Save successful, updated bagrut:",S),v({type:"success",message:"השמעה עודכנה בהצלחה",autoCloseTime:3e3}),l(null),p(!1)}catch(S){console.error("Failed to update presentation:",S),v({type:"danger",message:"שגיאה בעדכון השמעה",autoCloseTime:5e3})}finally{u(!1)}}},b=()=>{l(null),p(!1),m.current=null},w=x.useCallback((D,S)=>{p(D),m.current=S},[]),C=x.useCallback(()=>{m.current&&m.current()},[]),T=D=>D.completed?D.status==="עבר/ה"?e.jsx(Et,{size:16,className:"status-icon success"}):e.jsx(Et,{size:16,className:"status-icon danger"}):e.jsx(Ve,{size:16,className:"status-icon muted"}),A=(D,S,R)=>{var I,M,z,Z;const E=(i==null?void 0:i.index)===S,k="presentation";return e.jsxs("div",{className:"presentation-card",children:[e.jsxs("div",{className:"presentation-header",children:[e.jsxs("div",{className:"presentation-title",children:[e.jsx("h3",{children:R}),T(D)]}),s&&!E&&e.jsx("button",{className:"edit-btn",onClick:()=>j(S,k),"aria-label":`ערוך ${R}`,children:e.jsx(fu,{size:16})})]}),E?e.jsxs("div",{className:"presentation-edit-form",children:[e.jsx(qR,{presentation:D,presentationIndex:typeof S=="number"?S:-1,presentationType:k,onChange:N,className:"editing-form",teachers:n,onHasChangesChange:w}),e.jsxs("div",{className:"form-actions",children:[f&&e.jsxs("button",{className:"btn primary",onClick:C,disabled:c,children:[e.jsx(sc,{size:16}),"שמור שינויים"]}),e.jsxs("button",{className:"btn secondary",onClick:b,disabled:c,children:[e.jsx(yt,{size:16}),"ביטול"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"presentation-grade-section",children:e.jsx("span",{className:`status-badge ${((Z=(z=(M=(I=D.status)==null?void 0:I.replace)==null?void 0:M.call(I,"/",""))==null?void 0:z.replace)==null?void 0:Z.call(z," ","-"))||"לא-נבחן"}`,children:D.status||"לא נבחן"})}),e.jsx("div",{className:"presentation-grade-section",children:e.jsxs("div",{className:"notes-display",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-value",children:D.notes||"אין הערות"})]})}),D.completed&&D.date&&e.jsxs("div",{className:"presentation-date",children:["תאריך: ",new Date(D.date).toLocaleDateString("he-IL")]})]})]},`presentation-${S}`)},_=()=>t.presentations.slice(0,3).filter(S=>S.completed).length;return e.jsxs("div",{className:"presentation-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"header-content",children:e.jsxs("h2",{children:[e.jsx(In,{size:20}),"השמעות"]})}),e.jsxs("div",{className:"completion-summary",children:[e.jsxs("div",{className:"progress-text",children:[_(),"/3 הושלמו"]}),e.jsx("div",{className:"progress-bar small",children:e.jsx("div",{className:"progress-fill",style:{width:`${_()/3*100}%`}})})]})]}),e.jsx("div",{className:"presentations-grid",children:t.presentations.slice(0,3).map((D,S)=>A(D,S,`השמעה ${S+1}`))})]})}function YR({bagrut:t,canEdit:s}){var Q,ne;const[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(-1),[p,m]=x.useState(null),[g,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[C,T]=x.useState({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),{addProgramPiece:A,updateProgramPiece:_,updateProgram:D,removeProgramPiece:S}=ja(),{addToast:R}=It(),E=()=>{i(!0),T({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""})},k=(X,se)=>{const O=X._id||`temp-${se}`;c(O),f(se),m(X),T({pieceTitle:X.pieceTitle,composer:X.composer,duration:X.duration,movement:X.movement||"",youtubeLink:X.youtubeLink||""})},I=async()=>{var X,se;if(!C.pieceTitle.trim()||!C.composer.trim()||!C.duration.trim()){R({type:"warning",message:"נא למלא את כל השדות הנדרשים",autoCloseTime:3e3});return}v(!0);try{const O={pieceTitle:C.pieceTitle.trim(),composer:C.composer.trim(),duration:C.duration.trim(),movement:((X=C.movement)==null?void 0:X.trim())||void 0,youtubeLink:((se=C.youtubeLink)==null?void 0:se.trim())||void 0};if(l&&!l.startsWith("temp-"))await _(t._id,l,O),R({type:"success",message:"יצירה עודכנה בהצלחה",autoCloseTime:3e3});else if(l&&l.startsWith("temp-")){const B=(t.program||[]).map((L,Y)=>Y===u?{pieceTitle:O.pieceTitle,composer:O.composer,duration:O.duration,movement:O.movement,youtubeLink:O.youtubeLink}:{pieceTitle:L.pieceTitle,composer:L.composer,duration:L.duration,movement:L.movement,youtubeLink:L.youtubeLink});await D(t._id,B),R({type:"success",message:"יצירה עודכנה בהצלחה",autoCloseTime:3e3})}else await A(t._id,O),R({type:"success",message:"יצירה נוספה לתוכנית",autoCloseTime:3e3});Z()}catch{R({type:"danger",message:l?"שגיאה בעדכון יצירה":"שגיאה בהוספת יצירה",autoCloseTime:5e3})}finally{v(!1)}},M=(X,se,O)=>{w({id:X,title:se,index:O}),N(!0)},z=async()=>{if(b){v(!0);try{if(b.id&&b.id!=="undefined")await S(t._id,b.id);else{const X=(t.program||[]).filter((se,O)=>O!==b.index);await D(t._id,X)}R({type:"success",message:"יצירה הוסרה מהתוכנית",autoCloseTime:3e3})}catch{R({type:"danger",message:"שגיאה בהסרת יצירה",autoCloseTime:5e3})}finally{v(!1),N(!1),w(null)}}},Z=()=>{i(!1),c(null),T({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""})},ee=X=>{if(X.includes(":"))return X;const se=parseInt(X);return isNaN(se)?X:`${se} דקות`},W=()=>e.jsxs("div",{className:"piece-form-card",children:[e.jsx("div",{className:"form-header",children:e.jsx("h4",{children:l?"ערוך יצירה":"הוסף יצירה חדשה"})}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"שם היצירה *"}),e.jsx("input",{type:"text",value:C.pieceTitle,onChange:X=>T({...C,pieceTitle:X.target.value}),placeholder:"הזן שם יצירה",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"מלחין *"}),e.jsx("input",{type:"text",value:C.composer,onChange:X=>T({...C,composer:X.target.value}),placeholder:"הזן שם מלחין",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"משך זמן *"}),e.jsx("input",{type:"text",value:C.duration,onChange:X=>T({...C,duration:X.target.value}),placeholder:"לדוגמה: 5:30 או 8 דקות",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"פרק/חלק (אופציונלי)"}),e.jsx("input",{type:"text",value:C.movement,onChange:X=>T({...C,movement:X.target.value}),placeholder:"לדוגמה: פרק ראשון, אלגרו",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"קישור YouTube (אופציונלי)"}),e.jsx("input",{type:"url",value:C.youtubeLink,onChange:X=>T({...C,youtubeLink:X.target.value}),placeholder:"https://youtube.com/...",className:"form-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn secondary",onClick:Z,disabled:g,children:[e.jsx(yt,{size:16}),"ביטול"]}),e.jsxs("button",{className:"btn primary",onClick:I,disabled:g,children:[e.jsx(sc,{size:16}),g?"שומר...":"שמור"]})]})]}),K=(X,se)=>e.jsxs("div",{className:"piece-card",children:[e.jsxs("div",{className:"piece-header",children:[e.jsxs("div",{className:"piece-title-section",children:[e.jsx(Je,{size:16,className:"piece-icon"}),e.jsxs("div",{className:"piece-title-info",children:[e.jsx("h4",{className:"piece-title",children:X.pieceTitle}),e.jsx("p",{className:"piece-composer",children:X.composer})]})]}),s&&e.jsxs("div",{className:"piece-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:O=>{console.log("Edit button click event triggered"),O.preventDefault(),O.stopPropagation(),k(X,se)},disabled:g,"aria-label":"ערוך יצירה",children:e.jsx(fu,{size:14})}),e.jsx("button",{className:"action-btn delete",onClick:()=>M(X._id,X.pieceTitle,se),disabled:g,"aria-label":"הסר יצירה",children:e.jsx(_t,{size:14})})]})]}),e.jsxs("div",{className:"piece-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:ee(X.duration)})]}),X.movement&&e.jsx("div",{className:"detail-item",children:e.jsx("span",{className:"movement-text",children:X.movement})}),X.youtubeLink&&e.jsx("div",{className:"detail-item",children:e.jsxs("a",{href:X.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"youtube-link",children:[e.jsx(vm,{size:14}),"צפה ב-YouTube"]})})]})]},X._id||`piece-${se}`);return e.jsxs("div",{className:"program-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"תוכנית מוזיקלית"}),e.jsxs("div",{className:"program-summary",children:[((Q=t.program)==null?void 0:Q.length)||0," יצירות בתוכנית"]}),s&&!n&&!l&&e.jsxs("button",{className:"btn primary",onClick:E,children:[e.jsx(ls,{size:16}),"הוסף יצירה"]})]}),(n||l)&&W(),(((ne=t.program)==null?void 0:ne.length)||0)===0&&!n?e.jsxs("div",{className:"empty-state",children:[e.jsx(Je,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין יצירות בתוכנית"}),e.jsx("p",{children:"התחל בהוספת יצירות לתוכנית הבגרות"})]}):e.jsx("div",{className:"pieces-grid",children:(t.program||[]).map((X,se)=>K(X,se))}),e.jsx(gs,{isOpen:j,onClose:()=>{N(!1),w(null)},onConfirm:z,title:"הסרת יצירה",message:b?e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך להסיר את היצירה ",e.jsxs("strong",{children:['"',b.title,'"']})," מהתוכנית?",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--danger-color)",fontSize:"0.9em"},children:"פעולה זו אינה ניתנת לביטול."})]}):null,confirmText:"הסר יצירה",cancelText:"ביטול",type:"danger"})]})}function VR({bagrut:t,canEdit:s}){var K,Q,ne,X;const[n,i]=x.useState(!1),[l,c]=x.useState(!1),[u,f]=x.useState(!1),[p,m]=x.useState(-1);x.useEffect(()=>{console.log("GradingManager received bagrut:",t),console.log("Presentations:",t.presentations),t.presentations.forEach((se,O)=>{console.log(`Presentation ${O+1}:`,{completed:se.completed,status:se.status,notes:se.notes||"No notes"})})},[t]);const g=()=>({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}}),[v,j]=x.useState(g()),{updateGradingDetails:N,calculateFinalGrade:b,updatePresentation:w,updateMagenBagrut:C,loadBagrutById:T}=ja(),{addToast:A}=It();x.useEffect(()=>{n||j({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}})},[t.gradingDetails,n]);const _=()=>{i(!0),j({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}})},D=async()=>{console.log("Starting save process...",v),c(!0);try{const se={technique:{grade:v.technique.grade,maxPoints:20,comments:v.technique.comments},interpretation:{grade:v.interpretation.grade,maxPoints:30,comments:v.interpretation.comments},musicality:{grade:v.musicality.grade,maxPoints:40,comments:v.musicality.comments},overall:{grade:v.overall.grade,maxPoints:10,comments:v.overall.comments}};console.log("Sending grading data:",se);const O=await N(t._id,se);console.log("Update result:",O),A({type:"success",message:"ציונים עודכנו בהצלחה",autoCloseTime:3e3}),i(!1)}catch(se){console.error("Error saving grading details:",se),A({type:"danger",message:"שגיאה בעדכון ציונים",autoCloseTime:5e3})}finally{c(!1)}},S=async()=>{c(!0);try{await b(t._id),A({type:"success",message:"ציון סופי חושב בהצלחה",autoCloseTime:3e3})}catch{A({type:"danger",message:"שגיאה בחישוב ציון סופי",autoCloseTime:5e3})}finally{c(!1)}},R=()=>{i(!1)},E=(se,O,B)=>{j(L=>({...L,[se]:{...L[se],[O]:B}}))},k=(se,O)=>{if(se===null)return"var(--text-muted)";const B=se/O*100;return B>=90?"var(--success)":B>=75?"var(--info)":B>=55?"var(--warning)":"var(--danger)"},I=()=>[v.technique.grade||0,v.interpretation.grade||0,v.musicality.grade||0,v.overall.grade||0].reduce((O,B)=>O+B,0),M=(se,O,B,L)=>{const Y=t.gradingDetails[se],H=v[se];return e.jsxs("div",{className:"grading-category",children:[e.jsx("div",{className:"category-header",children:e.jsxs("div",{className:"category-info",children:[e.jsxs("div",{className:"header-with-grade",children:[e.jsx("h4",{children:O}),e.jsxs("div",{className:"grade-inline",children:[e.jsx("span",{children:"ציון:"}),n?e.jsx("input",{type:"number",min:"0",max:B,value:H.grade||"",onChange:P=>E(se,"grade",P.target.value?Number(P.target.value):null),className:"grade-input",placeholder:"0"}):e.jsx("span",{className:"grade-display",style:{color:k(Y.grade,B)},children:Y.grade!==null?`${Y.grade}/${B}`:"לא הוערך"})]})]}),L,e.jsxs("span",{className:"max-points",children:["מקסימום: ",B," נקודות"]})]})}),e.jsxs("div",{className:"category-comments",children:[e.jsx("label",{children:"הערות:"}),n?e.jsx("textarea",{value:H.comments,onChange:P=>E(se,"comments",P.target.value),placeholder:"הזן הערות...",rows:3,className:"comments-input"}):e.jsx("p",{className:"comments-display",children:Y.comments||"אין הערות"})]})]})},z=async(se,O)=>{c(!0);try{const B={completed:O,status:O?"עבר/ה":"לא נבחן",date:O?new Date:null};se===3&&await C(t._id,B);const L=se===3?"מגן בגרות":`השמעה ${se+1}`;A({type:"success",message:`${L} ${O?"סומנה כהושלמה":"סומנה כלא הושלמה"}`,autoCloseTime:3e3})}catch(B){console.error("Error updating presentation status:",B),A({type:"danger",message:"שגיאה בעדכון סטטוס השמעה",autoCloseTime:5e3})}finally{c(!1)}},Z=se=>{m(se),f(!0)},ee=async()=>{c(!0);try{const se={completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null};p===3?await C(t._id,se):await w(t._id,p,se),await b(t._id),await T(t._id);const O=p===3?"מגן בגרות":`השמעה ${p+1}`;A({type:"success",message:`${O} אופס בהצלחה`,autoCloseTime:3e3})}catch(se){console.error("Error resetting presentation:",se),A({type:"danger",message:"שגיאה באיפוס השמעה",autoCloseTime:5e3})}finally{c(!1),f(!1),m(-1)}},W=se=>se===3?"מגן בגרות":`השמעה ${se+1}`;return e.jsxs("div",{className:"grading-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"מגן בגרות - ציונים מפורטים"}),s&&!n&&e.jsxs("div",{className:"header-buttons",children:[e.jsxs("button",{className:"btn primary",onClick:_,children:[e.jsx(fu,{size:16}),"ערוך ציונים"]}),e.jsxs("button",{className:"btn secondary reset-presentation-btn",onClick:()=>Z(3),title:"איפוס מגן בגרות",children:[e.jsx(Uo,{size:16}),"איפוס מגן בגרות"]})]})]}),e.jsx("div",{className:"magen-bagrut-summary",children:e.jsxs("div",{className:"magen-status-card",children:[e.jsxs("div",{className:"status-info",children:[e.jsxs("div",{className:"status-header",children:[e.jsx("span",{className:"magen-title",children:"מגן בגרות"}),e.jsx("span",{className:`status-badge ${((X=(ne=(Q=(K=t.magenBagrut.status)==null?void 0:K.replace)==null?void 0:Q.call(K,"/",""))==null?void 0:ne.replace)==null?void 0:X.call(ne," ","-"))||"לא-נבחן"}`,children:t.magenBagrut.status||"לא נבחן"})]}),e.jsxs("div",{className:"grade-display",children:[e.jsx("span",{className:"grade-label",children:"ציון סופי:"}),e.jsx("span",{className:"grade-value",children:t.magenBagrut.grade?`${t.magenBagrut.grade} (${t.magenBagrut.gradeLevel})`:"לא הוערך"})]}),t.magenBagrut.completed&&t.magenBagrut.date&&e.jsxs("div",{className:"completion-date",children:["תאריך השלמה: ",new Date(t.magenBagrut.date).toLocaleDateString("he-IL")]})]}),s&&e.jsx("div",{className:"completion-toggle",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("span",{children:"הושלם"}),e.jsxs("div",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:t.magenBagrut.completed,onChange:se=>z(3,se.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]})})]})}),t.finalGrade&&e.jsx("div",{className:"final-grade-summary",children:e.jsxs("div",{className:"final-grade-card",children:[e.jsx(ms,{size:24}),e.jsxs("div",{className:"final-grade-info",children:[e.jsxs("h3",{children:["ציון סופי: ",t.finalGrade]}),e.jsxs("p",{children:["רמת ציון: ",t.finalGradeLevel]})]})]})}),e.jsxs("div",{className:"grading-categories",children:[M("technique","מיומנות נגינה/שירה",20,""),M("musicality","הבנה מוסיקלית",40,""),M("interpretation","ידיעת הטקסט",30,""),M("overall",'נוגן בע"פ',10,"")]}),n&&e.jsx("div",{className:"current-total",children:e.jsxs("div",{className:"total-info",children:[e.jsx(hx,{size:16}),e.jsxs("span",{children:['סה"כ נוכחי: ',I(),"/100"]})]})}),n?e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn primary",onClick:D,disabled:l,children:[e.jsx(sc,{size:16}),l?"שומר...":"שמור ציונים"]}),e.jsxs("button",{className:"btn secondary",onClick:R,disabled:l,children:[e.jsx(yt,{size:16}),"ביטול"]})]}):s&&e.jsx("div",{className:"calculate-actions",children:e.jsxs("button",{className:"btn primary",onClick:S,disabled:l,children:[e.jsx(hx,{size:16}),l?"מחשב...":"חשב ציון סופי"]})}),e.jsxs("div",{className:"grading-scale-reference",children:[e.jsx("h4",{children:"סולם ציונים:"}),e.jsxs("div",{className:"scale-items",children:[e.jsx("div",{className:"scale-item",children:"מעולה: 95-100"}),e.jsx("div",{className:"scale-item",children:"טוב מאוד: 90-94"}),e.jsx("div",{className:"scale-item",children:"טוב: 75-89"}),e.jsx("div",{className:"scale-item",children:"מספיק: 55-74"}),e.jsx("div",{className:"scale-item",children:"מספיק בקושי: 45-54"}),e.jsx("div",{className:"scale-item",children:"לא עבר/ה: 0-44"})]})]}),e.jsx(gs,{isOpen:u,onClose:()=>{f(!1),m(-1)},onConfirm:ee,title:"איפוס השמעה",message:e.jsxs("div",{children:[e.jsxs("p",{children:["האם אתה בטוח שברצונך לאפס את ",e.jsx("strong",{children:W(p)}),"?"]}),e.jsx("p",{children:'פעולה זו תמחק את כל הנתונים הקשורים להשמעה ותחזיר אותה לסטטוס "לא נבחן".'})]}),confirmText:"איפוס השמעה",cancelText:"ביטול",type:"danger"})]})}function GR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(!1),u=x.useRef(null),{uploadDocument:f,removeDocument:p}=ja(),{addToast:m}=It(),g=async T=>{if(!T||T.length===0)return;const A=T[0],_=10*1024*1024;if(A.size>_){m({type:"warning",message:"קובץ גדול מדי. גודל מקסימלי: 10MB",autoCloseTime:4e3});return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","audio/mpeg","audio/wav","video/mp4"].includes(A.type)){m({type:"warning",message:"סוג קובץ לא נתמך. נתמכים: PDF, Word, תמונות, אודיו, וידאו",autoCloseTime:4e3});return}i(!0);try{await f(t._id,A),m({type:"success",message:"מסמך הועלה בהצלחה",autoCloseTime:3e3})}catch{m({type:"danger",message:"שגיאה בהעלאת מסמך",autoCloseTime:5e3})}finally{i(!1),u.current&&(u.current.value="")}},v=async(T,A)=>{if(confirm(`האם אתה בטוח שברצונך למחוק את המסמך "${A}"?`))try{await p(t._id,T),m({type:"success",message:"מסמך נמחק בהצלחה",autoCloseTime:3e3})}catch{m({type:"danger",message:"שגיאה במחיקת מסמך",autoCloseTime:5e3})}},j=T=>{T.preventDefault(),c(!0)},N=T=>{T.preventDefault(),c(!1)},b=T=>{T.preventDefault(),c(!1),g(T.dataTransfer.files)},w=T=>{if(T===0)return"0 B";const A=1024,_=["B","KB","MB","GB"],D=Math.floor(Math.log(T)/Math.log(A));return parseFloat((T/Math.pow(A,D)).toFixed(2))+" "+_[D]},C=T=>T.startsWith("image/")?"🖼️":T.startsWith("audio/")?"🎵":T.startsWith("video/")?"🎬":T.includes("pdf")?"📄":T.includes("word")?"📝":"📋";return e.jsxs("div",{className:"document-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"מסמכים נלווים"}),e.jsxs("div",{className:"documents-count",children:[t.documents.length," מסמכים"]})]}),s&&e.jsxs("div",{className:`upload-area ${l?"dragging":""} ${n?"uploading":""}`,onDragOver:j,onDragLeave:N,onDrop:b,onClick:()=>{var T;return(T=u.current)==null?void 0:T.click()},children:[e.jsx("input",{ref:u,type:"file",onChange:T=>g(T.target.files),style:{display:"none"},disabled:n}),e.jsxs("div",{className:"upload-content",children:[e.jsx(NE,{size:32,className:"upload-icon"}),e.jsx("h4",{children:n?"מעלה קובץ...":"העלה מסמך"}),e.jsx("p",{children:"גרור קובץ לכאן או לחץ לבחירה"}),e.jsx("p",{className:"upload-hint",children:"PDF, Word, תמונות, אודיو, וידאו (עד 10MB)"})]})]}),t.documents.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(tc,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין מסמכים"}),e.jsx("p",{children:"העלה מסמכים נלווים לבגרות"})]}):e.jsx("div",{className:"documents-list",children:t.documents.map(T=>e.jsxs("div",{className:"document-card",children:[e.jsxs("div",{className:"document-info",children:[e.jsx("div",{className:"document-icon",children:e.jsx("span",{className:"file-type-icon",children:C(T.mimetype)})}),e.jsxs("div",{className:"document-details",children:[e.jsx("h4",{className:"document-name",children:T.title||T.filename}),e.jsxs("div",{className:"document-meta",children:[e.jsx("span",{className:"file-size",children:w(T.size)}),e.jsx("span",{className:"upload-date",children:new Date(T.uploadDate).toLocaleDateString("he-IL")})]})]})]}),e.jsxs("div",{className:"document-actions",children:[e.jsx("button",{className:"action-btn view",onClick:()=>{m({type:"info",message:"פתיחת מסמך (יש להטמיע)",autoCloseTime:3e3})},"aria-label":"צפה במסמך",children:e.jsx(ba,{size:16})}),e.jsx("button",{className:"action-btn download",onClick:()=>{m({type:"info",message:"הורדת מסמך (יש להטמיע)",autoCloseTime:3e3})},"aria-label":"הורד מסמך",children:e.jsx(OT,{size:16})}),s&&e.jsx("button",{className:"action-btn delete",onClick:()=>v(T._id,T.filename),"aria-label":"מחק מסמך",children:e.jsx(_t,{size:16})})]})]},T._id))})]})}function QR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState({name:"",instrument:"",phone:""}),{addAccompanist:g,removeAccompanist:v}=ja(),{addToast:j}=It(),N=Array.isArray(t.accompaniment)?t.accompaniment:[],b=()=>{i(!0),m({name:"",instrument:"",phone:""})},w=S=>{c(S._id),m({name:S.name,instrument:S.instrument,phone:S.phone||""})},C=async()=>{if(!p.name.trim()||!p.instrument.trim()){j({type:"warning",message:"נא למלא שם וכלי נגינה",autoCloseTime:3e3});return}f(!0);try{const S={name:p.name.trim(),instrument:p.instrument.trim(),phone:p.phone.trim()||void 0};await g(t._id,S),j({type:"success",message:"מלווה נוסף בהצלחה",autoCloseTime:3e3}),A()}catch{j({type:"danger",message:"שגיאה בהוספת מלווה",autoCloseTime:5e3})}finally{f(!1)}},T=async(S,R)=>{if(confirm(`האם אתה בטוח שברצונך להסיר את המלווה "${R}"?`)){f(!0);try{await v(t._id,S),j({type:"success",message:"מלווה הוסר בהצלחה",autoCloseTime:3e3})}catch{j({type:"danger",message:"שגיאה בהסרת מלווה",autoCloseTime:5e3})}finally{f(!1)}}},A=()=>{i(!1),c(null),m({name:"",instrument:"",phone:""})},_=()=>e.jsxs("div",{className:"accompanist-form-card",children:[e.jsx("div",{className:"form-header",children:e.jsx("h4",{children:l?"ערוך מלווה":"הוסף מלווה"})}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"שם מלא *"}),e.jsx("input",{type:"text",value:p.name,onChange:S=>m({...p,name:S.target.value}),placeholder:"הזן שם מלא",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"כלי נגינה *"}),e.jsx("input",{type:"text",value:p.instrument,onChange:S=>m({...p,instrument:S.target.value}),placeholder:"לדוגמה: פסנתר, כינור",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"טלפון (אופציונלי)"}),e.jsx("input",{type:"tel",value:p.phone,onChange:S=>m({...p,phone:S.target.value}),placeholder:"מספר טלפון ליצירת קשר",className:"form-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn secondary",onClick:A,disabled:u,children:[e.jsx(yt,{size:16}),"ביטול"]}),e.jsxs("button",{className:"btn primary",onClick:C,disabled:u,children:[e.jsx(sc,{size:16}),u?"שומר...":"שמור"]})]})]}),D=S=>e.jsxs("div",{className:"accompanist-card",children:[e.jsxs("div",{className:"accompanist-header",children:[e.jsxs("div",{className:"accompanist-info",children:[e.jsx(fx,{size:16,className:"accompanist-icon"}),e.jsxs("div",{className:"accompanist-details",children:[e.jsx("h4",{className:"accompanist-name",children:S.name}),e.jsx("p",{className:"accompanist-instrument",children:S.instrument})]})]}),s&&e.jsxs("div",{className:"accompanist-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:()=>w(S),disabled:u,"aria-label":"ערוך מלווה",children:e.jsx(fu,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>T(S._id,S.name),disabled:u,"aria-label":"הסר מלווה",children:e.jsx(_t,{size:16})})]})]}),S.phone&&e.jsxs("div",{className:"accompanist-contact",children:[e.jsx(fi,{size:14}),e.jsx("span",{children:S.phone})]})]},S._id);return e.jsxs("div",{className:"accompaniment-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"מלווים"}),e.jsxs("div",{className:"accompanists-summary",children:[N.length," מלווים"]}),s&&!n&&!l&&e.jsxs("button",{className:"btn primary",onClick:b,children:[e.jsx(ls,{size:16}),"הוסף מלווה"]})]}),(n||l)&&_(),N.length===0&&!n?e.jsxs("div",{className:"empty-state",children:[e.jsx(fx,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין מלווים"}),e.jsx("p",{children:"הוסף מלווים לביצוע הבגרות"})]}):e.jsx("div",{className:"accompanists-grid",children:N.map(D)})]})}function XR({bagrut:t}){var b;const[s,n]=x.useState(!1),[i,l]=x.useState(!1),[c,u]=x.useState(""),{completeBagrut:f}=ja(),{addToast:p}=It(),{user:m}=vs(),g=async()=>{if(!c.trim()){p({type:"warning",message:"נא להזין חתימה דיגיטלית",autoCloseTime:3e3});return}n(!0);try{await f(t._id,c.trim()),p({type:"success",message:"בגרות הושלמה בהצלחה! מזל טוב!",autoCloseTime:5e3}),l(!1),u("")}catch{p({type:"danger",message:"שגיאה בהשלמת הבגרות",autoCloseTime:5e3})}finally{n(!1)}},j=[{id:"presentations",title:"4 השמעות",completed:t.presentations.every(C=>C.completed),description:"כל 4 ההשמעות יجב להיות מושלמות"},{id:"magen",title:"מגן בגרות",completed:t.magenBagrut.completed,description:"מגן בגרות (הגנה סופית) יגב להיות מושלם"},{id:"program",title:"תוכנית מוזיקלית",completed:t.program.length>0,description:"לפחות יצירה אחת בתוכנית"},{id:"grading",title:"ציונים מפורטים",completed:t.gradingDetails.technique.grade!==null&&t.gradingDetails.interpretation.grade!==null&&t.gradingDetails.musicality.grade!==null&&t.gradingDetails.overall.grade!==null,description:"כל הקטגוריות יגבו להיות מדורגות"},{id:"finalGrade",title:"ציון סופי",completed:t.finalGrade!==null,description:"ציון סופי יגב להיות מחושב"}],N=j.every(w=>w.completed);return t.isCompleted?e.jsxs("div",{className:"completion-status completed",children:[e.jsxs("div",{className:"completion-header",children:[e.jsx(Et,{size:32,className:"completion-icon success"}),e.jsxs("div",{className:"completion-info",children:[e.jsx("h3",{children:"בגרות הושלמה בהצלחה!"}),e.jsxs("p",{children:["ציון סופי: ",t.finalGrade," (",t.finalGradeLevel,")"]})]})]}),e.jsxs("div",{className:"completion-details",children:[t.completionDate&&e.jsxs("div",{className:"detail-item",children:[e.jsx($e,{size:16}),e.jsxs("span",{children:["תאריך השלמה: ",new Date(t.completionDate).toLocaleDateString("he-IL")]})]}),t.teacherSignature&&e.jsxs("div",{className:"detail-item",children:[e.jsx(BT,{size:16}),e.jsxs("span",{children:["חתימת מורה: ",t.teacherSignature]})]}),t.finalGrade&&e.jsxs("div",{className:"detail-item",children:[e.jsx(ms,{size:16}),e.jsx("span",{children:"הישג מעולה! התלמיד עבר בהצלחה את הבגרות"})]})]})]}):e.jsxs("div",{className:"completion-manager",children:[e.jsxs("div",{className:"completion-header",children:[e.jsx("h3",{children:"השלמת בגרות"}),e.jsx("p",{children:"בדוק את הדרישות והשלם את תהליך הבגרות"})]}),e.jsxs("div",{className:"requirements-checklist",children:[e.jsx("h4",{children:"דרישות להשלמה:"}),e.jsx("div",{className:"requirements-list",children:j.map(w=>e.jsxs("div",{className:`requirement-item ${w.completed?"completed":"pending"}`,children:[e.jsx("div",{className:"requirement-status",children:e.jsx(Et,{size:20,className:w.completed?"completed-icon":"pending-icon"})}),e.jsxs("div",{className:"requirement-content",children:[e.jsx("h5",{children:w.title}),e.jsx("p",{children:w.description})]})]},w.id))})]}),e.jsx("div",{className:"completion-actions",children:N?i?e.jsxs("div",{className:"completion-form",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h4",{children:"השלמה סופית"}),e.jsx("p",{children:"אישור השלמת כל שלבי הבגרות"})]}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"signature-section",children:[e.jsx("label",{children:"חתימה דיגיטלית של המורה *"}),e.jsx("input",{type:"text",value:c,onChange:w=>u(w.target.value),placeholder:((b=m==null?void 0:m.personalInfo)==null?void 0:b.fullName)||"הזן שם מלא",className:"signature-input"}),e.jsx("p",{className:"signature-note",children:"חתימה זו מאשרת כי התלמיד השלים בהצלחה את כל שלבי הבגרות"})]}),e.jsxs("div",{className:"final-summary",children:[e.jsx("h5",{children:"סיכום סופי:"}),e.jsxs("div",{className:"summary-items",children:[e.jsx("div",{children:"השמעות הושלמו: ✓"}),e.jsx("div",{children:"מגן בגרות הושלם: ✓"}),e.jsxs("div",{children:["ציון סופי: ",t.finalGrade," (",t.finalGradeLevel,")"]}),e.jsx("div",{children:"מועמד/ת עומד/ת בכל הדרישות"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn secondary",onClick:()=>{l(!1),u("")},disabled:s,children:"ביטול"}),e.jsxs("button",{className:"btn primary",onClick:g,disabled:s||!c.trim(),children:[e.jsx(Et,{size:16}),s?"משלים...":"השלם בגרות סופית"]})]})]}):e.jsxs("button",{className:"btn primary large",onClick:()=>l(!0),children:[e.jsx(Et,{size:20}),"השלם בגרות"]}):e.jsx("div",{className:"incomplete-notice",children:e.jsx("p",{children:"יש להשלים את כל הדרישות לפני סיום הבגרות"})})}),N&&!i&&e.jsx("div",{className:"congratulations-preview",children:e.jsxs("div",{className:"celebration-content",children:[e.jsx(ms,{size:48,className:"celebration-icon"}),e.jsx("h4",{children:"כל הכבוד!"}),e.jsx("p",{children:'התלמיד מוכן לסיום הבגרות. לחץ על "השלם בגרות" להשלמה סופית.'})]})})]})}function ZR(){var R;const{bagrutId:t}=Nr(),s=Ot(),{user:n}=vs(),{addToast:i}=It(),[l,c]=x.useState("program"),{selectedBagrut:u,isLoading:f,error:p,loadBagrutById:m,clearError:g}=ja(),{students:v,loadStudents:j}=La(),{teachers:N,loadTeachers:b}=Ds();x.useEffect(()=>{t&&m(t),j(),b()},[t,m,j,b]);const w=()=>{s("/bagrut")},C=()=>{var I;if(!u)return{text:"לא החל",color:"var(--text-muted)",icon:Ve};if(u.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const E=(u.presentations||[]).filter(M=>M.completed).length,k=((I=u.magenBagrut)==null?void 0:I.completed)||!1;return E>0||k?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},T=u?v.find(E=>E._id===u.studentId):void 0,A=u?N.find(E=>E._id===u.teacherId):void 0,_=n&&(((R=n.roles)==null?void 0:R.includes("מנהל"))||(u==null?void 0:u.teacherId)===n._id),D=()=>{var z,Z;if(!u)return{completed:0,total:4,percentage:0};const E=((z=u.presentations)==null?void 0:z.filter(ee=>(ee==null?void 0:ee.completed)===!0).length)||0,k=((Z=u.magenBagrut)==null?void 0:Z.completed)===!0?1:0,I=4,M=E+k;return{completed:M,total:I,percentage:M/I*100}};if(f)return e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{className:"loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי בגרות..."})]});if(p||!u)return e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:p||"לא ניתן לטעון את פרטי הבגרות"}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:w,className:"btn secondary",children:"חזרה לרשימת בגרויות"}),e.jsx("button",{onClick:()=>{g(),t&&m(t)},className:"btn primary",children:"נסה שוב"})]})]});const S=D();return e.jsxs("div",{className:"app-container",children:[e.jsx(Rn,{}),e.jsxs("main",{className:"main-content bagrut-details-page",children:[e.jsxs("div",{className:"bagrut-header",children:[e.jsxs("div",{className:"header-top",children:[e.jsx("button",{className:"back-btn",onClick:w,"aria-label":"חזרה",children:e.jsx(Bs,{size:20})}),e.jsxs("div",{className:"bagrut-title-info",children:[e.jsxs("div",{className:"header-with-badge",children:[e.jsx("h1",{children:"בגרות בנגינה"}),(()=>{const E=C(),k=E.icon;return e.jsxs("div",{className:"status-badge",style:{backgroundColor:E.color},children:[e.jsx(k,{size:14}),e.jsx("span",{children:E.text})]})})()]}),e.jsx("div",{className:"bagrut-meta",children:u.conservatoryName&&e.jsx("span",{className:"conservatory-name",children:u.conservatoryName})})]})]}),e.jsxs("div",{className:"participants-info",children:[e.jsxs("div",{className:"participant-card",children:[e.jsx(We,{size:16}),e.jsxs("div",{className:"participant-details",children:[e.jsx("div",{className:"participant-name",children:(T==null?void 0:T.personalInfo.fullName)||"תלמיד לא זמין"}),e.jsx("div",{className:"participant-role",children:"תלמיד"})]})]}),e.jsxs("div",{className:"participant-card",children:[e.jsx(pr,{size:16}),e.jsxs("div",{className:"participant-details",children:[e.jsx("div",{className:"participant-name",children:(A==null?void 0:A.personalInfo.fullName)||"מורה לא זמין"}),e.jsx("div",{className:"participant-role",children:"מורה מנחה"})]})]})]}),e.jsxs("div",{className:"progress-section",children:[e.jsx("div",{className:"progress-header",children:e.jsxs("span",{children:["התקדמות: ",S.completed,"/",S.total]})}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${S.percentage}%`}})})]}),u.finalGrade&&e.jsxs("div",{className:"final-grade-display",children:[e.jsx(ms,{size:16}),e.jsxs("span",{children:["ציון סופי: ",u.finalGrade," (",u.finalGradeLevel,")"]})]})]}),e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${l==="program"?"active":""}`,onClick:()=>c("program"),children:[e.jsx(Je,{size:16}),"תוכנית"]}),e.jsxs("button",{className:`tab-btn ${l==="presentations"?"active":""}`,onClick:()=>c("presentations"),children:[e.jsx($e,{size:16}),"השמעות"]}),e.jsxs("button",{className:`tab-btn ${l==="grading"?"active":""}`,onClick:()=>c("grading"),children:[e.jsx(ms,{size:16}),"מגן בגרות"]}),e.jsxs("button",{className:`tab-btn ${l==="documents"?"active":""}`,onClick:()=>c("documents"),children:[e.jsx(tc,{size:16}),"מסמכים"]})]}),e.jsxs("div",{className:"tab-content",children:[l==="presentations"&&e.jsx(HR,{bagrut:u,canEdit:!!_,teachers:N}),l==="program"&&e.jsxs("div",{className:"program-tab-content",children:[e.jsx(YR,{bagrut:u,canEdit:!!_}),e.jsx(QR,{bagrut:u,canEdit:!!_})]}),l==="grading"&&e.jsx(VR,{bagrut:u,canEdit:!!_},`grading-${u._id}-${u.updatedAt}`),l==="documents"&&e.jsx(GR,{bagrut:u,canEdit:!!_})]}),!u.isCompleted&&_&&S.completed===S.total&&e.jsx(XR,{bagrut:u})]})]})}const dN=({teacherId:t,teacherName:s,onFullScreenView:n,compact:i=!1})=>{var oe,ce;const[l,c]=x.useState([]),[u,f]=x.useState(!0),[p,m]=x.useState(null),[g,v]=x.useState(0),[j,N]=x.useState(null),[b,w]=x.useState({}),[C,T]=x.useState(new Set),[A,_]=x.useState(null),[D,S]=x.useState(null),{currentTeacherSchedule:R,isLoading:E,loadTeacherSchedule:k}=kl(),I=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],M=x.useMemo(()=>{const pe=lt().tz("Asia/Jerusalem").startOf("week").add(g,"week");return I.map((me,je)=>({day:I[je],date:pe.add(je,"day"),dateString:pe.add(je,"day").format("YYYY-MM-DD"),displayDate:pe.add(je,"day").format("DD/MM")}))},[g]),z=x.useCallback(G=>{const re=M.find(pe=>pe.day===G);return re?re.dateString:Za.formatForAPI(new Date)},[M]),Z=x.useCallback(async G=>{const re=G.filter(me=>me.scheduleSlotId);if(re.length===0){console.log("No lessons with scheduleSlotId found for attendance loading");return}console.log(`Loading attendance for ${re.length} lessons`);const pe=re.map(me=>me.scheduleSlotId);T(me=>{const je=new Set(me);return pe.forEach(Oe=>je.add(Oe)),je});try{const me=pe.map(async Te=>{var Be,V;try{const ue=await dl.getLessonAttendance(Te);return{scheduleSlotId:Te,attendanceData:ue,success:!0}}catch(ue){return(Be=ue.message)!=null&&Be.includes("not found")||(V=ue.message)!=null&&V.includes("לא נמצא")?(console.log(`Schedule slot ${Te} not found in attendance system - this is expected for lessons not configured for attendance tracking`),{scheduleSlotId:Te,attendanceData:null,success:!1,notFound:!0}):(console.log(`Error loading attendance for lesson ${Te}:`,ue),{scheduleSlotId:Te,attendanceData:null,success:!1,notFound:!1})}}),je=await Promise.allSettled(me),Oe={};let De=0,be=0;je.forEach(Te=>{if(Te.status==="fulfilled"){const{scheduleSlotId:Be,attendanceData:V,success:ue,notFound:ve}=Te.value;ue&&V&&V.attendance?(Oe[Be]=V.attendance,De++):ve&&be++}}),w(Te=>({...Te,...Oe})),console.log(`Loaded attendance for ${De} lessons, ${be} lessons not found in attendance system`)}catch(me){console.error("Error loading attendance data:",me)}finally{T(me=>{const je=new Set(me);return pe.forEach(Oe=>je.delete(Oe)),je})}},[]),ee=x.useCallback(async()=>{if(t)try{f(!0),m(null);const[G,re]=await Promise.allSettled([Jt.getTeacherLessons(t),k(t)]);let pe=null;G.status==="fulfilled"&&(pe=G.value);let me={};if(pe!=null&&pe.lessons&&Array.isArray(pe.lessons)&&(console.log("Processing lessons data:",pe.lessons),pe.lessons.forEach(De=>{var V;const be=De.day||De.dayOfWeek;if(!be)return;const Te=W(be);me[Te]||(me[Te]=[]);const Be={_id:De._id||`${De.studentId}-${De.time}`,time:De.time||De.startTime||De.lessonStartTime,studentName:De.studentName||"תלמיד לא ידוע",studentId:De.studentId,duration:De.duration||45,instrument:typeof De.instrument=="object"?((V=De.instrument)==null?void 0:V.instrumentName)||"":De.instrument||"",day:Te,endTime:De.endTime||De.lessonEndTime||K(De.time||De.startTime,De.duration||45),location:De.location,scheduleSlotId:De.scheduleSlotId};me[Te].push(Be)}),Object.keys(me).forEach(De=>{me[De].sort((be,Te)=>(be.time||"").localeCompare(Te.time||""))})),Object.keys(me).length===0)try{const De=await Jt.getTeacherWeeklySchedule(t);De!=null&&De.weeklySchedule&&(me=De.weeklySchedule)}catch(De){console.log("Weekly schedule API also failed:",De)}const je=I.map(De=>{const be=me[De]||[],Te=be.reduce((Be,V)=>Be+(V.duration||45),0);return{day:De,lessons:be,timeBlocks:[],totalDuration:Te,lessonCount:be.length}}).filter(De=>De.lessons.length>0);c(je),N(new Date),console.log(`Successfully loaded schedule for teacher ${t}: ${je.length} days with lessons`);const Oe=je.flatMap(De=>De.lessons);Oe.length>0&&(console.log("Loading attendance data for schedule lessons..."),await Z(Oe))}catch(G){console.error("Error fetching teacher schedule:",G),m(G.message||"שגיאה בטעינת לוח הזמנים")}finally{f(!1)}},[t,k,Z]);x.useEffect(()=>{if(R!=null&&R.timeBlocks&&l.length>0){const G=l.map(re=>{const pe=R.timeBlocks.filter(me=>me.day===re.day&&me.isActive);return{...re,timeBlocks:pe}});c(G)}},[R]),x.useEffect(()=>{ee()},[ee]);const W=G=>({Sunday:"ראשון",Monday:"שני",Tuesday:"שלישי",Wednesday:"רביעי",Thursday:"חמישי",Friday:"שישי",Saturday:"שבת",sun:"ראשון",mon:"שני",tue:"שלישי",wed:"רביעי",thu:"חמישי",fri:"שישי",sat:"שבת",0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"})[G]||G,K=(G,re)=>{if(!G)return"";const[pe,me]=G.split(":").map(Number),je=pe*60+me+re,Oe=Math.floor(je/60),De=je%60;return`${Oe.toString().padStart(2,"0")}:${De.toString().padStart(2,"0")}`},Q=G=>{const re=Math.floor(G/60),pe=G%60;return re===0?`${pe}ד'`:pe===0?`${re}ש'`:`${re}ש' ${pe}ד'`},ne=()=>{const G=l.reduce((me,je)=>me+je.lessonCount,0),re=l.reduce((me,je)=>me+je.totalDuration,0),pe=new Set;return l.forEach(me=>{me.lessons.forEach(je=>{je.studentId&&pe.add(je.studentId)})}),{totalLessons:G,totalDuration:Q(re),totalStudents:pe.size,activeDays:l.length}},X=G=>{v(re=>G==="next"?re+1:re-1)},se=G=>{var re;return G&&((re=b[G])==null?void 0:re.status)||null},O=G=>{switch(G){case"הגיע/ה":return e.jsx(Et,{size:16,className:"attendance-icon present"});case"לא הגיע/ה":return e.jsx(Ro,{size:16,className:"attendance-icon absent"});case"cancelled":return e.jsx(Sd,{size:16,className:"attendance-icon cancelled"});case"pending":return e.jsx(Sd,{size:16,className:"attendance-icon pending"});default:return e.jsx(Sd,{size:16,className:"attendance-icon not-marked"})}},B=G=>{switch(G){case"הגיע/ה":return"הגיע/ה";case"לא הגיע/ה":return"לא הגיע/ה";case"cancelled":return"בוטל";case"pending":return"ממתין";default:return""}},L=G=>{switch(G){case"הגיע/ה":return"present";case"לא הגיע/ה":return"absent";case"cancelled":return"cancelled";case"pending":return"pending";default:return"not-marked"}},Y=x.useCallback(async(G,re,pe,me)=>{var je,Oe,De,be;if(!G||!re){console.error("Invalid parameters for marking attendance:",{scheduleSlotId:G,status:re}),_("פרמטרים לא תקינים לסימון נוכחות");return}T(Te=>new Set(Te).add(G)),_(null),S(null);try{console.log(`Marking attendance for lesson ${G} as ${re} for week offset ${g}`);const Te=me?z(me):Za.formatForAPI(new Date);console.log(`Using lesson date: ${Te} for day: ${me}`);const Be={status:re,notes:pe||"",lessonDate:Te},V=await dl.markAttendance(G,{status:re,notes:pe||""});w(ve=>({...ve,[G]:{status:re,notes:pe||""}})),console.log(`Successfully marked attendance for lesson ${G}`);const ue=B(re);S(`נוכחות סומנה כמו: ${ue}`),setTimeout(()=>{S(null)},3e3)}catch(Te){console.error(`Failed to mark attendance for lesson ${G}:`,Te),(je=Te.message)!=null&&je.includes("not found")||(Oe=Te.message)!=null&&Oe.includes("לא נמצא")?_("שיעור זה עדיין לא קיים במערכת הנוכחות. יתכן שזה שיעור עתידי או שהוא טרם הוגדר למעקב נוכחות."):(De=Te.message)!=null&&De.includes("markedAt")||(be=Te.message)!=null&&be.includes("not allowed")?_("נתונים לא תקינים נשלחו לשרת"):_(`שגיאה בסימון נוכחות: ${Te.message||"שגיאה לא ידועה"}`)}finally{T(Te=>{const Be=new Set(Te);return Be.delete(G),Be})}},[t,z]),H=x.useCallback((G,re)=>Y(G,"הגיע/ה",void 0,re),[Y]),P=x.useCallback((G,re)=>Y(G,"לא הגיע/ה",void 0,re),[Y]);x.useCallback((G,re,pe)=>Y(G,"cancelled",re,pe),[Y]);const q=x.useCallback(G=>{w(re=>{const pe={...re};return delete pe[G],pe})},[]),F=x.useCallback(async(G,re)=>{const pe=G.lessons.filter(je=>je.scheduleSlotId);if(pe.length===0){console.log(`No lessons with valid schedule slot ID found for ${G.day}`);return}console.log(`Bulk marking ${pe.length} lessons for ${G.day} as ${re}`);const me=pe.map(je=>Y(je.scheduleSlotId,re,void 0,G.day));try{await Promise.allSettled(me),console.log(`Completed bulk marking for ${G.day}`)}catch(je){console.error(`Error in bulk marking for ${G.day}:`,je)}},[Y]),te=x.useCallback(G=>{const re=G.lessons.filter(Oe=>{const De=se(Oe.scheduleSlotId);return De&&De!=="pending"}),pe=G.lessons.filter(Oe=>se(Oe.scheduleSlotId)==="הגיע/ה").length,me=G.lessons.filter(Oe=>se(Oe.scheduleSlotId)==="לא הגיע/ה").length,je=G.lessons.filter(Oe=>se(Oe.scheduleSlotId)==="cancelled").length;return{total:G.lessons.length,marked:re.length,present:pe,absent:me,cancelled:je,unmarked:G.lessons.length-re.length}},[se]);if(u||E)return e.jsxs("div",{className:"teacher-schedule-loading",children:[e.jsx(Yt,{className:"loading-icon",size:20}),e.jsx("span",{children:"טוען מערכת השעות השבועית..."})]});if(p)return e.jsxs("div",{className:"teacher-schedule-error",children:[e.jsx("div",{className:"error-message",children:p}),e.jsxs("button",{className:"retry-button",onClick:ee,"aria-label":"נסה שוב",children:[e.jsx(Yt,{size:16}),"נסה שוב"]})]});if(l.length===0)return e.jsx("div",{className:"teacher-schedule-empty",children:e.jsxs("div",{className:"empty-message",children:[e.jsx($e,{size:32}),e.jsx("h4",{children:"אין שיעורים מתוכננים השבוע"}),e.jsxs("p",{children:["למורה ",s," אין שיעורים מוקצים כרגע"]}),e.jsxs("button",{className:"refresh-empty-btn",onClick:ee,"aria-label":"רענן נתונים",children:[e.jsx(Yt,{size:16}),"רענן נתונים"]})]})});const ae=ne();return i?e.jsxs("div",{className:"teacher-schedule-compact",children:[e.jsxs("div",{className:"schedule-header-compact",children:[e.jsxs("div",{className:"schedule-title",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת השעות השבועית"})]}),e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("span",{className:"stat",children:[ae.totalLessons," שיעורים"]}),e.jsxs("span",{className:"stat",children:[ae.totalStudents," תלמידים"]}),n&&e.jsx("button",{className:"full-screen-btn",onClick:n,title:"תצוגה מלאה",children:e.jsx(vm,{size:14})})]})]}),e.jsx("div",{className:"days-grid-compact",children:l.slice(0,4).map(G=>e.jsxs("div",{className:"day-compact",children:[e.jsxs("div",{className:"day-header-compact",children:[e.jsx("span",{className:"day-name",children:G.day}),e.jsxs("span",{className:"lesson-count",children:["(",G.lessonCount,")"]})]}),e.jsxs("div",{className:"lessons-preview",children:[G.lessons.slice(0,2).map((re,pe)=>{const me=se(re.scheduleSlotId);return re.scheduleSlotId&&C.has(re.scheduleSlotId),e.jsxs("div",{className:`lesson-compact ${me?`attendance-${L(me)}`:""}`,children:[e.jsxs("div",{className:"lesson-time-compact",children:[re.time," - ",re.endTime,me&&e.jsx("span",{className:`attendance-indicator-compact ${L(me)}`,children:O(me)})]}),e.jsx("div",{className:"lesson-student-compact",children:re.studentName})]},re._id||pe)}),G.lessonCount>2&&e.jsxs("div",{className:"more-lessons-compact",children:["+",G.lessonCount-2]})]})]},G.day))}),l.length>4&&e.jsxs("div",{className:"more-days-indicator",children:["+",l.length-4," ימים נוספים"]})]}):e.jsxs("div",{className:"teacher-schedule-calendar",children:[e.jsxs("div",{className:"schedule-header",children:[e.jsxs("div",{className:"schedule-navigation",children:[e.jsx("button",{className:"nav-btn",onClick:()=>X("prev"),"aria-label":"שבוע קודם",children:e.jsx(Xm,{size:16})}),e.jsxs("div",{className:"current-week",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת השעות השבועית"}),e.jsxs("div",{className:"week-date-range",children:[(oe=M[0])==null?void 0:oe.displayDate," - ",(ce=M[M.length-1])==null?void 0:ce.displayDate]}),g!==0&&e.jsxs("span",{className:"week-offset",children:["(",g>0?"+":"",g," שבועות)"]})]}),e.jsx("button",{className:"nav-btn",onClick:()=>X("next"),"aria-label":"שבוע הבא",children:e.jsx(x0,{size:16})})]}),e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:ae.totalDuration})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(We,{size:14}),e.jsxs("span",{children:[ae.totalStudents," תלמידים"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:[ae.activeDays," ימים"]})]}),n&&e.jsxs("button",{className:"full-screen-btn",onClick:n,title:"תצוגה במסך מלא",children:[e.jsx(ba,{size:16}),e.jsx(vm,{size:12})]})]})]}),A&&e.jsxs("div",{className:"attendance-notification error",children:[e.jsx(Ro,{size:16}),e.jsx("span",{children:A}),e.jsx("button",{className:"close-notification",onClick:()=>_(null),"aria-label":"סגור הודעה",children:"×"})]}),D&&e.jsxs("div",{className:"attendance-notification success",children:[e.jsx(Et,{size:16}),e.jsx("span",{children:D}),e.jsx("button",{className:"close-notification",onClick:()=>S(null),"aria-label":"סגור הודעה",children:"×"})]}),e.jsx("div",{className:"schedule-grid",children:l.map(G=>{var pe;const re=te(G);return e.jsxs("div",{className:"day-schedule",children:[e.jsxs("div",{className:"day-header",children:[e.jsxs("div",{className:"day-info",children:[e.jsxs("div",{className:"day-title",children:[e.jsx("h4",{className:"day-name",children:G.day}),e.jsx("span",{className:"day-date",children:(pe=M.find(me=>me.day===G.day))==null?void 0:pe.displayDate})]}),e.jsxs("div",{className:"day-stats",children:[e.jsxs("span",{className:"lessons-count",children:[G.lessonCount," שיעורים • ",Q(G.totalDuration)]}),re.marked>0&&e.jsxs("span",{className:"attendance-stats",children:["נוכחות: ",re.marked,"/",re.total,re.present>0&&e.jsxs("span",{className:"present-count",children:[" הגיעו: ",re.present]}),re.absent>0&&e.jsxs("span",{className:"absent-count",children:[" חסרו: ",re.absent]})]})]})]}),e.jsxs("div",{className:"day-controls",children:[G.timeBlocks.length>0&&e.jsxs("div",{className:"time-blocks-indicator",children:[e.jsx(vt,{size:12}),e.jsxs("span",{children:[G.timeBlocks.length," בלוקים"]})]}),!i&&re.unmarked>0&&e.jsxs("div",{className:"bulk-attendance-controls",children:[e.jsxs("button",{className:"bulk-btn bulk-present",onClick:()=>F(G,"הגיע/ה"),title:"סמן הכל כהגיעו",children:[e.jsx(Et,{size:12}),"הכל"]}),e.jsxs("button",{className:"bulk-btn bulk-absent",onClick:()=>F(G,"לא הגיע/ה"),title:"סמן הכל כחסרו",children:[e.jsx(Ro,{size:12}),"הכל"]})]})]})]}),e.jsxs("div",{className:"day-content",children:[G.timeBlocks.length>0&&e.jsx("div",{className:"time-blocks-background",children:G.timeBlocks.map(me=>e.jsxs("div",{className:"time-block-bg",title:`${me.startTime} - ${me.endTime}${me.location?` • ${me.location}`:""}`,children:[e.jsxs("div",{className:"block-time-range",children:[me.startTime," - ",me.endTime]}),me.location&&e.jsxs("div",{className:"block-location",children:[e.jsx(vt,{size:10}),me.location]}),e.jsx("div",{className:"utilization-bar",children:e.jsx("div",{className:"utilization-fill",style:{width:`${me.utilizationPercentage}%`}})})]},me._id))}),e.jsx("div",{className:"lessons-list",children:G.lessons.map((me,je)=>{const Oe=se(me.scheduleSlotId),De=me.scheduleSlotId?C.has(me.scheduleSlotId):!1;return e.jsxs("div",{className:`lesson-item ${Oe?`attendance-${L(Oe)}`:""}`,children:[e.jsxs("div",{className:"lesson-details",children:[e.jsx("div",{className:"lesson-student",children:e.jsx("span",{children:me.studentName})}),me.instrument&&e.jsx("div",{className:"lesson-instrument",children:e.jsx("span",{children:me.instrument||"כלי נגינה"})})]}),e.jsxs("div",{className:"lesson-header",children:[e.jsxs("div",{className:"lesson-time",children:[e.jsxs("span",{className:"main-time",children:[me.time," - ",me.endTime]}),e.jsxs("span",{className:"duration",children:["(",me.duration,"ד')"]})]}),me.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(vt,{size:10}),e.jsx("span",{children:me.location})]})]}),me.scheduleSlotId&&e.jsx("div",{className:"lesson-attendance",children:!i&&e.jsxs("div",{className:"attendance-controls",children:[e.jsxs("div",{className:"attendance-toggle-wrapper",children:[e.jsxs("label",{className:"attendance-toggle-labels",children:[e.jsx("span",{className:"absent-label",children:"לא נוכח"}),e.jsx("span",{className:"present-label",children:"נוכח"})]}),e.jsxs("label",{className:`attendance-toggle-switch ${Oe&&Oe!=="not-marked"&&Oe!=="pending"?"has-attendance":""}`,children:[e.jsx("input",{type:"checkbox",checked:Oe==="הגיע/ה",onChange:be=>{De||(be.target.checked?H(me.scheduleSlotId,G.day):P(me.scheduleSlotId,G.day))},disabled:De}),e.jsx("span",{className:"attendance-toggle-slider",children:De&&e.jsx(Yt,{size:12,className:"toggle-loading"})})]})]}),Oe&&e.jsxs("button",{className:"attendance-clear-btn",onClick:()=>q(me.scheduleSlotId),disabled:De,title:"מחק סימון נוכחות",children:[e.jsx(Sd,{size:12}),e.jsx("span",{children:"מחק"})]})]})})]},me._id||je)})})]})]},G.day)})}),j&&e.jsxs("div",{className:"schedule-footer",children:[e.jsxs("div",{className:"last-updated",children:["עודכן לאחרונה: ",j.toLocaleTimeString("he-IL")]}),e.jsxs("button",{className:"refresh-btn",onClick:ee,"aria-label":"רענן נתונים",children:[e.jsx(Yt,{size:14}),"רענן"]})]})]})},WR=({isOpen:t,onClose:s,teacherId:n,teacherName:i})=>t?e.jsxs(Ta,{isOpen:t,onClose:s,className:"full-screen-schedule-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"header-info",children:[e.jsx($e,{size:24}),e.jsxs("h2",{children:["מערכת השעות המלאה - ",i]})]}),e.jsx("button",{className:"close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(yt,{size:24})})]}),e.jsx("div",{className:"modal-body",children:e.jsx(dN,{teacherId:n,teacherName:i,compact:!1})})]}):null;function KR(){var V,ue,ve,Ne,_e,Ie,Ue,$t,qe,mt,Rt,Pt,xt,xi,Ea;const{user:t}=vs(),[s,n]=y0(),i=Ot(),l=cl(),[c,u]=x.useState(null),[f,p]=x.useState(!0),[m,g]=x.useState(null),[v,j]=x.useState(!1),[N,b]=x.useState(null),[w,C]=x.useState(!1),[T,A]=x.useState([]),[_,D]=x.useState([]),[S,R]=x.useState(!1),[E,k]=x.useState(!1),[I,M]=x.useState({students:!1,orchestras:!1,schedule:!1}),[z,Z]=x.useState(!1),ee=ke=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545","מורה תאוריה":"#6F42C1"})[ke]||"#6c757d",W=()=>{if(t){const ke={_id:t._id,personalInfo:{fullName:t.fullName||"",email:t.email||"",phone:t.phone||"",address:t.address||""},roles:t.roles||[],professionalInfo:t.professionalInfo?{instrument:t.professionalInfo.instrument||"",isActive:!0}:void 0,credentials:{email:t.email||""}};u(ke),b(ke)}},K=ke=>{var ze,Gt,At,dt;if(t){const os={...t,fullName:((ze=ke.personalInfo)==null?void 0:ze.fullName)||t.fullName,email:((Gt=ke.personalInfo)==null?void 0:Gt.email)||t.email,phone:((At=ke.personalInfo)==null?void 0:At.phone)||t.phone,address:((dt=ke.personalInfo)==null?void 0:dt.address)||t.address,professionalInfo:ke.professionalInfo||t.professionalInfo};localStorage.setItem("user",JSON.stringify(os)),l.user=os}},[Q,ne]=x.useState(!1),[X,se]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[O,B]=x.useState({current:!1,new:!1,confirm:!1}),[L,Y]=x.useState(!1),[H,P]=x.useState(null),[q,F]=x.useState(null),te=s.get("forcePasswordChange")==="true"||localStorage.getItem("requiresPasswordChange")==="true";x.useEffect(()=>{t&&(W(),G())},[t]),x.useEffect(()=>{t&&(async()=>{const ze=s.get("forcePasswordChange")==="true",Gt=localStorage.getItem("requiresPasswordChange")==="true";if(ze||Gt)try{await Fs.validateSession()}catch(At){console.error("Auth validation failed:",At),i("/login")}})()},[t,s,i]),x.useEffect(()=>{c&&ae()&&re()},[c]),x.useEffect(()=>{s.get("openSchedule")==="true"&&c&&(ae()||oe())&&(Z(!0),s.delete("openSchedule"),n(s,{replace:!0}))},[c,s,n]);const ae=()=>{var ke;return((ke=c==null?void 0:c.roles)==null?void 0:ke.some(ze=>ze==="מורה"||ze==="מורה תאוריה"||ze==="מנצח"))||!1},oe=()=>{var ke;return((ke=c==null?void 0:c.roles)==null?void 0:ke.includes("מנצח"))||!1},ce=ke=>{M(ze=>({...ze,[ke]:!ze[ke]}))},G=async()=>{var ke,ze,Gt,At;if(t)try{p(!0);const dt=await ge.get(`teachers/${t._id}`),os={_id:dt._id||t._id,personalInfo:{fullName:((ke=dt.personalInfo)==null?void 0:ke.fullName)||t.fullName||"",email:((ze=dt.personalInfo)==null?void 0:ze.email)||t.email||"",phone:((Gt=dt.personalInfo)==null?void 0:Gt.phone)||t.phone||"",address:((At=dt.personalInfo)==null?void 0:At.address)||t.address||""},roles:dt.roles||t.roles||[],professionalInfo:dt.professionalInfo||(t.professionalInfo?{instrument:t.professionalInfo.instrument||"",isActive:!0}:void 0),credentials:dt.credentials||{email:t.email||""},createdAt:dt.createdAt,updatedAt:dt.updatedAt};u(os),b(os)}catch(dt){const os=ts(dt);g(os.userMessage),console.log("API failed, using user store data")}finally{p(!1)}},re=async()=>{var ke;if(t!=null&&t._id)try{if(ae()){R(!0);try{const Gt=(await ot.getStudents()).filter(At=>{const dt=At.teacherIds&&At.teacherIds.includes(t._id),os=At.teacherAssignments&&At.teacherAssignments.some(ra=>ra.teacherId===t._id);return dt||os});A(Gt)}catch(ze){console.error("Failed to load students:",ze)}finally{R(!1)}}if(oe()&&((ke=c==null?void 0:c.conducting)!=null&&ke.orchestraIds)){k(!0);try{const ze=await Ra.getOrchestrasByIds(c.conducting.orchestraIds);D(ze)}catch(ze){console.error("Failed to load orchestras:",ze)}finally{k(!1)}}}catch(ze){console.error("Failed to load teacher data:",ze)}},pe=()=>{j(!0),b(c),g(null)},me=()=>{j(!1),b(c),g(null)},je=async()=>{if(!(!N||!c))try{C(!0);const ke={personalInfo:N.personalInfo,roles:N.roles,professionalInfo:N.professionalInfo,teaching:c.teaching||{studentIds:[],schedule:[]},credentials:{email:N.personalInfo.email}};console.log("Sending update data:",ke);const ze=await ge.put("teachers/profile/me",ke);u(ze.data),K(ze.data),j(!1),g(null)}catch(ke){const ze=ts(ke);g(ze.userMessage)}finally{C(!1)}},Oe=async ke=>{if(confirm("האם אתה בטוח שברצונך להסיר את התלמיד מהרשימה שלך?"))try{await ge.put("teachers/profile/me/remove-student",{studentId:ke}),await re()}catch(ze){const Gt=ts(ze);g(Gt.userMessage)}},De=(ke,ze,Gt)=>{N&&b(At=>{if(!At)return At;const dt=At[ke];return typeof dt=="object"&&dt!==null?{...At,[ke]:{...dt,[ze]:Gt}}:At})},be=async ke=>{if(ke.preventDefault(),P(null),F(null),!X.currentPassword||!X.newPassword||!X.confirmPassword){P("יש למלא את כל השדות");return}if(X.newPassword!==X.confirmPassword){P("הסיסמאות החדשות אינן תואמות");return}if(X.newPassword.length<6){P("הסיסמה החדשה חייבת להכיל לפחות 6 תווים");return}if(X.currentPassword===X.newPassword){P("הסיסמה החדשה חייבת להיות שונה מהסיסמה הנוכחית");return}try{Y(!0);const ze=await np.changePassword({currentPassword:X.currentPassword,newPassword:X.newPassword});ze.accessToken&&(Fs.setToken(ze.accessToken),console.log("Updated access token after password change")),ze.refreshToken&&(localStorage.setItem("refreshToken",ze.refreshToken),console.log("Updated refresh token after password change")),F("הסיסמה שונתה בהצלחה!"),se({currentPassword:"",newPassword:"",confirmPassword:""}),ne(!1),localStorage.removeItem("requiresPasswordChange"),s.get("forcePasswordChange")&&(s.delete("forcePasswordChange"),n(s)),setTimeout(()=>{F(null)},3e3)}catch(ze){const Gt=ts(ze);P(Gt.userMessage)}finally{Y(!1)}},Te=ke=>{B(ze=>({...ze,[ke]:!ze[ke]}))},Be=async()=>{try{const ke=localStorage.getItem("requiresPasswordChange"),ze=s.get("forcePasswordChange")==="true";(ke==="true"||ze)&&(localStorage.removeItem("requiresPasswordChange"),ze&&(s.delete("forcePasswordChange"),n(s)),await Fs.validateSession()),i("/")}catch(ke){console.error("Navigation error:",ke),i("/login")}};return f?e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"טוען פרופיל..."})]})}):!c&&!f?e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"error-container",children:[e.jsx("p",{children:"שגיאה בטעינת הפרופיל"}),e.jsx("button",{onClick:G,className:"retry-btn",children:"נסה שוב"})]})}):c?e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("button",{onClick:Be,className:"close-btn","aria-label":"חזרה לעמוד הקודם",children:e.jsx(Bs,{size:18})}),e.jsx("div",{className:"header-content",children:((V=c==null?void 0:c.personalInfo)==null?void 0:V.fullName)&&e.jsx("h1",{className:"user-name",children:c.personalInfo.fullName})}),e.jsx("div",{className:"header-actions",children:v?e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{onClick:je,disabled:w,className:"btn btn-primary",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sc,{size:20}),"שמירה"]})}),e.jsxs("button",{onClick:me,disabled:w,className:"btn btn-secondary",children:[e.jsx(yt,{size:20}),"ביטול"]})]}):e.jsxs("button",{onClick:pe,className:"btn btn-primary",children:[e.jsx(Fo,{size:20}),"עריכה"]})})]}),m&&e.jsx("div",{className:"error-message",children:m}),q&&e.jsx("div",{className:"success-message",children:q}),e.jsxs("div",{className:"profile-content",children:[e.jsxs("div",{className:"main-section",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(We,{size:20}),e.jsx("h2",{children:"פרטים אישיים"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"fullName",children:[e.jsx(We,{size:16}),"שם מלא"]}),e.jsx("input",{type:"text",id:"fullName",value:v?((ue=N==null?void 0:N.personalInfo)==null?void 0:ue.fullName)||"":((ve=c==null?void 0:c.personalInfo)==null?void 0:ve.fullName)||"",onChange:ke=>De("personalInfo","fullName",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן שם מלא"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:[e.jsx(On,{size:16}),"כתובת אימייל"]}),e.jsx("input",{type:"email",id:"email",value:v?((Ne=N==null?void 0:N.personalInfo)==null?void 0:Ne.email)||"":((_e=c==null?void 0:c.personalInfo)==null?void 0:_e.email)||"",onChange:ke=>De("personalInfo","email",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כתובת אימייל"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"phone",children:[e.jsx(fi,{size:16}),"טלפון"]}),e.jsx("input",{type:"tel",id:"phone",value:v?((Ie=N==null?void 0:N.personalInfo)==null?void 0:Ie.phone)||"":((Ue=c==null?void 0:c.personalInfo)==null?void 0:Ue.phone)||"",onChange:ke=>De("personalInfo","phone",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן מספר טלפון"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"address",children:[e.jsx(vt,{size:16}),"כתובת"]}),e.jsx("input",{type:"text",id:"address",value:v?(($t=N==null?void 0:N.personalInfo)==null?void 0:$t.address)||"":((qe=c==null?void 0:c.personalInfo)==null?void 0:qe.address)||"",onChange:ke=>De("personalInfo","address",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כתובת"})]})]})})]}),c.professionalInfo&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(Je,{size:20}),e.jsx("h2",{children:"מידע מקצועי"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"instrument",children:[e.jsx(Je,{size:16}),"כלי נגינה"]}),e.jsx("input",{type:"text",id:"instrument",value:v?((mt=N==null?void 0:N.professionalInfo)==null?void 0:mt.instrument)||"":((Rt=c==null?void 0:c.professionalInfo)==null?void 0:Rt.instrument)||"",onChange:ke=>De("professionalInfo","instrument",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כלי נגינה"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"סטטוס פעילות"}),e.jsx("div",{className:"status-badge",children:c.professionalInfo.isActive?"פעיל":"לא פעיל"})]})]})})]}),ae()&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${I.students?"active":""}`,onClick:()=>ce("students"),children:[e.jsx(ps,{size:20}),e.jsxs("h2",{children:["התלמידים שלי (",T.length,")"]}),I.students?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),I.students&&e.jsx("div",{className:"card-body",children:S?e.jsxs("div",{className:"loading-section",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"טוען תלמידים..."})]}):T.length>0?e.jsx("div",{className:"students-grid-enhanced",children:T.map(ke=>{var Gt,At,dt,os,ra;const ze=(Gt=ke.teacherAssignments)==null?void 0:Gt.find(sn=>sn.teacherId===(t==null?void 0:t._id)&&sn.isActive!==!1);return e.jsxs("div",{className:"student-card-enhanced",children:[e.jsxs("div",{className:"student-main-info",children:[e.jsx("div",{className:"student-avatar",children:((dt=(At=ke.personalInfo)==null?void 0:At.fullName)==null?void 0:dt.charAt(0))||"ת"}),e.jsxs("div",{className:"student-details",children:[e.jsx("h4",{className:"student-name",children:((os=ke.personalInfo)==null?void 0:os.fullName)||"תלמיד לא ידוע"}),e.jsxs("div",{className:"student-lesson-info",children:[ze&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"lesson-time",children:[ze.time," - ",(()=>{const[sn,Cr]=ze.time.split(":").map(Number),uc=sn*60+Cr+(ze.duration||45),hc=Math.floor(uc/60),fc=uc%60;return`${hc.toString().padStart(2,"0")}:${fc.toString().padStart(2,"0")}`})()]}),e.jsxs("span",{className:"lesson-duration",children:["(",ze.duration||45,"ד')"]}),e.jsx("span",{className:"day-info",children:ze.day})]}),((ra=ke.academicInfo)==null?void 0:ra.instrument)&&e.jsx("span",{className:"instrument-info",children:ke.academicInfo.instrument||"כלי נגינה"})]})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>window.open(`/students/${ke._id}`,"_blank"),title:"ערוך תלמיד",children:e.jsx(Fo,{size:12})}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>Oe(ke._id),title:"הסר מהרשימה",children:e.jsx(yt,{size:12})})]})]},ke._id)})}):e.jsxs("div",{className:"no-data",children:[e.jsx(ps,{size:32}),e.jsx("p",{children:"אין תלמידים מוקצים"})]})})]}),oe()&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${I.orchestras?"active":""}`,onClick:()=>ce("orchestras"),children:[e.jsx(Je,{size:20}),e.jsxs("h2",{children:["התזמורות שלי (",_.length,")"]}),I.orchestras?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),I.orchestras&&e.jsx("div",{className:"card-body",children:E?e.jsxs("div",{className:"loading-section",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"טוען תזמורות..."})]}):_.length>0?e.jsx("div",{className:"orchestras-grid",children:_.map(ke=>e.jsx("div",{className:"orchestra-card",children:e.jsxs("div",{className:"orchestra-info",children:[e.jsx("div",{className:"orchestra-name",children:ke.name}),ke.location&&e.jsxs("div",{className:"orchestra-location",children:[e.jsx(vt,{size:12}),ke.location]})]})},ke._id))}):e.jsxs("div",{className:"no-data",children:[e.jsx(Je,{size:32}),e.jsx("p",{children:"אין תזמורות מוקצות"})]})})]}),(ae()||oe())&&c&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${I.schedule?"active":""}`,onClick:()=>ce("schedule"),children:[e.jsx($e,{size:20}),e.jsx("h2",{children:"מערכת השעות השבועית"}),I.schedule?e.jsx(Ft,{size:18,className:"toggle-icon"}):e.jsx(gt,{size:18,className:"toggle-icon"})]}),I.schedule&&e.jsx("div",{className:"card-body",children:e.jsx(dN,{teacherId:(t==null?void 0:t._id)||"",teacherName:((Pt=c==null?void 0:c.personalInfo)==null?void 0:Pt.fullName)||"מורה",compact:!0,onFullScreenView:()=>Z(!0)})})]})]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(j0,{size:20}),e.jsx("h2",{children:"מידע חשבון"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid single-column",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תפקידים"}),e.jsx("div",{className:"roles-container",children:((xt=c.roles)==null?void 0:xt.map((ke,ze)=>e.jsx("span",{className:"role-badge",style:{backgroundColor:ee(ke)},children:ke},ze)))||e.jsx("span",{className:"role-badge",children:"לא זמין"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16}),"התחברות אחרונה"]}),e.jsx("input",{type:"text",value:(xi=c.credentials)!=null&&xi.lastLogin?new Date(c.credentials.lastLogin).toLocaleDateString("he-IL"):"לא זמין",disabled:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16}),"תאריך יצירה"]}),e.jsx("input",{type:"text",value:c.createdAt?new Date(c.createdAt).toLocaleDateString("he-IL"):"לא זמין",disabled:!0,className:"form-input"})]})]})})]}),te&&e.jsx("div",{className:"card",style:{borderColor:"#ff6b6b",backgroundColor:"#fff5f5"},children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#d63031"},children:[e.jsx(mr,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:"#d63031"},children:"שינוי סיסמה נדרש"}),e.jsx("p",{style:{margin:"8px 0 0 0",color:"#636e72"},children:"עליך לשנות את הסיסמה שלך לפני שתוכל להמשיך להשתמש במערכת"})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(mr,{size:24}),e.jsx("h2",{children:"שינוי סיסמה"}),e.jsx("button",{onClick:()=>ne(!Q),className:"btn btn-outline",style:te?{display:"none"}:{},children:Q?"ביטול":"שינוי סיסמה"})]}),(Q||te)&&e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:be,children:[H&&e.jsx("div",{className:"error-message",children:H}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentPassword",children:"סיסמה נוכחית"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.current?"text":"password",id:"currentPassword",value:X.currentPassword,onChange:ke=>se(ze=>({...ze,currentPassword:ke.target.value})),className:"form-input",required:!0}),e.jsx("button",{type:"button",onClick:()=>Te("current"),className:"password-toggle",children:O.current?e.jsx(ni,{size:20}):e.jsx(ba,{size:20})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"סיסמה חדשה"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.new?"text":"password",id:"newPassword",value:X.newPassword,onChange:ke=>se(ze=>({...ze,newPassword:ke.target.value})),className:"form-input",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>Te("new"),className:"password-toggle",children:O.new?e.jsx(ni,{size:20}):e.jsx(ba,{size:20})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"אישור סיסמה חדשה"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.confirm?"text":"password",id:"confirmPassword",value:X.confirmPassword,onChange:ke=>se(ze=>({...ze,confirmPassword:ke.target.value})),className:"form-input",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>Te("confirm"),className:"password-toggle",children:O.confirm?e.jsx(ni,{size:20}):e.jsx(ba,{size:20})})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",disabled:L,className:"btn btn-primary",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"משנה סיסמה..."]}):e.jsxs(e.Fragment,{children:[e.jsx(mr,{size:20}),"שינוי סיסמה"]})})})]})})]})]})]}),(ae()||oe())&&c&&e.jsx(WR,{isOpen:z,onClose:()=>Z(!1),teacherId:(t==null?void 0:t._id)||"",teacherName:((Ea=c==null?void 0:c.personalInfo)==null?void 0:Ea.fullName)||"Teacher"})]}):e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"טוען פרופיל..."})]})})}function JR(){const{token:t}=Nr(),s=Ot(),[n,i]=x.useState(""),[l,c]=x.useState(""),[u,f]=x.useState(!1),[p,m]=x.useState(!1),[g,v]=x.useState(!1),[j,N]=x.useState(null),[b,w]=x.useState(!1);x.useEffect(()=>{t||s("/login")},[t,s]);const C=async _=>{if(_.preventDefault(),N(null),!n||!l){N("יש למלא את כל השדות");return}if(n!==l){N("הסיסמאות אינן תואמות");return}if(n.length<6){N("הסיסמה חייבת להכיל לפחות 6 תווים");return}if(!t){N("טוקן לא תקין");return}try{v(!0),await np.resetPassword({token:t,newPassword:n}),w(!0),setTimeout(()=>{s("/login")},3e3)}catch(D){const S=ts(D);N(S.userMessage)}finally{v(!1)}},T=()=>{f(!u)},A=()=>{m(!p)};return b?e.jsx("div",{className:"reset-password-page",children:e.jsx("div",{className:"reset-password-form",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:e.jsx(Bo,{size:48})}),e.jsx("h1",{children:"הסיסמה שונתה בהצלחה!"}),e.jsx("p",{children:"הסיסמה שלך עודכנה בהצלחה. אתה מועבר לדף ההתחברות..."}),e.jsx("div",{className:"spinner"})]})})}):e.jsx("div",{className:"reset-password-page",children:e.jsxs("div",{className:"reset-password-form",children:[e.jsx("h1",{children:"איפוס סיסמה"}),e.jsx("p",{className:"reset-description",children:"הזן את הסיסמה החדשה שלך"}),j&&e.jsx("div",{className:"error-message",children:j}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:u?"text":"password",id:"password",className:n?"has-value":"",placeholder:"",required:!0,value:n,onChange:_=>i(_.target.value),minLength:6}),e.jsx("label",{htmlFor:"password",children:"סיסמה חדשה"}),e.jsx(mr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:T,children:u?e.jsx(ni,{size:20}):e.jsx(ba,{size:20})})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:p?"text":"password",id:"confirmPassword",className:l?"has-value":"",placeholder:"",required:!0,value:l,onChange:_=>c(_.target.value),minLength:6}),e.jsx("label",{htmlFor:"confirmPassword",children:"אישור סיסמה"}),e.jsx(mr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:A,children:p?e.jsx(ni,{size:20}):e.jsx(ba,{size:20})})]}),e.jsx("button",{type:"submit",className:"btn",disabled:g,children:g?"מאפס סיסמה...":"איפוס סיסמה"})]}),e.jsx("div",{className:"back-to-login",children:e.jsx("button",{type:"button",onClick:()=>s("/login"),className:"back-link",children:"חזרה להתחברות"})})]})})}function eM(){var j;const[t,s]=x.useState(!1),[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(null),p="688136c194c6cd56db965db9",m=async(N,b)=>{const w=await fetch(`/api/${N}`,{headers:{"Content-Type":"application/json",...b==null?void 0:b.headers},...b});if(!w.ok)throw new Error(`API call failed: ${w.status} ${w.statusText}`);return w.json()},g=async()=>{var N,b,w;s(!0),c(null),f(null);try{console.log("🔍 Starting investigation..."),console.log("📖 Loading teacher...");const C=await m(`teacher/${p}`);console.log("Teacher loaded:",(N=C.personalInfo)==null?void 0:N.fullName),console.log("👥 Loading all students...");const T=await m("student");console.log(`Total students in database: ${T.length}`);const A=T.filter(R=>{const E=R.teacherIds&&R.teacherIds.includes(p),k=R.teacherAssignments&&R.teacherAssignments.some(I=>I.teacherId===p);return E||k});console.log(`✅ Found ${A.length} students with this teacher`);const _=((b=C.teaching)==null?void 0:b.studentIds)||[],D=((w=C.teaching)==null?void 0:w.schedule)||[],S={teacher:C,allStudents:T.length,studentsWithTeacher:A,currentStudentIds:_,scheduleEntries:D,needsFix:JSON.stringify(_.sort())!==JSON.stringify(A.map(R=>R._id).sort())};c(S),console.log("Investigation complete:",S)}catch(C){console.error("❌ Investigation failed:",C),c({error:C instanceof Error?C.message:"Unknown error"})}finally{s(!1)}},v=async()=>{var N,b,w,C,T,A,_;if(!(!l||!l.needsFix)){i(!0);try{const{teacher:D,studentsWithTeacher:S}=l,R=S.map(M=>M._id);console.log("🔧 Executing fix..."),console.log("Current studentIds:",((N=D.teaching)==null?void 0:N.studentIds)||[]),console.log("New studentIds:",R);const E={...D.teaching,studentIds:R};(b=D.teaching)!=null&&b.schedule&&(E.schedule=D.teaching.schedule.filter(M=>R.includes(M.studentId)));const k={_id:p,teaching:E};console.log("Update payload:",k);const I=await m(`teacher/${p}`,{method:"PUT",body:JSON.stringify(k)});console.log("✅ Teacher updated successfully!"),f({success:!0,teacherName:((w=D.personalInfo)==null?void 0:w.fullName)||"Unknown",studentsFound:S.length,previousCount:((T=(C=D.teaching)==null?void 0:C.studentIds)==null?void 0:T.length)||0,newCount:R.length,studentDetails:S.map(M=>{var z,Z;return{id:M._id,name:(z=M.personalInfo)==null?void 0:z.fullName,instrument:(Z=M.academicInfo)==null?void 0:Z.instrument}})}),c(null)}catch(D){console.error("❌ Fix failed:",D),f({success:!1,teacherName:((_=(A=l.teacher)==null?void 0:A.personalInfo)==null?void 0:_.fullName)||"Unknown",studentsFound:0,previousCount:0,newCount:0,error:D instanceof Error?D.message:"Unknown error"})}finally{i(!1)}}};return e.jsxs("div",{style:{padding:"2rem",maxWidth:"900px",margin:"0 auto",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#f8f9fa",minHeight:"100vh"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white",padding:"2rem",borderRadius:"12px",marginBottom:"2rem",boxShadow:"0 4px 20px rgba(220, 53, 69, 0.3)"},children:[e.jsxs("h1",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(kT,{size:32}),"Direct Teacher-Student Sync Fix"]}),e.jsxs("p",{style:{margin:0,opacity:.9,fontSize:"1.1rem"},children:[e.jsx("strong",{children:"Issue:"}),` Teacher "מאיה איצקוביץ'" shows 4 students in UI but has empty studentIds in database`]})]}),e.jsxs("div",{style:{background:"#fff3cd",border:"2px solid #ffeaa7",padding:"1.5rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx(yr,{size:24,color:"#856404"}),e.jsx("strong",{style:{color:"#856404",fontSize:"1.2rem"},children:"Data Inconsistency Detected"})]}),e.jsxs("div",{style:{color:"#856404",lineHeight:1.6},children:[e.jsxs("p",{style:{margin:"0 0 0.5rem 0"},children:[e.jsx("strong",{children:"Root Cause:"})," Students have teacher assignments but teacher's studentIds array is empty"]}),e.jsxs("p",{style:{margin:"0 0 0.5rem 0"},children:[e.jsx("strong",{children:"Symptom:"})," TeacherDetails.tsx uses fallback logic to show students from reverse lookup"]}),e.jsxs("p",{style:{margin:0},children:[e.jsx("strong",{children:"Solution:"})," Synchronize teacher's studentIds with actual student assignments"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",flexWrap:"wrap"},children:[e.jsxs("button",{onClick:g,disabled:t,style:{padding:"1rem 2rem",background:t?"#6c757d":"#007bff",color:"white",border:"none",borderRadius:"8px",cursor:t?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.1rem",fontWeight:"600",boxShadow:"0 2px 10px rgba(0, 123, 255, 0.3)",transition:"all 0.3s ease"},children:[t?e.jsx(Yt,{size:20,className:"spin"}):e.jsx(ba,{size:20}),t?"Investigating...":"Investigate Issue"]}),l&&l.needsFix&&e.jsxs("button",{onClick:v,disabled:n,style:{padding:"1rem 2rem",background:n?"#6c757d":"#28a745",color:"white",border:"none",borderRadius:"8px",cursor:n?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.1rem",fontWeight:"600",boxShadow:"0 2px 10px rgba(40, 167, 69, 0.3)",transition:"all 0.3s ease"},children:[n?e.jsx(Yt,{size:20,className:"spin"}):e.jsx(Et,{size:20}),n?"Executing Fix...":"Execute Fix"]})]}),l&&!l.error&&e.jsxs("div",{style:{background:"white",border:"2px solid #dee2e6",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:"0 2px 15px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",color:"#495057",fontSize:"1.5rem"},children:"🔍 Investigation Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Teacher:"}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"1.1rem",color:"#495057"},children:(j=l.teacher.personalInfo)==null?void 0:j.fullName})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Current studentIds:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.3rem",color:"#dc3545"},children:[l.currentStudentIds.length," students"]})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Students found with teacher:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.3rem",color:"#28a745"},children:[l.studentsWithTeacher.length," students"]})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Schedule entries:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.1rem",color:"#495057"},children:[l.scheduleEntries.length," entries"]})]})]}),l.needsFix?e.jsxs("div",{style:{background:"#f8d7da",border:"2px solid #f5c6cb",color:"#721c24",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx("strong",{style:{fontSize:"1.2rem"},children:"⚠️ Fix Required"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0"},children:["studentIds array needs ",l.studentsWithTeacher.length," student IDs but currently has ",l.currentStudentIds.length,"."]})]}):e.jsxs("div",{style:{background:"#d4edda",border:"2px solid #c3e6cb",color:"#155724",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx("strong",{style:{fontSize:"1.2rem"},children:"✅ No Fix Needed"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0"},children:"Data is already synchronized."})]}),l.studentsWithTeacher.length>0&&e.jsxs("div",{children:[e.jsxs("strong",{style:{fontSize:"1.2rem",color:"#495057"},children:["Students with this teacher (",l.studentsWithTeacher.length,"):"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem",marginTop:"1rem"},children:l.studentsWithTeacher.map(N=>{var b,w;return e.jsxs("div",{style:{padding:"1rem",background:"#e9ecef",borderRadius:"8px",border:"1px solid #ced4da"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:(b=N.personalInfo)==null?void 0:b.fullName}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6c757d"},children:["ID: ",N._id]}),((w=N.academicInfo)==null?void 0:w.instrument)&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6c757d"},children:["Instrument: ",N.academicInfo.instrument]})]},N._id)})})]})]}),u&&e.jsxs("div",{style:{background:u.success?"#d4edda":"#f8d7da",border:`2px solid ${u.success?"#c3e6cb":"#f5c6cb"}`,color:u.success?"#155724":"#721c24",borderRadius:"12px",padding:"2rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsx(Et,{size:32}),e.jsx("h3",{style:{margin:0,fontSize:"1.5rem"},children:u.success?"✅ Fix Completed Successfully!":"❌ Fix Failed"})]}),u.success?e.jsxs("div",{style:{lineHeight:1.6},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Teacher:"})," ",u.teacherName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Students synchronized:"})," ",u.newCount," (was ",u.previousCount,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Students found:"})," ",u.studentsFound]}),u.studentDetails&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("strong",{children:"Added to studentIds:"}),e.jsx("ul",{style:{marginTop:"0.5rem"},children:u.studentDetails.map(N=>e.jsxs("li",{children:[N.name," - ",N.instrument," (",N.id,")"]},N.id))})]}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(255, 255, 255, 0.3)",borderRadius:"8px"},children:[e.jsx("strong",{children:"🎉 Success!"})," The teacher's studentIds array has been synchronized with student assignments!",e.jsx("br",{}),"The teacher form and details page will now show consistent data."]})]}):e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",u.error]}),e.jsx("p",{children:"Please check the browser console for more details and try again."})]})]}),l&&l.error&&e.jsxs("div",{style:{background:"#f8d7da",border:"2px solid #f5c6cb",color:"#721c24",borderRadius:"12px",padding:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.5rem"},children:"❌ Investigation Failed"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",l.error]}),e.jsx("p",{children:"Please check the browser console for more details."})]}),e.jsx("style",{children:`
        .spin {
          animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}const tM=new JE({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});function sM(){const t=cl(l=>l.isAuthenticated),s=cl(l=>l.isLoading),n=cl(l=>l.isInitialized),i=Ds(l=>l.loadBasicTeacherData);return x.useEffect(()=>{t&&i()},[t,i]),!n||s?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px"},children:"Validating session..."}):t?e.jsx(wl,{}):e.jsx(eu,{to:"/login",replace:!0})}function aM(){const t=cl(s=>s.initialize);return x.useEffect(()=>{t()},[t]),e.jsx(t2,{client:tM,children:e.jsx(xA,{children:e.jsx(AA,{position:"bottom-left",children:e.jsx(Gw,{children:e.jsxs(Sw,{children:[e.jsx(ut,{path:"/login",element:e.jsx(vA,{})}),e.jsx(ut,{path:"/reset-password/:token",element:e.jsx(JR,{})}),e.jsx(ut,{path:"/accept-invitation/:token",element:e.jsx(DA,{})}),e.jsx(ut,{path:"/event-registration",element:e.jsx(IA,{})}),e.jsx(ut,{path:"/toast-test",element:e.jsx($A,{})}),e.jsx(ut,{path:"/debug-sync",element:e.jsx(eM,{})}),e.jsxs(ut,{element:e.jsx(sM,{}),children:[e.jsx(ut,{path:"/dashboard",element:e.jsx(QA,{})}),e.jsx(ut,{path:"/profile",element:e.jsx(KR,{})}),e.jsxs(ut,{path:"/students",element:e.jsx(d$,{}),children:[e.jsx(ut,{path:":studentId",element:e.jsx(Dj,{})}),e.jsx(ut,{path:"new",element:e.jsx(Dj,{})})]}),e.jsxs(ut,{path:"/teachers",element:e.jsx(M$,{}),children:[e.jsx(ut,{path:":teacherId",element:e.jsx(Ij,{})}),e.jsx(ut,{path:"new",element:e.jsx(Ij,{})})]}),e.jsxs(ut,{path:"/orchestras",element:e.jsx(H$,{}),children:[e.jsx(ut,{path:":orchestraId",element:e.jsx($j,{})}),e.jsx(ut,{path:"new",element:e.jsx($j,{})})]}),e.jsxs(ut,{path:"/rehearsals",element:e.jsx(J$,{}),children:[e.jsx(ut,{path:":rehearsalId",element:e.jsx(Rj,{})}),e.jsx(ut,{path:"new",element:e.jsx(Rj,{})})]}),e.jsx(ut,{path:"/theory",element:e.jsx($R,{})}),e.jsx(ut,{path:"/theory/:theoryLessonId",element:e.jsx(qj,{})}),e.jsx(ut,{path:"/theory/new",element:e.jsx(qj,{})}),e.jsx(ut,{path:"/bagrut",element:e.jsx(FR,{})}),e.jsx(ut,{path:"/bagrut/:bagrutId",element:e.jsx(ZR,{})}),e.jsx(ut,{path:"/",element:e.jsx(eu,{to:"/theory",replace:!0})}),e.jsx(ut,{path:"*",element:e.jsx(eu,{to:"/theory",replace:!0})})]})]})})})})})}_1.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(aM,{})}))});export default nM();
