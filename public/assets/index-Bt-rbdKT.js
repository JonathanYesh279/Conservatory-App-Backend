const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/Dashboard-DfJ0hgmp.js","chunks/vendor-B2j9q2e_.js","chunks/StatsCard-CfdMOdiv.js","chunks/utils-x1PSU_OZ.js","chunks/Card-Bp9nq125.js","chunks/cascade-deletion-DAN0Gkem.js","chunks/query-BI61muSV.js","chunks/ui-ypR0-hKN.js","chunks/teacherDetailsApi-BGs4ypj_.js","chunks/Students-BTMrWWcP.js","chunks/Table-BQGUFwcb.js","chunks/ConfirmationModal-B7HaZ5IM.js","chunks/StudentDetailsPageSimple-DiXZ6z9p.js","chunks/TeacherNameDisplay-h4fB0e93.js","chunks/apiCache-T5b6VToj.js","chunks/theoryEnrollmentService-Bgf_GhXN.js","chunks/Teachers-cs89_WST.js","chunks/TheoryLessons-2jnWnr7s.js","chunks/TheoryLessonDetails-bqX9lw2J.js","chunks/Orchestras-ctfVdrfe.js","chunks/Rehearsals-DOxgheCG.js","chunks/RehearsalDetails-CyDK6Oir.js","chunks/Bagruts-Dt4f5sJD.js","chunks/useBagrut-DphyHZix.js","chunks/BagrutDetails-p8HeCSCc.js","chunks/Profile-DNPkbvN4.js","chunks/RehearsalAttendance-DykoWZ-T.js","chunks/OrchestraEnrollmentManager-CEGKc7Xv.js","chunks/TeacherDetailsPage-CagTbE7Z.js","chunks/OrchestraDetailsPage-BDn9QX7A.js"])))=>i.map(i=>d[i]);
var Rt=Object.defineProperty;var Ot=(t,s,o)=>s in t?Rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o;var Oe=(t,s,o)=>Ot(t,typeof s!="symbol"?s+"":s,o);import{r as u,a as Pt,u as $t,b as Ce,L as ue,c as Lt,d as Ut,e as H,N as Ie,R as Se,B as Bt}from"../chunks/vendor-B2j9q2e_.js";import{a as K,t as Ft,s as Mt,o as Vt,b as mt,_ as Z,e as Yt}from"../chunks/cascade-deletion-DAN0Gkem.js";import{Q as ht,c as gt}from"../chunks/query-BI61muSV.js";import{X as me,A as We,U as de,C as ge,a as ie,B as Ne,M as Ee,T as Be,P as xe,b as ae,c as ke,F as Je,d as le,e as ve,f as oe,S as He,g as Fe,h as Wt,R as Ht,i as Ze,j as et,k as zt,l as Pe,m as Xt,n as qt,H as we,G as xt,o as ze,p as _e,q as ft,r as Gt,s as tt,t as st,u as Qt,L as Kt}from"../chunks/ui-ypR0-hKN.js";import"../chunks/utils-x1PSU_OZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();var pt={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt=u,Zt=Symbol.for("react.element"),es=Symbol.for("react.fragment"),ts=Object.prototype.hasOwnProperty,ss=Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rs={key:!0,ref:!0,__self:!0,__source:!0};function yt(t,s,o){var c,r={},n=null,i=null;o!==void 0&&(n=""+o),s.key!==void 0&&(n=""+s.key),s.ref!==void 0&&(i=s.ref);for(c in s)ts.call(s,c)&&!rs.hasOwnProperty(c)&&(r[c]=s[c]);if(t&&t.defaultProps)for(c in s=t.defaultProps,s)r[c]===void 0&&(r[c]=s[c]);return{$$typeof:Zt,type:t,key:n,ref:i,props:r,_owner:ss.current}}Ae.Fragment=es;Ae.jsx=yt;Ae.jsxs=yt;pt.exports=Ae;var e=pt.exports,Me={},rt=Pt;Me.createRoot=rt.createRoot,Me.hydrateRoot=rt.hydrateRoot;const bt=u.createContext(null),fe=()=>{const t=u.useContext(bt);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},as=({children:t})=>{const[s,o]=u.useState(!1),[c,r]=u.useState(!0),[n,i]=u.useState(null),[b,m]=u.useState(null),[d,h]=u.useState(null),S=u.useRef(!1),O=u.useRef(null),k=u.useRef(!0);u.useEffect(()=>{k.current=!0;const I=setTimeout(()=>{k.current&&$()},100);return()=>{k.current=!1,O.current&&clearTimeout(O.current),clearTimeout(I)}},[]);const $=u.useCallback(async(I=!1)=>{if(S.current&&!I){console.log("ğŸ” AUTH CONTEXT - Validation already in progress, skipping");return}const A=Date.now();if(!I&&d&&A-d<3e4){console.log("ğŸ” AUTH CONTEXT - Using cached authentication status");return}S.current=!0,m(null);try{if(K.auth.isAuthenticated()){console.log("ğŸ” AUTH CONTEXT - Token found, validating with server");const E=await K.auth.validateToken();if(!k.current)return;const L=E?.data?.user||E?.user||E?.data||E;console.log("ğŸ” AUTH CONTEXT - Token validation successful, fetching full teacher data");let v=null;if(L?._id)try{v=await K.teachers.getTeacher(L._id),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched:",{hasPersonalInfo:!!v?.personalInfo,hasRoles:!!v?.roles,fullName:v?.personalInfo?.fullName})}catch(M){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data:",M),v=L}const P=v||L,_={...P,teacherId:P?.teacherId||P?._id,personalInfo:P?.personalInfo||{fullName:P?.fullName||L?.fullName||"",email:P?.email||L?.email||"",phone:P?.phone||"",address:P?.address||""},roles:P?.roles||L?.roles||[],role:P?.role||P?.roles?.[0]||L?.roles?.[0]||""};console.log("ğŸ” AUTH CONTEXT - User data normalized:",{hasUserData:!!_,userRole:_?.role||_?.roles,userId:_?.teacherId||_?._id,fullName:_?.personalInfo?.fullName}),o(!0),i(_),h(A)}else console.log("ğŸ” AUTH CONTEXT - No valid token found"),o(!1),i(null),h(A)}catch(E){if(console.error("ğŸ” AUTH CONTEXT - Auth validation failed:",E),!k.current)return;m(E.message),o(!1),i(null),h(A),E.message.includes("Authentication failed")&&K.auth.isAuthenticated()&&console.log("ğŸ” AUTH CONTEXT - Attempting token refresh")}finally{k.current&&r(!1),S.current=!1}},[d]),F=async(I,A)=>{try{r(!0),m(null);const E=await K.auth.login(I,A);if(!k.current)return;console.log("ğŸ” AUTH CONTEXT - Login successful:",{hasToken:!!E.token,hasUserData:!!(E.teacher||E.user)});const{token:L}=E,v=E.teacher||E.user||E.data?.teacher||E.data?.user||E.data;if(!L||!v)throw new Error("Invalid login response: missing token or user data");console.log("ğŸ” AUTH CONTEXT - Fetching full teacher data after login");let P=null;if(v?._id||v?.teacherId)try{const re=v._id||v.teacherId;P=await K.teachers.getTeacher(re),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched after login:",{hasPersonalInfo:!!P?.personalInfo,hasRoles:!!P?.roles,fullName:P?.personalInfo?.fullName})}catch(re){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data after login:",re),P=v}const _=P||v,M={..._,teacherId:_?.teacherId||_?._id,personalInfo:_?.personalInfo||{fullName:_?.fullName||v?.personalInfo?.fullName||v?.fullName||"",email:_?.email||v?.credentials?.email||v?.personalInfo?.email||v?.email||I,phone:_?.phone||v?.personalInfo?.phone||"",address:_?.address||v?.personalInfo?.address||""},roles:_?.roles||v?.roles||[],role:_?.role||_?.roles?.[0]||v?.roles?.[0]||""};return console.log("ğŸ” AUTH CONTEXT - User data normalized after login:",{hasUserData:!!M,userRole:M?.role||M?.roles,userId:M?.teacherId||M?._id,fullName:M?.personalInfo?.fullName}),o(!0),i(M),h(Date.now()),{success:!0,user:M}}catch(E){throw console.error("ğŸ” AUTH CONTEXT - Login failed:",E),k.current&&(m(E.message),o(!1),i(null)),E}finally{k.current&&r(!1)}},T=async()=>{try{r(!0),await K.auth.logout(),console.log("ğŸ” AUTH CONTEXT - Logout successful")}catch(I){console.warn("ğŸ” AUTH CONTEXT - Logout API call failed:",I)}finally{k.current&&(o(!1),i(null),m(null),h(null),r(!1))}},W=u.useCallback(async()=>{try{return console.log("ğŸ” AUTH CONTEXT - Attempting token refresh"),await $(!0),s}catch(I){return console.error("ğŸ” AUTH CONTEXT - Token refresh failed:",I),await T(),!1}},[s]),x=u.useCallback(()=>({isAuthenticated:s,isLoading:c,user:n?{id:n.teacherId||n.id,role:n.role}:null,authError:b,lastValidation:d?new Date(d).toISOString():null,isValidating:S.current,cacheAge:d?Date.now()-d:null}),[s,c,n,b,d]),j={isAuthenticated:s,isLoading:c,user:n,authError:b,login:F,logout:T,checkAuthStatus:$,refreshToken:W,debugAuth:x};return e.jsx(bt.Provider,{value:j,children:t})},jt=u.createContext(null),vt=()=>{const t=u.useContext(jt);if(!t)throw new Error("useSchoolYear must be used within a SchoolYearProvider");return t},ns=({children:t})=>{const{isAuthenticated:s}=fe(),[o,c]=u.useState(null),[r,n]=u.useState([]),[i,b]=u.useState(!0),[m,d]=u.useState(null);u.useEffect(()=>{s?h():(c(null),n([]),b(!1),d(null))},[s]);const h=async()=>{try{b(!0),d(null);const x=await K.schoolYears.getSchoolYears();n(x);const j=await K.schoolYears.getCurrentSchoolYear();if(j)c(j);else if(x.length>0){const I=x.sort((A,E)=>new Date(E.startDate)-new Date(A.startDate))[0];c(I)}console.log(`ğŸ“ Loaded ${x.length} school years, current: ${j?.name||"None"}`)}catch(x){console.error("Failed to load school years:",x),d(x.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×©× ×•×ª ×”×œ×™××•×“")}finally{b(!1)}},S=async x=>{try{const j=r.find(I=>I._id===x);if(j)c(j),console.log(`ğŸ¯ Switched to school year: ${j.name}`);else{const I=await K.schoolYears.getSchoolYear(x);c(I),console.log(`ğŸ¯ Switched to fetched school year: ${I.name}`)}}catch(j){console.error("Failed to set school year:",j),d(j.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“")}},O=async x=>{try{const j=await K.schoolYears.createSchoolYear(x);return n(I=>[...I,j]),x.isCurrent&&c(j),console.log(`â• Created new school year: ${j.name}`),j}catch(j){throw console.error("Failed to create school year:",j),d(j.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×©× ×ª ×”×œ×™××•×“"),j}},k=async(x,j)=>{try{const I=await K.schoolYears.updateSchoolYear(x,j);return n(A=>A.map(E=>E._id===x?I:E)),o&&o._id===x&&c(I),console.log(`âœï¸ Updated school year: ${I.name}`),I}catch(I){throw console.error("Failed to update school year:",I),d(I.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“"),I}},$=async x=>{try{if(await K.schoolYears.deleteSchoolYear(x),n(j=>j.filter(I=>I._id!==x)),o&&o._id===x){const j=r.filter(I=>I._id!==x);j.length>0?c(j[0]):c(null)}console.log(`ğŸ—‘ï¸ Deleted school year: ${x}`)}catch(j){throw console.error("Failed to delete school year:",j),d(j.message||"×©×’×™××” ×‘××—×™×§×ª ×©× ×ª ×”×œ×™××•×“"),j}},F=x=>{if(!x)return!1;const j=new Date,I=new Date(x.startDate),A=new Date(x.endDate);return j>=I&&j<=A&&x.isActive},W={currentSchoolYear:o,schoolYears:r,isLoading:i,error:m,loadSchoolYears:h,setCurrentSchoolYearById:S,createSchoolYear:O,updateSchoolYear:k,deleteSchoolYear:$,isSchoolYearActive:F,getSchoolYearDisplayName:x=>{if(!x)return"×œ× × ×‘×—×¨×” ×©× ×”";const j=x.isCurrent,I=F(x);let A=x.name;return j?A+=" (× ×•×›×—×™×ª)":I&&(A+=" (×¤×¢×™×œ×”)"),A}};return e.jsx(jt.Provider,{value:W,children:t})},ls={currentBagrut:null,bagruts:[],loading:!1,error:null,validation:{errors:{},warnings:{}}},os=t=>{if(!t[3]?.detailedGrading)return 0;const s=t[3].detailedGrading;return(s.playingSkills?.points||0)+(s.musicalUnderstanding?.points||0)+(s.textKnowledge?.points||0)+(s.playingByHeart?.points||0)},is=(t,s)=>{const o=t/100*100,c=s/100*100;return o*.9+c*.1},cs=t=>t>=95?"××¦×•×™×Ÿ (100-95)":t>=85?"×˜×•×‘ ×××“ (94-85)":t>=75?"×˜×•×‘ (84-75)":t>=65?"×›××¢×˜ ×˜×•×‘ (74-65)":t>=55?"××¡×¤×™×§ (64-55)":"×œ× ××¡×¤×™×§ (54-0)",ds=t=>({presentations:[t.presentations?.[0]?.completed||!1,t.presentations?.[1]?.completed||!1,t.presentations?.[2]?.completed||!1,t.presentations?.[3]?.completed||!1],directorEvaluation:!!t.directorEvaluation?.points,recitalConfig:!!(t.recitalConfiguration?.units&&t.recitalConfiguration?.field),program:t.program?.length>0}),je=(t,s,o)=>t<0?`${o} ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×œ×™×œ×™`:t>s?`${o} ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ ${s} × ×§×•×“×•×ª`:null,us=t=>t!==3&&t!==5?"×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5":null,ms=(t,s)=>{switch(s.type){case"SET_LOADING":return{...t,loading:s.payload};case"SET_ERROR":return{...t,error:s.payload};case"SET_CURRENT_BAGRUT":return console.log("âœ… BagrutContext: SET_CURRENT_BAGRUT reducer:",s.payload?._id),{...t,currentBagrut:s.payload};case"SET_BAGRUTS":return{...t,bagruts:s.payload};case"UPDATE_DIRECTOR_EVALUATION":{const{bagrutId:o,evaluation:c}=s.payload,r=t.currentBagrut?._id===o?{...t.currentBagrut,directorEvaluation:c}:t.currentBagrut,n=t.bagruts.map(i=>i._id===o?{...i,directorEvaluation:c}:i);return{...t,currentBagrut:r,bagruts:n}}case"UPDATE_RECITAL_CONFIG":{const{bagrutId:o,config:c}=s.payload,r={units:c.recitalUnits,field:c.recitalField},n=t.currentBagrut?._id===o?{...t.currentBagrut,recitalConfiguration:r,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:t.currentBagrut,i=t.bagruts.map(b=>b._id===o?{...b,recitalConfiguration:r,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:b);return{...t,currentBagrut:n,bagruts:i}}case"UPDATE_PRESENTATION":{const{bagrutId:o,index:c,data:r}=s.payload,n=(m=[])=>{const d=[...m];return d[c]={...d[c],...r},d},i=t.currentBagrut?._id===o?{...t.currentBagrut,presentations:n(t.currentBagrut.presentations)}:t.currentBagrut,b=t.bagruts.map(m=>m._id===o?{...m,presentations:n(m.presentations)}:m);return{...t,currentBagrut:i,bagruts:b}}case"CALCULATE_COMPUTED_VALUES":{const{bagrutId:o}=s.payload,c=r=>{if(r._id!==o)return r;const n=os(r.presentations||[]),i=r.directorEvaluation?.points||0,b=is(n,i),m=cs(b),d=ds(r);return{...r,computedValues:{totalPerformancePoints:n,weightedFinalGrade:b,gradeLevel:m,completionStatus:d},finalGrade:b,finalGradeLevel:m}};return{...t,currentBagrut:t.currentBagrut?c(t.currentBagrut):null,bagruts:t.bagruts.map(c)}}case"SET_VALIDATION_ERROR":return{...t,validation:{...t.validation,errors:{...t.validation.errors,[s.payload.field]:s.payload.message}}};case"CLEAR_VALIDATION_ERRORS":return{...t,validation:{...t.validation,errors:{}}};default:return t}},Nt=u.createContext(null),hs=({children:t})=>{const[s,o]=u.useReducer(ms,ls),c=u.useMemo(()=>({setLoading:n=>o({type:"SET_LOADING",payload:n}),setError:n=>o({type:"SET_ERROR",payload:n}),setCurrentBagrut:n=>{console.log("ğŸ’¾ BagrutContext: setCurrentBagrut action called with:",n?._id),o({type:"SET_CURRENT_BAGRUT",payload:n})},setBagruts:n=>o({type:"SET_BAGRUTS",payload:n}),updateDirectorEvaluation:(n,i)=>{const b=je(i.points||0,100,"×”×¢×¨×›×ª ×× ×”×œ");if(b){o({type:"SET_VALIDATION_ERROR",payload:{field:"directorEvaluation",message:b}});return}o({type:"UPDATE_DIRECTOR_EVALUATION",payload:{bagrutId:n,evaluation:i}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updateRecitalConfig:(n,i)=>{const b=us(i.recitalUnits);if(b){o({type:"SET_VALIDATION_ERROR",payload:{field:"recitalUnits",message:b}});return}o({type:"UPDATE_RECITAL_CONFIG",payload:{bagrutId:n,config:i}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updatePresentation:(n,i,b)=>{if(b.detailedGrading){const m=b.detailedGrading,d=[];if(m.playingSkills?.points!==void 0){const h=je(m.playingSkills.points,40,"×›×™×©×•×¨×™ × ×’×™× ×”");h&&d.push(h)}if(m.musicalUnderstanding?.points!==void 0){const h=je(m.musicalUnderstanding.points,30,"×”×‘× ×” ××•×–×™×§×œ×™×ª");h&&d.push(h)}if(m.textKnowledge?.points!==void 0){const h=je(m.textKnowledge.points,20,"×™×“×¢ ×˜×§×¡×˜");h&&d.push(h)}if(m.playingByHeart?.points!==void 0){const h=je(m.playingByHeart.points,10,"× ×’×™× ×” ×‘×¢×œ ×¤×”");h&&d.push(h)}if(d.length>0){o({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${i}`,message:d[0]}});return}}o({type:"UPDATE_PRESENTATION",payload:{bagrutId:n,index:i,data:b}}),o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},recalculateGrade:n=>{o({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},setValidationError:(n,i)=>{o({type:"SET_VALIDATION_ERROR",payload:{field:n,message:i}})},clearValidationErrors:()=>{o({type:"CLEAR_VALIDATION_ERRORS"})},validatePointTotal:n=>(n.playingSkills?.points||0)+(n.musicalUnderstanding?.points||0)+(n.textKnowledge?.points||0)+(n.playingByHeart?.points||0)>100?(o({type:"SET_VALIDATION_ERROR",payload:{field:"totalPoints",message:"×¡×š ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100"}}),!1):!0,validateSequentialPresentation:(n,i)=>n>0&&!i[n-1]?.completed?(o({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${n}`,message:`×™×© ×œ×”×©×œ×™× ×ª×—×™×œ×” ××¦×’×ª ${n}`}}),!1):!0}),[]),r=u.useMemo(()=>({state:s,actions:c}),[s,c]);return e.jsx(Nt.Provider,{value:r,children:t})},yr=()=>{const t=u.useContext(Nt);if(!t)throw new Error("useBagrutContext must be used within a BagrutProvider");return t},br={getCurrentBagrut:t=>t.currentBagrut,getAllBagruts:t=>t.bagruts,getLoadingState:t=>t.loading,getError:t=>t.error,getValidationErrors:t=>t.validation.errors,getBagrutById:(t,s)=>t.bagruts.find(o=>o._id===s),getCompletedPresentations:(t,s)=>t.bagruts.find(c=>c._id===s)?.presentations?.filter(c=>c.completed)||[],getTotalPerformancePoints:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.totalPerformancePoints||0,getWeightedFinalGrade:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.weightedFinalGrade||0,getCompletionStatus:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1}},pe=new ht({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!0,retry:(t,s)=>{const o=s?.response?.status;return o>=400&&o<500?!1:t<2},retryDelay:t=>Math.min(1e3*2**t,3e4),networkMode:"online"},mutations:{retry:1,networkMode:"online",onError:t=>{console.error("Mutation error:",t)}}}});pe.setQueryDefaults(["students"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["teachers"],{staleTime:10*60*1e3,gcTime:30*60*1e3});pe.setQueryDefaults(["theory-lessons"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["orchestras"],{staleTime:5*60*1e3,gcTime:15*60*1e3});pe.setQueryDefaults(["school-years"],{staleTime:30*60*1e3,gcTime:60*60*1e3});function gs({children:t}){return e.jsxs(gt,{client:pe,children:[t,!1]})}const wt=u.createContext(void 0);function xs({children:t}){const[s,o]=u.useState(!0),[c,r]=u.useState(!1);return u.useEffect(()=>{const n=()=>{r(window.innerWidth<768)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),e.jsx(wt.Provider,{value:{isDesktopOpen:s,setIsDesktopOpen:o,isMobile:c},children:t})}function Xe(){const t=u.useContext(wt);if(t===void 0)throw new Error("useSidebar must be used within a SidebarProvider");return t}const fs=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨"],ps=[1,2,3,4,5,6,7,8],ys=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","×’×™×˜×¨×” ×‘×¡","×ª×•×¤×™×"],bs=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],js=[30,45,60],at=["×œ× × ×‘×—×Ÿ","×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”"],vs=({initialData:t,onSubmit:s,onCancel:o,isEdit:c=!1})=>{const[r,n]=u.useState({personalInfo:{fullName:"",phone:"",age:null,address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[{instrumentName:"",isPrimary:!0,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}],class:"×",tests:{bagrutId:null}},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,...t}),[i,b]=u.useState({}),[m,d]=u.useState(!1),[h,S]=u.useState({personal:!0,academic:!0,instruments:!0,teachers:!0,enrollments:!1}),[O,k]=u.useState([]),[$,F]=u.useState([]),[T,W]=u.useState([]),[x,j]=u.useState([]),[I,A]=u.useState(""),[E,L]=u.useState(!1);u.useState([]);const[v,P]=u.useState({duration:null,selectedDays:[],startTime:"",endTime:""}),[_,M]=u.useState(!0);u.useEffect(()=>{const a=async()=>{try{const C=await K.teachers.getTeachers();k(C)}catch(C){console.error("Error fetching teachers:",C)}},f=async()=>{try{const C=await K.orchestras.getOrchestras();console.log("Fetched orchestras:",C);const R=await Promise.all((C||[]).map(async z=>{if(z.rehearsalIds&&z.rehearsalIds.length>0)try{const ee=await K.rehearsals.getRehearsalById(z.rehearsalIds[0]);return{...z,rehearsalSchedule:ee?{day:ee.day||ee.dayOfWeek,startTime:ee.startTime,endTime:ee.endTime,location:ee.location||z.location}:null}}catch{return console.log("Could not fetch rehearsal for orchestra:",z.name),z}return z}));W(R)}catch(C){console.error("Error fetching orchestras:",C),W([])}},p=async()=>{try{const C=await K.theory.getTheoryLessons();console.log("Fetched theory lessons:",C);const R=Array.isArray(C)?C:C?.data||[];j(R)}catch(C){console.error("Error fetching theory lessons:",C),j([])}};a(),f(),p()},[]),u.useEffect(()=>{I&&(re(I),M(!0))},[I]);const re=async a=>{L(!0);try{const f=await K.teachers.getTeacherById(a);console.log("Teacher data for slots:",f);const p=f.teaching?.timeBlocks?.filter(R=>R.isActive!==!1)||[];console.log("Time blocks found:",p);const C=[];p.forEach(R=>{const z=R.startTime,ee=R.endTime,N=R.day,[V,Y]=z.split(":").map(Number),[X,te]=ee.split(":").map(Number),be=V*60+Y,St=X*60+te-be;js.forEach(he=>{const kt=Math.floor(St/he);for(let Te=0;Te<kt;Te++){const Re=be+Te*he,Ge=Re+he,Dt=Math.floor(Re/60),Ct=Re%60,Et=Math.floor(Ge/60),_t=Ge%60,Qe=`${Dt.toString().padStart(2,"0")}:${Ct.toString().padStart(2,"0")}`,At=`${Et.toString().padStart(2,"0")}:${_t.toString().padStart(2,"0")}`;R.assignedLessons&&R.assignedLessons.some(Ke=>Ke.startTime===Qe&&Ke.duration===he)||C.push({_id:`${R._id}-${he}-${Te}`,day:N,startTime:Qe,endTime:At,duration:he,isAvailable:!0,location:R.location,teacherName:f.personalInfo?.fullName,teacherId:f._id,instrument:f.professionalInfo?.instrument})}})}),console.log("Generated available slots:",C),F(C)}catch(f){console.error("Error fetching teacher slots:",f),F([])}finally{L(!1)}},l=a=>{S(f=>({...f,[a]:!f[a]}))},y=(a,f,p)=>{n(C=>({...C,[a]:{...C[a],[f]:p}})),b(C=>({...C,[`${a}.${f}`]:""}))},U=(a,f,p)=>{const C=[...r.academicInfo.instrumentProgress];f==="tests"?C[a]={...C[a],tests:p}:C[a]={...C[a],[f]:p},f==="isPrimary"&&p===!0&&C.forEach((R,z)=>{z!==a&&(R.isPrimary=!1)}),n(R=>({...R,academicInfo:{...R.academicInfo,instrumentProgress:C}}))},g=()=>{const a=r.academicInfo.instrumentProgress.some(f=>f.isPrimary);n(f=>({...f,academicInfo:{...f.academicInfo,instrumentProgress:[...f.academicInfo.instrumentProgress,{instrumentName:"",isPrimary:!a,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}]}}))},D=a=>{const f=r.academicInfo.instrumentProgress.filter((p,C)=>C!==a);f.length>0&&!f.some(p=>p.isPrimary)&&(f[0].isPrimary=!0),n(p=>({...p,academicInfo:{...p.academicInfo,instrumentProgress:f}}))},w=a=>{const f={teacherId:a.teacherId,day:a.day,time:a.startTime,duration:a.duration,isActive:!0,isRecurring:!0,...a.location&&{location:a.location}};n(p=>({...p,teacherAssignments:[...p.teacherAssignments,f],teacherIds:p.teacherIds.includes(a.teacherId)?p.teacherIds:[...p.teacherIds,a.teacherId]})),F(p=>p.filter(C=>C._id!==a._id)),M(!1)},B=(a,f)=>{const[p,C]=a.split(":").map(Number),R=p*60+C+f,z=Math.floor(R/60),ee=R%60;return`${z.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`},J=a=>{const f=r.teacherAssignments[a];n(p=>{const C=p.teacherAssignments.filter((z,ee)=>ee!==a),R=C.some(z=>z.teacherId===f.teacherId);return{...p,teacherAssignments:C,teacherIds:R?p.teacherIds:p.teacherIds.filter(z=>z!==f.teacherId)}})},Q=()=>{const a={};r.personalInfo.fullName.trim()||(a["personalInfo.fullName"]="×©× ××œ× ×”×•× ×©×“×” ×—×•×‘×”"),r.personalInfo.phone&&!/^05\d{8}$/.test(r.personalInfo.phone)&&(a["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×“×•×’××”: 0501234567)"),r.personalInfo.parentPhone&&!/^05\d{8}$/.test(r.personalInfo.parentPhone)&&(a["personalInfo.parentPhone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),r.personalInfo.parentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.personalInfo.parentEmail)&&(a["personalInfo.parentEmail"]="××™××™×™×œ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),r.personalInfo.studentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.personalInfo.studentEmail)&&(a["personalInfo.studentEmail"]="××™××™×™×œ ×ª×œ××™×“ ×œ× ×ª×§×™×Ÿ"),r.academicInfo.class||(a["academicInfo.class"]="×›×™×ª×” ×”×™× ×©×“×” ×—×•×‘×”"),r.academicInfo.instrumentProgress.length===0?a["academicInfo.instruments"]="×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×›×œ×™ × ×’×™× ×” ××—×“":r.academicInfo.instrumentProgress.forEach((p,C)=>{p.instrumentName||(a[`instrument.${C}.name`]="×©× ×”×›×œ×™ ×”×•× ×©×“×” ×—×•×‘×”")});const f=r.academicInfo.instrumentProgress.some(p=>p.isPrimary);return r.academicInfo.instrumentProgress.length>0&&!f&&(a["academicInfo.primaryInstrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ ×¨××©×™"),b(a),Object.keys(a).length===0},ye=async a=>{if(a.preventDefault(),!!Q()){d(!0);try{console.log("ğŸ“‹ Form data being submitted:",JSON.stringify(r,null,2)),console.log("ğŸ‘¥ Teacher assignments:",JSON.stringify(r.teacherAssignments,null,2)),console.log("ğŸ‘¨â€ğŸ« Teacher IDs:",r.teacherIds),await s(r)}catch(f){console.error("Error submitting form:",f),b({submit:"×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×"})}finally{d(!1)}}};return e.jsxs("form",{onSubmit:ye,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:c?"×¢×¨×™×›×ª ×ª×œ××™×“":"×”×•×¡×¤×ª ×ª×œ××™×“ ×—×“×©"}),e.jsx("button",{type:"button",onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),i.submit&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:i.submit})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("personal"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××™×©×™×™×"})]}),h.personal?e.jsx(ge,{}):e.jsx(ie,{})]}),h.personal&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ××œ× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.personalInfo.fullName,onChange:a=>y("personalInfo","fullName",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.fullName"]?"border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ××©×¤×—×” ×•××– ×©× ×¤×¨×˜×™ (×œ×“×•×’××”: ×›×”×Ÿ ×™×•×¡×™)"}),i["personalInfo.fullName"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×ª×œ××™×“"}),e.jsx("input",{type:"tel",value:r.personalInfo.phone,onChange:a=>y("personalInfo","phone",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.phone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),i["personalInfo.phone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×’×™×œ"}),e.jsx("input",{type:"number",value:r.personalInfo.age||"",onChange:a=>y("personalInfo","age",a.target.value?parseInt(a.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×’×™×œ ×”×ª×œ××™×“",min:"0",max:"99"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×ª×œ××™×“"}),e.jsx("input",{type:"email",value:r.personalInfo.studentEmail,onChange:a=>y("personalInfo","studentEmail",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.studentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"student@example.com"}),i["personalInfo.studentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.studentEmail"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª"}),e.jsx("input",{type:"text",value:r.personalInfo.address,onChange:a=>y("personalInfo","address",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×”×›× ×¡ ×›×ª×•×‘×ª ××œ××”"})]}),e.jsx("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-4",children:"×¤×¨×˜×™ ×”×•×¨×”"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×•×¨×”"}),e.jsx("input",{type:"text",value:r.personalInfo.parentName,onChange:a=>y("personalInfo","parentName",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×©× ×”×”×•×¨×”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×”×•×¨×”"}),e.jsx("input",{type:"tel",value:r.personalInfo.parentPhone,onChange:a=>y("personalInfo","parentPhone",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.parentPhone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),i["personalInfo.parentPhone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.parentPhone"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×”×•×¨×”"}),e.jsx("input",{type:"email",value:r.personalInfo.parentEmail,onChange:a=>y("personalInfo","parentEmail",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.parentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"parent@example.com"}),i["personalInfo.parentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.parentEmail"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("academic"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××§×“××™×™×"})]}),h.academic?e.jsx(ge,{}):e.jsx(ie,{})]}),h.academic&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×™×ª×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:r.academicInfo.class,onChange:a=>y("academicInfo","class",a.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["academicInfo.class"]?"border-red-500":"border-gray-300"}`,children:fs.map(a=>e.jsx("option",{value:a,children:a},a))}),i["academicInfo.class"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["academicInfo.class"]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("instruments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×›×œ×™ × ×’×™× ×”"})]}),h.instruments?e.jsx(ge,{}):e.jsx(ie,{})]}),h.instruments&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[i["academicInfo.instruments"]&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:i["academicInfo.instruments"]})}),i["academicInfo.primaryInstrument"]&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:i["academicInfo.primaryInstrument"]})}),e.jsxs("div",{className:"space-y-4",children:[r.academicInfo.instrumentProgress.map((a,f)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×›×œ×™ × ×’×™× ×” ",f+1]}),r.academicInfo.instrumentProgress.length>1&&e.jsx("button",{type:"button",onClick:()=>D(f),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["×©× ×”×›×œ×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.instrumentName,onChange:p=>U(f,"instrumentName",p.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i[`instrument.${f}.name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),ys.map(p=>e.jsx("option",{value:p,children:p},p))]}),i[`instrument.${f}.name`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i[`instrument.${f}.name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×œ×‘ × ×•×›×—×™"}),e.jsx("select",{value:a.currentStage,onChange:p=>U(f,"currentStage",parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:ps.map(p=>e.jsxs("option",{value:p,children:["×©×œ×‘ ",p]},p))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isPrimary,onChange:p=>U(f,"isPrimary",p.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×›×œ×™ ×¨××©×™"})]})}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×©×œ×‘"}),e.jsx("select",{value:a.tests.stageTest.status,onChange:p=>U(f,"tests",{...a.tests,stageTest:{...a.tests.stageTest,status:p.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:at.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×˜×›× ×™"}),e.jsx("select",{value:a.tests.technicalTest.status,onChange:p=>U(f,"tests",{...a.tests,technicalTest:{...a.tests.technicalTest,status:p.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:at.map(p=>e.jsx("option",{value:p,children:p},p))})]})]})]})]},f)),e.jsxs("button",{type:"button",onClick:g,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors flex items-center justify-center gap-2 text-gray-600 hover:text-primary-600",children:[e.jsx(xe,{className:"w-4 h-4"}),"×”×•×¡×£ ×›×œ×™ × ×’×™× ×”"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("teachers"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××•×¨×™× ×•×©×™×¢×•×¨×™×"}),r.teacherAssignments.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:[r.teacherAssignments.length," ×©×™×‘×•×¦×™×"]})]}),h.teachers?e.jsx(ge,{}):e.jsx(ie,{})]}),h.teachers&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[r.teacherAssignments.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×©×™×¢×•×¨×™× ××ª×•×›× × ×™×"}),e.jsx("div",{className:"space-y-2",children:r.teacherAssignments.map((a,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ke,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["××•×¨×” - ",O.find(p=>p._id===a.teacherId)?.professionalInfo?.instrument||"×›×œ×™"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.day," | ",a.time,"-",B(a.time,a.duration)," | ",a.duration," ×“×§×•×ª",a.location&&` | ${a.location}`]})]})]}),e.jsx("button",{type:"button",onClick:()=>J(f),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Be,{className:"w-4 h-4"})})]},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×‘×—×¨ ××•×¨×”"}),e.jsxs("select",{value:I,onChange:a=>A(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×"}),O.map(a=>e.jsxs("option",{value:a._id,children:[a.personalInfo?.fullName," - ",a.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"]},a._id))]})]}),I&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["×–×× ×™× ×¤× ×•×™×™× - ",O.find(a=>a._id===I)?.personalInfo?.fullName||"××•×¨×”"]}),!_&&$.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>M(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4"}),"×‘×—×¨ ×©×™×¢×•×¨ × ×•×¡×£"]})}),_&&!E&&$.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"×¡×™× ×•×Ÿ ×–×× ×™×"]}),(v.duration||v.selectedDays.length>0||v.startTime||v.endTime)&&e.jsxs("button",{type:"button",onClick:()=>P({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),"× ×§×” ×¡×™× ×•×Ÿ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×š ×©×™×¢×•×¨"}),e.jsxs("select",{value:v.duration||"",onChange:a=>P(f=>({...f,duration:a.target.value?Number(a.target.value):null})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"×›×œ ×”××©×›×™×"}),e.jsx("option",{value:"30",children:"30 ×“×§×•×ª"}),e.jsx("option",{value:"45",children:"45 ×“×§×•×ª"}),e.jsx("option",{value:"60",children:"60 ×“×§×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×™××™×"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-right flex items-center justify-between text-gray-900",onClick:a=>{const f=a.currentTarget.nextElementSibling;f&&f.classList.toggle("hidden")},children:[e.jsx("span",{className:"truncate",children:v.selectedDays.length>0?`${v.selectedDays.length} ×™××™× × ×‘×—×¨×•`:"×›×œ ×”×™××™×"}),e.jsx(ie,{className:"w-4 h-4 flex-shrink-0"})]}),e.jsx("div",{className:"hidden absolute top-full mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg z-10",children:bs.map(a=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v.selectedDays.includes(a),onChange:f=>{f.target.checked?P(p=>({...p,selectedDays:[...p.selectedDays,a]})):P(p=>({...p,selectedDays:p.selectedDays.filter(C=>C!==a)}))},className:"ml-2 text-primary-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:a})]},a))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×¢×”"}),e.jsx("input",{type:"time",value:v.startTime,onChange:a=>P(f=>({...f,startTime:a.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×¢×“ ×©×¢×”"}),e.jsx("input",{type:"time",value:v.endTime,onChange:a=>P(f=>({...f,endTime:a.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]})]})]}),E?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"×˜×•×¢×Ÿ ×–×× ×™× ×¤× ×•×™×™×..."})]}):_&&$.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–××Ÿ ×•××©×š ×©×™×¢×•×¨ ××”××¤×©×¨×•×™×•×ª ×”×–××™× ×•×ª:"}),(()=>{const a=$.filter(p=>!(v.duration&&p.duration!==v.duration||v.selectedDays.length>0&&!v.selectedDays.includes(p.day)||v.startTime&&p.startTime<v.startTime||v.endTime&&p.endTime>v.endTime));if(a.length===0)return e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×”×ª×•×××™× ×œ×¡×™× ×•×Ÿ ×©×‘×—×¨×ª"}),e.jsx("button",{type:"button",onClick:()=>P({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700",children:"× ×§×” ×¡×™× ×•×Ÿ ×•×ª×¨××” ××ª ×›×œ ×”×–×× ×™×"})]});const f=a.reduce((p,C)=>(p[C.day]||(p[C.day]=[]),p[C.day].push(C),p),{});return Object.entries(f).map(([p,C])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),p]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:C.sort((R,z)=>R.startTime.localeCompare(z.startTime)).map(R=>e.jsx("button",{type:"button",onClick:()=>w(R),className:`p-3 border rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-right ${R.duration===30?"border-green-300 bg-green-50":R.duration===45?"border-blue-300 bg-blue-50":"border-purple-300 bg-purple-50"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[R.startTime,"-",R.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R.duration===30?"bg-green-100 text-green-800":R.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[R.duration," ×“×§×³"]})]}),R.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ve,{className:"w-3 h-3"}),R.location]}),e.jsx("div",{className:"text-xs text-gray-600",children:R.instrument})]})},R._id))})]},p))})()]}):I&&!E&&_&&$.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×¤× ×•×™×™× ×œ××•×¨×” ×–×”"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×”××•×¨×” ×œ× ×”×’×“×™×¨ ×–×× ×™ ×”×•×¨××”"})]}):null]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("enrollments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×¨×©××•×ª"})]}),h.enrollments?e.jsx(ge,{}):e.jsx(ie,{})]}),h.enrollments&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×–××•×¨×ª"}),e.jsxs("select",{value:r.enrollments.orchestraIds[0]||"",onChange:a=>{n(f=>({...f,enrollments:{...f.enrollments,orchestraIds:a.target.value?[a.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),T.map(a=>{const f=a.rehearsalSchedule||a.schedule&&a.schedule[0]||a.rehearsals&&a.rehearsals[0]||null;let p=a.name;if(f){const C=f.day||f.dayOfWeek||"",R=f.startTime||"",z=f.endTime||"",ee=f.location||a.location||"";C&&R&&z&&(p+=` | ${C} ${R}-${z}`),ee&&(p+=` | ${ee}`)}else a.location&&(p+=` | ${a.location}`);return e.jsx("option",{value:a._id,children:p},a._id)})]}),r.enrollments.orchestraIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200",children:(()=>{const a=T.find(f=>f._id===r.enrollments.orchestraIds[0]);return a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-purple-900",children:a.name}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[a.rehearsalSchedule&&e.jsxs("div",{className:"p-2 bg-purple-100 rounded",children:[e.jsx("strong",{children:"×–×× ×™ ×—×–×¨×•×ª:"})," ",a.rehearsalSchedule.day," ",a.rehearsalSchedule.startTime,"-",a.rehearsalSchedule.endTime,a.rehearsalSchedule.location&&e.jsxs("span",{children:[" | ",a.rehearsalSchedule.location]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×•×’:"})," ",a.type||"×ª×–××•×¨×ª"]}),!a.rehearsalSchedule&&a.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"××™×§×•×:"})," ",a.location]}),a.memberIds&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×‘×¨×™×:"})," ",a.memberIds.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×˜×˜×•×¡:"})," ",a.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"]}),a.rehearsalIds&&a.rehearsalIds.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×–×¨×•×ª ×©××•×¨×•×ª:"})," ",a.rehearsalIds.length]})]})]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),e.jsxs("select",{value:r.enrollments.theoryLessonIds[0]||"",onChange:a=>{n(f=>({...f,enrollments:{...f.enrollments,theoryLessonIds:a.target.value?[a.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),x.map(a=>{const f=a.schedule&&a.schedule.length>0?a.schedule[0]:null,p=f?`${f.day} ${f.startTime}-${f.endTime}${f.location?` | ${f.location}`:""}`:"";return e.jsxs("option",{value:a._id,children:[a.name||a.title||a.category," ",p?`| ${p}`:"",a.teacher?.personalInfo?.fullName&&` | ××•×¨×”: ${a.teacher.personalInfo.fullName}`]},a._id)})]}),r.enrollments.theoryLessonIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(()=>{const a=x.find(f=>f._id===r.enrollments.theoryLessonIds[0]);return a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:a.name}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"×¨××”:"})," ",a.level]}),a.teacher?.personalInfo?.fullName&&e.jsxs("div",{children:[e.jsx("strong",{children:"××•×¨×”:"})," ",a.teacher.personalInfo.fullName]}),a.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×™××•×¨:"})," ",a.description]}),a.maxStudents&&e.jsxs("div",{children:[e.jsx("strong",{children:"××§×¡×™××•× ×ª×œ××™×“×™×:"})," ",a.maxStudents]}),a.currentStudents!==void 0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×œ××™×“×™× × ×•×›×—×™×™×:"})," ",a.currentStudents,"/",a.maxStudents||"âˆ"]}),a.schedule&&a.schedule.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×–×× ×™ ×©×™×¢×•×¨:"}),e.jsx("div",{className:"mt-1 space-y-1",children:a.schedule.map((f,p)=>e.jsxs("div",{className:"text-xs bg-blue-100 px-2 py-1 rounded",children:[f.day," ",f.startTime,"-",f.endTime,f.location&&` | ${f.location}`]},p))})]}),a.prerequisites&&e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[e.jsx("strong",{children:"×“×¨×™×©×•×ª ×§×“×:"})," ",a.prerequisites]})]})]}):null})()})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:o,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4"}),c?"×¢×“×›×Ÿ ×ª×œ××™×“":"×”×•×¡×£ ×ª×œ××™×“"]})})]})]})},Ve=["××•×œ× ×¢×¨×Ÿ","×¡×˜×•×“×™×• ×§×××¨×™ 1","×¡×˜×•×“×™×• ×§×××¨×™ 2","××•×œ×¤×Ÿ ×”×§×œ×˜×•×ª","×—×“×¨ ×—×–×¨×•×ª 1","×—×“×¨ ×—×–×¨×•×ª 2","×—×“×¨ ××—×©×‘×™×","×—×“×¨ 1","×—×“×¨ 2","×—×“×¨ ×—×–×¨×•×ª","×—×“×¨ 5","×—×“×¨ 6","×—×“×¨ 7","×—×“×¨ 8","×—×“×¨ 9","×—×“×¨ 10","×—×“×¨ 11","×—×“×¨ 12","×—×“×¨ 13","×—×“×¨ 14","×—×“×¨ 15","×—×“×¨ 16","×—×“×¨ 17","×—×“×¨ 18","×—×“×¨ 19","×—×“×¨ 20","×—×“×¨ 21","×—×“×¨ 22","×—×“×¨ 23","×—×“×¨ 24","×—×“×¨ 25","×—×“×¨ 26","×—×“×¨ ×ª××•×¨×™×” ×","×—×“×¨ ×ª××•×¨×™×” ×‘"],Ns=["××•×¨×”","×× ×¦×—","××“×¨×™×š ×”×¨×›×‘","×× ×”×œ","××•×¨×” ×ª××•×¨×™×”","××’××”"],ws=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],Ts=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","××•×¨×’×Ÿ","×—×¨××•× ×™×§×”","×× ×“×•×œ×™× ×”","×›×™× ×•×¨ ×‘××¨×•×§","×•×™×•×œ×” ×“×” ×’××‘×”","×¤×œ×•×˜×” ×¨×§×•×¨×“×¨","××•×§×¨×™× ×”","×—×œ×™×œ ×¤××Ÿ","×“×•×œ×¦×™××¨","××•×˜×•-×”×¨×¤","×¤×¡× ×ª×¨ ××œ×§×˜×¨×•× ×™","×’×™×˜×¨×” ×‘×¡","×’×™×˜×¨×” ××§×•×¡×˜×™×ª","×’×™×˜×¨×” ×§×œ××¡×™×ª","×‘× ×’×³×•","×—×œ×™×œ ××™×¨×™","×›×™× ×•×¨ ×§×œ×˜×™","×‘×•×“×”×¨××Ÿ"],Ye=(t,s)=>{if(!t||!s)return 0;const[o,c]=t.split(":").map(Number),[r,n]=s.split(":").map(Number),i=o*60+c,b=r*60+n;return b<=i?0:b-i},nt=(t,s)=>{if(!t||!s)return null;const o=Ye(t,s);return o<=0?"×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":o<30?"×™×•× ×œ×™××•×“ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 30 ×“×§×•×ª":o>480?"×™×•× ×œ×™××•×“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-8 ×©×¢×•×ª":null},Is=({isOpen:t,onClose:s,onTeacherAdded:o,teacherToEdit:c,mode:r="add"})=>{const{currentSchoolYear:n}=vt(),[i,b]=u.useState("personal"),[m,d]=u.useState({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),[h,S]=u.useState([]),[O,k]=u.useState([]),[$,F]=u.useState(!1),[T,W]=u.useState({}),[x,j]=u.useState("");u.useEffect(()=>{t&&r==="edit"&&c?A(c):t&&r==="add"&&l()},[t,r,c]),u.useEffect(()=>{t&&I()},[t]);const I=async()=>{try{const[g,D]=await Promise.all([K.orchestras.getOrchestras(),K.orchestras.getOrchestras({type:"ensemble"})]);S(g||[]),k(D||[])}catch(g){console.error("Failed to load orchestras/ensembles:",g)}},A=g=>{d({personalInfo:{fullName:g.personalInfo?.fullName||"",phone:g.personalInfo?.phone||"",email:g.personalInfo?.email||"",address:g.personalInfo?.address||""},roles:g.roles||[],professionalInfo:{instrument:g.professionalInfo?.instrument||"",isActive:g.professionalInfo?.isActive??!0},teaching:{schedule:g.teaching?.schedule||[]},conducting:{orchestraIds:g.conducting?.orchestraIds||[]},ensemblesIds:g.ensemblesIds||[]})},E=()=>{const g={};return m.personalInfo.fullName.trim()||(g["personalInfo.fullName"]="×©× ××œ× × ×“×¨×©"),m.personalInfo.phone.match(/^05\d{8}$/)||(g["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¤×•×¨××˜: 05XXXXXXXX"),m.personalInfo.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(g["personalInfo.email"]="×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”"),m.personalInfo.address.trim()||(g["personalInfo.address"]="×›×ª×•×‘×ª × ×“×¨×©×ª"),m.roles.length===0&&(g.roles="×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×ª×¤×§×™×“ ××—×“"),(m.roles.includes("××•×¨×”")||m.roles.includes("××’××”")||!m.roles.includes("××•×¨×” ×ª××•×¨×™×”"))&&!m.professionalInfo.instrument&&(g["professionalInfo.instrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ × ×’×™× ×”"),m.teaching.schedule.forEach((w,B)=>{if(w.startTime||(g[`schedule.${B}.startTime`]="×©×¢×ª ×”×ª×—×œ×” × ×“×¨×©×ª"),w.endTime||(g[`schedule.${B}.endTime`]="×©×¢×ª ×¡×™×•× × ×“×¨×©×ª"),w.location?Ve.includes(w.location)||(g[`schedule.${B}.location`]="××™×§×•× ×œ× ×ª×§×™×Ÿ"):g[`schedule.${B}.location`]="×™×© ×œ×‘×—×•×¨ ××™×§×•×",w.startTime&&w.endTime){const J=nt(w.startTime,w.endTime);J&&(g[`schedule.${B}.timeRange`]=J)}}),W(g),Object.keys(g).length===0},L=(g,D,w)=>{d(J=>({...J,[g]:{...J[g],[D]:w}}));const B=`${g}.${D}`;T[B]&&W(J=>{const Q={...J};return delete Q[B],Q})},v=(g,D)=>{const w=D?[...m.roles,g]:m.roles.filter(B=>B!==g);d(B=>({...B,roles:w})),T.roles&&W(B=>{const J={...B};return delete J.roles,J})},P=()=>{const g={day:"×¨××©×•×Ÿ",startTime:"14:00",endTime:"15:30",location:"",notes:""};d(D=>({...D,teaching:{...D.teaching,schedule:[...D.teaching.schedule,g]}}))},_=g=>{d(D=>({...D,teaching:{...D.teaching,schedule:D.teaching.schedule.filter((w,B)=>B!==g)}}))},M=(g,D,w)=>{d(B=>({...B,teaching:{...B.teaching,schedule:B.teaching.schedule.map((J,Q)=>Q===g?{...J,[D]:w}:J)}}))},re=async g=>{if(g.preventDefault(),!!E()){F(!0),j("");try{const D={personalInfo:m.personalInfo,roles:m.roles,professionalInfo:m.professionalInfo,teaching:{studentIds:[],schedule:m.teaching.schedule.map(w=>({day:w.day,startTime:w.startTime,endTime:w.endTime,duration:Ye(w.startTime,w.endTime),location:w.location||null,notes:w.notes||null,isAvailable:!0,studentId:null,recurring:{isRecurring:!0,excludeDates:[]}}))},conducting:m.conducting,ensemblesIds:m.ensemblesIds,schoolYears:n?[{schoolYearId:n._id,isActive:!0}]:[],credentials:{email:m.personalInfo.email,password:null,isInvitationAccepted:!1},isActive:!0};if(r==="edit"&&c){console.log("ğŸ”„ Updating teacher:",D);const w=await K.teachers.updateTeacher(c._id,D);console.log("âœ… Teacher updated successfully:",w),o(w)}else{console.log("ğŸ”„ Creating teacher:",D);const w=await K.teachers.addTeacher(D);console.log("âœ… Teacher created successfully:",w),o(w)}l(),s()}catch(D){console.error(`âŒ Failed to ${r==="edit"?"update":"create"} teacher:`,D),j(D.message||`×©×’×™××” ×‘${r==="edit"?"×¢×“×›×•×Ÿ":"×™×¦×™×¨×ª"} ×”××•×¨×”. × ×¡×” ×©×•×‘.`)}finally{F(!1)}}},l=()=>{d({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),b("personal"),W({}),j("")},y=()=>{l(),s()};if(!t)return null;const U=[{id:"personal",label:"××™×“×¢ ××™×©×™",icon:de},{id:"professional",label:"××™×“×¢ ××§×¦×•×¢×™",icon:Wt},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:ae},{id:"conducting",label:"× ×™×¦×•×—",icon:Fe}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[85vh] overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r==="edit"?"×¢×¨×™×›×ª ×¤×¨×˜×™ ××•×¨×”":"×”×•×¡×¤×ª ××•×¨×” ×—×“×©"}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:U.map(({id:g,label:D,icon:w})=>e.jsxs("button",{onClick:()=>b(g),className:`flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${i===g?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(w,{className:"w-4 h-4"}),D]},g))})}),e.jsxs("form",{onSubmit:re,children:[e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[i==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ××œ× *"}),e.jsx("input",{type:"text",value:m.personalInfo.fullName,onChange:g=>L("personalInfo","fullName",g.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${T["personalInfo.fullName"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×”×›× ×¡ ×©× ××œ×"}),T["personalInfo.fullName"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ *"}),e.jsx("input",{type:"tel",value:m.personalInfo.phone,onChange:g=>L("personalInfo","phone",g.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${T["personalInfo.phone"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"05XXXXXXXX"}),T["personalInfo.phone"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ *"}),e.jsx("input",{type:"email",value:m.personalInfo.email,onChange:g=>L("personalInfo","email",g.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${T["personalInfo.email"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"teacher@example.com"}),T["personalInfo.email"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T["personalInfo.email"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª *"}),e.jsx("input",{type:"text",value:m.personalInfo.address,onChange:g=>L("personalInfo","address",g.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${T["personalInfo.address"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×¨×—×•×‘ ××¡×¤×¨, ×¢×™×¨"}),T["personalInfo.address"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T["personalInfo.address"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×ª×¤×§×™×“×™× *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Ns.map(g=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:m.roles.includes(g),onChange:D=>v(g,D.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 w-4 h-4"}),e.jsx("span",{className:"mr-3 text-sm text-gray-700 font-medium",children:g})]},g))}),T.roles&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T.roles})]})]}),i==="professional"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×œ×™ × ×’×™× ×” ",!m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&"*"]}),e.jsxs("select",{value:m.professionalInfo.instrument,onChange:g=>L("professionalInfo","instrument",g.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 bg-white ${T["professionalInfo.instrument"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,disabled:m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&m.roles.length===1,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),Ts.map(g=>e.jsx("option",{value:g,children:g},g))]}),T["professionalInfo.instrument"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T["professionalInfo.instrument"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.professionalInfo.isActive,onChange:g=>L("professionalInfo","isActive",g.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"××•×¨×” ×¤×¢×™×œ"})]})})]}),i==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"×‘×œ×•×§×™ ×–××Ÿ ×œ×”×•×¨××”"}),e.jsxs("button",{type:"button",onClick:P,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 ml-2"}),"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ"]})]}),m.teaching.schedule.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"×œ× ×”×•×’×“×¨×• ×‘×œ×•×§×™ ×–××Ÿ"}),e.jsx("p",{className:"text-sm",children:"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ ×›×“×™ ×œ×§×‘×•×¢ ××ª×™ ×”××•×¨×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}):e.jsx("div",{className:"space-y-4",children:m.teaching.schedule.map((g,D)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×™×•×"}),e.jsx("select",{value:g.day,onChange:w=>M(D,"day",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white",children:ws.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:g.startTime,onChange:w=>M(D,"startTime",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:g.endTime,onChange:w=>M(D,"endTime",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"}),g.startTime&&g.endTime&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const w=Ye(g.startTime,g.endTime),B=nt(g.startTime,g.endTime);return B?e.jsx("span",{className:"text-red-600",children:B}):w>0?e.jsxs("span",{className:"text-gray-500",children:["××©×š: ",w," ×“×§×•×ª"]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××™×§×•×"}),e.jsxs("select",{value:g.location,onChange:w=>M(D,"location",w.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white ${T[`schedule.${D}.location`]?"border-red-300 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×..."}),Ve.map(w=>e.jsx("option",{value:w,children:w},w))]}),T[`schedule.${D}.location`]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T[`schedule.${D}.location`]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×”×¢×¨×•×ª"}),e.jsx("input",{type:"text",value:g.notes,onChange:w=>M(D,"notes",w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500 bg-white",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>_(D),className:"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(Be,{className:"w-4 h-4 ml-1"}),"×”×¡×¨"]})})]},D))})]}),i==="conducting"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×ª×–××•×¨×•×ª ×œ× ×™×¦×•×—"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×ª×–××•×¨×•×ª ×©×”××•×¨×” ×™× ×¦×—"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:h.map(g=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-purple-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.conducting.orchestraIds.includes(g._id),onChange:D=>{const w=D.target.checked?[...m.conducting.orchestraIds,g._id]:m.conducting.orchestraIds.filter(B=>B!==g._id);L("conducting","orchestraIds",w)},className:"rounded-lg border-gray-300 text-purple-600 focus:ring-purple-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-purple-700 transition-colors",children:g.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:g.description||"×ª×–××•×¨×ª ×œ×œ× ×ª×™××•×¨"}),g.memberCount&&e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["ğŸ‘¥ ",g.memberCount," ×—×‘×¨×™×"]})]})]},g._id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×× ×¡××‘×œ×™× ×œ×”×“×¨×›×”"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×× ×¡××‘×œ×™× ×©×”××•×¨×” ×™×“×¨×™×š"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:O.map(g=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.ensemblesIds.includes(g._id),onChange:D=>{const w=D.target.checked?[...m.ensemblesIds,g._id]:m.ensemblesIds.filter(B=>B!==g._id);d(B=>({...B,ensemblesIds:w}))},className:"rounded-lg border-gray-300 text-green-600 focus:ring-green-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-green-700 transition-colors",children:g.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:g.description||"×× ×¡××‘×œ ×œ×œ× ×ª×™××•×¨"}),g.memberCount&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ğŸµ ",g.memberCount," ×—×‘×¨×™×"]})]})]},g._id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200",children:[x&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:x})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:$,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:$,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[$?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),$?"×©×•××¨...":r==="edit"?"×¢×“×›×Ÿ ××•×¨×”":"×©××•×¨ ××•×¨×”"]})]})]})]})]})})};function Ss({theoryLesson:t,theoryLessons:s,teachers:o,onSubmit:c,onCancel:r,mode:n="create"}){const[i,b]=u.useState("single"),[m,d]=u.useState({category:"××’××”",teacherId:"",date:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],attendance:{present:[],absent:[]},notes:"",syllabus:"",homework:"",schoolYearId:""}),[h,S]=u.useState({category:"××’××”",teacherId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:"",syllabus:"",excludeDates:[],schoolYearId:""}),[O,k]=u.useState(o||[]),[$,F]=u.useState(!1),[T,W]=u.useState(!1),[x,j]=u.useState(""),[I,A]=u.useState(""),E=["×ª×œ××™×“×™× ×—×“×©×™× ×‘-×“","××ª×—×™×œ×™×","××ª×—×™×œ×™× ×‘","××ª×—×™×œ×™× ×“","××ª×§×“××™× ×‘","××ª×§×“××™× ×","××ª×§×“××™× ×’","×ª×œ××™×“×™× ×—×“×©×™× ×‘×•×’×¨×™× (×” - ×˜)","×ª×œ××™×“×™× ×—×“×©×™× ×¦×¢×™×¨×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×§×œ××¡×™ ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×‘","××’××”","×ª××•×¨×™×” ×›×œ×™"],L={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"};u.useEffect(()=>{o||v(),P()},[o]),u.useEffect(()=>{if(n==="edit"&&t){const l=new Date(t.date);d({category:t.category||"××’××”",teacherId:t.teacherId||"",date:t.date?new Date(t.date).toISOString().split("T")[0]:"",dayOfWeek:t.dayOfWeek!==void 0?t.dayOfWeek:l.getDay(),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||"××•×œ× ×¢×¨×Ÿ",studentIds:t.studentIds||[],attendance:t.attendance||{present:[],absent:[]},notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||""}),S(y=>({...y,category:t.category||"××’××”",teacherId:t.teacherId||"",location:t.location||"××•×œ× ×¢×¨×Ÿ",startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",notes:t.notes||"",syllabus:t.syllabus||"",schoolYearId:t.schoolYearId||""}))}else if(n==="bulk-edit"&&s&&s.length>0){const l=s[0],y=s.every(Q=>Q.category===l.category)?l.category:"",U=s.every(Q=>Q.teacherId===l.teacherId)?l.teacherId:"",g=s.every(Q=>Q.location===l.location)?l.location:"",D=s.every(Q=>Q.startTime===l.startTime)?l.startTime:"",w=s.every(Q=>Q.endTime===l.endTime)?l.endTime:"",B=s.every(Q=>Q.notes===l.notes)?l.notes:"",J=s.every(Q=>Q.syllabus===l.syllabus)?l.syllabus:"";S({category:y||"××’××”",teacherId:U||"",startDate:"",endDate:"",dayOfWeek:0,startTime:D||"14:00",endTime:w||"15:00",location:g||"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:B||"",syllabus:J||"",excludeDates:[],schoolYearId:l.schoolYearId||""})}},[t,s,n]);const v=async()=>{try{const y=(await Ft.getTeachers()).filter(U=>U.roles&&U.roles.includes("××•×¨×” ×ª××•×¨×™×”"));k(y)}catch(l){console.error("Error loading teachers:",l)}},P=async()=>{try{const l=await Mt.getCurrentSchoolYear();l&&(m.schoolYearId||d(y=>({...y,schoolYearId:l._id})),h.schoolYearId||S(y=>({...y,schoolYearId:l._id})))}catch(l){console.error("Error loading current school year:",l)}},_=(l,y)=>{if(n==="edit"||n==="create"&&i==="single"){if(d(U=>({...U,[l]:y})),l==="date"&&y){const g=new Date(y).getDay();d(D=>({...D,date:y,dayOfWeek:g}))}}else S(U=>({...U,[l]:y}))},M=()=>{if(i==="single"){if(!m.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨"),!1;if(!m.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨"),!1;if(!m.date)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ×©×™×¢×•×¨"),!1;if(!m.startTime||!m.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!m.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨"),!1;const l=m.startTime.split(":").map(Number),y=m.endTime.split(":").map(Number),U=l[0]*60+l[1];if(y[0]*60+y[1]<=U)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}else{if(!h.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.startDate||!h.endDate)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×›×™ ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.startTime||!h.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨×™×"),!1;if(h.dayOfWeek<0||h.dayOfWeek>6)return j("×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),!1;if(!h.schoolYearId)return j("×™×© ×œ×‘×—×•×¨ ×©× ×ª ×œ×™××•×“×™×"),!1;if(new Date(h.endDate)<=new Date(h.startDate))return j("×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),!1;const l=h.startTime.split(":").map(Number),y=h.endTime.split(":").map(Number),U=l[0]*60+l[1];if(y[0]*60+y[1]<=U)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}return!0},re=async l=>{if(l.preventDefault(),j(""),A(""),!!M()){F(!0);try{if(n==="edit"){const y={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"edit",lessonId:t?._id};await c(y),A("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”")}else if(n==="bulk-edit"){const y={};h.category&&h.category.trim()&&(y.category=h.category),h.teacherId&&h.teacherId.trim()&&(y.teacherId=h.teacherId),h.location&&h.location.trim()&&(y.location=h.location),h.startTime&&h.startTime.trim()&&(y.startTime=h.startTime),h.endTime&&h.endTime.trim()&&(y.endTime=h.endTime),h.notes&&h.notes.trim()&&(y.notes=h.notes),h.syllabus&&h.syllabus.trim()&&(y.syllabus=h.syllabus);const U={mode:"bulk-edit",lessonIds:s?.map(g=>g._id)||[],updateData:y};await c(U),A(`${s?.length||0} ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”`)}else if(i==="single"){const y={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"create"};await c(y),A("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}else{const y={...h,isBulk:!0,mode:"bulk-create"};console.log("ğŸš€ Bulk theory lesson creation data:",JSON.stringify(y,null,2));const g=["category","teacherId","startDate","endDate","dayOfWeek","startTime","endTime","location","schoolYearId"].filter(D=>{const w=y[D];return w==null||typeof w=="string"&&w.trim()===""});if(g.length>0){console.error("âŒ Missing required fields:",g),j(`×—×¡×¨×™× ×©×“×•×ª ×—×•×‘×”: ${g.join(", ")}`);return}await c(y),A("×¨×¦×£ ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}}catch(y){console.error("Error submitting theory lesson form:",y),j(y.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×©×™×¢×•×¨")}finally{F(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n==="edit"?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":n==="bulk-edit"?"×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”":"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(me,{className:"w-5 h-5 text-gray-500"})})]}),n==="create"&&e.jsxs("div",{className:"flex space-x-4 rtl:space-x-reverse",children:[e.jsxs("button",{type:"button",onClick:()=>b("single"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${i==="single"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ae,{className:"w-4 h-4 ml-2"}),"×©×™×¢×•×¨ ×‘×•×“×“"]}),e.jsxs("button",{type:"button",onClick:()=>b("bulk"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${i==="bulk"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ht,{className:"w-4 h-4 ml-2"}),"×¨×¦×£ ×©×™×¢×•×¨×™×"]})]}),n==="bulk-edit"&&s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600 ml-2"}),e.jsxs("p",{className:"text-blue-800",children:["×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ",s.length," ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"]})]}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"×©×“×•×ª ×¨×™×§×™× ×™×™×©××¨×• ×œ×œ× ×©×™× ×•×™, ×¨×§ ×©×“×•×ª ×©×™××•×œ××• ×™×¢×•×“×›× ×•"})]})]}),e.jsxs("form",{onSubmit:re,className:"p-6 space-y-6",children:[T&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 ml-2"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×™×¢×•×¨..."})]})}),I&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800 text-sm",children:I})}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:x})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ne,{className:"w-4 h-4 inline ml-1"}),"×§×˜×’×•×¨×™×” *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&i==="single"?m.category:h.category,onChange:l=>_("category",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),E.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××•×¨×” *"}),e.jsxs("select",{value:n==="edit"||n==="create"&&i==="single"?m.teacherId:h.teacherId,onChange:l=>_("teacherId",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[e.jsx("option",{value:"",children:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™":"×‘×—×¨ ××•×¨×”"}),O.map(l=>e.jsx("option",{value:l._id,children:l.personalInfo?.fullName},l._id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&i==="single"?m.location:h.location,onChange:l=>_("location",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),Ve.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),n==="edit"||n==="create"&&i==="single"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š *"}),e.jsx("input",{type:"date",value:m.date,onChange:l=>_("date",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("input",{type:"text",value:L[m.dayOfWeek]||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:m.startTime,onChange:l=>_("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:m.endTime,onChange:l=>_("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]}):n==="bulk-edit"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:l=>_("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:h.endTime,onChange:l=>_("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×”×ª×—×œ×” *"}),e.jsx("input",{type:"date",value:h.startDate,onChange:l=>_("startDate",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•× *"}),e.jsx("input",{type:"date",value:h.endDate,onChange:l=>_("endDate",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:h.dayOfWeek,onChange:l=>_("dayOfWeek",parseInt(l.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0,children:Object.entries(L).map(([l,y])=>e.jsx("option",{value:l,children:y},l))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:l=>_("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:h.endTime,onChange:l=>_("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×™×œ×‘×•×¡"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&i==="single"?m.syllabus:h.syllabus,onChange:l=>_("syllabus",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - × ×•×©××™ ×”×©×™×¢×•×¨...":n==="edit"||i==="single"?"× ×•×©××™ ×”×©×™×¢×•×¨...":"× ×•×©××™ ×”×©×™×¢×•×¨×™×..."})]}),n==="edit"||n==="create"&&i==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨×™ ×‘×™×ª"}),e.jsx("textarea",{value:m.homework,onChange:l=>_("homework",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"××©×™××•×ª ×œ×‘×™×ª..."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&i==="single"?m.notes:h.notes,onChange:l=>_("notes",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª...":"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:$,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:$,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[$?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),n==="edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨":n==="bulk-edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨×™×":i==="single"?"×¦×•×¨ ×©×™×¢×•×¨":"×¦×•×¨ ×¨×¦×£ ×©×™×¢×•×¨×™×"]})]})]})]})})}const Tt={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"},ks=Object.entries(Tt).map(([t,s])=>({value:parseInt(t),label:s})),qe=t=>Tt[t]||"×œ× ×™×“×•×¢",Ds=t=>{const s=new Date(t.date).toLocaleDateString("he-IL"),o=`${t.startTime} - ${t.endTime}`,c=qe(t.dayOfWeek),r=`${c}, ${s} ${o}`;return{date:s,time:o,dayName:c,fullDateTime:r}},De=(t,s)=>{const o=ce(t);return ce(s)-o},ce=t=>{const[s,o]=t.split(":").map(Number);return s*60+o},lt=t=>{const s=t.attendance?.present?.length||0,o=t.attendance?.absent?.length||0,c=t.orchestra?.memberIds?.length||s+o,r=c>0?Math.round(s/c*100):0;return{presentCount:s,absentCount:o,totalMembers:c,attendanceRate:r,hasAttendanceData:s>0||o>0}},Cs=t=>{if(!t.isActive)return{status:"cancelled",text:"×‘×•×˜×œ×”",colorClass:"bg-gray-100 text-gray-800"};const s=new Date;new Date(t.date);const o=new Date(`${t.date}T${t.startTime}:00`),c=new Date(`${t.date}T${t.endTime}:00`);return s<o?{status:"upcoming",text:"×¢×ª×™×“×”",colorClass:"bg-blue-100 text-blue-800"}:s>=o&&s<=c?{status:"in_progress",text:"××ª×§×™×™××ª ×›×¢×ª",colorClass:"bg-green-100 text-green-800"}:{status:"completed",text:"×”×¡×ª×™×™××”",colorClass:"bg-orange-100 text-orange-800"}},ot=(t,s)=>{if(t.date!==s.date)return{hasConflict:!1,conflictType:"none",severity:"none",message:""};if(t.groupId===s.groupId)return{hasConflict:!1,conflictType:"none",severity:"none",message:"××•×ª×” ×ª×–××•×¨×ª"};const o=ce(t.startTime),c=ce(t.endTime),r=ce(s.startTime),n=ce(s.endTime);if(o<n&&r<c){if(t.location===s.location)return{hasConflict:!0,conflictType:"location",severity:"critical",message:`×—×¤×™×¤×” ×‘××™×§×•×: ${t.location}`};const b=t.orchestra?.conductor?._id,m=s.orchestra?.conductor?._id;if(b&&m&&b===m)return{hasConflict:!0,conflictType:"conductor",severity:"critical",message:"××•×ª×• ×× ×¦×— ×‘×©× ×™ ××§×•××•×ª"};const d=new Set(t.orchestra?.memberIds||[]),h=new Set(s.orchestra?.memberIds||[]),S=[...d].filter(O=>h.has(O));return S.length>0?{hasConflict:!0,conflictType:"members",severity:"warning",message:`${S.length} ×—×‘×¨×™× ××©×•×ª×¤×™×`}:{hasConflict:!0,conflictType:"time",severity:"warning",message:"×—×¤×™×¤×ª ×–×× ×™×"}}return{hasConflict:!1,conflictType:"none",severity:"none",message:""}},jr=(t,s)=>t.filter(o=>{if(s.searchQuery){const c=s.searchQuery.toLowerCase();if(!(o.orchestra?.name?.toLowerCase().includes(c)||o.location?.toLowerCase().includes(c)||o.notes?.toLowerCase().includes(c)||qe(o.dayOfWeek).toLowerCase().includes(c)))return!1}if(s.orchestraId&&o.groupId!==s.orchestraId||s.type&&o.type!==s.type||s.dayOfWeek!==""&&s.dayOfWeek!==void 0&&o.dayOfWeek!==s.dayOfWeek||s.location&&o.location!==s.location)return!1;if(s.startDate){const c=new Date(o.date),r=new Date(s.startDate);if(c<r)return!1}if(s.endDate){const c=new Date(o.date),r=new Date(s.endDate);if(c>r)return!1}return!(s.status&&s.status!=="all"&&Cs(o).status!==s.status||s.isActive!==void 0&&o.isActive!==s.isActive)}),vr=(t,s="date",o="asc")=>[...t].sort((r,n)=>{let i=0;switch(s){case"date":i=new Date(r.date).getTime()-new Date(n.date).getTime();break;case"time":i=ce(r.startTime)-ce(n.startTime);break;case"orchestra":const b=r.orchestra?.name||"",m=n.orchestra?.name||"";i=b.localeCompare(m,"he");break;case"location":i=r.location.localeCompare(n.location,"he");break;case"attendance":const d=lt(r).attendanceRate,h=lt(n).attendanceRate;i=d-h;break;case"duration":const S=De(r.startTime,r.endTime),O=De(n.startTime,n.endTime);i=S-O;break;default:i=0}return o==="desc"?-i:i}),Es=t=>{const s=[],o=new Date(t.startDate),c=new Date(t.endDate),r=t.dayOfWeek,n=new Set(t.excludeDates||[]),i=new Date(o);for(;i.getDay()!==r&&i<=c;)i.setDate(i.getDate()+1);for(;i<=c;){const b=i.toISOString().split("T")[0];n.has(b)||s.push(b),i.setDate(i.getDate()+7)}return s},_s=t=>{const s={};if(t.groupId?.trim()||(s.groupId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.type||(s.type="×™×© ×œ×‘×—×•×¨ ×¡×•×’ ×”×¨×›×‘"),!t.date)s.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const o=new Date(t.date),c=new Date;c.setHours(0,0,0,0),o<c&&(s.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime){const o=De(t.startTime,t.endTime);o<=0?s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":o>300&&(s.endTime="××©×š ×”×—×–×¨×” ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-5 ×©×¢×•×ª")}return t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},As=t=>{const s={};if(t.orchestraId?.trim()||(s.orchestraId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.startDate||(s.startDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×”×ª×—×œ×”"),t.endDate||(s.endDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×¡×™×•×"),t.startDate&&t.endDate){const o=new Date(t.startDate),c=new Date(t.endDate);o>=c&&(s.endDate="×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),(c.getTime()-o.getTime())/(1e3*60*60*24)>365&&(s.endDate="×ª×§×•×¤×” ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×™×•×ª×¨ ××©× ×”")}return(t.dayOfWeek===void 0||t.dayOfWeek<0||t.dayOfWeek>6)&&(s.dayOfWeek="×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime&&De(t.startTime,t.endTime)<=0&&(s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},Nr=t=>{switch(t.orchestra?.type||t.type){case"×ª×–××•×¨×ª":return"bg-blue-500";case"×”×¨×›×‘":return"bg-pink-500";default:return"bg-gray-500"}};function Rs({newRehearsal:t,bulkData:s,existingRehearsals:o,orchestras:c,onConflictsChanged:r}){const[n,i]=u.useState([]),[b,m]=u.useState(!1);u.useEffect(()=>{t||s?d():i([])},[t,s,o]),u.useEffect(()=>{r?.(n)},[n,r]);const d=async()=>{m(!0);try{let x=[];t?x=await h(t):s&&(x=await S(s)),i(x)}catch(x){console.error("Error detecting conflicts:",x)}finally{m(!1)}},h=async x=>{const j=[],I={_id:"temp",groupId:x.groupId,type:x.type,date:x.date,dayOfWeek:new Date(x.date).getDay(),startTime:x.startTime,endTime:x.endTime,location:x.location,attendance:{present:[],absent:[]},notes:x.notes||"",schoolYearId:"current",isActive:x.isActive,orchestra:c.find(A=>A._id===x.groupId)};for(const A of o){if(A.groupId===x.groupId&&A.date===x.date)continue;const E=ot(I,A);E.hasConflict&&j.push({...E,conflictingRehearsal:A,affectedDate:x.date})}return j},S=async x=>{const j=[],I=O(x),A=c.find(E=>E._id===x.orchestraId);for(const E of I){const L={_id:"temp",groupId:x.orchestraId,type:A?.type||"×ª×–××•×¨×ª",date:E,dayOfWeek:new Date(E).getDay(),startTime:x.startTime,endTime:x.endTime,location:x.location,attendance:{present:[],absent:[]},notes:x.notes||"",schoolYearId:x.schoolYearId,isActive:!0,orchestra:A};for(const v of o){if(v.groupId===x.orchestraId&&v.date===E)continue;const P=ot(L,v);P.hasConflict&&j.push({...P,conflictingRehearsal:v,affectedDate:E})}}return j},O=x=>{const j=[],I=new Date(x.startDate),A=new Date(x.endDate),E=x.dayOfWeek,L=new Set(x.excludeDates||[]),v=new Date(I);for(;v.getDay()!==E&&v<=A;)v.setDate(v.getDate()+1);for(;v<=A;){const P=v.toISOString().split("T")[0];L.has(P)||j.push(P),v.setDate(v.getDate()+7)}return j},k=x=>{switch(x){case"critical":return e.jsx(Ze,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(et,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(ke,{className:"w-5 h-5 text-green-600"})}},$=x=>{switch(x){case"location":return e.jsx(ve,{className:"w-4 h-4"});case"conductor":return e.jsx(de,{className:"w-4 h-4"});case"members":return e.jsx(oe,{className:"w-4 h-4"});case"time":return e.jsx(le,{className:"w-4 h-4"});default:return e.jsx(ke,{className:"w-4 h-4"})}},F=x=>{switch(x){case"critical":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-green-50 border-green-200 text-green-800"}},T=n.filter(x=>x.severity==="critical"),W=n.filter(x=>x.severity==="warning");return b?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"×‘×•×“×§ ×”×ª× ×’×©×•×™×•×ª..."})]})}):n.length===0&&(t||s)?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"w-5 h-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-sm text-green-800",children:"×œ× × ××¦××• ×”×ª× ×’×©×•×™×•×ª - × ×™×ª×Ÿ ×œ×™×¦×•×¨ ××ª ×”×—×–×¨×”"})]})}):n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"×¡×™×›×•× ×”×ª× ×’×©×•×™×•×ª"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[T.length>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(Ze,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[T.length," ×§×¨×™×˜×™×•×ª"]})]}),W.length>0&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(et,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[W.length," ××–×”×¨×•×ª"]})]})]})]}),T.length>0&&e.jsx("p",{className:"text-sm text-red-800",children:"× ××¦××• ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×©××•× ×¢×•×ª ×™×¦×™×¨×ª ×”×—×–×¨×”. ×™×© ×œ×¤×ª×•×¨ ××•×ª×Ÿ ×œ×¤× ×™ ×”××©×š."}),W.length>0&&T.length===0&&e.jsx("p",{className:"text-sm text-yellow-800",children:"× ××¦××• ××–×”×¨×•×ª ×©×›×“××™ ×œ×‘×“×•×§. × ×™×ª×Ÿ ×œ×”××©×™×š ×‘×™×¦×™×¨×ª ×”×—×–×¨×” ××š ××•××œ×¥ ×œ×•×•×“×."})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n.map((x,j)=>e.jsx("div",{className:`border rounded-lg p-3 ${F(x.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-2",children:[k(x.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[$(x.conflictType),e.jsx("span",{className:"font-medium text-sm",children:x.message})]}),x.conflictingRehearsal&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:x.conflictingRehearsal.orchestra?.name}),e.jsx("span",{children:Ds(x.conflictingRehearsal).fullDateTime}),e.jsx("span",{children:x.conflictingRehearsal.location})]})}),x.affectedDate&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["×ª××¨×™×š ××ª× ×’×©: ",new Date(x.affectedDate).toLocaleDateString("he-IL")]})]})]})})},j))}),T.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"×¤×¢×•×œ×•×ª ××•××œ×¦×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[T.some(x=>x.conflictType==="location")&&e.jsx("li",{children:"×©× ×” ××ª ××™×§×•× ×”×—×–×¨×” ××• ×‘×—×¨ ×–××Ÿ ××—×¨"}),T.some(x=>x.conflictType==="conductor")&&e.jsx("li",{children:"×ª×× ×¢× ×”×× ×¦×— ××• ×©× ×” ××ª ×–××Ÿ ×”×—×–×¨×”"}),T.some(x=>x.conflictType==="time")&&e.jsx("li",{children:"×‘×—×¨ ×–××Ÿ ××—×¨ ××• ×ª××¨×™×š ××—×¨"})]})]})]})}function Os({orchestras:t,existingRehearsals:s=[],onSubmit:o,onCancel:c,initialData:r}){const[n,i]=u.useState("single"),[b,m]=u.useState(!1),[d,h]=u.useState({}),[S,O]=u.useState({groupId:"",type:"×ª×–××•×¨×ª",date:"",startTime:"19:00",endTime:"21:00",location:"",notes:"",isActive:!0,...r}),[k,$]=u.useState({orchestraId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"19:00",endTime:"21:00",location:"",notes:"",excludeDates:[],schoolYearId:"current"}),[F,T]=u.useState(""),[W,x]=u.useState([]),[j,I]=u.useState(!1),[A,E]=u.useState(!1);u.useEffect(()=>{if(n==="single"&&S.groupId){const l=t.find(y=>y._id===S.groupId);l&&!S.location&&O(y=>({...y,location:l.location,type:l.type}))}},[S.groupId,t,n]),u.useEffect(()=>{if(n==="bulk"&&k.orchestraId){const l=t.find(y=>y._id===k.orchestraId);l&&!k.location&&$(y=>({...y,location:l.location}))}},[k.orchestraId,t,n]),u.useEffect(()=>{if(n==="bulk"&&k.startDate&&k.endDate&&k.dayOfWeek!==void 0)try{const l=Es(k);x(l)}catch{x([])}else x([])},[n,k.startDate,k.endDate,k.dayOfWeek,k.excludeDates]);const L=(l,y)=>{O(U=>({...U,[l]:y})),d[l]&&h(U=>({...U,[l]:""}))},v=(l,y)=>{$(U=>({...U,[l]:y})),d[l]&&h(U=>({...U,[l]:""}))},P=()=>{F&&($(l=>({...l,excludeDates:[...l.excludeDates||[],F]})),T(""))},_=l=>{$(y=>({...y,excludeDates:(y.excludeDates||[]).filter(U=>U!==l)}))},M=l=>{I(l.length>0),E(l.some(y=>y.severity==="critical"))},re=async l=>{l.preventDefault(),m(!0),h({});try{if(A){h({submit:"×™×© ×œ×¤×ª×•×¨ ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×œ×¤× ×™ ×™×¦×™×¨×ª ×”×—×–×¨×”"});return}if(n==="single"){const y=_s(S);if(!y.isValid){h(y.errors);return}const g=new Date(S.date).getDay(),D={...S,dayOfWeek:g};await o(D,!1)}else{const y=As(k);if(!y.isValid){h(y.errors);return}await o(k,!0)}}catch(y){h({submit:y.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×—×–×¨×”"})}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:c,children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r?"×¢×¨×•×š ×—×–×¨×”":"×—×–×¨×” ×—×“×©×”"}),!r&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>i("single"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×” ×™×—×™×“×”"}),e.jsx("button",{type:"button",onClick:()=>i("bulk"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="bulk"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×•×ª ×—×•×–×¨×•×ª"})]})})]}),e.jsx("div",{className:"w-8"})]}),e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[n==="single"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:S.groupId||"",onChange:l=>L("groupId",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.groupId?"border-red-300":"border-gray-300"}`,disabled:!!r,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(l=>e.jsxs("option",{value:l._id,children:[l.name," (",l.type,")"]},l._id))]}),d.groupId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.groupId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š"]}),e.jsx("input",{type:"date",value:S.date||"",onChange:l=>L("date",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.date?"border-red-300":"border-gray-300"}`}),d.date&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:S.startTime||"",onChange:l=>L("startTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startTime?"border-red-300":"border-gray-300"}`}),d.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:S.endTime||"",onChange:l=>L("endTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endTime?"border-red-300":"border-gray-300"}`}),d.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:S.location||"",onChange:l=>L("location",l.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`}),d.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:S.notes||"",onChange:l=>L("notes",l.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×”×—×–×¨×”...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:k.orchestraId||"",onChange:l=>v("orchestraId",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.orchestraId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(l=>e.jsxs("option",{value:l._id,children:[l.name," (",l.type,")"]},l._id))]}),d.orchestraId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.orchestraId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š ×”×ª×—×œ×”"]}),e.jsx("input",{type:"date",value:k.startDate||"",onChange:l=>v("startDate",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startDate?"border-red-300":"border-gray-300"}`}),d.startDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•×"}),e.jsx("input",{type:"date",value:k.endDate||"",onChange:l=>v("endDate",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endDate?"border-red-300":"border-gray-300"}`}),d.endDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endDate})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("select",{value:k.dayOfWeek||0,onChange:l=>v("dayOfWeek",parseInt(l.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.dayOfWeek?"border-red-300":"border-gray-300"}`,children:ks.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),d.dayOfWeek&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.dayOfWeek})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:k.startTime||"",onChange:l=>v("startTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startTime?"border-red-300":"border-gray-300"}`}),d.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:k.endTime||"",onChange:l=>v("endTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endTime?"border-red-300":"border-gray-300"}`}),d.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:k.location||"",onChange:l=>v("location",l.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`}),d.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×›×™× ×œ×“×™×œ×•×’"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:F,onChange:l=>T(l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"×‘×—×¨ ×ª××¨×™×š ×œ×“×™×œ×•×’"}),e.jsx("button",{type:"button",onClick:P,disabled:!F,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(xe,{className:"w-4 h-4"})})]}),k.excludeDates&&k.excludeDates.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:k.excludeDates.map(l=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg px-2 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:new Date(l).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",onClick:()=>_(l),className:"mr-1 text-gray-500 hover:text-red-600",children:e.jsx(zt,{className:"w-3 h-3"})})]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:k.notes||"",onChange:l=>v("notes",l.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ×”×—×–×¨×•×ª...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),W.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-blue-600 ml-1"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["×ª×™×•×•×¦×¨×• ",W.length," ×—×–×¨×•×ª"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 max-h-32 overflow-y-auto",children:[W.slice(0,10).map(l=>e.jsxs("div",{children:[new Date(l).toLocaleDateString("he-IL")," - ",qe(new Date(l).getDay())]},l)),W.length>10&&e.jsxs("div",{className:"text-blue-600",children:["...×•×¢×•×“ ",W.length-10]})]})]})]}),e.jsx(Rs,{newRehearsal:n==="single"?S:null,bulkData:n==="bulk"?k:null,existingRehearsals:s,orchestras:t,onConflictsChanged:M}),d.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:d.submit})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:b||A,className:`px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors ${b||A?"opacity-50 cursor-not-allowed":""}`,children:b?"×©×•××¨...":r?"×¢×“×›×Ÿ ×—×–×¨×”":n==="single"?"×¦×•×¨ ×—×–×¨×”":`×¦×•×¨ ${W.length} ×—×–×¨×•×ª`})]})]})]})})})}const Ps=[{name:"××™×“×¢ ×›×œ×œ×™",href:"/dashboard",icon:we,category:"general"},{name:"×ª×œ××™×“×™×",href:"/students",icon:oe,category:"management",roles:["admin"]},{name:"××•×¨×™×",href:"/teachers",icon:xt,category:"management",roles:["admin"]},{name:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:Ne,category:"management",roles:["admin"]},{name:"×ª×–××•×¨×•×ª",href:"/orchestras",icon:Ee,category:"management",roles:["admin"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:ae,category:"management",roles:["admin"]},{name:"×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"management",roles:["admin"]},{name:"× ×•×›×—×•×ª",href:"/teachers",icon:_e,category:"operations",roles:["admin"]},{name:"×”×’×“×¨×•×ª",href:"/settings",icon:Fe,category:"system",roles:["admin"]}],$s=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:we,category:"general"},{name:"×”×ª×œ××™×“×™× ×©×œ×™",href:"/students",icon:oe,category:"personal",roles:["teacher"]},{name:"×œ×•×— ×–×× ×™× ×©×œ×™",href:"/profile",icon:ae,category:"personal",roles:["teacher"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=attendance",icon:_e,category:"operations",roles:["teacher"]},{name:"× ×™×”×•×œ ×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"operations",roles:["teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],Ls=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:we,category:"general"},{name:"×”×ª×–××•×¨×•×ª ×©×œ×™",href:"/orchestras",icon:Ee,category:"personal",roles:["conductor"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:ae,category:"personal",roles:["conductor"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=orchestras",icon:_e,category:"operations",roles:["conductor"]},{name:"× ×™×”×•×œ ×¨×™×©×•××™×",href:"/conductor/enrollment",icon:ft,category:"operations",roles:["conductor"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],Us=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:we,category:"general"},{name:"×”×©×™×¢×•×¨×™× ×©×œ×™",href:"/theory-lessons",icon:Ne,category:"personal",roles:["theory-teacher"]},{name:"×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:oe,category:"personal",roles:["theory-teacher"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=lessons",icon:_e,category:"operations",roles:["theory-teacher"]},{name:"×ª×›× ×™×ª ×œ×™××•×“×™×",href:"/theory-lessons",icon:Gt,category:"personal",roles:["theory-teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],Bs={admin:[{name:"×”×•×¡×£ ×ª×œ××™×“ ×—×“×©",href:"/students/new",icon:oe,role:"admin"},{name:"×”×•×¡×£ ××•×¨×” ×—×“×©",href:"/teachers/new",icon:xt,role:"admin"},{name:"×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:Ne,role:"admin"},{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:ae,role:"admin"}],teacher:[{name:"×”×•×¡×£ ×©×™×¢×•×¨",href:"/profile?tab=students&action=addStudent",icon:xe,role:"teacher"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/profile?tab=attendance",icon:tt,role:"teacher"},{name:"×¦×¤×” ×‘×œ×•×— ×–×× ×™×",href:"/profile?tab=schedule",icon:le,role:"teacher"}],conductor:[{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:st,role:"conductor"},{name:"× ×”×œ ×ª×–××•×¨×ª",href:"/orchestras",icon:Ee,role:"conductor"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/profile?tab=orchestras",icon:tt,role:"conductor"}],"theory-teacher":[{name:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:st,role:"theory-teacher"},{name:"× ×”×œ ×§×‘×•×¦×•×ª",href:"/theory-lessons",icon:ft,role:"theory-teacher"},{name:"×“×¨×’ ×ª×œ××™×“×™×",href:"/theory-lessons",icon:ze,role:"theory-teacher"}]};function Fs(){const t=$t(),s=Ce(),{user:o,isLoading:c}=fe(),{isDesktopOpen:r,setIsDesktopOpen:n,isMobile:i}=Xe(),[b,m]=u.useState(""),[d,h]=u.useState(!1),[S,O]=u.useState(new Set),[k,$]=u.useState(!1),[F,T]=u.useState(!1),[W,x]=u.useState(!1),[j,I]=u.useState(!1),[A,E]=u.useState([]),[L,v]=u.useState(!1),P=N=>t.pathname===N,M=(()=>{if(!o)return[];const N=[];return o.role&&N.push(o.role),o.roles&&Array.isArray(o.roles)&&N.push(...o.roles),o.teaching?.studentIds?.length>0&&!N.includes("teacher")&&!N.includes("××•×¨×”")&&N.push("teacher"),o.conducting?.orchestraIds?.length>0&&!N.includes("conductor")&&!N.includes("×× ×¦×—")&&N.push("conductor"),[...new Set(N.map(V=>V==="theory_teacher"?"theory-teacher":V==="×× ×”×œ"?"admin":V==="××•×¨×”"?"teacher":V==="×× ×¦×—"?"conductor":V==="××•×¨×” ×ª×™××•×¨×™×”"?"theory-teacher":V))]})(),re=M.includes("admin"),l=M.length>1,y=()=>{if(re){const Y=[...Ps],X=Y.findIndex(te=>te.name==="× ×•×›×—×•×ª");if(X!==-1){let te="/teachers";M.includes("teacher")?te="/profile?tab=attendance":M.includes("conductor")?te="/profile?tab=orchestras":M.includes("theory-teacher")&&(te="/profile?tab=lessons"),Y[X]={...Y[X],href:te}}return Y}const N=new Map,V=[];return M.includes("teacher")&&V.push(...$s),M.includes("conductor")&&V.push(...Ls),M.includes("theory-teacher")&&V.push(...Us),V.forEach(Y=>{const X=Y.href;if(!N.has(X))N.set(X,Y);else{const te=N.get(X);Y.roles&&te.roles&&(te.roles=[...new Set([...te.roles,...Y.roles])])}}),Array.from(N.values())},U=()=>{const N=[],V=new Map;return M.forEach(Y=>{const X=Bs[Y];X&&X.forEach(te=>{const be=`${te.href}-${te.name}`;V.has(be)||(V.set(be,!0),N.push(te))})}),N},g=N=>{const V={general:{label:"×›×œ×œ×™",items:[]},personal:{label:"××–×•×¨ ××™×©×™",items:[]},management:{label:"× ×™×”×•×œ ××¢×¨×›×ª",items:[]},operations:{label:"×¤×¢×•×œ×•×ª",items:[]},system:{label:"××¢×¨×›×ª",items:[]}};return N.forEach(Y=>{const X=Y.category||"general";V[X]&&V[X].items.push(Y)}),Object.entries(V).filter(([Y,X])=>X.items.length>0).map(([Y,X])=>({key:Y,...X}))},D=y(),w=g(D),B=U();console.log("ğŸ“‹ Sidebar Debug:",{hasUser:!!o,isLoading:c,userRoles:M,isAdmin:re,hasMultipleRoles:l,isMobile:i,isDesktopOpen:r,isOpen:d,navigationItemsCount:D?.length||0,groupedNavigationCount:w?.length||0,quickActionsCount:B?.length||0}),u.useEffect(()=>{i||h(!1)},[i]),u.useEffect(()=>{const N=V=>{if(i&&d){const Y=document.getElementById("mobile-sidebar"),X=document.getElementById("hamburger-button");Y&&!Y.contains(V.target)&&X&&!X.contains(V.target)&&h(!1)}};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[i,d]),u.useEffect(()=>(i&&d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i,d]);const J=()=>{i&&h(!1)},Q=N=>{const V=new Set(S);V.has(N)?V.delete(N):V.add(N),O(V)},ye=N=>{switch(N){case"admin":return"×× ×”×œ";case"teacher":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"theory-teacher":return"××•×¨×” ×ª×™××•×¨×™×”";default:return N}},a=N=>{switch(N){case"admin":return"bg-red-100 text-red-700";case"teacher":return"bg-blue-100 text-blue-700";case"conductor":return"bg-green-100 text-green-700";case"theory-teacher":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},f=async(N,V)=>{J(),N==="×”×•×¡×£ ×ª×œ××™×“ ×—×“×©"?$(!0):N==="×”×•×¡×£ ××•×¨×” ×—×“×©"?T(!0):N==="×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"?x(!0):N==="×ª×–××Ÿ ×—×–×¨×”"?(await p(),I(!0)):s(V)},p=async()=>{try{v(!0);const N=await Vt.getOrchestras();E(N||[])}catch(N){console.error("Failed to load orchestras:",N),E([])}finally{v(!1)}},C=async N=>{$(!1)},R=async()=>{T(!1)},z=async N=>{x(!1)},ee=async N=>{I(!1)};return e.jsxs(e.Fragment,{children:[i&&e.jsx("button",{id:"hamburger-button",onClick:()=>h(!d),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-gray-50 transition-colors duration-200","aria-label":"Toggle menu",children:d?e.jsx(me,{className:"w-6 h-6 text-gray-600"}):e.jsx(Pe,{className:"w-6 h-6 text-gray-600"})}),!i&&!r&&e.jsx("button",{onClick:()=>n(!0),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200","aria-label":"Open sidebar",children:e.jsx(Pe,{className:"w-5 h-5 text-indigo-600"})}),i&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[50] transition-opacity duration-300",onClick:()=>h(!1)}),e.jsxs("div",{id:"sidebar",className:`fixed top-0 right-0 w-[280px] h-screen bg-white border-l border-gray-200 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.1)] rtl z-[55] transition-transform duration-300 ease-in-out flex flex-col ${i?d?"translate-x-0":"translate-x-full":r?"translate-x-0":"translate-x-full"}`,children:[!i&&e.jsx("button",{onClick:()=>n(!r),className:"absolute top-4 left-4 p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200 z-10","aria-label":"Toggle sidebar",children:r?e.jsx(me,{className:"w-5 h-5 text-gray-600"}):e.jsx(Pe,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("div",{className:"p-4 border-b border-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Xt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×©...",value:b,onChange:N=>m(N.target.value),className:"w-full pr-10 pl-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm font-reisinger-yonatan text-right rtl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),l&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(N=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a(N)}`,children:[e.jsx(qt,{className:"w-3 h-3"}),ye(N)]},N))})}),e.jsx("nav",{className:"flex-1 px-3 py-4 overflow-y-auto overflow-x-hidden min-h-0 custom-scrollbar",children:c?e.jsx("div",{className:"space-y-2 px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})}):e.jsxs(e.Fragment,{children:[w.map((N,V)=>e.jsxs("div",{className:V>0?"mt-6":"",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("button",{onClick:()=>Q(N.key),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700 transition-colors",children:[e.jsx("span",{children:N.label}),e.jsx(ie,{className:`w-3 h-3 transition-transform ${S.has(N.key)?"rotate-180":""}`})]})}),!S.has(N.key)&&e.jsx("div",{className:"space-y-1",children:N.items.map(Y=>{const X=Y.icon,te=P(Y.href);return e.jsxs(ue,{to:Y.href,onClick:J,className:`flex items-center justify-between px-4 py-3 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan ${te?"bg-primary-50 text-primary-700 border border-primary-200":"text-gray-600 hover:bg-gray-50 hover:text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:Y.name}),l&&Y.roles&&Y.roles.length===1&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${a(Y.roles[0])}`,children:ye(Y.roles[0])})]}),e.jsx(X,{className:"w-4 h-4 flex-shrink-0"})]},`${N.key}-${Y.href}-${Y.name}`)})})]},N.key)),B.length>0&&e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-6 mt-6",children:[e.jsx("h3",{className:"px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),B.map(N=>{const V=N.icon;return e.jsxs("button",{onClick:()=>f(N.name,N.href),className:"w-full flex items-center justify-between px-4 py-2 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan text-gray-600 hover:bg-green-50 hover:text-green-700 group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:N.name}),l&&N.role&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${a(N.role)}`,children:ye(N.role)})]}),e.jsxs("div",{className:"flex items-center space-x-1 space-x-reverse",children:[e.jsx(xe,{className:"w-3 h-3 group-hover:text-green-500"}),e.jsx(V,{className:"w-3.5 h-3.5"})]})]},`${N.href}-${N.name}-${N.role}`)})]})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(vs,{onSubmit:C,onCancel:()=>$(!1),isEdit:!1,initialData:null})})}),F&&e.jsx(Is,{isOpen:F,onClose:()=>T(!1),onSuccess:R}),W&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Ss,{onSubmit:z,onCancel:()=>x(!1)})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:L?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×ª×–××•×¨×•×ª..."})]}):e.jsx(Os,{orchestras:A,onSubmit:ee,onCancel:()=>I(!1)})})})]})}function Ms(){const[t,s]=u.useState(!1),o=u.useRef(null),{currentSchoolYear:c,schoolYears:r,isLoading:n,setCurrentSchoolYearById:i,getSchoolYearDisplayName:b}=vt();u.useEffect(()=>{const d=h=>{o.current&&!o.current.contains(h.target)&&s(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const m=async d=>{await i(d),s(!1)};return n?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]}):e.jsxs("div",{className:"relative",ref:o,children:[e.jsxs("button",{onClick:()=>s(!t),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 ease-in-out min-w-[200px]",style:{direction:"rtl"},children:[e.jsx(ae,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan flex-grow text-right truncate",children:c?b(c):"×‘×—×¨ ×©× ×ª ×œ×™××•×“"}),t?e.jsx(ge,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}):e.jsx(ie,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-full min-w-[250px] bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide font-reisinger-yonatan text-right",children:"×©× ×•×ª ×œ×™××•×“"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:r.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 font-reisinger-yonatan text-center",children:"×œ× × ××¦××• ×©× ×•×ª ×œ×™××•×“"}):r.sort((d,h)=>new Date(h.startDate).getTime()-new Date(d.startDate).getTime()).map(d=>{const h=c?._id===d._id,S=d.isCurrent,O=d.isActive;return e.jsxs("button",{onClick:()=>m(d._id),className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${h?"bg-indigo-50 border-l-4 border-indigo-500":""}`,style:{direction:"rtl"},children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${h?"text-indigo-700":"text-gray-700"}`,children:d.name}),S&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"× ×•×›×—×™×ª"}),!O&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"×œ× ×¤×¢×™×œ×”"})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[new Date(d.startDate).toLocaleDateString("he-IL")," - ",new Date(d.endDate).toLocaleDateString("he-IL")]})]}),h&&e.jsx(Qt,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"})]},d._id)})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:e.jsx("button",{className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium font-reisinger-yonatan",children:"+ ×”×•×¡×£ ×©× ×ª ×œ×™××•×“ ×—×“×©×”"})})]})]})}function Vs(){const[t,s]=u.useState(!1),o=u.useRef(null),c=Ce(),{user:r,logout:n}=fe(),{isDesktopOpen:i,isMobile:b}=Xe(),m=r&&(r.role==="admin"||r.roles?.includes("admin")||r.role==="×× ×”×œ"||r.roles?.includes("×× ×”×œ")),d=r&&(r.role==="admin"||r.roles?.includes("admin")||r.role==="×× ×”×œ"||r.roles?.includes("×× ×”×œ")||r.role==="teacher"||r.roles?.includes("teacher")||r.role==="××•×¨×”"||r.roles?.includes("××•×¨×”")||r.role==="conductor"||r.roles?.includes("conductor")||r.role==="×× ×¦×—"||r.roles?.includes("×× ×¦×—")||r.role==="theory-teacher"||r.roles?.includes("theory-teacher")||r.role==="theory_teacher"||r.roles?.includes("theory_teacher")||r.role==="××•×¨×” ×ª×™××•×¨×™×”"||r.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||r.teaching?.studentIds?.length>0||r.conducting?.orchestraIds?.length>0);u.useEffect(()=>{const T=W=>{o.current&&!o.current.contains(W.target)&&s(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const h=()=>{c("/profile"),s(!1)},S=async()=>{try{await n(),c("/login")}catch(T){console.error("Logout error:",T)}s(!1)},O=()=>{c("/dashboard")},k=()=>{const T=r?.personalInfo?.fullName||r?.fullName||r?.name||"";if(!T)return"×";const W=T.trim().split(" ");return W.length>=2?W[0][0]+W[1][0]:W[0][0]||"×"},$=()=>r?.personalInfo?.fullName||r?.fullName||r?.name||"××©×ª××©",F=()=>{const T=r?.role||r?.roles?.[0]||"";switch(T){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return T||"××©×ª××©"}};return e.jsxs("header",{className:"fixed top-0 left-0 h-16 bg-white border-b border-gray-200 flex items-center justify-between z-[45] transition-all duration-300",style:{direction:"rtl",width:d&&!b&&i?"calc(100% - 280px)":"100%",paddingLeft:"1.5rem",paddingRight:d&&!b&&!i?"4rem":"1.5rem"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-10 w-auto object-contain"}),e.jsx(Ms,{})]}),e.jsxs("div",{className:"flex items-center gap-4",style:{direction:"ltr"},children:[!b&&e.jsx(e.Fragment,{children:!m&&e.jsx("button",{onClick:O,className:"w-10 h-10 rounded-lg bg-indigo-50 border border-indigo-200 flex items-center justify-center hover:bg-indigo-100 hover:border-indigo-300 transition-all duration-150 ease-in-out cursor-pointer",title:"×œ×•×— ×‘×§×¨×”",children:e.jsx(we,{className:"w-5 h-5 text-indigo-600"})})}),e.jsxs("div",{className:"relative",ref:o,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center cursor-pointer hover:bg-indigo-700 transition-colors",onClick:()=>s(!t),children:e.jsx("span",{className:"text-sm font-semibold text-white font-reisinger-yonatan",children:k()})}),t&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[70]",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:$()}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:F()})]}),e.jsxs("button",{onClick:h,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×¢××•×“ ××™×©×™"}),e.jsx(de,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs("button",{onClick:S,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 text-red-600 hover:bg-red-50",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium font-reisinger-yonatan",children:"×™×¦×™××”"}),e.jsx(Kt,{className:"w-4 h-4"})]})]})]})]})]})}function q({children:t}){const{user:s}=fe(),{isDesktopOpen:o,isMobile:c}=Xe(),r=s&&(s.role==="admin"||s.roles?.includes("admin")||s.role==="×× ×”×œ"||s.roles?.includes("×× ×”×œ")||s.role==="teacher"||s.roles?.includes("teacher")||s.role==="××•×¨×”"||s.roles?.includes("××•×¨×”")||s.role==="conductor"||s.roles?.includes("conductor")||s.role==="×× ×¦×—"||s.roles?.includes("×× ×¦×—")||s.role==="theory-teacher"||s.roles?.includes("theory-teacher")||s.role==="theory_teacher"||s.roles?.includes("theory_teacher")||s.role==="××•×¨×” ×ª×™××•×¨×™×”"||s.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||s.teaching?.studentIds?.length>0||s.conducting?.orchestraIds?.length>0);return console.log("ğŸ¨ Layout Debug:",{hasUser:!!s,userRole:s?.role,userRoles:s?.roles,userObject:s,shouldShowSidebar:r,isMobile:c,isDesktopOpen:o,conditions:{hasRole:!!s?.role,hasRolesArray:!!s?.roles,isAdmin:s?.role==="admin"||s?.roles?.includes("admin"),isTeacher:s?.role==="teacher"||s?.roles?.includes("teacher"),hasConductor:s?.role==="conductor"||s?.roles?.includes("conductor"),hasTheoryTeacher:s?.role==="theory-teacher"||s?.roles?.includes("theory-teacher"),hasTeaching:s?.teaching?.studentIds?.length>0,hasConducting:s?.conducting?.orchestraIds?.length>0}}),e.jsxs("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[r&&e.jsx(Fs,{}),e.jsx(Vs,{}),e.jsx("main",{className:"mt-16 ml-0 p-0 bg-gray-50 min-h-[calc(100vh-64px)] rtl transition-all duration-300",style:{marginRight:r&&!c&&o?"280px":"0"},children:e.jsx("div",{className:"p-6 bg-gray-50",children:t})})]})}function Ys(){const[t,s]=u.useState(""),[o,c]=u.useState(""),[r,n]=u.useState(""),[i,b]=u.useState(!1),m=Ce(),{login:d}=fe(),h=async S=>{S.preventDefault(),n(""),b(!0),console.log("ğŸ” Login attempt started:",{email:t,password:"***"}),console.log("ğŸŒ API Base URL:","/api"),console.log("ğŸ”§ Environment check:",{VITE_API_URL:"/api",fallback:"http://localhost:3001/api",actual:"/api"});try{console.log("ğŸ“¤ Sending login request to API service...");const O=await d(t,o);console.log("âœ… Login successful:",{user:O.user?.personalInfo?.fullName||"Unknown"}),console.log("ğŸ”‘ Authentication token stored successfully"),console.log("ğŸ§­ Navigating to dashboard..."),m("/dashboard")}catch(O){console.error("âŒ Login failed:",O),console.error("ğŸ“ Error details:",{message:O.message,stack:O.stack}),n(O.message||"×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª. ×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×•× ×¡×” ×©×•×‘.")}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×›× ×™×¡×” ×œ××¢×¨×›×ª"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:h,children:[r&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:r})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:i,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:S=>s(S.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:i,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××”",value:o,onChange:S=>c(S.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:i,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"××ª×—×‘×¨..."]}):"×›× ×™×¡×”"})}),e.jsx("div",{className:"text-center",children:e.jsx(ue,{to:"/forgot-password",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×©×›×—×ª×™ ×¡×™×¡××"})})]})]})})]})}function Ws(){const[t,s]=u.useState(""),[o,c]=u.useState(!1),[r,n]=u.useState(!1),[i,b]=u.useState(""),m=async d=>{d.preventDefault(),b(""),c(!0);try{await mt.forgotPassword(t),n(!0)}catch(h){b(h.message||"×©×’×™××” ×‘×©×œ×™×—×ª ×‘×§×©×ª ××™×¤×•×¡ ×¡×™×¡××”")}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×©×›×—×ª×™ ×¡×™×¡××"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:'×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”×“×•×"×œ ×©×œ×š ×•× ×©×œ×— ×œ×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”'})]}),r?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan",children:'×× ×§×™×™× ×—×©×‘×•×Ÿ ×¢× ×›×ª×•×‘×ª ×“×•×"×œ ×–×•, × ×©×œ×— ××œ×™×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”. ×× × ×‘×“×•×§ ××ª ×ª×™×‘×ª ×”×“×•××¨ ×©×œ×š.'})}),e.jsx("div",{className:"text-center",children:e.jsx(ue,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[i&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:i})}),e.jsx("div",{className:"rounded-md shadow-sm",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:o,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:d=>s(d.target.value),dir:"ltr",style:{textAlign:"left"}})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:o,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×©×•×œ×—..."]}):"×©×œ×— ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsx("div",{className:"text-center",children:e.jsx(ue,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]})]})})]})}function Hs(){const{token:t}=Lt(),[s,o]=u.useState(""),[c,r]=u.useState(""),[n,i]=u.useState(!1),[b,m]=u.useState(""),[d,h]=u.useState(!1),S=Ce();u.useEffect(()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),t||m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”.")},[t]);const O=async k=>{if(k.preventDefault(),m(""),s.length<6){m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×");return}if(s!==c){m("×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª");return}if(!t){m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ");return}i(!0);try{await mt.resetPassword(t,s),h(!0),setTimeout(()=>{S("/login")},3e3)}catch($){const F=$.message||$.error||"×©×’×™××” ×‘××™×¤×•×¡ ×”×¡×™×¡××”";F.includes("expired")||F.includes("RESET_TOKEN_EXPIRED")?m("×ª×•×§×£ ×”×§×™×©×•×¨ ×¤×’. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):F.includes("invalid")||F.includes("INVALID_RESET_TOKEN")?m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):F.includes("password")||F.includes("WEAK_PASSWORD")?m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×"):m(F)}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"××™×¤×•×¡ ×¡×™×¡××”"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:"×”×–×Ÿ ×¡×™×¡××” ×—×“×©×” ×œ×—×©×‘×•×Ÿ ×©×œ×š"})]}),d?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:[e.jsx("p",{className:"text-green-100 text-center font-reisinger-yonatan",children:"×”×¡×™×¡××” ××•×¤×¡×” ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×ª×•×›×œ ×œ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡××” ×”×—×“×©×”."}),e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan mt-2",children:"××¢×‘×™×¨ ××•×ª×š ×œ×“×£ ×”×›× ×™×¡×”..."})]}),e.jsx("div",{className:"text-center",children:e.jsx(ue,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×” ×¢×›×©×™×•"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:O,children:[b&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:b})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××” ×—×“×©×”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××” ×—×“×©×” (×œ×¤×—×•×ª 6 ×ª×•×•×™×)",value:s,onChange:k=>o(k.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"sr-only font-reisinger-yonatan",children:"××™××•×ª ×¡×™×¡××”"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"××™××•×ª ×¡×™×¡××”",value:c,onChange:k=>r(k.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:n||!t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×××¤×¡ ×¡×™×¡××”..."]}):"××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(ue,{to:"/forgot-password",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×‘×§×© ×§×™×©×•×¨ ×—×“×©"}),e.jsx(ue,{to:"/login",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})]})]})]})})]})}function se(t,s,o=3){return u.lazy(()=>{let c=0;const r=async()=>{try{const n=await t();return console.log(`âœ… Successfully loaded ${s}`),n}catch(n){if(console.error(`âŒ Failed to load ${s}, attempt ${c+1}/${o}:`,n),c<o-1){c++;const i=Math.min(1e3*Math.pow(2,c),5e3);return await new Promise(b=>setTimeout(b,i)),r()}else throw console.error(`âŒ All retry attempts failed for ${s}`),n}};return r()})}class zs{constructor(){Oe(this,"preloadedComponents",new Set);Oe(this,"preloadPromises",new Map)}preload(s,o){if(this.preloadedComponents.has(s))return Promise.resolve();if(this.preloadPromises.has(s))return this.preloadPromises.get(s);const c=o().then(r=>(this.preloadedComponents.add(s),console.log(`âœ… Preloaded ${s}`),r)).catch(r=>{throw console.error(`âŒ Failed to preload ${s}:`,r),r}).finally(()=>{this.preloadPromises.delete(s)});return this.preloadPromises.set(s,c),c}preloadOnHover(s,o){return()=>{this.preloadedComponents.has(s)||this.preload(s,o)}}getPreloadStats(){return{preloadedComponents:Array.from(this.preloadedComponents),pendingPreloads:Array.from(this.preloadPromises.keys())}}}const $e=new zs,Le={STUDENT_DETAILS:"StudentDetailsPage",THEORY_TAB:"TheoryTab",ORCHESTRA_TAB:"OrchestraTab",DASHBOARD:"Dashboard",STUDENTS_LIST:"Students"};function Xs(){setTimeout(()=>{$e.preload(Le.DASHBOARD,()=>Z(()=>import("../chunks/Dashboard-DfJ0hgmp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),$e.preload(Le.STUDENTS_LIST,()=>Z(()=>import("../chunks/Students-BTMrWWcP.js"),__vite__mapDeps([9,1,3,4,10,7,11,5,6])))},1e3),setTimeout(()=>{$e.preload(Le.STUDENT_DETAILS,()=>Z(()=>import("../chunks/StudentDetailsPageSimple-DiXZ6z9p.js"),__vite__mapDeps([12,1,7,5,6,3,13,14,15,4])))},3e3)}function qs(){const t=document.head,s=document.createElement("link");s.rel="dns-prefetch",s.href="//localhost",t.appendChild(s);const o=document.createElement("link");o.rel="preconnect",o.href="http://localhost:3001",o.crossOrigin="anonymous",t.appendChild(o);const c=document.createElement("link");c.rel="prefetch",c.as="style",c.href="/src/index.css",t.appendChild(c)}function Gs(){typeof window>"u"||(qs(),Xs(),console.log("ğŸš€ Bundle optimizations initialized"))}const Qs=se(()=>Z(()=>import("../chunks/Dashboard-DfJ0hgmp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),"Dashboard"),it=se(()=>Z(()=>import("../chunks/Students-BTMrWWcP.js"),__vite__mapDeps([9,1,3,4,10,7,11,5,6])),"Students"),Ks=se(()=>Z(()=>import("../chunks/Teachers-cs89_WST.js"),__vite__mapDeps([16,1,4,3,10,7,11,5,6])),"Teachers"),Ue=se(()=>Z(()=>import("../chunks/TheoryLessons-2jnWnr7s.js"),__vite__mapDeps([17,1,4,3,2,13,5,6,7,11])),"TheoryLessons"),Js=se(()=>Z(()=>import("../chunks/TheoryLessonDetails-bqX9lw2J.js"),__vite__mapDeps([18,1,4,3,10,7,2,11,5,6])),"TheoryLessonDetails"),ct=se(()=>Z(()=>import("../chunks/Orchestras-ctfVdrfe.js"),__vite__mapDeps([19,1,4,3,10,7,2,5,6])),"Orchestras"),dt=se(()=>Z(()=>import("../chunks/Rehearsals-DOxgheCG.js"),__vite__mapDeps([20,1,4,3,10,7,11,5,6])),"Rehearsals"),Zs=se(()=>Z(()=>import("../chunks/RehearsalDetails-CyDK6Oir.js"),__vite__mapDeps([21,1,5,6,3,4,11,7])),"RehearsalDetails"),er=se(()=>Z(()=>import("../chunks/Bagruts-Dt4f5sJD.js"),__vite__mapDeps([22,1,4,3,10,7,2,11,23,5,6])),"Bagruts"),tr=se(()=>Z(()=>import("../chunks/BagrutDetails-p8HeCSCc.js"),__vite__mapDeps([24,1,4,3,10,7,2,11,23,5,6])),"BagrutDetails"),sr=se(()=>Z(()=>import("../chunks/Profile-DNPkbvN4.js"),__vite__mapDeps([25,1,5,6,3,7,11,15])),"Profile"),ut=se(()=>Z(()=>import("../chunks/RehearsalAttendance-DykoWZ-T.js"),__vite__mapDeps([26,1,5,6,3,7])),"ConductorAttendance"),rr=se(()=>Z(()=>import("../chunks/OrchestraEnrollmentManager-CEGKc7Xv.js"),__vite__mapDeps([27,1,5,6,3,7])),"OrchestraEnrollmentManager"),ar=se(()=>Z(()=>import("../chunks/StudentDetailsPageSimple-DiXZ6z9p.js"),__vite__mapDeps([12,1,7,5,6,3,13,14,15,4])),"StudentDetailsPage"),nr=se(()=>Z(()=>import("../chunks/TeacherDetailsPage-CagTbE7Z.js"),__vite__mapDeps([28,1,7,8,3,5,6])),"TeacherDetailsPage"),lr=se(()=>Z(()=>import("../chunks/OrchestraDetailsPage-BDn9QX7A.js"),__vite__mapDeps([29,1,5,6,3,7,11])),"OrchestraDetailsPage"),ne=({message:t="×˜×•×¢×Ÿ ×¢××•×“..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:t})]})});function G({children:t,allowedRoles:s}){const{isAuthenticated:o,isLoading:c,authError:r,checkAuthStatus:n,user:i}=fe(),[b,m]=Se.useState(0),d=2,h=()=>{if(!s||s.length===0)return!0;if(!i)return!1;const S=i.role||i.roles?.[0]||"",O=i.roles||[S],k={×× ×”×œ:"admin",××•×¨×”:"teacher",×× ×¦×—:"conductor","××“×¨×™×š ×ª×“×¨":"theory-teacher","××•×¨×” ×ª×™××•×¨×™×”":"theory-teacher"},$=O.map(T=>k[T]||T),F=k[S]||S;return s.some(T=>$.includes(T)||F===T||T==="admin"&&!S)};return Se.useEffect(()=>{if(r&&b<d){const S=setTimeout(()=>{console.log(`ğŸ”„ ProtectedRoute - Retrying authentication (${b+1}/${d})`),n(!0),m(O=>O+1)},1e3*(b+1));return()=>clearTimeout(S)}},[r,b,n]),Se.useEffect(()=>{o&&b>0&&m(0)},[o]),c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"××××ª ×”×¨×©××•×ª..."}),r&&b>0&&e.jsxs("div",{className:"mt-2 text-sm text-amber-600",children:["×× ×¡×” ×©×•×‘ (",b,"/",d,")..."]})]})}):o?h()?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"××™×Ÿ ×”×¨×©××”"}),e.jsx("p",{className:"text-gray-600",children:"××™×Ÿ ×œ×š ×”×¨×©××” ×œ×’×©×ª ×œ×¢××•×“ ×–×”"})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"×—×–×•×¨"})]})}):e.jsx(Ie,{to:"/login",replace:!0})}function or(){return e.jsx("div",{dir:"rtl",children:e.jsxs(Ut,{children:[e.jsx(H,{path:"/login",element:e.jsx(Ys,{})}),e.jsx(H,{path:"/forgot-password",element:e.jsx(Ws,{})}),e.jsx(H,{path:"/reset-password/:token",element:e.jsx(Hs,{})}),e.jsx(H,{path:"/dashboard",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×“×©×‘×•×¨×“..."}),children:e.jsx(Qs,{})})})})}),e.jsx(H,{path:"/students",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}),children:e.jsx(it,{})})})})}),e.jsx(H,{path:"/students/:studentId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×œ××™×“..."}),children:e.jsx(ar,{})})})})}),e.jsx(H,{path:"/teachers",element:e.jsx(G,{allowedRoles:["admin","teacher","conductor","theory-teacher"],children:e.jsx(q,{children:e.jsx(Ks,{})})})}),e.jsx(H,{path:"/teachers/:teacherId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××•×¨×”..."})]})}),children:e.jsx(nr,{})})})})}),e.jsx(H,{path:"/theory-lessons",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(Ue,{})})})}),e.jsx(H,{path:"/theory-lessons/:theoryId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(Js,{})})})}),e.jsx(H,{path:"/orchestras",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(ct,{})})})}),e.jsx(H,{path:"/orchestras/:orchestraId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×–××•×¨×ª..."})]})}),children:e.jsx(lr,{})})})})}),e.jsx(H,{path:"/rehearsals",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(dt,{})})})}),e.jsx(H,{path:"/rehearsals/:rehearsalId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(Zs,{})})})}),e.jsx(H,{path:"/bagruts",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(er,{})})})}),e.jsx(H,{path:"/bagruts/:bagrutId",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(tr,{})})})}),e.jsx(H,{path:"/bagruts/:bagrutId/edit",element:e.jsx(G,{children:e.jsx(q,{children:e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"×¢×¨×™×›×ª ×‘×’×¨×•×ª"}),e.jsx("p",{className:"text-gray-600",children:"×¢×¨×™×›×ª ×¤×¨×˜×™ ×”×‘×’×¨×•×ª ×•×”×ª×§×“××•×ª"}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-blue-700",children:"ğŸ”§ ×¢××•×“ ×¢×¨×™×›×ª ×‘×’×¨×•×ª ×‘×¤×™×ª×•×— - ×‘×™× ×ª×™×™× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×“×¨×š ×¢××•×“ ×”×¤×¨×˜×™×"})})]})})})}),e.jsx(H,{path:"/bagrut",element:e.jsx(Ie,{to:"/bagruts",replace:!0})}),e.jsx(H,{path:"/profile",element:e.jsx(G,{children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×¢××•×“ ××™×©×™..."}),children:e.jsx(sr,{})})})})}),e.jsx(H,{path:"/conductor/attendance",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×•×ª..."}),children:e.jsx(ut,{})})})})}),e.jsx(H,{path:"/conductor/attendance/:rehearsalId",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×”..."}),children:e.jsx(ut,{})})})})}),e.jsx(H,{path:"/conductor/enrollment",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×¨×™×©×•××™×..."}),children:e.jsx(rr,{})})})})}),e.jsx(H,{path:"/conductor/orchestras",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×ª×–××•×¨×•×ª..."}),children:e.jsx(ct,{})})})})}),e.jsx(H,{path:"/conductor/rehearsals",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×—×–×¨×•×ª..."}),children:e.jsx(dt,{})})})})}),e.jsx(H,{path:"/conductor/musicians",element:e.jsx(G,{allowedRoles:["conductor","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ××•×–×™×§××™×..."}),children:e.jsx(it,{})})})})}),e.jsx(H,{path:"/theory-teacher/lessons",element:e.jsx(G,{allowedRoles:["theory-teacher","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”..."}),children:e.jsx(Ue,{})})})})}),e.jsx(H,{path:"/theory-teacher/groups",element:e.jsx(G,{allowedRoles:["theory-teacher","admin"],children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(ne,{message:"×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”..."}),children:e.jsx(Ue,{})})})})}),e.jsx(H,{path:"/",element:e.jsx(Ie,{to:"/dashboard",replace:!0})}),e.jsx(H,{path:"*",element:e.jsx(Ie,{to:"/dashboard",replace:!0})})]})})}function ir(){return u.useEffect(()=>{Gs()},[]),e.jsx(gs,{children:e.jsx(as,{children:e.jsx(ns,{children:e.jsx(hs,{children:e.jsx(xs,{children:e.jsx(or,{})})})})})})}Yt();const cr=new ht({defaultOptions:{queries:{staleTime:1e3*60*5,retry:(t,s)=>s?.status===404||s?.status===403?!1:t<3}}}),It=document.getElementById("root");if(!It)throw new Error("Root element not found");Me.createRoot(It).render(e.jsx(Se.StrictMode,{children:e.jsx(gt,{client:cr,children:e.jsx(Bt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(ir,{})})})}));export{Is as A,ks as D,Os as R,vs as S,Ss as T,Ve as V,vt as a,qe as b,lt as c,Tt as d,Cs as e,Ds as f,Nr as g,jr as h,yr as i,e as j,br as k,vr as s,fe as u};
