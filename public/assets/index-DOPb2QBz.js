const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/Dashboard-MxBkLAMU.js","chunks/vendor-B2j9q2e_.js","chunks/StatsCard-Ckza2SwS.js","chunks/utils-x1PSU_OZ.js","chunks/Card-iUXie6Y4.js","chunks/cascade-deletion-CG57WmIj.js","chunks/query-BI61muSV.js","chunks/ui-26XYoSED.js","chunks/teacherDetailsApi-BGs4ypj_.js","chunks/Students-Dp4VVF_T.js","chunks/Table-CXSp2z4Q.js","chunks/ConfirmationModal-oNBHBs2Q.js","chunks/StudentDetailsPageSimple-LYKuBLke.js","chunks/TeacherNameDisplay-Dd-IOQkM.js","chunks/apiCache-CJ11KYCE.js","chunks/theoryEnrollmentService-BrndHKnz.js","chunks/Teachers-D1RqbrfM.js","chunks/TheoryLessons-BKpemILV.js","chunks/TheoryLessonDetails-GFxP1y5I.js","chunks/Orchestras-CTRyeqKH.js","chunks/Rehearsals-BrsT-LpX.js","chunks/RehearsalDetails-DoKuKx6L.js","chunks/Bagruts-0ctATLA0.js","chunks/useBagrut-B_VVY438.js","chunks/BagrutDetails-BjmA-QKg.js","chunks/Profile-CL9Np0zV.js","chunks/RehearsalAttendance-BuLj0ycM.js","chunks/OrchestraEnrollmentManager-CuB7bsxe.js","chunks/TeacherDetailsPage-Be8eunUW.js","chunks/OrchestraDetailsPage-DJ-ekzfT.js"])))=>i.map(i=>d[i]);
var Pt=Object.defineProperty;var $t=(t,s,n)=>s in t?Pt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var Pe=(t,s,n)=>$t(t,typeof s!="symbol"?s+"":s,n);import{r as u,a as Lt,u as Ut,b as Ee,L as me,c as Bt,d as Ft,e as Y,N as Se,R as ke,B as Mt}from"../chunks/vendor-B2j9q2e_.js";import{a as Q,t as Vt,s as Yt,o as Wt,b as gt,_ as Z,e as Ht}from"../chunks/cascade-deletion-CG57WmIj.js";import{Q as xt,c as ft}from"../chunks/query-BI61muSV.js";import{X as he,A as We,U as de,C as ue,a as le,B as we,M as _e,T as Fe,P as xe,b as re,c as De,F as Je,d as oe,e as ve,f as ie,S as He,g as Ne,h as zt,R as Xt,i as Ze,j as et,k as qt,l as $e,m as Gt,n as Qt,H as Te,G as pt,o as ze,p as Ae,q as Kt,r as tt,s as st,t as yt,u as Jt,v as Zt,w as rt,L as es}from"../chunks/ui-26XYoSED.js";import"../chunks/utils-x1PSU_OZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();var bt={exports:{}},Re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ts=u,ss=Symbol.for("react.element"),rs=Symbol.for("react.fragment"),as=Object.prototype.hasOwnProperty,ns=ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ls={key:!0,ref:!0,__self:!0,__source:!0};function jt(t,s,n){var c,o={},a=null,i=null;n!==void 0&&(a=""+n),s.key!==void 0&&(a=""+s.key),s.ref!==void 0&&(i=s.ref);for(c in s)as.call(s,c)&&!ls.hasOwnProperty(c)&&(o[c]=s[c]);if(t&&t.defaultProps)for(c in s=t.defaultProps,s)o[c]===void 0&&(o[c]=s[c]);return{$$typeof:ss,type:t,key:a,ref:i,props:o,_owner:ns.current}}Re.Fragment=rs;Re.jsx=jt;Re.jsxs=jt;bt.exports=Re;var e=bt.exports,Me={},at=Lt;Me.createRoot=at.createRoot,Me.hydrateRoot=at.hydrateRoot;const vt=u.createContext(null),fe=()=>{const t=u.useContext(vt);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},os=({children:t})=>{const[s,n]=u.useState(!1),[c,o]=u.useState(!0),[a,i]=u.useState(null),[f,m]=u.useState(null),[d,h]=u.useState(null),I=u.useRef(!1),R=u.useRef(null),S=u.useRef(!0);u.useEffect(()=>{S.current=!0;const v=setTimeout(()=>{S.current&&L()},100);return()=>{S.current=!1,R.current&&clearTimeout(R.current),clearTimeout(v)}},[]);const L=u.useCallback(async(v=!1)=>{if(I.current&&!v){console.log("ğŸ” AUTH CONTEXT - Validation already in progress, skipping");return}const C=Date.now();if(!v&&d&&C-d<3e4){console.log("ğŸ” AUTH CONTEXT - Using cached authentication status");return}I.current=!0,m(null);try{if(Q.auth.isAuthenticated()){console.log("ğŸ” AUTH CONTEXT - Token found, validating with server");const E=await Q.auth.validateToken();if(!S.current)return;const O=E?.data?.user||E?.user||E?.data||E;console.log("ğŸ” AUTH CONTEXT - Token validation successful, fetching full teacher data");let N=null;if(O?._id)try{N=await Q.teachers.getTeacher(O._id),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched:",{hasPersonalInfo:!!N?.personalInfo,hasRoles:!!N?.roles,fullName:N?.personalInfo?.fullName})}catch(V){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data:",V),N=O}const $=N||O,A={...$,teacherId:$?.teacherId||$?._id,personalInfo:$?.personalInfo||{fullName:$?.fullName||O?.fullName||"",email:$?.email||O?.email||"",phone:$?.phone||"",address:$?.address||""},roles:$?.roles||O?.roles||[],role:$?.role||$?.roles?.[0]||O?.roles?.[0]||""};console.log("ğŸ” AUTH CONTEXT - User data normalized:",{hasUserData:!!A,userRole:A?.role||A?.roles,userId:A?.teacherId||A?._id,fullName:A?.personalInfo?.fullName}),n(!0),i(A),h(C)}else console.log("ğŸ” AUTH CONTEXT - No valid token found"),n(!1),i(null),h(C)}catch(E){if(console.error("ğŸ” AUTH CONTEXT - Auth validation failed:",E),!S.current)return;m(E.message),n(!1),i(null),h(C),E.message.includes("Authentication failed")&&Q.auth.isAuthenticated()&&console.log("ğŸ” AUTH CONTEXT - Attempting token refresh")}finally{S.current&&o(!1),I.current=!1}},[d]),F=async(v,C)=>{try{o(!0),m(null);const E=await Q.auth.login(v,C);if(!S.current)return;console.log("ğŸ” AUTH CONTEXT - Login successful:",{hasToken:!!E.token,hasUserData:!!(E.teacher||E.user)});const{token:O}=E,N=E.teacher||E.user||E.data?.teacher||E.data?.user||E.data;if(!O||!N)throw new Error("Invalid login response: missing token or user data");console.log("ğŸ” AUTH CONTEXT - Fetching full teacher data after login");let $=null;if(N?._id||N?.teacherId)try{const ee=N._id||N.teacherId;$=await Q.teachers.getTeacher(ee),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched after login:",{hasPersonalInfo:!!$?.personalInfo,hasRoles:!!$?.roles,fullName:$?.personalInfo?.fullName})}catch(ee){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data after login:",ee),$=N}const A=$||N,V={...A,teacherId:A?.teacherId||A?._id,personalInfo:A?.personalInfo||{fullName:A?.fullName||N?.personalInfo?.fullName||N?.fullName||"",email:A?.email||N?.credentials?.email||N?.personalInfo?.email||N?.email||v,phone:A?.phone||N?.personalInfo?.phone||"",address:A?.address||N?.personalInfo?.address||""},roles:A?.roles||N?.roles||[],role:A?.role||A?.roles?.[0]||N?.roles?.[0]||""};return console.log("ğŸ” AUTH CONTEXT - User data normalized after login:",{hasUserData:!!V,userRole:V?.role||V?.roles,userId:V?.teacherId||V?._id,fullName:V?.personalInfo?.fullName}),n(!0),i(V),h(Date.now()),{success:!0,user:V}}catch(E){throw console.error("ğŸ” AUTH CONTEXT - Login failed:",E),S.current&&(m(E.message),n(!1),i(null)),E}finally{S.current&&o(!1)}},D=async()=>{try{o(!0),await Q.auth.logout(),console.log("ğŸ” AUTH CONTEXT - Logout successful")}catch(v){console.warn("ğŸ” AUTH CONTEXT - Logout API call failed:",v)}finally{S.current&&(n(!1),i(null),m(null),h(null),o(!1))}},H=u.useCallback(async()=>{try{return console.log("ğŸ” AUTH CONTEXT - Attempting token refresh"),await L(!0),s}catch(v){return console.error("ğŸ” AUTH CONTEXT - Token refresh failed:",v),await D(),!1}},[s]),g=u.useCallback(()=>({isAuthenticated:s,isLoading:c,user:a?{id:a.teacherId||a.id,role:a.role}:null,authError:f,lastValidation:d?new Date(d).toISOString():null,isValidating:I.current,cacheAge:d?Date.now()-d:null}),[s,c,a,f,d]),j={isAuthenticated:s,isLoading:c,user:a,authError:f,login:F,logout:D,checkAuthStatus:L,refreshToken:H,debugAuth:g};return e.jsx(vt.Provider,{value:j,children:t})},Nt=u.createContext(null),wt=()=>{const t=u.useContext(Nt);if(!t)throw new Error("useSchoolYear must be used within a SchoolYearProvider");return t},is=({children:t})=>{const{isAuthenticated:s}=fe(),[n,c]=u.useState(null),[o,a]=u.useState([]),[i,f]=u.useState(!0),[m,d]=u.useState(null);u.useEffect(()=>{s?h():(c(null),a([]),f(!1),d(null))},[s]);const h=async()=>{try{f(!0),d(null);const g=await Q.schoolYears.getSchoolYears();a(g);const j=await Q.schoolYears.getCurrentSchoolYear();if(j)c(j);else if(g.length>0){const v=g.sort((C,E)=>new Date(E.startDate)-new Date(C.startDate))[0];c(v)}console.log(`ğŸ“ Loaded ${g.length} school years, current: ${j?.name||"None"}`)}catch(g){console.error("Failed to load school years:",g),d(g.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×©× ×•×ª ×”×œ×™××•×“")}finally{f(!1)}},I=async g=>{try{const j=o.find(v=>v._id===g);if(j)c(j),console.log(`ğŸ¯ Switched to school year: ${j.name}`);else{const v=await Q.schoolYears.getSchoolYear(g);c(v),console.log(`ğŸ¯ Switched to fetched school year: ${v.name}`)}}catch(j){console.error("Failed to set school year:",j),d(j.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“")}},R=async g=>{try{const j=await Q.schoolYears.createSchoolYear(g);return a(v=>[...v,j]),g.isCurrent&&c(j),console.log(`â• Created new school year: ${j.name}`),j}catch(j){throw console.error("Failed to create school year:",j),d(j.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×©× ×ª ×”×œ×™××•×“"),j}},S=async(g,j)=>{try{const v=await Q.schoolYears.updateSchoolYear(g,j);return a(C=>C.map(E=>E._id===g?v:E)),n&&n._id===g&&c(v),console.log(`âœï¸ Updated school year: ${v.name}`),v}catch(v){throw console.error("Failed to update school year:",v),d(v.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“"),v}},L=async g=>{try{if(await Q.schoolYears.deleteSchoolYear(g),a(j=>j.filter(v=>v._id!==g)),n&&n._id===g){const j=o.filter(v=>v._id!==g);j.length>0?c(j[0]):c(null)}console.log(`ğŸ—‘ï¸ Deleted school year: ${g}`)}catch(j){throw console.error("Failed to delete school year:",j),d(j.message||"×©×’×™××” ×‘××—×™×§×ª ×©× ×ª ×”×œ×™××•×“"),j}},F=g=>{if(!g)return!1;const j=new Date,v=new Date(g.startDate),C=new Date(g.endDate);return j>=v&&j<=C&&g.isActive},H={currentSchoolYear:n,schoolYears:o,isLoading:i,error:m,loadSchoolYears:h,setCurrentSchoolYearById:I,createSchoolYear:R,updateSchoolYear:S,deleteSchoolYear:L,isSchoolYearActive:F,getSchoolYearDisplayName:g=>{if(!g)return"×œ× × ×‘×—×¨×” ×©× ×”";const j=g.isCurrent,v=F(g);let C=g.name;return j?C+=" (× ×•×›×—×™×ª)":v&&(C+=" (×¤×¢×™×œ×”)"),C}};return e.jsx(Nt.Provider,{value:H,children:t})},cs={currentBagrut:null,bagruts:[],loading:!1,error:null,validation:{errors:{},warnings:{}}},ds=t=>{if(!t[3]?.detailedGrading)return 0;const s=t[3].detailedGrading;return(s.playingSkills?.points||0)+(s.musicalUnderstanding?.points||0)+(s.textKnowledge?.points||0)+(s.playingByHeart?.points||0)},us=(t,s)=>{const n=t/100*100,c=s/100*100;return n*.9+c*.1},ms=t=>t>=95?"××¦×•×™×Ÿ (100-95)":t>=85?"×˜×•×‘ ×××“ (94-85)":t>=75?"×˜×•×‘ (84-75)":t>=65?"×›××¢×˜ ×˜×•×‘ (74-65)":t>=55?"××¡×¤×™×§ (64-55)":"×œ× ××¡×¤×™×§ (54-0)",hs=t=>({presentations:[t.presentations?.[0]?.completed||!1,t.presentations?.[1]?.completed||!1,t.presentations?.[2]?.completed||!1,t.presentations?.[3]?.completed||!1],directorEvaluation:!!t.directorEvaluation?.points,recitalConfig:!!(t.recitalConfiguration?.units&&t.recitalConfiguration?.field),program:t.program?.length>0}),je=(t,s,n)=>t<0?`${n} ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×œ×™×œ×™`:t>s?`${n} ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ ${s} × ×§×•×“×•×ª`:null,gs=t=>t!==3&&t!==5?"×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5":null,xs=(t,s)=>{switch(s.type){case"SET_LOADING":return{...t,loading:s.payload};case"SET_ERROR":return{...t,error:s.payload};case"SET_CURRENT_BAGRUT":return console.log("âœ… BagrutContext: SET_CURRENT_BAGRUT reducer:",s.payload?._id),{...t,currentBagrut:s.payload};case"SET_BAGRUTS":return{...t,bagruts:s.payload};case"UPDATE_DIRECTOR_EVALUATION":{const{bagrutId:n,evaluation:c}=s.payload,o=t.currentBagrut?._id===n?{...t.currentBagrut,directorEvaluation:c}:t.currentBagrut,a=t.bagruts.map(i=>i._id===n?{...i,directorEvaluation:c}:i);return{...t,currentBagrut:o,bagruts:a}}case"UPDATE_RECITAL_CONFIG":{const{bagrutId:n,config:c}=s.payload,o={units:c.recitalUnits,field:c.recitalField},a=t.currentBagrut?._id===n?{...t.currentBagrut,recitalConfiguration:o,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:t.currentBagrut,i=t.bagruts.map(f=>f._id===n?{...f,recitalConfiguration:o,recitalUnits:c.recitalUnits,recitalField:c.recitalField}:f);return{...t,currentBagrut:a,bagruts:i}}case"UPDATE_PRESENTATION":{const{bagrutId:n,index:c,data:o}=s.payload,a=(m=[])=>{const d=[...m];return d[c]={...d[c],...o},d},i=t.currentBagrut?._id===n?{...t.currentBagrut,presentations:a(t.currentBagrut.presentations)}:t.currentBagrut,f=t.bagruts.map(m=>m._id===n?{...m,presentations:a(m.presentations)}:m);return{...t,currentBagrut:i,bagruts:f}}case"CALCULATE_COMPUTED_VALUES":{const{bagrutId:n}=s.payload,c=o=>{if(o._id!==n)return o;const a=ds(o.presentations||[]),i=o.directorEvaluation?.points||0,f=us(a,i),m=ms(f),d=hs(o);return{...o,computedValues:{totalPerformancePoints:a,weightedFinalGrade:f,gradeLevel:m,completionStatus:d},finalGrade:f,finalGradeLevel:m}};return{...t,currentBagrut:t.currentBagrut?c(t.currentBagrut):null,bagruts:t.bagruts.map(c)}}case"SET_VALIDATION_ERROR":return{...t,validation:{...t.validation,errors:{...t.validation.errors,[s.payload.field]:s.payload.message}}};case"CLEAR_VALIDATION_ERRORS":return{...t,validation:{...t.validation,errors:{}}};default:return t}},Tt=u.createContext(null),fs=({children:t})=>{const[s,n]=u.useReducer(xs,cs),c=u.useMemo(()=>({setLoading:a=>n({type:"SET_LOADING",payload:a}),setError:a=>n({type:"SET_ERROR",payload:a}),setCurrentBagrut:a=>{console.log("ğŸ’¾ BagrutContext: setCurrentBagrut action called with:",a?._id),n({type:"SET_CURRENT_BAGRUT",payload:a})},setBagruts:a=>n({type:"SET_BAGRUTS",payload:a}),updateDirectorEvaluation:(a,i)=>{const f=je(i.points||0,100,"×”×¢×¨×›×ª ×× ×”×œ");if(f){n({type:"SET_VALIDATION_ERROR",payload:{field:"directorEvaluation",message:f}});return}n({type:"UPDATE_DIRECTOR_EVALUATION",payload:{bagrutId:a,evaluation:i}}),n({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:a}})},updateRecitalConfig:(a,i)=>{const f=gs(i.recitalUnits);if(f){n({type:"SET_VALIDATION_ERROR",payload:{field:"recitalUnits",message:f}});return}n({type:"UPDATE_RECITAL_CONFIG",payload:{bagrutId:a,config:i}}),n({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:a}})},updatePresentation:(a,i,f)=>{if(f.detailedGrading){const m=f.detailedGrading,d=[];if(m.playingSkills?.points!==void 0){const h=je(m.playingSkills.points,40,"×›×™×©×•×¨×™ × ×’×™× ×”");h&&d.push(h)}if(m.musicalUnderstanding?.points!==void 0){const h=je(m.musicalUnderstanding.points,30,"×”×‘× ×” ××•×–×™×§×œ×™×ª");h&&d.push(h)}if(m.textKnowledge?.points!==void 0){const h=je(m.textKnowledge.points,20,"×™×“×¢ ×˜×§×¡×˜");h&&d.push(h)}if(m.playingByHeart?.points!==void 0){const h=je(m.playingByHeart.points,10,"× ×’×™× ×” ×‘×¢×œ ×¤×”");h&&d.push(h)}if(d.length>0){n({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${i}`,message:d[0]}});return}}n({type:"UPDATE_PRESENTATION",payload:{bagrutId:a,index:i,data:f}}),n({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:a}})},recalculateGrade:a=>{n({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:a}})},setValidationError:(a,i)=>{n({type:"SET_VALIDATION_ERROR",payload:{field:a,message:i}})},clearValidationErrors:()=>{n({type:"CLEAR_VALIDATION_ERRORS"})},validatePointTotal:a=>(a.playingSkills?.points||0)+(a.musicalUnderstanding?.points||0)+(a.textKnowledge?.points||0)+(a.playingByHeart?.points||0)>100?(n({type:"SET_VALIDATION_ERROR",payload:{field:"totalPoints",message:"×¡×š ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100"}}),!1):!0,validateSequentialPresentation:(a,i)=>a>0&&!i[a-1]?.completed?(n({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${a}`,message:`×™×© ×œ×”×©×œ×™× ×ª×—×™×œ×” ××¦×’×ª ${a}`}}),!1):!0}),[]),o=u.useMemo(()=>({state:s,actions:c}),[s,c]);return e.jsx(Tt.Provider,{value:o,children:t})},jr=()=>{const t=u.useContext(Tt);if(!t)throw new Error("useBagrutContext must be used within a BagrutProvider");return t},vr={getCurrentBagrut:t=>t.currentBagrut,getAllBagruts:t=>t.bagruts,getLoadingState:t=>t.loading,getError:t=>t.error,getValidationErrors:t=>t.validation.errors,getBagrutById:(t,s)=>t.bagruts.find(n=>n._id===s),getCompletedPresentations:(t,s)=>t.bagruts.find(c=>c._id===s)?.presentations?.filter(c=>c.completed)||[],getTotalPerformancePoints:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.totalPerformancePoints||0,getWeightedFinalGrade:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.weightedFinalGrade||0,getCompletionStatus:(t,s)=>t.bagruts.find(c=>c._id===s)?.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1}},pe=new xt({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!0,retry:(t,s)=>{const n=s?.response?.status;return n>=400&&n<500?!1:t<2},retryDelay:t=>Math.min(1e3*2**t,3e4),networkMode:"online"},mutations:{retry:1,networkMode:"online",onError:t=>{console.error("Mutation error:",t)}}}});pe.setQueryDefaults(["students"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["teachers"],{staleTime:10*60*1e3,gcTime:30*60*1e3});pe.setQueryDefaults(["theory-lessons"],{staleTime:2*60*1e3,gcTime:5*60*1e3});pe.setQueryDefaults(["orchestras"],{staleTime:5*60*1e3,gcTime:15*60*1e3});pe.setQueryDefaults(["school-years"],{staleTime:30*60*1e3,gcTime:60*60*1e3});function ps({children:t}){return e.jsxs(ft,{client:pe,children:[t,!1]})}const It=u.createContext(void 0);function ys({children:t}){const[s,n]=u.useState(!0),[c,o]=u.useState(!1);return u.useEffect(()=>{const a=()=>{o(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),e.jsx(It.Provider,{value:{isDesktopOpen:s,setIsDesktopOpen:n,isMobile:c},children:t})}function Xe(){const t=u.useContext(It);if(t===void 0)throw new Error("useSidebar must be used within a SidebarProvider");return t}const bs=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨"],js=[1,2,3,4,5,6,7,8],vs=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","×’×™×˜×¨×” ×‘×¡","×ª×•×¤×™×"],Ns=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],ws=[30,45,60],nt=["×œ× × ×‘×—×Ÿ","×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”"],Ts=({initialData:t,onSubmit:s,onCancel:n,isEdit:c=!1})=>{const[o,a]=u.useState({personalInfo:{fullName:"",phone:"",age:null,address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[{instrumentName:"",isPrimary:!0,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}],class:"×",tests:{bagrutId:null}},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,...t}),[i,f]=u.useState({}),[m,d]=u.useState(!1),[h,I]=u.useState({personal:!0,academic:!0,instruments:!0,teachers:!0,enrollments:!1}),[R,S]=u.useState([]),[L,F]=u.useState([]),[D,H]=u.useState([]),[g,j]=u.useState([]),[v,C]=u.useState(""),[E,O]=u.useState(!1);u.useState([]);const[N,$]=u.useState({duration:null,selectedDays:[],startTime:"",endTime:""}),[A,V]=u.useState(!0);u.useEffect(()=>{const r=async()=>{try{const _=await Q.teachers.getTeachers();S(_)}catch(_){console.error("Error fetching teachers:",_)}},p=async()=>{try{const _=await Q.orchestras.getOrchestras();console.log("Fetched orchestras:",_);const P=await Promise.all((_||[]).map(async z=>{if(z.rehearsalIds&&z.rehearsalIds.length>0)try{const te=await Q.rehearsals.getRehearsalById(z.rehearsalIds[0]);return{...z,rehearsalSchedule:te?{day:te.day||te.dayOfWeek,startTime:te.startTime,endTime:te.endTime,location:te.location||z.location}:null}}catch{return console.log("Could not fetch rehearsal for orchestra:",z.name),z}return z}));H(P)}catch(_){console.error("Error fetching orchestras:",_),H([])}},y=async()=>{try{const _=await Q.theory.getTheoryLessons();console.log("Fetched theory lessons:",_),j(_||[])}catch(_){console.error("Error fetching theory lessons:",_),j([])}};r(),p(),y()},[]),u.useEffect(()=>{v&&(ee(v),V(!0))},[v]);const ee=async r=>{O(!0);try{const p=await Q.teachers.getTeacherById(r);console.log("Teacher data for slots:",p);const y=p.teaching?.timeBlocks?.filter(P=>P.isActive!==!1)||[];console.log("Time blocks found:",y);const _=[];y.forEach(P=>{const z=P.startTime,te=P.endTime,w=P.day,[M,W]=z.split(":").map(Number),[J,ne]=te.split(":").map(Number),be=M*60+W,Dt=J*60+ne-be;ws.forEach(ge=>{const Ct=Math.floor(Dt/ge);for(let Ie=0;Ie<Ct;Ie++){const Oe=be+Ie*ge,Ge=Oe+ge,Et=Math.floor(Oe/60),_t=Oe%60,At=Math.floor(Ge/60),Rt=Ge%60,Qe=`${Et.toString().padStart(2,"0")}:${_t.toString().padStart(2,"0")}`,Ot=`${At.toString().padStart(2,"0")}:${Rt.toString().padStart(2,"0")}`;P.assignedLessons&&P.assignedLessons.some(Ke=>Ke.startTime===Qe&&Ke.duration===ge)||_.push({_id:`${P._id}-${ge}-${Ie}`,day:w,startTime:Qe,endTime:Ot,duration:ge,isAvailable:!0,location:P.location,teacherName:p.personalInfo?.fullName,teacherId:p._id,instrument:p.professionalInfo?.instrument})}})}),console.log("Generated available slots:",_),F(_)}catch(p){console.error("Error fetching teacher slots:",p),F([])}finally{O(!1)}},l=r=>{I(p=>({...p,[r]:!p[r]}))},b=(r,p,y)=>{a(_=>({..._,[r]:{..._[r],[p]:y}})),f(_=>({..._,[`${r}.${p}`]:""}))},U=(r,p,y)=>{const _=[...o.academicInfo.instrumentProgress];p==="tests"?_[r]={..._[r],tests:y}:_[r]={..._[r],[p]:y},p==="isPrimary"&&y===!0&&_.forEach((P,z)=>{z!==r&&(P.isPrimary=!1)}),a(P=>({...P,academicInfo:{...P.academicInfo,instrumentProgress:_}}))},x=()=>{const r=o.academicInfo.instrumentProgress.some(p=>p.isPrimary);a(p=>({...p,academicInfo:{...p.academicInfo,instrumentProgress:[...p.academicInfo.instrumentProgress,{instrumentName:"",isPrimary:!r,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}]}}))},k=r=>{const p=o.academicInfo.instrumentProgress.filter((y,_)=>_!==r);p.length>0&&!p.some(y=>y.isPrimary)&&(p[0].isPrimary=!0),a(y=>({...y,academicInfo:{...y.academicInfo,instrumentProgress:p}}))},T=r=>{const p={teacherId:r.teacherId,day:r.day,time:r.startTime,duration:r.duration,isActive:!0,isRecurring:!0,...r.location&&{location:r.location}};a(y=>({...y,teacherAssignments:[...y.teacherAssignments,p],teacherIds:y.teacherIds.includes(r.teacherId)?y.teacherIds:[...y.teacherIds,r.teacherId]})),F(y=>y.filter(_=>_._id!==r._id)),V(!1)},B=(r,p)=>{const[y,_]=r.split(":").map(Number),P=y*60+_+p,z=Math.floor(P/60),te=P%60;return`${z.toString().padStart(2,"0")}:${te.toString().padStart(2,"0")}`},K=r=>{const p=o.teacherAssignments[r];a(y=>{const _=y.teacherAssignments.filter((z,te)=>te!==r),P=_.some(z=>z.teacherId===p.teacherId);return{...y,teacherAssignments:_,teacherIds:P?y.teacherIds:y.teacherIds.filter(z=>z!==p.teacherId)}})},G=()=>{const r={};o.personalInfo.fullName.trim()||(r["personalInfo.fullName"]="×©× ××œ× ×”×•× ×©×“×” ×—×•×‘×”"),o.personalInfo.phone&&!/^05\d{8}$/.test(o.personalInfo.phone)&&(r["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×“×•×’××”: 0501234567)"),o.personalInfo.parentPhone&&!/^05\d{8}$/.test(o.personalInfo.parentPhone)&&(r["personalInfo.parentPhone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),o.personalInfo.parentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.personalInfo.parentEmail)&&(r["personalInfo.parentEmail"]="××™××™×™×œ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),o.personalInfo.studentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.personalInfo.studentEmail)&&(r["personalInfo.studentEmail"]="××™××™×™×œ ×ª×œ××™×“ ×œ× ×ª×§×™×Ÿ"),o.academicInfo.class||(r["academicInfo.class"]="×›×™×ª×” ×”×™× ×©×“×” ×—×•×‘×”"),o.academicInfo.instrumentProgress.length===0?r["academicInfo.instruments"]="×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×›×œ×™ × ×’×™× ×” ××—×“":o.academicInfo.instrumentProgress.forEach((y,_)=>{y.instrumentName||(r[`instrument.${_}.name`]="×©× ×”×›×œ×™ ×”×•× ×©×“×” ×—×•×‘×”")});const p=o.academicInfo.instrumentProgress.some(y=>y.isPrimary);return o.academicInfo.instrumentProgress.length>0&&!p&&(r["academicInfo.primaryInstrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ ×¨××©×™"),f(r),Object.keys(r).length===0},ye=async r=>{if(r.preventDefault(),!!G()){d(!0);try{console.log("ğŸ“‹ Form data being submitted:",JSON.stringify(o,null,2)),console.log("ğŸ‘¥ Teacher assignments:",JSON.stringify(o.teacherAssignments,null,2)),console.log("ğŸ‘¨â€ğŸ« Teacher IDs:",o.teacherIds),await s(o)}catch(p){console.error("Error submitting form:",p),f({submit:"×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×"})}finally{d(!1)}}};return e.jsxs("form",{onSubmit:ye,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:c?"×¢×¨×™×›×ª ×ª×œ××™×“":"×”×•×¡×¤×ª ×ª×œ××™×“ ×—×“×©"}),e.jsx("button",{type:"button",onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(he,{className:"w-5 h-5"})})]}),i.submit&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:i.submit})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("personal"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××™×©×™×™×"})]}),h.personal?e.jsx(ue,{}):e.jsx(le,{})]}),h.personal&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ××œ× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.personalInfo.fullName,onChange:r=>b("personalInfo","fullName",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.fullName"]?"border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ××©×¤×—×” ×•××– ×©× ×¤×¨×˜×™ (×œ×“×•×’××”: ×›×”×Ÿ ×™×•×¡×™)"}),i["personalInfo.fullName"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×ª×œ××™×“"}),e.jsx("input",{type:"tel",value:o.personalInfo.phone,onChange:r=>b("personalInfo","phone",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.phone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),i["personalInfo.phone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×’×™×œ"}),e.jsx("input",{type:"number",value:o.personalInfo.age||"",onChange:r=>b("personalInfo","age",r.target.value?parseInt(r.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×’×™×œ ×”×ª×œ××™×“",min:"0",max:"99"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×ª×œ××™×“"}),e.jsx("input",{type:"email",value:o.personalInfo.studentEmail,onChange:r=>b("personalInfo","studentEmail",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.studentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"student@example.com"}),i["personalInfo.studentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.studentEmail"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª"}),e.jsx("input",{type:"text",value:o.personalInfo.address,onChange:r=>b("personalInfo","address",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×”×›× ×¡ ×›×ª×•×‘×ª ××œ××”"})]}),e.jsx("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-4",children:"×¤×¨×˜×™ ×”×•×¨×”"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×•×¨×”"}),e.jsx("input",{type:"text",value:o.personalInfo.parentName,onChange:r=>b("personalInfo","parentName",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×©× ×”×”×•×¨×”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×”×•×¨×”"}),e.jsx("input",{type:"tel",value:o.personalInfo.parentPhone,onChange:r=>b("personalInfo","parentPhone",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.parentPhone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),i["personalInfo.parentPhone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.parentPhone"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×”×•×¨×”"}),e.jsx("input",{type:"email",value:o.personalInfo.parentEmail,onChange:r=>b("personalInfo","parentEmail",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["personalInfo.parentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"parent@example.com"}),i["personalInfo.parentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["personalInfo.parentEmail"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("academic"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××§×“××™×™×"})]}),h.academic?e.jsx(ue,{}):e.jsx(le,{})]}),h.academic&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×™×ª×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:o.academicInfo.class,onChange:r=>b("academicInfo","class",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i["academicInfo.class"]?"border-red-500":"border-gray-300"}`,children:bs.map(r=>e.jsx("option",{value:r,children:r},r))}),i["academicInfo.class"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i["academicInfo.class"]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("instruments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×›×œ×™ × ×’×™× ×”"})]}),h.instruments?e.jsx(ue,{}):e.jsx(le,{})]}),h.instruments&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[i["academicInfo.instruments"]&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:i["academicInfo.instruments"]})}),i["academicInfo.primaryInstrument"]&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:i["academicInfo.primaryInstrument"]})}),e.jsxs("div",{className:"space-y-4",children:[o.academicInfo.instrumentProgress.map((r,p)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×›×œ×™ × ×’×™× ×” ",p+1]}),o.academicInfo.instrumentProgress.length>1&&e.jsx("button",{type:"button",onClick:()=>k(p),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["×©× ×”×›×œ×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.instrumentName,onChange:y=>U(p,"instrumentName",y.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${i[`instrument.${p}.name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),vs.map(y=>e.jsx("option",{value:y,children:y},y))]}),i[`instrument.${p}.name`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i[`instrument.${p}.name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×œ×‘ × ×•×›×—×™"}),e.jsx("select",{value:r.currentStage,onChange:y=>U(p,"currentStage",parseInt(y.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:js.map(y=>e.jsxs("option",{value:y,children:["×©×œ×‘ ",y]},y))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.isPrimary,onChange:y=>U(p,"isPrimary",y.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×›×œ×™ ×¨××©×™"})]})}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×©×œ×‘"}),e.jsx("select",{value:r.tests.stageTest.status,onChange:y=>U(p,"tests",{...r.tests,stageTest:{...r.tests.stageTest,status:y.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:nt.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×˜×›× ×™"}),e.jsx("select",{value:r.tests.technicalTest.status,onChange:y=>U(p,"tests",{...r.tests,technicalTest:{...r.tests.technicalTest,status:y.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:nt.map(y=>e.jsx("option",{value:y,children:y},y))})]})]})]})]},p)),e.jsxs("button",{type:"button",onClick:x,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors flex items-center justify-center gap-2 text-gray-600 hover:text-primary-600",children:[e.jsx(xe,{className:"w-4 h-4"}),"×”×•×¡×£ ×›×œ×™ × ×’×™× ×”"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("teachers"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××•×¨×™× ×•×©×™×¢×•×¨×™×"}),o.teacherAssignments.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:[o.teacherAssignments.length," ×©×™×‘×•×¦×™×"]})]}),h.teachers?e.jsx(ue,{}):e.jsx(le,{})]}),h.teachers&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[o.teacherAssignments.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×©×™×¢×•×¨×™× ××ª×•×›× × ×™×"}),e.jsx("div",{className:"space-y-2",children:o.teacherAssignments.map((r,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["××•×¨×” - ",R.find(y=>y._id===r.teacherId)?.professionalInfo?.instrument||"×›×œ×™"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.day," | ",r.time,"-",B(r.time,r.duration)," | ",r.duration," ×“×§×•×ª",r.location&&` | ${r.location}`]})]})]}),e.jsx("button",{type:"button",onClick:()=>K(p),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(Fe,{className:"w-4 h-4"})})]},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×‘×—×¨ ××•×¨×”"}),e.jsxs("select",{value:v,onChange:r=>C(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×"}),R.map(r=>e.jsxs("option",{value:r._id,children:[r.personalInfo?.fullName," - ",r.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"]},r._id))]})]}),v&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["×–×× ×™× ×¤× ×•×™×™× - ",R.find(r=>r._id===v)?.personalInfo?.fullName||"××•×¨×”"]}),!A&&L.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>V(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4"}),"×‘×—×¨ ×©×™×¢×•×¨ × ×•×¡×£"]})}),A&&!E&&L.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"×¡×™× ×•×Ÿ ×–×× ×™×"]}),(N.duration||N.selectedDays.length>0||N.startTime||N.endTime)&&e.jsxs("button",{type:"button",onClick:()=>$({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),"× ×§×” ×¡×™× ×•×Ÿ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×š ×©×™×¢×•×¨"}),e.jsxs("select",{value:N.duration||"",onChange:r=>$(p=>({...p,duration:r.target.value?Number(r.target.value):null})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"×›×œ ×”××©×›×™×"}),e.jsx("option",{value:"30",children:"30 ×“×§×•×ª"}),e.jsx("option",{value:"45",children:"45 ×“×§×•×ª"}),e.jsx("option",{value:"60",children:"60 ×“×§×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×™××™×"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-right flex items-center justify-between text-gray-900",onClick:r=>{const p=r.currentTarget.nextElementSibling;p&&p.classList.toggle("hidden")},children:[e.jsx("span",{className:"truncate",children:N.selectedDays.length>0?`${N.selectedDays.length} ×™××™× × ×‘×—×¨×•`:"×›×œ ×”×™××™×"}),e.jsx(le,{className:"w-4 h-4 flex-shrink-0"})]}),e.jsx("div",{className:"hidden absolute top-full mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg z-10",children:Ns.map(r=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N.selectedDays.includes(r),onChange:p=>{p.target.checked?$(y=>({...y,selectedDays:[...y.selectedDays,r]})):$(y=>({...y,selectedDays:y.selectedDays.filter(_=>_!==r)}))},className:"ml-2 text-primary-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:r})]},r))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×¢×”"}),e.jsx("input",{type:"time",value:N.startTime,onChange:r=>$(p=>({...p,startTime:r.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×¢×“ ×©×¢×”"}),e.jsx("input",{type:"time",value:N.endTime,onChange:r=>$(p=>({...p,endTime:r.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]})]})]}),E?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"×˜×•×¢×Ÿ ×–×× ×™× ×¤× ×•×™×™×..."})]}):A&&L.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–××Ÿ ×•××©×š ×©×™×¢×•×¨ ××”××¤×©×¨×•×™×•×ª ×”×–××™× ×•×ª:"}),(()=>{const r=L.filter(y=>!(N.duration&&y.duration!==N.duration||N.selectedDays.length>0&&!N.selectedDays.includes(y.day)||N.startTime&&y.startTime<N.startTime||N.endTime&&y.endTime>N.endTime));if(r.length===0)return e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×”×ª×•×××™× ×œ×¡×™× ×•×Ÿ ×©×‘×—×¨×ª"}),e.jsx("button",{type:"button",onClick:()=>$({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700",children:"× ×§×” ×¡×™× ×•×Ÿ ×•×ª×¨××” ××ª ×›×œ ×”×–×× ×™×"})]});const p=r.reduce((y,_)=>(y[_.day]||(y[_.day]=[]),y[_.day].push(_),y),{});return Object.entries(p).map(([y,_])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),y]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:_.sort((P,z)=>P.startTime.localeCompare(z.startTime)).map(P=>e.jsx("button",{type:"button",onClick:()=>T(P),className:`p-3 border rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-right ${P.duration===30?"border-green-300 bg-green-50":P.duration===45?"border-blue-300 bg-blue-50":"border-purple-300 bg-purple-50"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[P.startTime,"-",P.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${P.duration===30?"bg-green-100 text-green-800":P.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[P.duration," ×“×§×³"]})]}),P.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ve,{className:"w-3 h-3"}),P.location]}),e.jsx("div",{className:"text-xs text-gray-600",children:P.instrument})]})},P._id))})]},y))})()]}):v&&!E&&A&&L.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×¤× ×•×™×™× ×œ××•×¨×” ×–×”"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×”××•×¨×” ×œ× ×”×’×“×™×¨ ×–×× ×™ ×”×•×¨××”"})]}):null]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("enrollments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×¨×©××•×ª"})]}),h.enrollments?e.jsx(ue,{}):e.jsx(le,{})]}),h.enrollments&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×–××•×¨×ª"}),e.jsxs("select",{value:o.enrollments.orchestraIds[0]||"",onChange:r=>{a(p=>({...p,enrollments:{...p.enrollments,orchestraIds:r.target.value?[r.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),D.map(r=>{const p=r.rehearsalSchedule||r.schedule&&r.schedule[0]||r.rehearsals&&r.rehearsals[0]||null;let y=r.name;if(p){const _=p.day||p.dayOfWeek||"",P=p.startTime||"",z=p.endTime||"",te=p.location||r.location||"";_&&P&&z&&(y+=` | ${_} ${P}-${z}`),te&&(y+=` | ${te}`)}else r.location&&(y+=` | ${r.location}`);return e.jsx("option",{value:r._id,children:y},r._id)})]}),o.enrollments.orchestraIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200",children:(()=>{const r=D.find(p=>p._id===o.enrollments.orchestraIds[0]);return r?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-purple-900",children:r.name}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[r.rehearsalSchedule&&e.jsxs("div",{className:"p-2 bg-purple-100 rounded",children:[e.jsx("strong",{children:"×–×× ×™ ×—×–×¨×•×ª:"})," ",r.rehearsalSchedule.day," ",r.rehearsalSchedule.startTime,"-",r.rehearsalSchedule.endTime,r.rehearsalSchedule.location&&e.jsxs("span",{children:[" | ",r.rehearsalSchedule.location]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×•×’:"})," ",r.type||"×ª×–××•×¨×ª"]}),!r.rehearsalSchedule&&r.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"××™×§×•×:"})," ",r.location]}),r.memberIds&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×‘×¨×™×:"})," ",r.memberIds.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×˜×˜×•×¡:"})," ",r.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"]}),r.rehearsalIds&&r.rehearsalIds.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×–×¨×•×ª ×©××•×¨×•×ª:"})," ",r.rehearsalIds.length]})]})]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),e.jsxs("select",{value:o.enrollments.theoryLessonIds[0]||"",onChange:r=>{a(p=>({...p,enrollments:{...p.enrollments,theoryLessonIds:r.target.value?[r.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),g.map(r=>{const p=r.schedule&&r.schedule.length>0?r.schedule[0]:null,y=p?`${p.day} ${p.startTime}-${p.endTime}${p.location?` | ${p.location}`:""}`:"";return e.jsxs("option",{value:r._id,children:[r.name||r.title||r.category," ",y?`| ${y}`:"",r.teacher?.personalInfo?.fullName&&` | ××•×¨×”: ${r.teacher.personalInfo.fullName}`]},r._id)})]}),o.enrollments.theoryLessonIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(()=>{const r=g.find(p=>p._id===o.enrollments.theoryLessonIds[0]);return r?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:r.name}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"×¨××”:"})," ",r.level]}),r.teacher?.personalInfo?.fullName&&e.jsxs("div",{children:[e.jsx("strong",{children:"××•×¨×”:"})," ",r.teacher.personalInfo.fullName]}),r.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×™××•×¨:"})," ",r.description]}),r.maxStudents&&e.jsxs("div",{children:[e.jsx("strong",{children:"××§×¡×™××•× ×ª×œ××™×“×™×:"})," ",r.maxStudents]}),r.currentStudents!==void 0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×œ××™×“×™× × ×•×›×—×™×™×:"})," ",r.currentStudents,"/",r.maxStudents||"âˆ"]}),r.schedule&&r.schedule.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×–×× ×™ ×©×™×¢×•×¨:"}),e.jsx("div",{className:"mt-1 space-y-1",children:r.schedule.map((p,y)=>e.jsxs("div",{className:"text-xs bg-blue-100 px-2 py-1 rounded",children:[p.day," ",p.startTime,"-",p.endTime,p.location&&` | ${p.location}`]},y))})]}),r.prerequisites&&e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[e.jsx("strong",{children:"×“×¨×™×©×•×ª ×§×“×:"})," ",r.prerequisites]})]})]}):null})()})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:n,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4"}),c?"×¢×“×›×Ÿ ×ª×œ××™×“":"×”×•×¡×£ ×ª×œ××™×“"]})})]})]})},Ve=["××•×œ× ×¢×¨×Ÿ","×¡×˜×•×“×™×• ×§×××¨×™ 1","×¡×˜×•×“×™×• ×§×××¨×™ 2","××•×œ×¤×Ÿ ×”×§×œ×˜×•×ª","×—×“×¨ ×—×–×¨×•×ª 1","×—×“×¨ ×—×–×¨×•×ª 2","×—×“×¨ ××—×©×‘×™×","×—×“×¨ 1","×—×“×¨ 2","×—×“×¨ ×—×–×¨×•×ª","×—×“×¨ 5","×—×“×¨ 6","×—×“×¨ 7","×—×“×¨ 8","×—×“×¨ 9","×—×“×¨ 10","×—×“×¨ 11","×—×“×¨ 12","×—×“×¨ 13","×—×“×¨ 14","×—×“×¨ 15","×—×“×¨ 16","×—×“×¨ 17","×—×“×¨ 18","×—×“×¨ 19","×—×“×¨ 20","×—×“×¨ 21","×—×“×¨ 22","×—×“×¨ 23","×—×“×¨ 24","×—×“×¨ 25","×—×“×¨ 26","×—×“×¨ ×ª××•×¨×™×” ×","×—×“×¨ ×ª××•×¨×™×” ×‘"],Is=["××•×¨×”","×× ×¦×—","××“×¨×™×š ×”×¨×›×‘","×× ×”×œ","××•×¨×” ×ª××•×¨×™×”","××’××”"],Ss=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],ks=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","××•×¨×’×Ÿ","×—×¨××•× ×™×§×”","×× ×“×•×œ×™× ×”","×›×™× ×•×¨ ×‘××¨×•×§","×•×™×•×œ×” ×“×” ×’××‘×”","×¤×œ×•×˜×” ×¨×§×•×¨×“×¨","××•×§×¨×™× ×”","×—×œ×™×œ ×¤××Ÿ","×“×•×œ×¦×™××¨","××•×˜×•-×”×¨×¤","×¤×¡× ×ª×¨ ××œ×§×˜×¨×•× ×™","×’×™×˜×¨×” ×‘×¡","×’×™×˜×¨×” ××§×•×¡×˜×™×ª","×’×™×˜×¨×” ×§×œ××¡×™×ª","×‘× ×’×³×•","×—×œ×™×œ ××™×¨×™","×›×™× ×•×¨ ×§×œ×˜×™","×‘×•×“×”×¨××Ÿ"],Ye=(t,s)=>{if(!t||!s)return 0;const[n,c]=t.split(":").map(Number),[o,a]=s.split(":").map(Number),i=n*60+c,f=o*60+a;return f<=i?0:f-i},lt=(t,s)=>{if(!t||!s)return null;const n=Ye(t,s);return n<=0?"×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":n<30?"×™×•× ×œ×™××•×“ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 30 ×“×§×•×ª":n>480?"×™×•× ×œ×™××•×“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-8 ×©×¢×•×ª":null},Ds=({isOpen:t,onClose:s,onTeacherAdded:n,teacherToEdit:c,mode:o="add"})=>{const{currentSchoolYear:a}=wt(),[i,f]=u.useState("personal"),[m,d]=u.useState({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),[h,I]=u.useState([]),[R,S]=u.useState([]),[L,F]=u.useState(!1),[D,H]=u.useState({}),[g,j]=u.useState("");u.useEffect(()=>{t&&o==="edit"&&c?C(c):t&&o==="add"&&l()},[t,o,c]),u.useEffect(()=>{t&&v()},[t]);const v=async()=>{try{const[x,k]=await Promise.all([Q.orchestras.getOrchestras(),Q.orchestras.getOrchestras({type:"ensemble"})]);I(x||[]),S(k||[])}catch(x){console.error("Failed to load orchestras/ensembles:",x)}},C=x=>{d({personalInfo:{fullName:x.personalInfo?.fullName||"",phone:x.personalInfo?.phone||"",email:x.personalInfo?.email||"",address:x.personalInfo?.address||""},roles:x.roles||[],professionalInfo:{instrument:x.professionalInfo?.instrument||"",isActive:x.professionalInfo?.isActive??!0},teaching:{schedule:x.teaching?.schedule||[]},conducting:{orchestraIds:x.conducting?.orchestraIds||[]},ensemblesIds:x.ensemblesIds||[]})},E=()=>{const x={};return m.personalInfo.fullName.trim()||(x["personalInfo.fullName"]="×©× ××œ× × ×“×¨×©"),m.personalInfo.phone.match(/^05\d{8}$/)||(x["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¤×•×¨××˜: 05XXXXXXXX"),m.personalInfo.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(x["personalInfo.email"]="×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”"),m.personalInfo.address.trim()||(x["personalInfo.address"]="×›×ª×•×‘×ª × ×“×¨×©×ª"),m.roles.length===0&&(x.roles="×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×ª×¤×§×™×“ ××—×“"),(m.roles.includes("××•×¨×”")||m.roles.includes("××’××”")||!m.roles.includes("××•×¨×” ×ª××•×¨×™×”"))&&!m.professionalInfo.instrument&&(x["professionalInfo.instrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ × ×’×™× ×”"),m.teaching.schedule.forEach((T,B)=>{if(T.startTime||(x[`schedule.${B}.startTime`]="×©×¢×ª ×”×ª×—×œ×” × ×“×¨×©×ª"),T.endTime||(x[`schedule.${B}.endTime`]="×©×¢×ª ×¡×™×•× × ×“×¨×©×ª"),T.location?Ve.includes(T.location)||(x[`schedule.${B}.location`]="××™×§×•× ×œ× ×ª×§×™×Ÿ"):x[`schedule.${B}.location`]="×™×© ×œ×‘×—×•×¨ ××™×§×•×",T.startTime&&T.endTime){const K=lt(T.startTime,T.endTime);K&&(x[`schedule.${B}.timeRange`]=K)}}),H(x),Object.keys(x).length===0},O=(x,k,T)=>{d(K=>({...K,[x]:{...K[x],[k]:T}}));const B=`${x}.${k}`;D[B]&&H(K=>{const G={...K};return delete G[B],G})},N=(x,k)=>{const T=k?[...m.roles,x]:m.roles.filter(B=>B!==x);d(B=>({...B,roles:T})),D.roles&&H(B=>{const K={...B};return delete K.roles,K})},$=()=>{const x={day:"×¨××©×•×Ÿ",startTime:"14:00",endTime:"15:30",location:"",notes:""};d(k=>({...k,teaching:{...k.teaching,schedule:[...k.teaching.schedule,x]}}))},A=x=>{d(k=>({...k,teaching:{...k.teaching,schedule:k.teaching.schedule.filter((T,B)=>B!==x)}}))},V=(x,k,T)=>{d(B=>({...B,teaching:{...B.teaching,schedule:B.teaching.schedule.map((K,G)=>G===x?{...K,[k]:T}:K)}}))},ee=async x=>{if(x.preventDefault(),!!E()){F(!0),j("");try{const k={personalInfo:m.personalInfo,roles:m.roles,professionalInfo:m.professionalInfo,teaching:{studentIds:[],schedule:m.teaching.schedule.map(T=>({day:T.day,startTime:T.startTime,endTime:T.endTime,duration:Ye(T.startTime,T.endTime),location:T.location||null,notes:T.notes||null,isAvailable:!0,studentId:null,recurring:{isRecurring:!0,excludeDates:[]}}))},conducting:m.conducting,ensemblesIds:m.ensemblesIds,schoolYears:a?[{schoolYearId:a._id,isActive:!0}]:[],credentials:{email:m.personalInfo.email,password:null,isInvitationAccepted:!1},isActive:!0};if(o==="edit"&&c){console.log("ğŸ”„ Updating teacher:",k);const T=await Q.teachers.updateTeacher(c._id,k);console.log("âœ… Teacher updated successfully:",T),n(T)}else{console.log("ğŸ”„ Creating teacher:",k);const T=await Q.teachers.addTeacher(k);console.log("âœ… Teacher created successfully:",T),n(T)}l(),s()}catch(k){console.error(`âŒ Failed to ${o==="edit"?"update":"create"} teacher:`,k),j(k.message||`×©×’×™××” ×‘${o==="edit"?"×¢×“×›×•×Ÿ":"×™×¦×™×¨×ª"} ×”××•×¨×”. × ×¡×” ×©×•×‘.`)}finally{F(!1)}}},l=()=>{d({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),f("personal"),H({}),j("")},b=()=>{l(),s()};if(!t)return null;const U=[{id:"personal",label:"××™×“×¢ ××™×©×™",icon:de},{id:"professional",label:"××™×“×¢ ××§×¦×•×¢×™",icon:zt},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:re},{id:"conducting",label:"× ×™×¦×•×—",icon:Ne}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[85vh] overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:o==="edit"?"×¢×¨×™×›×ª ×¤×¨×˜×™ ××•×¨×”":"×”×•×¡×¤×ª ××•×¨×” ×—×“×©"}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:U.map(({id:x,label:k,icon:T})=>e.jsxs("button",{onClick:()=>f(x),className:`flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${i===x?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(T,{className:"w-4 h-4"}),k]},x))})}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[i==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ××œ× *"}),e.jsx("input",{type:"text",value:m.personalInfo.fullName,onChange:x=>O("personalInfo","fullName",x.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${D["personalInfo.fullName"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×”×›× ×¡ ×©× ××œ×"}),D["personalInfo.fullName"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ *"}),e.jsx("input",{type:"tel",value:m.personalInfo.phone,onChange:x=>O("personalInfo","phone",x.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${D["personalInfo.phone"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"05XXXXXXXX"}),D["personalInfo.phone"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ *"}),e.jsx("input",{type:"email",value:m.personalInfo.email,onChange:x=>O("personalInfo","email",x.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${D["personalInfo.email"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"teacher@example.com"}),D["personalInfo.email"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D["personalInfo.email"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª *"}),e.jsx("input",{type:"text",value:m.personalInfo.address,onChange:x=>O("personalInfo","address",x.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${D["personalInfo.address"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×¨×—×•×‘ ××¡×¤×¨, ×¢×™×¨"}),D["personalInfo.address"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D["personalInfo.address"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×ª×¤×§×™×“×™× *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Is.map(x=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:m.roles.includes(x),onChange:k=>N(x,k.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 w-4 h-4"}),e.jsx("span",{className:"mr-3 text-sm text-gray-700 font-medium",children:x})]},x))}),D.roles&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D.roles})]})]}),i==="professional"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×œ×™ × ×’×™× ×” ",!m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&"*"]}),e.jsxs("select",{value:m.professionalInfo.instrument,onChange:x=>O("professionalInfo","instrument",x.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 bg-white ${D["professionalInfo.instrument"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,disabled:m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&m.roles.length===1,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),ks.map(x=>e.jsx("option",{value:x,children:x},x))]}),D["professionalInfo.instrument"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D["professionalInfo.instrument"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.professionalInfo.isActive,onChange:x=>O("professionalInfo","isActive",x.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"××•×¨×” ×¤×¢×™×œ"})]})})]}),i==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"×‘×œ×•×§×™ ×–××Ÿ ×œ×”×•×¨××”"}),e.jsxs("button",{type:"button",onClick:$,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 ml-2"}),"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ"]})]}),m.teaching.schedule.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"×œ× ×”×•×’×“×¨×• ×‘×œ×•×§×™ ×–××Ÿ"}),e.jsx("p",{className:"text-sm",children:"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ ×›×“×™ ×œ×§×‘×•×¢ ××ª×™ ×”××•×¨×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}):e.jsx("div",{className:"space-y-4",children:m.teaching.schedule.map((x,k)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×™×•×"}),e.jsx("select",{value:x.day,onChange:T=>V(k,"day",T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white",children:Ss.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:x.startTime,onChange:T=>V(k,"startTime",T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:x.endTime,onChange:T=>V(k,"endTime",T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"}),x.startTime&&x.endTime&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const T=Ye(x.startTime,x.endTime),B=lt(x.startTime,x.endTime);return B?e.jsx("span",{className:"text-red-600",children:B}):T>0?e.jsxs("span",{className:"text-gray-500",children:["××©×š: ",T," ×“×§×•×ª"]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××™×§×•×"}),e.jsxs("select",{value:x.location,onChange:T=>V(k,"location",T.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white ${D[`schedule.${k}.location`]?"border-red-300 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×..."}),Ve.map(T=>e.jsx("option",{value:T,children:T},T))]}),D[`schedule.${k}.location`]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:D[`schedule.${k}.location`]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×”×¢×¨×•×ª"}),e.jsx("input",{type:"text",value:x.notes,onChange:T=>V(k,"notes",T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500 bg-white",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>A(k),className:"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4 ml-1"}),"×”×¡×¨"]})})]},k))})]}),i==="conducting"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×ª×–××•×¨×•×ª ×œ× ×™×¦×•×—"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×ª×–××•×¨×•×ª ×©×”××•×¨×” ×™× ×¦×—"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:h.map(x=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-purple-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.conducting.orchestraIds.includes(x._id),onChange:k=>{const T=k.target.checked?[...m.conducting.orchestraIds,x._id]:m.conducting.orchestraIds.filter(B=>B!==x._id);O("conducting","orchestraIds",T)},className:"rounded-lg border-gray-300 text-purple-600 focus:ring-purple-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-purple-700 transition-colors",children:x.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:x.description||"×ª×–××•×¨×ª ×œ×œ× ×ª×™××•×¨"}),x.memberCount&&e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["ğŸ‘¥ ",x.memberCount," ×—×‘×¨×™×"]})]})]},x._id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×× ×¡××‘×œ×™× ×œ×”×“×¨×›×”"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×× ×¡××‘×œ×™× ×©×”××•×¨×” ×™×“×¨×™×š"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:R.map(x=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.ensemblesIds.includes(x._id),onChange:k=>{const T=k.target.checked?[...m.ensemblesIds,x._id]:m.ensemblesIds.filter(B=>B!==x._id);d(B=>({...B,ensemblesIds:T}))},className:"rounded-lg border-gray-300 text-green-600 focus:ring-green-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-green-700 transition-colors",children:x.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:x.description||"×× ×¡××‘×œ ×œ×œ× ×ª×™××•×¨"}),x.memberCount&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ğŸµ ",x.memberCount," ×—×‘×¨×™×"]})]})]},x._id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:g})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:L,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:L,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[L?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),L?"×©×•××¨...":o==="edit"?"×¢×“×›×Ÿ ××•×¨×”":"×©××•×¨ ××•×¨×”"]})]})]})]})]})})};function Cs({theoryLesson:t,theoryLessons:s,teachers:n,onSubmit:c,onCancel:o,mode:a="create"}){const[i,f]=u.useState("single"),[m,d]=u.useState({category:"××’××”",teacherId:"",date:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],attendance:{present:[],absent:[]},notes:"",syllabus:"",homework:"",schoolYearId:""}),[h,I]=u.useState({category:"××’××”",teacherId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:"",syllabus:"",excludeDates:[],schoolYearId:""}),[R,S]=u.useState(n||[]),[L,F]=u.useState(!1),[D,H]=u.useState(!1),[g,j]=u.useState(""),[v,C]=u.useState(""),E=["×ª×œ××™×“×™× ×—×“×©×™× ×‘-×“","××ª×—×™×œ×™×","××ª×—×™×œ×™× ×‘","××ª×—×™×œ×™× ×“","××ª×§×“××™× ×‘","××ª×§×“××™× ×","××ª×§×“××™× ×’","×ª×œ××™×“×™× ×—×“×©×™× ×‘×•×’×¨×™× (×” - ×˜)","×ª×œ××™×“×™× ×—×“×©×™× ×¦×¢×™×¨×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×§×œ××¡×™ ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×‘","××’××”","×ª××•×¨×™×” ×›×œ×™"],O={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"};u.useEffect(()=>{n||N(),$()},[n]),u.useEffect(()=>{if(a==="edit"&&t){const l=new Date(t.date);d({category:t.category||"××’××”",teacherId:t.teacherId||"",date:t.date?new Date(t.date).toISOString().split("T")[0]:"",dayOfWeek:t.dayOfWeek!==void 0?t.dayOfWeek:l.getDay(),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||"××•×œ× ×¢×¨×Ÿ",studentIds:t.studentIds||[],attendance:t.attendance||{present:[],absent:[]},notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||""}),I(b=>({...b,category:t.category||"××’××”",teacherId:t.teacherId||"",location:t.location||"××•×œ× ×¢×¨×Ÿ",startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",notes:t.notes||"",syllabus:t.syllabus||"",schoolYearId:t.schoolYearId||""}))}else if(a==="bulk-edit"&&s&&s.length>0){const l=s[0],b=s.every(G=>G.category===l.category)?l.category:"",U=s.every(G=>G.teacherId===l.teacherId)?l.teacherId:"",x=s.every(G=>G.location===l.location)?l.location:"",k=s.every(G=>G.startTime===l.startTime)?l.startTime:"",T=s.every(G=>G.endTime===l.endTime)?l.endTime:"",B=s.every(G=>G.notes===l.notes)?l.notes:"",K=s.every(G=>G.syllabus===l.syllabus)?l.syllabus:"";I({category:b||"××’××”",teacherId:U||"",startDate:"",endDate:"",dayOfWeek:0,startTime:k||"14:00",endTime:T||"15:00",location:x||"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:B||"",syllabus:K||"",excludeDates:[],schoolYearId:l.schoolYearId||""})}},[t,s,a]);const N=async()=>{try{const b=(await Vt.getTeachers()).filter(U=>U.roles&&U.roles.includes("××•×¨×” ×ª××•×¨×™×”"));S(b)}catch(l){console.error("Error loading teachers:",l)}},$=async()=>{try{const l=await Yt.getCurrentSchoolYear();l&&(m.schoolYearId||d(b=>({...b,schoolYearId:l._id})),h.schoolYearId||I(b=>({...b,schoolYearId:l._id})))}catch(l){console.error("Error loading current school year:",l)}},A=(l,b)=>{if(a==="edit"||a==="create"&&i==="single"){if(d(U=>({...U,[l]:b})),l==="date"&&b){const x=new Date(b).getDay();d(k=>({...k,date:b,dayOfWeek:x}))}}else I(U=>({...U,[l]:b}))},V=()=>{if(i==="single"){if(!m.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨"),!1;if(!m.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨"),!1;if(!m.date)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ×©×™×¢×•×¨"),!1;if(!m.startTime||!m.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!m.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨"),!1;const l=m.startTime.split(":").map(Number),b=m.endTime.split(":").map(Number),U=l[0]*60+l[1];if(b[0]*60+b[1]<=U)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}else{if(!h.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.startDate||!h.endDate)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×›×™ ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.startTime||!h.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨×™×"),!1;if(h.dayOfWeek<0||h.dayOfWeek>6)return j("×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),!1;if(!h.schoolYearId)return j("×™×© ×œ×‘×—×•×¨ ×©× ×ª ×œ×™××•×“×™×"),!1;if(new Date(h.endDate)<=new Date(h.startDate))return j("×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),!1;const l=h.startTime.split(":").map(Number),b=h.endTime.split(":").map(Number),U=l[0]*60+l[1];if(b[0]*60+b[1]<=U)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}return!0},ee=async l=>{if(l.preventDefault(),j(""),C(""),!!V()){F(!0);try{if(a==="edit"){const b={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"edit",lessonId:t?._id};await c(b),C("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”")}else if(a==="bulk-edit"){const b={};h.category&&h.category.trim()&&(b.category=h.category),h.teacherId&&h.teacherId.trim()&&(b.teacherId=h.teacherId),h.location&&h.location.trim()&&(b.location=h.location),h.startTime&&h.startTime.trim()&&(b.startTime=h.startTime),h.endTime&&h.endTime.trim()&&(b.endTime=h.endTime),h.notes&&h.notes.trim()&&(b.notes=h.notes),h.syllabus&&h.syllabus.trim()&&(b.syllabus=h.syllabus);const U={mode:"bulk-edit",lessonIds:s?.map(x=>x._id)||[],updateData:b};await c(U),C(`${s?.length||0} ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”`)}else if(i==="single"){const b={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"create"};await c(b),C("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}else{const b={...h,isBulk:!0,mode:"bulk-create"};console.log("ğŸš€ Bulk theory lesson creation data:",JSON.stringify(b,null,2));const x=["category","teacherId","startDate","endDate","dayOfWeek","startTime","endTime","location","schoolYearId"].filter(k=>{const T=b[k];return T==null||typeof T=="string"&&T.trim()===""});if(x.length>0){console.error("âŒ Missing required fields:",x),j(`×—×¡×¨×™× ×©×“×•×ª ×—×•×‘×”: ${x.join(", ")}`);return}await c(b),C("×¨×¦×£ ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}}catch(b){console.error("Error submitting theory lesson form:",b),j(b.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×©×™×¢×•×¨")}finally{F(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a==="edit"?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":a==="bulk-edit"?"×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”":"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(he,{className:"w-5 h-5 text-gray-500"})})]}),a==="create"&&e.jsxs("div",{className:"flex space-x-4 rtl:space-x-reverse",children:[e.jsxs("button",{type:"button",onClick:()=>f("single"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${i==="single"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(re,{className:"w-4 h-4 ml-2"}),"×©×™×¢×•×¨ ×‘×•×“×“"]}),e.jsxs("button",{type:"button",onClick:()=>f("bulk"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${i==="bulk"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Xt,{className:"w-4 h-4 ml-2"}),"×¨×¦×£ ×©×™×¢×•×¨×™×"]})]}),a==="bulk-edit"&&s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 text-blue-600 ml-2"}),e.jsxs("p",{className:"text-blue-800",children:["×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ",s.length," ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"]})]}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"×©×“×•×ª ×¨×™×§×™× ×™×™×©××¨×• ×œ×œ× ×©×™× ×•×™, ×¨×§ ×©×“×•×ª ×©×™××•×œ××• ×™×¢×•×“×›× ×•"})]})]}),e.jsxs("form",{onSubmit:ee,className:"p-6 space-y-6",children:[D&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 ml-2"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×™×¢×•×¨..."})]})}),v&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800 text-sm",children:v})}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:g})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(we,{className:"w-4 h-4 inline ml-1"}),"×§×˜×’×•×¨×™×” *"]}),e.jsxs("select",{value:a==="edit"||a==="create"&&i==="single"?m.category:h.category,onChange:l=>A("category",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:a!=="bulk-edit",children:[a==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),E.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××•×¨×” *"}),e.jsxs("select",{value:a==="edit"||a==="create"&&i==="single"?m.teacherId:h.teacherId,onChange:l=>A("teacherId",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:a!=="bulk-edit",children:[e.jsx("option",{value:"",children:a==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™":"×‘×—×¨ ××•×¨×”"}),R.map(l=>e.jsx("option",{value:l._id,children:l.personalInfo?.fullName},l._id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× *"]}),e.jsxs("select",{value:a==="edit"||a==="create"&&i==="single"?m.location:h.location,onChange:l=>A("location",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:a!=="bulk-edit",children:[a==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),Ve.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),a==="edit"||a==="create"&&i==="single"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š *"}),e.jsx("input",{type:"date",value:m.date,onChange:l=>A("date",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("input",{type:"text",value:O[m.dayOfWeek]||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:m.startTime,onChange:l=>A("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:m.endTime,onChange:l=>A("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]}):a==="bulk-edit"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:l=>A("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:h.endTime,onChange:l=>A("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×”×ª×—×œ×” *"}),e.jsx("input",{type:"date",value:h.startDate,onChange:l=>A("startDate",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•× *"}),e.jsx("input",{type:"date",value:h.endDate,onChange:l=>A("endDate",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:h.dayOfWeek,onChange:l=>A("dayOfWeek",parseInt(l.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0,children:Object.entries(O).map(([l,b])=>e.jsx("option",{value:l,children:b},l))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:l=>A("startTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:h.endTime,onChange:l=>A("endTime",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×™×œ×‘×•×¡"}),e.jsx("textarea",{value:a==="edit"||a==="create"&&i==="single"?m.syllabus:h.syllabus,onChange:l=>A("syllabus",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:a==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - × ×•×©××™ ×”×©×™×¢×•×¨...":a==="edit"||i==="single"?"× ×•×©××™ ×”×©×™×¢×•×¨...":"× ×•×©××™ ×”×©×™×¢×•×¨×™×..."})]}),a==="edit"||a==="create"&&i==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨×™ ×‘×™×ª"}),e.jsx("textarea",{value:m.homework,onChange:l=>A("homework",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"××©×™××•×ª ×œ×‘×™×ª..."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:a==="edit"||a==="create"&&i==="single"?m.notes:h.notes,onChange:l=>A("notes",l.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:a==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª...":"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:L,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:L,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[L?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(He,{className:"w-4 h-4 ml-2"}),a==="edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨":a==="bulk-edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨×™×":i==="single"?"×¦×•×¨ ×©×™×¢×•×¨":"×¦×•×¨ ×¨×¦×£ ×©×™×¢×•×¨×™×"]})]})]})]})})}const St={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"},Es=Object.entries(St).map(([t,s])=>({value:parseInt(t),label:s})),qe=t=>St[t]||"×œ× ×™×“×•×¢",_s=t=>{const s=new Date(t.date).toLocaleDateString("he-IL"),n=`${t.startTime} - ${t.endTime}`,c=qe(t.dayOfWeek),o=`${c}, ${s} ${n}`;return{date:s,time:n,dayName:c,fullDateTime:o}},Ce=(t,s)=>{const n=ce(t);return ce(s)-n},ce=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},ot=t=>{const s=t.attendance?.present?.length||0,n=t.attendance?.absent?.length||0,c=t.orchestra?.memberIds?.length||s+n,o=c>0?Math.round(s/c*100):0;return{presentCount:s,absentCount:n,totalMembers:c,attendanceRate:o,hasAttendanceData:s>0||n>0}},As=t=>{if(!t.isActive)return{status:"cancelled",text:"×‘×•×˜×œ×”",colorClass:"bg-gray-100 text-gray-800"};const s=new Date;new Date(t.date);const n=new Date(`${t.date}T${t.startTime}:00`),c=new Date(`${t.date}T${t.endTime}:00`);return s<n?{status:"upcoming",text:"×¢×ª×™×“×”",colorClass:"bg-blue-100 text-blue-800"}:s>=n&&s<=c?{status:"in_progress",text:"××ª×§×™×™××ª ×›×¢×ª",colorClass:"bg-green-100 text-green-800"}:{status:"completed",text:"×”×¡×ª×™×™××”",colorClass:"bg-orange-100 text-orange-800"}},it=(t,s)=>{if(t.date!==s.date)return{hasConflict:!1,conflictType:"none",severity:"none",message:""};if(t.groupId===s.groupId)return{hasConflict:!1,conflictType:"none",severity:"none",message:"××•×ª×” ×ª×–××•×¨×ª"};const n=ce(t.startTime),c=ce(t.endTime),o=ce(s.startTime),a=ce(s.endTime);if(n<a&&o<c){if(t.location===s.location)return{hasConflict:!0,conflictType:"location",severity:"critical",message:`×—×¤×™×¤×” ×‘××™×§×•×: ${t.location}`};const f=t.orchestra?.conductor?._id,m=s.orchestra?.conductor?._id;if(f&&m&&f===m)return{hasConflict:!0,conflictType:"conductor",severity:"critical",message:"××•×ª×• ×× ×¦×— ×‘×©× ×™ ××§×•××•×ª"};const d=new Set(t.orchestra?.memberIds||[]),h=new Set(s.orchestra?.memberIds||[]),I=[...d].filter(R=>h.has(R));return I.length>0?{hasConflict:!0,conflictType:"members",severity:"warning",message:`${I.length} ×—×‘×¨×™× ××©×•×ª×¤×™×`}:{hasConflict:!0,conflictType:"time",severity:"warning",message:"×—×¤×™×¤×ª ×–×× ×™×"}}return{hasConflict:!1,conflictType:"none",severity:"none",message:""}},Nr=(t,s)=>t.filter(n=>{if(s.searchQuery){const c=s.searchQuery.toLowerCase();if(!(n.orchestra?.name?.toLowerCase().includes(c)||n.location?.toLowerCase().includes(c)||n.notes?.toLowerCase().includes(c)||qe(n.dayOfWeek).toLowerCase().includes(c)))return!1}if(s.orchestraId&&n.groupId!==s.orchestraId||s.type&&n.type!==s.type||s.dayOfWeek!==""&&s.dayOfWeek!==void 0&&n.dayOfWeek!==s.dayOfWeek||s.location&&n.location!==s.location)return!1;if(s.startDate){const c=new Date(n.date),o=new Date(s.startDate);if(c<o)return!1}if(s.endDate){const c=new Date(n.date),o=new Date(s.endDate);if(c>o)return!1}return!(s.status&&s.status!=="all"&&As(n).status!==s.status||s.isActive!==void 0&&n.isActive!==s.isActive)}),wr=(t,s="date",n="asc")=>[...t].sort((o,a)=>{let i=0;switch(s){case"date":i=new Date(o.date).getTime()-new Date(a.date).getTime();break;case"time":i=ce(o.startTime)-ce(a.startTime);break;case"orchestra":const f=o.orchestra?.name||"",m=a.orchestra?.name||"";i=f.localeCompare(m,"he");break;case"location":i=o.location.localeCompare(a.location,"he");break;case"attendance":const d=ot(o).attendanceRate,h=ot(a).attendanceRate;i=d-h;break;case"duration":const I=Ce(o.startTime,o.endTime),R=Ce(a.startTime,a.endTime);i=I-R;break;default:i=0}return n==="desc"?-i:i}),Rs=t=>{const s=[],n=new Date(t.startDate),c=new Date(t.endDate),o=t.dayOfWeek,a=new Set(t.excludeDates||[]),i=new Date(n);for(;i.getDay()!==o&&i<=c;)i.setDate(i.getDate()+1);for(;i<=c;){const f=i.toISOString().split("T")[0];a.has(f)||s.push(f),i.setDate(i.getDate()+7)}return s},Os=t=>{const s={};if(t.groupId?.trim()||(s.groupId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.type||(s.type="×™×© ×œ×‘×—×•×¨ ×¡×•×’ ×”×¨×›×‘"),!t.date)s.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const n=new Date(t.date),c=new Date;c.setHours(0,0,0,0),n<c&&(s.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime){const n=Ce(t.startTime,t.endTime);n<=0?s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":n>300&&(s.endTime="××©×š ×”×—×–×¨×” ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-5 ×©×¢×•×ª")}return t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},Ps=t=>{const s={};if(t.orchestraId?.trim()||(s.orchestraId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.startDate||(s.startDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×”×ª×—×œ×”"),t.endDate||(s.endDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×¡×™×•×"),t.startDate&&t.endDate){const n=new Date(t.startDate),c=new Date(t.endDate);n>=c&&(s.endDate="×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),(c.getTime()-n.getTime())/(1e3*60*60*24)>365&&(s.endDate="×ª×§×•×¤×” ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×™×•×ª×¨ ××©× ×”")}return(t.dayOfWeek===void 0||t.dayOfWeek<0||t.dayOfWeek>6)&&(s.dayOfWeek="×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime&&Ce(t.startTime,t.endTime)<=0&&(s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},Tr=t=>{switch(t.orchestra?.type||t.type){case"×ª×–××•×¨×ª":return"bg-blue-500";case"×”×¨×›×‘":return"bg-pink-500";default:return"bg-gray-500"}};function $s({newRehearsal:t,bulkData:s,existingRehearsals:n,orchestras:c,onConflictsChanged:o}){const[a,i]=u.useState([]),[f,m]=u.useState(!1);u.useEffect(()=>{t||s?d():i([])},[t,s,n]),u.useEffect(()=>{o?.(a)},[a,o]);const d=async()=>{m(!0);try{let g=[];t?g=await h(t):s&&(g=await I(s)),i(g)}catch(g){console.error("Error detecting conflicts:",g)}finally{m(!1)}},h=async g=>{const j=[],v={_id:"temp",groupId:g.groupId,type:g.type,date:g.date,dayOfWeek:new Date(g.date).getDay(),startTime:g.startTime,endTime:g.endTime,location:g.location,attendance:{present:[],absent:[]},notes:g.notes||"",schoolYearId:"current",isActive:g.isActive,orchestra:c.find(C=>C._id===g.groupId)};for(const C of n){if(C.groupId===g.groupId&&C.date===g.date)continue;const E=it(v,C);E.hasConflict&&j.push({...E,conflictingRehearsal:C,affectedDate:g.date})}return j},I=async g=>{const j=[],v=R(g),C=c.find(E=>E._id===g.orchestraId);for(const E of v){const O={_id:"temp",groupId:g.orchestraId,type:C?.type||"×ª×–××•×¨×ª",date:E,dayOfWeek:new Date(E).getDay(),startTime:g.startTime,endTime:g.endTime,location:g.location,attendance:{present:[],absent:[]},notes:g.notes||"",schoolYearId:g.schoolYearId,isActive:!0,orchestra:C};for(const N of n){if(N.groupId===g.orchestraId&&N.date===E)continue;const $=it(O,N);$.hasConflict&&j.push({...$,conflictingRehearsal:N,affectedDate:E})}}return j},R=g=>{const j=[],v=new Date(g.startDate),C=new Date(g.endDate),E=g.dayOfWeek,O=new Set(g.excludeDates||[]),N=new Date(v);for(;N.getDay()!==E&&N<=C;)N.setDate(N.getDate()+1);for(;N<=C;){const $=N.toISOString().split("T")[0];O.has($)||j.push($),N.setDate(N.getDate()+7)}return j},S=g=>{switch(g){case"critical":return e.jsx(Ze,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(et,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(De,{className:"w-5 h-5 text-green-600"})}},L=g=>{switch(g){case"location":return e.jsx(ve,{className:"w-4 h-4"});case"conductor":return e.jsx(de,{className:"w-4 h-4"});case"members":return e.jsx(ie,{className:"w-4 h-4"});case"time":return e.jsx(oe,{className:"w-4 h-4"});default:return e.jsx(De,{className:"w-4 h-4"})}},F=g=>{switch(g){case"critical":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-green-50 border-green-200 text-green-800"}},D=a.filter(g=>g.severity==="critical"),H=a.filter(g=>g.severity==="warning");return f?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"×‘×•×“×§ ×”×ª× ×’×©×•×™×•×ª..."})]})}):a.length===0&&(t||s)?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"w-5 h-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-sm text-green-800",children:"×œ× × ××¦××• ×”×ª× ×’×©×•×™×•×ª - × ×™×ª×Ÿ ×œ×™×¦×•×¨ ××ª ×”×—×–×¨×”"})]})}):a.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"×¡×™×›×•× ×”×ª× ×’×©×•×™×•×ª"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[D.length>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(Ze,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[D.length," ×§×¨×™×˜×™×•×ª"]})]}),H.length>0&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(et,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[H.length," ××–×”×¨×•×ª"]})]})]})]}),D.length>0&&e.jsx("p",{className:"text-sm text-red-800",children:"× ××¦××• ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×©××•× ×¢×•×ª ×™×¦×™×¨×ª ×”×—×–×¨×”. ×™×© ×œ×¤×ª×•×¨ ××•×ª×Ÿ ×œ×¤× ×™ ×”××©×š."}),H.length>0&&D.length===0&&e.jsx("p",{className:"text-sm text-yellow-800",children:"× ××¦××• ××–×”×¨×•×ª ×©×›×“××™ ×œ×‘×“×•×§. × ×™×ª×Ÿ ×œ×”××©×™×š ×‘×™×¦×™×¨×ª ×”×—×–×¨×” ××š ××•××œ×¥ ×œ×•×•×“×."})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map((g,j)=>e.jsx("div",{className:`border rounded-lg p-3 ${F(g.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-2",children:[S(g.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[L(g.conflictType),e.jsx("span",{className:"font-medium text-sm",children:g.message})]}),g.conflictingRehearsal&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:g.conflictingRehearsal.orchestra?.name}),e.jsx("span",{children:_s(g.conflictingRehearsal).fullDateTime}),e.jsx("span",{children:g.conflictingRehearsal.location})]})}),g.affectedDate&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["×ª××¨×™×š ××ª× ×’×©: ",new Date(g.affectedDate).toLocaleDateString("he-IL")]})]})]})})},j))}),D.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"×¤×¢×•×œ×•×ª ××•××œ×¦×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[D.some(g=>g.conflictType==="location")&&e.jsx("li",{children:"×©× ×” ××ª ××™×§×•× ×”×—×–×¨×” ××• ×‘×—×¨ ×–××Ÿ ××—×¨"}),D.some(g=>g.conflictType==="conductor")&&e.jsx("li",{children:"×ª×× ×¢× ×”×× ×¦×— ××• ×©× ×” ××ª ×–××Ÿ ×”×—×–×¨×”"}),D.some(g=>g.conflictType==="time")&&e.jsx("li",{children:"×‘×—×¨ ×–××Ÿ ××—×¨ ××• ×ª××¨×™×š ××—×¨"})]})]})]})}function Ls({orchestras:t,existingRehearsals:s=[],onSubmit:n,onCancel:c,initialData:o}){const[a,i]=u.useState("single"),[f,m]=u.useState(!1),[d,h]=u.useState({}),[I,R]=u.useState({groupId:"",type:"×ª×–××•×¨×ª",date:"",startTime:"19:00",endTime:"21:00",location:"",notes:"",isActive:!0,...o}),[S,L]=u.useState({orchestraId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"19:00",endTime:"21:00",location:"",notes:"",excludeDates:[],schoolYearId:"current"}),[F,D]=u.useState(""),[H,g]=u.useState([]),[j,v]=u.useState(!1),[C,E]=u.useState(!1);u.useEffect(()=>{if(a==="single"&&I.groupId){const l=t.find(b=>b._id===I.groupId);l&&!I.location&&R(b=>({...b,location:l.location,type:l.type}))}},[I.groupId,t,a]),u.useEffect(()=>{if(a==="bulk"&&S.orchestraId){const l=t.find(b=>b._id===S.orchestraId);l&&!S.location&&L(b=>({...b,location:l.location}))}},[S.orchestraId,t,a]),u.useEffect(()=>{if(a==="bulk"&&S.startDate&&S.endDate&&S.dayOfWeek!==void 0)try{const l=Rs(S);g(l)}catch{g([])}else g([])},[a,S.startDate,S.endDate,S.dayOfWeek,S.excludeDates]);const O=(l,b)=>{R(U=>({...U,[l]:b})),d[l]&&h(U=>({...U,[l]:""}))},N=(l,b)=>{L(U=>({...U,[l]:b})),d[l]&&h(U=>({...U,[l]:""}))},$=()=>{F&&(L(l=>({...l,excludeDates:[...l.excludeDates||[],F]})),D(""))},A=l=>{L(b=>({...b,excludeDates:(b.excludeDates||[]).filter(U=>U!==l)}))},V=l=>{v(l.length>0),E(l.some(b=>b.severity==="critical"))},ee=async l=>{l.preventDefault(),m(!0),h({});try{if(C){h({submit:"×™×© ×œ×¤×ª×•×¨ ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×œ×¤× ×™ ×™×¦×™×¨×ª ×”×—×–×¨×”"});return}if(a==="single"){const b=Os(I);if(!b.isValid){h(b.errors);return}const x=new Date(I.date).getDay(),k={...I,dayOfWeek:x};await n(k,!1)}else{const b=Ps(S);if(!b.isValid){h(b.errors);return}await n(S,!0)}}catch(b){h({submit:b.message||"×©×’×™××” ×‘×©××™×¨×ª ×”×—×–×¨×”"})}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:c,children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o?"×¢×¨×•×š ×—×–×¨×”":"×—×–×¨×” ×—×“×©×”"}),!o&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>i("single"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${a==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×” ×™×—×™×“×”"}),e.jsx("button",{type:"button",onClick:()=>i("bulk"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${a==="bulk"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×•×ª ×—×•×–×¨×•×ª"})]})})]}),e.jsx("div",{className:"w-8"})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[a==="single"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:I.groupId||"",onChange:l=>O("groupId",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.groupId?"border-red-300":"border-gray-300"}`,disabled:!!o,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(l=>e.jsxs("option",{value:l._id,children:[l.name," (",l.type,")"]},l._id))]}),d.groupId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.groupId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š"]}),e.jsx("input",{type:"date",value:I.date||"",onChange:l=>O("date",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.date?"border-red-300":"border-gray-300"}`}),d.date&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:I.startTime||"",onChange:l=>O("startTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startTime?"border-red-300":"border-gray-300"}`}),d.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:I.endTime||"",onChange:l=>O("endTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endTime?"border-red-300":"border-gray-300"}`}),d.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:I.location||"",onChange:l=>O("location",l.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`}),d.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:I.notes||"",onChange:l=>O("notes",l.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×”×—×–×¨×”...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª"]}),e.jsxs("select",{value:S.orchestraId||"",onChange:l=>N("orchestraId",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.orchestraId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(l=>e.jsxs("option",{value:l._id,children:[l.name," (",l.type,")"]},l._id))]}),d.orchestraId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.orchestraId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š ×”×ª×—×œ×”"]}),e.jsx("input",{type:"date",value:S.startDate||"",onChange:l=>N("startDate",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startDate?"border-red-300":"border-gray-300"}`}),d.startDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•×"}),e.jsx("input",{type:"date",value:S.endDate||"",onChange:l=>N("endDate",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endDate?"border-red-300":"border-gray-300"}`}),d.endDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endDate})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("select",{value:S.dayOfWeek||0,onChange:l=>N("dayOfWeek",parseInt(l.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.dayOfWeek?"border-red-300":"border-gray-300"}`,children:Es.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),d.dayOfWeek&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.dayOfWeek})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:S.startTime||"",onChange:l=>N("startTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.startTime?"border-red-300":"border-gray-300"}`}),d.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:S.endTime||"",onChange:l=>N("endTime",l.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.endTime?"border-red-300":"border-gray-300"}`}),d.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 inline ml-1"}),"××™×§×•×"]}),e.jsx("input",{type:"text",value:S.location||"",onChange:l=>N("location",l.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${d.location?"border-red-300":"border-gray-300"}`}),d.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×›×™× ×œ×“×™×œ×•×’"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:F,onChange:l=>D(l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"×‘×—×¨ ×ª××¨×™×š ×œ×“×™×œ×•×’"}),e.jsx("button",{type:"button",onClick:$,disabled:!F,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(xe,{className:"w-4 h-4"})})]}),S.excludeDates&&S.excludeDates.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:S.excludeDates.map(l=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg px-2 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:new Date(l).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",onClick:()=>A(l),className:"mr-1 text-gray-500 hover:text-red-600",children:e.jsx(qt,{className:"w-3 h-3"})})]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:S.notes||"",onChange:l=>N("notes",l.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ×”×—×–×¨×•×ª...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),H.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-blue-600 ml-1"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["×ª×™×•×•×¦×¨×• ",H.length," ×—×–×¨×•×ª"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 max-h-32 overflow-y-auto",children:[H.slice(0,10).map(l=>e.jsxs("div",{children:[new Date(l).toLocaleDateString("he-IL")," - ",qe(new Date(l).getDay())]},l)),H.length>10&&e.jsxs("div",{className:"text-blue-600",children:["...×•×¢×•×“ ",H.length-10]})]})]})]}),e.jsx($s,{newRehearsal:a==="single"?I:null,bulkData:a==="bulk"?S:null,existingRehearsals:s,orchestras:t,onConflictsChanged:V}),d.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:d.submit})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:f||C,className:`px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors ${f||C?"opacity-50 cursor-not-allowed":""}`,children:f?"×©×•××¨...":o?"×¢×“×›×Ÿ ×—×–×¨×”":a==="single"?"×¦×•×¨ ×—×–×¨×”":`×¦×•×¨ ${H.length} ×—×–×¨×•×ª`})]})]})]})})})}const Us=[{name:"××™×“×¢ ×›×œ×œ×™",href:"/dashboard",icon:Te,category:"general"},{name:"×ª×œ××™×“×™×",href:"/students",icon:ie,category:"management",roles:["admin"]},{name:"××•×¨×™×",href:"/teachers",icon:pt,category:"management",roles:["admin"]},{name:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:we,category:"management",roles:["admin"]},{name:"×ª×–××•×¨×•×ª",href:"/orchestras",icon:_e,category:"management",roles:["admin"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:re,category:"management",roles:["admin"]},{name:"×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"operations",roles:["admin"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["admin"]},{name:"×“×•×—×•×ª",href:"/reports",icon:Kt,category:"management",roles:["admin"]},{name:"×”×’×“×¨×•×ª",href:"/settings",icon:Ne,category:"system",roles:["admin"]}],Bs=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×ª×œ××™×“×™× ×©×œ×™",href:"/students",icon:ie,category:"personal",roles:["teacher"]},{name:"×œ×•×— ×–×× ×™× ×©×œ×™",href:"/profile",icon:re,category:"personal",roles:["teacher"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["teacher"]},{name:"× ×™×”×•×œ ×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:ze,category:"operations",roles:["teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],Fs=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×ª×–××•×¨×•×ª ×©×œ×™",href:"/orchestras",icon:_e,category:"personal",roles:["conductor"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:re,category:"personal",roles:["conductor"]},{name:"× ×•×›×—×•×ª",href:"/conductor/attendance",icon:Ae,category:"operations",roles:["conductor"]},{name:"× ×™×”×•×œ ×¨×™×©×•××™×",href:"/conductor/enrollment",icon:yt,category:"operations",roles:["conductor"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],Ms=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:Te,category:"general"},{name:"×”×©×™×¢×•×¨×™× ×©×œ×™",href:"/theory-lessons",icon:we,category:"personal",roles:["theory-teacher"]},{name:"×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:ie,category:"personal",roles:["theory-teacher"]},{name:"× ×•×›×—×•×ª",href:"/attendance",icon:Ae,category:"operations",roles:["theory-teacher"]},{name:"×ª×›× ×™×ª ×œ×™××•×“×™×",href:"/theory-lessons",icon:Jt,category:"personal",roles:["theory-teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:de,category:"personal"}],ct={admin:[{name:"×”×•×¡×£ ×ª×œ××™×“ ×—×“×©",href:"/students/new",icon:ie,role:"admin"},{name:"×”×•×¡×£ ××•×¨×” ×—×“×©",href:"/teachers/new",icon:pt,role:"admin"},{name:"×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:we,role:"admin"},{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:re,role:"admin"}],teacher:[{name:"×”×•×¡×£ ×©×™×¢×•×¨",href:"/profile",icon:xe,role:"teacher"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/attendance",icon:tt,role:"teacher"},{name:"×¦×¤×” ×‘×œ×•×— ×–×× ×™×",href:"/profile",icon:oe,role:"teacher"}],conductor:[{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:st,role:"conductor"},{name:"× ×”×œ ×ª×–××•×¨×ª",href:"/orchestras",icon:_e,role:"conductor"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/conductor/attendance",icon:tt,role:"conductor"}],"theory-teacher":[{name:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:st,role:"theory-teacher"},{name:"× ×”×œ ×§×‘×•×¦×•×ª",href:"/theory-lessons",icon:yt,role:"theory-teacher"},{name:"×“×¨×’ ×ª×œ××™×“×™×",href:"/theory-lessons",icon:ze,role:"theory-teacher"}]};function Vs(){const t=Ut(),s=Ee(),{user:n,isLoading:c}=fe(),{isDesktopOpen:o,setIsDesktopOpen:a,isMobile:i}=Xe(),[f,m]=u.useState(""),[d,h]=u.useState(!1),[I,R]=u.useState(new Set),[S,L]=u.useState(!1),[F,D]=u.useState(!1),[H,g]=u.useState(!1),[j,v]=u.useState(!1),[C,E]=u.useState([]),[O,N]=u.useState(!1),$=w=>t.pathname===w,V=(()=>{if(!n)return[];const w=[];return n.role==="admin"||n.role==="×× ×”×œ"||n.roles?.includes("admin")||n.roles?.includes("×× ×”×œ")?["admin"]:(n.role&&w.push(n.role),n.roles&&Array.isArray(n.roles)&&w.push(...n.roles),n.teaching?.studentIds?.length>0&&!w.includes("teacher")&&w.push("teacher"),n.conducting?.orchestraIds?.length>0&&!w.includes("conductor")&&w.push("conductor"),[...new Set(w.map(M=>M==="theory_teacher"?"theory-teacher":M==="×× ×”×œ"?"admin":M==="××•×¨×”"?"teacher":M==="×× ×¦×—"?"conductor":M==="××•×¨×” ×ª×™××•×¨×™×”"?"theory-teacher":M))])})(),ee=V.includes("admin"),l=V.length>1,b=()=>{if(ee)return Us;const w=new Map,M=[];return V.includes("teacher")&&M.push(...Bs),V.includes("conductor")&&M.push(...Fs),V.includes("theory-teacher")&&M.push(...Ms),M.forEach(W=>{const J=W.href;if(!w.has(J))w.set(J,W);else{const ne=w.get(J);W.roles&&ne.roles&&(ne.roles=[...new Set([...ne.roles,...W.roles])])}}),Array.from(w.values())},U=()=>{if(ee)return ct.admin;const w=[],M=new Map;return V.forEach(W=>{const J=ct[W];J&&J.forEach(ne=>{const be=`${ne.href}-${ne.name}`;M.has(be)||(M.set(be,!0),w.push(ne))})}),w},x=w=>{const M={general:{label:"×›×œ×œ×™",items:[]},personal:{label:"××–×•×¨ ××™×©×™",items:[]},management:{label:"× ×™×”×•×œ ××¢×¨×›×ª",items:[]},operations:{label:"×¤×¢×•×œ×•×ª",items:[]},system:{label:"××¢×¨×›×ª",items:[]}};return w.forEach(W=>{const J=W.category||"general";M[J]&&M[J].items.push(W)}),Object.entries(M).filter(([W,J])=>J.items.length>0).map(([W,J])=>({key:W,...J}))},k=b(),T=x(k),B=U();console.log("ğŸ“‹ Sidebar Debug:",{hasUser:!!n,isLoading:c,userRoles:V,isAdmin:ee,hasMultipleRoles:l,isMobile:i,isDesktopOpen:o,isOpen:d,navigationItemsCount:k?.length||0,groupedNavigationCount:T?.length||0,quickActionsCount:B?.length||0}),u.useEffect(()=>{i||h(!1)},[i]),u.useEffect(()=>{const w=M=>{if(i&&d){const W=document.getElementById("mobile-sidebar"),J=document.getElementById("hamburger-button");W&&!W.contains(M.target)&&J&&!J.contains(M.target)&&h(!1)}};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[i,d]),u.useEffect(()=>(i&&d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i,d]);const K=()=>{i&&h(!1)},G=w=>{const M=new Set(I);M.has(w)?M.delete(w):M.add(w),R(M)},ye=w=>{switch(w){case"admin":return"×× ×”×œ";case"teacher":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"theory-teacher":return"××•×¨×” ×ª×™××•×¨×™×”";default:return w}},r=w=>{switch(w){case"admin":return"bg-purple-100 text-purple-700";case"teacher":return"bg-blue-100 text-blue-700";case"conductor":return"bg-green-100 text-green-700";case"theory-teacher":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},p=async(w,M)=>{K(),w==="×”×•×¡×£ ×ª×œ××™×“ ×—×“×©"?L(!0):w==="×”×•×¡×£ ××•×¨×” ×—×“×©"?D(!0):w==="×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"?g(!0):w==="×ª×–××Ÿ ×—×–×¨×”"?(await y(),v(!0)):s(M)},y=async()=>{try{N(!0);const w=await Wt.getOrchestras();E(w||[])}catch(w){console.error("Failed to load orchestras:",w),E([])}finally{N(!1)}},_=async w=>{L(!1)},P=async()=>{D(!1)},z=async w=>{g(!1)},te=async w=>{v(!1)};return e.jsxs(e.Fragment,{children:[i&&e.jsx("button",{id:"hamburger-button",onClick:()=>h(!d),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-gray-50 transition-colors duration-200","aria-label":"Toggle menu",children:d?e.jsx(he,{className:"w-6 h-6 text-gray-600"}):e.jsx($e,{className:"w-6 h-6 text-gray-600"})}),!i&&!o&&e.jsx("button",{onClick:()=>a(!0),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200","aria-label":"Open sidebar",children:e.jsx($e,{className:"w-5 h-5 text-indigo-600"})}),i&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[50] transition-opacity duration-300",onClick:()=>h(!1)}),e.jsxs("div",{id:"sidebar",className:`fixed top-0 right-0 w-[280px] h-screen bg-white border-l border-gray-200 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.1)] rtl z-[55] transition-transform duration-300 ease-in-out flex flex-col ${i?d?"translate-x-0":"translate-x-full":o?"translate-x-0":"translate-x-full"}`,children:[!i&&e.jsx("button",{onClick:()=>a(!o),className:"absolute top-4 left-4 p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200 z-10","aria-label":"Toggle sidebar",children:o?e.jsx(he,{className:"w-5 h-5 text-gray-600"}):e.jsx($e,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("div",{className:"p-4 border-b border-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×©...",value:f,onChange:w=>m(w.target.value),className:"w-full pr-10 pl-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm font-reisinger-yonatan text-right rtl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),l&&!ee&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(w=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${r(w)}`,children:[e.jsx(Qt,{className:"w-3 h-3"}),ye(w)]},w))})}),e.jsx("nav",{className:"flex-1 px-3 py-4 overflow-y-auto overflow-x-hidden min-h-0 custom-scrollbar",children:c?e.jsx("div",{className:"space-y-2 px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})}):e.jsxs(e.Fragment,{children:[T.map((w,M)=>e.jsxs("div",{className:M>0?"mt-6":"",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("button",{onClick:()=>G(w.key),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700 transition-colors",children:[e.jsx("span",{children:w.label}),e.jsx(le,{className:`w-3 h-3 transition-transform ${I.has(w.key)?"rotate-180":""}`})]})}),!I.has(w.key)&&e.jsx("div",{className:"space-y-1",children:w.items.map(W=>{const J=W.icon,ne=$(W.href);return e.jsxs(me,{to:W.href,onClick:K,className:`flex items-center justify-between px-4 py-3 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan ${ne?"bg-primary-50 text-primary-700 border border-primary-200":"text-gray-600 hover:bg-gray-50 hover:text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:W.name}),l&&!ee&&W.roles&&W.roles.length===1&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${r(W.roles[0])}`,children:ye(W.roles[0])})]}),e.jsx(J,{className:"w-4 h-4 flex-shrink-0"})]},`${w.key}-${W.href}-${W.name}`)})})]},w.key)),B.length>0&&e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-6 mt-6",children:[e.jsx("h3",{className:"px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),B.map(w=>{const M=w.icon;return e.jsxs("button",{onClick:()=>p(w.name,w.href),className:"w-full flex items-center justify-between px-4 py-2 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan text-gray-600 hover:bg-green-50 hover:text-green-700 group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:w.name}),l&&!ee&&w.role&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${r(w.role)}`,children:ye(w.role)})]}),e.jsxs("div",{className:"flex items-center space-x-1 space-x-reverse",children:[e.jsx(xe,{className:"w-3 h-3 group-hover:text-green-500"}),e.jsx(M,{className:"w-3.5 h-3.5"})]})]},`${w.href}-${w.name}-${w.role}`)})]})]})})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Ts,{onSubmit:_,onCancel:()=>L(!1),isEdit:!1,initialData:null})})}),F&&e.jsx(Ds,{isOpen:F,onClose:()=>D(!1),onSuccess:P}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Cs,{onSubmit:z,onCancel:()=>g(!1)})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:O?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×ª×–××•×¨×•×ª..."})]}):e.jsx(Ls,{orchestras:C,onSubmit:te,onCancel:()=>v(!1)})})})]})}function Ys(){const[t,s]=u.useState(!1),n=u.useRef(null),{currentSchoolYear:c,schoolYears:o,isLoading:a,setCurrentSchoolYearById:i,getSchoolYearDisplayName:f}=wt();u.useEffect(()=>{const d=h=>{n.current&&!n.current.contains(h.target)&&s(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const m=async d=>{await i(d),s(!1)};return a?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]}):e.jsxs("div",{className:"relative",ref:n,children:[e.jsxs("button",{onClick:()=>s(!t),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 ease-in-out min-w-[200px]",style:{direction:"rtl"},children:[e.jsx(re,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan flex-grow text-right truncate",children:c?f(c):"×‘×—×¨ ×©× ×ª ×œ×™××•×“"}),t?e.jsx(ue,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}):e.jsx(le,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-full min-w-[250px] bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide font-reisinger-yonatan text-right",children:"×©× ×•×ª ×œ×™××•×“"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 font-reisinger-yonatan text-center",children:"×œ× × ××¦××• ×©× ×•×ª ×œ×™××•×“"}):o.sort((d,h)=>new Date(h.startDate).getTime()-new Date(d.startDate).getTime()).map(d=>{const h=c?._id===d._id,I=d.isCurrent,R=d.isActive;return e.jsxs("button",{onClick:()=>m(d._id),className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${h?"bg-indigo-50 border-l-4 border-indigo-500":""}`,style:{direction:"rtl"},children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${h?"text-indigo-700":"text-gray-700"}`,children:d.name}),I&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"× ×•×›×—×™×ª"}),!R&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"×œ× ×¤×¢×™×œ×”"})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[new Date(d.startDate).toLocaleDateString("he-IL")," - ",new Date(d.endDate).toLocaleDateString("he-IL")]})]}),h&&e.jsx(Zt,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"})]},d._id)})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:e.jsx("button",{className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium font-reisinger-yonatan",children:"+ ×”×•×¡×£ ×©× ×ª ×œ×™××•×“ ×—×“×©×”"})})]})]})}function Ws(){const[t,s]=u.useState(!1),[n,c]=u.useState(!1),o=u.useRef(null),a=u.useRef(null),i=Ee(),{user:f,logout:m}=fe(),{isDesktopOpen:d,isMobile:h}=Xe(),I=f&&(f.role==="admin"||f.roles?.includes("admin")||f.role==="×× ×”×œ"||f.roles?.includes("×× ×”×œ")),R=f&&(f.role==="admin"||f.roles?.includes("admin")||f.role==="×× ×”×œ"||f.roles?.includes("×× ×”×œ")||f.role==="teacher"||f.roles?.includes("teacher")||f.role==="××•×¨×”"||f.roles?.includes("××•×¨×”")||f.role==="conductor"||f.roles?.includes("conductor")||f.role==="×× ×¦×—"||f.roles?.includes("×× ×¦×—")||f.role==="theory-teacher"||f.roles?.includes("theory-teacher")||f.role==="theory_teacher"||f.roles?.includes("theory_teacher")||f.role==="××•×¨×” ×ª×™××•×¨×™×”"||f.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||f.teaching?.studentIds?.length>0||f.conducting?.orchestraIds?.length>0);u.useEffect(()=>{const v=C=>{o.current&&!o.current.contains(C.target)&&s(!1),a.current&&!a.current.contains(C.target)&&c(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const S=()=>[{icon:rt,label:"×”×ª×¨××•×ª",action:()=>console.log("Notifications")},{icon:re,label:"×œ×•×— ×©× ×”",action:()=>console.log("Calendar")},{icon:Ne,label:"×”×’×“×¨×•×ª",action:()=>console.log("Settings")}],L=()=>{i("/profile"),c(!1)},F=async()=>{try{await m(),i("/login")}catch(v){console.error("Logout error:",v)}c(!1)},D=()=>{i("/dashboard")},H=()=>{const v=f?.personalInfo?.fullName||f?.fullName||f?.name||"";if(!v)return"×";const C=v.trim().split(" ");return C.length>=2?C[0][0]+C[1][0]:C[0][0]||"×"},g=()=>f?.personalInfo?.fullName||f?.fullName||f?.name||"××©×ª××©",j=()=>{const v=f?.role||f?.roles?.[0]||"";switch(v){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return v||"××©×ª××©"}};return e.jsxs("header",{className:"fixed top-0 left-0 h-16 bg-white border-b border-gray-200 flex items-center justify-between z-[45] transition-all duration-300",style:{direction:"rtl",width:R&&!h&&d?"calc(100% - 280px)":"100%",paddingLeft:"1.5rem",paddingRight:R&&!h&&!d?"4rem":"1.5rem"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-10 w-auto object-contain"}),e.jsx(Ys,{})]}),e.jsxs("div",{className:"flex items-center gap-4",style:{direction:"ltr"},children:[!h&&e.jsxs(e.Fragment,{children:[!I&&e.jsx("button",{onClick:D,className:"w-10 h-10 rounded-lg bg-indigo-50 border border-indigo-200 flex items-center justify-center hover:bg-indigo-100 hover:border-indigo-300 transition-all duration-150 ease-in-out cursor-pointer",title:"×œ×•×— ×‘×§×¨×”",children:e.jsx(Te,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(rt,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(re,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:e.jsx(Ne,{className:"w-5 h-5 text-gray-600"})})]}),h&&e.jsxs("div",{className:"relative",ref:o,children:[e.jsx("button",{onClick:()=>s(!t),className:"w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center hover:bg-gray-100 hover:border-gray-300 transition-all duration-150 ease-in-out cursor-pointer",children:t?e.jsx(ue,{className:"w-5 h-5 text-gray-600"}):e.jsx(le,{className:"w-5 h-5 text-gray-600"})}),t&&e.jsx("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[70]",children:S().map((v,C)=>{const E=v.icon,O=v.label==="×œ×•×— ×‘×§×¨×”";return e.jsxs("button",{onClick:()=>{v.action(),s(!1)},className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${O?"hover:bg-indigo-50":""}`,style:{direction:"rtl"},children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${O?"text-indigo-700":"text-gray-700"}`,children:v.label}),e.jsx(E,{className:`w-4 h-4 ${O?"text-indigo-600":"text-gray-500"}`})]},C)})})]}),e.jsxs("div",{className:"relative",ref:a,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center cursor-pointer hover:bg-indigo-700 transition-colors",onClick:()=>c(!n),children:e.jsx("span",{className:"text-sm font-semibold text-white font-reisinger-yonatan",children:H()})}),n&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[70]",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:g()}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:j()})]}),e.jsxs("button",{onClick:L,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×¢××•×“ ××™×©×™"}),e.jsx(de,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs("button",{onClick:F,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 text-red-600 hover:bg-red-50",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium font-reisinger-yonatan",children:"×™×¦×™××”"}),e.jsx(es,{className:"w-4 h-4"})]})]})]})]})]})}function X({children:t}){const{user:s}=fe(),{isDesktopOpen:n,isMobile:c}=Xe(),o=s&&(s.role==="admin"||s.roles?.includes("admin")||s.role==="×× ×”×œ"||s.roles?.includes("×× ×”×œ")||s.role==="teacher"||s.roles?.includes("teacher")||s.role==="××•×¨×”"||s.roles?.includes("××•×¨×”")||s.role==="conductor"||s.roles?.includes("conductor")||s.role==="×× ×¦×—"||s.roles?.includes("×× ×¦×—")||s.role==="theory-teacher"||s.roles?.includes("theory-teacher")||s.role==="theory_teacher"||s.roles?.includes("theory_teacher")||s.role==="××•×¨×” ×ª×™××•×¨×™×”"||s.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||s.teaching?.studentIds?.length>0||s.conducting?.orchestraIds?.length>0);return console.log("ğŸ¨ Layout Debug:",{hasUser:!!s,userRole:s?.role,userRoles:s?.roles,userObject:s,shouldShowSidebar:o,isMobile:c,isDesktopOpen:n,conditions:{hasRole:!!s?.role,hasRolesArray:!!s?.roles,isAdmin:s?.role==="admin"||s?.roles?.includes("admin"),isTeacher:s?.role==="teacher"||s?.roles?.includes("teacher"),hasConductor:s?.role==="conductor"||s?.roles?.includes("conductor"),hasTheoryTeacher:s?.role==="theory-teacher"||s?.roles?.includes("theory-teacher"),hasTeaching:s?.teaching?.studentIds?.length>0,hasConducting:s?.conducting?.orchestraIds?.length>0}}),e.jsxs("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[o&&e.jsx(Vs,{}),e.jsx(Ws,{}),e.jsx("main",{className:"mt-16 ml-0 p-0 bg-gray-50 min-h-[calc(100vh-64px)] rtl transition-all duration-300",style:{marginRight:o&&!c&&n?"280px":"0"},children:e.jsx("div",{className:"p-6 bg-gray-50",children:t})})]})}function Hs(){const[t,s]=u.useState(""),[n,c]=u.useState(""),[o,a]=u.useState(""),[i,f]=u.useState(!1),m=Ee(),{login:d}=fe(),h=async I=>{I.preventDefault(),a(""),f(!0),console.log("ğŸ” Login attempt started:",{email:t,password:"***"}),console.log("ğŸŒ API Base URL:","/api"),console.log("ğŸ”§ Environment check:",{VITE_API_URL:"/api",fallback:"http://localhost:3001/api",actual:"/api"});try{console.log("ğŸ“¤ Sending login request to API service...");const R=await d(t,n);console.log("âœ… Login successful:",{user:R.user?.personalInfo?.fullName||"Unknown"}),console.log("ğŸ”‘ Authentication token stored successfully"),console.log("ğŸ§­ Navigating to dashboard..."),m("/dashboard")}catch(R){console.error("âŒ Login failed:",R),console.error("ğŸ“ Error details:",{message:R.message,stack:R.stack}),a(R.message||"×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª. ×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×•× ×¡×” ×©×•×‘.")}finally{f(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×›× ×™×¡×” ×œ××¢×¨×›×ª"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:h,children:[o&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:o})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:i,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:I=>s(I.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:i,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××”",value:n,onChange:I=>c(I.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:i,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"××ª×—×‘×¨..."]}):"×›× ×™×¡×”"})}),e.jsx("div",{className:"text-center",children:e.jsx(me,{to:"/forgot-password",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×©×›×—×ª×™ ×¡×™×¡××"})})]})]})})]})}function zs(){const[t,s]=u.useState(""),[n,c]=u.useState(!1),[o,a]=u.useState(!1),[i,f]=u.useState(""),m=async d=>{d.preventDefault(),f(""),c(!0);try{await gt.forgotPassword(t),a(!0)}catch(h){f(h.message||"×©×’×™××” ×‘×©×œ×™×—×ª ×‘×§×©×ª ××™×¤×•×¡ ×¡×™×¡××”")}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×©×›×—×ª×™ ×¡×™×¡××"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:'×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”×“×•×"×œ ×©×œ×š ×•× ×©×œ×— ×œ×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”'})]}),o?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan",children:'×× ×§×™×™× ×—×©×‘×•×Ÿ ×¢× ×›×ª×•×‘×ª ×“×•×"×œ ×–×•, × ×©×œ×— ××œ×™×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”. ×× × ×‘×“×•×§ ××ª ×ª×™×‘×ª ×”×“×•××¨ ×©×œ×š.'})}),e.jsx("div",{className:"text-center",children:e.jsx(me,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[i&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:i})}),e.jsx("div",{className:"rounded-md shadow-sm",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:n,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:d=>s(d.target.value),dir:"ltr",style:{textAlign:"left"}})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:n,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×©×•×œ×—..."]}):"×©×œ×— ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsx("div",{className:"text-center",children:e.jsx(me,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]})]})})]})}function Xs(){const{token:t}=Bt(),[s,n]=u.useState(""),[c,o]=u.useState(""),[a,i]=u.useState(!1),[f,m]=u.useState(""),[d,h]=u.useState(!1),I=Ee();u.useEffect(()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),t||m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”.")},[t]);const R=async S=>{if(S.preventDefault(),m(""),s.length<6){m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×");return}if(s!==c){m("×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª");return}if(!t){m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ");return}i(!0);try{await gt.resetPassword(t,s),h(!0),setTimeout(()=>{I("/login")},3e3)}catch(L){const F=L.message||L.error||"×©×’×™××” ×‘××™×¤×•×¡ ×”×¡×™×¡××”";F.includes("expired")||F.includes("RESET_TOKEN_EXPIRED")?m("×ª×•×§×£ ×”×§×™×©×•×¨ ×¤×’. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):F.includes("invalid")||F.includes("INVALID_RESET_TOKEN")?m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):F.includes("password")||F.includes("WEAK_PASSWORD")?m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×"):m(F)}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"××™×¤×•×¡ ×¡×™×¡××”"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:"×”×–×Ÿ ×¡×™×¡××” ×—×“×©×” ×œ×—×©×‘×•×Ÿ ×©×œ×š"})]}),d?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:[e.jsx("p",{className:"text-green-100 text-center font-reisinger-yonatan",children:"×”×¡×™×¡××” ××•×¤×¡×” ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×ª×•×›×œ ×œ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡××” ×”×—×“×©×”."}),e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan mt-2",children:"××¢×‘×™×¨ ××•×ª×š ×œ×“×£ ×”×›× ×™×¡×”..."})]}),e.jsx("div",{className:"text-center",children:e.jsx(me,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×” ×¢×›×©×™×•"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:R,children:[f&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:f})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××” ×—×“×©×”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:a||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××” ×—×“×©×” (×œ×¤×—×•×ª 6 ×ª×•×•×™×)",value:s,onChange:S=>n(S.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"sr-only font-reisinger-yonatan",children:"××™××•×ª ×¡×™×¡××”"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,disabled:a||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"××™××•×ª ×¡×™×¡××”",value:c,onChange:S=>o(S.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:a||!t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×××¤×¡ ×¡×™×¡××”..."]}):"××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(me,{to:"/forgot-password",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×‘×§×© ×§×™×©×•×¨ ×—×“×©"}),e.jsx(me,{to:"/login",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})]})]})]})})]})}function se(t,s,n=3){return u.lazy(()=>{let c=0;const o=async()=>{try{const a=await t();return console.log(`âœ… Successfully loaded ${s}`),a}catch(a){if(console.error(`âŒ Failed to load ${s}, attempt ${c+1}/${n}:`,a),c<n-1){c++;const i=Math.min(1e3*Math.pow(2,c),5e3);return await new Promise(f=>setTimeout(f,i)),o()}else throw console.error(`âŒ All retry attempts failed for ${s}`),a}};return o()})}class qs{constructor(){Pe(this,"preloadedComponents",new Set);Pe(this,"preloadPromises",new Map)}preload(s,n){if(this.preloadedComponents.has(s))return Promise.resolve();if(this.preloadPromises.has(s))return this.preloadPromises.get(s);const c=n().then(o=>(this.preloadedComponents.add(s),console.log(`âœ… Preloaded ${s}`),o)).catch(o=>{throw console.error(`âŒ Failed to preload ${s}:`,o),o}).finally(()=>{this.preloadPromises.delete(s)});return this.preloadPromises.set(s,c),c}preloadOnHover(s,n){return()=>{this.preloadedComponents.has(s)||this.preload(s,n)}}getPreloadStats(){return{preloadedComponents:Array.from(this.preloadedComponents),pendingPreloads:Array.from(this.preloadPromises.keys())}}}const Le=new qs,Ue={STUDENT_DETAILS:"StudentDetailsPage",THEORY_TAB:"TheoryTab",ORCHESTRA_TAB:"OrchestraTab",DASHBOARD:"Dashboard",STUDENTS_LIST:"Students"};function Gs(){setTimeout(()=>{Le.preload(Ue.DASHBOARD,()=>Z(()=>import("../chunks/Dashboard-MxBkLAMU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Le.preload(Ue.STUDENTS_LIST,()=>Z(()=>import("../chunks/Students-Dp4VVF_T.js"),__vite__mapDeps([9,1,3,4,10,7,11,5,6])))},1e3),setTimeout(()=>{Le.preload(Ue.STUDENT_DETAILS,()=>Z(()=>import("../chunks/StudentDetailsPageSimple-LYKuBLke.js"),__vite__mapDeps([12,1,7,5,6,3,13,14,15,4])))},3e3)}function Qs(){const t=document.head,s=document.createElement("link");s.rel="dns-prefetch",s.href="//localhost",t.appendChild(s);const n=document.createElement("link");n.rel="preconnect",n.href="http://localhost:3001",n.crossOrigin="anonymous",t.appendChild(n);const c=document.createElement("link");c.rel="prefetch",c.as="style",c.href="/src/index.css",t.appendChild(c)}function Ks(){typeof window>"u"||(Qs(),Gs(),console.log("ğŸš€ Bundle optimizations initialized"))}const Js=se(()=>Z(()=>import("../chunks/Dashboard-MxBkLAMU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),"Dashboard"),dt=se(()=>Z(()=>import("../chunks/Students-Dp4VVF_T.js"),__vite__mapDeps([9,1,3,4,10,7,11,5,6])),"Students"),Zs=se(()=>Z(()=>import("../chunks/Teachers-D1RqbrfM.js"),__vite__mapDeps([16,1,4,3,10,7,5,6])),"Teachers"),Be=se(()=>Z(()=>import("../chunks/TheoryLessons-BKpemILV.js"),__vite__mapDeps([17,1,4,3,2,13,5,6,7,11])),"TheoryLessons"),er=se(()=>Z(()=>import("../chunks/TheoryLessonDetails-GFxP1y5I.js"),__vite__mapDeps([18,1,4,3,10,7,2,11,5,6])),"TheoryLessonDetails"),ut=se(()=>Z(()=>import("../chunks/Orchestras-CTRyeqKH.js"),__vite__mapDeps([19,1,4,3,10,7,2,5,6])),"Orchestras"),mt=se(()=>Z(()=>import("../chunks/Rehearsals-BrsT-LpX.js"),__vite__mapDeps([20,1,4,3,10,7,11,5,6])),"Rehearsals"),tr=se(()=>Z(()=>import("../chunks/RehearsalDetails-DoKuKx6L.js"),__vite__mapDeps([21,1,5,6,3,4,11,7])),"RehearsalDetails"),sr=se(()=>Z(()=>import("../chunks/Bagruts-0ctATLA0.js"),__vite__mapDeps([22,1,4,3,10,7,2,11,23,5,6])),"Bagruts"),rr=se(()=>Z(()=>import("../chunks/BagrutDetails-BjmA-QKg.js"),__vite__mapDeps([24,1,4,3,10,7,2,11,23,5,6])),"BagrutDetails"),ar=se(()=>Z(()=>import("../chunks/Profile-CL9Np0zV.js"),__vite__mapDeps([25,1,5,6,3,7,11,15])),"Profile"),ht=se(()=>Z(()=>import("../chunks/RehearsalAttendance-BuLj0ycM.js"),__vite__mapDeps([26,1,5,6,3,7])),"ConductorAttendance"),nr=se(()=>Z(()=>import("../chunks/OrchestraEnrollmentManager-CuB7bsxe.js"),__vite__mapDeps([27,1,5,6,3,7])),"OrchestraEnrollmentManager"),lr=se(()=>Z(()=>import("../chunks/StudentDetailsPageSimple-LYKuBLke.js"),__vite__mapDeps([12,1,7,5,6,3,13,14,15,4])),"StudentDetailsPage"),or=se(()=>Z(()=>import("../chunks/TeacherDetailsPage-Be8eunUW.js"),__vite__mapDeps([28,1,7,8,3,5,6])),"TeacherDetailsPage"),ir=se(()=>Z(()=>import("../chunks/OrchestraDetailsPage-DJ-ekzfT.js"),__vite__mapDeps([29,1,5,6,3,7,11])),"OrchestraDetailsPage"),ae=({message:t="×˜×•×¢×Ÿ ×¢××•×“..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:t})]})});function q({children:t,allowedRoles:s}){const{isAuthenticated:n,isLoading:c,authError:o,checkAuthStatus:a,user:i}=fe(),[f,m]=ke.useState(0),d=2,h=()=>{if(!s||s.length===0)return!0;if(!i)return!1;const I=i.role||i.roles?.[0]||"",R=i.roles||[I],S={×× ×”×œ:"admin",××•×¨×”:"teacher",×× ×¦×—:"conductor","××“×¨×™×š ×ª×“×¨":"theory-teacher","××•×¨×” ×ª×™××•×¨×™×”":"theory-teacher"},L=R.map(D=>S[D]||D),F=S[I]||I;return s.some(D=>L.includes(D)||F===D||D==="admin"&&!I)};return ke.useEffect(()=>{if(o&&f<d){const I=setTimeout(()=>{console.log(`ğŸ”„ ProtectedRoute - Retrying authentication (${f+1}/${d})`),a(!0),m(R=>R+1)},1e3*(f+1));return()=>clearTimeout(I)}},[o,f,a]),ke.useEffect(()=>{n&&f>0&&m(0)},[n]),c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"××××ª ×”×¨×©××•×ª..."}),o&&f>0&&e.jsxs("div",{className:"mt-2 text-sm text-amber-600",children:["×× ×¡×” ×©×•×‘ (",f,"/",d,")..."]})]})}):n?h()?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"××™×Ÿ ×”×¨×©××”"}),e.jsx("p",{className:"text-gray-600",children:"××™×Ÿ ×œ×š ×”×¨×©××” ×œ×’×©×ª ×œ×¢××•×“ ×–×”"})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"×—×–×•×¨"})]})}):e.jsx(Se,{to:"/login",replace:!0})}function cr(){return e.jsx("div",{dir:"rtl",children:e.jsxs(Ft,{children:[e.jsx(Y,{path:"/login",element:e.jsx(Hs,{})}),e.jsx(Y,{path:"/forgot-password",element:e.jsx(zs,{})}),e.jsx(Y,{path:"/reset-password/:token",element:e.jsx(Xs,{})}),e.jsx(Y,{path:"/dashboard",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×“×©×‘×•×¨×“..."}),children:e.jsx(Js,{})})})})}),e.jsx(Y,{path:"/students",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}),children:e.jsx(dt,{})})})})}),e.jsx(Y,{path:"/students/:studentId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×œ××™×“..."}),children:e.jsx(lr,{})})})})}),e.jsx(Y,{path:"/teachers",element:e.jsx(q,{allowedRoles:["admin","teacher","conductor","theory-teacher"],children:e.jsx(X,{children:e.jsx(Zs,{})})})}),e.jsx(Y,{path:"/teachers/:teacherId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××•×¨×”..."})]})}),children:e.jsx(or,{})})})})}),e.jsx(Y,{path:"/theory-lessons",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(Be,{})})})}),e.jsx(Y,{path:"/theory-lessons/:theoryId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(er,{})})})}),e.jsx(Y,{path:"/orchestras",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(ut,{})})})}),e.jsx(Y,{path:"/orchestras/:orchestraId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×–××•×¨×ª..."})]})}),children:e.jsx(ir,{})})})})}),e.jsx(Y,{path:"/rehearsals",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(mt,{})})})}),e.jsx(Y,{path:"/rehearsals/:rehearsalId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(tr,{})})})}),e.jsx(Y,{path:"/bagruts",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(sr,{})})})}),e.jsx(Y,{path:"/bagruts/:bagrutId",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(rr,{})})})}),e.jsx(Y,{path:"/bagruts/:bagrutId/edit",element:e.jsx(q,{children:e.jsx(X,{children:e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"×¢×¨×™×›×ª ×‘×’×¨×•×ª"}),e.jsx("p",{className:"text-gray-600",children:"×¢×¨×™×›×ª ×¤×¨×˜×™ ×”×‘×’×¨×•×ª ×•×”×ª×§×“××•×ª"}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-blue-700",children:"ğŸ”§ ×¢××•×“ ×¢×¨×™×›×ª ×‘×’×¨×•×ª ×‘×¤×™×ª×•×— - ×‘×™× ×ª×™×™× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×“×¨×š ×¢××•×“ ×”×¤×¨×˜×™×"})})]})})})}),e.jsx(Y,{path:"/bagrut",element:e.jsx(Se,{to:"/bagruts",replace:!0})}),e.jsx(Y,{path:"/profile",element:e.jsx(q,{children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×¢××•×“ ××™×©×™..."}),children:e.jsx(ar,{})})})})}),e.jsx(Y,{path:"/conductor/attendance",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×•×ª..."}),children:e.jsx(ht,{})})})})}),e.jsx(Y,{path:"/conductor/attendance/:rehearsalId",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×”..."}),children:e.jsx(ht,{})})})})}),e.jsx(Y,{path:"/conductor/enrollment",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×¨×™×©×•××™×..."}),children:e.jsx(nr,{})})})})}),e.jsx(Y,{path:"/conductor/orchestras",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×ª×–××•×¨×•×ª..."}),children:e.jsx(ut,{})})})})}),e.jsx(Y,{path:"/conductor/rehearsals",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×—×–×¨×•×ª..."}),children:e.jsx(mt,{})})})})}),e.jsx(Y,{path:"/conductor/musicians",element:e.jsx(q,{allowedRoles:["conductor","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ××•×–×™×§××™×..."}),children:e.jsx(dt,{})})})})}),e.jsx(Y,{path:"/theory-teacher/lessons",element:e.jsx(q,{allowedRoles:["theory-teacher","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”..."}),children:e.jsx(Be,{})})})})}),e.jsx(Y,{path:"/theory-teacher/groups",element:e.jsx(q,{allowedRoles:["theory-teacher","admin"],children:e.jsx(X,{children:e.jsx(u.Suspense,{fallback:e.jsx(ae,{message:"×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”..."}),children:e.jsx(Be,{})})})})}),e.jsx(Y,{path:"/",element:e.jsx(Se,{to:"/dashboard",replace:!0})}),e.jsx(Y,{path:"*",element:e.jsx(Se,{to:"/dashboard",replace:!0})})]})})}function dr(){return u.useEffect(()=>{Ks()},[]),e.jsx(ps,{children:e.jsx(os,{children:e.jsx(is,{children:e.jsx(fs,{children:e.jsx(ys,{children:e.jsx(cr,{})})})})})})}Ht();const ur=new xt({defaultOptions:{queries:{staleTime:1e3*60*5,retry:(t,s)=>s?.status===404||s?.status===403?!1:t<3}}}),kt=document.getElementById("root");if(!kt)throw new Error("Root element not found");Me.createRoot(kt).render(e.jsx(ke.StrictMode,{children:e.jsx(ft,{client:ur,children:e.jsx(Mt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(dr,{})})})}));export{Ds as A,Es as D,Ls as R,Ts as S,Cs as T,Ve as V,wt as a,qe as b,ot as c,St as d,As as e,_s as f,Tr as g,Nr as h,jr as i,e as j,vr as k,wr as s,fe as u};
