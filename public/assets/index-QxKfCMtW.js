var Gv=t=>{throw TypeError(t)};var b1=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var Rf=(t,s,n)=>s.has(t)||Gv("Cannot "+n);var ge=(t,s,n)=>(Rf(t,s,"read from private field"),n?n.call(t):s.get(t)),tt=(t,s,n)=>s.has(t)?Gv("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,n),Ye=(t,s,n,i)=>(Rf(t,s,"write to private field"),i?i.call(t,n):s.set(t,n),n),Ht=(t,s,n)=>(Rf(t,s,"access private method"),n);var jd=(t,s,n,i)=>({set _(l){Ye(t,s,l,n)},get _(){return ge(t,s,i)}});var QR=b1((ea,ta)=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=n(l);fetch(l.href,c)}})();function Ja(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Mf={exports:{}},Ao={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv;function N1(){if(Qv)return Ao;Qv=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function n(i,l,c){var u=null;if(c!==void 0&&(u=""+c),l.key!==void 0&&(u=""+l.key),"key"in l){c={};for(var f in l)f!=="key"&&(c[f]=l[f])}else c=l;return l=c.ref,{$$typeof:t,type:i,key:u,ref:l!==void 0?l:null,props:c}}return Ao.Fragment=s,Ao.jsx=n,Ao.jsxs=n,Ao}var Xv;function S1(){return Xv||(Xv=1,Mf.exports=N1()),Mf.exports}var e=S1(),zf={exports:{}},Xe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zv;function w1(){if(Zv)return Xe;Zv=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function j(O){return O===null||typeof O!="object"?null:(O=v&&O[v]||O["@@iterator"],typeof O=="function"?O:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function A(O,U,Y){this.props=O,this.context=U,this.refs=w,this.updater=Y||N}A.prototype.isReactComponent={},A.prototype.setState=function(O,U){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,U,"setState")},A.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function S(){}S.prototype=A.prototype;function C(O,U,Y){this.props=O,this.context=U,this.refs=w,this.updater=Y||N}var D=C.prototype=new S;D.constructor=C,b(D,A.prototype),D.isPureReactComponent=!0;var I=Array.isArray,T={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function E(O,U,Y,Z,H,P){return Y=P.ref,{$$typeof:t,type:O,key:U,ref:Y!==void 0?Y:null,props:P}}function _(O,U){return E(O.type,U,void 0,void 0,void 0,O.props)}function k(O){return typeof O=="object"&&O!==null&&O.$$typeof===t}function z(O){var U={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(Y){return U[Y]})}var M=/\/+/g;function G(O,U){return typeof O=="object"&&O!==null&&O.key!=null?z(""+O.key):U.toString(36)}function X(){}function W(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(X,X):(O.status="pending",O.then(function(U){O.status==="pending"&&(O.status="fulfilled",O.value=U)},function(U){O.status==="pending"&&(O.status="rejected",O.reason=U)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function te(O,U,Y,Z,H){var P=typeof O;(P==="undefined"||P==="boolean")&&(O=null);var q=!1;if(O===null)q=!0;else switch(P){case"bigint":case"string":case"number":q=!0;break;case"object":switch(O.$$typeof){case t:case s:q=!0;break;case y:return q=O._init,te(q(O._payload),U,Y,Z,H)}}if(q)return H=H(O),q=Z===""?"."+G(O,0):Z,I(H)?(Y="",q!=null&&(Y=q.replace(M,"$&/")+"/"),te(H,U,Y,"",function(ae){return ae})):H!=null&&(k(H)&&(H=_(H,Y+(H.key==null||O&&O.key===H.key?"":(""+H.key).replace(M,"$&/")+"/")+q)),U.push(H)),1;q=0;var B=Z===""?".":Z+":";if(I(O))for(var se=0;se<O.length;se++)Z=O[se],P=B+G(Z,se),q+=te(Z,U,Y,P,H);else if(se=j(O),typeof se=="function")for(O=se.call(O),se=0;!(Z=O.next()).done;)Z=Z.value,P=B+G(Z,se++),q+=te(Z,U,Y,P,H);else if(P==="object"){if(typeof O.then=="function")return te(W(O),U,Y,Z,H);throw U=String(O),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return q}function L(O,U,Y){if(O==null)return O;var Z=[],H=0;return te(O,Z,"","",function(P){return U.call(Y,P,H++)}),Z}function J(O){if(O._status===-1){var U=O._result;U=U(),U.then(function(Y){(O._status===0||O._status===-1)&&(O._status=1,O._result=Y)},function(Y){(O._status===0||O._status===-1)&&(O._status=2,O._result=Y)}),O._status===-1&&(O._status=0,O._result=U)}if(O._status===1)return O._result.default;throw O._result}var K=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)};function le(){}return Xe.Children={map:L,forEach:function(O,U,Y){L(O,function(){U.apply(this,arguments)},Y)},count:function(O){var U=0;return L(O,function(){U++}),U},toArray:function(O){return L(O,function(U){return U})||[]},only:function(O){if(!k(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},Xe.Component=A,Xe.Fragment=n,Xe.Profiler=l,Xe.PureComponent=C,Xe.StrictMode=i,Xe.Suspense=p,Xe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,Xe.act=function(){throw Error("act(...) is not supported in production builds of React.")},Xe.cache=function(O){return function(){return O.apply(null,arguments)}},Xe.cloneElement=function(O,U,Y){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var Z=b({},O.props),H=O.key,P=void 0;if(U!=null)for(q in U.ref!==void 0&&(P=void 0),U.key!==void 0&&(H=""+U.key),U)!R.call(U,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&U.ref===void 0||(Z[q]=U[q]);var q=arguments.length-2;if(q===1)Z.children=Y;else if(1<q){for(var B=Array(q),se=0;se<q;se++)B[se]=arguments[se+2];Z.children=B}return E(O.type,H,void 0,void 0,P,Z)},Xe.createContext=function(O){return O={$$typeof:u,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:c,_context:O},O},Xe.createElement=function(O,U,Y){var Z,H={},P=null;if(U!=null)for(Z in U.key!==void 0&&(P=""+U.key),U)R.call(U,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(H[Z]=U[Z]);var q=arguments.length-2;if(q===1)H.children=Y;else if(1<q){for(var B=Array(q),se=0;se<q;se++)B[se]=arguments[se+2];H.children=B}if(O&&O.defaultProps)for(Z in q=O.defaultProps,q)H[Z]===void 0&&(H[Z]=q[Z]);return E(O,P,void 0,void 0,null,H)},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(O){return{$$typeof:f,render:O}},Xe.isValidElement=k,Xe.lazy=function(O){return{$$typeof:y,_payload:{_status:-1,_result:O},_init:J}},Xe.memo=function(O,U){return{$$typeof:m,type:O,compare:U===void 0?null:U}},Xe.startTransition=function(O){var U=T.T,Y={};T.T=Y;try{var Z=O(),H=T.S;H!==null&&H(Y,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(le,K)}catch(P){K(P)}finally{T.T=U}},Xe.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},Xe.use=function(O){return T.H.use(O)},Xe.useActionState=function(O,U,Y){return T.H.useActionState(O,U,Y)},Xe.useCallback=function(O,U){return T.H.useCallback(O,U)},Xe.useContext=function(O){return T.H.useContext(O)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(O,U){return T.H.useDeferredValue(O,U)},Xe.useEffect=function(O,U){return T.H.useEffect(O,U)},Xe.useId=function(){return T.H.useId()},Xe.useImperativeHandle=function(O,U,Y){return T.H.useImperativeHandle(O,U,Y)},Xe.useInsertionEffect=function(O,U){return T.H.useInsertionEffect(O,U)},Xe.useLayoutEffect=function(O,U){return T.H.useLayoutEffect(O,U)},Xe.useMemo=function(O,U){return T.H.useMemo(O,U)},Xe.useOptimistic=function(O,U){return T.H.useOptimistic(O,U)},Xe.useReducer=function(O,U,Y){return T.H.useReducer(O,U,Y)},Xe.useRef=function(O){return T.H.useRef(O)},Xe.useState=function(O){return T.H.useState(O)},Xe.useSyncExternalStore=function(O,U,Y){return T.H.useSyncExternalStore(O,U,Y)},Xe.useTransition=function(){return T.H.useTransition()},Xe.version="19.0.0",Xe}var Wv;function Um(){return Wv||(Wv=1,zf.exports=w1()),zf.exports}var x=Um();const ii=Ja(x);var Lf={exports:{}},Co={},Bf={exports:{}},Ff={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kv;function T1(){return Kv||(Kv=1,function(t){function s(L,J){var K=L.length;L.push(J);e:for(;0<K;){var le=K-1>>>1,O=L[le];if(0<l(O,J))L[le]=J,L[K]=O,K=le;else break e}}function n(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var J=L[0],K=L.pop();if(K!==J){L[0]=K;e:for(var le=0,O=L.length,U=O>>>1;le<U;){var Y=2*(le+1)-1,Z=L[Y],H=Y+1,P=L[H];if(0>l(Z,K))H<O&&0>l(P,Z)?(L[le]=P,L[H]=K,le=H):(L[le]=Z,L[Y]=K,le=Y);else if(H<O&&0>l(P,K))L[le]=P,L[H]=K,le=H;else break e}}return J}function l(L,J){var K=L.sortIndex-J.sortIndex;return K!==0?K:L.id-J.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var u=Date,f=u.now();t.unstable_now=function(){return u.now()-f}}var p=[],m=[],y=1,v=null,j=3,N=!1,b=!1,w=!1,A=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function D(L){for(var J=n(m);J!==null;){if(J.callback===null)i(m);else if(J.startTime<=L)i(m),J.sortIndex=J.expirationTime,s(p,J);else break;J=n(m)}}function I(L){if(w=!1,D(L),!b)if(n(p)!==null)b=!0,W();else{var J=n(m);J!==null&&te(I,J.startTime-L)}}var T=!1,R=-1,E=5,_=-1;function k(){return!(t.unstable_now()-_<E)}function z(){if(T){var L=t.unstable_now();_=L;var J=!0;try{e:{b=!1,w&&(w=!1,S(R),R=-1),N=!0;var K=j;try{t:{for(D(L),v=n(p);v!==null&&!(v.expirationTime>L&&k());){var le=v.callback;if(typeof le=="function"){v.callback=null,j=v.priorityLevel;var O=le(v.expirationTime<=L);if(L=t.unstable_now(),typeof O=="function"){v.callback=O,D(L),J=!0;break t}v===n(p)&&i(p),D(L)}else i(p);v=n(p)}if(v!==null)J=!0;else{var U=n(m);U!==null&&te(I,U.startTime-L),J=!1}}break e}finally{v=null,j=K,N=!1}J=void 0}}finally{J?M():T=!1}}}var M;if(typeof C=="function")M=function(){C(z)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,X=G.port2;G.port1.onmessage=z,M=function(){X.postMessage(null)}}else M=function(){A(z,0)};function W(){T||(T=!0,M())}function te(L,J){R=A(function(){L(t.unstable_now())},J)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){b||N||(b=!0,W())},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return j},t.unstable_getFirstCallbackNode=function(){return n(p)},t.unstable_next=function(L){switch(j){case 1:case 2:case 3:var J=3;break;default:J=j}var K=j;j=J;try{return L()}finally{j=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,J){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var K=j;j=L;try{return J()}finally{j=K}},t.unstable_scheduleCallback=function(L,J,K){var le=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?le+K:le):K=le,L){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=K+O,L={id:y++,callback:J,priorityLevel:L,startTime:K,expirationTime:O,sortIndex:-1},K>le?(L.sortIndex=K,s(m,L),n(p)===null&&L===n(m)&&(w?(S(R),R=-1):w=!0,te(I,K-le))):(L.sortIndex=O,s(p,L),b||N||(b=!0,W())),L},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(L){var J=j;return function(){var K=j;j=J;try{return L.apply(this,arguments)}finally{j=K}}}}(Ff)),Ff}var Jv;function E1(){return Jv||(Jv=1,Bf.exports=T1()),Bf.exports}var Uf={exports:{}},js={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ex;function A1(){if(ex)return js;ex=1;var t=Um();function s(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(s(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(p,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:v==null?null:""+v,children:p,containerInfo:m,implementation:y}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return js.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,js.createPortal=function(p,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(s(299));return c(p,m,null,y)},js.flushSync=function(p){var m=u.T,y=i.p;try{if(u.T=null,i.p=2,p)return p()}finally{u.T=m,i.p=y,i.d.f()}},js.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,i.d.C(p,m))},js.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},js.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin),j=typeof m.integrity=="string"?m.integrity:void 0,N=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?i.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:j,fetchPriority:N}):y==="script"&&i.d.X(p,{crossOrigin:v,integrity:j,fetchPriority:N,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},js.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=f(m.as,m.crossOrigin);i.d.M(p,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&i.d.M(p)},js.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin);i.d.L(p,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},js.preloadModule=function(p,m){if(typeof p=="string")if(m){var y=f(m.as,m.crossOrigin);i.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else i.d.m(p)},js.requestFormReset=function(p){i.d.r(p)},js.unstable_batchedUpdates=function(p,m){return p(m)},js.useFormState=function(p,m,y){return u.H.useFormState(p,m,y)},js.useFormStatus=function(){return u.H.useHostTransitionStatus()},js.version="19.0.0",js}var tx;function e0(){if(tx)return Uf.exports;tx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),Uf.exports=A1(),Uf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sx;function C1(){if(sx)return Co;sx=1;var t=E1(),s=Um(),n=e0();function i(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}var c=Symbol.for("react.element"),u=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),j=Symbol.for("react.consumer"),N=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),D=Symbol.for("react.offscreen"),I=Symbol.for("react.memo_cache_sentinel"),T=Symbol.iterator;function R(a){return a===null||typeof a!="object"?null:(a=T&&a[T]||a["@@iterator"],typeof a=="function"?a:null)}var E=Symbol.for("react.client.reference");function _(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===E?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case p:return"Fragment";case f:return"Portal";case y:return"Profiler";case m:return"StrictMode";case w:return"Suspense";case A:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case N:return(a.displayName||"Context")+".Provider";case j:return(a._context.displayName||"Context")+".Consumer";case b:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case S:return r=a.displayName||null,r!==null?r:_(a.type)||"Memo";case C:r=a._payload,a=a._init;try{return _(a(r))}catch{}}return null}var k=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=Object.assign,M,G;function X(a){if(M===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);M=r&&r[1]||"",G=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+M+a+G}var W=!1;function te(a,r){if(!a||W)return"";W=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(r){var Ae=function(){throw Error()};if(Object.defineProperty(Ae.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ae,[])}catch(Se){var fe=Se}Reflect.construct(a,[],Ae)}else{try{Ae.call()}catch(Se){fe=Se}a.call(Ae.prototype)}}else{try{throw Error()}catch(Se){fe=Se}(Ae=a())&&typeof Ae.catch=="function"&&Ae.catch(function(){})}}catch(Se){if(Se&&fe&&typeof Se.stack=="string")return[Se.stack,fe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=d.DetermineComponentFrameRoot(),$=g[0],F=g[1];if($&&F){var ee=$.split(`
`),ie=F.split(`
`);for(h=d=0;d<ee.length&&!ee[d].includes("DetermineComponentFrameRoot");)d++;for(;h<ie.length&&!ie[h].includes("DetermineComponentFrameRoot");)h++;if(d===ee.length||h===ie.length)for(d=ee.length-1,h=ie.length-1;1<=d&&0<=h&&ee[d]!==ie[h];)h--;for(;1<=d&&0<=h;d--,h--)if(ee[d]!==ie[h]){if(d!==1||h!==1)do if(d--,h--,0>h||ee[d]!==ie[h]){var we=`
`+ee[d].replace(" at new "," at ");return a.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",a.displayName)),we}while(1<=d&&0<=h);break}}}finally{W=!1,Error.prepareStackTrace=o}return(o=a?a.displayName||a.name:"")?X(o):""}function L(a){switch(a.tag){case 26:case 27:case 5:return X(a.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return a=te(a.type,!1),a;case 11:return a=te(a.type.render,!1),a;case 1:return a=te(a.type,!0),a;default:return""}}function J(a){try{var r="";do r+=L(a),a=a.return;while(a);return r}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function K(a){var r=a,o=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(o=r.return),a=r.return;while(a)}return r.tag===3?o:null}function le(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function O(a){if(K(a)!==a)throw Error(i(188))}function U(a){var r=a.alternate;if(!r){if(r=K(a),r===null)throw Error(i(188));return r!==a?null:a}for(var o=a,d=r;;){var h=o.return;if(h===null)break;var g=h.alternate;if(g===null){if(d=h.return,d!==null){o=d;continue}break}if(h.child===g.child){for(g=h.child;g;){if(g===o)return O(h),a;if(g===d)return O(h),r;g=g.sibling}throw Error(i(188))}if(o.return!==d.return)o=h,d=g;else{for(var $=!1,F=h.child;F;){if(F===o){$=!0,o=h,d=g;break}if(F===d){$=!0,d=h,o=g;break}F=F.sibling}if(!$){for(F=g.child;F;){if(F===o){$=!0,o=g,d=h;break}if(F===d){$=!0,d=g,o=h;break}F=F.sibling}if(!$)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?a:r}function Y(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=Y(a),r!==null)return r;a=a.sibling}return null}var Z=Array.isArray,H=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},q=[],B=-1;function se(a){return{current:a}}function ae(a){0>B||(a.current=q[B],q[B]=null,B--)}function oe(a,r){B++,q[B]=a.current,a.current=r}var ce=se(null),Q=se(null),ne=se(null),pe=se(null);function me(a,r){switch(oe(ne,r),oe(Q,a),oe(ce,null),a=r.nodeType,a){case 9:case 11:r=(r=r.documentElement)&&(r=r.namespaceURI)?Nv(r):0;break;default:if(a=a===8?r.parentNode:r,r=a.tagName,a=a.namespaceURI)a=Nv(a),r=Sv(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ae(ce),oe(ce,r)}function je(){ae(ce),ae(Q),ae(ne)}function Oe(a){a.memoizedState!==null&&oe(pe,a);var r=ce.current,o=Sv(r,a.type);r!==o&&(oe(Q,a),oe(ce,o))}function De(a){Q.current===a&&(ae(ce),ae(Q)),pe.current===a&&(ae(pe),No._currentValue=P)}var be=Object.prototype.hasOwnProperty,Te=t.unstable_scheduleCallback,Be=t.unstable_cancelCallback,V=t.unstable_shouldYield,ue=t.unstable_requestPaint,ve=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,_e=t.unstable_ImmediatePriority,Ie=t.unstable_UserBlockingPriority,Ue=t.unstable_NormalPriority,It=t.unstable_LowPriority,qe=t.unstable_IdlePriority,mt=t.log,$t=t.unstable_setDisableYieldValue,Pt=null,yt=null;function xi(a){if(yt&&typeof yt.onCommitFiberRoot=="function")try{yt.onCommitFiberRoot(Pt,a,void 0,(a.current.flags&128)===128)}catch{}}function Sa(a){if(typeof mt=="function"&&$t(a),yt&&typeof yt.setStrictMode=="function")try{yt.setStrictMode(Pt,a)}catch{}}var ke=Math.clz32?Math.clz32:Ct,Le=Math.log,Vt=Math.LN2;function Ct(a){return a>>>=0,a===0?32:31-(Le(a)/Vt|0)|0}var dt=128,ls=4194304;function aa(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function tn(a,r){var o=a.pendingLanes;if(o===0)return 0;var d=0,h=a.suspendedLanes,g=a.pingedLanes,$=a.warmLanes;a=a.finishedLanes!==0;var F=o&134217727;return F!==0?(o=F&~h,o!==0?d=aa(o):(g&=F,g!==0?d=aa(g):a||($=F&~$,$!==0&&(d=aa($))))):(F=o&~h,F!==0?d=aa(F):g!==0?d=aa(g):a||($=o&~$,$!==0&&(d=aa($)))),d===0?0:r!==0&&r!==d&&(r&h)===0&&(h=d&-d,$=r&-r,h>=$||h===32&&($&4194176)!==0)?r:d}function Tr(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function dc(a,r){switch(a){case 1:case 2:case 4:case 8:return r+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function uc(){var a=dt;return dt<<=1,(dt&4194176)===0&&(dt=128),a}function hc(){var a=ls;return ls<<=1,(ls&62914560)===0&&(ls=4194304),a}function Du(a){for(var r=[],o=0;31>o;o++)r.push(a);return r}function Ol(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function dN(a,r,o,d,h,g){var $=a.pendingLanes;a.pendingLanes=o,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=o,a.entangledLanes&=o,a.errorRecoveryDisabledLanes&=o,a.shellSuspendCounter=0;var F=a.entanglements,ee=a.expirationTimes,ie=a.hiddenUpdates;for(o=$&~o;0<o;){var we=31-ke(o),Ae=1<<we;F[we]=0,ee[we]=-1;var fe=ie[we];if(fe!==null)for(ie[we]=null,we=0;we<fe.length;we++){var Se=fe[we];Se!==null&&(Se.lane&=-536870913)}o&=~Ae}d!==0&&gp(a,d,0),g!==0&&h===0&&a.tag!==0&&(a.suspendedLanes|=g&~($&~r))}function gp(a,r,o){a.pendingLanes|=r,a.suspendedLanes&=~r;var d=31-ke(r);a.entangledLanes|=r,a.entanglements[d]=a.entanglements[d]|1073741824|o&4194218}function yp(a,r){var o=a.entangledLanes|=r;for(a=a.entanglements;o;){var d=31-ke(o),h=1<<d;h&r|a[d]&r&&(a[d]|=r),o&=~h}}function vp(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function xp(){var a=H.p;return a!==0?a:(a=window.event,a===void 0?32:Uv(a.type))}function uN(a,r){var o=H.p;try{return H.p=a,r()}finally{H.p=o}}var Mn=Math.random().toString(36).slice(2),vs="__reactFiber$"+Mn,ks="__reactProps$"+Mn,ji="__reactContainer$"+Mn,ku="__reactEvents$"+Mn,hN="__reactListeners$"+Mn,fN="__reactHandles$"+Mn,jp="__reactResources$"+Mn,Il="__reactMarker$"+Mn;function _u(a){delete a[vs],delete a[ks],delete a[ku],delete a[hN],delete a[fN]}function Er(a){var r=a[vs];if(r)return r;for(var o=a.parentNode;o;){if(r=o[ji]||o[vs]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(a=Ev(a);a!==null;){if(o=a[vs])return o;a=Ev(a)}return r}a=o,o=a.parentNode}return null}function bi(a){if(a=a[vs]||a[ji]){var r=a.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return a}return null}function $l(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(i(33))}function Ni(a){var r=a[jp];return r||(r=a[jp]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function ss(a){a[Il]=!0}var bp=new Set,Np={};function Ar(a,r){Si(a,r),Si(a+"Capture",r)}function Si(a,r){for(Np[a]=r,a=0;a<r.length;a++)bp.add(r[a])}var sn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mN=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sp={},wp={};function pN(a){return be.call(wp,a)?!0:be.call(Sp,a)?!1:mN.test(a)?wp[a]=!0:(Sp[a]=!0,!1)}function fc(a,r,o){if(pN(r))if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var d=r.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+o)}}function mc(a,r,o){if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+o)}}function an(a,r,o,d){if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttributeNS(r,o,""+d)}}function na(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Tp(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function gN(a){var r=Tp(a)?"checked":"value",o=Object.getOwnPropertyDescriptor(a.constructor.prototype,r),d=""+a[r];if(!a.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var h=o.get,g=o.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return h.call(this)},set:function($){d=""+$,g.call(this,$)}}),Object.defineProperty(a,r,{enumerable:o.enumerable}),{getValue:function(){return d},setValue:function($){d=""+$},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function pc(a){a._valueTracker||(a._valueTracker=gN(a))}function Ep(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var o=r.getValue(),d="";return a&&(d=Tp(a)?a.checked?"true":"false":a.value),a=d,a!==o?(r.setValue(a),!0):!1}function gc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var yN=/[\n"\\]/g;function ra(a){return a.replace(yN,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Ou(a,r,o,d,h,g,$,F){a.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?a.type=$:a.removeAttribute("type"),r!=null?$==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+na(r)):a.value!==""+na(r)&&(a.value=""+na(r)):$!=="submit"&&$!=="reset"||a.removeAttribute("value"),r!=null?Iu(a,$,na(r)):o!=null?Iu(a,$,na(o)):d!=null&&a.removeAttribute("value"),h==null&&g!=null&&(a.defaultChecked=!!g),h!=null&&(a.checked=h&&typeof h!="function"&&typeof h!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?a.name=""+na(F):a.removeAttribute("name")}function Ap(a,r,o,d,h,g,$,F){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(a.type=g),r!=null||o!=null){if(!(g!=="submit"&&g!=="reset"||r!=null))return;o=o!=null?""+na(o):"",r=r!=null?""+na(r):o,F||r===a.value||(a.value=r),a.defaultValue=r}d=d??h,d=typeof d!="function"&&typeof d!="symbol"&&!!d,a.checked=F?a.checked:!!d,a.defaultChecked=!!d,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(a.name=$)}function Iu(a,r,o){r==="number"&&gc(a.ownerDocument)===a||a.defaultValue===""+o||(a.defaultValue=""+o)}function wi(a,r,o,d){if(a=a.options,r){r={};for(var h=0;h<o.length;h++)r["$"+o[h]]=!0;for(o=0;o<a.length;o++)h=r.hasOwnProperty("$"+a[o].value),a[o].selected!==h&&(a[o].selected=h),h&&d&&(a[o].defaultSelected=!0)}else{for(o=""+na(o),r=null,h=0;h<a.length;h++){if(a[h].value===o){a[h].selected=!0,d&&(a[h].defaultSelected=!0);return}r!==null||a[h].disabled||(r=a[h])}r!==null&&(r.selected=!0)}}function Cp(a,r,o){if(r!=null&&(r=""+na(r),r!==a.value&&(a.value=r),o==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=o!=null?""+na(o):""}function Dp(a,r,o,d){if(r==null){if(d!=null){if(o!=null)throw Error(i(92));if(Z(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),r=o}o=na(r),a.defaultValue=o,d=a.textContent,d===o&&d!==""&&d!==null&&(a.value=d)}function Ti(a,r){if(r){var o=a.firstChild;if(o&&o===a.lastChild&&o.nodeType===3){o.nodeValue=r;return}}a.textContent=r}var vN=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kp(a,r,o){var d=r.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":d?a.setProperty(r,o):typeof o!="number"||o===0||vN.has(r)?r==="float"?a.cssFloat=o:a[r]=(""+o).trim():a[r]=o+"px"}function _p(a,r,o){if(r!=null&&typeof r!="object")throw Error(i(62));if(a=a.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||r!=null&&r.hasOwnProperty(d)||(d.indexOf("--")===0?a.setProperty(d,""):d==="float"?a.cssFloat="":a[d]="");for(var h in r)d=r[h],r.hasOwnProperty(h)&&o[h]!==d&&kp(a,h,d)}else for(var g in r)r.hasOwnProperty(g)&&kp(a,g,r[g])}function $u(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xN=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jN=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function yc(a){return jN.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Ru=null;function Mu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ei=null,Ai=null;function Op(a){var r=bi(a);if(r&&(a=r.stateNode)){var o=a[ks]||null;e:switch(a=r.stateNode,r.type){case"input":if(Ou(a,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),r=o.name,o.type==="radio"&&r!=null){for(o=a;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+ra(""+r)+'"][type="radio"]'),r=0;r<o.length;r++){var d=o[r];if(d!==a&&d.form===a.form){var h=d[ks]||null;if(!h)throw Error(i(90));Ou(d,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(r=0;r<o.length;r++)d=o[r],d.form===a.form&&Ep(d)}break e;case"textarea":Cp(a,o.value,o.defaultValue);break e;case"select":r=o.value,r!=null&&wi(a,!!o.multiple,r,!1)}}}var zu=!1;function Ip(a,r,o){if(zu)return a(r,o);zu=!0;try{var d=a(r);return d}finally{if(zu=!1,(Ei!==null||Ai!==null)&&(ed(),Ei&&(r=Ei,a=Ai,Ai=Ei=null,Op(r),a)))for(r=0;r<a.length;r++)Op(a[r])}}function Rl(a,r){var o=a.stateNode;if(o===null)return null;var d=o[ks]||null;if(d===null)return null;o=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(a=a.type,d=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!d;break e;default:a=!1}if(a)return null;if(o&&typeof o!="function")throw Error(i(231,r,typeof o));return o}var Lu=!1;if(sn)try{var Ml={};Object.defineProperty(Ml,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",Ml,Ml),window.removeEventListener("test",Ml,Ml)}catch{Lu=!1}var zn=null,Bu=null,vc=null;function $p(){if(vc)return vc;var a,r=Bu,o=r.length,d,h="value"in zn?zn.value:zn.textContent,g=h.length;for(a=0;a<o&&r[a]===h[a];a++);var $=o-a;for(d=1;d<=$&&r[o-d]===h[g-d];d++);return vc=h.slice(a,1<d?1-d:void 0)}function xc(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function jc(){return!0}function Rp(){return!1}function _s(a){function r(o,d,h,g,$){this._reactName=o,this._targetInst=h,this.type=d,this.nativeEvent=g,this.target=$,this.currentTarget=null;for(var F in a)a.hasOwnProperty(F)&&(o=a[F],this[F]=o?o(g):g[F]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?jc:Rp,this.isPropagationStopped=Rp,this}return z(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=jc)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=jc)},persist:function(){},isPersistent:jc}),r}var Cr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bc=_s(Cr),zl=z({},Cr,{view:0,detail:0}),bN=_s(zl),Fu,Uu,Ll,Nc=z({},zl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ll&&(Ll&&a.type==="mousemove"?(Fu=a.screenX-Ll.screenX,Uu=a.screenY-Ll.screenY):Uu=Fu=0,Ll=a),Fu)},movementY:function(a){return"movementY"in a?a.movementY:Uu}}),Mp=_s(Nc),NN=z({},Nc,{dataTransfer:0}),SN=_s(NN),wN=z({},zl,{relatedTarget:0}),Pu=_s(wN),TN=z({},Cr,{animationName:0,elapsedTime:0,pseudoElement:0}),EN=_s(TN),AN=z({},Cr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),CN=_s(AN),DN=z({},Cr,{data:0}),zp=_s(DN),kN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_N={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ON={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IN(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=ON[a])?!!r[a]:!1}function qu(){return IN}var $N=z({},zl,{key:function(a){if(a.key){var r=kN[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=xc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?_N[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qu,charCode:function(a){return a.type==="keypress"?xc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?xc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),RN=_s($N),MN=z({},Nc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lp=_s(MN),zN=z({},zl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qu}),LN=_s(zN),BN=z({},Cr,{propertyName:0,elapsedTime:0,pseudoElement:0}),FN=_s(BN),UN=z({},Nc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),PN=_s(UN),qN=z({},Cr,{newState:0,oldState:0}),HN=_s(qN),YN=[9,13,27,32],Hu=sn&&"CompositionEvent"in window,Bl=null;sn&&"documentMode"in document&&(Bl=document.documentMode);var VN=sn&&"TextEvent"in window&&!Bl,Bp=sn&&(!Hu||Bl&&8<Bl&&11>=Bl),Fp=" ",Up=!1;function Pp(a,r){switch(a){case"keyup":return YN.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qp(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ci=!1;function GN(a,r){switch(a){case"compositionend":return qp(r);case"keypress":return r.which!==32?null:(Up=!0,Fp);case"textInput":return a=r.data,a===Fp&&Up?null:a;default:return null}}function QN(a,r){if(Ci)return a==="compositionend"||!Hu&&Pp(a,r)?(a=$p(),vc=Bu=zn=null,Ci=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Bp&&r.locale!=="ko"?null:r.data;default:return null}}var XN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hp(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!XN[a.type]:r==="textarea"}function Yp(a,r,o,d){Ei?Ai?Ai.push(d):Ai=[d]:Ei=d,r=rd(r,"onChange"),0<r.length&&(o=new bc("onChange","change",null,o,d),a.push({event:o,listeners:r}))}var Fl=null,Ul=null;function ZN(a){yv(a,0)}function Sc(a){var r=$l(a);if(Ep(r))return a}function Vp(a,r){if(a==="change")return r}var Gp=!1;if(sn){var Yu;if(sn){var Vu="oninput"in document;if(!Vu){var Qp=document.createElement("div");Qp.setAttribute("oninput","return;"),Vu=typeof Qp.oninput=="function"}Yu=Vu}else Yu=!1;Gp=Yu&&(!document.documentMode||9<document.documentMode)}function Xp(){Fl&&(Fl.detachEvent("onpropertychange",Zp),Ul=Fl=null)}function Zp(a){if(a.propertyName==="value"&&Sc(Ul)){var r=[];Yp(r,Ul,a,Mu(a)),Ip(ZN,r)}}function WN(a,r,o){a==="focusin"?(Xp(),Fl=r,Ul=o,Fl.attachEvent("onpropertychange",Zp)):a==="focusout"&&Xp()}function KN(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Sc(Ul)}function JN(a,r){if(a==="click")return Sc(r)}function eS(a,r){if(a==="input"||a==="change")return Sc(r)}function tS(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var Ps=typeof Object.is=="function"?Object.is:tS;function Pl(a,r){if(Ps(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var o=Object.keys(a),d=Object.keys(r);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var h=o[d];if(!be.call(r,h)||!Ps(a[h],r[h]))return!1}return!0}function Wp(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Kp(a,r){var o=Wp(a);a=0;for(var d;o;){if(o.nodeType===3){if(d=a+o.textContent.length,a<=r&&d>=r)return{node:o,offset:r-a};a=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Wp(o)}}function Jp(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?Jp(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function eg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=gc(a.document);r instanceof a.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)a=r.contentWindow;else break;r=gc(a.document)}return r}function Gu(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}function sS(a,r){var o=eg(r);r=a.focusedElem;var d=a.selectionRange;if(o!==r&&r&&r.ownerDocument&&Jp(r.ownerDocument.documentElement,r)){if(d!==null&&Gu(r)){if(a=d.start,o=d.end,o===void 0&&(o=a),"selectionStart"in r)r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length);else if(o=(a=r.ownerDocument||document)&&a.defaultView||window,o.getSelection){o=o.getSelection();var h=r.textContent.length,g=Math.min(d.start,h);d=d.end===void 0?g:Math.min(d.end,h),!o.extend&&g>d&&(h=d,d=g,g=h),h=Kp(r,g);var $=Kp(r,d);h&&$&&(o.rangeCount!==1||o.anchorNode!==h.node||o.anchorOffset!==h.offset||o.focusNode!==$.node||o.focusOffset!==$.offset)&&(a=a.createRange(),a.setStart(h.node,h.offset),o.removeAllRanges(),g>d?(o.addRange(a),o.extend($.node,$.offset)):(a.setEnd($.node,$.offset),o.addRange(a)))}}for(a=[],o=r;o=o.parentNode;)o.nodeType===1&&a.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<a.length;r++)o=a[r],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var aS=sn&&"documentMode"in document&&11>=document.documentMode,Di=null,Qu=null,ql=null,Xu=!1;function tg(a,r,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Xu||Di==null||Di!==gc(d)||(d=Di,"selectionStart"in d&&Gu(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ql&&Pl(ql,d)||(ql=d,d=rd(Qu,"onSelect"),0<d.length&&(r=new bc("onSelect","select",null,r,o),a.push({event:r,listeners:d}),r.target=Di)))}function Dr(a,r){var o={};return o[a.toLowerCase()]=r.toLowerCase(),o["Webkit"+a]="webkit"+r,o["Moz"+a]="moz"+r,o}var ki={animationend:Dr("Animation","AnimationEnd"),animationiteration:Dr("Animation","AnimationIteration"),animationstart:Dr("Animation","AnimationStart"),transitionrun:Dr("Transition","TransitionRun"),transitionstart:Dr("Transition","TransitionStart"),transitioncancel:Dr("Transition","TransitionCancel"),transitionend:Dr("Transition","TransitionEnd")},Zu={},sg={};sn&&(sg=document.createElement("div").style,"AnimationEvent"in window||(delete ki.animationend.animation,delete ki.animationiteration.animation,delete ki.animationstart.animation),"TransitionEvent"in window||delete ki.transitionend.transition);function kr(a){if(Zu[a])return Zu[a];if(!ki[a])return a;var r=ki[a],o;for(o in r)if(r.hasOwnProperty(o)&&o in sg)return Zu[a]=r[o];return a}var ag=kr("animationend"),ng=kr("animationiteration"),rg=kr("animationstart"),nS=kr("transitionrun"),rS=kr("transitionstart"),iS=kr("transitioncancel"),ig=kr("transitionend"),lg=new Map,og="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function wa(a,r){lg.set(a,r),Ar(r,[a])}var ia=[],_i=0,Wu=0;function wc(){for(var a=_i,r=Wu=_i=0;r<a;){var o=ia[r];ia[r++]=null;var d=ia[r];ia[r++]=null;var h=ia[r];ia[r++]=null;var g=ia[r];if(ia[r++]=null,d!==null&&h!==null){var $=d.pending;$===null?h.next=h:(h.next=$.next,$.next=h),d.pending=h}g!==0&&cg(o,h,g)}}function Tc(a,r,o,d){ia[_i++]=a,ia[_i++]=r,ia[_i++]=o,ia[_i++]=d,Wu|=d,a.lanes|=d,a=a.alternate,a!==null&&(a.lanes|=d)}function Ku(a,r,o,d){return Tc(a,r,o,d),Ec(a)}function Ln(a,r){return Tc(a,null,null,r),Ec(a)}function cg(a,r,o){a.lanes|=o;var d=a.alternate;d!==null&&(d.lanes|=o);for(var h=!1,g=a.return;g!==null;)g.childLanes|=o,d=g.alternate,d!==null&&(d.childLanes|=o),g.tag===22&&(a=g.stateNode,a===null||a._visibility&1||(h=!0)),a=g,g=g.return;h&&r!==null&&a.tag===3&&(g=a.stateNode,h=31-ke(o),g=g.hiddenUpdates,a=g[h],a===null?g[h]=[r]:a.push(r),r.lane=o|536870912)}function Ec(a){if(50<po)throw po=0,nf=null,Error(i(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var Oi={},dg=new WeakMap;function la(a,r){if(typeof a=="object"&&a!==null){var o=dg.get(a);return o!==void 0?o:(r={value:a,source:r,stack:J(r)},dg.set(a,r),r)}return{value:a,source:r,stack:J(r)}}var Ii=[],$i=0,Ac=null,Cc=0,oa=[],ca=0,_r=null,nn=1,rn="";function Or(a,r){Ii[$i++]=Cc,Ii[$i++]=Ac,Ac=a,Cc=r}function ug(a,r,o){oa[ca++]=nn,oa[ca++]=rn,oa[ca++]=_r,_r=a;var d=nn;a=rn;var h=32-ke(d)-1;d&=~(1<<h),o+=1;var g=32-ke(r)+h;if(30<g){var $=h-h%5;g=(d&(1<<$)-1).toString(32),d>>=$,h-=$,nn=1<<32-ke(r)+h|o<<h|d,rn=g+a}else nn=1<<g|o<<h|d,rn=a}function Ju(a){a.return!==null&&(Or(a,1),ug(a,1,0))}function eh(a){for(;a===Ac;)Ac=Ii[--$i],Ii[$i]=null,Cc=Ii[--$i],Ii[$i]=null;for(;a===_r;)_r=oa[--ca],oa[ca]=null,rn=oa[--ca],oa[ca]=null,nn=oa[--ca],oa[ca]=null}var ws=null,os=null,rt=!1,Ta=null,qa=!1,th=Error(i(519));function Ir(a){var r=Error(i(418,""));throw Vl(la(r,a)),th}function hg(a){var r=a.stateNode,o=a.type,d=a.memoizedProps;switch(r[vs]=a,r[ks]=d,o){case"dialog":st("cancel",r),st("close",r);break;case"iframe":case"object":case"embed":st("load",r);break;case"video":case"audio":for(o=0;o<yo.length;o++)st(yo[o],r);break;case"source":st("error",r);break;case"img":case"image":case"link":st("error",r),st("load",r);break;case"details":st("toggle",r);break;case"input":st("invalid",r),Ap(r,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),pc(r);break;case"select":st("invalid",r);break;case"textarea":st("invalid",r),Dp(r,d.value,d.defaultValue,d.children),pc(r)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||r.textContent===""+o||d.suppressHydrationWarning===!0||bv(r.textContent,o)?(d.popover!=null&&(st("beforetoggle",r),st("toggle",r)),d.onScroll!=null&&st("scroll",r),d.onScrollEnd!=null&&st("scrollend",r),d.onClick!=null&&(r.onclick=id),r=!0):r=!1,r||Ir(a)}function fg(a){for(ws=a.return;ws;)switch(ws.tag){case 3:case 27:qa=!0;return;case 5:case 13:qa=!1;return;default:ws=ws.return}}function Hl(a){if(a!==ws)return!1;if(!rt)return fg(a),rt=!0,!1;var r=!1,o;if((o=a.tag!==3&&a.tag!==27)&&((o=a.tag===5)&&(o=a.type,o=!(o!=="form"&&o!=="button")||Nf(a.type,a.memoizedProps)),o=!o),o&&(r=!0),r&&os&&Ir(a),fg(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));e:{for(a=a.nextSibling,r=0;a;){if(a.nodeType===8)if(o=a.data,o==="/$"){if(r===0){os=Aa(a.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++;a=a.nextSibling}os=null}}else os=ws?Aa(a.stateNode.nextSibling):null;return!0}function Yl(){os=ws=null,rt=!1}function Vl(a){Ta===null?Ta=[a]:Ta.push(a)}var Gl=Error(i(460)),mg=Error(i(474)),sh={then:function(){}};function pg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Dc(){}function gg(a,r,o){switch(o=a[o],o===void 0?a.push(r):o!==r&&(r.then(Dc,Dc),r=o),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,a===Gl?Error(i(483)):a;default:if(typeof r.status=="string")r.then(Dc,Dc);else{if(a=vt,a!==null&&100<a.shellSuspendCounter)throw Error(i(482));a=r,a.status="pending",a.then(function(d){if(r.status==="pending"){var h=r;h.status="fulfilled",h.value=d}},function(d){if(r.status==="pending"){var h=r;h.status="rejected",h.reason=d}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,a===Gl?Error(i(483)):a}throw Ql=r,Gl}}var Ql=null;function yg(){if(Ql===null)throw Error(i(459));var a=Ql;return Ql=null,a}var Ri=null,Xl=0;function kc(a){var r=Xl;return Xl+=1,Ri===null&&(Ri=[]),gg(Ri,a,r)}function Zl(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function _c(a,r){throw r.$$typeof===c?Error(i(525)):(a=Object.prototype.toString.call(r),Error(i(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function vg(a){var r=a._init;return r(a._payload)}function xg(a){function r(de,re){if(a){var he=de.deletions;he===null?(de.deletions=[re],de.flags|=16):he.push(re)}}function o(de,re){if(!a)return null;for(;re!==null;)r(de,re),re=re.sibling;return null}function d(de){for(var re=new Map;de!==null;)de.key!==null?re.set(de.key,de):re.set(de.index,de),de=de.sibling;return re}function h(de,re){return de=Zn(de,re),de.index=0,de.sibling=null,de}function g(de,re,he){return de.index=he,a?(he=de.alternate,he!==null?(he=he.index,he<re?(de.flags|=33554434,re):he):(de.flags|=33554434,re)):(de.flags|=1048576,re)}function $(de){return a&&de.alternate===null&&(de.flags|=33554434),de}function F(de,re,he,Ee){return re===null||re.tag!==6?(re=Zh(he,de.mode,Ee),re.return=de,re):(re=h(re,he),re.return=de,re)}function ee(de,re,he,Ee){var Re=he.type;return Re===p?we(de,re,he.props.children,Ee,he.key):re!==null&&(re.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===C&&vg(Re)===re.type)?(re=h(re,he.props),Zl(re,he),re.return=de,re):(re=Xc(he.type,he.key,he.props,null,de.mode,Ee),Zl(re,he),re.return=de,re)}function ie(de,re,he,Ee){return re===null||re.tag!==4||re.stateNode.containerInfo!==he.containerInfo||re.stateNode.implementation!==he.implementation?(re=Wh(he,de.mode,Ee),re.return=de,re):(re=h(re,he.children||[]),re.return=de,re)}function we(de,re,he,Ee,Re){return re===null||re.tag!==7?(re=qr(he,de.mode,Ee,Re),re.return=de,re):(re=h(re,he),re.return=de,re)}function Ae(de,re,he){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return re=Zh(""+re,de.mode,he),re.return=de,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case u:return he=Xc(re.type,re.key,re.props,null,de.mode,he),Zl(he,re),he.return=de,he;case f:return re=Wh(re,de.mode,he),re.return=de,re;case C:var Ee=re._init;return re=Ee(re._payload),Ae(de,re,he)}if(Z(re)||R(re))return re=qr(re,de.mode,he,null),re.return=de,re;if(typeof re.then=="function")return Ae(de,kc(re),he);if(re.$$typeof===N)return Ae(de,Vc(de,re),he);_c(de,re)}return null}function fe(de,re,he,Ee){var Re=re!==null?re.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Re!==null?null:F(de,re,""+he,Ee);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case u:return he.key===Re?ee(de,re,he,Ee):null;case f:return he.key===Re?ie(de,re,he,Ee):null;case C:return Re=he._init,he=Re(he._payload),fe(de,re,he,Ee)}if(Z(he)||R(he))return Re!==null?null:we(de,re,he,Ee,null);if(typeof he.then=="function")return fe(de,re,kc(he),Ee);if(he.$$typeof===N)return fe(de,re,Vc(de,he),Ee);_c(de,he)}return null}function Se(de,re,he,Ee,Re){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return de=de.get(he)||null,F(re,de,""+Ee,Re);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case u:return de=de.get(Ee.key===null?he:Ee.key)||null,ee(re,de,Ee,Re);case f:return de=de.get(Ee.key===null?he:Ee.key)||null,ie(re,de,Ee,Re);case C:var We=Ee._init;return Ee=We(Ee._payload),Se(de,re,he,Ee,Re)}if(Z(Ee)||R(Ee))return de=de.get(he)||null,we(re,de,Ee,Re,null);if(typeof Ee.then=="function")return Se(de,re,he,kc(Ee),Re);if(Ee.$$typeof===N)return Se(de,re,he,Vc(re,Ee),Re);_c(re,Ee)}return null}function Fe(de,re,he,Ee){for(var Re=null,We=null,Pe=re,He=re=0,rs=null;Pe!==null&&He<he.length;He++){Pe.index>He?(rs=Pe,Pe=null):rs=Pe.sibling;var it=fe(de,Pe,he[He],Ee);if(it===null){Pe===null&&(Pe=rs);break}a&&Pe&&it.alternate===null&&r(de,Pe),re=g(it,re,He),We===null?Re=it:We.sibling=it,We=it,Pe=rs}if(He===he.length)return o(de,Pe),rt&&Or(de,He),Re;if(Pe===null){for(;He<he.length;He++)Pe=Ae(de,he[He],Ee),Pe!==null&&(re=g(Pe,re,He),We===null?Re=Pe:We.sibling=Pe,We=Pe);return rt&&Or(de,He),Re}for(Pe=d(Pe);He<he.length;He++)rs=Se(Pe,de,He,he[He],Ee),rs!==null&&(a&&rs.alternate!==null&&Pe.delete(rs.key===null?He:rs.key),re=g(rs,re,He),We===null?Re=rs:We.sibling=rs,We=rs);return a&&Pe.forEach(function(ar){return r(de,ar)}),rt&&Or(de,He),Re}function Ge(de,re,he,Ee){if(he==null)throw Error(i(151));for(var Re=null,We=null,Pe=re,He=re=0,rs=null,it=he.next();Pe!==null&&!it.done;He++,it=he.next()){Pe.index>He?(rs=Pe,Pe=null):rs=Pe.sibling;var ar=fe(de,Pe,it.value,Ee);if(ar===null){Pe===null&&(Pe=rs);break}a&&Pe&&ar.alternate===null&&r(de,Pe),re=g(ar,re,He),We===null?Re=ar:We.sibling=ar,We=ar,Pe=rs}if(it.done)return o(de,Pe),rt&&Or(de,He),Re;if(Pe===null){for(;!it.done;He++,it=he.next())it=Ae(de,it.value,Ee),it!==null&&(re=g(it,re,He),We===null?Re=it:We.sibling=it,We=it);return rt&&Or(de,He),Re}for(Pe=d(Pe);!it.done;He++,it=he.next())it=Se(Pe,de,He,it.value,Ee),it!==null&&(a&&it.alternate!==null&&Pe.delete(it.key===null?He:it.key),re=g(it,re,He),We===null?Re=it:We.sibling=it,We=it);return a&&Pe.forEach(function(j1){return r(de,j1)}),rt&&Or(de,He),Re}function zt(de,re,he,Ee){if(typeof he=="object"&&he!==null&&he.type===p&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case u:e:{for(var Re=he.key;re!==null;){if(re.key===Re){if(Re=he.type,Re===p){if(re.tag===7){o(de,re.sibling),Ee=h(re,he.props.children),Ee.return=de,de=Ee;break e}}else if(re.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===C&&vg(Re)===re.type){o(de,re.sibling),Ee=h(re,he.props),Zl(Ee,he),Ee.return=de,de=Ee;break e}o(de,re);break}else r(de,re);re=re.sibling}he.type===p?(Ee=qr(he.props.children,de.mode,Ee,he.key),Ee.return=de,de=Ee):(Ee=Xc(he.type,he.key,he.props,null,de.mode,Ee),Zl(Ee,he),Ee.return=de,de=Ee)}return $(de);case f:e:{for(Re=he.key;re!==null;){if(re.key===Re)if(re.tag===4&&re.stateNode.containerInfo===he.containerInfo&&re.stateNode.implementation===he.implementation){o(de,re.sibling),Ee=h(re,he.children||[]),Ee.return=de,de=Ee;break e}else{o(de,re);break}else r(de,re);re=re.sibling}Ee=Wh(he,de.mode,Ee),Ee.return=de,de=Ee}return $(de);case C:return Re=he._init,he=Re(he._payload),zt(de,re,he,Ee)}if(Z(he))return Fe(de,re,he,Ee);if(R(he)){if(Re=R(he),typeof Re!="function")throw Error(i(150));return he=Re.call(he),Ge(de,re,he,Ee)}if(typeof he.then=="function")return zt(de,re,kc(he),Ee);if(he.$$typeof===N)return zt(de,re,Vc(de,he),Ee);_c(de,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,re!==null&&re.tag===6?(o(de,re.sibling),Ee=h(re,he),Ee.return=de,de=Ee):(o(de,re),Ee=Zh(he,de.mode,Ee),Ee.return=de,de=Ee),$(de)):o(de,re)}return function(de,re,he,Ee){try{Xl=0;var Re=zt(de,re,he,Ee);return Ri=null,Re}catch(Pe){if(Pe===Gl)throw Pe;var We=fa(29,Pe,null,de.mode);return We.lanes=Ee,We.return=de,We}finally{}}}var $r=xg(!0),jg=xg(!1),Mi=se(null),Oc=se(0);function bg(a,r){a=yn,oe(Oc,a),oe(Mi,r),yn=a|r.baseLanes}function ah(){oe(Oc,yn),oe(Mi,Mi.current)}function nh(){yn=Oc.current,ae(Mi),ae(Oc)}var da=se(null),Ha=null;function Bn(a){var r=a.alternate;oe(Wt,Wt.current&1),oe(da,a),Ha===null&&(r===null||Mi.current!==null||r.memoizedState!==null)&&(Ha=a)}function Ng(a){if(a.tag===22){if(oe(Wt,Wt.current),oe(da,a),Ha===null){var r=a.alternate;r!==null&&r.memoizedState!==null&&(Ha=a)}}else Fn()}function Fn(){oe(Wt,Wt.current),oe(da,da.current)}function ln(a){ae(da),Ha===a&&(Ha=null),ae(Wt)}var Wt=se(0);function Ic(a){for(var r=a;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var lS=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(o,d){a.push(d)}};this.abort=function(){r.aborted=!0,a.forEach(function(o){return o()})}},oS=t.unstable_scheduleCallback,cS=t.unstable_NormalPriority,Kt={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rh(){return{controller:new lS,data:new Map,refCount:0}}function Wl(a){a.refCount--,a.refCount===0&&oS(cS,function(){a.controller.abort()})}var Kl=null,ih=0,zi=0,Li=null;function dS(a,r){if(Kl===null){var o=Kl=[];ih=0,zi=ff(),Li={status:"pending",value:void 0,then:function(d){o.push(d)}}}return ih++,r.then(Sg,Sg),r}function Sg(){if(--ih===0&&Kl!==null){Li!==null&&(Li.status="fulfilled");var a=Kl;Kl=null,zi=0,Li=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function uS(a,r){var o=[],d={status:"pending",value:null,reason:null,then:function(h){o.push(h)}};return a.then(function(){d.status="fulfilled",d.value=r;for(var h=0;h<o.length;h++)(0,o[h])(r)},function(h){for(d.status="rejected",d.reason=h,h=0;h<o.length;h++)(0,o[h])(void 0)}),d}var wg=k.S;k.S=function(a,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&dS(a,r),wg!==null&&wg(a,r)};var Rr=se(null);function lh(){var a=Rr.current;return a!==null?a:vt.pooledCache}function $c(a,r){r===null?oe(Rr,Rr.current):oe(Rr,r.pool)}function Tg(){var a=lh();return a===null?null:{parent:Kt._currentValue,pool:a}}var Un=0,Ze=null,ht=null,Gt=null,Rc=!1,Bi=!1,Mr=!1,Mc=0,Jl=0,Fi=null,hS=0;function qt(){throw Error(i(321))}function oh(a,r){if(r===null)return!1;for(var o=0;o<r.length&&o<a.length;o++)if(!Ps(a[o],r[o]))return!1;return!0}function ch(a,r,o,d,h,g){return Un=g,Ze=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,k.H=a===null||a.memoizedState===null?zr:Pn,Mr=!1,g=o(d,h),Mr=!1,Bi&&(g=Ag(r,o,d,h)),Eg(a),g}function Eg(a){k.H=Ya;var r=ht!==null&&ht.next!==null;if(Un=0,Gt=ht=Ze=null,Rc=!1,Jl=0,Fi=null,r)throw Error(i(300));a===null||as||(a=a.dependencies,a!==null&&Yc(a)&&(as=!0))}function Ag(a,r,o,d){Ze=a;var h=0;do{if(Bi&&(Fi=null),Jl=0,Bi=!1,25<=h)throw Error(i(301));if(h+=1,Gt=ht=null,a.updateQueue!=null){var g=a.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}k.H=Lr,g=r(o,d)}while(Bi);return g}function fS(){var a=k.H,r=a.useState()[0];return r=typeof r.then=="function"?eo(r):r,a=a.useState()[0],(ht!==null?ht.memoizedState:null)!==a&&(Ze.flags|=1024),r}function dh(){var a=Mc!==0;return Mc=0,a}function uh(a,r,o){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~o}function hh(a){if(Rc){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}Rc=!1}Un=0,Gt=ht=Ze=null,Bi=!1,Jl=Mc=0,Fi=null}function Os(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?Ze.memoizedState=Gt=a:Gt=Gt.next=a,Gt}function Qt(){if(ht===null){var a=Ze.alternate;a=a!==null?a.memoizedState:null}else a=ht.next;var r=Gt===null?Ze.memoizedState:Gt.next;if(r!==null)Gt=r,ht=a;else{if(a===null)throw Ze.alternate===null?Error(i(467)):Error(i(310));ht=a,a={memoizedState:ht.memoizedState,baseState:ht.baseState,baseQueue:ht.baseQueue,queue:ht.queue,next:null},Gt===null?Ze.memoizedState=Gt=a:Gt=Gt.next=a}return Gt}var zc;zc=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function eo(a){var r=Jl;return Jl+=1,Fi===null&&(Fi=[]),a=gg(Fi,a,r),r=Ze,(Gt===null?r.memoizedState:Gt.next)===null&&(r=r.alternate,k.H=r===null||r.memoizedState===null?zr:Pn),a}function Lc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return eo(a);if(a.$$typeof===N)return xs(a)}throw Error(i(438,String(a)))}function fh(a){var r=null,o=Ze.updateQueue;if(o!==null&&(r=o.memoCache),r==null){var d=Ze.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(r={data:d.data.map(function(h){return h.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),o===null&&(o=zc(),Ze.updateQueue=o),o.memoCache=r,o=r.data[r.index],o===void 0)for(o=r.data[r.index]=Array(a),d=0;d<a;d++)o[d]=I;return r.index++,o}function on(a,r){return typeof r=="function"?r(a):r}function Bc(a){var r=Qt();return mh(r,ht,a)}function mh(a,r,o){var d=a.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var h=a.baseQueue,g=d.pending;if(g!==null){if(h!==null){var $=h.next;h.next=g.next,g.next=$}r.baseQueue=h=g,d.pending=null}if(g=a.baseState,h===null)a.memoizedState=g;else{r=h.next;var F=$=null,ee=null,ie=r,we=!1;do{var Ae=ie.lane&-536870913;if(Ae!==ie.lane?(nt&Ae)===Ae:(Un&Ae)===Ae){var fe=ie.revertLane;if(fe===0)ee!==null&&(ee=ee.next={lane:0,revertLane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),Ae===zi&&(we=!0);else if((Un&fe)===fe){ie=ie.next,fe===zi&&(we=!0);continue}else Ae={lane:0,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},ee===null?(F=ee=Ae,$=g):ee=ee.next=Ae,Ze.lanes|=fe,Wn|=fe;Ae=ie.action,Mr&&o(g,Ae),g=ie.hasEagerState?ie.eagerState:o(g,Ae)}else fe={lane:Ae,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},ee===null?(F=ee=fe,$=g):ee=ee.next=fe,Ze.lanes|=Ae,Wn|=Ae;ie=ie.next}while(ie!==null&&ie!==r);if(ee===null?$=g:ee.next=F,!Ps(g,a.memoizedState)&&(as=!0,we&&(o=Li,o!==null)))throw o;a.memoizedState=g,a.baseState=$,a.baseQueue=ee,d.lastRenderedState=g}return h===null&&(d.lanes=0),[a.memoizedState,d.dispatch]}function ph(a){var r=Qt(),o=r.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=a;var d=o.dispatch,h=o.pending,g=r.memoizedState;if(h!==null){o.pending=null;var $=h=h.next;do g=a(g,$.action),$=$.next;while($!==h);Ps(g,r.memoizedState)||(as=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),o.lastRenderedState=g}return[g,d]}function Cg(a,r,o){var d=Ze,h=Qt(),g=rt;if(g){if(o===void 0)throw Error(i(407));o=o()}else o=r();var $=!Ps((ht||h).memoizedState,o);if($&&(h.memoizedState=o,as=!0),h=h.queue,vh(_g.bind(null,d,h,a),[a]),h.getSnapshot!==r||$||Gt!==null&&Gt.memoizedState.tag&1){if(d.flags|=2048,Ui(9,kg.bind(null,d,h,o,r),{destroy:void 0},null),vt===null)throw Error(i(349));g||(Un&60)!==0||Dg(d,r,o)}return o}function Dg(a,r,o){a.flags|=16384,a={getSnapshot:r,value:o},r=Ze.updateQueue,r===null?(r=zc(),Ze.updateQueue=r,r.stores=[a]):(o=r.stores,o===null?r.stores=[a]:o.push(a))}function kg(a,r,o,d){r.value=o,r.getSnapshot=d,Og(r)&&Ig(a)}function _g(a,r,o){return o(function(){Og(r)&&Ig(a)})}function Og(a){var r=a.getSnapshot;a=a.value;try{var o=r();return!Ps(a,o)}catch{return!0}}function Ig(a){var r=Ln(a,2);r!==null&&Ts(r,a,2)}function gh(a){var r=Os();if(typeof a=="function"){var o=a;if(a=o(),Mr){Sa(!0);try{o()}finally{Sa(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:on,lastRenderedState:a},r}function $g(a,r,o,d){return a.baseState=o,mh(a,ht,typeof d=="function"?d:on)}function mS(a,r,o,d,h){if(Pc(a))throw Error(i(485));if(a=r.action,a!==null){var g={payload:h,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){g.listeners.push($)}};k.T!==null?o(!0):g.isTransition=!1,d(g),o=r.pending,o===null?(g.next=r.pending=g,Rg(r,g)):(g.next=o.next,r.pending=o.next=g)}}function Rg(a,r){var o=r.action,d=r.payload,h=a.state;if(r.isTransition){var g=k.T,$={};k.T=$;try{var F=o(h,d),ee=k.S;ee!==null&&ee($,F),Mg(a,r,F)}catch(ie){yh(a,r,ie)}finally{k.T=g}}else try{g=o(h,d),Mg(a,r,g)}catch(ie){yh(a,r,ie)}}function Mg(a,r,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){zg(a,r,d)},function(d){return yh(a,r,d)}):zg(a,r,o)}function zg(a,r,o){r.status="fulfilled",r.value=o,Lg(r),a.state=o,r=a.pending,r!==null&&(o=r.next,o===r?a.pending=null:(o=o.next,r.next=o,Rg(a,o)))}function yh(a,r,o){var d=a.pending;if(a.pending=null,d!==null){d=d.next;do r.status="rejected",r.reason=o,Lg(r),r=r.next;while(r!==d)}a.action=null}function Lg(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function Bg(a,r){return r}function Fg(a,r){if(rt){var o=vt.formState;if(o!==null){e:{var d=Ze;if(rt){if(os){t:{for(var h=os,g=qa;h.nodeType!==8;){if(!g){h=null;break t}if(h=Aa(h.nextSibling),h===null){h=null;break t}}g=h.data,h=g==="F!"||g==="F"?h:null}if(h){os=Aa(h.nextSibling),d=h.data==="F!";break e}}Ir(d)}d=!1}d&&(r=o[0])}}return o=Os(),o.memoizedState=o.baseState=r,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bg,lastRenderedState:r},o.queue=d,o=ny.bind(null,Ze,d),d.dispatch=o,d=gh(!1),g=Sh.bind(null,Ze,!1,d.queue),d=Os(),h={state:r,dispatch:null,action:a,pending:null},d.queue=h,o=mS.bind(null,Ze,h,g,o),h.dispatch=o,d.memoizedState=a,[r,o,!1]}function Ug(a){var r=Qt();return Pg(r,ht,a)}function Pg(a,r,o){r=mh(a,r,Bg)[0],a=Bc(on)[0],r=typeof r=="object"&&r!==null&&typeof r.then=="function"?eo(r):r;var d=Qt(),h=d.queue,g=h.dispatch;return o!==d.memoizedState&&(Ze.flags|=2048,Ui(9,pS.bind(null,h,o),{destroy:void 0},null)),[r,g,a]}function pS(a,r){a.action=r}function qg(a){var r=Qt(),o=ht;if(o!==null)return Pg(r,o,a);Qt(),r=r.memoizedState,o=Qt();var d=o.queue.dispatch;return o.memoizedState=a,[r,d,!1]}function Ui(a,r,o,d){return a={tag:a,create:r,inst:o,deps:d,next:null},r=Ze.updateQueue,r===null&&(r=zc(),Ze.updateQueue=r),o=r.lastEffect,o===null?r.lastEffect=a.next=a:(d=o.next,o.next=a,a.next=d,r.lastEffect=a),a}function Hg(){return Qt().memoizedState}function Fc(a,r,o,d){var h=Os();Ze.flags|=a,h.memoizedState=Ui(1|r,o,{destroy:void 0},d===void 0?null:d)}function Uc(a,r,o,d){var h=Qt();d=d===void 0?null:d;var g=h.memoizedState.inst;ht!==null&&d!==null&&oh(d,ht.memoizedState.deps)?h.memoizedState=Ui(r,o,g,d):(Ze.flags|=a,h.memoizedState=Ui(1|r,o,g,d))}function Yg(a,r){Fc(8390656,8,a,r)}function vh(a,r){Uc(2048,8,a,r)}function Vg(a,r){return Uc(4,2,a,r)}function Gg(a,r){return Uc(4,4,a,r)}function Qg(a,r){if(typeof r=="function"){a=a();var o=r(a);return function(){typeof o=="function"?o():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function Xg(a,r,o){o=o!=null?o.concat([a]):null,Uc(4,4,Qg.bind(null,r,a),o)}function xh(){}function Zg(a,r){var o=Qt();r=r===void 0?null:r;var d=o.memoizedState;return r!==null&&oh(r,d[1])?d[0]:(o.memoizedState=[a,r],a)}function Wg(a,r){var o=Qt();r=r===void 0?null:r;var d=o.memoizedState;if(r!==null&&oh(r,d[1]))return d[0];if(d=a(),Mr){Sa(!0);try{a()}finally{Sa(!1)}}return o.memoizedState=[d,r],d}function jh(a,r,o){return o===void 0||(Un&1073741824)!==0?a.memoizedState=r:(a.memoizedState=o,a=Jy(),Ze.lanes|=a,Wn|=a,o)}function Kg(a,r,o,d){return Ps(o,r)?o:Mi.current!==null?(a=jh(a,o,d),Ps(a,r)||(as=!0),a):(Un&42)===0?(as=!0,a.memoizedState=o):(a=Jy(),Ze.lanes|=a,Wn|=a,r)}function Jg(a,r,o,d,h){var g=H.p;H.p=g!==0&&8>g?g:8;var $=k.T,F={};k.T=F,Sh(a,!1,r,o);try{var ee=h(),ie=k.S;if(ie!==null&&ie(F,ee),ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var we=uS(ee,d);to(a,r,we,Vs(a))}else to(a,r,d,Vs(a))}catch(Ae){to(a,r,{then:function(){},status:"rejected",reason:Ae},Vs())}finally{H.p=g,k.T=$}}function gS(){}function bh(a,r,o,d){if(a.tag!==5)throw Error(i(476));var h=ey(a).queue;Jg(a,h,r,P,o===null?gS:function(){return ty(a),o(d)})}function ey(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:on,lastRenderedState:P},next:null};var o={};return r.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:on,lastRenderedState:o},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function ty(a){var r=ey(a).next.queue;to(a,r,{},Vs())}function Nh(){return xs(No)}function sy(){return Qt().memoizedState}function ay(){return Qt().memoizedState}function yS(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var o=Vs();a=Yn(o);var d=Vn(r,a,o);d!==null&&(Ts(d,r,o),no(d,r,o)),r={cache:rh()},a.payload=r;return}r=r.return}}function vS(a,r,o){var d=Vs();o={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},Pc(a)?ry(r,o):(o=Ku(a,r,o,d),o!==null&&(Ts(o,a,d),iy(o,r,d)))}function ny(a,r,o){var d=Vs();to(a,r,o,d)}function to(a,r,o,d){var h={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(Pc(a))ry(r,h);else{var g=a.alternate;if(a.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var $=r.lastRenderedState,F=g($,o);if(h.hasEagerState=!0,h.eagerState=F,Ps(F,$))return Tc(a,r,h,0),vt===null&&wc(),!1}catch{}finally{}if(o=Ku(a,r,h,d),o!==null)return Ts(o,a,d),iy(o,r,d),!0}return!1}function Sh(a,r,o,d){if(d={lane:2,revertLane:ff(),action:d,hasEagerState:!1,eagerState:null,next:null},Pc(a)){if(r)throw Error(i(479))}else r=Ku(a,o,d,2),r!==null&&Ts(r,a,2)}function Pc(a){var r=a.alternate;return a===Ze||r!==null&&r===Ze}function ry(a,r){Bi=Rc=!0;var o=a.pending;o===null?r.next=r:(r.next=o.next,o.next=r),a.pending=r}function iy(a,r,o){if((o&4194176)!==0){var d=r.lanes;d&=a.pendingLanes,o|=d,r.lanes=o,yp(a,o)}}var Ya={readContext:xs,use:Lc,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useLayoutEffect:qt,useInsertionEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useSyncExternalStore:qt,useId:qt};Ya.useCacheRefresh=qt,Ya.useMemoCache=qt,Ya.useHostTransitionStatus=qt,Ya.useFormState=qt,Ya.useActionState=qt,Ya.useOptimistic=qt;var zr={readContext:xs,use:Lc,useCallback:function(a,r){return Os().memoizedState=[a,r===void 0?null:r],a},useContext:xs,useEffect:Yg,useImperativeHandle:function(a,r,o){o=o!=null?o.concat([a]):null,Fc(4194308,4,Qg.bind(null,r,a),o)},useLayoutEffect:function(a,r){return Fc(4194308,4,a,r)},useInsertionEffect:function(a,r){Fc(4,2,a,r)},useMemo:function(a,r){var o=Os();r=r===void 0?null:r;var d=a();if(Mr){Sa(!0);try{a()}finally{Sa(!1)}}return o.memoizedState=[d,r],d},useReducer:function(a,r,o){var d=Os();if(o!==void 0){var h=o(r);if(Mr){Sa(!0);try{o(r)}finally{Sa(!1)}}}else h=r;return d.memoizedState=d.baseState=h,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:h},d.queue=a,a=a.dispatch=vS.bind(null,Ze,a),[d.memoizedState,a]},useRef:function(a){var r=Os();return a={current:a},r.memoizedState=a},useState:function(a){a=gh(a);var r=a.queue,o=ny.bind(null,Ze,r);return r.dispatch=o,[a.memoizedState,o]},useDebugValue:xh,useDeferredValue:function(a,r){var o=Os();return jh(o,a,r)},useTransition:function(){var a=gh(!1);return a=Jg.bind(null,Ze,a.queue,!0,!1),Os().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,o){var d=Ze,h=Os();if(rt){if(o===void 0)throw Error(i(407));o=o()}else{if(o=r(),vt===null)throw Error(i(349));(nt&60)!==0||Dg(d,r,o)}h.memoizedState=o;var g={value:o,getSnapshot:r};return h.queue=g,Yg(_g.bind(null,d,g,a),[a]),d.flags|=2048,Ui(9,kg.bind(null,d,g,o,r),{destroy:void 0},null),o},useId:function(){var a=Os(),r=vt.identifierPrefix;if(rt){var o=rn,d=nn;o=(d&~(1<<32-ke(d)-1)).toString(32)+o,r=":"+r+"R"+o,o=Mc++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=hS++,r=":"+r+"r"+o.toString(32)+":";return a.memoizedState=r},useCacheRefresh:function(){return Os().memoizedState=yS.bind(null,Ze)}};zr.useMemoCache=fh,zr.useHostTransitionStatus=Nh,zr.useFormState=Fg,zr.useActionState=Fg,zr.useOptimistic=function(a){var r=Os();r.memoizedState=r.baseState=a;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=o,r=Sh.bind(null,Ze,!0,o),o.dispatch=r,[a,r]};var Pn={readContext:xs,use:Lc,useCallback:Zg,useContext:xs,useEffect:vh,useImperativeHandle:Xg,useInsertionEffect:Vg,useLayoutEffect:Gg,useMemo:Wg,useReducer:Bc,useRef:Hg,useState:function(){return Bc(on)},useDebugValue:xh,useDeferredValue:function(a,r){var o=Qt();return Kg(o,ht.memoizedState,a,r)},useTransition:function(){var a=Bc(on)[0],r=Qt().memoizedState;return[typeof a=="boolean"?a:eo(a),r]},useSyncExternalStore:Cg,useId:sy};Pn.useCacheRefresh=ay,Pn.useMemoCache=fh,Pn.useHostTransitionStatus=Nh,Pn.useFormState=Ug,Pn.useActionState=Ug,Pn.useOptimistic=function(a,r){var o=Qt();return $g(o,ht,a,r)};var Lr={readContext:xs,use:Lc,useCallback:Zg,useContext:xs,useEffect:vh,useImperativeHandle:Xg,useInsertionEffect:Vg,useLayoutEffect:Gg,useMemo:Wg,useReducer:ph,useRef:Hg,useState:function(){return ph(on)},useDebugValue:xh,useDeferredValue:function(a,r){var o=Qt();return ht===null?jh(o,a,r):Kg(o,ht.memoizedState,a,r)},useTransition:function(){var a=ph(on)[0],r=Qt().memoizedState;return[typeof a=="boolean"?a:eo(a),r]},useSyncExternalStore:Cg,useId:sy};Lr.useCacheRefresh=ay,Lr.useMemoCache=fh,Lr.useHostTransitionStatus=Nh,Lr.useFormState=qg,Lr.useActionState=qg,Lr.useOptimistic=function(a,r){var o=Qt();return ht!==null?$g(o,ht,a,r):(o.baseState=a,[a,o.queue.dispatch])};function wh(a,r,o,d){r=a.memoizedState,o=o(d,r),o=o==null?r:z({},r,o),a.memoizedState=o,a.lanes===0&&(a.updateQueue.baseState=o)}var Th={isMounted:function(a){return(a=a._reactInternals)?K(a)===a:!1},enqueueSetState:function(a,r,o){a=a._reactInternals;var d=Vs(),h=Yn(d);h.payload=r,o!=null&&(h.callback=o),r=Vn(a,h,d),r!==null&&(Ts(r,a,d),no(r,a,d))},enqueueReplaceState:function(a,r,o){a=a._reactInternals;var d=Vs(),h=Yn(d);h.tag=1,h.payload=r,o!=null&&(h.callback=o),r=Vn(a,h,d),r!==null&&(Ts(r,a,d),no(r,a,d))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var o=Vs(),d=Yn(o);d.tag=2,r!=null&&(d.callback=r),r=Vn(a,d,o),r!==null&&(Ts(r,a,o),no(r,a,o))}};function ly(a,r,o,d,h,g,$){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(d,g,$):r.prototype&&r.prototype.isPureReactComponent?!Pl(o,d)||!Pl(h,g):!0}function oy(a,r,o,d){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,d),r.state!==a&&Th.enqueueReplaceState(r,r.state,null)}function Br(a,r){var o=r;if("ref"in r){o={};for(var d in r)d!=="ref"&&(o[d]=r[d])}if(a=a.defaultProps){o===r&&(o=z({},o));for(var h in a)o[h]===void 0&&(o[h]=a[h])}return o}var qc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function cy(a){qc(a)}function dy(a){console.error(a)}function uy(a){qc(a)}function Hc(a,r){try{var o=a.onUncaughtError;o(r.value,{componentStack:r.stack})}catch(d){setTimeout(function(){throw d})}}function hy(a,r,o){try{var d=a.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function Eh(a,r,o){return o=Yn(o),o.tag=3,o.payload={element:null},o.callback=function(){Hc(a,r)},o}function fy(a){return a=Yn(a),a.tag=3,a}function my(a,r,o,d){var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var g=d.value;a.payload=function(){return h(g)},a.callback=function(){hy(r,o,d)}}var $=o.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(a.callback=function(){hy(r,o,d),typeof h!="function"&&(Kn===null?Kn=new Set([this]):Kn.add(this));var F=d.stack;this.componentDidCatch(d.value,{componentStack:F!==null?F:""})})}function xS(a,r,o,d,h){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(r=o.alternate,r!==null&&ao(r,o,h,!0),o=da.current,o!==null){switch(o.tag){case 13:return Ha===null?of():o.alternate===null&&Mt===0&&(Mt=3),o.flags&=-257,o.flags|=65536,o.lanes=h,d===sh?o.flags|=16384:(r=o.updateQueue,r===null?o.updateQueue=new Set([d]):r.add(d),df(a,d,h)),!1;case 22:return o.flags|=65536,d===sh?o.flags|=16384:(r=o.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=r):(o=r.retryQueue,o===null?r.retryQueue=new Set([d]):o.add(d)),df(a,d,h)),!1}throw Error(i(435,o.tag))}return df(a,d,h),of(),!1}if(rt)return r=da.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=h,d!==th&&(a=Error(i(422),{cause:d}),Vl(la(a,o)))):(d!==th&&(r=Error(i(423),{cause:d}),Vl(la(r,o))),a=a.current.alternate,a.flags|=65536,h&=-h,a.lanes|=h,d=la(d,o),h=Eh(a.stateNode,d,h),Uh(a,h),Mt!==4&&(Mt=2)),!1;var g=Error(i(520),{cause:d});if(g=la(g,o),fo===null?fo=[g]:fo.push(g),Mt!==4&&(Mt=2),r===null)return!0;d=la(d,o),o=r;do{switch(o.tag){case 3:return o.flags|=65536,a=h&-h,o.lanes|=a,a=Eh(o.stateNode,d,a),Uh(o,a),!1;case 1:if(r=o.type,g=o.stateNode,(o.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Kn===null||!Kn.has(g))))return o.flags|=65536,h&=-h,o.lanes|=h,h=fy(h),my(h,a,o,d),Uh(o,h),!1}o=o.return}while(o!==null);return!1}var py=Error(i(461)),as=!1;function cs(a,r,o,d){r.child=a===null?jg(r,null,o,d):$r(r,a.child,o,d)}function gy(a,r,o,d,h){o=o.render;var g=r.ref;if("ref"in d){var $={};for(var F in d)F!=="ref"&&($[F]=d[F])}else $=d;return Ur(r),d=ch(a,r,o,$,g,h),F=dh(),a!==null&&!as?(uh(a,r,h),cn(a,r,h)):(rt&&F&&Ju(r),r.flags|=1,cs(a,r,d,h),r.child)}function yy(a,r,o,d,h){if(a===null){var g=o.type;return typeof g=="function"&&!Xh(g)&&g.defaultProps===void 0&&o.compare===null?(r.tag=15,r.type=g,vy(a,r,g,d,h)):(a=Xc(o.type,null,d,r,r.mode,h),a.ref=r.ref,a.return=r,r.child=a)}if(g=a.child,!Rh(a,h)){var $=g.memoizedProps;if(o=o.compare,o=o!==null?o:Pl,o($,d)&&a.ref===r.ref)return cn(a,r,h)}return r.flags|=1,a=Zn(g,d),a.ref=r.ref,a.return=r,r.child=a}function vy(a,r,o,d,h){if(a!==null){var g=a.memoizedProps;if(Pl(g,d)&&a.ref===r.ref)if(as=!1,r.pendingProps=d=g,Rh(a,h))(a.flags&131072)!==0&&(as=!0);else return r.lanes=a.lanes,cn(a,r,h)}return Ah(a,r,o,d,h)}function xy(a,r,o){var d=r.pendingProps,h=d.children,g=(r.stateNode._pendingVisibility&2)!==0,$=a!==null?a.memoizedState:null;if(so(a,r),d.mode==="hidden"||g){if((r.flags&128)!==0){if(d=$!==null?$.baseLanes|o:o,a!==null){for(h=r.child=a.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;r.childLanes=g&~d}else r.childLanes=0,r.child=null;return jy(a,r,d,o)}if((o&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&$c(r,$!==null?$.cachePool:null),$!==null?bg(r,$):ah(),Ng(r);else return r.lanes=r.childLanes=536870912,jy(a,r,$!==null?$.baseLanes|o:o,o)}else $!==null?($c(r,$.cachePool),bg(r,$),Fn(),r.memoizedState=null):(a!==null&&$c(r,null),ah(),Fn());return cs(a,r,h,o),r.child}function jy(a,r,o,d){var h=lh();return h=h===null?null:{parent:Kt._currentValue,pool:h},r.memoizedState={baseLanes:o,cachePool:h},a!==null&&$c(r,null),ah(),Ng(r),a!==null&&ao(a,r,d,!0),null}function so(a,r){var o=r.ref;if(o===null)a!==null&&a.ref!==null&&(r.flags|=2097664);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(a===null||a.ref!==o)&&(r.flags|=2097664)}}function Ah(a,r,o,d,h){return Ur(r),o=ch(a,r,o,d,void 0,h),d=dh(),a!==null&&!as?(uh(a,r,h),cn(a,r,h)):(rt&&d&&Ju(r),r.flags|=1,cs(a,r,o,h),r.child)}function by(a,r,o,d,h,g){return Ur(r),r.updateQueue=null,o=Ag(r,d,o,h),Eg(a),d=dh(),a!==null&&!as?(uh(a,r,g),cn(a,r,g)):(rt&&d&&Ju(r),r.flags|=1,cs(a,r,o,g),r.child)}function Ny(a,r,o,d,h){if(Ur(r),r.stateNode===null){var g=Oi,$=o.contextType;typeof $=="object"&&$!==null&&(g=xs($)),g=new o(d,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Th,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=d,g.state=r.memoizedState,g.refs={},Bh(r),$=o.contextType,g.context=typeof $=="object"&&$!==null?xs($):Oi,g.state=r.memoizedState,$=o.getDerivedStateFromProps,typeof $=="function"&&(wh(r,o,$,d),g.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||($=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),$!==g.state&&Th.enqueueReplaceState(g,g.state,null),io(r,d,g,h),ro(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),d=!0}else if(a===null){g=r.stateNode;var F=r.memoizedProps,ee=Br(o,F);g.props=ee;var ie=g.context,we=o.contextType;$=Oi,typeof we=="object"&&we!==null&&($=xs(we));var Ae=o.getDerivedStateFromProps;we=typeof Ae=="function"||typeof g.getSnapshotBeforeUpdate=="function",F=r.pendingProps!==F,we||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(F||ie!==$)&&oy(r,g,d,$),Hn=!1;var fe=r.memoizedState;g.state=fe,io(r,d,g,h),ro(),ie=r.memoizedState,F||fe!==ie||Hn?(typeof Ae=="function"&&(wh(r,o,Ae,d),ie=r.memoizedState),(ee=Hn||ly(r,o,ee,d,fe,ie,$))?(we||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=ie),g.props=d,g.state=ie,g.context=$,d=ee):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{g=r.stateNode,Fh(a,r),$=r.memoizedProps,we=Br(o,$),g.props=we,Ae=r.pendingProps,fe=g.context,ie=o.contextType,ee=Oi,typeof ie=="object"&&ie!==null&&(ee=xs(ie)),F=o.getDerivedStateFromProps,(ie=typeof F=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||($!==Ae||fe!==ee)&&oy(r,g,d,ee),Hn=!1,fe=r.memoizedState,g.state=fe,io(r,d,g,h),ro();var Se=r.memoizedState;$!==Ae||fe!==Se||Hn||a!==null&&a.dependencies!==null&&Yc(a.dependencies)?(typeof F=="function"&&(wh(r,o,F,d),Se=r.memoizedState),(we=Hn||ly(r,o,we,d,fe,Se,ee)||a!==null&&a.dependencies!==null&&Yc(a.dependencies))?(ie||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(d,Se,ee),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(d,Se,ee)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=Se),g.props=d,g.state=Se,g.context=ee,d=we):(typeof g.componentDidUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||$===a.memoizedProps&&fe===a.memoizedState||(r.flags|=1024),d=!1)}return g=d,so(a,r),d=(r.flags&128)!==0,g||d?(g=r.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,a!==null&&d?(r.child=$r(r,a.child,null,h),r.child=$r(r,null,o,h)):cs(a,r,o,h),r.memoizedState=g.state,a=r.child):a=cn(a,r,h),a}function Sy(a,r,o,d){return Yl(),r.flags|=256,cs(a,r,o,d),r.child}var Ch={dehydrated:null,treeContext:null,retryLane:0};function Dh(a){return{baseLanes:a,cachePool:Tg()}}function kh(a,r,o){return a=a!==null?a.childLanes&~o:0,r&&(a|=ma),a}function wy(a,r,o){var d=r.pendingProps,h=!1,g=(r.flags&128)!==0,$;if(($=g)||($=a!==null&&a.memoizedState===null?!1:(Wt.current&2)!==0),$&&(h=!0,r.flags&=-129),$=(r.flags&32)!==0,r.flags&=-33,a===null){if(rt){if(h?Bn(r):Fn(),rt){var F=os,ee;if(ee=F){e:{for(ee=F,F=qa;ee.nodeType!==8;){if(!F){F=null;break e}if(ee=Aa(ee.nextSibling),ee===null){F=null;break e}}F=ee}F!==null?(r.memoizedState={dehydrated:F,treeContext:_r!==null?{id:nn,overflow:rn}:null,retryLane:536870912},ee=fa(18,null,null,0),ee.stateNode=F,ee.return=r,r.child=ee,ws=r,os=null,ee=!0):ee=!1}ee||Ir(r)}if(F=r.memoizedState,F!==null&&(F=F.dehydrated,F!==null))return F.data==="$!"?r.lanes=16:r.lanes=536870912,null;ln(r)}return F=d.children,d=d.fallback,h?(Fn(),h=r.mode,F=Oh({mode:"hidden",children:F},h),d=qr(d,h,o,null),F.return=r,d.return=r,F.sibling=d,r.child=F,h=r.child,h.memoizedState=Dh(o),h.childLanes=kh(a,$,o),r.memoizedState=Ch,d):(Bn(r),_h(r,F))}if(ee=a.memoizedState,ee!==null&&(F=ee.dehydrated,F!==null)){if(g)r.flags&256?(Bn(r),r.flags&=-257,r=Ih(a,r,o)):r.memoizedState!==null?(Fn(),r.child=a.child,r.flags|=128,r=null):(Fn(),h=d.fallback,F=r.mode,d=Oh({mode:"visible",children:d.children},F),h=qr(h,F,o,null),h.flags|=2,d.return=r,h.return=r,d.sibling=h,r.child=d,$r(r,a.child,null,o),d=r.child,d.memoizedState=Dh(o),d.childLanes=kh(a,$,o),r.memoizedState=Ch,r=h);else if(Bn(r),F.data==="$!"){if($=F.nextSibling&&F.nextSibling.dataset,$)var ie=$.dgst;$=ie,d=Error(i(419)),d.stack="",d.digest=$,Vl({value:d,source:null,stack:null}),r=Ih(a,r,o)}else if(as||ao(a,r,o,!1),$=(o&a.childLanes)!==0,as||$){if($=vt,$!==null){if(d=o&-o,(d&42)!==0)d=1;else switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=64;break;case 268435456:d=134217728;break;default:d=0}if(d=(d&($.suspendedLanes|o))!==0?0:d,d!==0&&d!==ee.retryLane)throw ee.retryLane=d,Ln(a,d),Ts($,a,d),py}F.data==="$?"||of(),r=Ih(a,r,o)}else F.data==="$?"?(r.flags|=128,r.child=a.child,r=$S.bind(null,a),F._reactRetry=r,r=null):(a=ee.treeContext,os=Aa(F.nextSibling),ws=r,rt=!0,Ta=null,qa=!1,a!==null&&(oa[ca++]=nn,oa[ca++]=rn,oa[ca++]=_r,nn=a.id,rn=a.overflow,_r=r),r=_h(r,d.children),r.flags|=4096);return r}return h?(Fn(),h=d.fallback,F=r.mode,ee=a.child,ie=ee.sibling,d=Zn(ee,{mode:"hidden",children:d.children}),d.subtreeFlags=ee.subtreeFlags&31457280,ie!==null?h=Zn(ie,h):(h=qr(h,F,o,null),h.flags|=2),h.return=r,d.return=r,d.sibling=h,r.child=d,d=h,h=r.child,F=a.child.memoizedState,F===null?F=Dh(o):(ee=F.cachePool,ee!==null?(ie=Kt._currentValue,ee=ee.parent!==ie?{parent:ie,pool:ie}:ee):ee=Tg(),F={baseLanes:F.baseLanes|o,cachePool:ee}),h.memoizedState=F,h.childLanes=kh(a,$,o),r.memoizedState=Ch,d):(Bn(r),o=a.child,a=o.sibling,o=Zn(o,{mode:"visible",children:d.children}),o.return=r,o.sibling=null,a!==null&&($=r.deletions,$===null?(r.deletions=[a],r.flags|=16):$.push(a)),r.child=o,r.memoizedState=null,o)}function _h(a,r){return r=Oh({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function Oh(a,r){return Zy(a,r,0,null)}function Ih(a,r,o){return $r(r,a.child,null,o),a=_h(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function Ty(a,r,o){a.lanes|=r;var d=a.alternate;d!==null&&(d.lanes|=r),zh(a.return,r,o)}function $h(a,r,o,d,h){var g=a.memoizedState;g===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:h}:(g.isBackwards=r,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=o,g.tailMode=h)}function Ey(a,r,o){var d=r.pendingProps,h=d.revealOrder,g=d.tail;if(cs(a,r,d.children,o),d=Wt.current,(d&2)!==0)d=d&1|2,r.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Ty(a,o,r);else if(a.tag===19)Ty(a,o,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}switch(oe(Wt,d),h){case"forwards":for(o=r.child,h=null;o!==null;)a=o.alternate,a!==null&&Ic(a)===null&&(h=o),o=o.sibling;o=h,o===null?(h=r.child,r.child=null):(h=o.sibling,o.sibling=null),$h(r,!1,h,o,g);break;case"backwards":for(o=null,h=r.child,r.child=null;h!==null;){if(a=h.alternate,a!==null&&Ic(a)===null){r.child=h;break}a=h.sibling,h.sibling=o,o=h,h=a}$h(r,!0,o,null,g);break;case"together":$h(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function cn(a,r,o){if(a!==null&&(r.dependencies=a.dependencies),Wn|=r.lanes,(o&r.childLanes)===0)if(a!==null){if(ao(a,r,o,!1),(o&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(i(153));if(r.child!==null){for(a=r.child,o=Zn(a,a.pendingProps),r.child=o,o.return=r;a.sibling!==null;)a=a.sibling,o=o.sibling=Zn(a,a.pendingProps),o.return=r;o.sibling=null}return r.child}function Rh(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&Yc(a)))}function jS(a,r,o){switch(r.tag){case 3:me(r,r.stateNode.containerInfo),qn(r,Kt,a.memoizedState.cache),Yl();break;case 27:case 5:Oe(r);break;case 4:me(r,r.stateNode.containerInfo);break;case 10:qn(r,r.type,r.memoizedProps.value);break;case 13:var d=r.memoizedState;if(d!==null)return d.dehydrated!==null?(Bn(r),r.flags|=128,null):(o&r.child.childLanes)!==0?wy(a,r,o):(Bn(r),a=cn(a,r,o),a!==null?a.sibling:null);Bn(r);break;case 19:var h=(a.flags&128)!==0;if(d=(o&r.childLanes)!==0,d||(ao(a,r,o,!1),d=(o&r.childLanes)!==0),h){if(d)return Ey(a,r,o);r.flags|=128}if(h=r.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),oe(Wt,Wt.current),d)break;return null;case 22:case 23:return r.lanes=0,xy(a,r,o);case 24:qn(r,Kt,a.memoizedState.cache)}return cn(a,r,o)}function Ay(a,r,o){if(a!==null)if(a.memoizedProps!==r.pendingProps)as=!0;else{if(!Rh(a,o)&&(r.flags&128)===0)return as=!1,jS(a,r,o);as=(a.flags&131072)!==0}else as=!1,rt&&(r.flags&1048576)!==0&&ug(r,Cc,r.index);switch(r.lanes=0,r.tag){case 16:e:{a=r.pendingProps;var d=r.elementType,h=d._init;if(d=h(d._payload),r.type=d,typeof d=="function")Xh(d)?(a=Br(d,a),r.tag=1,r=Ny(null,r,d,a,o)):(r.tag=0,r=Ah(null,r,d,a,o));else{if(d!=null){if(h=d.$$typeof,h===b){r.tag=11,r=gy(null,r,d,a,o);break e}else if(h===S){r.tag=14,r=yy(null,r,d,a,o);break e}}throw r=_(d)||d,Error(i(306,r,""))}}return r;case 0:return Ah(a,r,r.type,r.pendingProps,o);case 1:return d=r.type,h=Br(d,r.pendingProps),Ny(a,r,d,h,o);case 3:e:{if(me(r,r.stateNode.containerInfo),a===null)throw Error(i(387));var g=r.pendingProps;h=r.memoizedState,d=h.element,Fh(a,r),io(r,g,null,o);var $=r.memoizedState;if(g=$.cache,qn(r,Kt,g),g!==h.cache&&Lh(r,[Kt],o,!0),ro(),g=$.element,h.isDehydrated)if(h={element:g,isDehydrated:!1,cache:$.cache},r.updateQueue.baseState=h,r.memoizedState=h,r.flags&256){r=Sy(a,r,g,o);break e}else if(g!==d){d=la(Error(i(424)),r),Vl(d),r=Sy(a,r,g,o);break e}else for(os=Aa(r.stateNode.containerInfo.firstChild),ws=r,rt=!0,Ta=null,qa=!0,o=jg(r,null,g,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Yl(),g===d){r=cn(a,r,o);break e}cs(a,r,g,o)}r=r.child}return r;case 26:return so(a,r),a===null?(o=kv(r.type,null,r.pendingProps,null))?r.memoizedState=o:rt||(o=r.type,a=r.pendingProps,d=ld(ne.current).createElement(o),d[vs]=r,d[ks]=a,ds(d,o,a),ss(d),r.stateNode=d):r.memoizedState=kv(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return Oe(r),a===null&&rt&&(d=r.stateNode=Av(r.type,r.pendingProps,ne.current),ws=r,qa=!0,os=Aa(d.firstChild)),d=r.pendingProps.children,a!==null||rt?cs(a,r,d,o):r.child=$r(r,null,d,o),so(a,r),r.child;case 5:return a===null&&rt&&((h=d=os)&&(d=ZS(d,r.type,r.pendingProps,qa),d!==null?(r.stateNode=d,ws=r,os=Aa(d.firstChild),qa=!1,h=!0):h=!1),h||Ir(r)),Oe(r),h=r.type,g=r.pendingProps,$=a!==null?a.memoizedProps:null,d=g.children,Nf(h,g)?d=null:$!==null&&Nf(h,$)&&(r.flags|=32),r.memoizedState!==null&&(h=ch(a,r,fS,null,null,o),No._currentValue=h),so(a,r),cs(a,r,d,o),r.child;case 6:return a===null&&rt&&((a=o=os)&&(o=WS(o,r.pendingProps,qa),o!==null?(r.stateNode=o,ws=r,os=null,a=!0):a=!1),a||Ir(r)),null;case 13:return wy(a,r,o);case 4:return me(r,r.stateNode.containerInfo),d=r.pendingProps,a===null?r.child=$r(r,null,d,o):cs(a,r,d,o),r.child;case 11:return gy(a,r,r.type,r.pendingProps,o);case 7:return cs(a,r,r.pendingProps,o),r.child;case 8:return cs(a,r,r.pendingProps.children,o),r.child;case 12:return cs(a,r,r.pendingProps.children,o),r.child;case 10:return d=r.pendingProps,qn(r,r.type,d.value),cs(a,r,d.children,o),r.child;case 9:return h=r.type._context,d=r.pendingProps.children,Ur(r),h=xs(h),d=d(h),r.flags|=1,cs(a,r,d,o),r.child;case 14:return yy(a,r,r.type,r.pendingProps,o);case 15:return vy(a,r,r.type,r.pendingProps,o);case 19:return Ey(a,r,o);case 22:return xy(a,r,o);case 24:return Ur(r),d=xs(Kt),a===null?(h=lh(),h===null&&(h=vt,g=rh(),h.pooledCache=g,g.refCount++,g!==null&&(h.pooledCacheLanes|=o),h=g),r.memoizedState={parent:d,cache:h},Bh(r),qn(r,Kt,h)):((a.lanes&o)!==0&&(Fh(a,r),io(r,null,null,o),ro()),h=a.memoizedState,g=r.memoizedState,h.parent!==d?(h={parent:d,cache:d},r.memoizedState=h,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=h),qn(r,Kt,d)):(d=g.cache,qn(r,Kt,d),d!==h.cache&&Lh(r,[Kt],o,!0))),cs(a,r,r.pendingProps.children,o),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}var Mh=se(null),Fr=null,dn=null;function qn(a,r,o){oe(Mh,r._currentValue),r._currentValue=o}function un(a){a._currentValue=Mh.current,ae(Mh)}function zh(a,r,o){for(;a!==null;){var d=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),a===o)break;a=a.return}}function Lh(a,r,o,d){var h=a.child;for(h!==null&&(h.return=a);h!==null;){var g=h.dependencies;if(g!==null){var $=h.child;g=g.firstContext;e:for(;g!==null;){var F=g;g=h;for(var ee=0;ee<r.length;ee++)if(F.context===r[ee]){g.lanes|=o,F=g.alternate,F!==null&&(F.lanes|=o),zh(g.return,o,a),d||($=null);break e}g=F.next}}else if(h.tag===18){if($=h.return,$===null)throw Error(i(341));$.lanes|=o,g=$.alternate,g!==null&&(g.lanes|=o),zh($,o,a),$=null}else $=h.child;if($!==null)$.return=h;else for($=h;$!==null;){if($===a){$=null;break}if(h=$.sibling,h!==null){h.return=$.return,$=h;break}$=$.return}h=$}}function ao(a,r,o,d){a=null;for(var h=r,g=!1;h!==null;){if(!g){if((h.flags&524288)!==0)g=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var $=h.alternate;if($===null)throw Error(i(387));if($=$.memoizedProps,$!==null){var F=h.type;Ps(h.pendingProps.value,$.value)||(a!==null?a.push(F):a=[F])}}else if(h===pe.current){if($=h.alternate,$===null)throw Error(i(387));$.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(a!==null?a.push(No):a=[No])}h=h.return}a!==null&&Lh(r,a,o,d),r.flags|=262144}function Yc(a){for(a=a.firstContext;a!==null;){if(!Ps(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ur(a){Fr=a,dn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function xs(a){return Cy(Fr,a)}function Vc(a,r){return Fr===null&&Ur(a),Cy(a,r)}function Cy(a,r){var o=r._currentValue;if(r={context:r,memoizedValue:o,next:null},dn===null){if(a===null)throw Error(i(308));dn=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else dn=dn.next=r;return o}var Hn=!1;function Bh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Fh(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Yn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Vn(a,r,o){var d=a.updateQueue;if(d===null)return null;if(d=d.shared,(kt&2)!==0){var h=d.pending;return h===null?r.next=r:(r.next=h.next,h.next=r),d.pending=r,r=Ec(a),cg(a,null,o),r}return Tc(a,d,r,o),Ec(a)}function no(a,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194176)!==0)){var d=r.lanes;d&=a.pendingLanes,o|=d,r.lanes=o,yp(a,o)}}function Uh(a,r){var o=a.updateQueue,d=a.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var h=null,g=null;if(o=o.firstBaseUpdate,o!==null){do{var $={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};g===null?h=g=$:g=g.next=$,o=o.next}while(o!==null);g===null?h=g=r:g=g.next=r}else h=g=r;o={baseState:d.baseState,firstBaseUpdate:h,lastBaseUpdate:g,shared:d.shared,callbacks:d.callbacks},a.updateQueue=o;return}a=o.lastBaseUpdate,a===null?o.firstBaseUpdate=r:a.next=r,o.lastBaseUpdate=r}var Ph=!1;function ro(){if(Ph){var a=Li;if(a!==null)throw a}}function io(a,r,o,d){Ph=!1;var h=a.updateQueue;Hn=!1;var g=h.firstBaseUpdate,$=h.lastBaseUpdate,F=h.shared.pending;if(F!==null){h.shared.pending=null;var ee=F,ie=ee.next;ee.next=null,$===null?g=ie:$.next=ie,$=ee;var we=a.alternate;we!==null&&(we=we.updateQueue,F=we.lastBaseUpdate,F!==$&&(F===null?we.firstBaseUpdate=ie:F.next=ie,we.lastBaseUpdate=ee))}if(g!==null){var Ae=h.baseState;$=0,we=ie=ee=null,F=g;do{var fe=F.lane&-536870913,Se=fe!==F.lane;if(Se?(nt&fe)===fe:(d&fe)===fe){fe!==0&&fe===zi&&(Ph=!0),we!==null&&(we=we.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var Fe=a,Ge=F;fe=r;var zt=o;switch(Ge.tag){case 1:if(Fe=Ge.payload,typeof Fe=="function"){Ae=Fe.call(zt,Ae,fe);break e}Ae=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ge.payload,fe=typeof Fe=="function"?Fe.call(zt,Ae,fe):Fe,fe==null)break e;Ae=z({},Ae,fe);break e;case 2:Hn=!0}}fe=F.callback,fe!==null&&(a.flags|=64,Se&&(a.flags|=8192),Se=h.callbacks,Se===null?h.callbacks=[fe]:Se.push(fe))}else Se={lane:fe,tag:F.tag,payload:F.payload,callback:F.callback,next:null},we===null?(ie=we=Se,ee=Ae):we=we.next=Se,$|=fe;if(F=F.next,F===null){if(F=h.shared.pending,F===null)break;Se=F,F=Se.next,Se.next=null,h.lastBaseUpdate=Se,h.shared.pending=null}}while(!0);we===null&&(ee=Ae),h.baseState=ee,h.firstBaseUpdate=ie,h.lastBaseUpdate=we,g===null&&(h.shared.lanes=0),Wn|=$,a.lanes=$,a.memoizedState=Ae}}function Dy(a,r){if(typeof a!="function")throw Error(i(191,a));a.call(r)}function ky(a,r){var o=a.callbacks;if(o!==null)for(a.callbacks=null,a=0;a<o.length;a++)Dy(o[a],r)}function lo(a,r){try{var o=r.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var h=d.next;o=h;do{if((o.tag&a)===a){d=void 0;var g=o.create,$=o.inst;d=g(),$.destroy=d}o=o.next}while(o!==h)}}catch(F){pt(r,r.return,F)}}function Gn(a,r,o){try{var d=r.updateQueue,h=d!==null?d.lastEffect:null;if(h!==null){var g=h.next;d=g;do{if((d.tag&a)===a){var $=d.inst,F=$.destroy;if(F!==void 0){$.destroy=void 0,h=r;var ee=o;try{F()}catch(ie){pt(h,ee,ie)}}}d=d.next}while(d!==g)}}catch(ie){pt(r,r.return,ie)}}function _y(a){var r=a.updateQueue;if(r!==null){var o=a.stateNode;try{ky(r,o)}catch(d){pt(a,a.return,d)}}}function Oy(a,r,o){o.props=Br(a.type,a.memoizedProps),o.state=a.memoizedState;try{o.componentWillUnmount()}catch(d){pt(a,r,d)}}function Pr(a,r){try{var o=a.ref;if(o!==null){var d=a.stateNode;switch(a.tag){case 26:case 27:case 5:var h=d;break;default:h=d}typeof o=="function"?a.refCleanup=o(h):o.current=h}}catch(g){pt(a,r,g)}}function qs(a,r){var o=a.ref,d=a.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(h){pt(a,r,h)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(h){pt(a,r,h)}else o.current=null}function Iy(a){var r=a.type,o=a.memoizedProps,d=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(h){pt(a,a.return,h)}}function $y(a,r,o){try{var d=a.stateNode;YS(d,a.type,o,r),d[ks]=r}catch(h){pt(a,a.return,h)}}function Ry(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27||a.tag===4}function qh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Ry(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==27&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Hh(a,r,o){var d=a.tag;if(d===5||d===6)a=a.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(a,r):o.insertBefore(a,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(a,o)):(r=o,r.appendChild(a)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=id));else if(d!==4&&d!==27&&(a=a.child,a!==null))for(Hh(a,r,o),a=a.sibling;a!==null;)Hh(a,r,o),a=a.sibling}function Gc(a,r,o){var d=a.tag;if(d===5||d===6)a=a.stateNode,r?o.insertBefore(a,r):o.appendChild(a);else if(d!==4&&d!==27&&(a=a.child,a!==null))for(Gc(a,r,o),a=a.sibling;a!==null;)Gc(a,r,o),a=a.sibling}var hn=!1,Rt=!1,Yh=!1,My=typeof WeakSet=="function"?WeakSet:Set,ns=null,zy=!1;function bS(a,r){if(a=a.containerInfo,jf=fd,a=eg(a),Gu(a)){if("selectionStart"in a)var o={start:a.selectionStart,end:a.selectionEnd};else e:{o=(o=a.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var h=d.anchorOffset,g=d.focusNode;d=d.focusOffset;try{o.nodeType,g.nodeType}catch{o=null;break e}var $=0,F=-1,ee=-1,ie=0,we=0,Ae=a,fe=null;t:for(;;){for(var Se;Ae!==o||h!==0&&Ae.nodeType!==3||(F=$+h),Ae!==g||d!==0&&Ae.nodeType!==3||(ee=$+d),Ae.nodeType===3&&($+=Ae.nodeValue.length),(Se=Ae.firstChild)!==null;)fe=Ae,Ae=Se;for(;;){if(Ae===a)break t;if(fe===o&&++ie===h&&(F=$),fe===g&&++we===d&&(ee=$),(Se=Ae.nextSibling)!==null)break;Ae=fe,fe=Ae.parentNode}Ae=Se}o=F===-1||ee===-1?null:{start:F,end:ee}}else o=null}o=o||{start:0,end:0}}else o=null;for(bf={focusedElem:a,selectionRange:o},fd=!1,ns=r;ns!==null;)if(r=ns,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,ns=a;else for(;ns!==null;){switch(r=ns,g=r.alternate,a=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&g!==null){a=void 0,o=r,h=g.memoizedProps,g=g.memoizedState,d=o.stateNode;try{var Fe=Br(o.type,h,o.elementType===o.type);a=d.getSnapshotBeforeUpdate(Fe,g),d.__reactInternalSnapshotBeforeUpdate=a}catch(Ge){pt(o,o.return,Ge)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,o=a.nodeType,o===9)Tf(a);else if(o===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Tf(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(i(163))}if(a=r.sibling,a!==null){a.return=r.return,ns=a;break}ns=r.return}return Fe=zy,zy=!1,Fe}function Ly(a,r,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:mn(a,o),d&4&&lo(5,o);break;case 1:if(mn(a,o),d&4)if(a=o.stateNode,r===null)try{a.componentDidMount()}catch(F){pt(o,o.return,F)}else{var h=Br(o.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(h,r,a.__reactInternalSnapshotBeforeUpdate)}catch(F){pt(o,o.return,F)}}d&64&&_y(o),d&512&&Pr(o,o.return);break;case 3:if(mn(a,o),d&64&&(d=o.updateQueue,d!==null)){if(a=null,o.child!==null)switch(o.child.tag){case 27:case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}try{ky(d,a)}catch(F){pt(o,o.return,F)}}break;case 26:mn(a,o),d&512&&Pr(o,o.return);break;case 27:case 5:mn(a,o),r===null&&d&4&&Iy(o),d&512&&Pr(o,o.return);break;case 12:mn(a,o);break;case 13:mn(a,o),d&4&&Uy(a,o);break;case 22:if(h=o.memoizedState!==null||hn,!h){r=r!==null&&r.memoizedState!==null||Rt;var g=hn,$=Rt;hn=h,(Rt=r)&&!$?Qn(a,o,(o.subtreeFlags&8772)!==0):mn(a,o),hn=g,Rt=$}d&512&&(o.memoizedProps.mode==="manual"?Pr(o,o.return):qs(o,o.return));break;default:mn(a,o)}}function By(a){var r=a.alternate;r!==null&&(a.alternate=null,By(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&_u(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Xt=null,Hs=!1;function fn(a,r,o){for(o=o.child;o!==null;)Fy(a,r,o),o=o.sibling}function Fy(a,r,o){if(yt&&typeof yt.onCommitFiberUnmount=="function")try{yt.onCommitFiberUnmount(Pt,o)}catch{}switch(o.tag){case 26:Rt||qs(o,r),fn(a,r,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Rt||qs(o,r);var d=Xt,h=Hs;for(Xt=o.stateNode,fn(a,r,o),o=o.stateNode,r=o.attributes;r.length;)o.removeAttributeNode(r[0]);_u(o),Xt=d,Hs=h;break;case 5:Rt||qs(o,r);case 6:h=Xt;var g=Hs;if(Xt=null,fn(a,r,o),Xt=h,Hs=g,Xt!==null)if(Hs)try{a=Xt,d=o.stateNode,a.nodeType===8?a.parentNode.removeChild(d):a.removeChild(d)}catch($){pt(o,r,$)}else try{Xt.removeChild(o.stateNode)}catch($){pt(o,r,$)}break;case 18:Xt!==null&&(Hs?(r=Xt,o=o.stateNode,r.nodeType===8?wf(r.parentNode,o):r.nodeType===1&&wf(r,o),Eo(r)):wf(Xt,o.stateNode));break;case 4:d=Xt,h=Hs,Xt=o.stateNode.containerInfo,Hs=!0,fn(a,r,o),Xt=d,Hs=h;break;case 0:case 11:case 14:case 15:Rt||Gn(2,o,r),Rt||Gn(4,o,r),fn(a,r,o);break;case 1:Rt||(qs(o,r),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Oy(o,r,d)),fn(a,r,o);break;case 21:fn(a,r,o);break;case 22:Rt||qs(o,r),Rt=(d=Rt)||o.memoizedState!==null,fn(a,r,o),Rt=d;break;default:fn(a,r,o)}}function Uy(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Eo(a)}catch(o){pt(r,r.return,o)}}function NS(a){switch(a.tag){case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new My),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new My),r;default:throw Error(i(435,a.tag))}}function Vh(a,r){var o=NS(a);r.forEach(function(d){var h=RS.bind(null,a,d);o.has(d)||(o.add(d),d.then(h,h))})}function ua(a,r){var o=r.deletions;if(o!==null)for(var d=0;d<o.length;d++){var h=o[d],g=a,$=r,F=$;e:for(;F!==null;){switch(F.tag){case 27:case 5:Xt=F.stateNode,Hs=!1;break e;case 3:Xt=F.stateNode.containerInfo,Hs=!0;break e;case 4:Xt=F.stateNode.containerInfo,Hs=!0;break e}F=F.return}if(Xt===null)throw Error(i(160));Fy(g,$,h),Xt=null,Hs=!1,g=h.alternate,g!==null&&(g.return=null),h.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)Py(r,a),r=r.sibling}var Ea=null;function Py(a,r){var o=a.alternate,d=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ua(r,a),ha(a),d&4&&(Gn(3,a,a.return),lo(3,a),Gn(5,a,a.return));break;case 1:ua(r,a),ha(a),d&512&&(Rt||o===null||qs(o,o.return)),d&64&&hn&&(a=a.updateQueue,a!==null&&(d=a.callbacks,d!==null&&(o=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var h=Ea;if(ua(r,a),ha(a),d&512&&(Rt||o===null||qs(o,o.return)),d&4){var g=o!==null?o.memoizedState:null;if(d=a.memoizedState,o===null)if(d===null)if(a.stateNode===null){e:{d=a.type,o=a.memoizedProps,h=h.ownerDocument||h;t:switch(d){case"title":g=h.getElementsByTagName("title")[0],(!g||g[Il]||g[vs]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=h.createElement(d),h.head.insertBefore(g,h.querySelector("head > title"))),ds(g,d,o),g[vs]=a,ss(g),d=g;break e;case"link":var $=Iv("link","href",h).get(d+(o.href||""));if($){for(var F=0;F<$.length;F++)if(g=$[F],g.getAttribute("href")===(o.href==null?null:o.href)&&g.getAttribute("rel")===(o.rel==null?null:o.rel)&&g.getAttribute("title")===(o.title==null?null:o.title)&&g.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){$.splice(F,1);break t}}g=h.createElement(d),ds(g,d,o),h.head.appendChild(g);break;case"meta":if($=Iv("meta","content",h).get(d+(o.content||""))){for(F=0;F<$.length;F++)if(g=$[F],g.getAttribute("content")===(o.content==null?null:""+o.content)&&g.getAttribute("name")===(o.name==null?null:o.name)&&g.getAttribute("property")===(o.property==null?null:o.property)&&g.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&g.getAttribute("charset")===(o.charSet==null?null:o.charSet)){$.splice(F,1);break t}}g=h.createElement(d),ds(g,d,o),h.head.appendChild(g);break;default:throw Error(i(468,d))}g[vs]=a,ss(g),d=g}a.stateNode=d}else $v(h,a.type,a.stateNode);else a.stateNode=Ov(h,d,a.memoizedProps);else g!==d?(g===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):g.count--,d===null?$v(h,a.type,a.stateNode):Ov(h,d,a.memoizedProps)):d===null&&a.stateNode!==null&&$y(a,a.memoizedProps,o.memoizedProps)}break;case 27:if(d&4&&a.alternate===null){h=a.stateNode,g=a.memoizedProps;try{for(var ee=h.firstChild;ee;){var ie=ee.nextSibling,we=ee.nodeName;ee[Il]||we==="HEAD"||we==="BODY"||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&ee.rel.toLowerCase()==="stylesheet"||h.removeChild(ee),ee=ie}for(var Ae=a.type,fe=h.attributes;fe.length;)h.removeAttributeNode(fe[0]);ds(h,Ae,g),h[vs]=a,h[ks]=g}catch(Fe){pt(a,a.return,Fe)}}case 5:if(ua(r,a),ha(a),d&512&&(Rt||o===null||qs(o,o.return)),a.flags&32){h=a.stateNode;try{Ti(h,"")}catch(Fe){pt(a,a.return,Fe)}}d&4&&a.stateNode!=null&&(h=a.memoizedProps,$y(a,h,o!==null?o.memoizedProps:h)),d&1024&&(Yh=!0);break;case 6:if(ua(r,a),ha(a),d&4){if(a.stateNode===null)throw Error(i(162));d=a.memoizedProps,o=a.stateNode;try{o.nodeValue=d}catch(Fe){pt(a,a.return,Fe)}}break;case 3:if(dd=null,h=Ea,Ea=od(r.containerInfo),ua(r,a),Ea=h,ha(a),d&4&&o!==null&&o.memoizedState.isDehydrated)try{Eo(r.containerInfo)}catch(Fe){pt(a,a.return,Fe)}Yh&&(Yh=!1,qy(a));break;case 4:d=Ea,Ea=od(a.stateNode.containerInfo),ua(r,a),ha(a),Ea=d;break;case 12:ua(r,a),ha(a);break;case 13:ua(r,a),ha(a),a.child.flags&8192&&a.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(tf=ve()),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vh(a,d)));break;case 22:if(d&512&&(Rt||o===null||qs(o,o.return)),ee=a.memoizedState!==null,ie=o!==null&&o.memoizedState!==null,we=hn,Ae=Rt,hn=we||ee,Rt=Ae||ie,ua(r,a),Rt=Ae,hn=we,ha(a),r=a.stateNode,r._current=a,r._visibility&=-3,r._visibility|=r._pendingVisibility&2,d&8192&&(r._visibility=ee?r._visibility&-2:r._visibility|1,ee&&(r=hn||Rt,o===null||ie||r||Pi(a)),a.memoizedProps===null||a.memoizedProps.mode!=="manual"))e:for(o=null,r=a;;){if(r.tag===5||r.tag===26||r.tag===27){if(o===null){ie=o=r;try{if(h=ie.stateNode,ee)g=h.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none";else{$=ie.stateNode,F=ie.memoizedProps.style;var Se=F!=null&&F.hasOwnProperty("display")?F.display:null;$.style.display=Se==null||typeof Se=="boolean"?"":(""+Se).trim()}}catch(Fe){pt(ie,ie.return,Fe)}}}else if(r.tag===6){if(o===null){ie=r;try{ie.stateNode.nodeValue=ee?"":ie.memoizedProps}catch(Fe){pt(ie,ie.return,Fe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;o===r&&(o=null),r=r.return}o===r&&(o=null),r.sibling.return=r.return,r=r.sibling}d&4&&(d=a.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,Vh(a,o))));break;case 19:ua(r,a),ha(a),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vh(a,d)));break;case 21:break;default:ua(r,a),ha(a)}}function ha(a){var r=a.flags;if(r&2){try{if(a.tag!==27){e:{for(var o=a.return;o!==null;){if(Ry(o)){var d=o;break e}o=o.return}throw Error(i(160))}switch(d.tag){case 27:var h=d.stateNode,g=qh(a);Gc(a,g,h);break;case 5:var $=d.stateNode;d.flags&32&&(Ti($,""),d.flags&=-33);var F=qh(a);Gc(a,F,$);break;case 3:case 4:var ee=d.stateNode.containerInfo,ie=qh(a);Hh(a,ie,ee);break;default:throw Error(i(161))}}}catch(we){pt(a,a.return,we)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function qy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;qy(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function mn(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Ly(a,r.alternate,r),r=r.sibling}function Pi(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:Gn(4,r,r.return),Pi(r);break;case 1:qs(r,r.return);var o=r.stateNode;typeof o.componentWillUnmount=="function"&&Oy(r,r.return,o),Pi(r);break;case 26:case 27:case 5:qs(r,r.return),Pi(r);break;case 22:qs(r,r.return),r.memoizedState===null&&Pi(r);break;default:Pi(r)}a=a.sibling}}function Qn(a,r,o){for(o=o&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var d=r.alternate,h=a,g=r,$=g.flags;switch(g.tag){case 0:case 11:case 15:Qn(h,g,o),lo(4,g);break;case 1:if(Qn(h,g,o),d=g,h=d.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(ie){pt(d,d.return,ie)}if(d=g,h=d.updateQueue,h!==null){var F=d.stateNode;try{var ee=h.shared.hiddenCallbacks;if(ee!==null)for(h.shared.hiddenCallbacks=null,h=0;h<ee.length;h++)Dy(ee[h],F)}catch(ie){pt(d,d.return,ie)}}o&&$&64&&_y(g),Pr(g,g.return);break;case 26:case 27:case 5:Qn(h,g,o),o&&d===null&&$&4&&Iy(g),Pr(g,g.return);break;case 12:Qn(h,g,o);break;case 13:Qn(h,g,o),o&&$&4&&Uy(h,g);break;case 22:g.memoizedState===null&&Qn(h,g,o),Pr(g,g.return);break;default:Qn(h,g,o)}r=r.sibling}}function Gh(a,r){var o=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==o&&(a!=null&&a.refCount++,o!=null&&Wl(o))}function Qh(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&Wl(a))}function Xn(a,r,o,d){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Hy(a,r,o,d),r=r.sibling}function Hy(a,r,o,d){var h=r.flags;switch(r.tag){case 0:case 11:case 15:Xn(a,r,o,d),h&2048&&lo(9,r);break;case 3:Xn(a,r,o,d),h&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&Wl(a)));break;case 12:if(h&2048){Xn(a,r,o,d),a=r.stateNode;try{var g=r.memoizedProps,$=g.id,F=g.onPostCommit;typeof F=="function"&&F($,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ee){pt(r,r.return,ee)}}else Xn(a,r,o,d);break;case 23:break;case 22:g=r.stateNode,r.memoizedState!==null?g._visibility&4?Xn(a,r,o,d):oo(a,r):g._visibility&4?Xn(a,r,o,d):(g._visibility|=4,qi(a,r,o,d,(r.subtreeFlags&10256)!==0)),h&2048&&Gh(r.alternate,r);break;case 24:Xn(a,r,o,d),h&2048&&Qh(r.alternate,r);break;default:Xn(a,r,o,d)}}function qi(a,r,o,d,h){for(h=h&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var g=a,$=r,F=o,ee=d,ie=$.flags;switch($.tag){case 0:case 11:case 15:qi(g,$,F,ee,h),lo(8,$);break;case 23:break;case 22:var we=$.stateNode;$.memoizedState!==null?we._visibility&4?qi(g,$,F,ee,h):oo(g,$):(we._visibility|=4,qi(g,$,F,ee,h)),h&&ie&2048&&Gh($.alternate,$);break;case 24:qi(g,$,F,ee,h),h&&ie&2048&&Qh($.alternate,$);break;default:qi(g,$,F,ee,h)}r=r.sibling}}function oo(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var o=a,d=r,h=d.flags;switch(d.tag){case 22:oo(o,d),h&2048&&Gh(d.alternate,d);break;case 24:oo(o,d),h&2048&&Qh(d.alternate,d);break;default:oo(o,d)}r=r.sibling}}var co=8192;function Hi(a){if(a.subtreeFlags&co)for(a=a.child;a!==null;)Yy(a),a=a.sibling}function Yy(a){switch(a.tag){case 26:Hi(a),a.flags&co&&a.memoizedState!==null&&d1(Ea,a.memoizedState,a.memoizedProps);break;case 5:Hi(a);break;case 3:case 4:var r=Ea;Ea=od(a.stateNode.containerInfo),Hi(a),Ea=r;break;case 22:a.memoizedState===null&&(r=a.alternate,r!==null&&r.memoizedState!==null?(r=co,co=16777216,Hi(a),co=r):Hi(a));break;default:Hi(a)}}function Vy(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function uo(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];ns=d,Qy(d,a)}Vy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Gy(a),a=a.sibling}function Gy(a){switch(a.tag){case 0:case 11:case 15:uo(a),a.flags&2048&&Gn(9,a,a.return);break;case 3:uo(a);break;case 12:uo(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&4&&(a.return===null||a.return.tag!==13)?(r._visibility&=-5,Qc(a)):uo(a);break;default:uo(a)}}function Qc(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];ns=d,Qy(d,a)}Vy(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:Gn(8,r,r.return),Qc(r);break;case 22:o=r.stateNode,o._visibility&4&&(o._visibility&=-5,Qc(r));break;default:Qc(r)}a=a.sibling}}function Qy(a,r){for(;ns!==null;){var o=ns;switch(o.tag){case 0:case 11:case 15:Gn(8,o,r);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Wl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,ns=d;else e:for(o=a;ns!==null;){d=ns;var h=d.sibling,g=d.return;if(By(d),d===o){ns=null;break e}if(h!==null){h.return=g,ns=h;break e}ns=g}}}function SS(a,r,o,d){this.tag=a,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fa(a,r,o,d){return new SS(a,r,o,d)}function Xh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Zn(a,r){var o=a.alternate;return o===null?(o=fa(a.tag,r,a.key,a.mode),o.elementType=a.elementType,o.type=a.type,o.stateNode=a.stateNode,o.alternate=a,a.alternate=o):(o.pendingProps=r,o.type=a.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=a.flags&31457280,o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,r=a.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=a.sibling,o.index=a.index,o.ref=a.ref,o.refCleanup=a.refCleanup,o}function Xy(a,r){a.flags&=31457282;var o=a.alternate;return o===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,r=o.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function Xc(a,r,o,d,h,g){var $=0;if(d=a,typeof a=="function")Xh(a)&&($=1);else if(typeof a=="string")$=o1(a,o,ce.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case p:return qr(o.children,h,g,r);case m:$=8,h|=24;break;case y:return a=fa(12,o,r,h|2),a.elementType=y,a.lanes=g,a;case w:return a=fa(13,o,r,h),a.elementType=w,a.lanes=g,a;case A:return a=fa(19,o,r,h),a.elementType=A,a.lanes=g,a;case D:return Zy(o,h,g,r);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case v:case N:$=10;break e;case j:$=9;break e;case b:$=11;break e;case S:$=14;break e;case C:$=16,d=null;break e}$=29,o=Error(i(130,a===null?"null":typeof a,"")),d=null}return r=fa($,o,r,h),r.elementType=a,r.type=d,r.lanes=g,r}function qr(a,r,o,d){return a=fa(7,a,d,r),a.lanes=o,a}function Zy(a,r,o,d){a=fa(22,a,d,r),a.elementType=D,a.lanes=o;var h={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var g=h._current;if(g===null)throw Error(i(456));if((h._pendingVisibility&2)===0){var $=Ln(g,2);$!==null&&(h._pendingVisibility|=2,Ts($,g,2))}},attach:function(){var g=h._current;if(g===null)throw Error(i(456));if((h._pendingVisibility&2)!==0){var $=Ln(g,2);$!==null&&(h._pendingVisibility&=-3,Ts($,g,2))}}};return a.stateNode=h,a}function Zh(a,r,o){return a=fa(6,a,null,r),a.lanes=o,a}function Wh(a,r,o){return r=fa(4,a.children!==null?a.children:[],a.key,r),r.lanes=o,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}function pn(a){a.flags|=4}function Wy(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Rv(r)){if(r=da.current,r!==null&&((nt&4194176)===nt?Ha!==null:(nt&62914560)!==nt&&(nt&536870912)===0||r!==Ha))throw Ql=sh,mg;a.flags|=8192}}function Zc(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?hc():536870912,a.lanes|=r,Vi|=r)}function ho(a,r){if(!rt)switch(a.tailMode){case"hidden":r=a.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?a.tail=null:o.sibling=null;break;case"collapsed":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:d.sibling=null}}function Dt(a){var r=a.alternate!==null&&a.alternate.child===a.child,o=0,d=0;if(r)for(var h=a.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags&31457280,d|=h.flags&31457280,h.return=a,h=h.sibling;else for(h=a.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags,d|=h.flags,h.return=a,h=h.sibling;return a.subtreeFlags|=d,a.childLanes=o,r}function wS(a,r,o){var d=r.pendingProps;switch(eh(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(r),null;case 1:return Dt(r),null;case 3:return o=r.stateNode,d=null,a!==null&&(d=a.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),un(Kt),je(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(a===null||a.child===null)&&(Hl(r)?pn(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Ta!==null&&(rf(Ta),Ta=null))),Dt(r),null;case 26:return o=r.memoizedState,a===null?(pn(r),o!==null?(Dt(r),Wy(r,o)):(Dt(r),r.flags&=-16777217)):o?o!==a.memoizedState?(pn(r),Dt(r),Wy(r,o)):(Dt(r),r.flags&=-16777217):(a.memoizedProps!==d&&pn(r),Dt(r),r.flags&=-16777217),null;case 27:De(r),o=ne.current;var h=r.type;if(a!==null&&r.stateNode!=null)a.memoizedProps!==d&&pn(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return Dt(r),null}a=ce.current,Hl(r)?hg(r):(a=Av(h,d,o),r.stateNode=a,pn(r))}return Dt(r),null;case 5:if(De(r),o=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==d&&pn(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return Dt(r),null}if(a=ce.current,Hl(r))hg(r);else{switch(h=ld(ne.current),a){case 1:a=h.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:a=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":a=h.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":a=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":a=h.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof d.is=="string"?h.createElement("select",{is:d.is}):h.createElement("select"),d.multiple?a.multiple=!0:d.size&&(a.size=d.size);break;default:a=typeof d.is=="string"?h.createElement(o,{is:d.is}):h.createElement(o)}}a[vs]=r,a[ks]=d;e:for(h=r.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}r.stateNode=a;e:switch(ds(a,o,d),o){case"button":case"input":case"select":case"textarea":a=!!d.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&pn(r)}}return Dt(r),r.flags&=-16777217,null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==d&&pn(r);else{if(typeof d!="string"&&r.stateNode===null)throw Error(i(166));if(a=ne.current,Hl(r)){if(a=r.stateNode,o=r.memoizedProps,d=null,h=ws,h!==null)switch(h.tag){case 27:case 5:d=h.memoizedProps}a[vs]=r,a=!!(a.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||bv(a.nodeValue,o)),a||Ir(r)}else a=ld(a).createTextNode(d),a[vs]=r,r.stateNode=a}return Dt(r),null;case 13:if(d=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(h=Hl(r),d!==null&&d.dehydrated!==null){if(a===null){if(!h)throw Error(i(318));if(h=r.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));h[vs]=r}else Yl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Dt(r),h=!1}else Ta!==null&&(rf(Ta),Ta=null),h=!0;if(!h)return r.flags&256?(ln(r),r):(ln(r),null)}if(ln(r),(r.flags&128)!==0)return r.lanes=o,r;if(o=d!==null,a=a!==null&&a.memoizedState!==null,o){d=r.child,h=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(h=d.alternate.memoizedState.cachePool.pool);var g=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(g=d.memoizedState.cachePool.pool),g!==h&&(d.flags|=2048)}return o!==a&&o&&(r.child.flags|=8192),Zc(r,r.updateQueue),Dt(r),null;case 4:return je(),a===null&&yf(r.stateNode.containerInfo),Dt(r),null;case 10:return un(r.type),Dt(r),null;case 19:if(ae(Wt),h=r.memoizedState,h===null)return Dt(r),null;if(d=(r.flags&128)!==0,g=h.rendering,g===null)if(d)ho(h,!1);else{if(Mt!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(g=Ic(a),g!==null){for(r.flags|=128,ho(h,!1),a=g.updateQueue,r.updateQueue=a,Zc(r,a),r.subtreeFlags=0,a=o,o=r.child;o!==null;)Xy(o,a),o=o.sibling;return oe(Wt,Wt.current&1|2),r.child}a=a.sibling}h.tail!==null&&ve()>Wc&&(r.flags|=128,d=!0,ho(h,!1),r.lanes=4194304)}else{if(!d)if(a=Ic(g),a!==null){if(r.flags|=128,d=!0,a=a.updateQueue,r.updateQueue=a,Zc(r,a),ho(h,!0),h.tail===null&&h.tailMode==="hidden"&&!g.alternate&&!rt)return Dt(r),null}else 2*ve()-h.renderingStartTime>Wc&&o!==536870912&&(r.flags|=128,d=!0,ho(h,!1),r.lanes=4194304);h.isBackwards?(g.sibling=r.child,r.child=g):(a=h.last,a!==null?a.sibling=g:r.child=g,h.last=g)}return h.tail!==null?(r=h.tail,h.rendering=r,h.tail=r.sibling,h.renderingStartTime=ve(),r.sibling=null,a=Wt.current,oe(Wt,d?a&1|2:a&1),r):(Dt(r),null);case 22:case 23:return ln(r),nh(),d=r.memoizedState!==null,a!==null?a.memoizedState!==null!==d&&(r.flags|=8192):d&&(r.flags|=8192),d?(o&536870912)!==0&&(r.flags&128)===0&&(Dt(r),r.subtreeFlags&6&&(r.flags|=8192)):Dt(r),o=r.updateQueue,o!==null&&Zc(r,o.retryQueue),o=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==o&&(r.flags|=2048),a!==null&&ae(Rr),null;case 24:return o=null,a!==null&&(o=a.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),un(Kt),Dt(r),null;case 25:return null}throw Error(i(156,r.tag))}function TS(a,r){switch(eh(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return un(Kt),je(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return De(r),null;case 13:if(ln(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Yl()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return ae(Wt),null;case 4:return je(),null;case 10:return un(r.type),null;case 22:case 23:return ln(r),nh(),a!==null&&ae(Rr),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return un(Kt),null;case 25:return null;default:return null}}function Ky(a,r){switch(eh(r),r.tag){case 3:un(Kt),je();break;case 26:case 27:case 5:De(r);break;case 4:je();break;case 13:ln(r);break;case 19:ae(Wt);break;case 10:un(r.type);break;case 22:case 23:ln(r),nh(),a!==null&&ae(Rr);break;case 24:un(Kt)}}var ES={getCacheForType:function(a){var r=xs(Kt),o=r.data.get(a);return o===void 0&&(o=a(),r.data.set(a,o)),o}},AS=typeof WeakMap=="function"?WeakMap:Map,kt=0,vt=null,et=null,nt=0,xt=0,Ys=null,gn=!1,Yi=!1,Kh=!1,yn=0,Mt=0,Wn=0,Hr=0,Jh=0,ma=0,Vi=0,fo=null,Va=null,ef=!1,tf=0,Wc=1/0,Kc=null,Kn=null,Jc=!1,Yr=null,mo=0,sf=0,af=null,po=0,nf=null;function Vs(){if((kt&2)!==0&&nt!==0)return nt&-nt;if(k.T!==null){var a=zi;return a!==0?a:ff()}return xp()}function Jy(){ma===0&&(ma=(nt&536870912)===0||rt?uc():536870912);var a=da.current;return a!==null&&(a.flags|=32),ma}function Ts(a,r,o){(a===vt&&xt===2||a.cancelPendingCommit!==null)&&(Gi(a,0),vn(a,nt,ma,!1)),Ol(a,o),((kt&2)===0||a!==vt)&&(a===vt&&((kt&2)===0&&(Hr|=o),Mt===4&&vn(a,nt,ma,!1)),Ga(a))}function ev(a,r,o){if((kt&6)!==0)throw Error(i(327));var d=!o&&(r&60)===0&&(r&a.expiredLanes)===0||Tr(a,r),h=d?kS(a,r):cf(a,r,!0),g=d;do{if(h===0){Yi&&!d&&vn(a,r,0,!1);break}else if(h===6)vn(a,r,0,!gn);else{if(o=a.current.alternate,g&&!CS(o)){h=cf(a,r,!1),g=!1;continue}if(h===2){if(g=r,a.errorRecoveryDisabledLanes&g)var $=0;else $=a.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){r=$;e:{var F=a;h=fo;var ee=F.current.memoizedState.isDehydrated;if(ee&&(Gi(F,$).flags|=256),$=cf(F,$,!1),$!==2){if(Kh&&!ee){F.errorRecoveryDisabledLanes|=g,Hr|=g,h=4;break e}g=Va,Va=h,g!==null&&rf(g)}h=$}if(g=!1,h!==2)continue}}if(h===1){Gi(a,0),vn(a,r,0,!0);break}e:{switch(d=a,h){case 0:case 1:throw Error(i(345));case 4:if((r&4194176)===r){vn(d,r,ma,!gn);break e}break;case 2:Va=null;break;case 3:case 5:break;default:throw Error(i(329))}if(d.finishedWork=o,d.finishedLanes=r,(r&62914560)===r&&(g=tf+300-ve(),10<g)){if(vn(d,r,ma,!gn),tn(d,0)!==0)break e;d.timeoutHandle=wv(tv.bind(null,d,o,Va,Kc,ef,r,ma,Hr,Vi,gn,2,-0,0),g);break e}tv(d,o,Va,Kc,ef,r,ma,Hr,Vi,gn,0,-0,0)}}break}while(!0);Ga(a)}function rf(a){Va===null?Va=a:Va.push.apply(Va,a)}function tv(a,r,o,d,h,g,$,F,ee,ie,we,Ae,fe){var Se=r.subtreeFlags;if((Se&8192||(Se&16785408)===16785408)&&(bo={stylesheets:null,count:0,unsuspend:c1},Yy(r),r=u1(),r!==null)){a.cancelPendingCommit=r(ov.bind(null,a,o,d,h,$,F,ee,1,Ae,fe)),vn(a,g,$,!ie);return}ov(a,o,d,h,$,F,ee,we,Ae,fe)}function CS(a){for(var r=a;;){var o=r.tag;if((o===0||o===11||o===15)&&r.flags&16384&&(o=r.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var h=o[d],g=h.getSnapshot;h=h.value;try{if(!Ps(g(),h))return!1}catch{return!1}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function vn(a,r,o,d){r&=~Jh,r&=~Hr,a.suspendedLanes|=r,a.pingedLanes&=~r,d&&(a.warmLanes|=r),d=a.expirationTimes;for(var h=r;0<h;){var g=31-ke(h),$=1<<g;d[g]=-1,h&=~$}o!==0&&gp(a,o,r)}function ed(){return(kt&6)===0?(go(0),!1):!0}function lf(){if(et!==null){if(xt===0)var a=et.return;else a=et,dn=Fr=null,hh(a),Ri=null,Xl=0,a=et;for(;a!==null;)Ky(a.alternate,a),a=a.return;et=null}}function Gi(a,r){a.finishedWork=null,a.finishedLanes=0;var o=a.timeoutHandle;o!==-1&&(a.timeoutHandle=-1,GS(o)),o=a.cancelPendingCommit,o!==null&&(a.cancelPendingCommit=null,o()),lf(),vt=a,et=o=Zn(a.current,null),nt=r,xt=0,Ys=null,gn=!1,Yi=Tr(a,r),Kh=!1,Vi=ma=Jh=Hr=Wn=Mt=0,Va=fo=null,ef=!1,(r&8)!==0&&(r|=r&32);var d=a.entangledLanes;if(d!==0)for(a=a.entanglements,d&=r;0<d;){var h=31-ke(d),g=1<<h;r|=a[h],d&=~g}return yn=r,wc(),o}function sv(a,r){Ze=null,k.H=Ya,r===Gl?(r=yg(),xt=3):r===mg?(r=yg(),xt=4):xt=r===py?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Ys=r,et===null&&(Mt=1,Hc(a,la(r,a.current)))}function av(){var a=k.H;return k.H=Ya,a===null?Ya:a}function nv(){var a=k.A;return k.A=ES,a}function of(){Mt=4,gn||(nt&4194176)!==nt&&da.current!==null||(Yi=!0),(Wn&134217727)===0&&(Hr&134217727)===0||vt===null||vn(vt,nt,ma,!1)}function cf(a,r,o){var d=kt;kt|=2;var h=av(),g=nv();(vt!==a||nt!==r)&&(Kc=null,Gi(a,r)),r=!1;var $=Mt;e:do try{if(xt!==0&&et!==null){var F=et,ee=Ys;switch(xt){case 8:lf(),$=6;break e;case 3:case 2:case 6:da.current===null&&(r=!0);var ie=xt;if(xt=0,Ys=null,Qi(a,F,ee,ie),o&&Yi){$=0;break e}break;default:ie=xt,xt=0,Ys=null,Qi(a,F,ee,ie)}}DS(),$=Mt;break}catch(we){sv(a,we)}while(!0);return r&&a.shellSuspendCounter++,dn=Fr=null,kt=d,k.H=h,k.A=g,et===null&&(vt=null,nt=0,wc()),$}function DS(){for(;et!==null;)rv(et)}function kS(a,r){var o=kt;kt|=2;var d=av(),h=nv();vt!==a||nt!==r?(Kc=null,Wc=ve()+500,Gi(a,r)):Yi=Tr(a,r);e:do try{if(xt!==0&&et!==null){r=et;var g=Ys;t:switch(xt){case 1:xt=0,Ys=null,Qi(a,r,g,1);break;case 2:if(pg(g)){xt=0,Ys=null,iv(r);break}r=function(){xt===2&&vt===a&&(xt=7),Ga(a)},g.then(r,r);break e;case 3:xt=7;break e;case 4:xt=5;break e;case 7:pg(g)?(xt=0,Ys=null,iv(r)):(xt=0,Ys=null,Qi(a,r,g,7));break;case 5:var $=null;switch(et.tag){case 26:$=et.memoizedState;case 5:case 27:var F=et;if(!$||Rv($)){xt=0,Ys=null;var ee=F.sibling;if(ee!==null)et=ee;else{var ie=F.return;ie!==null?(et=ie,td(ie)):et=null}break t}}xt=0,Ys=null,Qi(a,r,g,5);break;case 6:xt=0,Ys=null,Qi(a,r,g,6);break;case 8:lf(),Mt=6;break e;default:throw Error(i(462))}}_S();break}catch(we){sv(a,we)}while(!0);return dn=Fr=null,k.H=d,k.A=h,kt=o,et!==null?0:(vt=null,nt=0,wc(),Mt)}function _S(){for(;et!==null&&!V();)rv(et)}function rv(a){var r=Ay(a.alternate,a,yn);a.memoizedProps=a.pendingProps,r===null?td(a):et=r}function iv(a){var r=a,o=r.alternate;switch(r.tag){case 15:case 0:r=by(o,r,r.pendingProps,r.type,void 0,nt);break;case 11:r=by(o,r,r.pendingProps,r.type.render,r.ref,nt);break;case 5:hh(r);default:Ky(o,r),r=et=Xy(r,yn),r=Ay(o,r,yn)}a.memoizedProps=a.pendingProps,r===null?td(a):et=r}function Qi(a,r,o,d){dn=Fr=null,hh(r),Ri=null,Xl=0;var h=r.return;try{if(xS(a,h,r,o,nt)){Mt=1,Hc(a,la(o,a.current)),et=null;return}}catch(g){if(h!==null)throw et=h,g;Mt=1,Hc(a,la(o,a.current)),et=null;return}r.flags&32768?(rt||d===1?a=!0:Yi||(nt&536870912)!==0?a=!1:(gn=a=!0,(d===2||d===3||d===6)&&(d=da.current,d!==null&&d.tag===13&&(d.flags|=16384))),lv(r,a)):td(r)}function td(a){var r=a;do{if((r.flags&32768)!==0){lv(r,gn);return}a=r.return;var o=wS(r.alternate,r,yn);if(o!==null){et=o;return}if(r=r.sibling,r!==null){et=r;return}et=r=a}while(r!==null);Mt===0&&(Mt=5)}function lv(a,r){do{var o=TS(a.alternate,a);if(o!==null){o.flags&=32767,et=o;return}if(o=a.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!r&&(a=a.sibling,a!==null)){et=a;return}et=a=o}while(a!==null);Mt=6,et=null}function ov(a,r,o,d,h,g,$,F,ee,ie){var we=k.T,Ae=H.p;try{H.p=2,k.T=null,OS(a,r,o,d,Ae,h,g,$,F,ee,ie)}finally{k.T=we,H.p=Ae}}function OS(a,r,o,d,h,g,$,F){do Xi();while(Yr!==null);if((kt&6)!==0)throw Error(i(327));var ee=a.finishedWork;if(d=a.finishedLanes,ee===null)return null;if(a.finishedWork=null,a.finishedLanes=0,ee===a.current)throw Error(i(177));a.callbackNode=null,a.callbackPriority=0,a.cancelPendingCommit=null;var ie=ee.lanes|ee.childLanes;if(ie|=Wu,dN(a,d,ie,g,$,F),a===vt&&(et=vt=null,nt=0),(ee.subtreeFlags&10256)===0&&(ee.flags&10256)===0||Jc||(Jc=!0,sf=ie,af=o,MS(Ue,function(){return Xi(),null})),o=(ee.flags&15990)!==0,(ee.subtreeFlags&15990)!==0||o?(o=k.T,k.T=null,g=H.p,H.p=2,$=kt,kt|=4,bS(a,ee),Py(ee,a),sS(bf,a.containerInfo),fd=!!jf,bf=jf=null,a.current=ee,Ly(a,ee.alternate,ee),ue(),kt=$,H.p=g,k.T=o):a.current=ee,Jc?(Jc=!1,Yr=a,mo=d):cv(a,ie),ie=a.pendingLanes,ie===0&&(Kn=null),xi(ee.stateNode),Ga(a),r!==null)for(h=a.onRecoverableError,ee=0;ee<r.length;ee++)ie=r[ee],h(ie.value,{componentStack:ie.stack});return(mo&3)!==0&&Xi(),ie=a.pendingLanes,(d&4194218)!==0&&(ie&42)!==0?a===nf?po++:(po=0,nf=a):po=0,go(0),null}function cv(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,Wl(r)))}function Xi(){if(Yr!==null){var a=Yr,r=sf;sf=0;var o=vp(mo),d=k.T,h=H.p;try{if(H.p=32>o?32:o,k.T=null,Yr===null)var g=!1;else{o=af,af=null;var $=Yr,F=mo;if(Yr=null,mo=0,(kt&6)!==0)throw Error(i(331));var ee=kt;if(kt|=4,Gy($.current),Hy($,$.current,F,o),kt=ee,go(0,!1),yt&&typeof yt.onPostCommitFiberRoot=="function")try{yt.onPostCommitFiberRoot(Pt,$)}catch{}g=!0}return g}finally{H.p=h,k.T=d,cv(a,r)}}return!1}function dv(a,r,o){r=la(o,r),r=Eh(a.stateNode,r,2),a=Vn(a,r,2),a!==null&&(Ol(a,2),Ga(a))}function pt(a,r,o){if(a.tag===3)dv(a,a,o);else for(;r!==null;){if(r.tag===3){dv(r,a,o);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Kn===null||!Kn.has(d))){a=la(o,a),o=fy(2),d=Vn(r,o,2),d!==null&&(my(o,d,r,a),Ol(d,2),Ga(d));break}}r=r.return}}function df(a,r,o){var d=a.pingCache;if(d===null){d=a.pingCache=new AS;var h=new Set;d.set(r,h)}else h=d.get(r),h===void 0&&(h=new Set,d.set(r,h));h.has(o)||(Kh=!0,h.add(o),a=IS.bind(null,a,r,o),r.then(a,a))}function IS(a,r,o){var d=a.pingCache;d!==null&&d.delete(r),a.pingedLanes|=a.suspendedLanes&o,a.warmLanes&=~o,vt===a&&(nt&o)===o&&(Mt===4||Mt===3&&(nt&62914560)===nt&&300>ve()-tf?(kt&2)===0&&Gi(a,0):Jh|=o,Vi===nt&&(Vi=0)),Ga(a)}function uv(a,r){r===0&&(r=hc()),a=Ln(a,r),a!==null&&(Ol(a,r),Ga(a))}function $S(a){var r=a.memoizedState,o=0;r!==null&&(o=r.retryLane),uv(a,o)}function RS(a,r){var o=0;switch(a.tag){case 13:var d=a.stateNode,h=a.memoizedState;h!==null&&(o=h.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(r),uv(a,o)}function MS(a,r){return Te(a,r)}var sd=null,Zi=null,uf=!1,ad=!1,hf=!1,Vr=0;function Ga(a){a!==Zi&&a.next===null&&(Zi===null?sd=Zi=a:Zi=Zi.next=a),ad=!0,uf||(uf=!0,LS(zS))}function go(a,r){if(!hf&&ad){hf=!0;do for(var o=!1,d=sd;d!==null;){if(a!==0){var h=d.pendingLanes;if(h===0)var g=0;else{var $=d.suspendedLanes,F=d.pingedLanes;g=(1<<31-ke(42|a)+1)-1,g&=h&~($&~F),g=g&201326677?g&201326677|1:g?g|2:0}g!==0&&(o=!0,mv(d,g))}else g=nt,g=tn(d,d===vt?g:0),(g&3)===0||Tr(d,g)||(o=!0,mv(d,g));d=d.next}while(o);hf=!1}}function zS(){ad=uf=!1;var a=0;Vr!==0&&(VS()&&(a=Vr),Vr=0);for(var r=ve(),o=null,d=sd;d!==null;){var h=d.next,g=hv(d,r);g===0?(d.next=null,o===null?sd=h:o.next=h,h===null&&(Zi=o)):(o=d,(a!==0||(g&3)!==0)&&(ad=!0)),d=h}go(a)}function hv(a,r){for(var o=a.suspendedLanes,d=a.pingedLanes,h=a.expirationTimes,g=a.pendingLanes&-62914561;0<g;){var $=31-ke(g),F=1<<$,ee=h[$];ee===-1?((F&o)===0||(F&d)!==0)&&(h[$]=dc(F,r)):ee<=r&&(a.expiredLanes|=F),g&=~F}if(r=vt,o=nt,o=tn(a,a===r?o:0),d=a.callbackNode,o===0||a===r&&xt===2||a.cancelPendingCommit!==null)return d!==null&&d!==null&&Be(d),a.callbackNode=null,a.callbackPriority=0;if((o&3)===0||Tr(a,o)){if(r=o&-o,r===a.callbackPriority)return r;switch(d!==null&&Be(d),vp(o)){case 2:case 8:o=Ie;break;case 32:o=Ue;break;case 268435456:o=qe;break;default:o=Ue}return d=fv.bind(null,a),o=Te(o,d),a.callbackPriority=r,a.callbackNode=o,r}return d!==null&&d!==null&&Be(d),a.callbackPriority=2,a.callbackNode=null,2}function fv(a,r){var o=a.callbackNode;if(Xi()&&a.callbackNode!==o)return null;var d=nt;return d=tn(a,a===vt?d:0),d===0?null:(ev(a,d,r),hv(a,ve()),a.callbackNode!=null&&a.callbackNode===o?fv.bind(null,a):null)}function mv(a,r){if(Xi())return null;ev(a,r,!0)}function LS(a){QS(function(){(kt&6)!==0?Te(_e,a):a()})}function ff(){return Vr===0&&(Vr=uc()),Vr}function pv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:yc(""+a)}function gv(a,r){var o=r.ownerDocument.createElement("input");return o.name=r.name,o.value=r.value,a.id&&o.setAttribute("form",a.id),r.parentNode.insertBefore(o,r),a=new FormData(a),o.parentNode.removeChild(o),a}function BS(a,r,o,d,h){if(r==="submit"&&o&&o.stateNode===h){var g=pv((h[ks]||null).action),$=d.submitter;$&&(r=(r=$[ks]||null)?pv(r.formAction):$.getAttribute("formAction"),r!==null&&(g=r,$=null));var F=new bc("action","action",null,d,h);a.push({event:F,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Vr!==0){var ee=$?gv(h,$):new FormData(h);bh(o,{pending:!0,data:ee,method:h.method,action:g},null,ee)}}else typeof g=="function"&&(F.preventDefault(),ee=$?gv(h,$):new FormData(h),bh(o,{pending:!0,data:ee,method:h.method,action:g},g,ee))},currentTarget:h}]})}}for(var mf=0;mf<og.length;mf++){var pf=og[mf],FS=pf.toLowerCase(),US=pf[0].toUpperCase()+pf.slice(1);wa(FS,"on"+US)}wa(ag,"onAnimationEnd"),wa(ng,"onAnimationIteration"),wa(rg,"onAnimationStart"),wa("dblclick","onDoubleClick"),wa("focusin","onFocus"),wa("focusout","onBlur"),wa(nS,"onTransitionRun"),wa(rS,"onTransitionStart"),wa(iS,"onTransitionCancel"),wa(ig,"onTransitionEnd"),Si("onMouseEnter",["mouseout","mouseover"]),Si("onMouseLeave",["mouseout","mouseover"]),Si("onPointerEnter",["pointerout","pointerover"]),Si("onPointerLeave",["pointerout","pointerover"]),Ar("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ar("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ar("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ar("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ar("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ar("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yo));function yv(a,r){r=(r&4)!==0;for(var o=0;o<a.length;o++){var d=a[o],h=d.event;d=d.listeners;e:{var g=void 0;if(r)for(var $=d.length-1;0<=$;$--){var F=d[$],ee=F.instance,ie=F.currentTarget;if(F=F.listener,ee!==g&&h.isPropagationStopped())break e;g=F,h.currentTarget=ie;try{g(h)}catch(we){qc(we)}h.currentTarget=null,g=ee}else for($=0;$<d.length;$++){if(F=d[$],ee=F.instance,ie=F.currentTarget,F=F.listener,ee!==g&&h.isPropagationStopped())break e;g=F,h.currentTarget=ie;try{g(h)}catch(we){qc(we)}h.currentTarget=null,g=ee}}}}function st(a,r){var o=r[ku];o===void 0&&(o=r[ku]=new Set);var d=a+"__bubble";o.has(d)||(vv(r,a,2,!1),o.add(d))}function gf(a,r,o){var d=0;r&&(d|=4),vv(o,a,d,r)}var nd="_reactListening"+Math.random().toString(36).slice(2);function yf(a){if(!a[nd]){a[nd]=!0,bp.forEach(function(o){o!=="selectionchange"&&(PS.has(o)||gf(o,!1,a),gf(o,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[nd]||(r[nd]=!0,gf("selectionchange",!1,r))}}function vv(a,r,o,d){switch(Uv(r)){case 2:var h=m1;break;case 8:h=p1;break;default:h=kf}o=h.bind(null,r,o,a),h=void 0,!Lu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(h=!0),d?h!==void 0?a.addEventListener(r,o,{capture:!0,passive:h}):a.addEventListener(r,o,!0):h!==void 0?a.addEventListener(r,o,{passive:h}):a.addEventListener(r,o,!1)}function vf(a,r,o,d,h){var g=d;if((r&1)===0&&(r&2)===0&&d!==null)e:for(;;){if(d===null)return;var $=d.tag;if($===3||$===4){var F=d.stateNode.containerInfo;if(F===h||F.nodeType===8&&F.parentNode===h)break;if($===4)for($=d.return;$!==null;){var ee=$.tag;if((ee===3||ee===4)&&(ee=$.stateNode.containerInfo,ee===h||ee.nodeType===8&&ee.parentNode===h))return;$=$.return}for(;F!==null;){if($=Er(F),$===null)return;if(ee=$.tag,ee===5||ee===6||ee===26||ee===27){d=g=$;continue e}F=F.parentNode}}d=d.return}Ip(function(){var ie=g,we=Mu(o),Ae=[];e:{var fe=lg.get(a);if(fe!==void 0){var Se=bc,Fe=a;switch(a){case"keypress":if(xc(o)===0)break e;case"keydown":case"keyup":Se=RN;break;case"focusin":Fe="focus",Se=Pu;break;case"focusout":Fe="blur",Se=Pu;break;case"beforeblur":case"afterblur":Se=Pu;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=Mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=SN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=LN;break;case ag:case ng:case rg:Se=EN;break;case ig:Se=FN;break;case"scroll":case"scrollend":Se=bN;break;case"wheel":Se=PN;break;case"copy":case"cut":case"paste":Se=CN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=Lp;break;case"toggle":case"beforetoggle":Se=HN}var Ge=(r&4)!==0,zt=!Ge&&(a==="scroll"||a==="scrollend"),de=Ge?fe!==null?fe+"Capture":null:fe;Ge=[];for(var re=ie,he;re!==null;){var Ee=re;if(he=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||he===null||de===null||(Ee=Rl(re,de),Ee!=null&&Ge.push(vo(re,Ee,he))),zt)break;re=re.return}0<Ge.length&&(fe=new Se(fe,Fe,null,o,we),Ae.push({event:fe,listeners:Ge}))}}if((r&7)===0){e:{if(fe=a==="mouseover"||a==="pointerover",Se=a==="mouseout"||a==="pointerout",fe&&o!==Ru&&(Fe=o.relatedTarget||o.fromElement)&&(Er(Fe)||Fe[ji]))break e;if((Se||fe)&&(fe=we.window===we?we:(fe=we.ownerDocument)?fe.defaultView||fe.parentWindow:window,Se?(Fe=o.relatedTarget||o.toElement,Se=ie,Fe=Fe?Er(Fe):null,Fe!==null&&(zt=K(Fe),Ge=Fe.tag,Fe!==zt||Ge!==5&&Ge!==27&&Ge!==6)&&(Fe=null)):(Se=null,Fe=ie),Se!==Fe)){if(Ge=Mp,Ee="onMouseLeave",de="onMouseEnter",re="mouse",(a==="pointerout"||a==="pointerover")&&(Ge=Lp,Ee="onPointerLeave",de="onPointerEnter",re="pointer"),zt=Se==null?fe:$l(Se),he=Fe==null?fe:$l(Fe),fe=new Ge(Ee,re+"leave",Se,o,we),fe.target=zt,fe.relatedTarget=he,Ee=null,Er(we)===ie&&(Ge=new Ge(de,re+"enter",Fe,o,we),Ge.target=he,Ge.relatedTarget=zt,Ee=Ge),zt=Ee,Se&&Fe)t:{for(Ge=Se,de=Fe,re=0,he=Ge;he;he=Wi(he))re++;for(he=0,Ee=de;Ee;Ee=Wi(Ee))he++;for(;0<re-he;)Ge=Wi(Ge),re--;for(;0<he-re;)de=Wi(de),he--;for(;re--;){if(Ge===de||de!==null&&Ge===de.alternate)break t;Ge=Wi(Ge),de=Wi(de)}Ge=null}else Ge=null;Se!==null&&xv(Ae,fe,Se,Ge,!1),Fe!==null&&zt!==null&&xv(Ae,zt,Fe,Ge,!0)}}e:{if(fe=ie?$l(ie):window,Se=fe.nodeName&&fe.nodeName.toLowerCase(),Se==="select"||Se==="input"&&fe.type==="file")var Re=Vp;else if(Hp(fe))if(Gp)Re=eS;else{Re=KN;var We=WN}else Se=fe.nodeName,!Se||Se.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?ie&&$u(ie.elementType)&&(Re=Vp):Re=JN;if(Re&&(Re=Re(a,ie))){Yp(Ae,Re,o,we);break e}We&&We(a,fe,ie),a==="focusout"&&ie&&fe.type==="number"&&ie.memoizedProps.value!=null&&Iu(fe,"number",fe.value)}switch(We=ie?$l(ie):window,a){case"focusin":(Hp(We)||We.contentEditable==="true")&&(Di=We,Qu=ie,ql=null);break;case"focusout":ql=Qu=Di=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,tg(Ae,o,we);break;case"selectionchange":if(aS)break;case"keydown":case"keyup":tg(Ae,o,we)}var Pe;if(Hu)e:{switch(a){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else Ci?Pp(a,o)&&(He="onCompositionEnd"):a==="keydown"&&o.keyCode===229&&(He="onCompositionStart");He&&(Bp&&o.locale!=="ko"&&(Ci||He!=="onCompositionStart"?He==="onCompositionEnd"&&Ci&&(Pe=$p()):(zn=we,Bu="value"in zn?zn.value:zn.textContent,Ci=!0)),We=rd(ie,He),0<We.length&&(He=new zp(He,a,null,o,we),Ae.push({event:He,listeners:We}),Pe?He.data=Pe:(Pe=qp(o),Pe!==null&&(He.data=Pe)))),(Pe=VN?GN(a,o):QN(a,o))&&(He=rd(ie,"onBeforeInput"),0<He.length&&(We=new zp("onBeforeInput","beforeinput",null,o,we),Ae.push({event:We,listeners:He}),We.data=Pe)),BS(Ae,a,ie,o,we)}yv(Ae,r)})}function vo(a,r,o){return{instance:a,listener:r,currentTarget:o}}function rd(a,r){for(var o=r+"Capture",d=[];a!==null;){var h=a,g=h.stateNode;h=h.tag,h!==5&&h!==26&&h!==27||g===null||(h=Rl(a,o),h!=null&&d.unshift(vo(a,h,g)),h=Rl(a,r),h!=null&&d.push(vo(a,h,g))),a=a.return}return d}function Wi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function xv(a,r,o,d,h){for(var g=r._reactName,$=[];o!==null&&o!==d;){var F=o,ee=F.alternate,ie=F.stateNode;if(F=F.tag,ee!==null&&ee===d)break;F!==5&&F!==26&&F!==27||ie===null||(ee=ie,h?(ie=Rl(o,g),ie!=null&&$.unshift(vo(o,ie,ee))):h||(ie=Rl(o,g),ie!=null&&$.push(vo(o,ie,ee)))),o=o.return}$.length!==0&&a.push({event:r,listeners:$})}var qS=/\r\n?/g,HS=/\u0000|\uFFFD/g;function jv(a){return(typeof a=="string"?a:""+a).replace(qS,`
`).replace(HS,"")}function bv(a,r){return r=jv(r),jv(a)===r}function id(){}function ft(a,r,o,d,h,g){switch(o){case"children":typeof d=="string"?r==="body"||r==="textarea"&&d===""||Ti(a,d):(typeof d=="number"||typeof d=="bigint")&&r!=="body"&&Ti(a,""+d);break;case"className":mc(a,"class",d);break;case"tabIndex":mc(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":mc(a,o,d);break;case"style":_p(a,d,g);break;case"data":if(r!=="object"){mc(a,"data",d);break}case"src":case"href":if(d===""&&(r!=="a"||o!=="href")){a.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(o);break}d=yc(""+d),a.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){a.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(o==="formAction"?(r!=="input"&&ft(a,r,"name",h.name,h,null),ft(a,r,"formEncType",h.formEncType,h,null),ft(a,r,"formMethod",h.formMethod,h,null),ft(a,r,"formTarget",h.formTarget,h,null)):(ft(a,r,"encType",h.encType,h,null),ft(a,r,"method",h.method,h,null),ft(a,r,"target",h.target,h,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(o);break}d=yc(""+d),a.setAttribute(o,d);break;case"onClick":d!=null&&(a.onclick=id);break;case"onScroll":d!=null&&st("scroll",a);break;case"onScrollEnd":d!=null&&st("scrollend",a);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(h.children!=null)throw Error(i(60));a.innerHTML=o}}break;case"multiple":a.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":a.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){a.removeAttribute("xlink:href");break}o=yc(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,""+d):a.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,""):a.removeAttribute(o);break;case"capture":case"download":d===!0?a.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(o,d):a.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?a.setAttribute(o,d):a.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?a.removeAttribute(o):a.setAttribute(o,d);break;case"popover":st("beforetoggle",a),st("toggle",a),fc(a,"popover",d);break;case"xlinkActuate":an(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":an(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":an(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":an(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":an(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":an(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":an(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":an(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":an(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":fc(a,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=xN.get(o)||o,fc(a,o,d))}}function xf(a,r,o,d,h,g){switch(o){case"style":_p(a,d,g);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(h.children!=null)throw Error(i(60));a.innerHTML=o}}break;case"children":typeof d=="string"?Ti(a,d):(typeof d=="number"||typeof d=="bigint")&&Ti(a,""+d);break;case"onScroll":d!=null&&st("scroll",a);break;case"onScrollEnd":d!=null&&st("scrollend",a);break;case"onClick":d!=null&&(a.onclick=id);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Np.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(h=o.endsWith("Capture"),r=o.slice(2,h?o.length-7:void 0),g=a[ks]||null,g=g!=null?g[o]:null,typeof g=="function"&&a.removeEventListener(r,g,h),typeof d=="function")){typeof g!="function"&&g!==null&&(o in a?a[o]=null:a.hasAttribute(o)&&a.removeAttribute(o)),a.addEventListener(r,d,h);break e}o in a?a[o]=d:d===!0?a.setAttribute(o,""):fc(a,o,d)}}}function ds(a,r,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",a),st("load",a);var d=!1,h=!1,g;for(g in o)if(o.hasOwnProperty(g)){var $=o[g];if($!=null)switch(g){case"src":d=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ft(a,r,g,$,o,null)}}h&&ft(a,r,"srcSet",o.srcSet,o,null),d&&ft(a,r,"src",o.src,o,null);return;case"input":st("invalid",a);var F=g=$=h=null,ee=null,ie=null;for(d in o)if(o.hasOwnProperty(d)){var we=o[d];if(we!=null)switch(d){case"name":h=we;break;case"type":$=we;break;case"checked":ee=we;break;case"defaultChecked":ie=we;break;case"value":g=we;break;case"defaultValue":F=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(i(137,r));break;default:ft(a,r,d,we,o,null)}}Ap(a,g,F,ee,ie,$,h,!1),pc(a);return;case"select":st("invalid",a),d=$=g=null;for(h in o)if(o.hasOwnProperty(h)&&(F=o[h],F!=null))switch(h){case"value":g=F;break;case"defaultValue":$=F;break;case"multiple":d=F;default:ft(a,r,h,F,o,null)}r=g,o=$,a.multiple=!!d,r!=null?wi(a,!!d,r,!1):o!=null&&wi(a,!!d,o,!0);return;case"textarea":st("invalid",a),g=h=d=null;for($ in o)if(o.hasOwnProperty($)&&(F=o[$],F!=null))switch($){case"value":d=F;break;case"defaultValue":h=F;break;case"children":g=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(i(91));break;default:ft(a,r,$,F,o,null)}Dp(a,d,h,g),pc(a);return;case"option":for(ee in o)if(o.hasOwnProperty(ee)&&(d=o[ee],d!=null))switch(ee){case"selected":a.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:ft(a,r,ee,d,o,null)}return;case"dialog":st("cancel",a),st("close",a);break;case"iframe":case"object":st("load",a);break;case"video":case"audio":for(d=0;d<yo.length;d++)st(yo[d],a);break;case"image":st("error",a),st("load",a);break;case"details":st("toggle",a);break;case"embed":case"source":case"link":st("error",a),st("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in o)if(o.hasOwnProperty(ie)&&(d=o[ie],d!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ft(a,r,ie,d,o,null)}return;default:if($u(r)){for(we in o)o.hasOwnProperty(we)&&(d=o[we],d!==void 0&&xf(a,r,we,d,o,void 0));return}}for(F in o)o.hasOwnProperty(F)&&(d=o[F],d!=null&&ft(a,r,F,d,o,null))}function YS(a,r,o,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,g=null,$=null,F=null,ee=null,ie=null,we=null;for(Se in o){var Ae=o[Se];if(o.hasOwnProperty(Se)&&Ae!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":ee=Ae;default:d.hasOwnProperty(Se)||ft(a,r,Se,null,d,Ae)}}for(var fe in d){var Se=d[fe];if(Ae=o[fe],d.hasOwnProperty(fe)&&(Se!=null||Ae!=null))switch(fe){case"type":g=Se;break;case"name":h=Se;break;case"checked":ie=Se;break;case"defaultChecked":we=Se;break;case"value":$=Se;break;case"defaultValue":F=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(i(137,r));break;default:Se!==Ae&&ft(a,r,fe,Se,d,Ae)}}Ou(a,$,F,ee,ie,we,g,h);return;case"select":Se=$=F=fe=null;for(g in o)if(ee=o[g],o.hasOwnProperty(g)&&ee!=null)switch(g){case"value":break;case"multiple":Se=ee;default:d.hasOwnProperty(g)||ft(a,r,g,null,d,ee)}for(h in d)if(g=d[h],ee=o[h],d.hasOwnProperty(h)&&(g!=null||ee!=null))switch(h){case"value":fe=g;break;case"defaultValue":F=g;break;case"multiple":$=g;default:g!==ee&&ft(a,r,h,g,d,ee)}r=F,o=$,d=Se,fe!=null?wi(a,!!o,fe,!1):!!d!=!!o&&(r!=null?wi(a,!!o,r,!0):wi(a,!!o,o?[]:"",!1));return;case"textarea":Se=fe=null;for(F in o)if(h=o[F],o.hasOwnProperty(F)&&h!=null&&!d.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:ft(a,r,F,null,d,h)}for($ in d)if(h=d[$],g=o[$],d.hasOwnProperty($)&&(h!=null||g!=null))switch($){case"value":fe=h;break;case"defaultValue":Se=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(i(91));break;default:h!==g&&ft(a,r,$,h,d,g)}Cp(a,fe,Se);return;case"option":for(var Fe in o)if(fe=o[Fe],o.hasOwnProperty(Fe)&&fe!=null&&!d.hasOwnProperty(Fe))switch(Fe){case"selected":a.selected=!1;break;default:ft(a,r,Fe,null,d,fe)}for(ee in d)if(fe=d[ee],Se=o[ee],d.hasOwnProperty(ee)&&fe!==Se&&(fe!=null||Se!=null))switch(ee){case"selected":a.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:ft(a,r,ee,fe,d,Se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in o)fe=o[Ge],o.hasOwnProperty(Ge)&&fe!=null&&!d.hasOwnProperty(Ge)&&ft(a,r,Ge,null,d,fe);for(ie in d)if(fe=d[ie],Se=o[ie],d.hasOwnProperty(ie)&&fe!==Se&&(fe!=null||Se!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,r));break;default:ft(a,r,ie,fe,d,Se)}return;default:if($u(r)){for(var zt in o)fe=o[zt],o.hasOwnProperty(zt)&&fe!==void 0&&!d.hasOwnProperty(zt)&&xf(a,r,zt,void 0,d,fe);for(we in d)fe=d[we],Se=o[we],!d.hasOwnProperty(we)||fe===Se||fe===void 0&&Se===void 0||xf(a,r,we,fe,d,Se);return}}for(var de in o)fe=o[de],o.hasOwnProperty(de)&&fe!=null&&!d.hasOwnProperty(de)&&ft(a,r,de,null,d,fe);for(Ae in d)fe=d[Ae],Se=o[Ae],!d.hasOwnProperty(Ae)||fe===Se||fe==null&&Se==null||ft(a,r,Ae,fe,d,Se)}var jf=null,bf=null;function ld(a){return a.nodeType===9?a:a.ownerDocument}function Nv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sv(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function Nf(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Sf=null;function VS(){var a=window.event;return a&&a.type==="popstate"?a===Sf?!1:(Sf=a,!0):(Sf=null,!1)}var wv=typeof setTimeout=="function"?setTimeout:void 0,GS=typeof clearTimeout=="function"?clearTimeout:void 0,Tv=typeof Promise=="function"?Promise:void 0,QS=typeof queueMicrotask=="function"?queueMicrotask:typeof Tv<"u"?function(a){return Tv.resolve(null).then(a).catch(XS)}:wv;function XS(a){setTimeout(function(){throw a})}function wf(a,r){var o=r,d=0;do{var h=o.nextSibling;if(a.removeChild(o),h&&h.nodeType===8)if(o=h.data,o==="/$"){if(d===0){a.removeChild(h),Eo(r);return}d--}else o!=="$"&&o!=="$?"&&o!=="$!"||d++;o=h}while(o);Eo(r)}function Tf(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var o=r;switch(r=r.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Tf(o),_u(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}a.removeChild(o)}}function ZS(a,r,o,d){for(;a.nodeType===1;){var h=o;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!d&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(d){if(!a[Il])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(g=a.getAttribute("rel"),g==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(g!==h.rel||a.getAttribute("href")!==(h.href==null?null:h.href)||a.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||a.getAttribute("title")!==(h.title==null?null:h.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(g=a.getAttribute("src"),(g!==(h.src==null?null:h.src)||a.getAttribute("type")!==(h.type==null?null:h.type)||a.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&g&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var g=h.name==null?null:""+h.name;if(h.type==="hidden"&&a.getAttribute("name")===g)return a}else return a;if(a=Aa(a.nextSibling),a===null)break}return null}function WS(a,r,o){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Aa(a.nextSibling),a===null))return null;return a}function Aa(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return a}function Ev(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var o=a.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return a;r--}else o==="/$"&&r++}a=a.previousSibling}return null}function Av(a,r,o){switch(r=ld(o),a){case"html":if(a=r.documentElement,!a)throw Error(i(452));return a;case"head":if(a=r.head,!a)throw Error(i(453));return a;case"body":if(a=r.body,!a)throw Error(i(454));return a;default:throw Error(i(451))}}var pa=new Map,Cv=new Set;function od(a){return typeof a.getRootNode=="function"?a.getRootNode():a.ownerDocument}var xn=H.d;H.d={f:KS,r:JS,D:e1,C:t1,L:s1,m:a1,X:r1,S:n1,M:i1};function KS(){var a=xn.f(),r=ed();return a||r}function JS(a){var r=bi(a);r!==null&&r.tag===5&&r.type==="form"?ty(r):xn.r(a)}var Ki=typeof document>"u"?null:document;function Dv(a,r,o){var d=Ki;if(d&&typeof r=="string"&&r){var h=ra(r);h='link[rel="'+a+'"][href="'+h+'"]',typeof o=="string"&&(h+='[crossorigin="'+o+'"]'),Cv.has(h)||(Cv.add(h),a={rel:a,crossOrigin:o,href:r},d.querySelector(h)===null&&(r=d.createElement("link"),ds(r,"link",a),ss(r),d.head.appendChild(r)))}}function e1(a){xn.D(a),Dv("dns-prefetch",a,null)}function t1(a,r){xn.C(a,r),Dv("preconnect",a,r)}function s1(a,r,o){xn.L(a,r,o);var d=Ki;if(d&&a&&r){var h='link[rel="preload"][as="'+ra(r)+'"]';r==="image"&&o&&o.imageSrcSet?(h+='[imagesrcset="'+ra(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(h+='[imagesizes="'+ra(o.imageSizes)+'"]')):h+='[href="'+ra(a)+'"]';var g=h;switch(r){case"style":g=Ji(a);break;case"script":g=el(a)}pa.has(g)||(a=z({rel:"preload",href:r==="image"&&o&&o.imageSrcSet?void 0:a,as:r},o),pa.set(g,a),d.querySelector(h)!==null||r==="style"&&d.querySelector(xo(g))||r==="script"&&d.querySelector(jo(g))||(r=d.createElement("link"),ds(r,"link",a),ss(r),d.head.appendChild(r)))}}function a1(a,r){xn.m(a,r);var o=Ki;if(o&&a){var d=r&&typeof r.as=="string"?r.as:"script",h='link[rel="modulepreload"][as="'+ra(d)+'"][href="'+ra(a)+'"]',g=h;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=el(a)}if(!pa.has(g)&&(a=z({rel:"modulepreload",href:a},r),pa.set(g,a),o.querySelector(h)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(jo(g)))return}d=o.createElement("link"),ds(d,"link",a),ss(d),o.head.appendChild(d)}}}function n1(a,r,o){xn.S(a,r,o);var d=Ki;if(d&&a){var h=Ni(d).hoistableStyles,g=Ji(a);r=r||"default";var $=h.get(g);if(!$){var F={loading:0,preload:null};if($=d.querySelector(xo(g)))F.loading=5;else{a=z({rel:"stylesheet",href:a,"data-precedence":r},o),(o=pa.get(g))&&Ef(a,o);var ee=$=d.createElement("link");ss(ee),ds(ee,"link",a),ee._p=new Promise(function(ie,we){ee.onload=ie,ee.onerror=we}),ee.addEventListener("load",function(){F.loading|=1}),ee.addEventListener("error",function(){F.loading|=2}),F.loading|=4,cd($,r,d)}$={type:"stylesheet",instance:$,count:1,state:F},h.set(g,$)}}}function r1(a,r){xn.X(a,r);var o=Ki;if(o&&a){var d=Ni(o).hoistableScripts,h=el(a),g=d.get(h);g||(g=o.querySelector(jo(h)),g||(a=z({src:a,async:!0},r),(r=pa.get(h))&&Af(a,r),g=o.createElement("script"),ss(g),ds(g,"link",a),o.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},d.set(h,g))}}function i1(a,r){xn.M(a,r);var o=Ki;if(o&&a){var d=Ni(o).hoistableScripts,h=el(a),g=d.get(h);g||(g=o.querySelector(jo(h)),g||(a=z({src:a,async:!0,type:"module"},r),(r=pa.get(h))&&Af(a,r),g=o.createElement("script"),ss(g),ds(g,"link",a),o.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},d.set(h,g))}}function kv(a,r,o,d){var h=(h=ne.current)?od(h):null;if(!h)throw Error(i(446));switch(a){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(r=Ji(o.href),o=Ni(h).hoistableStyles,d=o.get(r),d||(d={type:"style",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){a=Ji(o.href);var g=Ni(h).hoistableStyles,$=g.get(a);if($||(h=h.ownerDocument||h,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(a,$),(g=h.querySelector(xo(a)))&&!g._p&&($.instance=g,$.state.loading=5),pa.has(a)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},pa.set(a,o),g||l1(h,a,o,$.state))),r&&d===null)throw Error(i(528,""));return $}if(r&&d!==null)throw Error(i(529,""));return null;case"script":return r=o.async,o=o.src,typeof o=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=el(o),o=Ni(h).hoistableScripts,d=o.get(r),d||(d={type:"script",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,a))}}function Ji(a){return'href="'+ra(a)+'"'}function xo(a){return'link[rel="stylesheet"]['+a+"]"}function _v(a){return z({},a,{"data-precedence":a.precedence,precedence:null})}function l1(a,r,o,d){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?d.loading=1:(r=a.createElement("link"),d.preload=r,r.addEventListener("load",function(){return d.loading|=1}),r.addEventListener("error",function(){return d.loading|=2}),ds(r,"link",o),ss(r),a.head.appendChild(r))}function el(a){return'[src="'+ra(a)+'"]'}function jo(a){return"script[async]"+a}function Ov(a,r,o){if(r.count++,r.instance===null)switch(r.type){case"style":var d=a.querySelector('style[data-href~="'+ra(o.href)+'"]');if(d)return r.instance=d,ss(d),d;var h=z({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(a.ownerDocument||a).createElement("style"),ss(d),ds(d,"style",h),cd(d,o.precedence,a),r.instance=d;case"stylesheet":h=Ji(o.href);var g=a.querySelector(xo(h));if(g)return r.state.loading|=4,r.instance=g,ss(g),g;d=_v(o),(h=pa.get(h))&&Ef(d,h),g=(a.ownerDocument||a).createElement("link"),ss(g);var $=g;return $._p=new Promise(function(F,ee){$.onload=F,$.onerror=ee}),ds(g,"link",d),r.state.loading|=4,cd(g,o.precedence,a),r.instance=g;case"script":return g=el(o.src),(h=a.querySelector(jo(g)))?(r.instance=h,ss(h),h):(d=o,(h=pa.get(g))&&(d=z({},o),Af(d,h)),a=a.ownerDocument||a,h=a.createElement("script"),ss(h),ds(h,"link",d),a.head.appendChild(h),r.instance=h);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(d=r.instance,r.state.loading|=4,cd(d,o.precedence,a));return r.instance}function cd(a,r,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=d.length?d[d.length-1]:null,g=h,$=0;$<d.length;$++){var F=d[$];if(F.dataset.precedence===r)g=F;else if(g!==h)break}g?g.parentNode.insertBefore(a,g.nextSibling):(r=o.nodeType===9?o.head:o,r.insertBefore(a,r.firstChild))}function Ef(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function Af(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var dd=null;function Iv(a,r,o){if(dd===null){var d=new Map,h=dd=new Map;h.set(o,d)}else h=dd,d=h.get(o),d||(d=new Map,h.set(o,d));if(d.has(a))return d;for(d.set(a,null),o=o.getElementsByTagName(a),h=0;h<o.length;h++){var g=o[h];if(!(g[Il]||g[vs]||a==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var $=g.getAttribute(r)||"";$=a+$;var F=d.get($);F?F.push(g):d.set($,[g])}}return d}function $v(a,r,o){a=a.ownerDocument||a,a.head.insertBefore(o,r==="title"?a.querySelector("head > title"):null)}function o1(a,r,o){if(o===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return a=r.disabled,typeof r.precedence=="string"&&a==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Rv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var bo=null;function c1(){}function d1(a,r,o){if(bo===null)throw Error(i(475));var d=bo;if(r.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var h=Ji(o.href),g=a.querySelector(xo(h));if(g){a=g._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(d.count++,d=ud.bind(d),a.then(d,d)),r.state.loading|=4,r.instance=g,ss(g);return}g=a.ownerDocument||a,o=_v(o),(h=pa.get(h))&&Ef(o,h),g=g.createElement("link"),ss(g);var $=g;$._p=new Promise(function(F,ee){$.onload=F,$.onerror=ee}),ds(g,"link",o),r.instance=g}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(r,a),(a=r.state.preload)&&(r.state.loading&3)===0&&(d.count++,r=ud.bind(d),a.addEventListener("load",r),a.addEventListener("error",r))}}function u1(){if(bo===null)throw Error(i(475));var a=bo;return a.stylesheets&&a.count===0&&Cf(a,a.stylesheets),0<a.count?function(r){var o=setTimeout(function(){if(a.stylesheets&&Cf(a,a.stylesheets),a.unsuspend){var d=a.unsuspend;a.unsuspend=null,d()}},6e4);return a.unsuspend=r,function(){a.unsuspend=null,clearTimeout(o)}}:null}function ud(){if(this.count--,this.count===0){if(this.stylesheets)Cf(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var hd=null;function Cf(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,hd=new Map,r.forEach(h1,a),hd=null,ud.call(a))}function h1(a,r){if(!(r.state.loading&4)){var o=hd.get(a);if(o)var d=o.get(null);else{o=new Map,hd.set(a,o);for(var h=a.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<h.length;g++){var $=h[g];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(o.set($.dataset.precedence,$),d=$)}d&&o.set(null,d)}h=r.instance,$=h.getAttribute("data-precedence"),g=o.get($)||d,g===d&&o.set(null,h),o.set($,h),this.count++,d=ud.bind(this),h.addEventListener("load",d),h.addEventListener("error",d),g?g.parentNode.insertBefore(h,g.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(h,a.firstChild)),r.state.loading|=4}}var No={$$typeof:N,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function f1(a,r,o,d,h,g,$,F){this.tag=1,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Du(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Du(0),this.hiddenUpdates=Du(null),this.identifierPrefix=d,this.onUncaughtError=h,this.onCaughtError=g,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=F,this.incompleteTransitions=new Map}function Mv(a,r,o,d,h,g,$,F,ee,ie,we,Ae){return a=new f1(a,r,o,$,F,ee,ie,Ae),r=1,g===!0&&(r|=24),g=fa(3,null,null,r),a.current=g,g.stateNode=a,r=rh(),r.refCount++,a.pooledCache=r,r.refCount++,g.memoizedState={element:d,isDehydrated:o,cache:r},Bh(g),a}function zv(a){return a?(a=Oi,a):Oi}function Lv(a,r,o,d,h,g){h=zv(h),d.context===null?d.context=h:d.pendingContext=h,d=Yn(r),d.payload={element:o},g=g===void 0?null:g,g!==null&&(d.callback=g),o=Vn(a,d,r),o!==null&&(Ts(o,a,r),no(o,a,r))}function Bv(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var o=a.retryLane;a.retryLane=o!==0&&o<r?o:r}}function Df(a,r){Bv(a,r),(a=a.alternate)&&Bv(a,r)}function Fv(a){if(a.tag===13){var r=Ln(a,67108864);r!==null&&Ts(r,a,67108864),Df(a,67108864)}}var fd=!0;function m1(a,r,o,d){var h=k.T;k.T=null;var g=H.p;try{H.p=2,kf(a,r,o,d)}finally{H.p=g,k.T=h}}function p1(a,r,o,d){var h=k.T;k.T=null;var g=H.p;try{H.p=8,kf(a,r,o,d)}finally{H.p=g,k.T=h}}function kf(a,r,o,d){if(fd){var h=_f(d);if(h===null)vf(a,r,d,md,o),Pv(a,d);else if(y1(h,a,r,o,d))d.stopPropagation();else if(Pv(a,d),r&4&&-1<g1.indexOf(a)){for(;h!==null;){var g=bi(h);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var $=aa(g.pendingLanes);if($!==0){var F=g;for(F.pendingLanes|=2,F.entangledLanes|=2;$;){var ee=1<<31-ke($);F.entanglements[1]|=ee,$&=~ee}Ga(g),(kt&6)===0&&(Wc=ve()+500,go(0))}}break;case 13:F=Ln(g,2),F!==null&&Ts(F,g,2),ed(),Df(g,2)}if(g=_f(d),g===null&&vf(a,r,d,md,o),g===h)break;h=g}h!==null&&d.stopPropagation()}else vf(a,r,d,null,o)}}function _f(a){return a=Mu(a),Of(a)}var md=null;function Of(a){if(md=null,a=Er(a),a!==null){var r=K(a);if(r===null)a=null;else{var o=r.tag;if(o===13){if(a=le(r),a!==null)return a;a=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return md=a,null}function Uv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case _e:return 2;case Ie:return 8;case Ue:case It:return 32;case qe:return 268435456;default:return 32}default:return 32}}var If=!1,Jn=null,er=null,tr=null,So=new Map,wo=new Map,sr=[],g1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pv(a,r){switch(a){case"focusin":case"focusout":Jn=null;break;case"dragenter":case"dragleave":er=null;break;case"mouseover":case"mouseout":tr=null;break;case"pointerover":case"pointerout":So.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(r.pointerId)}}function To(a,r,o,d,h,g){return a===null||a.nativeEvent!==g?(a={blockedOn:r,domEventName:o,eventSystemFlags:d,nativeEvent:g,targetContainers:[h]},r!==null&&(r=bi(r),r!==null&&Fv(r)),a):(a.eventSystemFlags|=d,r=a.targetContainers,h!==null&&r.indexOf(h)===-1&&r.push(h),a)}function y1(a,r,o,d,h){switch(r){case"focusin":return Jn=To(Jn,a,r,o,d,h),!0;case"dragenter":return er=To(er,a,r,o,d,h),!0;case"mouseover":return tr=To(tr,a,r,o,d,h),!0;case"pointerover":var g=h.pointerId;return So.set(g,To(So.get(g)||null,a,r,o,d,h)),!0;case"gotpointercapture":return g=h.pointerId,wo.set(g,To(wo.get(g)||null,a,r,o,d,h)),!0}return!1}function qv(a){var r=Er(a.target);if(r!==null){var o=K(r);if(o!==null){if(r=o.tag,r===13){if(r=le(o),r!==null){a.blockedOn=r,uN(a.priority,function(){if(o.tag===13){var d=Vs(),h=Ln(o,d);h!==null&&Ts(h,o,d),Df(o,d)}});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){a.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}a.blockedOn=null}function pd(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var o=_f(a.nativeEvent);if(o===null){o=a.nativeEvent;var d=new o.constructor(o.type,o);Ru=d,o.target.dispatchEvent(d),Ru=null}else return r=bi(o),r!==null&&Fv(r),a.blockedOn=o,!1;r.shift()}return!0}function Hv(a,r,o){pd(a)&&o.delete(r)}function v1(){If=!1,Jn!==null&&pd(Jn)&&(Jn=null),er!==null&&pd(er)&&(er=null),tr!==null&&pd(tr)&&(tr=null),So.forEach(Hv),wo.forEach(Hv)}function gd(a,r){a.blockedOn===r&&(a.blockedOn=null,If||(If=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,v1)))}var yd=null;function Yv(a){yd!==a&&(yd=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){yd===a&&(yd=null);for(var r=0;r<a.length;r+=3){var o=a[r],d=a[r+1],h=a[r+2];if(typeof d!="function"){if(Of(d||o)===null)continue;break}var g=bi(o);g!==null&&(a.splice(r,3),r-=3,bh(g,{pending:!0,data:h,method:o.method,action:d},d,h))}}))}function Eo(a){function r(ee){return gd(ee,a)}Jn!==null&&gd(Jn,a),er!==null&&gd(er,a),tr!==null&&gd(tr,a),So.forEach(r),wo.forEach(r);for(var o=0;o<sr.length;o++){var d=sr[o];d.blockedOn===a&&(d.blockedOn=null)}for(;0<sr.length&&(o=sr[0],o.blockedOn===null);)qv(o),o.blockedOn===null&&sr.shift();if(o=(a.ownerDocument||a).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var h=o[d],g=o[d+1],$=h[ks]||null;if(typeof g=="function")$||Yv(o);else if($){var F=null;if(g&&g.hasAttribute("formAction")){if(h=g,$=g[ks]||null)F=$.formAction;else if(Of(h)!==null)continue}else F=$.action;typeof F=="function"?o[d+1]=F:(o.splice(d,3),d-=3),Yv(o)}}}function $f(a){this._internalRoot=a}vd.prototype.render=$f.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(i(409));var o=r.current,d=Vs();Lv(o,d,a,r,null,null)},vd.prototype.unmount=$f.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;a.tag===0&&Xi(),Lv(a.current,2,null,a,null,null),ed(),r[ji]=null}};function vd(a){this._internalRoot=a}vd.prototype.unstable_scheduleHydration=function(a){if(a){var r=xp();a={blockedOn:null,target:a,priority:r};for(var o=0;o<sr.length&&r!==0&&r<sr[o].priority;o++);sr.splice(o,0,a),o===0&&qv(a)}};var Vv=s.version;if(Vv!=="19.0.0")throw Error(i(527,Vv,"19.0.0"));H.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(i(188)):(a=Object.keys(a).join(","),Error(i(268,a)));return a=U(r),a=a!==null?Y(a):null,a=a===null?null:a.stateNode,a};var x1={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:k,findFiberByHostInstance:Er,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xd.isDisabled&&xd.supportsFiber)try{Pt=xd.inject(x1),yt=xd}catch{}}return Co.createRoot=function(a,r){if(!l(a))throw Error(i(299));var o=!1,d="",h=cy,g=dy,$=uy,F=null;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onUncaughtError!==void 0&&(h=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&($=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(F=r.unstable_transitionCallbacks)),r=Mv(a,1,!1,null,null,o,d,h,g,$,F,null),a[ji]=r.current,yf(a.nodeType===8?a.parentNode:a),new $f(r)},Co.hydrateRoot=function(a,r,o){if(!l(a))throw Error(i(299));var d=!1,h="",g=cy,$=dy,F=uy,ee=null,ie=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&($=o.onCaughtError),o.onRecoverableError!==void 0&&(F=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(ee=o.unstable_transitionCallbacks),o.formState!==void 0&&(ie=o.formState)),r=Mv(a,1,!0,r,o??null,d,h,g,$,F,ee,ie),r.context=zv(null),o=r.current,d=Vs(),h=Yn(d),h.callback=null,Vn(o,h,d),r.current.lanes=d,Ol(r,d),Ga(r),a[ji]=r.current,yf(a),new vd(r)},Co.version="19.0.0",Co}var ax;function D1(){if(ax)return Lf.exports;ax=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),Lf.exports=C1(),Lf.exports}var k1=D1(),Do={},nx;function _1(){if(nx)return Do;nx=1,Object.defineProperty(Do,"__esModule",{value:!0}),Do.parse=u,Do.serialize=m;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,s=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,i=/^[\u0020-\u003A\u003D-\u007E]*$/,l=Object.prototype.toString,c=(()=>{const j=function(){};return j.prototype=Object.create(null),j})();function u(j,N){const b=new c,w=j.length;if(w<2)return b;const A=(N==null?void 0:N.decode)||y;let S=0;do{const C=j.indexOf("=",S);if(C===-1)break;const D=j.indexOf(";",S),I=D===-1?w:D;if(C>I){S=j.lastIndexOf(";",C-1)+1;continue}const T=f(j,S,C),R=p(j,C,T),E=j.slice(T,R);if(b[E]===void 0){let _=f(j,C+1,I),k=p(j,I,_);const z=A(j.slice(_,k));b[E]=z}S=I+1}while(S<w);return b}function f(j,N,b){do{const w=j.charCodeAt(N);if(w!==32&&w!==9)return N}while(++N<b);return b}function p(j,N,b){for(;N>b;){const w=j.charCodeAt(--N);if(w!==32&&w!==9)return N+1}return b}function m(j,N,b){const w=(b==null?void 0:b.encode)||encodeURIComponent;if(!t.test(j))throw new TypeError(`argument name is invalid: ${j}`);const A=w(N);if(!s.test(A))throw new TypeError(`argument val is invalid: ${N}`);let S=j+"="+A;if(!b)return S;if(b.maxAge!==void 0){if(!Number.isInteger(b.maxAge))throw new TypeError(`option maxAge is invalid: ${b.maxAge}`);S+="; Max-Age="+b.maxAge}if(b.domain){if(!n.test(b.domain))throw new TypeError(`option domain is invalid: ${b.domain}`);S+="; Domain="+b.domain}if(b.path){if(!i.test(b.path))throw new TypeError(`option path is invalid: ${b.path}`);S+="; Path="+b.path}if(b.expires){if(!v(b.expires)||!Number.isFinite(b.expires.valueOf()))throw new TypeError(`option expires is invalid: ${b.expires}`);S+="; Expires="+b.expires.toUTCString()}if(b.httpOnly&&(S+="; HttpOnly"),b.secure&&(S+="; Secure"),b.partitioned&&(S+="; Partitioned"),b.priority)switch(typeof b.priority=="string"?b.priority.toLowerCase():void 0){case"low":S+="; Priority=Low";break;case"medium":S+="; Priority=Medium";break;case"high":S+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${b.priority}`)}if(b.sameSite)switch(typeof b.sameSite=="string"?b.sameSite.toLowerCase():b.sameSite){case!0:case"strict":S+="; SameSite=Strict";break;case"lax":S+="; SameSite=Lax";break;case"none":S+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${b.sameSite}`)}return S}function y(j){if(j.indexOf("%")===-1)return j;try{return decodeURIComponent(j)}catch{return j}}function v(j){return l.call(j)==="[object Date]"}return Do}_1();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var rx="popstate";function O1(t={}){function s(i,l){let{pathname:c,search:u,hash:f}=i.location;return mm("",{pathname:c,search:u,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(i,l){return typeof l=="string"?l:Lo(l)}return $1(s,n,null,t)}function At(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function ja(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function I1(){return Math.random().toString(36).substring(2,10)}function ix(t,s){return{usr:t.state,key:t.key,idx:s}}function mm(t,s,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?bl(s):s,state:n,key:s&&s.key||i||I1()}}function Lo({pathname:t="/",search:s="",hash:n=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function bl(t){let s={};if(t){let n=t.indexOf("#");n>=0&&(s.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(s.search=t.substring(i),t=t.substring(0,i)),t&&(s.pathname=t)}return s}function $1(t,s,n,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,u=l.history,f="POP",p=null,m=y();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function y(){return(u.state||{idx:null}).idx}function v(){f="POP";let A=y(),S=A==null?null:A-m;m=A,p&&p({action:f,location:w.location,delta:S})}function j(A,S){f="PUSH";let C=mm(w.location,A,S);m=y()+1;let D=ix(C,m),I=w.createHref(C);try{u.pushState(D,"",I)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;l.location.assign(I)}c&&p&&p({action:f,location:w.location,delta:1})}function N(A,S){f="REPLACE";let C=mm(w.location,A,S);m=y();let D=ix(C,m),I=w.createHref(C);u.replaceState(D,"",I),c&&p&&p({action:f,location:w.location,delta:0})}function b(A){let S=l.location.origin!=="null"?l.location.origin:l.location.href,C=typeof A=="string"?A:Lo(A);return C=C.replace(/ $/,"%20"),At(S,`No window.location.(origin|href) available to create URL for href: ${C}`),new URL(C,S)}let w={get action(){return f},get location(){return t(l,u)},listen(A){if(p)throw new Error("A history only accepts one active listener");return l.addEventListener(rx,v),p=A,()=>{l.removeEventListener(rx,v),p=null}},createHref(A){return s(l,A)},createURL:b,encodeLocation(A){let S=b(A);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:j,replace:N,go(A){return u.go(A)}};return w}function t0(t,s,n="/"){return R1(t,s,n,!1)}function R1(t,s,n,i){let l=typeof s=="string"?bl(s):s,c=_n(l.pathname||"/",n);if(c==null)return null;let u=s0(t);M1(u);let f=null;for(let p=0;f==null&&p<u.length;++p){let m=G1(c);f=Y1(u[p],m,i)}return f}function s0(t,s=[],n=[],i=""){let l=(c,u,f)=>{let p={relativePath:f===void 0?c.path||"":f,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};p.relativePath.startsWith("/")&&(At(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length));let m=Cn([i,p.relativePath]),y=n.concat(p);c.children&&c.children.length>0&&(At(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),s0(c.children,s,y,m)),!(c.path==null&&!c.index)&&s.push({path:m,score:q1(m,c.index),routesMeta:y})};return t.forEach((c,u)=>{var f;if(c.path===""||!((f=c.path)!=null&&f.includes("?")))l(c,u);else for(let p of a0(c.path))l(c,u,p)}),s}function a0(t){let s=t.split("/");if(s.length===0)return[];let[n,...i]=s,l=n.endsWith("?"),c=n.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let u=a0(i.join("/")),f=[];return f.push(...u.map(p=>p===""?c:[c,p].join("/"))),l&&f.push(...u),f.map(p=>t.startsWith("/")&&p===""?"/":p)}function M1(t){t.sort((s,n)=>s.score!==n.score?n.score-s.score:H1(s.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var z1=/^:[\w-]+$/,L1=3,B1=2,F1=1,U1=10,P1=-2,lx=t=>t==="*";function q1(t,s){let n=t.split("/"),i=n.length;return n.some(lx)&&(i+=P1),s&&(i+=B1),n.filter(l=>!lx(l)).reduce((l,c)=>l+(z1.test(c)?L1:c===""?F1:U1),i)}function H1(t,s){return t.length===s.length&&t.slice(0,-1).every((i,l)=>i===s[l])?t[t.length-1]-s[s.length-1]:0}function Y1(t,s,n=!1){let{routesMeta:i}=t,l={},c="/",u=[];for(let f=0;f<i.length;++f){let p=i[f],m=f===i.length-1,y=c==="/"?s:s.slice(c.length)||"/",v=Kd({path:p.relativePath,caseSensitive:p.caseSensitive,end:m},y),j=p.route;if(!v&&m&&n&&!i[i.length-1].route.index&&(v=Kd({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},y)),!v)return null;Object.assign(l,v.params),u.push({params:l,pathname:Cn([c,v.pathname]),pathnameBase:W1(Cn([c,v.pathnameBase])),route:j}),v.pathnameBase!=="/"&&(c=Cn([c,v.pathnameBase]))}return u}function Kd(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=V1(t.path,t.caseSensitive,t.end),l=s.match(n);if(!l)return null;let c=l[0],u=c.replace(/(.)\/+$/,"$1"),f=l.slice(1);return{params:i.reduce((m,{paramName:y,isOptional:v},j)=>{if(y==="*"){let b=f[j]||"";u=c.slice(0,c.length-b.length).replace(/(.)\/+$/,"$1")}const N=f[j];return v&&!N?m[y]=void 0:m[y]=(N||"").replace(/%2F/g,"/"),m},{}),pathname:c,pathnameBase:u,pattern:t}}function V1(t,s=!1,n=!0){ja(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],l="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,f,p)=>(i.push({paramName:f,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),l+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?l+="\\/*$":t!==""&&t!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,s?void 0:"i"),i]}function G1(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return ja(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function _n(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function Q1(t,s="/"){let{pathname:n,search:i="",hash:l=""}=typeof t=="string"?bl(t):t;return{pathname:n?n.startsWith("/")?n:X1(n,s):s,search:K1(i),hash:J1(l)}}function X1(t,s){let n=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(l=>{l===".."?n.length>1&&n.pop():l!=="."&&n.push(l)}),n.length>1?n.join("/"):"/"}function Pf(t,s,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Z1(t){return t.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function Pm(t){let s=Z1(t);return s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase)}function qm(t,s,n,i=!1){let l;typeof t=="string"?l=bl(t):(l={...t},At(!l.pathname||!l.pathname.includes("?"),Pf("?","pathname","search",l)),At(!l.pathname||!l.pathname.includes("#"),Pf("#","pathname","hash",l)),At(!l.search||!l.search.includes("#"),Pf("#","search","hash",l)));let c=t===""||l.pathname==="",u=c?"/":l.pathname,f;if(u==null)f=n;else{let v=s.length-1;if(!i&&u.startsWith("..")){let j=u.split("/");for(;j[0]==="..";)j.shift(),v-=1;l.pathname=j.join("/")}f=v>=0?s[v]:"/"}let p=Q1(l,f),m=u&&u!=="/"&&u.endsWith("/"),y=(c||u===".")&&n.endsWith("/");return!p.pathname.endsWith("/")&&(m||y)&&(p.pathname+="/"),p}var Cn=t=>t.join("/").replace(/\/\/+/g,"/"),W1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),K1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,J1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ew(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var n0=["POST","PUT","PATCH","DELETE"];new Set(n0);var tw=["GET",...n0];new Set(tw);var Nl=x.createContext(null);Nl.displayName="DataRouter";var du=x.createContext(null);du.displayName="DataRouterState";var r0=x.createContext({isTransitioning:!1});r0.displayName="ViewTransition";var sw=x.createContext(new Map);sw.displayName="Fetchers";var aw=x.createContext(null);aw.displayName="Await";var La=x.createContext(null);La.displayName="Navigation";var Jo=x.createContext(null);Jo.displayName="Location";var Na=x.createContext({outlet:null,matches:[],isDataRoute:!1});Na.displayName="Route";var Hm=x.createContext(null);Hm.displayName="RouteError";function nw(t,{relative:s}={}){At(Sl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=x.useContext(La),{hash:l,pathname:c,search:u}=ec(t,{relative:s}),f=c;return n!=="/"&&(f=c==="/"?n:Cn([n,c])),i.createHref({pathname:f,search:u,hash:l})}function Sl(){return x.useContext(Jo)!=null}function gs(){return At(Sl(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Jo).location}var i0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function l0(t){x.useContext(La).static||x.useLayoutEffect(t)}function _t(){let{isDataRoute:t}=x.useContext(Na);return t?xw():rw()}function rw(){At(Sl(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(Nl),{basename:s,navigator:n}=x.useContext(La),{matches:i}=x.useContext(Na),{pathname:l}=gs(),c=JSON.stringify(Pm(i)),u=x.useRef(!1);return l0(()=>{u.current=!0}),x.useCallback((p,m={})=>{if(ja(u.current,i0),!u.current)return;if(typeof p=="number"){n.go(p);return}let y=qm(p,JSON.parse(c),l,m.relative==="path");t==null&&s!=="/"&&(y.pathname=y.pathname==="/"?s:Cn([s,y.pathname])),(m.replace?n.replace:n.push)(y,m.state,m)},[s,n,c,l,t])}var iw=x.createContext(null);function lw(t){let s=x.useContext(Na).outlet;return s&&x.createElement(iw.Provider,{value:t},s)}function jr(){let{matches:t}=x.useContext(Na),s=t[t.length-1];return s?s.params:{}}function ec(t,{relative:s}={}){let{matches:n}=x.useContext(Na),{pathname:i}=gs(),l=JSON.stringify(Pm(n));return x.useMemo(()=>qm(t,JSON.parse(l),i,s==="path"),[t,l,i,s])}function ow(t,s){return o0(t,s)}function o0(t,s,n,i){var C;At(Sl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l,static:c}=x.useContext(La),{matches:u}=x.useContext(Na),f=u[u.length-1],p=f?f.params:{},m=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let D=v&&v.path||"";c0(m,!v||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let j=gs(),N;if(s){let D=typeof s=="string"?bl(s):s;At(y==="/"||((C=D.pathname)==null?void 0:C.startsWith(y)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${y}" but pathname "${D.pathname}" was given in the \`location\` prop.`),N=D}else N=j;let b=N.pathname||"/",w=b;if(y!=="/"){let D=y.replace(/^\//,"").split("/");w="/"+b.replace(/^\//,"").split("/").slice(D.length).join("/")}let A=!c&&n&&n.matches&&n.matches.length>0?n.matches:t0(t,{pathname:w});ja(v||A!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),ja(A==null||A[A.length-1].route.element!==void 0||A[A.length-1].route.Component!==void 0||A[A.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let S=fw(A&&A.map(D=>Object.assign({},D,{params:Object.assign({},p,D.params),pathname:Cn([y,l.encodeLocation?l.encodeLocation(D.pathname).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?y:Cn([y,l.encodeLocation?l.encodeLocation(D.pathnameBase).pathname:D.pathnameBase])})),u,n,i);return s&&S?x.createElement(Jo.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},S):S}function cw(){let t=vw(),s=ew(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=x.createElement(x.Fragment,null,x.createElement("p",null,"💿 Hey developer 👋"),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:c},"ErrorBoundary")," or"," ",x.createElement("code",{style:c},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},s),n?x.createElement("pre",{style:l},n):null,u)}var dw=x.createElement(cw,null),uw=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?x.createElement(Na.Provider,{value:this.props.routeContext},x.createElement(Hm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function hw({routeContext:t,match:s,children:n}){let i=x.useContext(Nl);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),x.createElement(Na.Provider,{value:t},n)}function fw(t,s=[],n=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(s.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=n==null?void 0:n.errors;if(c!=null){let p=l.findIndex(m=>m.route.id&&(c==null?void 0:c[m.route.id])!==void 0);At(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,p+1))}let u=!1,f=-1;if(n)for(let p=0;p<l.length;p++){let m=l[p];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(f=p),m.route.id){let{loaderData:y,errors:v}=n,j=m.route.loader&&!y.hasOwnProperty(m.route.id)&&(!v||v[m.route.id]===void 0);if(m.route.lazy||j){u=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}return l.reduceRight((p,m,y)=>{let v,j=!1,N=null,b=null;n&&(v=c&&m.route.id?c[m.route.id]:void 0,N=m.route.errorElement||dw,u&&(f<0&&y===0?(c0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),j=!0,b=null):f===y&&(j=!0,b=m.route.hydrateFallbackElement||null)));let w=s.concat(l.slice(0,y+1)),A=()=>{let S;return v?S=N:j?S=b:m.route.Component?S=x.createElement(m.route.Component,null):m.route.element?S=m.route.element:S=p,x.createElement(hw,{match:m,routeContext:{outlet:p,matches:w,isDataRoute:n!=null},children:S})};return n&&(m.route.ErrorBoundary||m.route.errorElement||y===0)?x.createElement(uw,{location:n.location,revalidation:n.revalidation,component:N,error:v,children:A(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):A()},null)}function Ym(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function mw(t){let s=x.useContext(Nl);return At(s,Ym(t)),s}function pw(t){let s=x.useContext(du);return At(s,Ym(t)),s}function gw(t){let s=x.useContext(Na);return At(s,Ym(t)),s}function Vm(t){let s=gw(t),n=s.matches[s.matches.length-1];return At(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function yw(){return Vm("useRouteId")}function vw(){var i;let t=x.useContext(Hm),s=pw("useRouteError"),n=Vm("useRouteError");return t!==void 0?t:(i=s.errors)==null?void 0:i[n]}function xw(){let{router:t}=mw("useNavigate"),s=Vm("useNavigate"),n=x.useRef(!1);return l0(()=>{n.current=!0}),x.useCallback(async(l,c={})=>{ja(n.current,i0),n.current&&(typeof l=="number"?t.navigate(l):await t.navigate(l,{fromRouteId:s,...c}))},[t,s])}var ox={};function c0(t,s,n){!s&&!ox[t]&&(ox[t]=!0,ja(!1,n))}x.memo(jw);function jw({routes:t,future:s,state:n}){return o0(t,void 0,n,s)}function Jd({to:t,replace:s,state:n,relative:i}){At(Sl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=x.useContext(La);ja(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=x.useContext(Na),{pathname:u}=gs(),f=_t(),p=qm(t,Pm(c),u,i==="path"),m=JSON.stringify(p);return x.useEffect(()=>{f(JSON.parse(m),{replace:s,state:n,relative:i})},[f,m,i,s,n]),null}function wl(t){return lw(t.context)}function ut(t){At(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function bw({basename:t="/",children:s=null,location:n,navigationType:i="POP",navigator:l,static:c=!1}){At(!Sl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=t.replace(/^\/*/,"/"),f=x.useMemo(()=>({basename:u,navigator:l,static:c,future:{}}),[u,l,c]);typeof n=="string"&&(n=bl(n));let{pathname:p="/",search:m="",hash:y="",state:v=null,key:j="default"}=n,N=x.useMemo(()=>{let b=_n(p,u);return b==null?null:{location:{pathname:b,search:m,hash:y,state:v,key:j},navigationType:i}},[u,p,m,y,v,j,i]);return ja(N!=null,`<Router basename="${u}"> is not able to match the URL "${p}${m}${y}" because it does not start with the basename, so the <Router> won't render anything.`),N==null?null:x.createElement(La.Provider,{value:f},x.createElement(Jo.Provider,{children:s,value:N}))}function Nw({children:t,location:s}){return ow(pm(t),s)}function pm(t,s=[]){let n=[];return x.Children.forEach(t,(i,l)=>{if(!x.isValidElement(i))return;let c=[...s,l];if(i.type===x.Fragment){n.push.apply(n,pm(i.props.children,c));return}At(i.type===ut,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),At(!i.props.index||!i.props.children,"An index route cannot have child routes.");let u={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(u.children=pm(i.props.children,c)),n.push(u)}),n}var $d="get",Rd="application/x-www-form-urlencoded";function uu(t){return t!=null&&typeof t.tagName=="string"}function Sw(t){return uu(t)&&t.tagName.toLowerCase()==="button"}function ww(t){return uu(t)&&t.tagName.toLowerCase()==="form"}function Tw(t){return uu(t)&&t.tagName.toLowerCase()==="input"}function Ew(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Aw(t,s){return t.button===0&&(!s||s==="_self")&&!Ew(t)}function gm(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,n)=>{let i=t[n];return s.concat(Array.isArray(i)?i.map(l=>[n,l]):[[n,i]])},[]))}function Cw(t,s){let n=gm(t);return s&&s.forEach((i,l)=>{n.has(l)||s.getAll(l).forEach(c=>{n.append(l,c)})}),n}var bd=null;function Dw(){if(bd===null)try{new FormData(document.createElement("form"),0),bd=!1}catch{bd=!0}return bd}var kw=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qf(t){return t!=null&&!kw.has(t)?(ja(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Rd}"`),null):t}function _w(t,s){let n,i,l,c,u;if(ww(t)){let f=t.getAttribute("action");i=f?_n(f,s):null,n=t.getAttribute("method")||$d,l=qf(t.getAttribute("enctype"))||Rd,c=new FormData(t)}else if(Sw(t)||Tw(t)&&(t.type==="submit"||t.type==="image")){let f=t.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=t.getAttribute("formaction")||f.getAttribute("action");if(i=p?_n(p,s):null,n=t.getAttribute("formmethod")||f.getAttribute("method")||$d,l=qf(t.getAttribute("formenctype"))||qf(f.getAttribute("enctype"))||Rd,c=new FormData(f,t),!Dw()){let{name:m,type:y,value:v}=t;if(y==="image"){let j=m?`${m}.`:"";c.append(`${j}x`,"0"),c.append(`${j}y`,"0")}else m&&c.append(m,v)}}else{if(uu(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=$d,i=null,l=Rd,u=t}return c&&l==="text/plain"&&(u=c,c=void 0),{action:i,method:n.toLowerCase(),encType:l,formData:c,body:u}}function Gm(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}async function Ow(t,s){if(t.id in s)return s[t.id];try{let n=await import(t.module);return s[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Iw(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function $w(t,s,n){let i=await Promise.all(t.map(async l=>{let c=s.routes[l.route.id];if(c){let u=await Ow(c,n);return u.links?u.links():[]}return[]}));return Lw(i.flat(1).filter(Iw).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function cx(t,s,n,i,l,c){let u=(p,m)=>n[m]?p.route.id!==n[m].route.id:!0,f=(p,m)=>{var y;return n[m].pathname!==p.pathname||((y=n[m].route.path)==null?void 0:y.endsWith("*"))&&n[m].params["*"]!==p.params["*"]};return c==="assets"?s.filter((p,m)=>u(p,m)||f(p,m)):c==="data"?s.filter((p,m)=>{var v;let y=i.routes[p.route.id];if(!y||!y.hasLoader)return!1;if(u(p,m)||f(p,m))return!0;if(p.route.shouldRevalidate){let j=p.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:((v=n[0])==null?void 0:v.params)||{},nextUrl:new URL(t,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof j=="boolean")return j}return!0}):[]}function Rw(t,s,{includeHydrateFallback:n}={}){return Mw(t.map(i=>{let l=s.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),n&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function Mw(t){return[...new Set(t)]}function zw(t){let s={},n=Object.keys(t).sort();for(let i of n)s[i]=t[i];return s}function Lw(t,s){let n=new Set;return new Set(s),t.reduce((i,l)=>{let c=JSON.stringify(zw(l));return n.has(c)||(n.add(c),i.push({key:c,link:l})),i},[])}function Bw(t,s){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":s&&_n(n.pathname,s)==="/"?n.pathname=`${s.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function d0(){let t=x.useContext(Nl);return Gm(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Fw(){let t=x.useContext(du);return Gm(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Qm=x.createContext(void 0);Qm.displayName="FrameworkContext";function u0(){let t=x.useContext(Qm);return Gm(t,"You must render this element inside a <HydratedRouter> element"),t}function Uw(t,s){let n=x.useContext(Qm),[i,l]=x.useState(!1),[c,u]=x.useState(!1),{onFocus:f,onBlur:p,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=s,j=x.useRef(null);x.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let w=S=>{S.forEach(C=>{u(C.isIntersecting)})},A=new IntersectionObserver(w,{threshold:.5});return j.current&&A.observe(j.current),()=>{A.disconnect()}}},[t]),x.useEffect(()=>{if(i){let w=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(w)}}},[i]);let N=()=>{l(!0)},b=()=>{l(!1),u(!1)};return n?t!=="intent"?[c,j,{}]:[c,j,{onFocus:ko(f,N),onBlur:ko(p,b),onMouseEnter:ko(m,N),onMouseLeave:ko(y,b),onTouchStart:ko(v,N)}]:[!1,j,{}]}function ko(t,s){return n=>{t&&t(n),n.defaultPrevented||s(n)}}function Pw({page:t,...s}){let{router:n}=d0(),i=x.useMemo(()=>t0(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?x.createElement(Hw,{page:t,matches:i,...s}):null}function qw(t){let{manifest:s,routeModules:n}=u0(),[i,l]=x.useState([]);return x.useEffect(()=>{let c=!1;return $w(t,s,n).then(u=>{c||l(u)}),()=>{c=!0}},[t,s,n]),i}function Hw({page:t,matches:s,...n}){let i=gs(),{manifest:l,routeModules:c}=u0(),{basename:u}=d0(),{loaderData:f,matches:p}=Fw(),m=x.useMemo(()=>cx(t,s,p,l,i,"data"),[t,s,p,l,i]),y=x.useMemo(()=>cx(t,s,p,l,i,"assets"),[t,s,p,l,i]),v=x.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let b=new Set,w=!1;if(s.forEach(S=>{var D;let C=l.routes[S.route.id];!C||!C.hasLoader||(!m.some(I=>I.route.id===S.route.id)&&S.route.id in f&&((D=c[S.route.id])!=null&&D.shouldRevalidate)||C.hasClientLoader?w=!0:b.add(S.route.id))}),b.size===0)return[];let A=Bw(t,u);return w&&b.size>0&&A.searchParams.set("_routes",s.filter(S=>b.has(S.route.id)).map(S=>S.route.id).join(",")),[A.pathname+A.search]},[u,f,i,l,m,s,t,c]),j=x.useMemo(()=>Rw(y,l),[y,l]),N=qw(y);return x.createElement(x.Fragment,null,v.map(b=>x.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...n})),j.map(b=>x.createElement("link",{key:b,rel:"modulepreload",href:b,...n})),N.map(({key:b,link:w})=>x.createElement("link",{key:b,...w})))}function Yw(...t){return s=>{t.forEach(n=>{typeof n=="function"?n(s):n!=null&&(n.current=s)})}}var h0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{h0&&(window.__reactRouterVersion="7.4.0")}catch{}function Vw({basename:t,children:s,window:n}){let i=x.useRef();i.current==null&&(i.current=O1({window:n,v5Compat:!0}));let l=i.current,[c,u]=x.useState({action:l.action,location:l.location}),f=x.useCallback(p=>{x.startTransition(()=>u(p))},[u]);return x.useLayoutEffect(()=>l.listen(f),[l,f]),x.createElement(bw,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:l})}var f0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xr=x.forwardRef(function({onClick:s,discover:n="render",prefetch:i="none",relative:l,reloadDocument:c,replace:u,state:f,target:p,to:m,preventScrollReset:y,viewTransition:v,...j},N){let{basename:b}=x.useContext(La),w=typeof m=="string"&&f0.test(m),A,S=!1;if(typeof m=="string"&&w&&(A=m,h0))try{let k=new URL(window.location.href),z=m.startsWith("//")?new URL(k.protocol+m):new URL(m),M=_n(z.pathname,b);z.origin===k.origin&&M!=null?m=M+z.search+z.hash:S=!0}catch{ja(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=nw(m,{relative:l}),[D,I,T]=Uw(i,j),R=Zw(m,{replace:u,state:f,target:p,preventScrollReset:y,relative:l,viewTransition:v});function E(k){s&&s(k),k.defaultPrevented||R(k)}let _=x.createElement("a",{...j,...T,href:A||C,onClick:S||c?s:E,ref:Yw(N,I),target:p,"data-discover":!w&&n==="render"?"true":void 0});return D&&!w?x.createElement(x.Fragment,null,_,x.createElement(Pw,{page:C})):_});Xr.displayName="Link";var Gw=x.forwardRef(function({"aria-current":s="page",caseSensitive:n=!1,className:i="",end:l=!1,style:c,to:u,viewTransition:f,children:p,...m},y){let v=ec(u,{relative:m.relative}),j=gs(),N=x.useContext(du),{navigator:b,basename:w}=x.useContext(La),A=N!=null&&tT(v)&&f===!0,S=b.encodeLocation?b.encodeLocation(v).pathname:v.pathname,C=j.pathname,D=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;n||(C=C.toLowerCase(),D=D?D.toLowerCase():null,S=S.toLowerCase()),D&&w&&(D=_n(D,w)||D);const I=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let T=C===S||!l&&C.startsWith(S)&&C.charAt(I)==="/",R=D!=null&&(D===S||!l&&D.startsWith(S)&&D.charAt(S.length)==="/"),E={isActive:T,isPending:R,isTransitioning:A},_=T?s:void 0,k;typeof i=="function"?k=i(E):k=[i,T?"active":null,R?"pending":null,A?"transitioning":null].filter(Boolean).join(" ");let z=typeof c=="function"?c(E):c;return x.createElement(Xr,{...m,"aria-current":_,className:k,ref:y,style:z,to:u,viewTransition:f},typeof p=="function"?p(E):p)});Gw.displayName="NavLink";var Qw=x.forwardRef(({discover:t="render",fetcherKey:s,navigate:n,reloadDocument:i,replace:l,state:c,method:u=$d,action:f,onSubmit:p,relative:m,preventScrollReset:y,viewTransition:v,...j},N)=>{let b=Jw(),w=eT(f,{relative:m}),A=u.toLowerCase()==="get"?"get":"post",S=typeof f=="string"&&f0.test(f),C=D=>{if(p&&p(D),D.defaultPrevented)return;D.preventDefault();let I=D.nativeEvent.submitter,T=(I==null?void 0:I.getAttribute("formmethod"))||u;b(I||D.currentTarget,{fetcherKey:s,method:T,navigate:n,replace:l,state:c,relative:m,preventScrollReset:y,viewTransition:v})};return x.createElement("form",{ref:N,method:A,action:w,onSubmit:i?p:C,...j,"data-discover":!S&&t==="render"?"true":void 0})});Qw.displayName="Form";function Xw(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function m0(t){let s=x.useContext(Nl);return At(s,Xw(t)),s}function Zw(t,{target:s,replace:n,state:i,preventScrollReset:l,relative:c,viewTransition:u}={}){let f=_t(),p=gs(),m=ec(t,{relative:c});return x.useCallback(y=>{if(Aw(y,s)){y.preventDefault();let v=n!==void 0?n:Lo(p)===Lo(m);f(t,{replace:v,state:i,preventScrollReset:l,relative:c,viewTransition:u})}},[p,f,m,n,i,s,t,l,c,u])}function p0(t){ja(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let s=x.useRef(gm(t)),n=x.useRef(!1),i=gs(),l=x.useMemo(()=>Cw(i.search,n.current?null:s.current),[i.search]),c=_t(),u=x.useCallback((f,p)=>{const m=gm(typeof f=="function"?f(l):f);n.current=!0,c("?"+m,p)},[c,l]);return[l,u]}var Ww=0,Kw=()=>`__${String(++Ww)}__`;function Jw(){let{router:t}=m0("useSubmit"),{basename:s}=x.useContext(La),n=yw();return x.useCallback(async(i,l={})=>{let{action:c,method:u,encType:f,formData:p,body:m}=_w(i,s);if(l.navigate===!1){let y=l.fetcherKey||Kw();await t.fetch(y,n,l.action||c,{preventScrollReset:l.preventScrollReset,formData:p,body:m,formMethod:l.method||u,formEncType:l.encType||f,flushSync:l.flushSync})}else await t.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:p,body:m,formMethod:l.method||u,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[t,s,n])}function eT(t,{relative:s}={}){let{basename:n}=x.useContext(La),i=x.useContext(Na);At(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...ec(t||".",{relative:s})},u=gs();if(t==null){c.search=u.search;let f=new URLSearchParams(c.search),p=f.getAll("index");if(p.some(y=>y==="")){f.delete("index"),p.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();c.search=y?`?${y}`:""}}return(!t||t===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(c.pathname=c.pathname==="/"?n:Cn([n,c.pathname])),Lo(c)}function tT(t,s={}){let n=x.useContext(r0);At(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=m0("useViewTransitionState"),l=ec(t,{relative:s.relative});if(!n.isTransitioning)return!1;let c=_n(n.currentLocation.pathname,i)||n.currentLocation.pathname,u=_n(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Kd(l.pathname,u)!=null||Kd(l.pathname,c)!=null}new TextEncoder;var sT=e0();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),g0=(...t)=>t.filter((s,n,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===n).join(" ").trim();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var nT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=x.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:u,...f},p)=>x.createElement("svg",{ref:p,...nT,width:s,height:s,stroke:t,strokeWidth:i?Number(n)*24/Number(s):n,className:g0("lucide",l),...f},[...u.map(([m,y])=>x.createElement(m,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=(t,s)=>{const n=x.forwardRef(({className:i,...l},c)=>x.createElement(rT,{ref:c,iconNode:s,className:g0(`lucide-${aT(t)}`,i),...l}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],zs=ze("ArrowLeft",iT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],dx=ze("ArrowRight",lT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Cs=ze("Award",oT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Zt=ze("BookOpen",cT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],ux=ze("Building2",dT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],hx=ze("Calculator",uT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],fT=ze("CalendarDays",hT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],$e=ze("Calendar",mT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ym=ze("ChartColumn",pT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Bo=ze("Check",gT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],bt=ze("ChevronDown",yT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],y0=ze("ChevronLeft",vT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xm=ze("ChevronRight",xT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Bt=ze("ChevronUp",jT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Bs=ze("CircleAlert",bT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Et=ze("CircleCheckBig",NT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ro=ze("CircleX",ST);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Nd=ze("Circle",wT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Ve=ze("Clock",TT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],AT=ze("Copy",ET);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],DT=ze("Database",CT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],_T=ze("Download",kT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],IT=ze("Ellipsis",OT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],vm=ze("ExternalLink",$T);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],si=ze("EyeOff",RT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xa=ze("Eye",MT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],LT=ze("FilePenLine",zT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],hu=ze("FileText",BT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],hi=ze("Funnel",FT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],mr=ze("GraduationCap",UT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],$o=ze("Info",PT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],fr=ze("Lock",qT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HT=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],YT=ze("LogOut",HT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VT=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],On=ze("Mail",VT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],gt=ze("MapPin",GT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QT=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],Hf=ze("Moon",QT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XT=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],fx=ze("Music2",XT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZT=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],Ke=ze("Music",ZT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],fu=ze("PenLine",WT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Fo=ze("Pen",KT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],fi=ze("Phone",JT);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],fs=ze("Plus",eE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tE=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Yt=ze("RefreshCw",tE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],xm=ze("Repeat",sE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aE=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Uo=ze("RotateCcw",aE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nE=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],tc=ze("Save",nE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rE=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],pr=ze("Search",rE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iE=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],v0=ze("Shield",iE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ba=ze("SquarePen",lE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],li=ze("Star",oE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cE=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Yf=ze("Sun",cE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],uE=ze("Target",dE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hE=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ft=ze("Trash2",hE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fE=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],Md=ze("TrendingDown",fE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mE=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],ll=ze("TrendingUp",mE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pE=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],oi=ze("TriangleAlert",pE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gE=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],yE=ze("Undo",gE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vE=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],xE=ze("Upload",vE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],bE=ze("UserCheck",jE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],SE=ze("UserPlus",NE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],TE=ze("UserX",wE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EE=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Je=ze("User",EE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AE=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],ms=ze("Users",AE);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Nt=ze("X",CE);var sc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},mu=typeof window>"u"||"Deno"in globalThis;function Da(){}function DE(t,s){return typeof t=="function"?t(s):t}function kE(t){return typeof t=="number"&&t>=0&&t!==1/0}function _E(t,s){return Math.max(t+(s||0)-Date.now(),0)}function mx(t,s){return typeof t=="function"?t(s):t}function OE(t,s){return typeof t=="function"?t(s):t}function px(t,s){const{type:n="all",exact:i,fetchStatus:l,predicate:c,queryKey:u,stale:f}=t;if(u){if(i){if(s.queryHash!==Zm(u,s.options))return!1}else if(!Po(s.queryKey,u))return!1}if(n!=="all"){const p=s.isActive();if(n==="active"&&!p||n==="inactive"&&p)return!1}return!(typeof f=="boolean"&&s.isStale()!==f||l&&l!==s.state.fetchStatus||c&&!c(s))}function gx(t,s){const{exact:n,status:i,predicate:l,mutationKey:c}=t;if(c){if(!s.options.mutationKey)return!1;if(n){if(ci(s.options.mutationKey)!==ci(c))return!1}else if(!Po(s.options.mutationKey,c))return!1}return!(i&&s.state.status!==i||l&&!l(s))}function Zm(t,s){return((s==null?void 0:s.queryKeyHashFn)||ci)(t)}function ci(t){return JSON.stringify(t,(s,n)=>jm(n)?Object.keys(n).sort().reduce((i,l)=>(i[l]=n[l],i),{}):n)}function Po(t,s){return t===s?!0:typeof t!=typeof s?!1:t&&s&&typeof t=="object"&&typeof s=="object"?!Object.keys(s).some(n=>!Po(t[n],s[n])):!1}function x0(t,s){if(t===s)return t;const n=yx(t)&&yx(s);if(n||jm(t)&&jm(s)){const i=n?t:Object.keys(t),l=i.length,c=n?s:Object.keys(s),u=c.length,f=n?[]:{};let p=0;for(let m=0;m<u;m++){const y=n?m:c[m];(!n&&i.includes(y)||n)&&t[y]===void 0&&s[y]===void 0?(f[y]=void 0,p++):(f[y]=x0(t[y],s[y]),f[y]===t[y]&&t[y]!==void 0&&p++)}return l===u&&p===l?t:f}return s}function IE(t,s){if(!s||Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}function yx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function jm(t){if(!vx(t))return!1;const s=t.constructor;if(s===void 0)return!0;const n=s.prototype;return!(!vx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function vx(t){return Object.prototype.toString.call(t)==="[object Object]"}function $E(t){return new Promise(s=>{setTimeout(s,t)})}function RE(t,s,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,s):n.structuralSharing!==!1?x0(t,s):s}function ME(t,s,n=0){const i=[...t,s];return n&&i.length>n?i.slice(1):i}function zE(t,s,n=0){const i=[s,...t];return n&&i.length>n?i.slice(0,-1):i}var Wm=Symbol();function j0(t,s){return!t.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!t.queryFn||t.queryFn===Wm?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Wr,ir,ul,Yj,LE=(Yj=class extends sc{constructor(){super();tt(this,Wr);tt(this,ir);tt(this,ul);Ye(this,ul,s=>{if(!mu&&window.addEventListener){const n=()=>s();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){ge(this,ir)||this.setEventListener(ge(this,ul))}onUnsubscribe(){var s;this.hasListeners()||((s=ge(this,ir))==null||s.call(this),Ye(this,ir,void 0))}setEventListener(s){var n;Ye(this,ul,s),(n=ge(this,ir))==null||n.call(this),Ye(this,ir,s(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(s){ge(this,Wr)!==s&&(Ye(this,Wr,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(n=>{n(s)})}isFocused(){var s;return typeof ge(this,Wr)=="boolean"?ge(this,Wr):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},Wr=new WeakMap,ir=new WeakMap,ul=new WeakMap,Yj),b0=new LE,hl,lr,fl,Vj,BE=(Vj=class extends sc{constructor(){super();tt(this,hl,!0);tt(this,lr);tt(this,fl);Ye(this,fl,s=>{if(!mu&&window.addEventListener){const n=()=>s(!0),i=()=>s(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){ge(this,lr)||this.setEventListener(ge(this,fl))}onUnsubscribe(){var s;this.hasListeners()||((s=ge(this,lr))==null||s.call(this),Ye(this,lr,void 0))}setEventListener(s){var n;Ye(this,fl,s),(n=ge(this,lr))==null||n.call(this),Ye(this,lr,s(this.setOnline.bind(this)))}setOnline(s){ge(this,hl)!==s&&(Ye(this,hl,s),this.listeners.forEach(i=>{i(s)}))}isOnline(){return ge(this,hl)}},hl=new WeakMap,lr=new WeakMap,fl=new WeakMap,Vj),eu=new BE;function FE(){let t,s;const n=new Promise((l,c)=>{t=l,s=c});n.status="pending",n.catch(()=>{});function i(l){Object.assign(n,l),delete n.resolve,delete n.reject}return n.resolve=l=>{i({status:"fulfilled",value:l}),t(l)},n.reject=l=>{i({status:"rejected",reason:l}),s(l)},n}function UE(t){return Math.min(1e3*2**t,3e4)}function N0(t){return(t??"online")==="online"?eu.isOnline():!0}var S0=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Vf(t){return t instanceof S0}function w0(t){let s=!1,n=0,i=!1,l;const c=FE(),u=w=>{var A;i||(j(new S0(w)),(A=t.abort)==null||A.call(t))},f=()=>{s=!0},p=()=>{s=!1},m=()=>b0.isFocused()&&(t.networkMode==="always"||eu.isOnline())&&t.canRun(),y=()=>N0(t.networkMode)&&t.canRun(),v=w=>{var A;i||(i=!0,(A=t.onSuccess)==null||A.call(t,w),l==null||l(),c.resolve(w))},j=w=>{var A;i||(i=!0,(A=t.onError)==null||A.call(t,w),l==null||l(),c.reject(w))},N=()=>new Promise(w=>{var A;l=S=>{(i||m())&&w(S)},(A=t.onPause)==null||A.call(t)}).then(()=>{var w;l=void 0,i||(w=t.onContinue)==null||w.call(t)}),b=()=>{if(i)return;let w;const A=n===0?t.initialPromise:void 0;try{w=A??t.fn()}catch(S){w=Promise.reject(S)}Promise.resolve(w).then(v).catch(S=>{var R;if(i)return;const C=t.retry??(mu?0:3),D=t.retryDelay??UE,I=typeof D=="function"?D(n,S):D,T=C===!0||typeof C=="number"&&n<C||typeof C=="function"&&C(n,S);if(s||!T){j(S);return}n++,(R=t.onFail)==null||R.call(t,n,S),$E(I).then(()=>m()?void 0:N()).then(()=>{s?j(S):b()})})};return{promise:c,cancel:u,continue:()=>(l==null||l(),c),cancelRetry:f,continueRetry:p,canStart:y,start:()=>(y()?b():N().then(b),c)}}function PE(){let t=[],s=0,n=f=>{f()},i=f=>{f()},l=f=>setTimeout(f,0);const c=f=>{s?t.push(f):l(()=>{n(f)})},u=()=>{const f=t;t=[],f.length&&l(()=>{i(()=>{f.forEach(p=>{n(p)})})})};return{batch:f=>{let p;s++;try{p=f()}finally{s--,s||u()}return p},batchCalls:f=>(...p)=>{c(()=>{f(...p)})},schedule:c,setNotifyFunction:f=>{n=f},setBatchNotifyFunction:f=>{i=f},setScheduler:f=>{l=f}}}var hs=PE(),Kr,Gj,T0=(Gj=class{constructor(){tt(this,Kr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),kE(this.gcTime)&&Ye(this,Kr,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(mu?1/0:5*60*1e3))}clearGcTimeout(){ge(this,Kr)&&(clearTimeout(ge(this,Kr)),Ye(this,Kr,void 0))}},Kr=new WeakMap,Gj),ml,pl,ya,Jr,Ns,Wo,ei,ka,bn,Qj,qE=(Qj=class extends T0{constructor(s){super();tt(this,ka);tt(this,ml);tt(this,pl);tt(this,ya);tt(this,Jr);tt(this,Ns);tt(this,Wo);tt(this,ei);Ye(this,ei,!1),Ye(this,Wo,s.defaultOptions),this.setOptions(s.options),this.observers=[],Ye(this,Jr,s.client),Ye(this,ya,ge(this,Jr).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,Ye(this,ml,YE(this.options)),this.state=s.state??ge(this,ml),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=ge(this,Ns))==null?void 0:s.promise}setOptions(s){this.options={...ge(this,Wo),...s},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ge(this,ya).remove(this)}setData(s,n){const i=RE(this.state.data,s,this.options);return Ht(this,ka,bn).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(s,n){Ht(this,ka,bn).call(this,{type:"setState",state:s,setStateOptions:n})}cancel(s){var i,l;const n=(i=ge(this,Ns))==null?void 0:i.promise;return(l=ge(this,Ns))==null||l.cancel(s),n?n.then(Da).catch(Da):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ge(this,ml))}isActive(){return this.observers.some(s=>OE(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Wm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(s=0){return this.state.isInvalidated||this.state.data===void 0||!_E(this.state.dataUpdatedAt,s)}onFocus(){var n;const s=this.observers.find(i=>i.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(n=ge(this,Ns))==null||n.continue()}onOnline(){var n;const s=this.observers.find(i=>i.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(n=ge(this,Ns))==null||n.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),ge(this,ya).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(n=>n!==s),this.observers.length||(ge(this,Ns)&&(ge(this,ei)?ge(this,Ns).cancel({revert:!0}):ge(this,Ns).cancelRetry()),this.scheduleGc()),ge(this,ya).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ht(this,ka,bn).call(this,{type:"invalidate"})}fetch(s,n){var p,m,y;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(ge(this,Ns))return ge(this,Ns).continueRetry(),ge(this,Ns).promise}if(s&&this.setOptions(s),!this.options.queryFn){const v=this.observers.find(j=>j.options.queryFn);v&&this.setOptions(v.options)}const i=new AbortController,l=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(Ye(this,ei,!0),i.signal)})},c=()=>{const v=j0(this.options,n),j={client:ge(this,Jr),queryKey:this.queryKey,meta:this.meta};return l(j),Ye(this,ei,!1),this.options.persister?this.options.persister(v,j,this):v(j)},u={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:ge(this,Jr),state:this.state,fetchFn:c};l(u),(p=this.options.behavior)==null||p.onFetch(u,this),Ye(this,pl,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((m=u.fetchOptions)==null?void 0:m.meta))&&Ht(this,ka,bn).call(this,{type:"fetch",meta:(y=u.fetchOptions)==null?void 0:y.meta});const f=v=>{var j,N,b,w;Vf(v)&&v.silent||Ht(this,ka,bn).call(this,{type:"error",error:v}),Vf(v)||((N=(j=ge(this,ya).config).onError)==null||N.call(j,v,this),(w=(b=ge(this,ya).config).onSettled)==null||w.call(b,this.state.data,v,this)),this.scheduleGc()};return Ye(this,Ns,w0({initialPromise:n==null?void 0:n.initialPromise,fn:u.fetchFn,abort:i.abort.bind(i),onSuccess:v=>{var j,N,b,w;if(v===void 0){f(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(v)}catch(A){f(A);return}(N=(j=ge(this,ya).config).onSuccess)==null||N.call(j,v,this),(w=(b=ge(this,ya).config).onSettled)==null||w.call(b,v,this.state.error,this),this.scheduleGc()},onError:f,onFail:(v,j)=>{Ht(this,ka,bn).call(this,{type:"failed",failureCount:v,error:j})},onPause:()=>{Ht(this,ka,bn).call(this,{type:"pause"})},onContinue:()=>{Ht(this,ka,bn).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0})),ge(this,Ns).start()}},ml=new WeakMap,pl=new WeakMap,ya=new WeakMap,Jr=new WeakMap,Ns=new WeakMap,Wo=new WeakMap,ei=new WeakMap,ka=new WeakSet,bn=function(s){const n=i=>{switch(s.type){case"failed":return{...i,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...HE(i.data,this.options),fetchMeta:s.meta??null};case"success":return{...i,data:s.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:s.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=s.error;return Vf(l)&&l.revert&&ge(this,pl)?{...ge(this,pl),fetchStatus:"idle"}:{...i,error:l,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...s.state}}};this.state=n(this.state),hs.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),ge(this,ya).notify({query:this,type:"updated",action:s})})},Qj);function HE(t,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:N0(s.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function YE(t){const s=typeof t.initialData=="function"?t.initialData():t.initialData,n=s!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Za,Xj,VE=(Xj=class extends sc{constructor(s={}){super();tt(this,Za);this.config=s,Ye(this,Za,new Map)}build(s,n,i){const l=n.queryKey,c=n.queryHash??Zm(l,n);let u=this.get(c);return u||(u=new qE({client:s,queryKey:l,queryHash:c,options:s.defaultQueryOptions(n),state:i,defaultOptions:s.getQueryDefaults(l)}),this.add(u)),u}add(s){ge(this,Za).has(s.queryHash)||(ge(this,Za).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const n=ge(this,Za).get(s.queryHash);n&&(s.destroy(),n===s&&ge(this,Za).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){hs.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return ge(this,Za).get(s)}getAll(){return[...ge(this,Za).values()]}find(s){const n={exact:!0,...s};return this.getAll().find(i=>px(n,i))}findAll(s={}){const n=this.getAll();return Object.keys(s).length>0?n.filter(i=>px(s,i)):n}notify(s){hs.batch(()=>{this.listeners.forEach(n=>{n(s)})})}onFocus(){hs.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){hs.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},Za=new WeakMap,Xj),Wa,Es,ti,Ka,nr,Zj,GE=(Zj=class extends T0{constructor(s){super();tt(this,Ka);tt(this,Wa);tt(this,Es);tt(this,ti);this.mutationId=s.mutationId,Ye(this,Es,s.mutationCache),Ye(this,Wa,[]),this.state=s.state||E0(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){ge(this,Wa).includes(s)||(ge(this,Wa).push(s),this.clearGcTimeout(),ge(this,Es).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){Ye(this,Wa,ge(this,Wa).filter(n=>n!==s)),this.scheduleGc(),ge(this,Es).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){ge(this,Wa).length||(this.state.status==="pending"?this.scheduleGc():ge(this,Es).remove(this))}continue(){var s;return((s=ge(this,ti))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var l,c,u,f,p,m,y,v,j,N,b,w,A,S,C,D,I,T,R,E;Ye(this,ti,w0({fn:()=>this.options.mutationFn?this.options.mutationFn(s):Promise.reject(new Error("No mutationFn found")),onFail:(_,k)=>{Ht(this,Ka,nr).call(this,{type:"failed",failureCount:_,error:k})},onPause:()=>{Ht(this,Ka,nr).call(this,{type:"pause"})},onContinue:()=>{Ht(this,Ka,nr).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ge(this,Es).canRun(this)}));const n=this.state.status==="pending",i=!ge(this,ti).canStart();try{if(!n){Ht(this,Ka,nr).call(this,{type:"pending",variables:s,isPaused:i}),await((c=(l=ge(this,Es).config).onMutate)==null?void 0:c.call(l,s,this));const k=await((f=(u=this.options).onMutate)==null?void 0:f.call(u,s));k!==this.state.context&&Ht(this,Ka,nr).call(this,{type:"pending",context:k,variables:s,isPaused:i})}const _=await ge(this,ti).start();return await((m=(p=ge(this,Es).config).onSuccess)==null?void 0:m.call(p,_,s,this.state.context,this)),await((v=(y=this.options).onSuccess)==null?void 0:v.call(y,_,s,this.state.context)),await((N=(j=ge(this,Es).config).onSettled)==null?void 0:N.call(j,_,null,this.state.variables,this.state.context,this)),await((w=(b=this.options).onSettled)==null?void 0:w.call(b,_,null,s,this.state.context)),Ht(this,Ka,nr).call(this,{type:"success",data:_}),_}catch(_){try{throw await((S=(A=ge(this,Es).config).onError)==null?void 0:S.call(A,_,s,this.state.context,this)),await((D=(C=this.options).onError)==null?void 0:D.call(C,_,s,this.state.context)),await((T=(I=ge(this,Es).config).onSettled)==null?void 0:T.call(I,void 0,_,this.state.variables,this.state.context,this)),await((E=(R=this.options).onSettled)==null?void 0:E.call(R,void 0,_,s,this.state.context)),_}finally{Ht(this,Ka,nr).call(this,{type:"error",error:_})}}finally{ge(this,Es).runNext(this)}}},Wa=new WeakMap,Es=new WeakMap,ti=new WeakMap,Ka=new WeakSet,nr=function(s){const n=i=>{switch(s.type){case"failed":return{...i,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...i,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:s.error,failureCount:i.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=n(this.state),hs.batch(()=>{ge(this,Wa).forEach(i=>{i.onMutationUpdate(s)}),ge(this,Es).notify({mutation:this,type:"updated",action:s})})},Zj);function E0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Tn,_a,Ko,Wj,QE=(Wj=class extends sc{constructor(s={}){super();tt(this,Tn);tt(this,_a);tt(this,Ko);this.config=s,Ye(this,Tn,new Set),Ye(this,_a,new Map),Ye(this,Ko,0)}build(s,n,i){const l=new GE({mutationCache:this,mutationId:++jd(this,Ko)._,options:s.defaultMutationOptions(n),state:i});return this.add(l),l}add(s){ge(this,Tn).add(s);const n=Sd(s);if(typeof n=="string"){const i=ge(this,_a).get(n);i?i.push(s):ge(this,_a).set(n,[s])}this.notify({type:"added",mutation:s})}remove(s){if(ge(this,Tn).delete(s)){const n=Sd(s);if(typeof n=="string"){const i=ge(this,_a).get(n);if(i)if(i.length>1){const l=i.indexOf(s);l!==-1&&i.splice(l,1)}else i[0]===s&&ge(this,_a).delete(n)}}this.notify({type:"removed",mutation:s})}canRun(s){const n=Sd(s);if(typeof n=="string"){const i=ge(this,_a).get(n),l=i==null?void 0:i.find(c=>c.state.status==="pending");return!l||l===s}else return!0}runNext(s){var i;const n=Sd(s);if(typeof n=="string"){const l=(i=ge(this,_a).get(n))==null?void 0:i.find(c=>c!==s&&c.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){hs.batch(()=>{ge(this,Tn).forEach(s=>{this.notify({type:"removed",mutation:s})}),ge(this,Tn).clear(),ge(this,_a).clear()})}getAll(){return Array.from(ge(this,Tn))}find(s){const n={exact:!0,...s};return this.getAll().find(i=>gx(n,i))}findAll(s={}){return this.getAll().filter(n=>gx(s,n))}notify(s){hs.batch(()=>{this.listeners.forEach(n=>{n(s)})})}resumePausedMutations(){const s=this.getAll().filter(n=>n.state.isPaused);return hs.batch(()=>Promise.all(s.map(n=>n.continue().catch(Da))))}},Tn=new WeakMap,_a=new WeakMap,Ko=new WeakMap,Wj);function Sd(t){var s;return(s=t.options.scope)==null?void 0:s.id}function xx(t){return{onFetch:(s,n)=>{var y,v,j,N,b;const i=s.options,l=(j=(v=(y=s.fetchOptions)==null?void 0:y.meta)==null?void 0:v.fetchMore)==null?void 0:j.direction,c=((N=s.state.data)==null?void 0:N.pages)||[],u=((b=s.state.data)==null?void 0:b.pageParams)||[];let f={pages:[],pageParams:[]},p=0;const m=async()=>{let w=!1;const A=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(s.signal.aborted?w=!0:s.signal.addEventListener("abort",()=>{w=!0}),s.signal)})},S=j0(s.options,s.fetchOptions),C=async(D,I,T)=>{if(w)return Promise.reject();if(I==null&&D.pages.length)return Promise.resolve(D);const R={client:s.client,queryKey:s.queryKey,pageParam:I,direction:T?"backward":"forward",meta:s.options.meta};A(R);const E=await S(R),{maxPages:_}=s.options,k=T?zE:ME;return{pages:k(D.pages,E,_),pageParams:k(D.pageParams,I,_)}};if(l&&c.length){const D=l==="backward",I=D?XE:jx,T={pages:c,pageParams:u},R=I(i,T);f=await C(T,R,D)}else{const D=t??c.length;do{const I=p===0?u[0]??i.initialPageParam:jx(i,f);if(p>0&&I==null)break;f=await C(f,I),p++}while(p<D)}return f};s.options.persister?s.fetchFn=()=>{var w,A;return(A=(w=s.options).persister)==null?void 0:A.call(w,m,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},n)}:s.fetchFn=m}}}function jx(t,{pages:s,pageParams:n}){const i=s.length-1;return s.length>0?t.getNextPageParam(s[i],s,n[i],n):void 0}function XE(t,{pages:s,pageParams:n}){var i;return s.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,s[0],s,n[0],n):void 0}var Lt,or,cr,gl,yl,dr,vl,xl,Kj,ZE=(Kj=class{constructor(t={}){tt(this,Lt);tt(this,or);tt(this,cr);tt(this,gl);tt(this,yl);tt(this,dr);tt(this,vl);tt(this,xl);Ye(this,Lt,t.queryCache||new VE),Ye(this,or,t.mutationCache||new QE),Ye(this,cr,t.defaultOptions||{}),Ye(this,gl,new Map),Ye(this,yl,new Map),Ye(this,dr,0)}mount(){jd(this,dr)._++,ge(this,dr)===1&&(Ye(this,vl,b0.subscribe(async t=>{t&&(await this.resumePausedMutations(),ge(this,Lt).onFocus())})),Ye(this,xl,eu.subscribe(async t=>{t&&(await this.resumePausedMutations(),ge(this,Lt).onOnline())})))}unmount(){var t,s;jd(this,dr)._--,ge(this,dr)===0&&((t=ge(this,vl))==null||t.call(this),Ye(this,vl,void 0),(s=ge(this,xl))==null||s.call(this),Ye(this,xl,void 0))}isFetching(t){return ge(this,Lt).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return ge(this,or).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=ge(this,Lt).get(s.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const s=this.defaultQueryOptions(t),n=ge(this,Lt).build(this,s),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(mx(s.staleTime,n))&&this.prefetchQuery(s),Promise.resolve(i))}getQueriesData(t){return ge(this,Lt).findAll(t).map(({queryKey:s,state:n})=>{const i=n.data;return[s,i]})}setQueryData(t,s,n){const i=this.defaultQueryOptions({queryKey:t}),l=ge(this,Lt).get(i.queryHash),c=l==null?void 0:l.state.data,u=DE(s,c);if(u!==void 0)return ge(this,Lt).build(this,i).setData(u,{...n,manual:!0})}setQueriesData(t,s,n){return hs.batch(()=>ge(this,Lt).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,s,n)]))}getQueryState(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=ge(this,Lt).get(s.queryHash))==null?void 0:n.state}removeQueries(t){const s=ge(this,Lt);hs.batch(()=>{s.findAll(t).forEach(n=>{s.remove(n)})})}resetQueries(t,s){const n=ge(this,Lt);return hs.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},s)))}cancelQueries(t,s={}){const n={revert:!0,...s},i=hs.batch(()=>ge(this,Lt).findAll(t).map(l=>l.cancel(n)));return Promise.all(i).then(Da).catch(Da)}invalidateQueries(t,s={}){return hs.batch(()=>(ge(this,Lt).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},s)))}refetchQueries(t,s={}){const n={...s,cancelRefetch:s.cancelRefetch??!0},i=hs.batch(()=>ge(this,Lt).findAll(t).filter(l=>!l.isDisabled()).map(l=>{let c=l.fetch(void 0,n);return n.throwOnError||(c=c.catch(Da)),l.state.fetchStatus==="paused"?Promise.resolve():c}));return Promise.all(i).then(Da)}fetchQuery(t){const s=this.defaultQueryOptions(t);s.retry===void 0&&(s.retry=!1);const n=ge(this,Lt).build(this,s);return n.isStaleByTime(mx(s.staleTime,n))?n.fetch(s):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Da).catch(Da)}fetchInfiniteQuery(t){return t.behavior=xx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Da).catch(Da)}ensureInfiniteQueryData(t){return t.behavior=xx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return eu.isOnline()?ge(this,or).resumePausedMutations():Promise.resolve()}getQueryCache(){return ge(this,Lt)}getMutationCache(){return ge(this,or)}getDefaultOptions(){return ge(this,cr)}setDefaultOptions(t){Ye(this,cr,t)}setQueryDefaults(t,s){ge(this,gl).set(ci(t),{queryKey:t,defaultOptions:s})}getQueryDefaults(t){const s=[...ge(this,gl).values()],n={};return s.forEach(i=>{Po(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,s){ge(this,yl).set(ci(t),{mutationKey:t,defaultOptions:s})}getMutationDefaults(t){const s=[...ge(this,yl).values()],n={};return s.forEach(i=>{Po(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const s={...ge(this,cr).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return s.queryHash||(s.queryHash=Zm(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===Wm&&(s.enabled=!1),s}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...ge(this,cr).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){ge(this,Lt).clear(),ge(this,or).clear()}},Lt=new WeakMap,or=new WeakMap,cr=new WeakMap,gl=new WeakMap,yl=new WeakMap,dr=new WeakMap,vl=new WeakMap,xl=new WeakMap,Kj),ur,hr,Rs,En,kn,zd,bm,Jj,WE=(Jj=class extends sc{constructor(n,i){super();tt(this,kn);tt(this,ur);tt(this,hr);tt(this,Rs);tt(this,En);Ye(this,ur,n),this.setOptions(i),this.bindMethods(),Ht(this,kn,zd).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var l;const i=this.options;this.options=ge(this,ur).defaultMutationOptions(n),IE(this.options,i)||ge(this,ur).getMutationCache().notify({type:"observerOptionsUpdated",mutation:ge(this,Rs),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&ci(i.mutationKey)!==ci(this.options.mutationKey)?this.reset():((l=ge(this,Rs))==null?void 0:l.state.status)==="pending"&&ge(this,Rs).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=ge(this,Rs))==null||n.removeObserver(this)}onMutationUpdate(n){Ht(this,kn,zd).call(this),Ht(this,kn,bm).call(this,n)}getCurrentResult(){return ge(this,hr)}reset(){var n;(n=ge(this,Rs))==null||n.removeObserver(this),Ye(this,Rs,void 0),Ht(this,kn,zd).call(this),Ht(this,kn,bm).call(this)}mutate(n,i){var l;return Ye(this,En,i),(l=ge(this,Rs))==null||l.removeObserver(this),Ye(this,Rs,ge(this,ur).getMutationCache().build(ge(this,ur),this.options)),ge(this,Rs).addObserver(this),ge(this,Rs).execute(n)}},ur=new WeakMap,hr=new WeakMap,Rs=new WeakMap,En=new WeakMap,kn=new WeakSet,zd=function(){var i;const n=((i=ge(this,Rs))==null?void 0:i.state)??E0();Ye(this,hr,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},bm=function(n){hs.batch(()=>{var i,l,c,u,f,p,m,y;if(ge(this,En)&&this.hasListeners()){const v=ge(this,hr).variables,j=ge(this,hr).context;(n==null?void 0:n.type)==="success"?((l=(i=ge(this,En)).onSuccess)==null||l.call(i,n.data,v,j),(u=(c=ge(this,En)).onSettled)==null||u.call(c,n.data,null,v,j)):(n==null?void 0:n.type)==="error"&&((p=(f=ge(this,En)).onError)==null||p.call(f,n.error,v,j),(y=(m=ge(this,En)).onSettled)==null||y.call(m,void 0,n.error,v,j))}this.listeners.forEach(v=>{v(ge(this,hr))})})},Jj),A0=x.createContext(void 0),C0=t=>{const s=x.useContext(A0);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},KE=({client:t,children:s})=>(x.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(A0.Provider,{value:t,children:s}));function JE(t,s){return typeof t=="function"?t(...s):!!t}function e2(){}function bx(t,s){const n=C0(),[i]=x.useState(()=>new WE(n,t));x.useEffect(()=>{i.setOptions(t)},[i,t]);const l=x.useSyncExternalStore(x.useCallback(u=>i.subscribe(hs.batchCalls(u)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),c=x.useCallback((u,f)=>{i.mutate(u,f).catch(e2)},[i]);if(l.error&&JE(i.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:c,mutateAsync:l.mutate}}const Nx=t=>{let s;const n=new Set,i=(m,y)=>{const v=typeof m=="function"?m(s):m;if(!Object.is(v,s)){const j=s;s=y??(typeof v!="object"||v===null)?v:Object.assign({},s,v),n.forEach(N=>N(s,j))}},l=()=>s,f={setState:i,getState:l,getInitialState:()=>p,subscribe:m=>(n.add(m),()=>n.delete(m))},p=s=t(i,l,f);return f},t2=t=>t?Nx(t):Nx,s2=t=>t;function a2(t,s=s2){const n=ii.useSyncExternalStore(t.subscribe,()=>s(t.getState()),()=>s(t.getInitialState()));return ii.useDebugValue(n),n}const Sx=t=>{const s=t2(t),n=i=>a2(s,i);return Object.assign(n,s),n},Ba=t=>t?Sx(t):Sx;function D0(t,s){return function(){return t.apply(s,arguments)}}const{toString:n2}=Object.prototype,{getPrototypeOf:Km}=Object,pu=(t=>s=>{const n=n2.call(s);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Fa=t=>(t=t.toLowerCase(),s=>pu(s)===t),gu=t=>s=>typeof s===t,{isArray:Tl}=Array,qo=gu("undefined");function r2(t){return t!==null&&!qo(t)&&t.constructor!==null&&!qo(t.constructor)&&sa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const k0=Fa("ArrayBuffer");function i2(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&k0(t.buffer),s}const l2=gu("string"),sa=gu("function"),_0=gu("number"),yu=t=>t!==null&&typeof t=="object",o2=t=>t===!0||t===!1,Ld=t=>{if(pu(t)!=="object")return!1;const s=Km(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},c2=Fa("Date"),d2=Fa("File"),u2=Fa("Blob"),h2=Fa("FileList"),f2=t=>yu(t)&&sa(t.pipe),m2=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||sa(t.append)&&((s=pu(t))==="formdata"||s==="object"&&sa(t.toString)&&t.toString()==="[object FormData]"))},p2=Fa("URLSearchParams"),[g2,y2,v2,x2]=["ReadableStream","Request","Response","Headers"].map(Fa),j2=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ac(t,s,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,l;if(typeof t!="object"&&(t=[t]),Tl(t))for(i=0,l=t.length;i<l;i++)s.call(null,t[i],i,t);else{const c=n?Object.getOwnPropertyNames(t):Object.keys(t),u=c.length;let f;for(i=0;i<u;i++)f=c[i],s.call(null,t[f],f,t)}}function O0(t,s){s=s.toLowerCase();const n=Object.keys(t);let i=n.length,l;for(;i-- >0;)if(l=n[i],s===l.toLowerCase())return l;return null}const Zr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,I0=t=>!qo(t)&&t!==Zr;function Nm(){const{caseless:t}=I0(this)&&this||{},s={},n=(i,l)=>{const c=t&&O0(s,l)||l;Ld(s[c])&&Ld(i)?s[c]=Nm(s[c],i):Ld(i)?s[c]=Nm({},i):Tl(i)?s[c]=i.slice():s[c]=i};for(let i=0,l=arguments.length;i<l;i++)arguments[i]&&ac(arguments[i],n);return s}const b2=(t,s,n,{allOwnKeys:i}={})=>(ac(s,(l,c)=>{n&&sa(l)?t[c]=D0(l,n):t[c]=l},{allOwnKeys:i}),t),N2=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),S2=(t,s,n,i)=>{t.prototype=Object.create(s.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),n&&Object.assign(t.prototype,n)},w2=(t,s,n,i)=>{let l,c,u;const f={};if(s=s||{},t==null)return s;do{for(l=Object.getOwnPropertyNames(t),c=l.length;c-- >0;)u=l[c],(!i||i(u,t,s))&&!f[u]&&(s[u]=t[u],f[u]=!0);t=n!==!1&&Km(t)}while(t&&(!n||n(t,s))&&t!==Object.prototype);return s},T2=(t,s,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=s.length;const i=t.indexOf(s,n);return i!==-1&&i===n},E2=t=>{if(!t)return null;if(Tl(t))return t;let s=t.length;if(!_0(s))return null;const n=new Array(s);for(;s-- >0;)n[s]=t[s];return n},A2=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&Km(Uint8Array)),C2=(t,s)=>{const i=(t&&t[Symbol.iterator]).call(t);let l;for(;(l=i.next())&&!l.done;){const c=l.value;s.call(t,c[0],c[1])}},D2=(t,s)=>{let n;const i=[];for(;(n=t.exec(s))!==null;)i.push(n);return i},k2=Fa("HTMLFormElement"),_2=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,l){return i.toUpperCase()+l}),wx=(({hasOwnProperty:t})=>(s,n)=>t.call(s,n))(Object.prototype),O2=Fa("RegExp"),$0=(t,s)=>{const n=Object.getOwnPropertyDescriptors(t),i={};ac(n,(l,c)=>{let u;(u=s(l,c,t))!==!1&&(i[c]=u||l)}),Object.defineProperties(t,i)},I2=t=>{$0(t,(s,n)=>{if(sa(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(sa(i)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},$2=(t,s)=>{const n={},i=l=>{l.forEach(c=>{n[c]=!0})};return Tl(t)?i(t):i(String(t).split(s)),n},R2=()=>{},M2=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function z2(t){return!!(t&&sa(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const L2=t=>{const s=new Array(10),n=(i,l)=>{if(yu(i)){if(s.indexOf(i)>=0)return;if(!("toJSON"in i)){s[l]=i;const c=Tl(i)?[]:{};return ac(i,(u,f)=>{const p=n(u,l+1);!qo(p)&&(c[f]=p)}),s[l]=void 0,c}}return i};return n(t,0)},B2=Fa("AsyncFunction"),F2=t=>t&&(yu(t)||sa(t))&&sa(t.then)&&sa(t.catch),R0=((t,s)=>t?setImmediate:s?((n,i)=>(Zr.addEventListener("message",({source:l,data:c})=>{l===Zr&&c===n&&i.length&&i.shift()()},!1),l=>{i.push(l),Zr.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",sa(Zr.postMessage)),U2=typeof queueMicrotask<"u"?queueMicrotask.bind(Zr):typeof process<"u"&&process.nextTick||R0,xe={isArray:Tl,isArrayBuffer:k0,isBuffer:r2,isFormData:m2,isArrayBufferView:i2,isString:l2,isNumber:_0,isBoolean:o2,isObject:yu,isPlainObject:Ld,isReadableStream:g2,isRequest:y2,isResponse:v2,isHeaders:x2,isUndefined:qo,isDate:c2,isFile:d2,isBlob:u2,isRegExp:O2,isFunction:sa,isStream:f2,isURLSearchParams:p2,isTypedArray:A2,isFileList:h2,forEach:ac,merge:Nm,extend:b2,trim:j2,stripBOM:N2,inherits:S2,toFlatObject:w2,kindOf:pu,kindOfTest:Fa,endsWith:T2,toArray:E2,forEachEntry:C2,matchAll:D2,isHTMLForm:k2,hasOwnProperty:wx,hasOwnProp:wx,reduceDescriptors:$0,freezeMethods:I2,toObjectSet:$2,toCamelCase:_2,noop:R2,toFiniteNumber:M2,findKey:O0,global:Zr,isContextDefined:I0,isSpecCompliantForm:z2,toJSONObject:L2,isAsyncFn:B2,isThenable:F2,setImmediate:R0,asap:U2};function Qe(t,s,n,i,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),n&&(this.config=n),i&&(this.request=i),l&&(this.response=l,this.status=l.status?l.status:null)}xe.inherits(Qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:xe.toJSONObject(this.config),code:this.code,status:this.status}}});const M0=Qe.prototype,z0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{z0[t]={value:t}});Object.defineProperties(Qe,z0);Object.defineProperty(M0,"isAxiosError",{value:!0});Qe.from=(t,s,n,i,l,c)=>{const u=Object.create(M0);return xe.toFlatObject(t,u,function(p){return p!==Error.prototype},f=>f!=="isAxiosError"),Qe.call(u,t.message,s,n,i,l),u.cause=t,u.name=t.name,c&&Object.assign(u,c),u};const P2=null;function Sm(t){return xe.isPlainObject(t)||xe.isArray(t)}function L0(t){return xe.endsWith(t,"[]")?t.slice(0,-2):t}function Tx(t,s,n){return t?t.concat(s).map(function(l,c){return l=L0(l),!n&&c?"["+l+"]":l}).join(n?".":""):s}function q2(t){return xe.isArray(t)&&!t.some(Sm)}const H2=xe.toFlatObject(xe,{},null,function(s){return/^is[A-Z]/.test(s)});function vu(t,s,n){if(!xe.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,n=xe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,A){return!xe.isUndefined(A[w])});const i=n.metaTokens,l=n.visitor||y,c=n.dots,u=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&xe.isSpecCompliantForm(s);if(!xe.isFunction(l))throw new TypeError("visitor must be a function");function m(b){if(b===null)return"";if(xe.isDate(b))return b.toISOString();if(!p&&xe.isBlob(b))throw new Qe("Blob is not supported. Use a Buffer instead.");return xe.isArrayBuffer(b)||xe.isTypedArray(b)?p&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function y(b,w,A){let S=b;if(b&&!A&&typeof b=="object"){if(xe.endsWith(w,"{}"))w=i?w:w.slice(0,-2),b=JSON.stringify(b);else if(xe.isArray(b)&&q2(b)||(xe.isFileList(b)||xe.endsWith(w,"[]"))&&(S=xe.toArray(b)))return w=L0(w),S.forEach(function(D,I){!(xe.isUndefined(D)||D===null)&&s.append(u===!0?Tx([w],I,c):u===null?w:w+"[]",m(D))}),!1}return Sm(b)?!0:(s.append(Tx(A,w,c),m(b)),!1)}const v=[],j=Object.assign(H2,{defaultVisitor:y,convertValue:m,isVisitable:Sm});function N(b,w){if(!xe.isUndefined(b)){if(v.indexOf(b)!==-1)throw Error("Circular reference detected in "+w.join("."));v.push(b),xe.forEach(b,function(S,C){(!(xe.isUndefined(S)||S===null)&&l.call(s,S,xe.isString(C)?C.trim():C,w,j))===!0&&N(S,w?w.concat(C):[C])}),v.pop()}}if(!xe.isObject(t))throw new TypeError("data must be an object");return N(t),s}function Ex(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return s[i]})}function Jm(t,s){this._pairs=[],t&&vu(t,this,s)}const B0=Jm.prototype;B0.append=function(s,n){this._pairs.push([s,n])};B0.toString=function(s){const n=s?function(i){return s.call(this,i,Ex)}:Ex;return this._pairs.map(function(l){return n(l[0])+"="+n(l[1])},"").join("&")};function Y2(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function F0(t,s,n){if(!s)return t;const i=n&&n.encode||Y2;xe.isFunction(n)&&(n={serialize:n});const l=n&&n.serialize;let c;if(l?c=l(s,n):c=xe.isURLSearchParams(s)?s.toString():new Jm(s,n).toString(i),c){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+c}return t}class Ax{constructor(){this.handlers=[]}use(s,n,i){return this.handlers.push({fulfilled:s,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){xe.forEach(this.handlers,function(i){i!==null&&s(i)})}}const U0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},V2=typeof URLSearchParams<"u"?URLSearchParams:Jm,G2=typeof FormData<"u"?FormData:null,Q2=typeof Blob<"u"?Blob:null,X2={isBrowser:!0,classes:{URLSearchParams:V2,FormData:G2,Blob:Q2},protocols:["http","https","file","blob","url","data"]},ep=typeof window<"u"&&typeof document<"u",wm=typeof navigator=="object"&&navigator||void 0,Z2=ep&&(!wm||["ReactNative","NativeScript","NS"].indexOf(wm.product)<0),W2=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",K2=ep&&window.location.href||"http://localhost",J2=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ep,hasStandardBrowserEnv:Z2,hasStandardBrowserWebWorkerEnv:W2,navigator:wm,origin:K2},Symbol.toStringTag,{value:"Module"})),Ss={...J2,...X2};function eA(t,s){return vu(t,new Ss.classes.URLSearchParams,Object.assign({visitor:function(n,i,l,c){return Ss.isNode&&xe.isBuffer(n)?(this.append(i,n.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},s))}function tA(t){return xe.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function sA(t){const s={},n=Object.keys(t);let i;const l=n.length;let c;for(i=0;i<l;i++)c=n[i],s[c]=t[c];return s}function P0(t){function s(n,i,l,c){let u=n[c++];if(u==="__proto__")return!0;const f=Number.isFinite(+u),p=c>=n.length;return u=!u&&xe.isArray(l)?l.length:u,p?(xe.hasOwnProp(l,u)?l[u]=[l[u],i]:l[u]=i,!f):((!l[u]||!xe.isObject(l[u]))&&(l[u]=[]),s(n,i,l[u],c)&&xe.isArray(l[u])&&(l[u]=sA(l[u])),!f)}if(xe.isFormData(t)&&xe.isFunction(t.entries)){const n={};return xe.forEachEntry(t,(i,l)=>{s(tA(i),l,n,0)}),n}return null}function aA(t,s,n){if(xe.isString(t))try{return(s||JSON.parse)(t),xe.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const nc={transitional:U0,adapter:["xhr","http","fetch"],transformRequest:[function(s,n){const i=n.getContentType()||"",l=i.indexOf("application/json")>-1,c=xe.isObject(s);if(c&&xe.isHTMLForm(s)&&(s=new FormData(s)),xe.isFormData(s))return l?JSON.stringify(P0(s)):s;if(xe.isArrayBuffer(s)||xe.isBuffer(s)||xe.isStream(s)||xe.isFile(s)||xe.isBlob(s)||xe.isReadableStream(s))return s;if(xe.isArrayBufferView(s))return s.buffer;if(xe.isURLSearchParams(s))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let f;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return eA(s,this.formSerializer).toString();if((f=xe.isFileList(s))||i.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return vu(f?{"files[]":s}:s,p&&new p,this.formSerializer)}}return c||l?(n.setContentType("application/json",!1),aA(s)):s}],transformResponse:[function(s){const n=this.transitional||nc.transitional,i=n&&n.forcedJSONParsing,l=this.responseType==="json";if(xe.isResponse(s)||xe.isReadableStream(s))return s;if(s&&xe.isString(s)&&(i&&!this.responseType||l)){const u=!(n&&n.silentJSONParsing)&&l;try{return JSON.parse(s)}catch(f){if(u)throw f.name==="SyntaxError"?Qe.from(f,Qe.ERR_BAD_RESPONSE,this,null,this.response):f}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ss.classes.FormData,Blob:Ss.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};xe.forEach(["delete","get","head","post","put","patch"],t=>{nc.headers[t]={}});const nA=xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rA=t=>{const s={};let n,i,l;return t&&t.split(`
`).forEach(function(u){l=u.indexOf(":"),n=u.substring(0,l).trim().toLowerCase(),i=u.substring(l+1).trim(),!(!n||s[n]&&nA[n])&&(n==="set-cookie"?s[n]?s[n].push(i):s[n]=[i]:s[n]=s[n]?s[n]+", "+i:i)}),s},Cx=Symbol("internals");function _o(t){return t&&String(t).trim().toLowerCase()}function Bd(t){return t===!1||t==null?t:xe.isArray(t)?t.map(Bd):String(t)}function iA(t){const s=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)s[i[1]]=i[2];return s}const lA=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Gf(t,s,n,i,l){if(xe.isFunction(i))return i.call(this,s,n);if(l&&(s=n),!!xe.isString(s)){if(xe.isString(i))return s.indexOf(i)!==-1;if(xe.isRegExp(i))return i.test(s)}}function oA(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,n,i)=>n.toUpperCase()+i)}function cA(t,s){const n=xe.toCamelCase(" "+s);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(l,c,u){return this[i].call(this,s,l,c,u)},configurable:!0})})}let Fs=class{constructor(s){s&&this.set(s)}set(s,n,i){const l=this;function c(f,p,m){const y=_o(p);if(!y)throw new Error("header name must be a non-empty string");const v=xe.findKey(l,y);(!v||l[v]===void 0||m===!0||m===void 0&&l[v]!==!1)&&(l[v||p]=Bd(f))}const u=(f,p)=>xe.forEach(f,(m,y)=>c(m,y,p));if(xe.isPlainObject(s)||s instanceof this.constructor)u(s,n);else if(xe.isString(s)&&(s=s.trim())&&!lA(s))u(rA(s),n);else if(xe.isHeaders(s))for(const[f,p]of s.entries())c(p,f,i);else s!=null&&c(n,s,i);return this}get(s,n){if(s=_o(s),s){const i=xe.findKey(this,s);if(i){const l=this[i];if(!n)return l;if(n===!0)return iA(l);if(xe.isFunction(n))return n.call(this,l,i);if(xe.isRegExp(n))return n.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,n){if(s=_o(s),s){const i=xe.findKey(this,s);return!!(i&&this[i]!==void 0&&(!n||Gf(this,this[i],i,n)))}return!1}delete(s,n){const i=this;let l=!1;function c(u){if(u=_o(u),u){const f=xe.findKey(i,u);f&&(!n||Gf(i,i[f],f,n))&&(delete i[f],l=!0)}}return xe.isArray(s)?s.forEach(c):c(s),l}clear(s){const n=Object.keys(this);let i=n.length,l=!1;for(;i--;){const c=n[i];(!s||Gf(this,this[c],c,s,!0))&&(delete this[c],l=!0)}return l}normalize(s){const n=this,i={};return xe.forEach(this,(l,c)=>{const u=xe.findKey(i,c);if(u){n[u]=Bd(l),delete n[c];return}const f=s?oA(c):String(c).trim();f!==c&&delete n[c],n[f]=Bd(l),i[f]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const n=Object.create(null);return xe.forEach(this,(i,l)=>{i!=null&&i!==!1&&(n[l]=s&&xe.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,n])=>s+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...n){const i=new this(s);return n.forEach(l=>i.set(l)),i}static accessor(s){const i=(this[Cx]=this[Cx]={accessors:{}}).accessors,l=this.prototype;function c(u){const f=_o(u);i[f]||(cA(l,u),i[f]=!0)}return xe.isArray(s)?s.forEach(c):c(s),this}};Fs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);xe.reduceDescriptors(Fs.prototype,({value:t},s)=>{let n=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(i){this[n]=i}}});xe.freezeMethods(Fs);function Qf(t,s){const n=this||nc,i=s||n,l=Fs.from(i.headers);let c=i.data;return xe.forEach(t,function(f){c=f.call(n,c,l.normalize(),s?s.status:void 0)}),l.normalize(),c}function q0(t){return!!(t&&t.__CANCEL__)}function El(t,s,n){Qe.call(this,t??"canceled",Qe.ERR_CANCELED,s,n),this.name="CanceledError"}xe.inherits(El,Qe,{__CANCEL__:!0});function H0(t,s,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):s(new Qe("Request failed with status code "+n.status,[Qe.ERR_BAD_REQUEST,Qe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function dA(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function uA(t,s){t=t||10;const n=new Array(t),i=new Array(t);let l=0,c=0,u;return s=s!==void 0?s:1e3,function(p){const m=Date.now(),y=i[c];u||(u=m),n[l]=p,i[l]=m;let v=c,j=0;for(;v!==l;)j+=n[v++],v=v%t;if(l=(l+1)%t,l===c&&(c=(c+1)%t),m-u<s)return;const N=y&&m-y;return N?Math.round(j*1e3/N):void 0}}function hA(t,s){let n=0,i=1e3/s,l,c;const u=(m,y=Date.now())=>{n=y,l=null,c&&(clearTimeout(c),c=null),t.apply(null,m)};return[(...m)=>{const y=Date.now(),v=y-n;v>=i?u(m,y):(l=m,c||(c=setTimeout(()=>{c=null,u(l)},i-v)))},()=>l&&u(l)]}const tu=(t,s,n=3)=>{let i=0;const l=uA(50,250);return hA(c=>{const u=c.loaded,f=c.lengthComputable?c.total:void 0,p=u-i,m=l(p),y=u<=f;i=u;const v={loaded:u,total:f,progress:f?u/f:void 0,bytes:p,rate:m||void 0,estimated:m&&f&&y?(f-u)/m:void 0,event:c,lengthComputable:f!=null,[s?"download":"upload"]:!0};t(v)},n)},Dx=(t,s)=>{const n=t!=null;return[i=>s[0]({lengthComputable:n,total:t,loaded:i}),s[1]]},kx=t=>(...s)=>xe.asap(()=>t(...s)),fA=Ss.hasStandardBrowserEnv?((t,s)=>n=>(n=new URL(n,Ss.origin),t.protocol===n.protocol&&t.host===n.host&&(s||t.port===n.port)))(new URL(Ss.origin),Ss.navigator&&/(msie|trident)/i.test(Ss.navigator.userAgent)):()=>!0,mA=Ss.hasStandardBrowserEnv?{write(t,s,n,i,l,c){const u=[t+"="+encodeURIComponent(s)];xe.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),xe.isString(i)&&u.push("path="+i),xe.isString(l)&&u.push("domain="+l),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read(t){const s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function pA(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function gA(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function Y0(t,s,n){let i=!pA(s);return t&&(i||n==!1)?gA(t,s):s}const _x=t=>t instanceof Fs?{...t}:t;function di(t,s){s=s||{};const n={};function i(m,y,v,j){return xe.isPlainObject(m)&&xe.isPlainObject(y)?xe.merge.call({caseless:j},m,y):xe.isPlainObject(y)?xe.merge({},y):xe.isArray(y)?y.slice():y}function l(m,y,v,j){if(xe.isUndefined(y)){if(!xe.isUndefined(m))return i(void 0,m,v,j)}else return i(m,y,v,j)}function c(m,y){if(!xe.isUndefined(y))return i(void 0,y)}function u(m,y){if(xe.isUndefined(y)){if(!xe.isUndefined(m))return i(void 0,m)}else return i(void 0,y)}function f(m,y,v){if(v in s)return i(m,y);if(v in t)return i(void 0,m)}const p={url:c,method:c,data:c,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:f,headers:(m,y,v)=>l(_x(m),_x(y),v,!0)};return xe.forEach(Object.keys(Object.assign({},t,s)),function(y){const v=p[y]||l,j=v(t[y],s[y],y);xe.isUndefined(j)&&v!==f||(n[y]=j)}),n}const V0=t=>{const s=di({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:l,xsrfCookieName:c,headers:u,auth:f}=s;s.headers=u=Fs.from(u),s.url=F0(Y0(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),f&&u.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):"")));let p;if(xe.isFormData(n)){if(Ss.hasStandardBrowserEnv||Ss.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((p=u.getContentType())!==!1){const[m,...y]=p?p.split(";").map(v=>v.trim()).filter(Boolean):[];u.setContentType([m||"multipart/form-data",...y].join("; "))}}if(Ss.hasStandardBrowserEnv&&(i&&xe.isFunction(i)&&(i=i(s)),i||i!==!1&&fA(s.url))){const m=l&&c&&mA.read(c);m&&u.set(l,m)}return s},yA=typeof XMLHttpRequest<"u",vA=yA&&function(t){return new Promise(function(n,i){const l=V0(t);let c=l.data;const u=Fs.from(l.headers).normalize();let{responseType:f,onUploadProgress:p,onDownloadProgress:m}=l,y,v,j,N,b;function w(){N&&N(),b&&b(),l.cancelToken&&l.cancelToken.unsubscribe(y),l.signal&&l.signal.removeEventListener("abort",y)}let A=new XMLHttpRequest;A.open(l.method.toUpperCase(),l.url,!0),A.timeout=l.timeout;function S(){if(!A)return;const D=Fs.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),T={data:!f||f==="text"||f==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:D,config:t,request:A};H0(function(E){n(E),w()},function(E){i(E),w()},T),A=null}"onloadend"in A?A.onloadend=S:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(S)},A.onabort=function(){A&&(i(new Qe("Request aborted",Qe.ECONNABORTED,t,A)),A=null)},A.onerror=function(){i(new Qe("Network Error",Qe.ERR_NETWORK,t,A)),A=null},A.ontimeout=function(){let I=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const T=l.transitional||U0;l.timeoutErrorMessage&&(I=l.timeoutErrorMessage),i(new Qe(I,T.clarifyTimeoutError?Qe.ETIMEDOUT:Qe.ECONNABORTED,t,A)),A=null},c===void 0&&u.setContentType(null),"setRequestHeader"in A&&xe.forEach(u.toJSON(),function(I,T){A.setRequestHeader(T,I)}),xe.isUndefined(l.withCredentials)||(A.withCredentials=!!l.withCredentials),f&&f!=="json"&&(A.responseType=l.responseType),m&&([j,b]=tu(m,!0),A.addEventListener("progress",j)),p&&A.upload&&([v,N]=tu(p),A.upload.addEventListener("progress",v),A.upload.addEventListener("loadend",N)),(l.cancelToken||l.signal)&&(y=D=>{A&&(i(!D||D.type?new El(null,t,A):D),A.abort(),A=null)},l.cancelToken&&l.cancelToken.subscribe(y),l.signal&&(l.signal.aborted?y():l.signal.addEventListener("abort",y)));const C=dA(l.url);if(C&&Ss.protocols.indexOf(C)===-1){i(new Qe("Unsupported protocol "+C+":",Qe.ERR_BAD_REQUEST,t));return}A.send(c||null)})},xA=(t,s)=>{const{length:n}=t=t?t.filter(Boolean):[];if(s||n){let i=new AbortController,l;const c=function(m){if(!l){l=!0,f();const y=m instanceof Error?m:this.reason;i.abort(y instanceof Qe?y:new El(y instanceof Error?y.message:y))}};let u=s&&setTimeout(()=>{u=null,c(new Qe(`timeout ${s} of ms exceeded`,Qe.ETIMEDOUT))},s);const f=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(m=>{m.unsubscribe?m.unsubscribe(c):m.removeEventListener("abort",c)}),t=null)};t.forEach(m=>m.addEventListener("abort",c));const{signal:p}=i;return p.unsubscribe=()=>xe.asap(f),p}},jA=function*(t,s){let n=t.byteLength;if(n<s){yield t;return}let i=0,l;for(;i<n;)l=i+s,yield t.slice(i,l),i=l},bA=async function*(t,s){for await(const n of NA(t))yield*jA(n,s)},NA=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:n,value:i}=await s.read();if(n)break;yield i}}finally{await s.cancel()}},Ox=(t,s,n,i)=>{const l=bA(t,s);let c=0,u,f=p=>{u||(u=!0,i&&i(p))};return new ReadableStream({async pull(p){try{const{done:m,value:y}=await l.next();if(m){f(),p.close();return}let v=y.byteLength;if(n){let j=c+=v;n(j)}p.enqueue(new Uint8Array(y))}catch(m){throw f(m),m}},cancel(p){return f(p),l.return()}},{highWaterMark:2})},xu=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",G0=xu&&typeof ReadableStream=="function",SA=xu&&(typeof TextEncoder=="function"?(t=>s=>t.encode(s))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Q0=(t,...s)=>{try{return!!t(...s)}catch{return!1}},wA=G0&&Q0(()=>{let t=!1;const s=new Request(Ss.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!s}),Ix=64*1024,Tm=G0&&Q0(()=>xe.isReadableStream(new Response("").body)),su={stream:Tm&&(t=>t.body)};xu&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!su[s]&&(su[s]=xe.isFunction(t[s])?n=>n[s]():(n,i)=>{throw new Qe(`Response type '${s}' is not supported`,Qe.ERR_NOT_SUPPORT,i)})})})(new Response);const TA=async t=>{if(t==null)return 0;if(xe.isBlob(t))return t.size;if(xe.isSpecCompliantForm(t))return(await new Request(Ss.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(xe.isArrayBufferView(t)||xe.isArrayBuffer(t))return t.byteLength;if(xe.isURLSearchParams(t)&&(t=t+""),xe.isString(t))return(await SA(t)).byteLength},EA=async(t,s)=>{const n=xe.toFiniteNumber(t.getContentLength());return n??TA(s)},AA=xu&&(async t=>{let{url:s,method:n,data:i,signal:l,cancelToken:c,timeout:u,onDownloadProgress:f,onUploadProgress:p,responseType:m,headers:y,withCredentials:v="same-origin",fetchOptions:j}=V0(t);m=m?(m+"").toLowerCase():"text";let N=xA([l,c&&c.toAbortSignal()],u),b;const w=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let A;try{if(p&&wA&&n!=="get"&&n!=="head"&&(A=await EA(y,i))!==0){let T=new Request(s,{method:"POST",body:i,duplex:"half"}),R;if(xe.isFormData(i)&&(R=T.headers.get("content-type"))&&y.setContentType(R),T.body){const[E,_]=Dx(A,tu(kx(p)));i=Ox(T.body,Ix,E,_)}}xe.isString(v)||(v=v?"include":"omit");const S="credentials"in Request.prototype;b=new Request(s,{...j,signal:N,method:n.toUpperCase(),headers:y.normalize().toJSON(),body:i,duplex:"half",credentials:S?v:void 0});let C=await fetch(b);const D=Tm&&(m==="stream"||m==="response");if(Tm&&(f||D&&w)){const T={};["status","statusText","headers"].forEach(k=>{T[k]=C[k]});const R=xe.toFiniteNumber(C.headers.get("content-length")),[E,_]=f&&Dx(R,tu(kx(f),!0))||[];C=new Response(Ox(C.body,Ix,E,()=>{_&&_(),w&&w()}),T)}m=m||"text";let I=await su[xe.findKey(su,m)||"text"](C,t);return!D&&w&&w(),await new Promise((T,R)=>{H0(T,R,{data:I,headers:Fs.from(C.headers),status:C.status,statusText:C.statusText,config:t,request:b})})}catch(S){throw w&&w(),S&&S.name==="TypeError"&&/fetch/i.test(S.message)?Object.assign(new Qe("Network Error",Qe.ERR_NETWORK,t,b),{cause:S.cause||S}):Qe.from(S,S&&S.code,t,b)}}),Em={http:P2,xhr:vA,fetch:AA};xe.forEach(Em,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const $x=t=>`- ${t}`,CA=t=>xe.isFunction(t)||t===null||t===!1,X0={getAdapter:t=>{t=xe.isArray(t)?t:[t];const{length:s}=t;let n,i;const l={};for(let c=0;c<s;c++){n=t[c];let u;if(i=n,!CA(n)&&(i=Em[(u=String(n)).toLowerCase()],i===void 0))throw new Qe(`Unknown adapter '${u}'`);if(i)break;l[u||"#"+c]=i}if(!i){const c=Object.entries(l).map(([f,p])=>`adapter ${f} `+(p===!1?"is not supported by the environment":"is not available in the build"));let u=s?c.length>1?`since :
`+c.map($x).join(`
`):" "+$x(c[0]):"as no adapter specified";throw new Qe("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return i},adapters:Em};function Xf(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new El(null,t)}function Rx(t){return Xf(t),t.headers=Fs.from(t.headers),t.data=Qf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),X0.getAdapter(t.adapter||nc.adapter)(t).then(function(i){return Xf(t),i.data=Qf.call(t,t.transformResponse,i),i.headers=Fs.from(i.headers),i},function(i){return q0(i)||(Xf(t),i&&i.response&&(i.response.data=Qf.call(t,t.transformResponse,i.response),i.response.headers=Fs.from(i.response.headers))),Promise.reject(i)})}const Z0="1.8.4",ju={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{ju[t]=function(i){return typeof i===t||"a"+(s<1?"n ":" ")+t}});const Mx={};ju.transitional=function(s,n,i){function l(c,u){return"[Axios v"+Z0+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,f)=>{if(s===!1)throw new Qe(l(u," has been removed"+(n?" in "+n:"")),Qe.ERR_DEPRECATED);return n&&!Mx[u]&&(Mx[u]=!0,console.warn(l(u," has been deprecated since v"+n+" and will be removed in the near future"))),s?s(c,u,f):!0}};ju.spelling=function(s){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${s}`),!0)};function DA(t,s,n){if(typeof t!="object")throw new Qe("options must be an object",Qe.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let l=i.length;for(;l-- >0;){const c=i[l],u=s[c];if(u){const f=t[c],p=f===void 0||u(f,c,t);if(p!==!0)throw new Qe("option "+c+" must be "+p,Qe.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Qe("Unknown option "+c,Qe.ERR_BAD_OPTION)}}const Fd={assertOptions:DA,validators:ju},Qa=Fd.validators;let ai=class{constructor(s){this.defaults=s,this.interceptors={request:new Ax,response:new Ax}}async request(s,n){try{return await this._request(s,n)}catch(i){if(i instanceof Error){let l={};Error.captureStackTrace?Error.captureStackTrace(l):l=new Error;const c=l.stack?l.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(s,n){typeof s=="string"?(n=n||{},n.url=s):n=s||{},n=di(this.defaults,n);const{transitional:i,paramsSerializer:l,headers:c}=n;i!==void 0&&Fd.assertOptions(i,{silentJSONParsing:Qa.transitional(Qa.boolean),forcedJSONParsing:Qa.transitional(Qa.boolean),clarifyTimeoutError:Qa.transitional(Qa.boolean)},!1),l!=null&&(xe.isFunction(l)?n.paramsSerializer={serialize:l}:Fd.assertOptions(l,{encode:Qa.function,serialize:Qa.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Fd.assertOptions(n,{baseUrl:Qa.spelling("baseURL"),withXsrfToken:Qa.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&xe.merge(c.common,c[n.method]);c&&xe.forEach(["delete","get","head","post","put","patch","common"],b=>{delete c[b]}),n.headers=Fs.concat(u,c);const f=[];let p=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(n)===!1||(p=p&&w.synchronous,f.unshift(w.fulfilled,w.rejected))});const m=[];this.interceptors.response.forEach(function(w){m.push(w.fulfilled,w.rejected)});let y,v=0,j;if(!p){const b=[Rx.bind(this),void 0];for(b.unshift.apply(b,f),b.push.apply(b,m),j=b.length,y=Promise.resolve(n);v<j;)y=y.then(b[v++],b[v++]);return y}j=f.length;let N=n;for(v=0;v<j;){const b=f[v++],w=f[v++];try{N=b(N)}catch(A){w.call(this,A);break}}try{y=Rx.call(this,N)}catch(b){return Promise.reject(b)}for(v=0,j=m.length;v<j;)y=y.then(m[v++],m[v++]);return y}getUri(s){s=di(this.defaults,s);const n=Y0(s.baseURL,s.url,s.allowAbsoluteUrls);return F0(n,s.params,s.paramsSerializer)}};xe.forEach(["delete","get","head","options"],function(s){ai.prototype[s]=function(n,i){return this.request(di(i||{},{method:s,url:n,data:(i||{}).data}))}});xe.forEach(["post","put","patch"],function(s){function n(i){return function(c,u,f){return this.request(di(f||{},{method:s,headers:i?{"Content-Type":"multipart/form-data"}:{},url:c,data:u}))}}ai.prototype[s]=n(),ai.prototype[s+"Form"]=n(!0)});let kA=class W0{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(c){n=c});const i=this;this.promise.then(l=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](l);i._listeners=null}),this.promise.then=l=>{let c;const u=new Promise(f=>{i.subscribe(f),c=f}).then(l);return u.cancel=function(){i.unsubscribe(c)},u},s(function(c,u,f){i.reason||(i.reason=new El(c,u,f),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const s=new AbortController,n=i=>{s.abort(i)};return this.subscribe(n),s.signal.unsubscribe=()=>this.unsubscribe(n),s.signal}static source(){let s;return{token:new W0(function(l){s=l}),cancel:s}}};function _A(t){return function(n){return t.apply(null,n)}}function OA(t){return xe.isObject(t)&&t.isAxiosError===!0}const Am={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Am).forEach(([t,s])=>{Am[s]=t});function K0(t){const s=new ai(t),n=D0(ai.prototype.request,s);return xe.extend(n,ai.prototype,s,{allOwnKeys:!0}),xe.extend(n,s,null,{allOwnKeys:!0}),n.create=function(l){return K0(di(t,l))},n}const Ut=K0(nc);Ut.Axios=ai;Ut.CanceledError=El;Ut.CancelToken=kA;Ut.isCancel=q0;Ut.VERSION=Z0;Ut.toFormData=vu;Ut.AxiosError=Qe;Ut.Cancel=Ut.CanceledError;Ut.all=function(s){return Promise.all(s)};Ut.spread=_A;Ut.isAxiosError=OA;Ut.mergeConfig=di;Ut.AxiosHeaders=Fs;Ut.formToJSON=t=>P0(xe.isHTMLForm(t)?new FormData(t):t);Ut.getAdapter=X0.getAdapter;Ut.HttpStatusCode=Am;Ut.default=Ut;const{Axios:IA,AxiosError:$A,CanceledError:RA,isCancel:MA,CancelToken:zA,VERSION:LA,all:BA,Cancel:FA,isAxiosError:UA,spread:PA,toFormData:qA,AxiosHeaders:HA,HttpStatusCode:YA,formToJSON:VA,getAdapter:GA,mergeConfig:QA}=Ut,XA=Object.freeze(Object.defineProperty({__proto__:null,Axios:IA,AxiosError:$A,AxiosHeaders:HA,Cancel:FA,CancelToken:zA,CanceledError:RA,HttpStatusCode:YA,VERSION:LA,all:BA,default:Ut,formToJSON:VA,getAdapter:GA,isAxiosError:UA,isCancel:MA,mergeConfig:QA,spread:PA,toFormData:qA},Symbol.toStringTag,{value:"Module"})),ZA=[/ValidationError:/i,/CastError:/i,/MongoError:/i,/mongoose/i,/TypeError:/i,/ReferenceError:/i,/SyntaxError:/i,/Failed to bulk create/i,/duplicate key error/i,/E11000/i,/must be one of/i,/Path .* is required/i,/Cast to ObjectId failed/i,/bufferedMaxEntries/i,/Connection/i,/timeout/i,/ECONNREFUSED/i,/ENOTFOUND/i,/stack trace/i,/\bat\s+.*\.(js|ts):\d+/i,/נמצאו התנגשויות.*תאוריה/i,/שיעורים\s+ביום\s+ראשון/i,/חדר\s+תאוריה\s+\d+/i,/תאריך:\s+\d{4}-\d{2}-\d{2}/i,/\d{4}-\d{2}-\d{2}/i,/\d{2}:\d{2}\s*-\s*\d{2}:\d{2}/i],WA={validation:"נתונים לא תקינים. אנא בדוק את המידע שהוזן ונסה שוב.",network:"בעיה בחיבור לשרת. אנא נסה שוב בעוד מספר רגעים.",server:"שגיאה פנימית בשרת. אנא נסה שוב מאוחר יותר.",notFound:"המשאב המבוקש לא נמצא.",unauthorized:"אין לך הרשאות לבצע פעולה זו. אנא פנה למנהל המערכת.",forbidden:"הגישה נדחתה. אין לך הרשאות מתאימות.",timeout:"הפעולה ארכה זמן רב מדי. אנא נסה שוב.",conflict:"קיים קונפליקט בנתונים. אנא רענן את הדף ונסה שוב.",tokenExpired:"פג תוקף ההתחברות. אנא התחבר מחדש.",invalidToken:"אימות לא תקין. אנא התחבר מחדש.",sessionExpired:"פג תוקף הפעלה. אנא התחבר מחדש.",authenticationFailed:"שגיאה בהתחברות. אנא בדוק את הנתונים ונסה שוב.",missingPasswords:"יש למלא את הסיסמה הנוכחית והסיסמה החדשה",incorrectCurrentPassword:"הסיסמה הנוכחית שגויה",weakPassword:"הסיסמה חייבת להכיל לפחות 6 תווים",samePassword:"הסיסמה החדשה חייבת להיות שונה מהסיסמה הנוכחית",missingEmail:"יש להזין כתובת אימייל",missingResetData:"נתוני איפוס הסיסמה חסרים",resetTokenExpired:"פג תוקף הקישור לאיפוס סיסמה. אנא בקש קישור חדש.",invalidResetToken:"הקישור לאיפוס סיסמה לא תקין או פג תוקפו",duplicateEmail:"כתובת האימייל הזו כבר קיימת במערכת. אנא השתמש בכתובת אימייל אחרת.",duplicatePhone:"מספר הטלפון הזה כבר קיים במערכת. אנא השתמש במספר טלפון אחר.",duplicateStudent:"תלמיד עם פרטים אלו כבר קיים במערכת.",duplicateOrchestra:"תזמורת עם שם זה כבר קיימת במערכת.",duplicateTheory:"שיעור תאוריה עם פרטים אלו כבר קיים במערכת.",theoryConflict:"קיים שיעור תאוריה באותו זמן. בחר זמן אחר.",notAuthorizedToUpdate:"אין לך הרשאות לעדכן תלמיד זה. רק המורה הקבוע או המנהל יכולים לעדכן.",notAuthorizedToDelete:"אין לך הרשאות למחוק תלמיד זה. רק המנהל יכול למחוק תלמידים.",notAuthorizedToView:"אין לך הרשאות לצפות בתלמיד זה.",studentNotAssigned:"תלמיד זה לא מוקצה אליך. פנה למנהל המערכת.",notAuthorizedToUpdateTeacher:"אין לך הרשאות לעדכן מורה זה. רק המנהל יכול לעדכן מורים אחרים.",notAuthorizedToDeleteTeacher:"אין לך הרשאות למחוק מורה זה. רק המנהל יכול למחוק מורים.",notAuthorizedToViewTeacher:"אין לך הרשאות לצפות במורה זה.",notAuthorizedToAddTeacher:"אין לך הרשאות להוסיף מורה חדש. רק המנהל יכול להוסיף מורים.",canOnlyEditOwnProfile:"אתה יכול לערוך רק את הפרופיל שלך.",duplicateNamePhone:"מורה עם שם מלא ומספר טלפון זהים כבר קיים במערכת.",duplicateNameAddress:"מורה עם שם מלא וכתובת דומים כבר קיים במערכת.",duplicatePhoneAddress:"מורה עם מספר טלפון וכתובת זהים כבר קיים במערכת.",duplicateFullProfile:"מורה עם פרטים זהים (שם, טלפון וכתובת) כבר קיים במערכת.",duplicateSimilarName:"נמצאו מורים עם שמות דומים במערכת.",duplicateTeacherBlocked:"לא ניתן להוסיף מורה זה - נמצאו כפילויות משמעותיות במערכת.",generic:"אירעה שגיאה. אנא נסה שוב מאוחר יותר."};function KA(t){return ZA.some(s=>s.test(t))}function JA(t){const s=t.toLowerCase();return s.includes("token expired")||s.includes("jwt expired")||s.includes("token has expired")||s.includes("התחברות פגה")||s.includes("פג תוקף")?"tokenExpired":s.includes("invalid token")||s.includes("malformed token")||s.includes("jwt malformed")||s.includes("אימות לא תקין")?"invalidToken":s.includes("session expired")||s.includes("session invalid")||s.includes("פג תוקף הפעלה")?"sessionExpired":s.includes("authentication failed")||s.includes("login failed")||s.includes("שגיאה בהתחברות")||s.includes("התחברות נכשלה")?"authenticationFailed":s.includes("missing_passwords")||s.includes("missing passwords")||s.includes("חסרים נתוני סיסמה")?"missingPasswords":s.includes("incorrect_current_password")||s.includes("incorrect current password")||s.includes("current password is wrong")||s.includes("הסיסמה הנוכחית שגויה")?"incorrectCurrentPassword":s.includes("weak_password")||s.includes("weak password")||s.includes("password too short")||s.includes("סיסמה חלשה")?"weakPassword":s.includes("same_password")||s.includes("same password")||s.includes("new password same as current")||s.includes("סיסמה זהה")?"samePassword":s.includes("missing_email")||s.includes("missing email")||s.includes("חסר אימייל")?"missingEmail":s.includes("missing_reset_data")||s.includes("missing reset data")||s.includes("חסרים נתוני איפוס")?"missingResetData":s.includes("reset_token_expired")||s.includes("reset token expired")||s.includes("token has expired")||s.includes("פג תוקף הקישור")?"resetTokenExpired":s.includes("invalid_reset_token")||s.includes("invalid reset token")||s.includes("invalid or malformed token")||s.includes("קישור לא תקין")?"invalidResetToken":s.includes("not authorized to update student")||s.includes("not authorized to update")||s.includes("לא מורשה לעדכן תלמיד")||s.includes("not authorized")&&s.includes("update")?"notAuthorizedToUpdate":s.includes("not authorized to delete student")||s.includes("not authorized to delete")||s.includes("לא מורשה למחוק תלמיד")||s.includes("not authorized")&&s.includes("delete")?"notAuthorizedToDelete":s.includes("not authorized to view student")||s.includes("not authorized to view")||s.includes("לא מורשה לצפות בתלמיד")||s.includes("not authorized")&&s.includes("view")?"notAuthorizedToView":s.includes("student not assigned to you")||s.includes("student not assigned")||s.includes("תלמיד לא מוקצה אליך")?"studentNotAssigned":s.includes("not authorized to update teacher")||s.includes("לא מורשה לעדכן מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("update")?"notAuthorizedToUpdateTeacher":s.includes("not authorized to delete teacher")||s.includes("לא מורשה למחוק מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("delete")?"notAuthorizedToDeleteTeacher":s.includes("not authorized to view teacher")||s.includes("לא מורשה לצפות במורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("view")?"notAuthorizedToViewTeacher":s.includes("not authorized to add teacher")||s.includes("לא מורשה להוסיף מורה")||s.includes("not authorized")&&s.includes("teacher")&&s.includes("add")?"notAuthorizedToAddTeacher":s.includes("can only edit own profile")||s.includes("יכול לערוך רק את הפרופיל שלך")||s.includes("own profile")?"canOnlyEditOwnProfile":s.includes("full_profile_duplicate")||s.includes("name")&&s.includes("phone")&&s.includes("address")?"duplicateFullProfile":s.includes("name_phone_duplicate")||s.includes("name")&&s.includes("phone")&&!s.includes("address")?"duplicateNamePhone":s.includes("name_address_duplicate")||s.includes("name")&&s.includes("address")&&!s.includes("phone")?"duplicateNameAddress":s.includes("phone_address_duplicate")||s.includes("phone")&&s.includes("address")&&!s.includes("name")?"duplicatePhoneAddress":s.includes("similar_name_duplicate")?"duplicateSimilarName":s.includes("duplicate teacher detected")||s.includes("duplicate_teacher_detected")?"duplicateTeacherBlocked":s.includes("teacher with email")&&s.includes("already exists")||s.includes("user with email")&&s.includes("already exists")||s.includes("email")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateEmail":s.includes("phone")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicatePhone":s.includes("student")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateStudent":s.includes("orchestra")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateOrchestra":s.includes("theory")&&(s.includes("duplicate")||s.includes("already exists"))?"duplicateTheory":null}function eC(t){return t.length<80&&!KA(t)&&!t.includes("Error:")&&!t.includes("ValidationError")&&!t.includes("MongoError")&&!t.includes("CastError")}function tC(t){const s=t.match(/יום\s+(ראשון|שני|שלישי|רביעי|חמישי|שישי|שבת)/i),n=t.match(/(\d{2}:\d{2})\s*-\s*(\d{2}:\d{2})/i),i=t.match(/חדר\s*תאוריה\s*(\d+|[א-ת]+)/i);if(s||n||i){const l=[];if(s&&l.push(`יום ${s[1]}`),n&&l.push(`שעה ${n[1]}`),i&&l.push(`חדר ${i[1]}`),l.length>0)return`קיים שיעור באותו ${l.join(" ו")}. שנה אחד מהפרטים.`}return"קיים שיעור תאוריה באותו זמן. בחר זמן או מקום אחר."}function sC(){return`ERR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function aC(t){const{status:s,message:n}=t;if(s)switch(s){case 400:return"validation";case 401:return"unauthorized";case 403:return"forbidden";case 404:return"notFound";case 409:return"conflict";case 408:case 504:return"timeout";case 500:case 502:case 503:return"server";default:if(s>=500)return"server";if(s>=400)return"validation"}if(n){const i=n.toLowerCase(),l=JA(n);if(l)return l;if(i.includes("נמצאו התנגשויות")||i.includes("תאוריה")||i.includes("שיעורים ביום")||i.includes("חדר תאוריה"))return"theoryConflict";if(i.includes("validation")||i.includes("required")||i.includes("invalid"))return"validation";if(i.includes("network")||i.includes("connection")||i.includes("timeout"))return"network";if(i.includes("unauthorized")||i.includes("token"))return"unauthorized";if(i.includes("forbidden")||i.includes("access denied"))return"forbidden";if(i.includes("not found"))return"notFound";if(i.includes("conflict")||i.includes("duplicate"))return"conflict"}return"generic"}function ts(t){var f;const s=sC(),n=new Date;let i;(f=t==null?void 0:t.response)!=null&&f.data?i={message:t.response.data.message||t.response.data.error||t.message||"Unknown error",status:t.response.status,code:t.response.data.code,details:t.response.data}:t!=null&&t.message?i={message:t.message,status:t.status||t.statusCode,code:t.code,details:t}:typeof t=="string"?i={message:t}:i={message:"Unknown error occurred",details:t};let l;if(eC(i.message))l=i.message;else{const p=aC(i);p==="theoryConflict"?l=tC(i.message):l=WA[p]}const c=nC(i),u=`[${s}] ${i.message}${i.status?` (Status: ${i.status})`:""}`;return console.error(`Error ${s}:`,u),{userMessage:l,developerMessage:u,errorId:s,timestamp:n,duplicateInfo:c||void 0}}function Ca(t,s){const n=ts(t);return s&&console.error(`API Error in ${s}:`,n.developerMessage),n}function nC(t){if(!t||!t.details)return null;const s=t.details;return s.blocked!==void 0||s.duplicates||s.warnings||s.potentialDuplicates?{blocked:s.blocked||!1,reason:s.reason||"Duplicate detection triggered",duplicates:s.duplicates||[],warnings:s.warnings||s.potentialDuplicates||[],canOverride:s.canOverride||!1,adminOverride:s.adminOverride||!1}:null}const rC=()=>"/api/",iC=rC(),ol=Ut.create({baseURL:iC,withCredentials:!0,timeout:15e3}),lC=2,oC=1e3,cC=t=>new Promise(s=>setTimeout(s,t)),Cm=t=>t?t.includes("/teacher/invitation/validate")||t.includes("/teacher/invitation/accept")||t.includes("/teacher/invitation/resend"):!1;ol.interceptors.request.use(async t=>{var n,i;if((n=t.url)!=null&&n.includes("auth/refresh")||(i=t.url)!=null&&i.includes("auth/login")||Cm(t.url))return t;const s=Ls.getToken();if(s)if(Ls.isTokenExpired(s))try{const l=await Ls.refreshToken();t.headers.Authorization=`Bearer ${l}`}catch{Ls.clearAuthData()}else t.headers.Authorization=`Bearer ${s}`;return t},t=>Promise.reject(t));ol.interceptors.response.use(t=>t,async t=>{var n,i,l;const s=t.config;if(!s)return Promise.reject(t);if(s._retry===void 0&&(s._retry=0),((n=t.response)==null?void 0:n.status)===401){if((i=s.url)!=null&&i.includes("auth/refresh")||(l=s.url)!=null&&l.includes("auth/login")||Cm(s.url))return Promise.reject(t);if(s._retry===0)try{s._retry=1;const c=await Ls.refreshToken();return s.headers||(s.headers={}),s.headers.Authorization=`Bearer ${c}`,ol(s)}catch(c){return Ls.clearAuthData(),window.location.pathname!=="/login"&&!Cm(s.url)&&(window.location.href="/login"),Promise.reject(c)}}if((t.code==="ECONNABORTED"||t.message.includes("timeout")||t.code==="ERR_NETWORK"||t.response&&t.response.status>=500)&&s._retry<lC){s._retry+=1;const c=oC*2**(s._retry-1);return await cC(c),ol(s)}return Promise.reject(t)});ol.interceptors.response.use(t=>t,t=>{var s;if(((s=t.response)==null?void 0:s.status)===403){const n=t.response.data;if((n==null?void 0:n.code)==="PASSWORD_CHANGE_REQUIRED")return localStorage.setItem("requiresPasswordChange","true"),window.location.href="/profile?forcePasswordChange=true",Promise.reject(new Error("Redirecting to password change"))}return Promise.reject(t)});const ye={async get(t,s=null,n={}){return wd("GET",t,null,s,n)},async post(t,s=null,n={}){return wd("POST",t,s,null,n)},async put(t,s=null,n={}){return wd("PUT",t,s,null,n)},async delete(t,s=null,n={}){return wd("DELETE",t,s,null,n)}};async function wd(t,s,n=null,i=null,l={}){var c;try{return(await ol({method:t,url:s,data:n,params:i,...l})).data}catch(u){if(((c=u==null?void 0:u.response)==null?void 0:c.status)===404&&s.includes("schedule/time-blocks/")&&!s.includes("/teacher/")){const y=new Error("Not Found");throw y.originalError=u,y}const p=Ca(u,`${t} ${s}`),m=new Error(p.userMessage);throw m.errorId=p.errorId,m.developerMessage=p.developerMessage,m.originalError=u,m}}let al=null;function J0(t){var c,u,f,p,m;const s=((c=t.personalInfo)==null?void 0:c.fullName)||t.fullName||"Unknown User",n=((u=t.personalInfo)==null?void 0:u.email)||t.email||((f=t.credentials)==null?void 0:f.email)||"",i=((p=t.personalInfo)==null?void 0:p.phone)||"",l=((m=t.personalInfo)==null?void 0:m.address)||"";return{_id:t._id,fullName:s,email:n,phone:i,address:l,roles:t.roles||[],professionalInfo:t.professionalInfo}}const Ls={login:dC,logout:uC,getCurrentUser:hC,isLoggedIn:fC,validateSession:mC,isTokenExpired:tp,refreshToken:eb,getToken:sp,setToken:ap,clearAuthData:Ho};async function dC(t,s){var n;try{const i=await ye.post("auth/login",{email:t,password:s});ap(i.accessToken),i.refreshToken&&localStorage.setItem("refreshToken",i.refreshToken);const l=J0(i.teacher);return localStorage.setItem("user",JSON.stringify(l)),(n=i.teacher.credentials)!=null&&n.requiresPasswordChange&&(localStorage.setItem("requiresPasswordChange","true"),setTimeout(()=>{window.location.href="/profile?forcePasswordChange=true"},100)),l}catch(i){throw console.error("Login failed:",i),i}}async function uC(){try{await ye.post("auth/logout")}catch(t){console.error("Logout failed:",t)}finally{Ho()}}function hC(){const t=localStorage.getItem("user");if(!t)return null;try{const s=JSON.parse(t);return s.personalInfo&&!s.fullName?J0(s):s}catch{return null}}function fC(){const t=sp();return!!(t&&!tp(t))}async function mC(){const t=sp();if(!t)return!1;if(tp(t))try{return await eb(),!0}catch{return Ho(),!1}try{return await ye.get("auth/validate"),!0}catch(s){return console.error("Session validation failed:",s),Ho(),!1}}function tp(t){try{const s=JSON.parse(atob(t.split(".")[1])),n=Date.now()/1e3;return s.exp<n}catch{return!0}}async function eb(){if(al)return al;const t=localStorage.getItem("refreshToken");if(!t)throw new Error("No refresh token available");return al=(async()=>{try{const s=await ye.post("auth/refresh",{refreshToken:t});return ap(s.accessToken),s.accessToken}catch(s){throw Ho(),s}finally{al=null}})(),al}function sp(){return localStorage.getItem("accessToken")}function ap(t){localStorage.setItem("accessToken",t)}function Ho(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),al=null}const cl=Ba(t=>({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!1,error:null,initialize:async()=>{t({isLoading:!0,isInitialized:!1});try{if(await Ls.validateSession()){const n=Ls.getCurrentUser();t({user:n,isAuthenticated:!0,isLoading:!1,isInitialized:!0})}else t({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0})}catch(s){console.error("Session validation failed:",s),t({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0})}},login:async(s,n)=>{t({isLoading:!0,error:null});try{const i=await Ls.login(s,n);return t({user:i,isAuthenticated:!0,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Login failed";throw t({error:l,isLoading:!1}),i}},logout:async()=>{t({isLoading:!0});try{await Ls.logout()}catch(s){console.error("Logout failed:",s)}finally{t({user:null,isAuthenticated:!1,isLoading:!1})}},clearError:()=>{t({error:null})}}));function ys(){var w;const t=C0(),s=_t(),{user:n,isAuthenticated:i,isLoading:l,error:c,login:u,logout:f,clearError:p}=cl(),m=bx({mutationFn:A=>u(A.email,A.password),onSuccess:()=>{t.invalidateQueries({queryKey:["user"]}),s("/dashboard")}}),y=bx({mutationFn:()=>f(),onSuccess:()=>{t.clear(),s("/login")}});function v(A,S){return p(),m.mutate({email:A,password:S})}function j(){return y.mutate()}const N=l||m.isPending||y.isPending,b=c||((w=m.error)==null?void 0:w.message)||void 0;return{user:n,isAuthenticated:i,isLoading:N,error:b,login:v,logout:j,clearError:p}}const np={async changePassword(t){try{return await ye.post("auth/change-password",t)}catch(s){throw console.error("Change password failed:",s),s}},async forgotPassword(t){try{return await ye.post("auth/forgot-password",t)}catch(s){throw console.error("Forgot password failed:",s),s}},async resetPassword(t){try{return await ye.post("auth/reset-password",t)}catch(s){throw console.error("Reset password failed:",s),s}}};function pC(){const[t,s]=x.useState(""),[n,i]=x.useState(""),[l,c]=x.useState(!1),[u,f]=x.useState(""),[p,m]=x.useState(!1),[y,v]=x.useState(null),[j,N]=x.useState(null),{login:b,isAuthenticated:w,isLoading:A,error:S,clearError:C}=ys();if(w)return e.jsx(Jd,{to:"/dashboard",replace:!0});function D(k){k.preventDefault(),!(!t||!n)&&b(t,n)}function I(k){C(),s(k.target.value)}function T(k){C(),i(k.target.value)}async function R(k){if(k.preventDefault(),!!u){m(!0),v(null),N(null);try{await np.forgotPassword({email:u}),N("נשלח אימייל עם הוראות לאיפוס סיסמה"),f("")}catch(z){const M=ts(z);v(M.userMessage)}finally{m(!1)}}}function E(){c(!0),f(t),v(null),N(null)}function _(){c(!1),v(null),N(null),f("")}return e.jsx("div",{className:"login-page","data-theme":"dark",children:e.jsx("div",{className:"login-form",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"back-button-container",children:e.jsxs("button",{type:"button",onClick:_,className:"back-button",children:[e.jsx(zs,{className:"icon"}),"חזרה להתחברות"]})}),e.jsx("h1",{children:"שכחת סיסמה?"}),e.jsx("p",{className:"forgot-password-description",children:"הזן את כתובת המייל שלך ונשלח לך הוראות לאיפוס הסיסמה"}),y&&e.jsx("div",{className:"error-message",children:y}),j&&e.jsx("div",{className:"success-message",children:j}),e.jsxs("form",{className:"form-section",onSubmit:R,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"email",id:"forgot-email",className:u?"has-value":"",placeholder:"",autoComplete:"off",required:!0,value:u,onChange:k=>f(k.target.value)}),e.jsx("label",{htmlFor:"forgot-email",children:"כתובת מייל"}),e.jsx(On,{className:"input-icon"})]}),e.jsx("button",{className:"btn",type:"submit",disabled:p,children:p?"שולח...":"שלח הוראות איפוס"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"התחברות"}),S&&e.jsx("div",{className:"error-message",children:S}),e.jsxs("form",{className:"form-section",onSubmit:D,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"email",id:"email",className:t?"has-value":"",placeholder:"",autoComplete:"off",required:!0,value:t,onChange:I}),e.jsx("label",{htmlFor:"email",children:"מייל"}),e.jsx(On,{className:"input-icon"})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:"password",id:"password",className:n?"has-value":"",placeholder:"",required:!0,value:n,onChange:T}),e.jsx("label",{htmlFor:"password",children:"סיסמה"}),e.jsx(fr,{className:"input-icon"})]}),e.jsx("button",{className:"btn",type:"submit",disabled:A,children:A?"מתחבר...":"התחבר"}),e.jsxs("div",{className:"forgot-password",children:[e.jsx("p",{children:"שכחת סיסמה?"}),e.jsx("button",{type:"button",onClick:E,className:"forgot-password-link",children:"לחץ כאן"})]})]})]})})})}const tb=x.createContext(void 0);function gC({children:t}){const[s,n]=x.useState(()=>{const l=localStorage.getItem("theme");return l||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});x.useEffect(()=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)},[s]),x.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)"),c=u=>{localStorage.getItem("theme")||n(u.matches?"dark":"light")};return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=()=>{n(l=>l==="light"?"dark":"light")};return e.jsx(tb.Provider,{value:{theme:s,toggleTheme:i},children:t})}function yC(){const t=x.useContext(tb);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const zx={async validateInvitation(t){try{const s=await ye.get(`/teacher/invitation/validate/${t}`);let n=s;return s&&s.success&&s.data&&(n=s.data),n}catch(s){throw console.error("Error validating invitation:",s),s}},async acceptInvitation(t,s){try{const n=await ye.post(`/teacher/invitation/accept/${t}`,s);let i=n;return n&&n.success&&n.data&&(i=n.data),i}catch(n){throw console.error("Error accepting invitation:",n),n}},async resendInvitation(t,s){try{return await ye.post(`/teacher/invitation/resend/${t}`,s)}catch(n){throw console.error("Error resending invitation:",n),n}}},vC=({id:t,message:s,type:n,onClose:i,onUndo:l,autoClose:c=!0,autoCloseTime:u=3e3})=>{x.useEffect(()=>{if(c){const p=setTimeout(()=>{i(t)},u);return()=>clearTimeout(p)}},[c,u,t,i]);const f=()=>{switch(n){case"success":return e.jsx(Et,{size:20});case"warning":return e.jsx(oi,{size:20});case"danger":return e.jsx(Ro,{size:20});case"info":default:return e.jsx($o,{size:20})}};return e.jsxs("div",{className:`toast toast-${n}`,role:"alert",children:[e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-icon",children:f()}),e.jsx("div",{className:"toast-message",children:s}),e.jsxs("div",{className:"toast-actions",children:[l&&e.jsxs("button",{className:"toast-undo-btn",onClick:()=>{l(),i(t)},children:[e.jsx(yE,{size:16}),e.jsx("span",{children:"Undo"})]}),e.jsx("button",{className:"toast-close-btn",onClick:()=>i(t),children:e.jsx(Ro,{size:16})})]})]}),c&&e.jsx("div",{className:"toast-progress",style:{animationDuration:`${u}ms`}})]})},xC=({toasts:t,position:s="bottom-left",onClose:n})=>e.jsx("div",{className:`toast-container toast-position-${s}`,children:t.map(i=>e.jsx(vC,{...i,onClose:n},i.id))}),us=[];for(let t=0;t<256;++t)us.push((t+256).toString(16).slice(1));function jC(t,s=0){return(us[t[s+0]]+us[t[s+1]]+us[t[s+2]]+us[t[s+3]]+"-"+us[t[s+4]]+us[t[s+5]]+"-"+us[t[s+6]]+us[t[s+7]]+"-"+us[t[s+8]]+us[t[s+9]]+"-"+us[t[s+10]]+us[t[s+11]]+us[t[s+12]]+us[t[s+13]]+us[t[s+14]]+us[t[s+15]]).toLowerCase()}let Zf;const bC=new Uint8Array(16);function NC(){if(!Zf){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zf=crypto.getRandomValues.bind(crypto)}return Zf(bC)}const SC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Lx={randomUUID:SC};function wC(t,s,n){var l;if(Lx.randomUUID&&!t)return Lx.randomUUID();t=t||{};const i=t.random??((l=t.rng)==null?void 0:l.call(t))??NC();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,jC(i)}const sb=x.createContext(void 0),Ot=()=>{const t=x.useContext(sb);if(!t)throw new Error("useToast must be used within a ToastProvider");return t},TC=({children:t,position:s="bottom-right"})=>{const[n,i]=x.useState([]),l=x.useCallback(v=>{const j=wC();return i(N=>[...N,{id:j,...v}]),j},[]),c=x.useCallback(v=>{i(j=>j.filter(N=>N.id!==v))},[]),u=x.useCallback(()=>{i([])},[]),f=x.useCallback(v=>{let j,N,b;return typeof v=="string"?j=v:"userMessage"in v?(j=v.userMessage,N=v.errorId,b=v.developerMessage):"message"in v?(j=v.message,N=v.errorId,b=v.developerMessage):j="אירעה שגיאה. אנא נסה שוב מאוחר יותר.",l({type:"danger",message:j,errorId:N,developerMessage:b,autoClose:!0,autoCloseTime:6e3})},[l]),p=x.useCallback(v=>l({type:"success",message:v,autoClose:!0,autoCloseTime:4e3}),[l]),m=x.useCallback(v=>l({type:"warning",message:v,autoClose:!0,autoCloseTime:5e3}),[l]),y=x.useCallback(v=>l({type:"info",message:v,autoClose:!0,autoCloseTime:4e3}),[l]);return e.jsxs(sb.Provider,{value:{addToast:l,removeToast:c,removeAllToasts:u,showError:f,showSuccess:p,showWarning:m,showInfo:y},children:[t,e.jsx(xC,{toasts:n.map(v=>({...v,onClose:c})),position:s,onClose:c})]})};function EC(){var W;const{token:t}=jr(),s=_t(),{theme:n,toggleTheme:i}=yC(),{showSuccess:l,showError:c}=Ot(),[u,f]=x.useState(""),[p,m]=x.useState(""),[y,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[A,S]=x.useState(!0),[C,D]=x.useState(!1),[I,T]=x.useState(null),[R,E]=x.useState(null),[_,k]=x.useState({length:!1,match:!1});x.useEffect(()=>{t?z():(E("קישור ההזמנה לא תקין"),S(!1))},[t]),x.useEffect(()=>{k({length:u.length>=6,match:u===p&&u.length>0})},[u,p]);async function z(){var te,L;if(t)try{S(!0);const J=await zx.validateInvitation(t);w(J.teacher),E(null)}catch(J){console.error("Error validating invitation:",J);const K=((L=(te=J==null?void 0:J.response)==null?void 0:te.data)==null?void 0:L.message)||"הזמנה לא תקפה או פג תוקפה";E(K),setTimeout(()=>{s("/login?error=invalid_invitation")},3e3)}finally{S(!1)}}async function M(te){var L,J,K,le;if(te.preventDefault(),!(!t||!b)){if(u.length<6){T("הסיסמה חייבת להכיל לפחות 6 תווים");return}if(u!==p){T("הסיסמאות אינן תואמות");return}try{D(!0),T(null);const O=await zx.acceptInvitation(t,{password:u});if(!O||!O.teacher||!O.accessToken)throw new Error("Invalid response structure from server");localStorage.setItem("accessToken",O.accessToken),O.refreshToken&&localStorage.setItem("refreshToken",O.refreshToken),localStorage.setItem("user",JSON.stringify(O.teacher));const U=((J=(L=O.teacher)==null?void 0:L.personalInfo)==null?void 0:J.fullName)||"מורה";l(`ברוכים הבאים, ${U}! החשבון שלך הוקם בהצלחה.`),s("/dashboard")}catch(O){console.error("Error accepting invitation:",O);let U="אירעה שגיאה בהגדרת הסיסמה";O!=null&&O.message?U=O.message:(le=(K=O==null?void 0:O.response)==null?void 0:K.data)!=null&&le.message&&(U=O.response.data.message),U.includes("Invalid or expired invitation token")?U="קישור ההזמנה לא תקף או פג תוקפו":U.includes("Password")&&(U="בעיה בהגדרת הסיסמה"),T(U),c(new Error(U))}finally{D(!1)}}}function G(te){T(null),f(te.target.value)}function X(te){T(null),m(te.target.value)}return A?e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"בודק הזמנה..."}),e.jsx("div",{className:"subtitle",children:"אנא המתן בזמן שאנו מאמתים את ההזמנה"}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]})}):R?e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"שגיאה בהזמנה"}),e.jsxs("div",{className:"error-message",children:[e.jsx(Bs,{size:20}),e.jsx("span",{children:R})]}),e.jsx("div",{className:"subtitle",children:"מעביר אותך לדף ההתחברות..."})]})}):e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-form compact-form",children:[e.jsx("button",{className:"theme-toggle",onClick:i,"aria-label":"Toggle theme",children:n==="dark"?e.jsx(Yf,{className:"icon"}):e.jsx(Hf,{className:"icon"})}),e.jsx("h1",{children:"הגדרת סיסמה"}),e.jsxs("div",{className:"subtitle",children:[(W=b==null?void 0:b.personalInfo)==null?void 0:W.fullName,e.jsx("br",{}),"אנא הגדירו את הסיסמה שלכם"]}),I&&e.jsxs("div",{className:"error-message",children:[e.jsx(Bs,{size:20}),e.jsx("span",{children:I})]}),e.jsxs("form",{className:"form-section",onSubmit:M,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:y?"text":"password",id:"password",className:u?"has-value":"",placeholder:"",required:!0,value:u,onChange:G,minLength:6}),e.jsx("label",{htmlFor:"password",children:"סיסמה"}),e.jsx(fr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>v(!y),"aria-label":y?"הסתר סיסמה":"הצג סיסמה",children:y?e.jsx(si,{size:16}):e.jsx(xa,{size:16})})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:j?"text":"password",id:"confirmPassword",className:p?"has-value":"",placeholder:"",required:!0,value:p,onChange:X,minLength:6}),e.jsx("label",{htmlFor:"confirmPassword",children:"אימות סיסמה"}),e.jsx(fr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>N(!j),"aria-label":j?"הסתר סיסמה":"הצג סיסמה",children:j?e.jsx(si,{size:16}):e.jsx(xa,{size:16})})]}),(u||p)&&e.jsxs("div",{className:"password-validation",children:[e.jsxs("div",{className:`validation-item ${_.length?"valid":"invalid"}`,children:[e.jsx(Et,{size:16}),e.jsx("span",{children:"לפחות 6 תווים"})]}),e.jsxs("div",{className:`validation-item ${_.match?"valid":"invalid"}`,children:[e.jsx(Et,{size:16}),e.jsx("span",{children:"הסיסמאות תואמות"})]})]}),e.jsx("button",{className:"btn",type:"submit",disabled:C||!_.length||!_.match,children:C?"מגדיר סיסמה...":"הגדר סיסמה והתחבר"}),e.jsx("div",{className:"invitation-info",children:e.jsx("p",{children:"לאחר הגדרת הסיסמה תועבר לדף הראשי"})})]})]})})}function ab(t){const s={};if(t._id&&(s._id=t._id),t.personalInfo&&(s.personalInfo={...t.personalInfo}),t.roles&&(console.log("Including roles for update:",t.roles),s.roles=Array.isArray(t.roles)?[...t.roles]:[]),t.professionalInfo&&(s.professionalInfo={...t.professionalInfo}),t.isActive!==void 0&&(s.isActive=t.isActive),t.conducting&&(s.conducting={orchestraIds:Array.isArray(t.conducting.orchestraIds)?[...t.conducting.orchestraIds]:[]}),t.ensemblesIds&&(s.ensemblesIds=Array.isArray(t.ensemblesIds)?[...t.ensemblesIds]:[]),t.schoolYears&&(s.schoolYears=[...t.schoolYears]),t.teaching){if(s.teaching={},Array.isArray(t.teaching.studentIds)&&(s.teaching.studentIds=[...t.teaching.studentIds]),t.teaching.schedule&&t.teaching.schedule.length>0){const n=t.teaching.schedule.filter(i=>i.studentId&&i.day&&i.time&&typeof i.duration=="number"&&[30,45,60].includes(i.duration));n.length>0&&(s.teaching.schedule=n.map(i=>({studentId:i.studentId,day:i.day,time:i.time,duration:i.duration,...i.isActive!==void 0?{isActive:i.isActive}:{}})))}t.teaching.timeBlocks&&Array.isArray(t.teaching.timeBlocks)&&(s.teaching.timeBlocks=[...t.teaching.timeBlocks])}return console.log("Prepared teacher data for update:",JSON.stringify(s,null,2)),s}function AC(t){var n,i;const s=ab(t);return s.credentials={email:((n=t.personalInfo)==null?void 0:n.email)||((i=t.credentials)==null?void 0:i.email)||""},s.teaching||(s.teaching={studentIds:[],schedule:[]}),s}function Td(t){return{_id:t,personalInfo:{fullName:"מורה לא זמין",phone:"",email:""},professionalInfo:{instrument:"",isActive:!1},roles:["teacher"],isActive:!1,teaching:{studentIds:[],schedule:[]},placeholder:!0}}const Jt={async getTeacherLessons(t){try{const s=await ye.get(`teachers/${t}/lessons`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher lessons for ${t}:`,s),new Error("Failed to load teacher lessons. Please try again later.")}},async getTeacherWeeklySchedule(t){try{const s=await ye.get(`teachers/${t}/weekly-schedule`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher weekly schedule for ${t}:`,s),new Error("Failed to load teacher weekly schedule. Please try again later.")}},async getTeacherDaySchedule(t,s){try{const n=await ye.get(`teachers/${t}/day-schedule/${encodeURIComponent(s)}`);return n&&n.success&&n.data?n.data:n}catch(n){throw console.error(`Failed to get teacher day schedule for ${t}, day ${s}:`,n),new Error("Failed to load teacher day schedule. Please try again later.")}},async getTeacherLessonStats(t){try{const s=await ye.get(`teachers/${t}/lesson-stats`);return s&&s.success&&s.data?s.data:s}catch(s){throw console.error(`Failed to get teacher lesson stats for ${t}:`,s),new Error("Failed to load teacher lesson statistics. Please try again later.")}},async getTeachers(t={}){try{const s=await ye.get("teacher",t);let n=s;return s&&s.success&&s.data&&(n=s.data),Array.isArray(n)?n:(console.warn("Teachers response is not an array:",n),[])}catch(s){throw console.error("Failed to get teachers:",s),new Error("Failed to load teachers. Please try again later.")}},async getTeacherById(t){if(!t||typeof t!="string")return console.error("Invalid teacher ID provided:",t),null;try{console.log(`Fetching teacher with ID: ${t}`);const s=await ye.get(`teacher/${t}`);let n=s;return s&&s.success&&s.data&&(n=s.data),!n||!n._id?(console.warn(`No valid teacher data found for ID ${t}`),Td(t)):(console.log("Teacher data received:",n),n)}catch(s){return console.error(`Failed to get teacher with ID ${t}:`,s),Td(t)}},async getTeachersByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getTeacherById(l).catch(c=>(console.error(`Failed to fetch teacher ${l}:`,c),Td(l))));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Failed to fetch teachers by IDs:",s),t.map(n=>Td(n))}},async getTeachersByRole(t){try{console.log(`Fetching teachers with role '${t}' from API`);const s=await ye.get(`teacher/role/${t}`);let n=s;if(s&&s.success&&s.data&&(n=s.data),!Array.isArray(n))return console.warn("API response for getTeachersByRole is not an array:",n),[];const i=n.filter(l=>l.isActive!==!1&&l.roles&&l.roles.includes(t));return console.log(`Found ${i.length} active teachers with role '${t}'`),i}catch(s){throw console.error(`Failed to get teachers with role ${t}:`,s),new Error(`Failed to load teachers with role ${t}. Please try again later.`)}},async getTeachersByOrchestraId(t){return this.getTeachers({orchestraId:t})},async getTeachersByStudentId(t){return this.getTeachers({studentId:t})},async addTeacher(t){const s=AC(t);console.log("Creating new teacher with data:",s);try{const n=await ye.post("teacher",s);let i=n;if(n&&n.success&&n.data&&(i=n.data),!i||!i._id||!i.personalInfo)throw console.error("Invalid teacher response structure:",{originalResponse:n,extractedData:i}),new Error("Invalid teacher data received from server");return console.log("Successfully created teacher:",i),i}catch(n){throw console.error("Failed to add new teacher:",n),new Error("Failed to create new teacher. Please check your inputs and try again.")}},async updateTeacher(t,s){const n=ab(s);console.log("Updating teacher with prepared data:",n);try{const i=await ye.put(`teacher/${t}`,n);let l=i;if(i&&i.success&&i.data&&(l=i.data),!l||!l._id||!l.personalInfo)throw console.error("Invalid teacher update response structure:",{originalResponse:i,extractedData:l}),new Error("Invalid teacher data received from server");return console.log("Successfully updated teacher:",l),l}catch(i){throw console.error(`Failed to update teacher ${t}:`,i),new Error("Failed to update teacher information. Please try again later.")}},async removeTeacher(t){try{return await ye.delete(`teacher/${t}`)}catch(s){throw console.error(`Failed to remove teacher ${t}:`,s),new Error("Failed to remove teacher. Please try again later.")}},async addOrchestra(t,s){try{return await ye.post(`teacher/${t}/orchestra`,{orchestraId:s})}catch(n){throw console.error(`Failed to add orchestra ${s} to teacher ${t}:`,n),new Error("Failed to associate orchestra with teacher. Please try again later.")}},async removeOrchestra(t,s){try{return await ye.delete(`teacher/${t}/orchestra/${s}`)}catch(n){throw console.error(`Failed to remove orchestra ${s} from teacher ${t}:`,n),new Error("Failed to remove orchestra from teacher. Please try again later.")}},async removeStudentFromTeacher(t,s){try{return await ye.delete(`teacher/${t}/student/${s}`)}catch(n){throw console.error(`Failed to remove student ${s} from teacher ${t}:`,n),new Error("Failed to remove student from teacher. Please try again later.")}}},Ud=Object.freeze(Object.defineProperty({__proto__:null,teacherService:Jt},Symbol.toStringTag,{value:"Module"})),Ds=Ba((t,s)=>({teachers:[],selectedTeacher:null,isLoading:!1,error:null,dataInitialized:!1,loadTeachers:async(n={})=>{t({isLoading:!0,error:null});try{const i=await Jt.getTeachers(n);return t({teachers:i,isLoading:!1,dataInitialized:!0}),i}catch(i){const l=i instanceof Error?i.message:"Failed to load teachers";throw t({error:l,isLoading:!1}),i}},loadBasicTeacherData:async()=>{if(!s().dataInitialized){console.log("Initializing basic teacher data..."),t({isLoading:!0,error:null});try{const n=await Jt.getTeachers({isActive:!0});t({teachers:n,isLoading:!1,dataInitialized:!0}),console.log(`Loaded ${n.length} teachers successfully`)}catch(n){const i=n instanceof Error?n.message:"Failed to load essential teacher data";t({error:i,isLoading:!1}),console.error("Teacher data initialization failed:",i)}}},loadTeacherByRole:async n=>{console.log(`Loading teachers with role: ${n}`),t({isLoading:!0,error:null});try{const i=s().teachers.filter(f=>f.roles&&f.roles.includes(n)&&f.isActive);if(i.length>0)return console.log(`Found ${i.length} cached teachers with role ${n}`),t({isLoading:!1}),i;console.log(`Fetching teachers with role ${n} from API`);const l=await Jt.getTeachersByRole(n),u=[...s().teachers];return l.forEach(f=>{const p=u.findIndex(m=>m._id===f._id);p>=0?u[p]=f:u.push(f)}),t({teachers:u,isLoading:!1}),l}catch(i){const l=i instanceof Error?i.message:`Failed to load teachers with role ${n}`;return t({error:l,isLoading:!1}),console.error(`Error loading teachers with role ${n}:`,i),[]}},loadTeacherById:async n=>{t({isLoading:!0,error:null});try{const i=s().teachers.find(u=>u._id===n);if(i)return t({selectedTeacher:i,isLoading:!1}),i;const l=await Jt.getTeacherById(n),c=[...s().teachers];if(l){const u=c.findIndex(f=>f._id===l._id);u>=0?c[u]=l:c.push(l)}return t({selectedTeacher:l,teachers:c,isLoading:!1}),l}catch(i){const l=i instanceof Error?i.message:"Failed to load teacher";throw t({error:l,isLoading:!1}),i}},saveTeacher:async(n,i)=>{var l,c,u,f,p;t({isLoading:!0,error:null});try{let m;const y=i||n._id;if(y?(console.log("🎯 FORCE UPDATE MODE - teacherId:",y),m=await Jt.updateTeacher(y,n)):(console.log("🎯 CREATE MODE - no ID found"),m=await Jt.addTeacher(n)),!y&&m.invitationInfo){const{invitationInfo:b}=m;b.mode==="DEFAULT_PASSWORD"&&console.log("Teacher created with default password:",{email:((l=m.credentials)==null?void 0:l.email)||m.personalInfo.email,password:b.defaultPassword,requiresPasswordChange:b.requiresPasswordChange})}if(!m||!m._id||!m.personalInfo)throw console.error("Invalid teacher structure returned from API:",{hasData:!!m,hasId:!!(m!=null&&m._id),hasPersonalInfo:!!(m!=null&&m.personalInfo),fullData:m}),new Error("Invalid teacher data received from server");console.log("Teacher saved successfully with structure:",{id:m._id,personalInfo:m.personalInfo,roles:m.roles});let v=m;if(y){console.log("🔄 Reloading complete teacher data after save to get time block assignments...");try{const b=await Jt.getTeacherById(y);b&&!b.placeholder&&(v=b,console.log("✅ Teacher data refreshed with time blocks:",{timeBlocks:((u=(c=v.teaching)==null?void 0:c.timeBlocks)==null?void 0:u.length)||0,totalAssignedLessons:((p=(f=v.teaching)==null?void 0:f.timeBlocks)==null?void 0:p.reduce((w,A)=>{var S;return w+(((S=A.assignedLessons)==null?void 0:S.length)||0)},0))||0}))}catch(b){console.warn("Failed to refresh teacher data after save, using response data:",b)}}const j=[...s().teachers],N=j.findIndex(b=>b._id===v._id);return N>=0?j[N]=v:j.push(v),t({teachers:j,selectedTeacher:null,isLoading:!1}),console.log("Teacher saved successfully, cleared selectedTeacher"),v}catch(m){const y=m instanceof Error?m.message:"Failed to save teacher";throw t({error:y,isLoading:!1}),m}},removeTeacher:async n=>{var i;t({isLoading:!0,error:null});try{await Jt.removeTeacher(n);const l=s().teachers.filter(c=>c._id!==n);t({teachers:l,selectedTeacher:((i=s().selectedTeacher)==null?void 0:i._id)===n?null:s().selectedTeacher,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove teacher";throw t({error:c,isLoading:!1}),l}},setSelectedTeacher:n=>{var i;console.log("Setting selected teacher:",((i=n==null?void 0:n.personalInfo)==null?void 0:i.fullName)||"null"),t({selectedTeacher:n})},clearError:()=>{t({error:null})},clearSelectedTeacher:()=>{console.log("Clearing selected teacher"),t({selectedTeacher:null})}})),CC=["Workshop","Seminar","Conference","Networking Event","Other"],DC=["Morning (9AM - 12PM)","Afternoon (1PM - 4PM)","Evening (5PM - 8PM)"];function kC(){const[t,s]=x.useState({firstName:"",lastName:"",email:"",phone:"",topic:"",preferredSlot:""}),[n,i]=x.useState(!1),l=u=>{const{name:f,value:p}=u.target;s(m=>({...m,[f]:p}))},c=async u=>{u.preventDefault(),i(!0);try{await new Promise(f=>setTimeout(f,1e3)),s({firstName:"",lastName:"",email:"",phone:"",topic:"",preferredSlot:""}),alert("Registration successful!")}catch{alert("Registration failed. Please try again.")}finally{i(!1)}};return e.jsx("div",{className:"event-registration-page",children:e.jsxs("div",{className:"glass-form",children:[e.jsx("h2",{children:"Event Registration"}),e.jsx("p",{children:"Register with us to get more details."}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Name"}),e.jsxs("div",{className:"form-row two-columns",children:[e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"firstName",value:t.firstName,onChange:l,placeholder:"First",required:!0})}),e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"lastName",value:t.lastName,onChange:l,placeholder:"Last",required:!0})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:l,placeholder:"email@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:l,placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Topic"}),e.jsxs("select",{name:"topic",value:t.topic,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select a topic"}),CC.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Preferred Slot"}),e.jsxs("select",{name:"preferredSlot",value:t.preferredSlot,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select a time"}),DC.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn-submit",disabled:n,children:n?"Submitting...":"Sign me up"})})]})]})})}const _C=()=>{const{addToast:t}=Ot(),s=()=>{t({type:"success",message:"This is a success toast",onUndo:()=>console.log("Undo clicked")})},n=()=>{t({type:"warning",message:"This is a warning toast"})},i=()=>{t({type:"danger",message:"This is a danger toast"})},l=()=>{t({type:"info",message:"This is an info toast"})};return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx("h2",{children:"Toast Test"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:s,children:"Success Toast"}),e.jsx("button",{onClick:n,children:"Warning Toast"}),e.jsx("button",{onClick:i,children:"Danger Toast"}),e.jsx("button",{onClick:l,children:"Info Toast"})]})]})},OC="/assets/logo-reKfKP0d.png";function $n(){const[t,s]=x.useState(!1),{user:n,logout:i}=ys(),l=x.useRef(null);x.useEffect(()=>{function p(m){l.current&&!l.current.contains(m.target)&&s(!1)}return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[]);function c(){i()}function u(){s(p=>!p)}const f=n!=null&&n.fullName?n.fullName.trim().split(" ").filter(p=>p.length>0).map(p=>p[0]).join("").substring(0,2).toUpperCase():"U";return e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-container",children:[e.jsxs("div",{className:"right-section",style:{display:"flex",alignItems:"center"},children:[n&&e.jsxs("div",{className:"user-container",ref:l,children:[e.jsx("div",{className:"avatar-wrapper",onClick:u,children:e.jsx("div",{className:"avatar-circle",children:n.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:"Avatar",className:"user-avatar"}):e.jsx("div",{className:"avatar-placeholder",children:f})})}),t&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:n.fullName}),e.jsx("div",{className:"user-email",children:n.email})]}),e.jsxs(Xr,{to:"/profile",className:"dropdown-item",children:[e.jsx(Je,{className:"dropdown-icon",strokeWidth:2}),e.jsx("span",{children:"פרופיל אישי"})]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item logout-btn",onClick:c,children:[e.jsx(YT,{className:"dropdown-icon",strokeWidth:2}),e.jsx("span",{children:"התנתק"})]})]})]}),e.jsx(Xr,{to:"/dashboard",className:"dashboard-link","aria-label":"Dashboard",children:e.jsx(ym,{className:"icon"})}),n&&e.jsx(Xr,{to:"/profile?openSchedule=true",className:"schedule-link","aria-label":"מערכת שעות שבועית",title:"מערכת שעות שבועית",children:e.jsx($e,{className:"icon"})})]}),e.jsx("div",{className:"logo-container",children:e.jsx(Xr,{to:"/dashboard",className:"logo-link",children:e.jsx("img",{src:OC,alt:"Logo",className:"logo-image"})})})]})})}function mi(){const s=gs().pathname,n=[{path:"/teachers",label:"מורים",icon:mr},{path:"/students",label:"תלמידים",icon:ms},{path:"/theory",label:"תאוריה",icon:Zt},{path:"/bagrut",label:"בגרות",icon:Cs},{path:"/orchestras",label:"תזמורות",icon:Ke},{path:"/rehearsals",label:"לוח חזרות",icon:$e}];return e.jsx("nav",{className:"bottom-nav visible",children:e.jsx("div",{className:"nav-items",children:n.map(i=>{const l=s===i.path||i.path==="/theory"&&s==="/"||s.startsWith(i.path);return e.jsxs(Xr,{to:i.path,className:`nav-item ${l?"active":""}`,"aria-label":i.label,children:[e.jsx(i.icon,{className:"nav-icon",strokeWidth:2}),e.jsx("span",{className:"nav-label",children:i.label})]},i.path)})})})}const Wf={async getStudentAttendanceStats(t,s){return ye.get(`orchestra/${t}/student/${s}/attendance`)},async getAttendanceDashboardData(){try{const[t,s]=await Promise.all([ye.get("rehearsal"),ye.get("orchestra")]),n=this.calculateOverallStats(t,s),i=this.calculateOrchestraOverviews(t,s),l=this.findRecentLowAttendance(t,s);return{overallStats:n,orchestraOverviews:i,recentLowAttendance:l}}catch(t){throw console.error("Failed to fetch attendance dashboard data:",t),t}},async getOrchestraAttendanceOverview(t){try{const[s,n]=await Promise.all([ye.get(`rehearsal/orchestra/${t}`),ye.get(`orchestra/${t}`)]);return this.calculateSingleOrchestraOverview(s,n)}catch(s){throw console.error("Failed to fetch orchestra attendance overview:",s),s}},calculateOverallStats(t,s){const n=s.length,i=t.length;let l=0,c=0,u=0;t.forEach(p=>{if(p.attendance&&Array.isArray(p.attendance.present)){const m=s.find(y=>y._id===p.groupId);if(m&&m.memberIds){const y=m.memberIds.length,v=p.attendance.present.length,j=y>0?v/y*100:0;l+=j,c++,j<60&&u++}}});const f=c>0?Math.round(l/c):0;return{totalOrchestras:n,totalRehearsals:i,averageAttendanceRate:f,lowAttendanceCount:u}},calculateOrchestraOverviews(t,s){return s.map(n=>this.calculateSingleOrchestraOverview(t.filter(i=>i.groupId===n._id),n))},calculateSingleOrchestraOverview(t,s){const n=s.memberIds?s.memberIds.length:0,i=t.length;let l=0,c=0;const u=[],f=[];[...t].sort((y,v)=>new Date(v.date).getTime()-new Date(y.date).getTime()).forEach(y=>{if(y.attendance&&Array.isArray(y.attendance.present)){const v=y.attendance.present.length,j=y.attendance.absent?y.attendance.absent.length:0,N=n>0?Math.round(v/n*100):0;l+=N,c++,u.length<5&&u.push({rehearsalId:y._id,date:y.date,presentCount:v,absentCount:j,attendanceRate:N}),N<60&&f.push({rehearsalId:y._id,date:y.date,attendanceRate:N})}});const m=c>0?Math.round(l/c):0;return{orchestraId:s._id,orchestraName:s.name,totalRehearsals:i,averageAttendanceRate:m,totalStudents:n,recentRehearsals:u,lowAttendanceAlerts:f.slice(0,3)}},findRecentLowAttendance(t,s){const n=[],i=new Date;return t.forEach(l=>{const c=new Date(l.date),u=l.attendance&&(Array.isArray(l.attendance.present)||Array.isArray(l.attendance.absent));if(c<i&&u){const f=s.find(p=>p._id===l.groupId);if(f&&f.memberIds){const p=f.memberIds.length,m=l.attendance.present?l.attendance.present.length:0,y=p>0?Math.round(m/p*100):0;n.push({orchestraName:f.name,rehearsalDate:l.date,attendanceRate:y,rehearsalId:l._id,orchestraId:f._id})}}}),n.sort((l,c)=>new Date(c.rehearsalDate).getTime()-new Date(l.rehearsalDate).getTime()).slice(0,5)}},IC=Ba((t,s)=>({dashboardData:null,orchestraOverviews:[],studentAttendanceStats:{},isLoadingDashboard:!1,isLoadingOrchestraOverview:!1,isLoadingStudentStats:!1,error:null,loadDashboardData:async()=>{t({isLoadingDashboard:!0,error:null});try{const n=await Wf.getAttendanceDashboardData();t({dashboardData:n,orchestraOverviews:n.orchestraOverviews,isLoadingDashboard:!1})}catch(n){console.error("Failed to load attendance dashboard data:",n),t({error:n.message||"Failed to load attendance data",isLoadingDashboard:!1})}},loadOrchestraAttendanceOverview:async n=>{t({isLoadingOrchestraOverview:!0,error:null});try{const i=await Wf.getOrchestraAttendanceOverview(n),c=s().orchestraOverviews.filter(u=>u.orchestraId!==n);c.push(i),t({orchestraOverviews:c,isLoadingOrchestraOverview:!1})}catch(i){console.error("Failed to load orchestra attendance overview:",i),t({error:i.message||"Failed to load orchestra attendance data",isLoadingOrchestraOverview:!1})}},loadStudentAttendanceStats:async(n,i)=>{t({isLoadingStudentStats:!0,error:null});try{const l=await Wf.getStudentAttendanceStats(n,i),c=`${n}-${i}`;t(u=>({studentAttendanceStats:{...u.studentAttendanceStats,[c]:l},isLoadingStudentStats:!1}))}catch(l){console.error("Failed to load student attendance stats:",l),t({error:l.message||"Failed to load student attendance stats",isLoadingStudentStats:!1})}},clearError:()=>{t({error:null})},clearDashboardData:()=>{t({dashboardData:null,orchestraOverviews:[],studentAttendanceStats:{}})}}));function Ua({isOpen:t,onClose:s,children:n,className:i=""}){const[l,c]=x.useState(!1),[u,f]=x.useState(null);if(x.useEffect(()=>{let y=document.getElementById("modal-portal-root");return y||(y=document.createElement("div"),y.id="modal-portal-root",y.className="modal-portal",document.body.appendChild(y)),f(y),()=>{const v=document.getElementById("modal-portal-root");v&&!v.hasChildNodes()&&document.body.removeChild(v)}},[]),x.useEffect(()=>{if(t){document.body.style.overflow="hidden",document.body.style.paddingRight=`${window.innerWidth-document.documentElement.clientWidth}px`;const y=document.getElementById("modal-portal-root");y&&y.classList.add("modal-active"),requestAnimationFrame(()=>{c(!0)})}else{c(!1);const y=document.getElementById("modal-portal-root");y&&y.classList.remove("modal-active");const v=setTimeout(()=>{document.body.style.overflow="",document.body.style.paddingRight=""},300);return()=>clearTimeout(v)}},[t]),x.useEffect(()=>{const y=v=>{v.key==="Escape"&&t&&s()};if(t)return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t,s]),!t||!u)return null;const p=y=>{y.target===y.currentTarget&&s()},m=e.jsx("div",{className:`modal-overlay ${l?"modal-overlay-visible":""}`,onClick:p,children:e.jsx("div",{className:`modal-content ${i}`,children:n})});return sT.createPortal(m,u)}const Zs={async getRehearsals(t={}){return ye.get("rehearsal",t)},async getRehearsalById(t){return ye.get(`rehearsal/${t}`)},async getRehearsalsByOrchestraId(t){return this.getRehearsals({groupId:t})},async addRehearsal(t){if(t.type||(t.type="תזמורת"),t.date&&!t.dayOfWeek){const s=new Date(t.date);t.dayOfWeek=s.getDay()}if(!t.schoolYearId)throw new Error("School year ID is required for rehearsal creation");return console.log("Adding rehearsal with data:",t),ye.post("rehearsal",t)},async updateRehearsal(t,s){const{_id:n,...i}=s;if(s.date&&!s.dayOfWeek){const l=new Date(s.date);i.dayOfWeek=l.getDay()}return ye.put(`rehearsal/${t}`,i)},async removeRehearsal(t){if(!t)throw new Error("Invalid rehearsal ID");return ye.delete(`rehearsal/${t}`)},async removeRehearsalsByOrchestra(t){var s;if(!t)throw new Error("Invalid orchestra ID");try{console.log("Attempting bulk delete for orchestra:",t);const n=await ye.delete(`rehearsal/orchestra/${t}`);return console.log("Bulk delete successful:",n),n}catch(n){if(console.log("Bulk delete failed, error:",n),n.status===404||((s=n.response)==null?void 0:s.status)===404){console.log("Bulk delete endpoint not available (404), falling back to individual deletions");const i=await this.getRehearsals({groupId:t});if(console.log(`Found ${i.length} rehearsals to delete for orchestra ${t}`),i.length===0)return{deletedCount:0};let l=0;const c=i.map(async u=>{try{await this.removeRehearsal(u._id),l++,console.log(`Successfully deleted rehearsal ${u._id}`)}catch(f){console.error(`Failed to delete rehearsal ${u._id}:`,f)}});return await Promise.allSettled(c),console.log(`Fallback deletion completed: ${l} out of ${i.length} rehearsals deleted`),{deletedCount:l}}throw n}},async updateRehearsalsByOrchestra(t,s){var n;if(!t)throw new Error("Invalid orchestra ID");try{console.log("Attempting bulk update for orchestra:",t,"with updates:",s);const i=await ye.put(`rehearsal/orchestra/${t}`,s);return console.log("Bulk update successful:",i),i}catch(i){if(console.log("Bulk update failed, error:",i),i.status===404||((n=i.response)==null?void 0:n.status)===404){console.log("Bulk update endpoint not available (404), falling back to individual updates");const l=await this.getRehearsals({groupId:t});if(console.log(`Found ${l.length} rehearsals to update for orchestra ${t}`),l.length===0)return{updatedCount:0};let c=0;const u=l.map(async f=>{try{await this.updateRehearsal(f._id,s),c++,console.log(`Successfully updated rehearsal ${f._id}`)}catch(p){console.error(`Failed to update rehearsal ${f._id}:`,p)}});return await Promise.allSettled(u),console.log(`Fallback update completed: ${c} out of ${l.length} rehearsals updated`),{updatedCount:c}}throw i}},async bulkCreateRehearsals(t){try{if(!t.orchestraId)throw new Error("Orchestra ID is required for bulk rehearsal creation");if(!t.schoolYearId)throw new Error("School year ID is required for bulk rehearsal creation");if(!t.startDate||!t.endDate)throw new Error("Start date and end date are required for bulk rehearsal creation");const s=Number(t.dayOfWeek);if(isNaN(s)||s<0||s>6)throw new Error("Day of week must be a number between 0 and 6");const n={orchestraId:t.orchestraId,startDate:t.startDate,endDate:t.endDate,dayOfWeek:s,startTime:t.startTime,endTime:t.endTime,location:t.location,notes:t.notes||"",excludeDates:t.excludeDates||[],schoolYearId:t.schoolYearId};console.log("Sending bulk create data:",n);const i=localStorage.getItem("accessToken");if(!i)throw new Error("Authentication required for bulk rehearsal creation");return await ye.post("rehearsal/bulk-create",n,{headers:{Authorization:`Bearer ${i}`}})}catch(s){throw console.error("Error in bulk create:",s),s}},async updateAttendance(t,s){return ye.put(`rehearsal/${t}/attendance`,s)},async getAttendance(t){return ye.get(`rehearsal/${t}/attendance`)},formatDate(t){return t.toISOString().split("T")[0]},formatTime(t){return t.toTimeString().slice(0,5)},formatDateForDisplay(t){return new Date(t).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"})},formatTimeForDisplay(t){return t},calculateDuration(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u}},ot={async getStudents(t={}){return ye.get("student",t)},async getStudentById(t){return ye.get(`student/${t}`)},async getStudentsByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getStudentById(l).catch(c=>(console.error(`Failed to fetch student ${l}:`,c),null)));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Error fetching students by IDs:",s),[]}},async getStudentsByOrchestraId(t){return this.getStudents({orchestraId:t})},async getStudentsByTeacherId(t){return this.getStudents({teacherId:t})},async addStudent(t){const{_id:s,...n}=t;return ye.post("student",n)},async updateStudent(t,s){const{createdAt:n,updatedAt:i,...l}=s;return l._id&&delete l._id,l.teacherAssignments&&(l.teacherAssignments=l.teacherAssignments.map(c=>{const{createdAt:u,updatedAt:f,...p}=c;return p})),l.theoryLessonAssignments&&(l.theoryLessonAssignments=l.theoryLessonAssignments.map(c=>{const{createdAt:u,updatedAt:f,...p}=c;return p})),console.log(`Updating student with ID: ${t}`),console.log("Clean update data:",l),ye.put(`student/${t}`,l)},async removeStudent(t){return ye.delete(`student/${t}`)},async getStudentAttendanceStats(t,s){try{return ye.get(`orchestra/${t}/student/${s}/attendance`)}catch(n){return console.error("Failed to get student attendance stats:",n),{attendanceRate:0,attended:0,totalRehearsals:0,recentHistory:[],message:"Failed to load attendance data"}}},async updateStudentTest(t,s,n,i){try{console.log(`Sending test update request: Student ID ${t}, Instrument: ${s}, Test Type: ${n}, Status: ${i}`);const l={instrumentName:s,testType:n,status:i},c=await ye.put(`student/${t}/test`,l);return console.log("Test update successful, server response:",c),c}catch(l){throw console.error("Failed to update student test status:",l),new Error(l instanceof Error?l.message:"Failed to update test status")}},async updateStudentStage(t,s,n){console.log(`Sending stage update request: Student ID ${t}, Instrument: ${s}, Stage: ${n}`),console.log("Backend endpoints for stage update not available, using local update approach");try{const i=await this.getStudentById(t),l={...i,academicInfo:{...i.academicInfo,instrumentProgress:i.academicInfo.instrumentProgress.map(c=>c.instrumentName===s?{...c,currentStage:n}:c)}};return console.log("Stage update applied locally (UI will show the change)"),console.log("Note: Backend persistence requires implementing PUT /student/:id/stage endpoint"),l}catch(i){throw console.error("Failed to update student instrument stage:",i),new Error(i instanceof Error?i.message:"Failed to update instrument stage")}}},Ia={async getOrchestras(t={}){return ye.get("orchestra",t)},async getOrchestraById(t){return ye.get(`orchestra/${t}`)},async getOrchestrasByIds(t){return!t||t.length===0?[]:(await this.getOrchestras()).filter(n=>t.includes(n._id))},async getOrchestrasByConductorId(t){return this.getOrchestras({conductorId:t})},async getOrchestrasByStudentId(t){return this.getOrchestras({memberIds:t})},async addOrchestra(t){return ye.post("orchestra",t)},async updateOrchestra(t,s){const{_id:n,...i}=s;return ye.put(`orchestra/${t}`,i)},async removeOrchestra(t){return ye.delete(`orchestra/${t}`)},async addMember(t,s){try{const n=await ye.post(`orchestra/${t}/members`,{studentId:s}),i=await ot.getStudentById(s);return i.enrollments.orchestraIds.includes(t)||await ot.updateStudent(s,{enrollments:{...i.enrollments,orchestraIds:[...i.enrollments.orchestraIds,t]}}),n}catch(n){throw console.error("Error adding member to orchestra:",n),n}},async removeMember(t,s){try{const n=await ye.delete(`orchestra/${t}/members/${s}`),i=await ot.getStudentById(s);return await ot.updateStudent(s,{enrollments:{...i.enrollments,orchestraIds:i.enrollments.orchestraIds.filter(l=>l!==t)}}),n}catch(n){throw console.error("Error removing member from orchestra:",n),n}},async updateMembers(t,s,n=[]){try{const i=await this.updateOrchestra(t,{memberIds:s}),l=s.filter(u=>!n.includes(u)),c=n.filter(u=>!s.includes(u));for(const u of l){const f=await ot.getStudentById(u);f.enrollments.orchestraIds.includes(t)||await ot.updateStudent(u,{enrollments:{...f.enrollments,orchestraIds:[...f.enrollments.orchestraIds,t]}})}for(const u of c){const f=await ot.getStudentById(u);await ot.updateStudent(u,{enrollments:{...f.enrollments,orchestraIds:f.enrollments.orchestraIds.filter(p=>p!==t)}})}return i}catch(i){throw console.error("Error updating orchestra members:",i),i}},async getRehearsalAttendance(t,s){return ye.get(`orchestra/${t}/rehearsals/${s}/attendance`)},async updateRehearsalAttendance(t,s,n){return ye.put(`orchestra/${t}/rehearsals/${s}/attendance`,n)},async getStudentAttendanceStats(t,s){return ye.get(`orchestra/${t}/student/${s}/attendance`)},async syncOrchestraMembers(t){try{const s=await this.getOrchestraById(t),l=(await ot.getStudents()).filter(f=>f.enrollments.orchestraIds.includes(t)).map(f=>f._id),c=l.filter(f=>!s.memberIds.includes(f)),u=s.memberIds.filter(f=>!l.includes(f));if(c.length>0){const f=[...s.memberIds,...c];await this.updateOrchestra(t,{memberIds:f})}for(const f of u){const p=await ot.getStudentById(f);await ot.updateStudent(f,{enrollments:{...p.enrollments,orchestraIds:p.enrollments.orchestraIds.filter(m=>m!==t)}})}}catch(s){throw console.error("Error syncing orchestra members:",s),s}},getOrchestraTypeDisplay(t){return{תזמורת:"תזמורת",הרכב:"הרכב"}[t]||t},getValidOrchestraTypes(){return["תזמורת","הרכב"]},getValidOrchestraNames(){return["תזמורת מתחילים נשיפה","תזמורת עתודה נשיפה","תזמורת צעירה נשיפה","תזמורת יצוגית נשיפה","תזמורת סימפונית"]}};function $C({isOpen:t,onClose:s,orchestraId:n,orchestraName:i,mode:l}){const[c,u]=x.useState(null),[f,p]=x.useState([]),[m,y]=x.useState(""),[v,j]=x.useState(!1),[N,b]=x.useState(null);x.useEffect(()=>{t&&(u(null),C(null),y(""),b(null),l==="last"?w():l==="by-date"&&A())},[t,n,l]);const w=async()=>{j(!0),b(null);try{const E=await Zs.getRehearsals({groupId:n});if(E.length===0){b("לא נמצאו חזרות עבור תזמורת זו");return}const _=new Date,k=E.filter(M=>{const X=new Date(M.date)<_,W=M.attendance&&(M.attendance.present||M.attendance.absent);return X&&W}).sort((M,G)=>new Date(G.date).getTime()-new Date(M.date).getTime());if(k.length===0){b("לא נמצאו חזרות שכבר התקיימו עם נתוני נוכחות עבור תזמורת זו");return}const z=k[0];await D(z._id)}catch(E){console.error("Failed to load last rehearsal attendance:",E),b("שגיאה בטעינת נתוני הנוכחות האחרונים")}finally{j(!1)}},A=async()=>{j(!0),b(null);try{const E=await Zs.getRehearsals({groupId:n}),_=new Date,k=E.filter(z=>{const G=new Date(z.date)<_,X=z.attendance&&(z.attendance.present||z.attendance.absent);return G&&X}).sort((z,M)=>new Date(M.date).getTime()-new Date(z.date).getTime());p(k),k.length===0&&b("לא נמצאו חזרות שכבר התקיימו עם נתוני נוכחות עבור תזמורת זו")}catch(E){console.error("Failed to load available rehearsals:",E),b("שגיאה בטעינת רשימת החזרות")}finally{j(!1)}},[S,C]=x.useState(null),D=async E=>{j(!0),b(null);try{const[_,k]=await Promise.all([Zs.getRehearsalById(E),Ia.getOrchestraById(n)]);if(C(_),!_.attendance||!_.attendance.present&&!_.attendance.absent){b("לא נמצאו נתוני נוכחות עבור חזרה זו");return}const z=[..._.attendance.present||[],..._.attendance.absent||[]];console.log("All student IDs:",z);const M=z.map(async le=>{try{const O=await ot.getStudentById(le);return console.log("Fetched student:",O),O}catch(O){return console.error("Failed to fetch student:",le,O),{_id:le,personalInfo:{fullName:`תלמיד ${le.slice(-4)}`},academicInfo:{instrumentProgress:[],class:""},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}}),G=await Promise.all(M),X=new Map(G.map(le=>[le._id,le])),W=le=>({_id:le,personalInfo:{fullName:`תלמיד ${le.slice(-4)}`},academicInfo:{instrumentProgress:[],class:""},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),te=(_.attendance.present||[]).map(le=>{const O=X.get(le)||W(le);return console.log("Present student mapped:",O),O}),L=(_.attendance.absent||[]).map(le=>{const O=X.get(le)||W(le);return console.log("Absent student mapped:",O),O}),J=k.memberIds?k.memberIds.length:te.length+L.length,K=J>0?Math.round(te.length/J*100):0;u({rehearsalId:_._id,rehearsalDate:_.date,orchestraName:k.name,present:te,absent:L,totalStudents:J,attendanceRate:K})}catch(_){console.error("Failed to load attendance data:",_),b("שגיאה בטעינת נתוני הנוכחות")}finally{j(!1)}},I=E=>{y(E),D(E)},T=E=>new Date(E).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),R=E=>E.startTime&&E.endTime?`${E.startTime} - ${E.endTime}`:new Date(E.date).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"});return e.jsx(Ua,{isOpen:t,onClose:s,children:e.jsxs("div",{className:"attendance-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title-section",children:[e.jsxs("h3",{className:"modal-title",children:["נוכחות - ",i]}),e.jsx("p",{className:"modal-subtitle",children:l==="last"?"נוכחות אחרונה":"נוכחות לפי תאריך"})]}),e.jsx("button",{className:"modal-close-btn",onClick:s,children:e.jsx(Nt,{size:20})})]}),l==="by-date"&&!c&&e.jsxs("div",{className:"rehearsal-selector",children:[e.jsx("h4",{children:"בחר חזרה:"}),v?e.jsx("div",{className:"loading-state",children:"טוען חזרות..."}):N?e.jsx("div",{className:"error-state",children:N}):e.jsx("div",{className:"rehearsal-list",children:f.map(E=>e.jsxs("button",{className:"rehearsal-item",onClick:()=>I(E._id),children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:16}),e.jsx("span",{children:T(E.date)})]}),e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:R(E)})]})]},E._id))})]}),c&&e.jsxs("div",{className:"attendance-details",children:[e.jsxs("div",{className:"attendance-header",children:[e.jsxs("div",{className:"rehearsal-info",children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:18}),e.jsx("span",{children:T(c.rehearsalDate)})]}),e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:16}),e.jsx("span",{children:R(S||{date:c.rehearsalDate})})]})]}),e.jsxs("div",{className:"attendance-summary",children:[e.jsxs("div",{className:`attendance-rate ${c.attendanceRate>=80?"success":c.attendanceRate>=60?"warning":"danger"}`,children:[c.attendanceRate,"%"]}),e.jsx("div",{className:"attendance-stats",children:e.jsxs("span",{children:[c.present.length," נוכחים מתוך ",c.totalStudents]})})]})]}),e.jsxs("div",{className:"attendance-lists",children:[e.jsxs("div",{className:"present-students",children:[e.jsxs("div",{className:"list-header",children:[e.jsx(bE,{size:18,className:"present-icon"}),e.jsxs("h4",{children:["נוכחים (",c.present.length,")"]})]}),e.jsx("div",{className:"students-list",children:c.present.map(E=>{var _;return console.log("Present student:",E),e.jsx("div",{className:"student-item present",children:e.jsx("div",{className:"student-name",children:((_=E.personalInfo)==null?void 0:_.fullName)||`תלמיד ${E._id.slice(-4)}`})},E._id)})})]}),e.jsxs("div",{className:"absent-students",children:[e.jsxs("div",{className:"list-header",children:[e.jsx(TE,{size:18,className:"absent-icon"}),e.jsxs("h4",{children:["נעדרים (",c.absent.length,")"]})]}),e.jsx("div",{className:"students-list",children:c.absent.map(E=>{var _;return console.log("Absent student:",E),e.jsx("div",{className:"student-item absent",children:e.jsx("div",{className:"student-name",children:((_=E.personalInfo)==null?void 0:_.fullName)||`תלמיד ${E._id.slice(-4)}`})},E._id)})})]})]}),l==="by-date"&&e.jsx("button",{className:"back-btn",onClick:()=>{u(null),y("")},children:"חזור לבחירת חזרה"})]}),v&&l==="last"&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען נתוני נוכחות..."})]}),N&&l==="last"&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:N}),e.jsx("button",{onClick:w,children:"נסה שוב"})]})]})})}const dl={markAttendance:async(t,s)=>{if(!t)throw new Error("מזהה שיעור חסר או לא תקין");if(!s.status)throw new Error("סטטוס נוכחות חסר");try{return await ye.put(`lessons/${t}/attendance`,s)}catch(n){console.error("Error marking attendance:",n);const i=Ca(n);throw new Error(i.userMessage||"שגיאה בעידכון הנוכחות")}},getLessonAttendance:async t=>{var s;if(!t)throw new Error("מזהה שיעור חסר או לא תקין");try{return await ye.get(`lessons/${t}/attendance`)}catch(n){if(((s=n==null?void 0:n.response)==null?void 0:s.status)===404||(n==null?void 0:n.status)===404)return null;console.error("Error loading lesson attendance:",n);const i=Ca(n);throw new Error(i.userMessage||"שגיאה בטעינת נתוני הנוכחות")}},getStudentStats:async(t,s)=>{if(!t)throw new Error("מזהה תלמיד חסר או לא תקין");try{const n=s?{teacherId:s}:{};return await ye.get(`students/${t}/private-lesson-attendance`,n)}catch(n){console.error("Error loading student attendance stats:",n);const i=Ca(n);throw new Error(i.userMessage||"שגיאה בטעינת סטטיסטיקות הנוכחות")}},getTeacherDashboard:async(t,s)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");try{return await ye.get(`analytics/teachers/${t}/attendance`,s||{})}catch(n){console.error("Error loading teacher dashboard:",n);const i=Ca(n);throw new Error(i.userMessage||"שגיאה בטעינת לוח הבקרה")}},getStudentAttendanceHistory:async(t,s,n)=>{if(!t)throw new Error("מזהה תלמיד חסר או לא תקין");try{const i={};return s&&(i.teacherId=s),n&&n>0&&(i.limit=Math.min(n,1e3)),await ye.get(`students/${t}/attendance-history`,i)}catch(i){console.error("Error loading attendance history:",i);const l=Ca(i);throw new Error(l.userMessage||"שגיאה בטעינת היסטוריית הנוכחות")}},bulkMarkAttendance:async(t,s)=>{if(!t)throw new Error("מזהה שיעור חסר או לא תקין");if(!s||s.length===0)throw new Error("רשימת נוכחות ריקה");for(const n of s){if(!n.studentId)throw new Error("מזהה תלמיד חסר ברשימת הנוכחות");if(!n.status)throw new Error("סטטוס נוכחות חסר ברשימת הנוכחות")}try{return await ye.put(`attendance/lessons/${t}/bulk`,{attendanceList:s})}catch(n){console.error("Error bulk marking attendance:",n);const i=Ca(n);throw new Error(i.userMessage||"שגיאה בעידכון נוכחות קבוצתי")}},getTeacherAttendanceOverview:async(t,s,n)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");try{const i={};s&&(i.startDate=s),n&&(i.endDate=n);const l=await ye.get(`teachers/${t}/lesson-attendance-summary`,i);return!l||typeof l!="object"?(console.warn("Invalid response format from teacher attendance overview API:",l),{teacherId:t,dateRange:{startDate:"",endDate:""},overallStats:{totalLessons:0,attendedLessons:0,missedLessons:0,cancelledLessons:0,attendanceRate:0},studentStats:{}}):l}catch(i){console.error("Error loading teacher attendance overview:",i);const l=Ca(i);throw new Error(l.userMessage||"שגיאה בטעינת סקירת נוכחות המורה")}},getAttendanceSummary:async(t,s,n)=>{if(!t)throw new Error("מזהה מורה חסר או לא תקין");if(!s||!n)throw new Error("תאריכי טווח חסרים");const i=new Date(s),l=new Date(n);if(isNaN(i.getTime())||isNaN(l.getTime()))throw new Error("פורמט תאריך לא תקין");if(i>l)throw new Error("תאריך התחלה חייב להיות לפני תאריך הסיום");const c=365*24*60*60*1e3;if(l.getTime()-i.getTime()>c)throw new Error("טווח תאריכים גדול מדי (מקסימום שנה)");try{return await ye.get(`analytics/teachers/${t}/attendance/summary`,{startDate:s,endDate:n})}catch(u){console.error("Error loading attendance summary:",u);const f=Ca(u);throw new Error(f.userMessage||"שגיאה בטעינת סיכום הנוכחות")}},getAllTeachers:async()=>{try{return await ye.get("teacher")}catch(t){console.error("Error loading teachers:",t);const s=Ca(t);throw new Error(s.userMessage||"שגיאה בטעינת רשימת המורים")}}},RC=({isOpen:t,onClose:s,teacherId:n,teacherName:i})=>{const[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState(null);x.useEffect(()=>{t&&n?y():(c(null),m(null))},[t,n]);const y=async()=>{var A,S,C,D,I;f(!0),m(null);try{console.log(`Loading teacher attendance modal data for: ${i} (${n})`);const T=await dl.getTeacherAttendanceOverview(n);if(console.log(`Teacher modal data for ${i}:`,JSON.stringify(T,null,2)),T&&typeof T=="object"){const R={teacherId:T.teacherId||n,dateRange:T.dateRange||{startDate:"",endDate:""},overallStats:{totalLessons:((A=T.overallStats)==null?void 0:A.totalLessons)||0,attendedLessons:((S=T.overallStats)==null?void 0:S.attendedLessons)||0,missedLessons:((C=T.overallStats)==null?void 0:C.missedLessons)||0,cancelledLessons:((D=T.overallStats)==null?void 0:D.cancelledLessons)||0,attendanceRate:((I=T.overallStats)==null?void 0:I.attendanceRate)||0},studentStats:T.studentStats||{}};c(R)}else console.warn(`Invalid response format for teacher ${i}:`,T),m("מבנה נתונים לא תקין מהשרת")}catch(T){console.error(`Error loading teacher modal data for ${i}:`,T),m(T.message||"שגיאה בטעינת נתוני נוכחות המורה")}finally{f(!1)}},v=A=>typeof A=="string"?A:`${Math.round(A)}%`,j=A=>{const S=typeof A=="string"?parseFloat(A):A;return S>=90?"success":S>=80?"warning":(S>=70,"danger")},N=A=>(typeof A=="string"?parseFloat(A):A)>=80?e.jsx(ll,{size:16,className:"attendance-icon success"}):e.jsx(Md,{size:16,className:"attendance-icon danger"}),b=A=>{const S=new Date(A.startDate),C=new Date(A.endDate),D=I=>I.toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"});return`${D(S)} - ${D(C)}`},w=()=>{if(!(l!=null&&l.studentStats))return e.jsxs("div",{className:"no-students",children:[e.jsx(ms,{size:48,className:"no-data-icon"}),e.jsx("p",{children:"אין נתוני נוכחות זמינים"})]});const A=Object.entries(l.studentStats);return A.length===0?e.jsxs("div",{className:"no-students",children:[e.jsx(ms,{size:48,className:"no-data-icon"}),e.jsx("p",{children:"אין תלמידים עם נתוני נוכחות בתקופה זו"})]}):e.jsx("div",{className:"students-grid",children:A.map(([S,C])=>e.jsxs("div",{className:"student-attendance-card",children:[e.jsxs("div",{className:"student-header",children:[e.jsx("div",{className:"student-avatar",children:e.jsx(Je,{size:24})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h4",{className:"student-name",children:C.studentName}),e.jsxs("div",{className:`attendance-rate ${j(C.attendanceRate)}`,children:[N(parseFloat(C.attendanceRate)),e.jsx("span",{children:v(C.attendanceRate)})]})]})]}),e.jsxs("div",{className:"student-metrics",children:[e.jsx("div",{className:"metric-row",children:e.jsxs("div",{className:"metric",children:[e.jsx(Zt,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:'סה"כ שיעורים'}),e.jsx("span",{className:"metric-value",children:C.totalLessons})]})}),e.jsxs("div",{className:"metric-row",children:[e.jsxs("div",{className:"metric success",children:[e.jsx(ll,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:"הגיעו"}),e.jsx("span",{className:"metric-value",children:C.attendedLessons})]}),e.jsxs("div",{className:"metric danger",children:[e.jsx(Md,{size:16,className:"metric-icon"}),e.jsx("span",{className:"metric-label",children:"חסרו"}),e.jsx("span",{className:"metric-value",children:C.missedLessons})]})]})]})]},S))})};return e.jsx(Ua,{isOpen:t,onClose:s,children:e.jsxs("div",{className:"teacher-attendance-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("div",{className:"teacher-avatar",children:e.jsx(Je,{size:32})}),e.jsxs("div",{className:"teacher-details",children:[e.jsx("h2",{children:i}),e.jsx("span",{className:"teacher-label",children:"נוכחות שיעורים פרטיים"})]})]}),(l==null?void 0:l.dateRange)&&e.jsxs("div",{className:"date-range",children:[e.jsx($e,{size:16}),e.jsx("span",{children:b(l.dateRange)})]})]}),e.jsx("button",{className:"close-btn",onClick:s,children:e.jsx(Nt,{size:24})})]}),e.jsxs("div",{className:"modal-content",children:[u&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"טוען נתוני נוכחות..."})]}),p&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:p}),e.jsx("button",{onClick:y,className:"retry-btn",children:"נסה שוב"})]}),l&&!u&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-section",children:[e.jsx("h3",{children:"סטטיסטיקות כלליות"}),l.overallStats.totalLessons>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Zt,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.totalLessons}),e.jsx("div",{className:"stat-label",children:'סה"כ שיעורים'})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ll,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.attendedLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שהתקיימו"})]})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Md,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.missedLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שלא התקיימו"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:l.overallStats.cancelledLessons}),e.jsx("div",{className:"stat-label",children:"שיעורים שבוטלו"})]})]})]}),e.jsx("div",{className:"overall-attendance-rate",children:e.jsxs("div",{className:`attendance-rate-display ${j(l.overallStats.attendanceRate)}`,children:[N(l.overallStats.attendanceRate),e.jsx("span",{className:"rate-value",children:v(l.overallStats.attendanceRate)}),e.jsx("span",{className:"rate-label",children:"אחוז נוכחות כללי"})]})})]}):e.jsxs("div",{className:"no-data-state",style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[e.jsx(Zt,{size:48,style:{marginBottom:"16px",opacity:.5}}),e.jsx("h4",{children:"אין נתוני נוכחות"}),e.jsx("p",{children:"לא נמצאו שיעורים פרטיים עבור המורה בתקופה זו"})]})]}),l.overallStats.totalLessons>0&&e.jsxs("div",{className:"students-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"נוכחות תלמידים"}),e.jsxs("span",{className:"students-count",children:[Object.keys(l.studentStats||{}).length," תלמידים"]})]}),w()]})]})]})]})})},MC=({className:t=""})=>{var le;const[s,n]=x.useState([]),[i,l]=x.useState(""),[c,u]=x.useState(""),[f,p]=x.useState(null),[m,y]=x.useState([]),[v,j]=x.useState({}),[N,b]=x.useState(!1),[w,A]=x.useState(!1),[S,C]=x.useState(null),[D,I]=x.useState({isOpen:!1,teacherId:"",teacherName:""});x.useEffect(()=>{T()},[]),x.useEffect(()=>{s.length>0&&R()},[s]);const T=async()=>{try{b(!0),console.log("Loading all teachers...");const O=await dl.getAllTeachers();console.log("Raw teachers data:",O);const U=O.filter(Y=>Y.isActive);console.log("Active teachers:",U.map(Y=>({name:Y.personalInfo.fullName,id:Y._id}))),n(U)}catch(O){console.error("Error loading teachers:",O),C(O.message||"שגיאה בטעינת רשימת המורים")}finally{b(!1)}},R=()=>{if(s.length===0)return;const U=[...s].sort(()=>.5-Math.random()).slice(0,Math.min(5,s.length));y(U),E(U)},E=async O=>{var Y,Z;const U={};A(!0),console.log("Loading data for teachers:",O.map(H=>{var P;return((P=H.personalInfo)==null?void 0:P.fullName)||H._id}));for(const H of O)try{const P=((Y=H.personalInfo)==null?void 0:Y.fullName)||H._id;console.log(`Loading attendance data for teacher: ${P} (${H._id})`);const q=await dl.getTeacherAttendanceOverview(H._id);console.log(`Attendance data for ${P}:`,JSON.stringify(q,null,2)),q&&q.overallStats&&q.studentStats?U[H._id]=q:console.warn(`Invalid data structure for teacher ${P}:`,q)}catch(P){const q=((Z=H.personalInfo)==null?void 0:Z.fullName)||H._id;console.error(`Error loading data for teacher ${q} (${H._id}):`,P)}console.log("Final random teachers data:",U),j(U),A(!1)},_=async O=>{if(!O)return;const U=s.find(Z=>Z._id===O),Y=(U==null?void 0:U.personalInfo.fullName)||O;try{b(!0),C(null),console.log(`Loading selected teacher data for: ${Y} (${O})`);const Z=await dl.getTeacherAttendanceOverview(O);console.log(`Selected teacher data for ${Y}:`,Z),p(Z)}catch(Z){console.error(`Error loading teacher attendance data for ${Y}:`,Z),C(Z.message||"שגיאה בטעינת נתוני נוכחות המורה"),p(null)}finally{b(!1)}},k=x.useMemo(()=>{if(!c.trim())return[];const O=c.toLowerCase().trim();return s.filter(U=>{var H,P,q,B;const Y=((P=(H=U.personalInfo)==null?void 0:H.fullName)==null?void 0:P.toLowerCase())||"",Z=((B=(q=U.personalInfo)==null?void 0:q.email)==null?void 0:B.toLowerCase())||"";return Y.includes(O)||Z.includes(O)}).slice(0,10)},[s,c]),z=O=>{l(O),u(""),C(null),_(O)},M=O=>{O.key==="Escape"?u(""):O.key==="Enter"&&k.length===1&&z(k[0]._id)},G=(O,U)=>{I({isOpen:!0,teacherId:O,teacherName:U})},X=()=>{I({isOpen:!1,teacherId:"",teacherName:""})},W=O=>typeof O=="string"?O:`${Math.round(O)}%`,te=O=>{const U=typeof O=="string"?parseFloat(O):O;return U>=90?"text-green-500":U>=80?"text-yellow-500":U>=70?"text-orange-500":"text-red-500"},L=O=>(typeof O=="string"?parseFloat(O):O)>=80?e.jsx(ll,{size:16,className:"text-green-500"}):e.jsx(Md,{size:16,className:"text-red-500"}),J=(O,U)=>{var P;const Y=U?Object.keys(U.studentStats).length:0,Z=(U==null?void 0:U.overallStats.attendanceRate)||0,H=U&&U.overallStats.totalLessons>0;return e.jsxs("div",{className:"teacher-card",onClick:()=>G(O._id,O.personalInfo.fullName),children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("h4",{className:"teacher-name",children:((P=O.personalInfo)==null?void 0:P.fullName)||"ללא שם"}),e.jsx("div",{className:"teacher-stats",children:H?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(ms,{size:14}),e.jsxs("span",{children:[Y," תלמידים"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(Zt,{size:14}),e.jsxs("span",{children:[U.overallStats.totalLessons," שיעורים"]})]}),e.jsxs("div",{className:`stat-item attendance-rate ${te(Z)}`,children:[L(Z),e.jsx("span",{children:W(Z)})]})]}):e.jsx("div",{className:"stat-item no-data",children:e.jsx("span",{style:{color:"#666",fontSize:"0.9em"},children:"אין נתוני נוכחות"})})})]}),e.jsx("div",{className:"click-hint",children:"לחץ לפרטים מלאים"})]},O._id)},K=O=>{const U=Object.entries(O);return U.length===0?e.jsx("div",{className:"no-students",children:"אין תלמידים בתקופה זו"}):e.jsx("div",{className:"student-stats-grid",children:U.map(([Y,Z])=>e.jsxs("div",{className:"student-stat-card",children:[e.jsx("div",{className:"student-name",children:Z.studentName}),e.jsxs("div",{className:"student-attendance-details",children:[e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"שיעורים:"}),e.jsx("span",{className:"metric-value",children:Z.totalLessons})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"הגיעו:"}),e.jsx("span",{className:"metric-value text-green-500",children:Z.attendedLessons})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("span",{className:"metric-label",children:"חסרו:"}),e.jsx("span",{className:"metric-value text-red-500",children:Z.missedLessons})]}),e.jsxs("div",{className:`attendance-rate ${te(Z.attendanceRate)}`,children:[L(parseFloat(Z.attendanceRate)),e.jsx("span",{children:W(Z.attendanceRate)})]})]})]},Y))})};return e.jsxs("div",{className:`teacher-attendance-section ${t}`,children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"נוכחות מורים ותלמידים"}),e.jsx("span",{className:"section-count",children:s.length})]}),e.jsxs("div",{className:"teacher-selection",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(pr,{size:18,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"חפש מורה לפי שם או אימייל...",value:c,onChange:O=>u(O.target.value),onKeyDown:M,className:"teacher-search-input",autoComplete:"off"})]}),c&&e.jsx("div",{className:"search-results",children:k.length>0?e.jsx("div",{className:"teacher-list",children:k.map(O=>{var U,Y;return e.jsxs("button",{className:"teacher-option",onClick:()=>z(O._id),children:[e.jsx("span",{className:"teacher-name",children:((U=O.personalInfo)==null?void 0:U.fullName)||"ללא שם"}),((Y=O.personalInfo)==null?void 0:Y.email)&&e.jsx("span",{className:"teacher-email",children:O.personalInfo.email})]},O._id)})}):e.jsxs("div",{className:"no-results",children:['לא נמצאו מורים התואמים לחיפוש "',c,'"']})})]}),i&&f&&e.jsxs("div",{className:"selected-teacher-details",children:[e.jsxs("div",{className:"selected-teacher-header",children:[e.jsxs("h4",{children:["פרטי נוכחות - ",(le=s.find(O=>O._id===i))==null?void 0:le.personalInfo.fullName]}),e.jsx("button",{className:"close-details",onClick:()=>{l(""),p(null)},children:"✕"})]}),e.jsxs("div",{className:"overall-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:'סה"כ שיעורים'}),e.jsx("div",{className:"stat-value",children:f.overallStats.totalLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"שיעורים שהתקיימו"}),e.jsx("div",{className:"stat-value text-green-500",children:f.overallStats.attendedLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"שיעורים שלא התקיימו"}),e.jsx("div",{className:"stat-value text-red-500",children:f.overallStats.missedLessons})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"אחוז נוכחות"}),e.jsx("div",{className:`stat-value ${te(f.overallStats.attendanceRate)}`,children:W(f.overallStats.attendanceRate)})]})]}),e.jsxs("div",{className:"student-stats-section",children:[e.jsx("h5",{children:"נוכחות תלמידים"}),K(f.studentStats)]})]}),!i&&e.jsxs("div",{className:"random-teachers-section",children:[e.jsxs("div",{className:"section-subheader",children:[e.jsx("h4",{children:"מורים נבחרים"}),e.jsx("button",{className:"refresh-btn",onClick:R,disabled:N,children:"↻ רענן"})]}),N?e.jsx("div",{className:"loading-state",children:"טוען נתוני מורים..."}):S?e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:S}),e.jsx("button",{onClick:T,className:"retry-btn",children:"נסה שוב"})]}):e.jsxs(e.Fragment,{children:[w&&e.jsx("div",{className:"loading-notice",style:{padding:"12px",backgroundColor:"#e7f3ff",border:"1px solid #b3d9ff",borderRadius:"6px",marginBottom:"16px",textAlign:"center",color:"#0066cc"},children:"טוען נתוני נוכחות..."}),e.jsx("div",{className:"teachers-grid",children:m.map(O=>J(O,v[O._id]))})]})]}),e.jsx(RC,{isOpen:D.isOpen,onClose:X,teacherId:D.teacherId,teacherName:D.teacherName})]})};function Kf({title:t,value:s,subtitle:n,icon:i,variant:l="default",onClick:c}){const u={default:"attendance-card-default",success:"attendance-card-success",warning:"attendance-card-warning",danger:"attendance-card-danger"};return e.jsxs("div",{className:`attendance-overview-card ${u[l]} ${c?"clickable":""}`,onClick:c,children:[e.jsx("div",{className:"card-icon",children:e.jsx(i,{size:24})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"card-value",children:s}),e.jsx("div",{className:"card-title",children:t}),n&&e.jsx("div",{className:"card-subtitle",children:n})]}),c&&e.jsx(Xm,{size:16,className:"card-arrow"})]})}function zC({orchestraName:t,orchestraId:s,attendanceRate:n,totalRehearsals:i,totalStudents:l,lowAttendanceCount:c,onViewLastAttendance:u,onViewByDate:f}){const p=m=>m>=80?"success":m>=60?"warning":"danger";return e.jsxs("div",{className:"orchestra-attendance-card",children:[e.jsxs("div",{className:"orchestra-header",children:[e.jsxs("div",{className:"orchestra-info",children:[e.jsx("h4",{className:"orchestra-name",children:t}),e.jsxs("div",{className:"orchestra-stats",children:[e.jsxs("span",{children:[l," תלמידים"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i," חזרות"]})]})]}),e.jsxs("div",{className:`attendance-rate ${p(n)}`,children:[n,"%"]})]}),c>0&&e.jsxs("div",{className:"low-attendance-alert",children:[e.jsx(oi,{size:14}),e.jsxs("span",{children:[c," חזרות עם נוכחות נמוכה"]})]}),e.jsx("div",{className:"orchestra-actions",children:e.jsxs("div",{className:"attendance-buttons",children:[e.jsxs("button",{className:"attendance-btn last-attendance",onClick:()=>u(s,t),children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"נוכחות אחרונה"})]}),e.jsxs("button",{className:"attendance-btn by-date",onClick:()=>f(s,t),children:[e.jsx(fT,{size:14}),e.jsx("span",{children:"לפי תאריך"})]})]})})]})}function LC({orchestraName:t,rehearsalDate:s,attendanceRate:n,onViewRehearsal:i,rehearsalId:l,isNewlyAdded:c=!1}){const u=f=>new Date(f).toLocaleDateString("he-IL",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:`low-attendance-item clickable ${c?"newly-added":""}`,onClick:()=>i(l),children:[e.jsxs("div",{className:"low-attendance-info",children:[e.jsx("div",{className:"orchestra-name",children:t}),e.jsx("div",{className:"rehearsal-date",children:u(s)})]}),e.jsxs("div",{className:"attendance-rate danger",children:[n,"%"]})]})}function BC(){const t=_t(),{dashboardData:s,isLoadingDashboard:n,error:i,loadDashboardData:l,clearError:c}=IC(),[u,f]=x.useState(5),[p,m]=x.useState(!1),[y,v]=x.useState(new Set),[j,N]=x.useState({isOpen:!1,orchestraId:"",orchestraName:"",mode:"last"});x.useEffect(()=>{l()},[l]),x.useEffect(()=>{s&&(f(5),v(new Set))},[s]);const b=E=>{t(`/rehearsals/${E}`)},w=()=>{t("/rehearsals")},A=(E,_)=>{N({isOpen:!0,orchestraId:E,orchestraName:_,mode:"last"})},S=(E,_)=>{N({isOpen:!0,orchestraId:E,orchestraName:_,mode:"by-date"})},C=()=>{N({isOpen:!1,orchestraId:"",orchestraName:"",mode:"last"})},D=async()=>{if(!s||p)return;m(!0),await new Promise(z=>setTimeout(z,500));const E=u,_=Math.min(E+5,s.recentLowAttendance.length),k=new Set;for(let z=E;z<_;z++)k.add(z);v(k),f(_),m(!1),setTimeout(()=>{v(new Set)},600)};if(n)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsx("div",{className:"loading-state",children:"טוען נתוני נוכחות..."})]});if(i)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:i}),e.jsx("button",{onClick:()=>{c(),l()},children:"נסה שוב"})]})]});if(!s)return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("h2",{children:"נוכחות ותחזוקה"})}),e.jsx("div",{className:"empty-state",children:"אין נתוני נוכחות זמינים"})]});const{overallStats:I,orchestraOverviews:T,recentLowAttendance:R}=s;return e.jsxs("div",{className:"attendance-dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"נוכחות ותחזוקה"}),e.jsx("div",{className:"dashboard-subtitle",children:"סקירה כללית של נוכחות בחזרות"})]}),e.jsxs("div",{className:"overview-cards",children:[e.jsx(Kf,{title:"תזמורות פעילות",value:I.totalOrchestras,icon:Ke}),e.jsx(Kf,{title:"חזרות החודש",value:I.totalRehearsals,icon:$e,onClick:w}),e.jsx(Kf,{title:"ממוצע נוכחות",value:`${I.averageAttendanceRate}%`,icon:ll,variant:I.averageAttendanceRate>=80?"success":I.averageAttendanceRate>=60?"warning":"danger"})]}),e.jsxs("div",{className:"dashboard-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"נוכחות לפי תזמורת"})}),T.length>0?e.jsx("div",{className:"orchestra-cards",children:T.map(E=>e.jsx(zC,{orchestraName:E.orchestraName,orchestraId:E.orchestraId,attendanceRate:E.averageAttendanceRate,totalRehearsals:E.totalRehearsals,totalStudents:E.totalStudents,lowAttendanceCount:E.lowAttendanceAlerts.length,onViewLastAttendance:A,onViewByDate:S},E.orchestraId))}):e.jsx("div",{className:"empty-section",children:"אין תזמורות זמינות"})]}),R.length>0&&e.jsxs("div",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"חזרות אחרונות"}),e.jsx("span",{className:"section-count",children:R.length})]}),e.jsx("div",{className:"low-attendance-list",children:R.slice(0,u).map((E,_)=>e.jsx(LC,{orchestraName:E.orchestraName,rehearsalDate:E.rehearsalDate,attendanceRate:E.attendanceRate,rehearsalId:E.rehearsalId,onViewRehearsal:b,isNewlyAdded:y.has(_)},`${E.rehearsalId}-${_}`))}),u<R.length&&e.jsx("button",{className:`view-more-btn ${p?"loading":""}`,onClick:D,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"טוען..."]}):`הצג עוד ${Math.min(5,R.length-u)} חזרות`})]}),e.jsx("div",{className:"dashboard-section",children:e.jsx(MC,{})}),e.jsx($C,{isOpen:j.isOpen,onClose:C,orchestraId:j.orchestraId,orchestraName:j.orchestraName,mode:j.mode})]})}const FC={async getPastActivities(t={}){try{if(t.type==="private-lessons"&&!t.teacherId)throw new Error("Teacher ID is required when filtering by private lessons");if(t.startDate&&!Bx(t.startDate))throw new Error("Start date must be in YYYY-MM-DD format");if(t.endDate&&!Bx(t.endDate))throw new Error("End date must be in YYYY-MM-DD format");if(t.teacherId&&!Jf(t.teacherId))throw new Error("Invalid teacher ID format");if(t.studentId&&!Jf(t.studentId))throw new Error("Invalid student ID format");if(t.orchestraId&&!Jf(t.orchestraId))throw new Error("Invalid orchestra ID format");const s={};t.type&&t.type!=="all"&&(s.type=t.type),t.teacherId&&(s.teacherId=t.teacherId),t.studentId&&(s.studentId=t.studentId),t.orchestraId&&(s.orchestraId=t.orchestraId),t.category&&(s.category=t.category),t.startDate&&(s.startDate=t.startDate),t.endDate&&(s.endDate=t.endDate),t.limit&&(s.limit=Math.min(t.limit,1e3)),t.page&&(s.page=Math.max(1,t.page));const n=await ye.get("admin/past-activities",s);if(n&&n.success&&n.data)return n;if(Array.isArray(n))return{success:!0,data:n,pagination:{currentPage:1,totalPages:1,totalCount:n.length,hasNextPage:!1,hasPreviousPage:!1},summary:{totalCount:n.length,rehearsalsCount:n.filter(i=>i.activityType==="rehearsal").length,theoryCount:n.filter(i=>i.activityType==="theory").length,privateLessonsCount:n.filter(i=>i.activityType==="private-lesson").length,dateRange:{from:t.startDate||"",to:t.endDate||""}}};throw new Error("Unexpected response format from past activities API")}catch(s){throw console.error("Failed to get past activities:",s),s instanceof Error?s:new Error("Failed to load past activities. Please try again later.")}},async getPastActivitiesByType(t,s={}){try{if(t==="private-lessons"&&!s.teacherId)throw new Error("Teacher ID is required when fetching private lessons");const n={...s};Object.keys(n).forEach(c=>{n[c]===void 0&&delete n[c]});const i=`admin/past-activities/${t}`,l=await ye.get(i,n);if(l&&l.success&&l.data)return l;if(Array.isArray(l))return{success:!0,data:l,pagination:{currentPage:1,totalPages:1,totalCount:l.length,hasNextPage:!1,hasPreviousPage:!1},summary:{totalCount:l.length,rehearsalsCount:t==="rehearsals"?l.length:0,theoryCount:t==="theory"?l.length:0,privateLessonsCount:t==="private-lessons"?l.length:0,dateRange:{from:s.startDate||"",to:s.endDate||""}}};throw new Error("Unexpected response format from past activities API")}catch(n){throw console.error(`Failed to get past activities for type ${t}:`,n),n instanceof Error?n:new Error(`Failed to load ${t} activities. Please try again later.`)}}};function Bx(t){if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;const n=new Date(t),i=n.getTime();return typeof i!="number"||Number.isNaN(i)?!1:t===n.toISOString().split("T")[0]}function Jf(t){return/^[0-9a-fA-F]{24}$/.test(t)}function Ed({title:t,count:s,icon:n,variant:i="default"}){const l={default:"summary-card-default",success:"summary-card-success",info:"summary-card-info",warning:"summary-card-warning"};return e.jsxs("div",{className:`past-activities-summary-card ${l[i]}`,children:[e.jsx("div",{className:"summary-card-icon",children:e.jsx(n,{size:20})}),e.jsxs("div",{className:"summary-card-content",children:[e.jsx("div",{className:"summary-card-count",children:s}),e.jsx("div",{className:"summary-card-title",children:t})]})]})}function UC({activity:t,onViewDetails:s}){const[n,i]=x.useState(!1),l=w=>{switch(w){case"rehearsal":return Ke;case"theory":return Zt;case"private-lesson":return mr;default:return $e}},c=w=>{switch(w){case"rehearsal":return"חזרה";case"theory":return"תאוריה";case"private-lesson":return"שיעור פרטי";default:return w}},u=w=>new Date(w).toLocaleDateString("he-IL",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),f=l(t.activityType),p=t.attendance;let m=[];Array.isArray(p)?m=p:p&&typeof p=="object"?(m=p.records||p.data||p.students||[],Array.isArray(m)||(m=[])):m=[];const y=m.length,v=Array.isArray(m)?m.filter(w=>w&&(w.status==="present"||w.status==="הגיע/ה")).length:0,j=Array.isArray(m)?m.filter(w=>w&&(w.status==="absent"||w.status==="לא הגיע/ה")).length:0,N=y>0?Math.round(v/y*100):0,b=w=>w>=80?"success":w>=60?"warning":"danger";return e.jsxs("div",{className:"past-activity-item",children:[e.jsx("div",{className:"activity-icon",children:e.jsx(f,{size:18})}),e.jsxs("div",{className:"activity-content",children:[e.jsxs("div",{className:"activity-header",children:[e.jsx("div",{className:"activity-title",children:t.title}),e.jsxs("div",{className:"activity-header-actions",children:[e.jsx("div",{className:"activity-date",children:u(t.date)}),y>0&&e.jsx("button",{className:"attendance-toggle",onClick:w=>{w.stopPropagation(),i(!n)},title:"הצג פרטי נוכחות",children:n?e.jsx(Bt,{size:14}):e.jsx(bt,{size:14})})]})]}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-type",children:c(t.activityType)}),e.jsxs("div",{className:"activity-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:t.time})]}),t.location&&e.jsxs("div",{className:"activity-location",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:t.location})]}),t.orchestraName&&e.jsxs("div",{className:"activity-orchestra",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:t.orchestraName})]}),t.teacherName&&e.jsxs("div",{className:"activity-teacher",children:[e.jsx(mr,{size:12}),e.jsx("span",{children:t.teacherName})]})]}),e.jsxs("div",{className:"activity-meta",children:[y>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"attendance-summary",children:[e.jsx(ms,{size:12}),e.jsxs("span",{children:[y," משתתפים"]})]}),e.jsxs("div",{className:`attendance-rate ${b(N)}`,children:[N,"% נוכחות"]}),e.jsxs("div",{className:"attendance-breakdown",children:[e.jsxs("span",{className:"present-count",children:["✓ ",v]}),e.jsxs("span",{className:"absent-count",children:["✗ ",j]})]})]}):e.jsxs("div",{className:"no-attendance",children:[e.jsx(ms,{size:12}),e.jsx("span",{children:"אין נתוני נוכחות"})]}),t.notes&&e.jsxs("div",{className:"has-notes",children:[e.jsx(hu,{size:12}),e.jsx("span",{children:"הערות"})]})]}),n&&y>0&&e.jsxs("div",{className:"attendance-details",children:[e.jsxs("div",{className:"attendance-section",children:[e.jsxs("h5",{className:"attendance-section-title",children:["✓ נוכחים (",v,")"]}),e.jsx("div",{className:"attendance-list",children:Array.isArray(m)?m.filter(w=>w&&(w.status==="present"||w.status==="הגיע/ה")).map(w=>e.jsx("div",{className:"attendance-student present",children:e.jsx("span",{className:"student-name",children:w.studentName||w.name||"משתתף"})},w.studentId||w.id||Math.random())):e.jsx("div",{className:"no-data",children:"אין נתונים"})})]}),j>0&&e.jsxs("div",{className:"attendance-section",children:[e.jsxs("h5",{className:"attendance-section-title",children:["✗ נעדרים (",j,")"]}),e.jsx("div",{className:"attendance-list",children:Array.isArray(m)?m.filter(w=>w&&(w.status==="absent"||w.status==="לא הגיע/ה")).map(w=>e.jsx("div",{className:"attendance-student absent",children:e.jsx("span",{className:"student-name",children:w.studentName||w.name||"משתתף"})},w.studentId||w.id||Math.random())):e.jsx("div",{className:"no-data",children:"אין נתונים"})})]})]})]})]})}function PC({currentPage:t,totalPages:s,onPageChange:n,hasNextPage:i,hasPreviousPage:l}){const c=()=>{const u=[];let p=Math.max(1,t-Math.floor(2.5));const m=Math.min(s,p+5-1);m-p+1<5&&(p=Math.max(1,m-5+1));for(let y=p;y<=m;y++)u.push(e.jsx("button",{className:`pagination-number ${y===t?"active":""}`,onClick:()=>n(y),children:y},y));return u};return s<=1?null:e.jsxs("div",{className:"past-activities-pagination",children:[e.jsxs("button",{className:"pagination-btn",onClick:()=>n(t-1),disabled:!l,children:[e.jsx(Xm,{size:16}),e.jsx("span",{children:"הקודם"})]}),e.jsx("div",{className:"pagination-numbers",children:c()}),e.jsxs("button",{className:"pagination-btn",onClick:()=>n(t+1),disabled:!i,children:[e.jsx("span",{children:"הבא"}),e.jsx(y0,{size:16})]})]})}function qC({className:t=""}){var R,E;const[s,n]=x.useState(null),[i,l]=x.useState(!1),[c,u]=x.useState(null),[f,p]=x.useState([]),[m,y]=x.useState(!1),[v,j]=x.useState({type:"all",limit:50,page:1}),[N,b]=x.useState(!1),w=Ls.getCurrentUser(),A=((R=w==null?void 0:w.roles)==null?void 0:R.includes("מנהל"))||((E=w==null?void 0:w.roles)==null?void 0:E.includes("admin")),S=x.useCallback(async()=>{if(!(m||f.length>0)){y(!0);try{const _=await Jt.getTeachers({isActive:!0});p(_)}catch(_){console.error("Failed to load teachers:",_)}finally{y(!1)}}},[m,f.length]),C=x.useCallback(async()=>{if(v.type==="private-lessons"&&!v.teacherId){u("יש לבחור מורה עבור שיעורים פרטיים");return}l(!0),u(null);try{const _=await FC.getPastActivities(v);n(_)}catch(_){const k=_ instanceof Error?_.message:"שגיאה בטעינת הפעילויות";u(k)}finally{l(!1)}},[v]);x.useEffect(()=>{A&&(C(),v.type==="private-lessons"&&S())},[A,C,v.type,S]);const D=_=>{j(k=>({...k,..._,page:1}))},I=_=>{j(k=>({...k,page:_}))},T=_=>{const k={type:_};_!=="private-lessons"&&(k.teacherId=void 0),D(k),_==="private-lessons"&&S()};return A?e.jsxs("div",{className:`past-activities-section ${t}`,children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"פעילויות קודמות"}),e.jsx("div",{className:"header-actions",children:e.jsxs("button",{className:`filter-toggle ${N?"active":""}`,onClick:()=>b(!N),children:[e.jsx(hi,{size:16}),e.jsx("span",{children:"מסננים"}),e.jsx(bt,{size:14,className:N?"rotated":""})]})})]}),N&&e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"סוג פעילות:"}),e.jsxs("select",{value:v.type||"all",onChange:_=>T(_.target.value),children:[e.jsx("option",{value:"all",children:"כל הפעילויות"}),e.jsx("option",{value:"rehearsals",children:"חזרות"}),e.jsx("option",{value:"theory",children:"שיעורי תאוריה"}),e.jsx("option",{value:"private-lessons",children:"שיעורים פרטיים"})]})]}),v.type==="private-lessons"&&e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"מורה: *"}),m?e.jsx("div",{className:"loading-teachers",children:"טוען מורים..."}):e.jsxs("select",{value:v.teacherId||"",onChange:_=>D({teacherId:_.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"בחר מורה"}),f.map(_=>e.jsx("option",{value:_._id,children:_.personalInfo.fullName},_._id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"מתאריך:"}),e.jsx("input",{type:"date",value:v.startDate||"",onChange:_=>D({startDate:_.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"עד תאריך:"}),e.jsx("input",{type:"date",value:v.endDate||"",onChange:_=>D({endDate:_.target.value})})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsxs("button",{className:"apply-filters-btn",onClick:C,disabled:i,children:[e.jsx(pr,{size:14}),e.jsx("span",{children:"חפש"})]}),e.jsx("button",{className:"clear-filters-btn",onClick:()=>{j({type:"all",limit:50,page:1}),u(null)},children:"נקה מסננים"})]})]}),c&&e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:c}),e.jsx("button",{onClick:C,children:"נסה שוב"})]}),i&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען פעילויות..."})]}),s&&!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-cards",children:[e.jsx(Ed,{title:"סה״כ פעילויות",count:s.summary.totalCount,icon:$e,variant:"default"}),e.jsx(Ed,{title:"חזרות",count:s.summary.rehearsalsCount,icon:Ke,variant:"info"}),e.jsx(Ed,{title:"שיעורי תאוריה",count:s.summary.theoryCount,icon:Zt,variant:"success"}),e.jsx(Ed,{title:"שיעורים פרטיים",count:s.summary.privateLessonsCount,icon:mr,variant:"warning"})]}),s.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"activities-list",children:s.data.map(_=>e.jsx(UC,{activity:_,onViewDetails:k=>{console.log("View activity details:",k)}},_._id))}),e.jsx(PC,{currentPage:s.pagination.currentPage,totalPages:s.pagination.totalPages,hasNextPage:s.pagination.hasNextPage,hasPreviousPage:s.pagination.hasPreviousPage,onPageChange:I})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx($e,{size:48}),e.jsx("h4",{children:"אין פעילויות להצגה"}),e.jsx("p",{children:"לא נמצאו פעילויות התואמות את הקריטריונים שנבחרו"})]})]})]}):e.jsxs("div",{className:`past-activities-section ${t}`,children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"פעילויות קודמות"})}),e.jsx("div",{className:"access-denied",children:e.jsx("p",{children:"גישה לסקירת פעילויות קודמות מוגבלת למנהלי המערכת בלבד"})})]})}function HC(){return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[e.jsx(BC,{}),e.jsx(qC,{})]}),e.jsx(mi,{})]})}const Fx=(t,s)=>{const n=s[t._id];return!n||Object.keys(n).length===0?t:{...t,academicInfo:{...t.academicInfo,instrumentProgress:t.academicInfo.instrumentProgress.map(i=>{const l=n[i.instrumentName];return l!==void 0?{...i,currentStage:l}:i})}}},Ma=Ba((t,s)=>({students:[],selectedStudent:null,filterBy:{},isLoading:!1,error:null,localStageChanges:{},loadStudents:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await ot.getStudents(i),c=s(),u=l.map(f=>Fx(f,c.localStageChanges));t({students:u,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load students";t({error:l,isLoading:!1}),console.error("Error loading students:",i)}},loadStudentById:async n=>{t({isLoading:!0,error:null});try{const i=await ot.getStudentById(n),l=s(),c=Fx(i,l.localStageChanges);t({selectedStudent:c,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load student";t({error:l,isLoading:!1}),console.error("Error loading student:",i)}},saveStudent:async n=>{t({isLoading:!0,error:null});try{let i;if(n._id){const l=n._id;i=await ot.updateStudent(l,n);const c=s().students.map(u=>u._id===i._id?i:u);t({students:c,selectedStudent:i,isLoading:!1})}else i=await ot.addStudent(n),t({students:[...s().students,i],selectedStudent:i,isLoading:!1});return i}catch(i){const l=i instanceof Error?i.message:"Failed to save student";throw t({error:l,isLoading:!1}),console.error("Error saving student:",i),i}},removeStudent:async n=>{var i;t({isLoading:!0,error:null});try{const l=s().students.find(u=>u._id===n)||s().selectedStudent,c=(l==null?void 0:l.teacherIds)||[];if(c.length>0){const u=c.map(f=>Jt.removeStudentFromTeacher(f,n).catch(p=>(console.error(`Failed to remove student ${n} from teacher ${f}:`,p),null)));await Promise.allSettled(u)}await ot.removeStudent(n),t({students:s().students.filter(u=>u._id!==n),selectedStudent:((i=s().selectedStudent)==null?void 0:i._id)===n?null:s().selectedStudent,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove student";throw t({error:c,isLoading:!1}),console.error("Error removing student:",l),l}},getStudentsByIds:async n=>{if(!n||n.length===0)return[];t({isLoading:!0,error:null});try{const l=s().students,c=l.map(m=>m._id),u=n.filter(m=>!c.includes(m));let f=[...l];if(u.length>0){const m=await ot.getStudentsByIds(u);f=[...l],m.forEach(y=>{f.some(v=>v._id===y._id)||f.push(y)}),t({students:f})}const p=f.filter(m=>n.includes(m._id));return t({isLoading:!1}),p}catch(i){const l=i instanceof Error?i.message:"Failed to load students by IDs";return t({error:l,isLoading:!1}),console.error("Error loading students by IDs:",i),[]}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedStudent:()=>{t({selectedStudent:null})},clearError:()=>{t({error:null})},updateStudentStage:(n,i,l)=>{const c=s(),u={...c.localStageChanges,[n]:{...c.localStageChanges[n],[i]:l}},f=c.students.map(m=>m._id===n?{...m,academicInfo:{...m.academicInfo,instrumentProgress:m.academicInfo.instrumentProgress.map(y=>y.instrumentName===i?{...y,currentStage:l}:y)}}:m);let p=c.selectedStudent;c.selectedStudent&&c.selectedStudent._id===n&&(p={...c.selectedStudent,academicInfo:{...c.selectedStudent.academicInfo,instrumentProgress:c.selectedStudent.academicInfo.instrumentProgress.map(m=>m.instrumentName===i?{...m,currentStage:l}:m)}}),t({students:f,selectedStudent:p,localStageChanges:u}),console.log(`Updated stage in student store: ${i} -> ${l} for student ${n}`),console.log("Local stage changes:",u)}})),YC=Object.freeze(Object.defineProperty({__proto__:null,useStudentStore:Ma},Symbol.toStringTag,{value:"Module"})),Oo={ADMIN:"מנהל",TEACHER:"מורה",CONDUCTOR:"מנצח",ENSEMBLE_INSTRUCTOR:"מדריך הרכב",STUDENT:"תלמיד"};class nb{constructor(s){this.context=s}hasRole(s){return this.context.user?(Array.isArray(s)?s:[s]).some(i=>this.context.user.roles.includes(i)):!1}isAdmin(){return this.hasRole(Oo.ADMIN)}isTeacher(){return this.hasRole(Oo.TEACHER)}isStudent(){return this.hasRole(Oo.STUDENT)}isConductor(){return this.hasRole(Oo.CONDUCTOR)}isEnsembleInstructor(){return this.hasRole(Oo.ENSEMBLE_INSTRUCTOR)}canAddStudent(){return this.isAdmin()||this.isTeacher()}canAddTeacher(){return this.isAdmin()}canViewStudent(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?this.isStudentAssignedToTeacher(s,this.context.user._id):this.isStudent()?s._id===this.context.user._id:!1:!1}canEditStudent(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?this.isStudentAssignedToTeacher(s,this.context.user._id):!1:!1}canDeleteStudent(s){return this.context.user?this.isAdmin():!1}canUpdateStudent(s){return this.canEditStudent(s)}canViewTeacher(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canEditTeacher(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canDeleteTeacher(s){return this.context.user?this.isAdmin():!1}canUpdateTeacher(s){return this.canEditTeacher(s)}canManageTeacherSchedule(s){return this.context.user?this.isAdmin()?!0:this.isTeacher()?s._id===this.context.user._id:!1:!1}canViewOrchestras(){return this.isAdmin()||this.isConductor()||this.isEnsembleInstructor()||this.isTeacher()}canCreateOrchestra(){return this.isAdmin()}canEditOrchestra(s){return!this.context.user||!s?!1:this.isAdmin()?!0:this.isConductor()||this.isEnsembleInstructor()?s.conductorId===this.context.user._id:!1}canDeleteOrchestra(s){return this.context.user?this.isAdmin():!1}canUpdateOrchestra(s){return this.canEditOrchestra(s)}isStudentAssignedToTeacher(s,n){return!s.teacherIds||!Array.isArray(s.teacherIds)?!1:s.teacherIds.includes(n)}getAuthorizationErrorMessage(s,n="תלמיד"){const i={view:`אין לך הרשאות לצפות ב${n} זה.`,edit:`אין לך הרשאות לערוך ${n} זה. רק המורה הקבוע או המנהל יכולים לערוך.`,update:`אין לך הרשאות לעדכן ${n} זה. רק המורה הקבוע או המנהל יכולים לעדכן.`,delete:`אין לך הרשאות למחוק ${n} זה. רק המנהל יכול למחוק.`,add:`אין לך הרשאות להוסיף ${n} חדש.`,default:"אין לך הרשאות לבצע פעולה זו."};return i[s]||i.default}getStudentActionPermissions(s){return{canView:this.canViewStudent(s),canEdit:this.canEditStudent(s),canDelete:this.canDeleteStudent(s),canUpdate:this.canUpdateStudent(s),showEditButton:this.canEditStudent(s),showDeleteButton:this.canDeleteStudent(s)}}getTeacherActionPermissions(s){return{canView:this.canViewTeacher(s),canEdit:this.canEditTeacher(s),canDelete:this.canDeleteTeacher(s),canUpdate:this.canUpdateTeacher(s),showEditButton:this.canEditTeacher(s),showDeleteButton:this.canDeleteTeacher(s)}}getOrchestraActionPermissions(s){return{canView:this.canViewOrchestras(),canEdit:this.canEditOrchestra(s),canDelete:this.canDeleteOrchestra(s),canUpdate:this.canUpdateOrchestra(s),showEditButton:this.canEditOrchestra(s),showDeleteButton:this.canDeleteOrchestra(s)}}validateAction(s,n,i){if(!this.context.user)throw new Error("אין לך הרשאות לבצע פעולה זו. אנא התחבר למערכת.");const l=i==="teacher",c=l?"מורה":"תלמיד";switch(s){case"add":if(l&&!this.canAddTeacher())throw new Error(this.getAuthorizationErrorMessage("add",c));if(!l&&!this.canAddStudent())throw new Error(this.getAuthorizationErrorMessage("add",c));break;case"view":if(n){if(l&&!this.canViewTeacher(n))throw new Error(this.getAuthorizationErrorMessage("view",c));if(!l&&!this.canViewStudent(n))throw new Error(this.getAuthorizationErrorMessage("view",c))}break;case"edit":case"update":if(n){if(l&&!this.canUpdateTeacher(n))throw new Error(this.getAuthorizationErrorMessage("update",c));if(!l&&!this.canUpdateStudent(n))throw new Error(this.getAuthorizationErrorMessage("update",c))}break;case"delete":if(n){if(l&&!this.canDeleteTeacher(n))throw new Error(this.getAuthorizationErrorMessage("delete",c));if(!l&&!this.canDeleteStudent(n))throw new Error(this.getAuthorizationErrorMessage("delete",c))}break;default:throw new Error(this.getAuthorizationErrorMessage("default"))}}}function br(t){return new nb(t)}function Al(t,s){return{user:t,isAuthenticated:s}}function VC({student:t,onView:s,onEdit:n,onRemove:i,authContext:l}){var R,E,_,k,z,M;const[c,u]=x.useState(t),[f,p]=x.useState([]),m=l?br(l):null;x.useEffect(()=>{u(t)},[t]),x.useEffect(()=>{var X;if(!((X=c==null?void 0:c.enrollments)!=null&&X.orchestraIds)||c.enrollments.orchestraIds.length===0){p([]);return}(async()=>{try{const te=(await Ia.getOrchestrasByIds(c.enrollments.orchestraIds)).map(L=>L.name);p(te)}catch(W){console.error("Error fetching orchestra data:",W),p([])}})()},[(R=c==null?void 0:c.enrollments)==null?void 0:R.orchestraIds]);const y=G=>{const X=["var(--stage-1)","var(--stage-2)","var(--stage-3)","var(--stage-4)","var(--stage-5)","var(--stage-6)","var(--stage-7)","var(--stage-8)"];return X[G-1]||X[0]},v=G=>{switch(G){case"עבר/ה":case"עבר/ה בהצטיינות":case"עבר/ה בהצטיינות יתרה":return"var(--success)";case"לא עבר/ה":return"var(--danger)";default:return"var(--text-muted)"}},j=G=>G?G.split(" ").map(X=>X[0]).join("").toUpperCase().substring(0,2):"",N=()=>f.length===0?"ללא תזמורת":f.join(" || "),b=()=>{var X;return!((X=c==null?void 0:c.academicInfo)!=null&&X.instrumentProgress)||c.academicInfo.instrumentProgress.length===0?"ללא כלי נגינה":c.academicInfo.instrumentProgress.slice(0,2).map(W=>W.instrumentName).join(" - ")},A=(()=>{var G;return(G=c==null?void 0:c.academicInfo)!=null&&G.instrumentProgress?c.academicInfo.instrumentProgress.find(X=>X.isPrimary)||(c.academicInfo.instrumentProgress.length>0?c.academicInfo.instrumentProgress[0]:null):null})(),S=(A==null?void 0:A.currentStage)||1,C=((_=(E=A==null?void 0:A.tests)==null?void 0:E.technicalTest)==null?void 0:_.status)||"לא נבחן",D=((z=(k=A==null?void 0:A.tests)==null?void 0:k.stageTest)==null?void 0:z.status)||"לא נבחן",I=c||t;if(!I||!I.personalInfo)return null;const T=(m==null?void 0:m.getStudentActionPermissions(I))||{showEditButton:!0,showDeleteButton:!0};return e.jsxs("div",{className:"student-preview",onClick:()=>s(I._id),children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsxs("div",{className:"student-details",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:y(S)},children:j(I.personalInfo.fullName)})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{className:"student-name",children:I.personalInfo.fullName}),e.jsxs("div",{className:"student-subject",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:b()})]})]})]}),e.jsxs("div",{className:"badges-container",children:[((M=I.academicInfo)==null?void 0:M.instrumentProgress)&&I.academicInfo.instrumentProgress.length>0&&e.jsx("div",{className:"instrument-badges",children:I.academicInfo.instrumentProgress.map(G=>e.jsxs("div",{className:"instrument-stage-badge",style:{backgroundColor:y(G.currentStage)},children:[G.instrumentName,": שלב"," ",G.currentStage]},G.instrumentName))}),e.jsx("div",{className:"grade-badge",style:{backgroundColor:"#348b49"},children:e.jsxs("span",{children:["כיתה ",I.academicInfo.class]})})]})]})}),e.jsxs("div",{className:"preview-content",children:[e.jsx("div",{className:"info-row",children:e.jsxs("div",{className:"info-item",children:[e.jsx(Cs,{size:16}),e.jsx("span",{children:N()})]})}),A&&e.jsxs("div",{className:"tests-section",children:[e.jsxs("div",{className:"test-item",children:[e.jsx("div",{className:"test-label",children:"מבחן טכני:"}),e.jsx("div",{className:"test-status",style:{color:v(C)},children:C})]}),e.jsxs("div",{className:"test-item",children:[e.jsx("div",{className:"test-label",children:"מבחן שלב:"}),e.jsx("div",{className:"test-status",style:{color:v(D)},children:D})]})]})]}),e.jsxs("div",{className:"preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[T.showEditButton&&e.jsx("button",{className:"action-btn edit",onClick:G=>{G.stopPropagation(),n(I._id)},"aria-label":"ערוך תלמיד",children:e.jsx(ba,{size:20})}),T.showDeleteButton&&i&&e.jsx("button",{className:"action-btn delete",onClick:G=>{G.stopPropagation(),i(I._id)},"aria-label":"מחק תלמיד",children:e.jsx(Ft,{size:20})})]}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(I.createdAt).toLocaleDateString("he-IL")})]})]})]})}function GC({students:t,isLoading:s,onEdit:n,onView:i,onRemove:l,authContext:c}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען תלמידים..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו תלמידים להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף תלמידים חדשים"})]}):e.jsx("div",{className:"student-grid",children:t.map(u=>e.jsx(VC,{student:u,onEdit:n,onView:i||n,onRemove:l,authContext:c},u._id))})}function rc({onSearch:t,placeholder:s="חיפוש...",className:n=""}){const[i,l]=x.useState(""),c=u=>{const f=u.target.value;l(f),t(f)};return e.jsx("div",{className:`search-bar-container ${n}`,children:e.jsxs("div",{className:"search-bar",children:[e.jsx(pr,{className:"search-icon",size:18}),e.jsx("input",{type:"text",value:i,onChange:c,placeholder:s,className:"search-input"})]})})}function bu(t,s,n,i,l,c){const[u,f]=x.useState(""),[p,m]=x.useState({instruments:[],stageLevel:null,classRange:null,sortOrder:null}),y=Array.isArray(t)?t:[],v=x.useMemo(()=>{const S={instruments:[],classRange:null};if(y.forEach(C=>{const D=n(C);(Array.isArray(D)?D:[D]).forEach(T=>{T&&typeof T=="string"&&T.trim()!==""&&!S.instruments.includes(T)&&S.instruments.push(T)})}),l){const C=y.map(D=>l(D)).filter(D=>D&&!isNaN(D)).sort((D,I)=>D-I);C.length>0&&(S.classRange=[C[0],C[C.length-1]])}return S.instruments.sort((C,D)=>C.localeCompare(D,"he")),S},[y,n,l]),j=x.useMemo(()=>{let S=[...y];if(u){const C=u.toLowerCase();S=S.filter(D=>{try{const I=typeof s=="function"?s(D):s.map(T=>{const R=D[T];return R?String(R):""});return Array.isArray(I)?I.some(T=>{if(typeof T!="string")return!1;const R=T.toLowerCase();return R.includes(C)?!0:R.split(/\s+/).some(_=>_.startsWith(C))}):(console.error("Expected fieldsToSearch to be an array but got:",typeof I),!1)}catch(I){return console.error("Error filtering entity:",I),!1}})}return p.instruments&&p.instruments.length>0&&(S=S.filter(C=>{const D=n(C);return(Array.isArray(D)?D:[D]).some(T=>T&&p.instruments.includes(T))})),p.stageLevel&&i&&(S=S.filter(C=>{const D=i(C);return!D||isNaN(D)?!1:D===p.stageLevel})),p.classRange&&l&&(S=S.filter(C=>{const D=l(C);return!D||isNaN(D)?!1:D>=p.classRange[0]&&D<=p.classRange[1]})),p.sortOrder&&c&&S.sort((C,D)=>{const I=c(C),T=c(D),R=I.localeCompare(T,"he");return p.sortOrder==="asc"?R:-R}),S},[y,u,p,s,n,i,l,c]),N=S=>{f(S)},b=S=>{m(S)},w=()=>{m({instruments:[],stageLevel:null,classRange:null,sortOrder:null})},A=p.instruments&&p.instruments.length>0||p.stageLevel!==null||p.classRange!==null||p.sortOrder!==null;return{filteredEntities:j,handleSearch:N,searchQuery:u,filters:p,handleApplyFilters:b,clearFilters:w,hasActiveFilters:A,availableInstruments:v.instruments,classRange:v.classRange}}function Nu({isOpen:t,onToggle:s,onApplyFilters:n,availableInstruments:i=[],classRange:l,currentFilters:c,hasActiveFilters:u,entityType:f}){var A,S,C,D;const p=x.useRef(null),[m,y]=x.useState(c);x.useEffect(()=>{function I(T){p.current&&!p.current.contains(T.target)&&s()}return t&&document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[t,s]),x.useEffect(()=>{y(c)},[c]);const v=I=>{const T=m.instruments||[],R=T.includes(I)?T.filter(_=>_!==I):[...T,I],E={...m,instruments:R};y(E),n(E)},j=I=>{const T={...m,stageLevel:I};y(T),n(T)},N=I=>{const T={...m,classRange:I};y(T),n(T)},b=I=>{const T={...m,sortOrder:I};y(T),n(T)},w=()=>{const I={instruments:[],stageLevel:null,classRange:null,sortOrder:null};y(I),n(I)};return t?e.jsxs("div",{ref:p,className:"filter-dropdown",children:[e.jsxs("div",{className:"filter-dropdown-header",children:[e.jsx("span",{className:"filter-title",children:"סינון"}),u&&e.jsx("button",{className:"clear-filters-btn",onClick:w,title:"נקה סינונים",children:e.jsx(Nt,{size:14})})]}),e.jsxs("div",{className:"filter-dropdown-content",children:[i.length>0&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:f==="orchestras"?"סוג":"כלי"}),e.jsx("div",{className:"filter-options",children:i.map(I=>e.jsxs("div",{className:"toggle-option",children:[e.jsx("span",{className:"toggle-option-text",children:I}),e.jsx("div",{className:`toggle-switch ${(m.instruments||[]).includes(I)?"active":""}`,onClick:()=>v(I),children:e.jsx("div",{className:"toggle-slider"})})]},I))})]}),f==="students"&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"שלב"}),e.jsx("div",{className:"stage-select-container",children:e.jsxs("select",{value:m.stageLevel||"",onChange:I=>{const T=I.target.value;j(T?parseInt(T):null)},className:"stage-select",children:[e.jsx("option",{value:"",children:"כל השלבים"}),[1,2,3,4,5,6,7,8].map(I=>e.jsxs("option",{value:I,children:["שלב ",I]},I))]})})]}),f==="students"&&l&&e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"כיתה"}),e.jsxs("div",{className:"range-slider-container",children:[e.jsxs("div",{className:"range-values",children:[e.jsxs("span",{children:["מ-",((A=m.classRange)==null?void 0:A[0])||l[0]]}),e.jsxs("span",{children:["עד-",((S=m.classRange)==null?void 0:S[1])||l[1]]})]}),e.jsxs("div",{className:"dual-range-wrapper",children:[e.jsx("input",{type:"range",min:l[0],max:l[1],value:((C=m.classRange)==null?void 0:C[0])||l[0],className:"blue-slider class-slider range-min",onChange:I=>{var E;const T=parseInt(I.target.value),R=((E=m.classRange)==null?void 0:E[1])||l[1];N([T,Math.max(T,R)])}}),e.jsx("input",{type:"range",min:l[0],max:l[1],value:((D=m.classRange)==null?void 0:D[1])||l[1],className:"blue-slider class-slider range-max",onChange:I=>{var E;const T=parseInt(I.target.value),R=((E=m.classRange)==null?void 0:E[0])||l[0];N([Math.min(R,T),T])}})]})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("div",{className:"filter-section-title",children:"מיון א-ת"}),e.jsxs("div",{className:"sort-options",children:[e.jsx("button",{className:`sort-btn ${m.sortOrder==="asc"?"active":""}`,onClick:()=>b(m.sortOrder==="asc"?null:"asc"),children:"עולה"}),e.jsx("button",{className:`sort-btn ${m.sortOrder==="desc"?"active":""}`,onClick:()=>b(m.sortOrder==="desc"?null:"desc"),children:"יורד"})]})]})]})]}):null}const Cl=({isOpen:t,onClose:s,modalId:n="modal",restoreFocusOnClose:i=!0})=>{const l=x.useRef(null),c=x.useRef(null),u=x.useRef(!0);x.useEffect(()=>{t&&u.current&&(c.current=document.activeElement,u.current=!1)},[t]);const f=x.useCallback(j=>{j.key==="Escape"&&t&&(j.preventDefault(),s())},[t,s]),p=x.useCallback(j=>{if(!(!t||!l.current)&&j.key==="Tab"){const N=l.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),b=N[0],w=N[N.length-1];j.shiftKey?document.activeElement===b&&(j.preventDefault(),w==null||w.focus()):document.activeElement===w&&(j.preventDefault(),b==null||b.focus())}},[t]);x.useEffect(()=>(t&&(document.addEventListener("keydown",f),document.addEventListener("keydown",p),document.body.style.overflow==="hidden"||(document.body.style.overflow="hidden"),setTimeout(()=>{if(l.current){const N=l.current.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');N?N.focus():l.current.focus()}},100)),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keydown",p),document.querySelector(".modal-active")||(document.body.style.overflow="")}),[t,f,p]),x.useEffect(()=>{if(!t&&i&&c.current){const j=c.current;j&&typeof j.focus=="function"&&setTimeout(()=>{j.focus()},100),c.current=null,u.current=!0}},[t,i]);const m={ref:l,role:"dialog","aria-modal":!0,"aria-labelledby":`${n}-title`,"aria-describedby":`${n}-description`,tabIndex:-1},y={id:`${n}-title`},v={id:`${n}-description`};return{modalProps:m,titleProps:y,descriptionProps:v,modalRef:l}};var QC=function(s){return XC(s)&&!ZC(s)};function XC(t){return!!t&&typeof t=="object"}function ZC(t){var s=Object.prototype.toString.call(t);return s==="[object RegExp]"||s==="[object Date]"||JC(t)}var WC=typeof Symbol=="function"&&Symbol.for,KC=WC?Symbol.for("react.element"):60103;function JC(t){return t.$$typeof===KC}function eD(t){return Array.isArray(t)?[]:{}}function au(t,s){return s.clone!==!1&&s.isMergeableObject(t)?Yo(eD(t),t,s):t}function tD(t,s,n){return t.concat(s).map(function(i){return au(i,n)})}function sD(t,s,n){var i={};return n.isMergeableObject(t)&&Object.keys(t).forEach(function(l){i[l]=au(t[l],n)}),Object.keys(s).forEach(function(l){!n.isMergeableObject(s[l])||!t[l]?i[l]=au(s[l],n):i[l]=Yo(t[l],s[l],n)}),i}function Yo(t,s,n){n=n||{},n.arrayMerge=n.arrayMerge||tD,n.isMergeableObject=n.isMergeableObject||QC;var i=Array.isArray(s),l=Array.isArray(t),c=i===l;return c?i?n.arrayMerge(t,s,n):sD(t,s,n):au(s,n)}Yo.all=function(s,n){if(!Array.isArray(s))throw new Error("first argument should be an array");return s.reduce(function(i,l){return Yo(i,l,n)},{})};var Dm=Yo,rb=typeof global=="object"&&global&&global.Object===Object&&global,aD=typeof self=="object"&&self&&self.Object===Object&&self,en=rb||aD||Function("return this")(),gr=en.Symbol,ib=Object.prototype,nD=ib.hasOwnProperty,rD=ib.toString,Io=gr?gr.toStringTag:void 0;function iD(t){var s=nD.call(t,Io),n=t[Io];try{t[Io]=void 0;var i=!0}catch{}var l=rD.call(t);return i&&(s?t[Io]=n:delete t[Io]),l}var lD=Object.prototype,oD=lD.toString;function cD(t){return oD.call(t)}var dD="[object Null]",uD="[object Undefined]",Ux=gr?gr.toStringTag:void 0;function pi(t){return t==null?t===void 0?uD:dD:Ux&&Ux in Object(t)?iD(t):cD(t)}function lb(t,s){return function(n){return t(s(n))}}var rp=lb(Object.getPrototypeOf,Object);function gi(t){return t!=null&&typeof t=="object"}var hD="[object Object]",fD=Function.prototype,mD=Object.prototype,ob=fD.toString,pD=mD.hasOwnProperty,gD=ob.call(Object);function Px(t){if(!gi(t)||pi(t)!=hD)return!1;var s=rp(t);if(s===null)return!0;var n=pD.call(s,"constructor")&&s.constructor;return typeof n=="function"&&n instanceof n&&ob.call(n)==gD}function yD(){this.__data__=[],this.size=0}function cb(t,s){return t===s||t!==t&&s!==s}function Su(t,s){for(var n=t.length;n--;)if(cb(t[n][0],s))return n;return-1}var vD=Array.prototype,xD=vD.splice;function jD(t){var s=this.__data__,n=Su(s,t);if(n<0)return!1;var i=s.length-1;return n==i?s.pop():xD.call(s,n,1),--this.size,!0}function bD(t){var s=this.__data__,n=Su(s,t);return n<0?void 0:s[n][1]}function ND(t){return Su(this.__data__,t)>-1}function SD(t,s){var n=this.__data__,i=Su(n,t);return i<0?(++this.size,n.push([t,s])):n[i][1]=s,this}function Rn(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}Rn.prototype.clear=yD;Rn.prototype.delete=jD;Rn.prototype.get=bD;Rn.prototype.has=ND;Rn.prototype.set=SD;function wD(){this.__data__=new Rn,this.size=0}function TD(t){var s=this.__data__,n=s.delete(t);return this.size=s.size,n}function ED(t){return this.__data__.get(t)}function AD(t){return this.__data__.has(t)}function ic(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var CD="[object AsyncFunction]",DD="[object Function]",kD="[object GeneratorFunction]",_D="[object Proxy]";function db(t){if(!ic(t))return!1;var s=pi(t);return s==DD||s==kD||s==CD||s==_D}var em=en["__core-js_shared__"],qx=function(){var t=/[^.]+$/.exec(em&&em.keys&&em.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function OD(t){return!!qx&&qx in t}var ID=Function.prototype,$D=ID.toString;function yi(t){if(t!=null){try{return $D.call(t)}catch{}try{return t+""}catch{}}return""}var RD=/[\\^$.*+?()[\]{}|]/g,MD=/^\[object .+?Constructor\]$/,zD=Function.prototype,LD=Object.prototype,BD=zD.toString,FD=LD.hasOwnProperty,UD=RegExp("^"+BD.call(FD).replace(RD,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function PD(t){if(!ic(t)||OD(t))return!1;var s=db(t)?UD:MD;return s.test(yi(t))}function qD(t,s){return t==null?void 0:t[s]}function vi(t,s){var n=qD(t,s);return PD(n)?n:void 0}var Vo=vi(en,"Map"),Go=vi(Object,"create");function HD(){this.__data__=Go?Go(null):{},this.size=0}function YD(t){var s=this.has(t)&&delete this.__data__[t];return this.size-=s?1:0,s}var VD="__lodash_hash_undefined__",GD=Object.prototype,QD=GD.hasOwnProperty;function XD(t){var s=this.__data__;if(Go){var n=s[t];return n===VD?void 0:n}return QD.call(s,t)?s[t]:void 0}var ZD=Object.prototype,WD=ZD.hasOwnProperty;function KD(t){var s=this.__data__;return Go?s[t]!==void 0:WD.call(s,t)}var JD="__lodash_hash_undefined__";function ek(t,s){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Go&&s===void 0?JD:s,this}function ui(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}ui.prototype.clear=HD;ui.prototype.delete=YD;ui.prototype.get=XD;ui.prototype.has=KD;ui.prototype.set=ek;function tk(){this.size=0,this.__data__={hash:new ui,map:new(Vo||Rn),string:new ui}}function sk(t){var s=typeof t;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?t!=="__proto__":t===null}function wu(t,s){var n=t.__data__;return sk(s)?n[typeof s=="string"?"string":"hash"]:n.map}function ak(t){var s=wu(this,t).delete(t);return this.size-=s?1:0,s}function nk(t){return wu(this,t).get(t)}function rk(t){return wu(this,t).has(t)}function ik(t,s){var n=wu(this,t),i=n.size;return n.set(t,s),this.size+=n.size==i?0:1,this}function Nr(t){var s=-1,n=t==null?0:t.length;for(this.clear();++s<n;){var i=t[s];this.set(i[0],i[1])}}Nr.prototype.clear=tk;Nr.prototype.delete=ak;Nr.prototype.get=nk;Nr.prototype.has=rk;Nr.prototype.set=ik;var lk=200;function ok(t,s){var n=this.__data__;if(n instanceof Rn){var i=n.__data__;if(!Vo||i.length<lk-1)return i.push([t,s]),this.size=++n.size,this;n=this.__data__=new Nr(i)}return n.set(t,s),this.size=n.size,this}function Dl(t){var s=this.__data__=new Rn(t);this.size=s.size}Dl.prototype.clear=wD;Dl.prototype.delete=TD;Dl.prototype.get=ED;Dl.prototype.has=AD;Dl.prototype.set=ok;function ck(t,s){for(var n=-1,i=t==null?0:t.length;++n<i&&s(t[n],n,t)!==!1;);return t}var Hx=function(){try{var t=vi(Object,"defineProperty");return t({},"",{}),t}catch{}}();function ub(t,s,n){s=="__proto__"&&Hx?Hx(t,s,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[s]=n}var dk=Object.prototype,uk=dk.hasOwnProperty;function hb(t,s,n){var i=t[s];(!(uk.call(t,s)&&cb(i,n))||n===void 0&&!(s in t))&&ub(t,s,n)}function Tu(t,s,n,i){var l=!n;n||(n={});for(var c=-1,u=s.length;++c<u;){var f=s[c],p=void 0;p===void 0&&(p=t[f]),l?ub(n,f,p):hb(n,f,p)}return n}function hk(t,s){for(var n=-1,i=Array(t);++n<t;)i[n]=s(n);return i}var fk="[object Arguments]";function Yx(t){return gi(t)&&pi(t)==fk}var fb=Object.prototype,mk=fb.hasOwnProperty,pk=fb.propertyIsEnumerable,gk=Yx(function(){return arguments}())?Yx:function(t){return gi(t)&&mk.call(t,"callee")&&!pk.call(t,"callee")},lc=Array.isArray;function yk(){return!1}var mb=typeof ea=="object"&&ea&&!ea.nodeType&&ea,Vx=mb&&typeof ta=="object"&&ta&&!ta.nodeType&&ta,vk=Vx&&Vx.exports===mb,Gx=vk?en.Buffer:void 0,xk=Gx?Gx.isBuffer:void 0,pb=xk||yk,jk=9007199254740991,bk=/^(?:0|[1-9]\d*)$/;function Nk(t,s){var n=typeof t;return s=s??jk,!!s&&(n=="number"||n!="symbol"&&bk.test(t))&&t>-1&&t%1==0&&t<s}var Sk=9007199254740991;function gb(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Sk}var wk="[object Arguments]",Tk="[object Array]",Ek="[object Boolean]",Ak="[object Date]",Ck="[object Error]",Dk="[object Function]",kk="[object Map]",_k="[object Number]",Ok="[object Object]",Ik="[object RegExp]",$k="[object Set]",Rk="[object String]",Mk="[object WeakMap]",zk="[object ArrayBuffer]",Lk="[object DataView]",Bk="[object Float32Array]",Fk="[object Float64Array]",Uk="[object Int8Array]",Pk="[object Int16Array]",qk="[object Int32Array]",Hk="[object Uint8Array]",Yk="[object Uint8ClampedArray]",Vk="[object Uint16Array]",Gk="[object Uint32Array]",wt={};wt[Bk]=wt[Fk]=wt[Uk]=wt[Pk]=wt[qk]=wt[Hk]=wt[Yk]=wt[Vk]=wt[Gk]=!0;wt[wk]=wt[Tk]=wt[zk]=wt[Ek]=wt[Lk]=wt[Ak]=wt[Ck]=wt[Dk]=wt[kk]=wt[_k]=wt[Ok]=wt[Ik]=wt[$k]=wt[Rk]=wt[Mk]=!1;function Qk(t){return gi(t)&&gb(t.length)&&!!wt[pi(t)]}function ip(t){return function(s){return t(s)}}var yb=typeof ea=="object"&&ea&&!ea.nodeType&&ea,Mo=yb&&typeof ta=="object"&&ta&&!ta.nodeType&&ta,Xk=Mo&&Mo.exports===yb,tm=Xk&&rb.process,jl=function(){try{var t=Mo&&Mo.require&&Mo.require("util").types;return t||tm&&tm.binding&&tm.binding("util")}catch{}}(),Qx=jl&&jl.isTypedArray,Zk=Qx?ip(Qx):Qk,Wk=Object.prototype,Kk=Wk.hasOwnProperty;function vb(t,s){var n=lc(t),i=!n&&gk(t),l=!n&&!i&&pb(t),c=!n&&!i&&!l&&Zk(t),u=n||i||l||c,f=u?hk(t.length,String):[],p=f.length;for(var m in t)(s||Kk.call(t,m))&&!(u&&(m=="length"||l&&(m=="offset"||m=="parent")||c&&(m=="buffer"||m=="byteLength"||m=="byteOffset")||Nk(m,p)))&&f.push(m);return f}var Jk=Object.prototype;function lp(t){var s=t&&t.constructor,n=typeof s=="function"&&s.prototype||Jk;return t===n}var e_=lb(Object.keys,Object),t_=Object.prototype,s_=t_.hasOwnProperty;function a_(t){if(!lp(t))return e_(t);var s=[];for(var n in Object(t))s_.call(t,n)&&n!="constructor"&&s.push(n);return s}function xb(t){return t!=null&&gb(t.length)&&!db(t)}function op(t){return xb(t)?vb(t):a_(t)}function n_(t,s){return t&&Tu(s,op(s),t)}function r_(t){var s=[];if(t!=null)for(var n in Object(t))s.push(n);return s}var i_=Object.prototype,l_=i_.hasOwnProperty;function o_(t){if(!ic(t))return r_(t);var s=lp(t),n=[];for(var i in t)i=="constructor"&&(s||!l_.call(t,i))||n.push(i);return n}function cp(t){return xb(t)?vb(t,!0):o_(t)}function c_(t,s){return t&&Tu(s,cp(s),t)}var jb=typeof ea=="object"&&ea&&!ea.nodeType&&ea,Xx=jb&&typeof ta=="object"&&ta&&!ta.nodeType&&ta,d_=Xx&&Xx.exports===jb,Zx=d_?en.Buffer:void 0,Wx=Zx?Zx.allocUnsafe:void 0;function u_(t,s){if(s)return t.slice();var n=t.length,i=Wx?Wx(n):new t.constructor(n);return t.copy(i),i}function bb(t,s){var n=-1,i=t.length;for(s||(s=Array(i));++n<i;)s[n]=t[n];return s}function h_(t,s){for(var n=-1,i=t==null?0:t.length,l=0,c=[];++n<i;){var u=t[n];s(u,n,t)&&(c[l++]=u)}return c}function Nb(){return[]}var f_=Object.prototype,m_=f_.propertyIsEnumerable,Kx=Object.getOwnPropertySymbols,dp=Kx?function(t){return t==null?[]:(t=Object(t),h_(Kx(t),function(s){return m_.call(t,s)}))}:Nb;function p_(t,s){return Tu(t,dp(t),s)}function Sb(t,s){for(var n=-1,i=s.length,l=t.length;++n<i;)t[l+n]=s[n];return t}var g_=Object.getOwnPropertySymbols,wb=g_?function(t){for(var s=[];t;)Sb(s,dp(t)),t=rp(t);return s}:Nb;function y_(t,s){return Tu(t,wb(t),s)}function Tb(t,s,n){var i=s(t);return lc(t)?i:Sb(i,n(t))}function v_(t){return Tb(t,op,dp)}function x_(t){return Tb(t,cp,wb)}var km=vi(en,"DataView"),_m=vi(en,"Promise"),Om=vi(en,"Set"),Im=vi(en,"WeakMap"),Jx="[object Map]",j_="[object Object]",ej="[object Promise]",tj="[object Set]",sj="[object WeakMap]",aj="[object DataView]",b_=yi(km),N_=yi(Vo),S_=yi(_m),w_=yi(Om),T_=yi(Im),Sn=pi;(km&&Sn(new km(new ArrayBuffer(1)))!=aj||Vo&&Sn(new Vo)!=Jx||_m&&Sn(_m.resolve())!=ej||Om&&Sn(new Om)!=tj||Im&&Sn(new Im)!=sj)&&(Sn=function(t){var s=pi(t),n=s==j_?t.constructor:void 0,i=n?yi(n):"";if(i)switch(i){case b_:return aj;case N_:return Jx;case S_:return ej;case w_:return tj;case T_:return sj}return s});var E_=Object.prototype,A_=E_.hasOwnProperty;function C_(t){var s=t.length,n=new t.constructor(s);return s&&typeof t[0]=="string"&&A_.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var nj=en.Uint8Array;function up(t){var s=new t.constructor(t.byteLength);return new nj(s).set(new nj(t)),s}function D_(t,s){var n=s?up(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var k_=/\w*$/;function __(t){var s=new t.constructor(t.source,k_.exec(t));return s.lastIndex=t.lastIndex,s}var rj=gr?gr.prototype:void 0,ij=rj?rj.valueOf:void 0;function O_(t){return ij?Object(ij.call(t)):{}}function I_(t,s){var n=s?up(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var $_="[object Boolean]",R_="[object Date]",M_="[object Map]",z_="[object Number]",L_="[object RegExp]",B_="[object Set]",F_="[object String]",U_="[object Symbol]",P_="[object ArrayBuffer]",q_="[object DataView]",H_="[object Float32Array]",Y_="[object Float64Array]",V_="[object Int8Array]",G_="[object Int16Array]",Q_="[object Int32Array]",X_="[object Uint8Array]",Z_="[object Uint8ClampedArray]",W_="[object Uint16Array]",K_="[object Uint32Array]";function J_(t,s,n){var i=t.constructor;switch(s){case P_:return up(t);case $_:case R_:return new i(+t);case q_:return D_(t,n);case H_:case Y_:case V_:case G_:case Q_:case X_:case Z_:case W_:case K_:return I_(t,n);case M_:return new i;case z_:case F_:return new i(t);case L_:return __(t);case B_:return new i;case U_:return O_(t)}}var lj=Object.create,eO=function(){function t(){}return function(s){if(!ic(s))return{};if(lj)return lj(s);t.prototype=s;var n=new t;return t.prototype=void 0,n}}();function tO(t){return typeof t.constructor=="function"&&!lp(t)?eO(rp(t)):{}}var sO="[object Map]";function aO(t){return gi(t)&&Sn(t)==sO}var oj=jl&&jl.isMap,nO=oj?ip(oj):aO,rO="[object Set]";function iO(t){return gi(t)&&Sn(t)==rO}var cj=jl&&jl.isSet,lO=cj?ip(cj):iO,oO=1,cO=2,dO=4,Eb="[object Arguments]",uO="[object Array]",hO="[object Boolean]",fO="[object Date]",mO="[object Error]",Ab="[object Function]",pO="[object GeneratorFunction]",gO="[object Map]",yO="[object Number]",Cb="[object Object]",vO="[object RegExp]",xO="[object Set]",jO="[object String]",bO="[object Symbol]",NO="[object WeakMap]",SO="[object ArrayBuffer]",wO="[object DataView]",TO="[object Float32Array]",EO="[object Float64Array]",AO="[object Int8Array]",CO="[object Int16Array]",DO="[object Int32Array]",kO="[object Uint8Array]",_O="[object Uint8ClampedArray]",OO="[object Uint16Array]",IO="[object Uint32Array]",jt={};jt[Eb]=jt[uO]=jt[SO]=jt[wO]=jt[hO]=jt[fO]=jt[TO]=jt[EO]=jt[AO]=jt[CO]=jt[DO]=jt[gO]=jt[yO]=jt[Cb]=jt[vO]=jt[xO]=jt[jO]=jt[bO]=jt[kO]=jt[_O]=jt[OO]=jt[IO]=!0;jt[mO]=jt[Ab]=jt[NO]=!1;function zo(t,s,n,i,l,c){var u,f=s&oO,p=s&cO,m=s&dO;if(u!==void 0)return u;if(!ic(t))return t;var y=lc(t);if(y){if(u=C_(t),!f)return bb(t,u)}else{var v=Sn(t),j=v==Ab||v==pO;if(pb(t))return u_(t,f);if(v==Cb||v==Eb||j&&!l){if(u=p||j?{}:tO(t),!f)return p?y_(t,c_(u,t)):p_(t,n_(u,t))}else{if(!jt[v])return l?t:{};u=J_(t,v,f)}}c||(c=new Dl);var N=c.get(t);if(N)return N;c.set(t,u),lO(t)?t.forEach(function(A){u.add(zo(A,s,n,A,t,c))}):nO(t)&&t.forEach(function(A,S){u.set(S,zo(A,s,n,S,t,c))});var b=m?p?x_:v_:p?cp:op,w=y?void 0:b(t);return ck(w||t,function(A,S){w&&(S=A,A=t[S]),hb(u,S,zo(A,s,n,S,t,c))}),u}var $O=1,RO=4;function Ad(t){return zo(t,$O|RO)}var sm,dj;function MO(){if(dj)return sm;dj=1;var t=Array.isArray,s=Object.keys,n=Object.prototype.hasOwnProperty,i=typeof Element<"u";function l(c,u){if(c===u)return!0;if(c&&u&&typeof c=="object"&&typeof u=="object"){var f=t(c),p=t(u),m,y,v;if(f&&p){if(y=c.length,y!=u.length)return!1;for(m=y;m--!==0;)if(!l(c[m],u[m]))return!1;return!0}if(f!=p)return!1;var j=c instanceof Date,N=u instanceof Date;if(j!=N)return!1;if(j&&N)return c.getTime()==u.getTime();var b=c instanceof RegExp,w=u instanceof RegExp;if(b!=w)return!1;if(b&&w)return c.toString()==u.toString();var A=s(c);if(y=A.length,y!==s(u).length)return!1;for(m=y;m--!==0;)if(!n.call(u,A[m]))return!1;if(i&&c instanceof Element&&u instanceof Element)return c===u;for(m=y;m--!==0;)if(v=A[m],!(v==="_owner"&&c.$$typeof)&&!l(c[v],u[v]))return!1;return!0}return c!==c&&u!==u}return sm=function(u,f){try{return l(u,f)}catch(p){if(p.message&&p.message.match(/stack|recursion/i)||p.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",p.name,p.message),!1;throw p}},sm}var zO=MO();const Qr=Ja(zO);var LO=4;function uj(t){return zo(t,LO)}function Db(t,s){for(var n=-1,i=t==null?0:t.length,l=Array(i);++n<i;)l[n]=s(t[n],n,t);return l}var BO="[object Symbol]";function hp(t){return typeof t=="symbol"||gi(t)&&pi(t)==BO}var FO="Expected a function";function fp(t,s){if(typeof t!="function"||s!=null&&typeof s!="function")throw new TypeError(FO);var n=function(){var i=arguments,l=s?s.apply(this,i):i[0],c=n.cache;if(c.has(l))return c.get(l);var u=t.apply(this,i);return n.cache=c.set(l,u)||c,u};return n.cache=new(fp.Cache||Nr),n}fp.Cache=Nr;var UO=500;function PO(t){var s=fp(t,function(i){return n.size===UO&&n.clear(),i}),n=s.cache;return s}var qO=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,HO=/\\(\\)?/g,YO=PO(function(t){var s=[];return t.charCodeAt(0)===46&&s.push(""),t.replace(qO,function(n,i,l,c){s.push(l?c.replace(HO,"$1"):i||n)}),s});function VO(t){if(typeof t=="string"||hp(t))return t;var s=t+"";return s=="0"&&1/t==-1/0?"-0":s}var hj=gr?gr.prototype:void 0,fj=hj?hj.toString:void 0;function kb(t){if(typeof t=="string")return t;if(lc(t))return Db(t,kb)+"";if(hp(t))return fj?fj.call(t):"";var s=t+"";return s=="0"&&1/t==-1/0?"-0":s}function GO(t){return t==null?"":kb(t)}function _b(t){return lc(t)?Db(t,VO):hp(t)?[t]:bb(YO(GO(t)))}var am={exports:{}},ct={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mj;function QO(){if(mj)return ct;mj=1;var t=typeof Symbol=="function"&&Symbol.for,s=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,i=t?Symbol.for("react.fragment"):60107,l=t?Symbol.for("react.strict_mode"):60108,c=t?Symbol.for("react.profiler"):60114,u=t?Symbol.for("react.provider"):60109,f=t?Symbol.for("react.context"):60110,p=t?Symbol.for("react.async_mode"):60111,m=t?Symbol.for("react.concurrent_mode"):60111,y=t?Symbol.for("react.forward_ref"):60112,v=t?Symbol.for("react.suspense"):60113,j=t?Symbol.for("react.suspense_list"):60120,N=t?Symbol.for("react.memo"):60115,b=t?Symbol.for("react.lazy"):60116,w=t?Symbol.for("react.block"):60121,A=t?Symbol.for("react.fundamental"):60117,S=t?Symbol.for("react.responder"):60118,C=t?Symbol.for("react.scope"):60119;function D(T){if(typeof T=="object"&&T!==null){var R=T.$$typeof;switch(R){case s:switch(T=T.type,T){case p:case m:case i:case c:case l:case v:return T;default:switch(T=T&&T.$$typeof,T){case f:case y:case b:case N:case u:return T;default:return R}}case n:return R}}}function I(T){return D(T)===m}return ct.AsyncMode=p,ct.ConcurrentMode=m,ct.ContextConsumer=f,ct.ContextProvider=u,ct.Element=s,ct.ForwardRef=y,ct.Fragment=i,ct.Lazy=b,ct.Memo=N,ct.Portal=n,ct.Profiler=c,ct.StrictMode=l,ct.Suspense=v,ct.isAsyncMode=function(T){return I(T)||D(T)===p},ct.isConcurrentMode=I,ct.isContextConsumer=function(T){return D(T)===f},ct.isContextProvider=function(T){return D(T)===u},ct.isElement=function(T){return typeof T=="object"&&T!==null&&T.$$typeof===s},ct.isForwardRef=function(T){return D(T)===y},ct.isFragment=function(T){return D(T)===i},ct.isLazy=function(T){return D(T)===b},ct.isMemo=function(T){return D(T)===N},ct.isPortal=function(T){return D(T)===n},ct.isProfiler=function(T){return D(T)===c},ct.isStrictMode=function(T){return D(T)===l},ct.isSuspense=function(T){return D(T)===v},ct.isValidElementType=function(T){return typeof T=="string"||typeof T=="function"||T===i||T===m||T===c||T===l||T===v||T===j||typeof T=="object"&&T!==null&&(T.$$typeof===b||T.$$typeof===N||T.$$typeof===u||T.$$typeof===f||T.$$typeof===y||T.$$typeof===A||T.$$typeof===S||T.$$typeof===C||T.$$typeof===w)},ct.typeOf=D,ct}var pj;function XO(){return pj||(pj=1,am.exports=QO()),am.exports}var nm,gj;function ZO(){if(gj)return nm;gj=1;var t=XO(),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},c={};c[t.ForwardRef]=i,c[t.Memo]=l;function u(b){return t.isMemo(b)?l:c[b.$$typeof]||s}var f=Object.defineProperty,p=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,y=Object.getOwnPropertyDescriptor,v=Object.getPrototypeOf,j=Object.prototype;function N(b,w,A){if(typeof w!="string"){if(j){var S=v(w);S&&S!==j&&N(b,S,A)}var C=p(w);m&&(C=C.concat(m(w)));for(var D=u(b),I=u(w),T=0;T<C.length;++T){var R=C[T];if(!n[R]&&!(A&&A[R])&&!(I&&I[R])&&!(D&&D[R])){var E=y(w,R);try{f(b,R,E)}catch{}}}}return b}return nm=N,nm}ZO();function Tt(){return Tt=Object.assign||function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Tt.apply(this,arguments)}function nl(t,s){if(t==null)return{};var n={},i=Object.keys(t),l,c;for(c=0;c<i.length;c++)l=i[c],!(s.indexOf(l)>=0)&&(n[l]=t[l]);return n}var Eu=x.createContext(void 0);Eu.displayName="FormikContext";var WO=Eu.Provider;Eu.Consumer;function Sr(){var t=x.useContext(Eu);return t}var Ws=function(s){return typeof s=="function"},oc=function(s){return s!==null&&typeof s=="object"},KO=function(s){return String(Math.floor(Number(s)))===s},rm=function(s){return Object.prototype.toString.call(s)==="[object String]"},JO=function(s){return x.Children.count(s)===0},im=function(s){return oc(s)&&Ws(s.then)};function Qs(t,s,n,i){i===void 0&&(i=0);for(var l=_b(s);t&&i<l.length;)t=t[l[i++]];return i!==l.length&&!t||t===void 0?n:t}function ni(t,s,n){for(var i=uj(t),l=i,c=0,u=_b(s);c<u.length-1;c++){var f=u[c],p=Qs(t,u.slice(0,c+1));if(p&&(oc(p)||Array.isArray(p)))l=l[f]=uj(p);else{var m=u[c+1];l=l[f]=KO(m)&&Number(m)>=0?[]:{}}}return(c===0?t:l)[u[c]]===n?t:(n===void 0?delete l[u[c]]:l[u[c]]=n,c===0&&n===void 0&&delete i[u[c]],i)}function Ob(t,s,n,i){n===void 0&&(n=new WeakMap),i===void 0&&(i={});for(var l=0,c=Object.keys(t);l<c.length;l++){var u=c[l],f=t[u];oc(f)?n.get(f)||(n.set(f,!0),i[u]=Array.isArray(f)?[]:{},Ob(f,s,n,i[u])):i[u]=s}return i}function eI(t,s){switch(s.type){case"SET_VALUES":return Tt({},t,{values:s.payload});case"SET_TOUCHED":return Tt({},t,{touched:s.payload});case"SET_ERRORS":return Qr(t.errors,s.payload)?t:Tt({},t,{errors:s.payload});case"SET_STATUS":return Tt({},t,{status:s.payload});case"SET_ISSUBMITTING":return Tt({},t,{isSubmitting:s.payload});case"SET_ISVALIDATING":return Tt({},t,{isValidating:s.payload});case"SET_FIELD_VALUE":return Tt({},t,{values:ni(t.values,s.payload.field,s.payload.value)});case"SET_FIELD_TOUCHED":return Tt({},t,{touched:ni(t.touched,s.payload.field,s.payload.value)});case"SET_FIELD_ERROR":return Tt({},t,{errors:ni(t.errors,s.payload.field,s.payload.value)});case"RESET_FORM":return Tt({},t,s.payload);case"SET_FORMIK_STATE":return s.payload(t);case"SUBMIT_ATTEMPT":return Tt({},t,{touched:Ob(t.values,!0),isSubmitting:!0,submitCount:t.submitCount+1});case"SUBMIT_FAILURE":return Tt({},t,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Tt({},t,{isSubmitting:!1});default:return t}}var Gr={},Cd={};function tI(t){var s=t.validateOnChange,n=s===void 0?!0:s,i=t.validateOnBlur,l=i===void 0?!0:i,c=t.validateOnMount,u=c===void 0?!1:c,f=t.isInitialValid,p=t.enableReinitialize,m=p===void 0?!1:p,y=t.onSubmit,v=nl(t,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),j=Tt({validateOnChange:n,validateOnBlur:l,validateOnMount:u,onSubmit:y},v),N=x.useRef(j.initialValues),b=x.useRef(j.initialErrors||Gr),w=x.useRef(j.initialTouched||Cd),A=x.useRef(j.initialStatus),S=x.useRef(!1),C=x.useRef({});x.useEffect(function(){return S.current=!0,function(){S.current=!1}},[]);var D=x.useState(0),I=D[1],T=x.useRef({values:Ad(j.initialValues),errors:Ad(j.initialErrors)||Gr,touched:Ad(j.initialTouched)||Cd,status:Ad(j.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),R=T.current,E=x.useCallback(function(V){var ue=T.current;T.current=eI(ue,V),ue!==T.current&&I(function(ve){return ve+1})},[]),_=x.useCallback(function(V,ue){return new Promise(function(ve,Ne){var _e=j.validate(V,ue);_e==null?ve(Gr):im(_e)?_e.then(function(Ie){ve(Ie||Gr)},function(Ie){Ne(Ie)}):ve(_e)})},[j.validate]),k=x.useCallback(function(V,ue){var ve=j.validationSchema,Ne=Ws(ve)?ve(ue):ve,_e=ue&&Ne.validateAt?Ne.validateAt(ue,V):aI(V,Ne);return new Promise(function(Ie,Ue){_e.then(function(){Ie(Gr)},function(It){It.name==="ValidationError"?Ie(sI(It)):Ue(It)})})},[j.validationSchema]),z=x.useCallback(function(V,ue){return new Promise(function(ve){return ve(C.current[V].validate(ue))})},[]),M=x.useCallback(function(V){var ue=Object.keys(C.current).filter(function(Ne){return Ws(C.current[Ne].validate)}),ve=ue.length>0?ue.map(function(Ne){return z(Ne,Qs(V,Ne))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(ve).then(function(Ne){return Ne.reduce(function(_e,Ie,Ue){return Ie==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||Ie&&(_e=ni(_e,ue[Ue],Ie)),_e},{})})},[z]),G=x.useCallback(function(V){return Promise.all([M(V),j.validationSchema?k(V):{},j.validate?_(V):{}]).then(function(ue){var ve=ue[0],Ne=ue[1],_e=ue[2],Ie=Dm.all([ve,Ne,_e],{arrayMerge:nI});return Ie})},[j.validate,j.validationSchema,M,_,k]),X=ga(function(V){return V===void 0&&(V=R.values),E({type:"SET_ISVALIDATING",payload:!0}),G(V).then(function(ue){return S.current&&(E({type:"SET_ISVALIDATING",payload:!1}),E({type:"SET_ERRORS",payload:ue})),ue})});x.useEffect(function(){u&&S.current===!0&&Qr(N.current,j.initialValues)&&X(N.current)},[u,X]);var W=x.useCallback(function(V){var ue=V&&V.values?V.values:N.current,ve=V&&V.errors?V.errors:b.current?b.current:j.initialErrors||{},Ne=V&&V.touched?V.touched:w.current?w.current:j.initialTouched||{},_e=V&&V.status?V.status:A.current?A.current:j.initialStatus;N.current=ue,b.current=ve,w.current=Ne,A.current=_e;var Ie=function(){E({type:"RESET_FORM",payload:{isSubmitting:!!V&&!!V.isSubmitting,errors:ve,touched:Ne,status:_e,values:ue,isValidating:!!V&&!!V.isValidating,submitCount:V&&V.submitCount&&typeof V.submitCount=="number"?V.submitCount:0}})};if(j.onReset){var Ue=j.onReset(R.values,ne);im(Ue)?Ue.then(Ie):Ie()}else Ie()},[j.initialErrors,j.initialStatus,j.initialTouched,j.onReset]);x.useEffect(function(){S.current===!0&&!Qr(N.current,j.initialValues)&&m&&(N.current=j.initialValues,W(),u&&X(N.current))},[m,j.initialValues,W,u,X]),x.useEffect(function(){m&&S.current===!0&&!Qr(b.current,j.initialErrors)&&(b.current=j.initialErrors||Gr,E({type:"SET_ERRORS",payload:j.initialErrors||Gr}))},[m,j.initialErrors]),x.useEffect(function(){m&&S.current===!0&&!Qr(w.current,j.initialTouched)&&(w.current=j.initialTouched||Cd,E({type:"SET_TOUCHED",payload:j.initialTouched||Cd}))},[m,j.initialTouched]),x.useEffect(function(){m&&S.current===!0&&!Qr(A.current,j.initialStatus)&&(A.current=j.initialStatus,E({type:"SET_STATUS",payload:j.initialStatus}))},[m,j.initialStatus,j.initialTouched]);var te=ga(function(V){if(C.current[V]&&Ws(C.current[V].validate)){var ue=Qs(R.values,V),ve=C.current[V].validate(ue);return im(ve)?(E({type:"SET_ISVALIDATING",payload:!0}),ve.then(function(Ne){return Ne}).then(function(Ne){E({type:"SET_FIELD_ERROR",payload:{field:V,value:Ne}}),E({type:"SET_ISVALIDATING",payload:!1})})):(E({type:"SET_FIELD_ERROR",payload:{field:V,value:ve}}),Promise.resolve(ve))}else if(j.validationSchema)return E({type:"SET_ISVALIDATING",payload:!0}),k(R.values,V).then(function(Ne){return Ne}).then(function(Ne){E({type:"SET_FIELD_ERROR",payload:{field:V,value:Qs(Ne,V)}}),E({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),L=x.useCallback(function(V,ue){var ve=ue.validate;C.current[V]={validate:ve}},[]),J=x.useCallback(function(V){delete C.current[V]},[]),K=ga(function(V,ue){E({type:"SET_TOUCHED",payload:V});var ve=ue===void 0?l:ue;return ve?X(R.values):Promise.resolve()}),le=x.useCallback(function(V){E({type:"SET_ERRORS",payload:V})},[]),O=ga(function(V,ue){var ve=Ws(V)?V(R.values):V;E({type:"SET_VALUES",payload:ve});var Ne=ue===void 0?n:ue;return Ne?X(ve):Promise.resolve()}),U=x.useCallback(function(V,ue){E({type:"SET_FIELD_ERROR",payload:{field:V,value:ue}})},[]),Y=ga(function(V,ue,ve){E({type:"SET_FIELD_VALUE",payload:{field:V,value:ue}});var Ne=ve===void 0?n:ve;return Ne?X(ni(R.values,V,ue)):Promise.resolve()}),Z=x.useCallback(function(V,ue){var ve=ue,Ne=V,_e;if(!rm(V)){V.persist&&V.persist();var Ie=V.target?V.target:V.currentTarget,Ue=Ie.type,It=Ie.name,qe=Ie.id,mt=Ie.value,$t=Ie.checked;Ie.outerHTML;var Pt=Ie.options,yt=Ie.multiple;ve=ue||It||qe,Ne=/number|range/.test(Ue)?(_e=parseFloat(mt),isNaN(_e)?"":_e):/checkbox/.test(Ue)?iI(Qs(R.values,ve),$t,mt):Pt&&yt?rI(Pt):mt}ve&&Y(ve,Ne)},[Y,R.values]),H=ga(function(V){if(rm(V))return function(ue){return Z(ue,V)};Z(V)}),P=ga(function(V,ue,ve){ue===void 0&&(ue=!0),E({type:"SET_FIELD_TOUCHED",payload:{field:V,value:ue}});var Ne=ve===void 0?l:ve;return Ne?X(R.values):Promise.resolve()}),q=x.useCallback(function(V,ue){V.persist&&V.persist();var ve=V.target,Ne=ve.name,_e=ve.id;ve.outerHTML;var Ie=ue||Ne||_e;P(Ie,!0)},[P]),B=ga(function(V){if(rm(V))return function(ue){return q(ue,V)};q(V)}),se=x.useCallback(function(V){Ws(V)?E({type:"SET_FORMIK_STATE",payload:V}):E({type:"SET_FORMIK_STATE",payload:function(){return V}})},[]),ae=x.useCallback(function(V){E({type:"SET_STATUS",payload:V})},[]),oe=x.useCallback(function(V){E({type:"SET_ISSUBMITTING",payload:V})},[]),ce=ga(function(){return E({type:"SUBMIT_ATTEMPT"}),X().then(function(V){var ue=V instanceof Error,ve=!ue&&Object.keys(V).length===0;if(ve){var Ne;try{if(Ne=pe(),Ne===void 0)return}catch(_e){throw _e}return Promise.resolve(Ne).then(function(_e){return S.current&&E({type:"SUBMIT_SUCCESS"}),_e}).catch(function(_e){if(S.current)throw E({type:"SUBMIT_FAILURE"}),_e})}else if(S.current&&(E({type:"SUBMIT_FAILURE"}),ue))throw V})}),Q=ga(function(V){V&&V.preventDefault&&Ws(V.preventDefault)&&V.preventDefault(),V&&V.stopPropagation&&Ws(V.stopPropagation)&&V.stopPropagation(),ce().catch(function(ue){console.warn("Warning: An unhandled error was caught from submitForm()",ue)})}),ne={resetForm:W,validateForm:X,validateField:te,setErrors:le,setFieldError:U,setFieldTouched:P,setFieldValue:Y,setStatus:ae,setSubmitting:oe,setTouched:K,setValues:O,setFormikState:se,submitForm:ce},pe=ga(function(){return y(R.values,ne)}),me=ga(function(V){V&&V.preventDefault&&Ws(V.preventDefault)&&V.preventDefault(),V&&V.stopPropagation&&Ws(V.stopPropagation)&&V.stopPropagation(),W()}),je=x.useCallback(function(V){return{value:Qs(R.values,V),error:Qs(R.errors,V),touched:!!Qs(R.touched,V),initialValue:Qs(N.current,V),initialTouched:!!Qs(w.current,V),initialError:Qs(b.current,V)}},[R.errors,R.touched,R.values]),Oe=x.useCallback(function(V){return{setValue:function(ve,Ne){return Y(V,ve,Ne)},setTouched:function(ve,Ne){return P(V,ve,Ne)},setError:function(ve){return U(V,ve)}}},[Y,P,U]),De=x.useCallback(function(V){var ue=oc(V),ve=ue?V.name:V,Ne=Qs(R.values,ve),_e={name:ve,value:Ne,onChange:H,onBlur:B};if(ue){var Ie=V.type,Ue=V.value,It=V.as,qe=V.multiple;Ie==="checkbox"?Ue===void 0?_e.checked=!!Ne:(_e.checked=!!(Array.isArray(Ne)&&~Ne.indexOf(Ue)),_e.value=Ue):Ie==="radio"?(_e.checked=Ne===Ue,_e.value=Ue):It==="select"&&qe&&(_e.value=_e.value||[],_e.multiple=!0)}return _e},[B,H,R.values]),be=x.useMemo(function(){return!Qr(N.current,R.values)},[N.current,R.values]),Te=x.useMemo(function(){return typeof f<"u"?be?R.errors&&Object.keys(R.errors).length===0:f!==!1&&Ws(f)?f(j):f:R.errors&&Object.keys(R.errors).length===0},[f,be,R.errors,j]),Be=Tt({},R,{initialValues:N.current,initialErrors:b.current,initialTouched:w.current,initialStatus:A.current,handleBlur:B,handleChange:H,handleReset:me,handleSubmit:Q,resetForm:W,setErrors:le,setFormikState:se,setFieldTouched:P,setFieldValue:Y,setFieldError:U,setStatus:ae,setSubmitting:oe,setTouched:K,setValues:O,submitForm:ce,validateForm:X,validateField:te,isValid:Te,dirty:be,unregisterField:J,registerField:L,getFieldProps:De,getFieldMeta:je,getFieldHelpers:Oe,validateOnBlur:l,validateOnChange:n,validateOnMount:u});return Be}function yr(t){var s=tI(t),n=t.component,i=t.children,l=t.render,c=t.innerRef;return x.useImperativeHandle(c,function(){return s}),x.createElement(WO,{value:s},n?x.createElement(n,s):l?l(s):i?Ws(i)?i(s):JO(i)?null:x.Children.only(i):null)}function sI(t){var s={};if(t.inner){if(t.inner.length===0)return ni(s,t.path,t.message);for(var l=t.inner,n=Array.isArray(l),i=0,l=n?l:l[Symbol.iterator]();;){var c;if(n){if(i>=l.length)break;c=l[i++]}else{if(i=l.next(),i.done)break;c=i.value}var u=c;Qs(s,u.path)||(s=ni(s,u.path,u.message))}}return s}function aI(t,s,n,i){n===void 0&&(n=!1);var l=$m(t);return s[n?"validateSync":"validate"](l,{abortEarly:!1,context:l})}function $m(t){var s=Array.isArray(t)?[]:{};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=String(n);Array.isArray(t[i])===!0?s[i]=t[i].map(function(l){return Array.isArray(l)===!0||Px(l)?$m(l):l!==""?l:void 0}):Px(t[i])?s[i]=$m(t[i]):s[i]=t[i]!==""?t[i]:void 0}return s}function nI(t,s,n){var i=t.slice();return s.forEach(function(c,u){if(typeof i[u]>"u"){var f=n.clone!==!1,p=f&&n.isMergeableObject(c);i[u]=p?Dm(Array.isArray(c)?[]:{},c,n):c}else n.isMergeableObject(c)?i[u]=Dm(t[u],c,n):t.indexOf(c)===-1&&i.push(c)}),i}function rI(t){return Array.from(t).filter(function(s){return s.selected}).map(function(s){return s.value})}function iI(t,s,n){if(typeof t=="boolean")return!!s;var i=[],l=!1,c=-1;if(Array.isArray(t))i=t,c=t.indexOf(n),l=c>=0;else if(!n||n=="true"||n=="false")return!!s;return s&&n&&!l?i.concat(n):l?i.slice(0,c).concat(i.slice(c+1)):i}var lI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?x.useLayoutEffect:x.useEffect;function ga(t){var s=x.useRef(t);return lI(function(){s.current=t}),x.useCallback(function(){for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return s.current.apply(void 0,i)},[])}function Ib(t){var s=Sr(),n=s.getFieldProps,i=s.getFieldMeta,l=s.getFieldHelpers,c=s.registerField,u=s.unregisterField,f=oc(t),p=f?t:{name:t},m=p.name,y=p.validate;x.useEffect(function(){return m&&c(m,{validate:y}),function(){m&&u(m)}},[c,u,m,y]);var v=x.useMemo(function(){return l(m)},[l,m]);return[n(p),i(m),v]}function Oa(t){var s=t.validate,n=t.name,i=t.render,l=t.children,c=t.as,u=t.component,f=t.className,p=nl(t,["validate","name","render","children","as","component","className"]),m=Sr(),y=nl(m,["validate","validationSchema"]),v=y.registerField,j=y.unregisterField;x.useEffect(function(){return v(n,{validate:s}),function(){j(n)}},[v,j,n,s]);var N=y.getFieldProps(Tt({name:n},p)),b=y.getFieldMeta(n),w={field:N,form:y};if(i)return i(Tt({},w,{meta:b}));if(Ws(l))return l(Tt({},w,{meta:b}));if(u){if(typeof u=="string"){var A=p.innerRef,S=nl(p,["innerRef"]);return x.createElement(u,Tt({ref:A},N,S,{className:f}),l)}return x.createElement(u,Tt({field:N,form:y},p,{className:f}),l)}var C=c||"input";if(typeof C=="string"){var D=p.innerRef,I=nl(p,["innerRef"]);return x.createElement(C,Tt({ref:D},N,I,{className:f}),l)}return x.createElement(C,Tt({},N,p,{className:f}),l)}var In=x.forwardRef(function(t,s){var n=t.action,i=nl(t,["action"]),l=n??"#",c=Sr(),u=c.handleReset,f=c.handleSubmit;return x.createElement("form",Tt({onSubmit:f,ref:s,onReset:u,action:l},i))});In.displayName="Form";const Me=({label:t,name:s,required:n=!1,className:i="",errorMessage:l,labelIcon:c,style:u,disabled:f,children:p,searchable:m=!1,...y})=>{const[v,j]=Ib(s),N=j.touched&&j.error,[b,w]=x.useState(!1),[A,S]=x.useState(""),[C,D]=x.useState(-1),I=x.useRef(null),T=x.useRef(null),R=`${i||""} ${N?"is-invalid":""}`,E=ii.Children.toArray(p).filter(M=>ii.isValidElement(M)&&M.type==="option"),_=m?E.filter(M=>{var X;return(((X=M.props.children)==null?void 0:X.toString().toLowerCase())||"").includes(A.toLowerCase())}):E,k=E.find(M=>M.props.value===v.value),z=(k==null?void 0:k.props.children)||y.placeholder||"בחר אפשרות...";return x.useEffect(()=>{const M=G=>{I.current&&!I.current.contains(G.target)&&(w(!1),S(""),D(-1))};if(m)return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[m]),x.useEffect(()=>{const M=G=>{if(!(!m||!b))switch(G.key){case"ArrowDown":G.preventDefault(),D(X=>X<_.length-1?X+1:X);break;case"ArrowUp":G.preventDefault(),D(X=>X>0?X-1:X);break;case"Enter":if(G.preventDefault(),C>=0&&_[C]){const X=_[C].props.value;v.onChange({target:{name:v.name,value:X}}),w(!1),S(""),D(-1)}break;case"Escape":w(!1),S(""),D(-1);break}};return document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)},[m,b,C,_,v]),e.jsxs("div",{className:"form-group",style:u,children:[e.jsxs("div",{className:"field-header",children:[e.jsxs("label",{htmlFor:y.id||s,className:n?"required-field":"",children:[c&&e.jsx("span",{className:"label-icon",children:c}),t]}),N&&e.jsx("div",{className:"form-error-inline",children:l||j.error})]}),y.as==="select"?m?e.jsxs("div",{ref:I,className:"searchable-select-field",children:[e.jsxs("div",{className:`searchable-select-display ${R} ${b?"open":""}`,onClick:()=>{f||(w(!b),b||setTimeout(()=>{var M;return(M=T.current)==null?void 0:M.focus()},100))},children:[e.jsx("span",{className:`display-text ${v.value?"":"placeholder"}`,children:v.value?z:y.placeholder||"בחר אפשרות..."}),e.jsx(bt,{className:`select-chevron ${b?"open":""}`,size:14})]}),b&&e.jsxs("div",{className:"searchable-dropdown",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(pr,{size:14,className:"search-icon"}),e.jsx("input",{ref:T,type:"text",value:A,onChange:M=>{S(M.target.value),D(-1)},placeholder:"חיפוש...",className:"search-input"})]}),e.jsx("div",{className:"options-container",children:_.length>0?_.map((M,G)=>e.jsx("div",{className:`option ${G===C?"highlighted":""} ${M.props.value===v.value?"selected":""}`,onClick:()=>{v.onChange({target:{name:v.name,value:M.props.value}}),w(!1),S(""),D(-1)},onMouseEnter:()=>D(G),children:M.props.children},M.props.value||G)):e.jsx("div",{className:"no-options",children:"אין תוצאות"})})]})]}):e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{id:y.id||s,className:R,disabled:f,value:v.value===void 0||v.value===null?"":v.value,onChange:v.onChange,onBlur:v.onBlur,name:v.name,...y,children:p}),e.jsx(bt,{className:"select-chevron",size:14})]}):y.as==="textarea"?e.jsx("textarea",{id:y.id||s,className:R,disabled:f,...v,...y}):e.jsx("input",{id:y.id||s,className:R,type:y.type||"text",disabled:f,value:v.value===void 0?(y.type==="number",""):v.value,onChange:v.onChange,onBlur:v.onBlur,name:v.name,...y})]})},Ks={SUNDAY:"ראשון",MONDAY:"שני",TUESDAY:"שלישי",WEDNESDAY:"רביעי",THURSDAY:"חמישי",FRIDAY:"שישי",SATURDAY:"שבת"},$b={[Ks.SUNDAY]:0,[Ks.MONDAY]:1,[Ks.TUESDAY]:2,[Ks.WEDNESDAY]:3,[Ks.THURSDAY]:4,[Ks.FRIDAY]:5,[Ks.SATURDAY]:6},Qo=["א","ב","ג","ד","ה","ו","ז","ח","ט","י","יא","יב","אחר"],Au=["חלילית","חליל צד","אבוב","בסון","סקסופון","קלרינט","חצוצרה","קרן יער","טרומבון","טובה/בריטון","שירה","כינור","ויולה","צ'לו","קונטרבס","פסנתר","גיטרה","גיטרה בס","תופים"],Rm=["לא נבחן","עבר/ה","לא עבר/ה","עבר/ה בהצטיינות","עבר/ה בהצטיינות יתרה"],oI=[Ks.SUNDAY,Ks.MONDAY,Ks.TUESDAY,Ks.WEDNESDAY,Ks.THURSDAY,Ks.FRIDAY],cI=[30,45,60];function dI(){Sr();const[t,s,n]=Ib("personalInfo.age");return e.jsxs("div",{className:"form-section personal-info-section",children:[e.jsx("h3",{children:"פרטים אישיים"}),e.jsxs("div",{className:"form-row four-columns-mixed",children:[e.jsx(Me,{label:"שם מלא",name:"personalInfo.fullName",type:"text",required:!0,className:"wide-field"}),e.jsx(Me,{label:"טלפון",name:"personalInfo.phone",type:"tel",placeholder:"05XXXXXXXX",required:!0,className:"wide-field"}),e.jsxs("div",{className:"form-group narrow-field",children:[e.jsx("label",{htmlFor:"age-select",className:"required-field",children:"גיל"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{id:"age-select",name:t.name,value:t.value||"",onChange:t.onChange,onBlur:t.onBlur,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:2,cursor:"pointer"},children:[e.jsx("option",{value:"",children:"בחר גיל"}),Array.from({length:97},(i,l)=>l+3).map(i=>e.jsx("option",{value:i.toString(),children:i},i))]}),e.jsx("div",{className:"age-select-display",style:{position:"relative",zIndex:1,cursor:"pointer",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23a0aec0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"16px"},children:t.value||"בחר גיל"})]}),s.touched&&s.error&&e.jsx("div",{style:{color:"var(--danger, #e74c3c)",fontSize:"0.85rem",marginTop:"0.35rem"},children:s.error})]}),e.jsx(Me,{label:"כיתה",name:"academicInfo.class",as:"select",required:!0,className:"class-select narrow-field",children:Qo.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"כתובת",name:"personalInfo.address",type:"text",required:!0})}),e.jsx("h4",{children:"פרטי הורה"}),e.jsxs("div",{className:"form-row two-columns",children:[e.jsx(Me,{label:"שם הורה",name:"personalInfo.parentName",type:"text"}),e.jsx(Me,{label:"טלפון הורה",name:"personalInfo.parentPhone",type:"tel",placeholder:"05XXXXXXXX"})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"אימייל תלמיד",name:"personalInfo.studentEmail",type:"email",required:!0})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"אימייל הורה",name:"personalInfo.parentEmail",type:"email"})})]})}function uI({isEditMode:t=!1}){var G,X,W,te,L,J,K,le;const[s,n]=x.useState(!1),[i,l]=x.useState(null),[c,u]=x.useState({instrumentName:"",currentStage:1,isPrimary:!1,tests:{stageTest:{status:"לא נבחן",notes:""},technicalTest:{status:"לא נבחן",notes:""}}}),[f,p]=x.useState(!1),[m,y]=x.useState(""),[v,j]=x.useState(""),{values:N,setFieldValue:b}=Sr(),w=N.academicInfo.instrumentProgress,A=[1,2,3,4,5,6,7,8],S=Rm;x.useEffect(()=>{let O;return f&&(O=window.setTimeout(()=>{p(!1)},3e3)),()=>{O&&clearTimeout(O)}},[f]);const C=O=>{const{name:U,value:Y}=O.target;if(j(""),U.includes(".")){const[Z,H,P]=U.split(".");u(q=>{const B=q[Z]||{},ae={...B[H]||{},[P]:Y},oe={...B,[H]:ae};return{...q,[Z]:oe}})}else u(U==="isPrimary"?Z=>({...Z,isPrimary:O.target.checked}):Z=>({...Z,[U]:U==="currentStage"?parseInt(Y,10):Y}))},D=()=>c.instrumentName?w.some((O,U)=>O.instrumentName===c.instrumentName&&U!==i)?(j("כלי נגינה זה כבר קיים ברשימה"),!1):!0:(j("יש לבחור כלי נגינה"),!1),I=()=>{var Y,Z,H,P,q,B,se,ae;if(!D())return;const O={instrumentName:c.instrumentName,currentStage:c.currentStage||1,isPrimary:c.isPrimary||!1,tests:{stageTest:{status:((Z=(Y=c.tests)==null?void 0:Y.stageTest)==null?void 0:Z.status)||"לא נבחן",notes:((P=(H=c.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((B=(q=c.tests)==null?void 0:q.technicalTest)==null?void 0:B.status)||"לא נבחן",notes:((ae=(se=c.tests)==null?void 0:se.technicalTest)==null?void 0:ae.notes)||""}}};y(O.instrumentName);const U=[...w,O];O.isPrimary&&U.forEach((oe,ce)=>{oe.instrumentName!==O.instrumentName&&(U[ce].isPrimary=!1)}),b("academicInfo.instrumentProgress",U),p(!0),E(),n(!1)},T=O=>{var Y,Z,H,P,q,B,se,ae;const U=w[O];l(O),u({instrumentName:U.instrumentName,currentStage:U.currentStage,isPrimary:U.isPrimary,tests:{stageTest:{status:((Z=(Y=U.tests)==null?void 0:Y.stageTest)==null?void 0:Z.status)||"לא נבחן",notes:((P=(H=U.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((B=(q=U.tests)==null?void 0:q.technicalTest)==null?void 0:B.status)||"לא נבחן",notes:((ae=(se=U.tests)==null?void 0:se.technicalTest)==null?void 0:ae.notes)||""}}}),n(!0)},R=()=>{var Y,Z,H,P,q,B,se,ae;if(!D()||i===null)return;const O={instrumentName:c.instrumentName,currentStage:c.currentStage||1,isPrimary:c.isPrimary||!1,tests:{stageTest:{status:((Z=(Y=c.tests)==null?void 0:Y.stageTest)==null?void 0:Z.status)||"לא נבחן",notes:((P=(H=c.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||""},technicalTest:{status:((B=(q=c.tests)==null?void 0:q.technicalTest)==null?void 0:B.status)||"לא נבחן",notes:((ae=(se=c.tests)==null?void 0:se.technicalTest)==null?void 0:ae.notes)||""}}};y(O.instrumentName);const U=[...w];U[i]=O,O.isPrimary&&U.forEach((oe,ce)=>{ce!==i&&(U[ce].isPrimary=!1)}),b("academicInfo.instrumentProgress",U),p(!0),E(),n(!1),l(null)},E=()=>{u({instrumentName:"",currentStage:1,isPrimary:!1,tests:{stageTest:{status:"לא נבחן",notes:""},technicalTest:{status:"לא נבחן",notes:""}}}),j("")},_=()=>{n(!1),l(null),E()},k=O=>{const U=w.filter(Y=>Y.instrumentName!==O);b("academicInfo.instrumentProgress",U)},z=O=>{const U=w.map(Y=>({...Y,isPrimary:Y.instrumentName===O}));b("academicInfo.instrumentProgress",U)},M=O=>{switch(O){case"עבר/ה":return"status-passed";case"עבר/ה בהצלחה":return"status-success";case"עבר/ה בהצטיינות":return"status-excellent";case"עבר/ה בהצטיינות יתרה":return"status-excellent";case"לא עבר/ה":return"status-failed";default:return"status-pending"}};return e.jsxs("div",{className:"form-section instrument-section",children:[e.jsx("h3",{children:"כלי נגינה"}),f&&e.jsxs("div",{className:"success-message",children:[e.jsx(Bo,{size:16}),e.jsxs("span",{children:["הכלי ",m," נוסף בהצלחה"]})]}),w.length>0&&e.jsx("div",{className:"instruments-list",children:w.map((O,U)=>{var Y,Z,H,P,q,B,se,ae,oe,ce,Q,ne,pe,me,je,Oe;return e.jsx("div",{className:"instrument-card",children:e.jsxs("div",{className:"instrument-header",children:[e.jsxs("div",{className:"instrument-info",children:[e.jsxs("div",{className:"instrument-name-wrapper",children:[e.jsxs("div",{className:"instrument-name",children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:O.instrumentName}),O.isPrimary&&e.jsxs("span",{className:"primary-badge",children:[e.jsx(li,{size:12}),"ראשי"]})]}),e.jsxs("div",{className:"stage-badge",children:["שלב ",O.currentStage]})]}),t&&e.jsxs("div",{className:"test-badges",children:[e.jsxs("div",{className:`test-badge ${M(((Z=(Y=O.tests)==null?void 0:Y.technicalTest)==null?void 0:Z.status)||"לא נבחן")}`,children:[e.jsx("span",{className:"test-label",children:"טכני:"}),e.jsx("span",{className:"test-value",children:((P=(H=O.tests)==null?void 0:H.technicalTest)==null?void 0:P.status)||"לא נבחן"})]}),e.jsxs("div",{className:`test-badge ${M(((B=(q=O.tests)==null?void 0:q.stageTest)==null?void 0:B.status)||"לא נבחן")}`,children:[e.jsx("span",{className:"test-label",children:"שלב:"}),e.jsx("span",{className:"test-value",children:((ae=(se=O.tests)==null?void 0:se.stageTest)==null?void 0:ae.status)||"לא נבחן"})]})]}),t&&(((ce=(oe=O.tests)==null?void 0:oe.stageTest)==null?void 0:ce.notes)||((ne=(Q=O.tests)==null?void 0:Q.technicalTest)==null?void 0:ne.notes))&&e.jsx("div",{className:"test-notes",children:e.jsx("span",{children:((me=(pe=O.tests)==null?void 0:pe.stageTest)==null?void 0:me.notes)||((Oe=(je=O.tests)==null?void 0:je.technicalTest)==null?void 0:Oe.notes)})})]}),e.jsxs("div",{className:"instrument-actions",children:[e.jsx("button",{type:"button",className:"edit-btn",onClick:()=>T(U),"aria-label":"ערוך כלי נגינה",title:"ערוך כלי נגינה",children:e.jsx(Fo,{size:14})}),!O.isPrimary&&e.jsx("button",{type:"button",className:"set-primary-btn",onClick:()=>z(O.instrumentName),title:"הגדר כראשי",children:e.jsx(li,{size:14})}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>k(O.instrumentName),"aria-label":"הסר כלי נגינה",title:"הסר כלי נגינה",children:e.jsx(Ft,{size:14})})]})]})},`${O.instrumentName}-${O.currentStage}-${U}`)})}),s?e.jsxs("div",{className:"add-instrument-form",children:[e.jsx("h4",{children:i!==null?"עריכת כלי נגינה":"הוספת כלי נגינה"}),v&&e.jsxs("div",{className:"form-error-message",children:[e.jsx(Bs,{size:16}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"instrumentName",className:"required-field",children:"כלי נגינה"}),e.jsxs("select",{id:"instrumentName",name:"instrumentName",value:c.instrumentName,onChange:C,className:v?"is-invalid":"",children:[e.jsx("option",{value:"",children:"בחר כלי נגינה"}),Au.map(O=>e.jsx("option",{value:O,children:O},O))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentStage",children:"שלב"}),e.jsx("select",{id:"currentStage",name:"currentStage",value:c.currentStage,onChange:C,children:A.map(O=>e.jsx("option",{value:O,children:O},O))})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stageTestStatus",children:"מבחן שלב"}),e.jsx("select",{id:"stageTestStatus",name:"tests.stageTest.status",value:((X=(G=c.tests)==null?void 0:G.stageTest)==null?void 0:X.status)||"לא נבחן",onChange:C,children:S.map(O=>e.jsx("option",{value:O,children:O},O))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"technicalTestStatus",children:"מבחן טכני"}),e.jsx("select",{id:"technicalTestStatus",name:"tests.technicalTest.status",value:((te=(W=c.tests)==null?void 0:W.technicalTest)==null?void 0:te.status)||"לא נבחן",onChange:C,children:S.map(O=>e.jsx("option",{value:O,children:O},O))})]})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stageTestNotes",children:"הערות מבחן שלב"}),e.jsx("input",{type:"text",id:"stageTestNotes",name:"tests.stageTest.notes",value:((J=(L=c.tests)==null?void 0:L.stageTest)==null?void 0:J.notes)||"",onChange:C,placeholder:"הערות אופציונליות למבחן שלב"})]})}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"technicalTestNotes",children:"הערות מבחן טכני"}),e.jsx("input",{type:"text",id:"technicalTestNotes",name:"tests.technicalTest.notes",value:((le=(K=c.tests)==null?void 0:K.technicalTest)==null?void 0:le.notes)||"",onChange:C,placeholder:"הערות אופציונליות למבחן טכני"})]})})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"primary-checkbox",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",name:"isPrimary",checked:c.isPrimary,onChange:C}),e.jsx("label",{htmlFor:"isPrimary",children:"כלי נגינה ראשי"})]})}),e.jsxs("div",{className:"form-actions-row",children:[e.jsxs("button",{type:"button",className:"add-instrument-btn",onClick:i!==null?R:I,children:[e.jsx(Bo,{size:16}),i!==null?"עדכן":"הוסף"]}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:_,children:"ביטול"})]})]}):e.jsx("div",{className:"add-more-instruments",children:e.jsxs("button",{type:"button",className:"add-more-btn",onClick:()=>n(!0),children:[e.jsx(fs,{size:16}),"הוסף כלי נגינה"]})})]})}function hI({teachers:t,selectedTeacherId:s,onSelect:n,newTeacherInfo:i,isLoading:l=!1,disabled:c=!1,placeholder:u="בחר מורה",className:f=""}){const[p,m]=x.useState(!1),[y,v]=x.useState(""),[j,N]=x.useState(-1),b=x.useRef(null),w=x.useRef(null),A=x.useRef(null),S=ii.useMemo(()=>{const k=t.filter(z=>z.isActive).map(z=>{var M;return{id:z._id,name:z.personalInfo.fullName,instrument:(M=z.professionalInfo)==null?void 0:M.instrument,isNew:!1}});return i&&k.unshift({id:"new-teacher",name:i.fullName,instrument:i.instrument,isNew:!0}),k},[t,i]),C=ii.useMemo(()=>{if(!y.trim())return S;const k=y.toLowerCase();return S.filter(z=>z.name.toLowerCase().includes(k)||z.instrument&&z.instrument.toLowerCase().includes(k))},[S,y]),D=S.find(k=>k.id===s),I=D?D.name:"";x.useEffect(()=>{const k=z=>{b.current&&!b.current.contains(z.target)&&(m(!1),v(""),N(-1))};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]);const T=k=>{if(!c)switch(k.key){case"ArrowDown":k.preventDefault(),p?N(z=>z<C.length-1?z+1:0):m(!0);break;case"ArrowUp":k.preventDefault(),p&&N(z=>z>0?z-1:C.length-1);break;case"Enter":k.preventDefault(),p&&j>=0&&C[j]?R(C[j].id):p||m(!0);break;case"Escape":k.preventDefault(),m(!1),v(""),N(-1);break}},R=k=>{n(k),m(!1),v(""),N(-1)},E=()=>{c||m(!0)},_=k=>{const z=k.target.value;v(z),N(-1),p||m(!0)};return x.useEffect(()=>{if(j>=0&&A.current){const k=A.current.children[j];k&&k.scrollIntoView({block:"nearest",behavior:"smooth"})}},[j]),e.jsxs("div",{className:`searchable-teacher-select ${f} ${p?"open":""} ${c?"disabled":""}`,ref:b,children:[e.jsxs("div",{className:"select-input-container",children:[e.jsxs("div",{className:"select-input-wrapper",children:[e.jsx(Je,{size:16,className:"input-icon"}),e.jsx("input",{ref:w,type:"text",className:"select-input",value:p?y:I,onChange:_,onFocus:E,onKeyDown:T,placeholder:s?I:u,disabled:c||l,autoComplete:"off"}),e.jsx("button",{type:"button",className:"dropdown-toggle",onClick:()=>!c&&m(!p),disabled:c||l,"aria-label":"פתח רשימת מורים",children:l?e.jsx("div",{className:"spinner"}):e.jsx(bt,{size:16,className:`chevron ${p?"rotated":""}`})})]}),p&&e.jsx("div",{className:"dropdown-menu",ref:A,children:C.length===0?e.jsx("div",{className:"no-results",children:y?"לא נמצאו מורים התואמים לחיפוש":"אין מורים זמינים"}):e.jsxs(e.Fragment,{children:[!s&&e.jsx("div",{className:"dropdown-item placeholder-item",onClick:()=>R(""),children:u}),C.map((k,z)=>e.jsxs("div",{className:`dropdown-item ${k.id===s?"selected":""} ${z===j?"highlighted":""} ${k.isNew?"new-teacher":""}`,onClick:()=>R(k.id),onMouseEnter:()=>N(z),children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx("span",{className:"teacher-name",children:k.name}),k.instrument&&e.jsxs("span",{className:"teacher-instrument",children:["(",k.instrument,")"]}),k.isNew&&e.jsx("span",{className:"new-badge",children:"מורה חדש"})]}),k.id===s&&e.jsx(Bo,{size:16,className:"check-icon"})]},k.id))]})})]}),y&&p&&e.jsxs("div",{className:"search-info",children:[e.jsx(pr,{size:12}),e.jsxs("span",{children:['מחפש: "',y,'" (',C.length," תוצאות)"]})]})]})}const fI="modulepreload",mI=function(t){return"/"+t},yj={},rl=function(s,n,i){let l=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));l=Promise.allSettled(n.map(p=>{if(p=mI(p),p in yj)return;yj[p]=!0;const m=p.endsWith(".css"),y=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":fI,m||(v.as="script"),v.crossOrigin="",v.href=p,f&&v.setAttribute("nonce",f),document.head.appendChild(v),m)return new Promise((j,N)=>{v.addEventListener("load",j),v.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return l.then(u=>{for(const f of u||[])f.status==="rejected"&&c(f.reason);return s().catch(c)})},An=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],Rb=[30,45,60],$s={async createTimeBlock(t,s){try{return await ye.post(`schedule/time-blocks/teacher/${t}/time-block`,s)}catch(n){throw console.error("Failed to create time block:",n),n instanceof Error?n.message.includes("conflict")||n.message.includes("409")?new Error(`יום הלימוד מתנגש עם לוח זמנים קיים ביום ${s.day} בזמן ${s.startTime}-${s.endTime}. אנא בדוק את הלוח הקיים ובחר זמן אחר.`):n:new Error("שגיאה ביצירת יום לימוד חדש")}},async getAvailableSlots(t,s){var n,i,l,c,u,f,p;try{const m=(await rl(async()=>{const{default:A}=await Promise.resolve().then(()=>XA);return{default:A}},[])).default,y=new URLSearchParams;y.append("duration",s.duration.toString()),(n=s.preferredDays)!=null&&n.length&&y.append("preferredDays",s.preferredDays.join(",")),(i=s.preferredTimeRange)!=null&&i.startTime&&y.append("preferredStartTime",s.preferredTimeRange.startTime),(l=s.preferredTimeRange)!=null&&l.endTime&&y.append("preferredEndTime",s.preferredTimeRange.endTime),s.studentPreferences&&(s.studentPreferences.morningPreference!==void 0&&y.append("morningPreference",s.studentPreferences.morningPreference.toString()),s.studentPreferences.afternoonPreference!==void 0&&y.append("afternoonPreference",s.studentPreferences.afternoonPreference.toString()),s.studentPreferences.avoidBackToBack!==void 0&&y.append("avoidBackToBack",s.studentPreferences.avoidBackToBack.toString()));const v=y.toString(),N=`/api/schedule/time-blocks/teacher/${t}/available-slots${v?`?${v}`:""}`,b=localStorage.getItem("accessToken");return console.log("Original criteria:",s),console.log("Built full URL:",N),console.log("Query params:",v),(await m.get(N,{headers:{Authorization:b?`Bearer ${b}`:"","Content-Type":"application/json"},timeout:15e3,withCredentials:!0})).data}catch(m){throw console.error("Failed to get available slots:",m),((c=m.response)==null?void 0:c.status)===400&&((p=(f=(u=m.response)==null?void 0:u.data)==null?void 0:f.message)!=null&&p.includes("schoolYearId"))?new Error("שגיאת אימות פרמטרים - נסה שוב או פנה למנהל המערכת"):new Error("שגיאה בטעינת השעות הזמינות")}},async getTeacherTimeBlocks(t){try{return(await ye.get(`teacher/${t}/time-blocks`)).timeBlocks||[]}catch(s){return console.error("Failed to get teacher time blocks:",s),[]}},async assignLesson(t){try{return await ye.post("schedule/time-blocks/assign-lesson",t)}catch(s){throw console.error("Failed to assign lesson:",s),new Error("שגיאה בהקצאת השיעור")}},async getTeacherScheduleWithBlocks(t){var s,n;try{const{teacherService:i}=await rl(async()=>{const{teacherService:f}=await Promise.resolve().then(()=>Ud);return{teacherService:f}},void 0),l=await i.getTeacherById(t);if(!l)throw new Error("Teacher not found");const c=((s=l==null?void 0:l.teaching)==null?void 0:s.timeBlocks)||[],u={teacherId:t,teacherName:((n=l.personalInfo)==null?void 0:n.fullName)||"Unknown Teacher",timeBlocks:c.map(f=>({_id:f._id||f.id,teacherId:t,day:f.day,startTime:f.startTime,endTime:f.endTime,totalDuration:f.totalDuration||this.calculateTotalDuration(f.startTime,f.endTime),location:f.location||"",notes:f.notes||"",assignedLessons:f.assignedLessons||[],availableMinutes:f.availableMinutes||this.calculateTotalDuration(f.startTime,f.endTime),utilizationPercentage:f.utilizationPercentage||0,isActive:f.isActive!==!1,createdAt:f.createdAt||new Date().toISOString(),updatedAt:f.updatedAt||new Date().toISOString()})),weeklyStats:{totalTimeBlocks:c.length,totalAvailableMinutes:c.reduce((f,p)=>f+(p.availableMinutes||this.calculateTotalDuration(p.startTime,p.endTime)),0),totalAssignedMinutes:c.reduce((f,p)=>{var m;return f+(((m=p.assignedLessons)==null?void 0:m.reduce((y,v)=>y+v.duration,0))||0)},0),utilizationPercentage:0,averageBlockSize:0}};return u.weeklyStats.totalAvailableMinutes>0&&(u.weeklyStats.utilizationPercentage=Math.round(u.weeklyStats.totalAssignedMinutes/u.weeklyStats.totalAvailableMinutes*100)),u.timeBlocks.length>0&&(u.weeklyStats.averageBlockSize=Math.round(u.weeklyStats.totalAvailableMinutes/u.timeBlocks.length)),u}catch(i){throw console.error("Failed to get teacher schedule with blocks:",i),new Error("שגיאה בטעינת מערכת השעות עם ימי לימוד")}},calculateTotalDuration(t,s){const n=this.timeToMinutes(t);return this.timeToMinutes(s)-n},async updateTimeBlock(t,s){var n,i,l;try{console.log("Updating time block:",t,"with data:",s);try{return await ye.put(`schedule/time-blocks/${t}`,s)}catch(c){throw((n=c==null?void 0:c.response)==null?void 0:n.status)===404||(c==null?void 0:c.status)===404||((i=c==null?void 0:c.message)==null?void 0:i.includes("404"))||((l=c==null?void 0:c.message)==null?void 0:l.includes("Not Found"))||(c==null?void 0:c.message)==="Not Found"&&(c==null?void 0:c.name)!=="ValidationError"?(console.debug("Time block API endpoint not available, using teacher-based update fallback"),new Error("updateTimeBlockViaTeacher")):(console.error("Unexpected error in time block update:",c),c)}}catch(c){throw c instanceof Error&&c.message==="updateTimeBlockViaTeacher"||console.error("Failed to update time block:",c),c}},async updateTimeBlockViaTeacher(t,s,n){var i;try{const{teacherService:l}=await rl(async()=>{const{teacherService:j}=await Promise.resolve().then(()=>Ud);return{teacherService:j}},void 0),c=await l.getTeacherById(t);if(!c)throw new Error("Teacher not found");const u=((i=c==null?void 0:c.teaching)==null?void 0:i.timeBlocks)||[],f=u.findIndex(j=>j._id===s);if(f===-1)throw new Error("Time block not found in teacher data");const p={...u[f],...n,updatedAt:new Date().toISOString()},m=[...u];m[f]=p;const y={...c,teaching:{...c.teaching,timeBlocks:m}};return await l.updateTeacher(t,y),{success:!0,updatedTimeBlock:{_id:s,teacherId:t,day:p.day,startTime:p.startTime,endTime:p.endTime,totalDuration:p.totalDuration||this.calculateTotalDuration(p.startTime,p.endTime),location:p.location||"",notes:p.notes||"",assignedLessons:p.assignedLessons||[],availableMinutes:p.availableMinutes||this.calculateTotalDuration(p.startTime,p.endTime),utilizationPercentage:p.utilizationPercentage||0,isActive:p.isActive!==!1,createdAt:p.createdAt||new Date().toISOString(),updatedAt:p.updatedAt||new Date().toISOString()},affectedAssignments:[],message:"יום הלימוד עודכן בהצלחה"}}catch(l){throw console.error("Failed to update time block via teacher service:",l),new Error("שגיאה בעדכון יום הלימוד")}},async deleteTimeBlock(t){var s,n,i;try{console.log("TimeBlockService: Deleting time block:",t);const l=`schedule/time-blocks/${t}`;console.log("Delete endpoint:",l);try{const c=await ye.delete(l);return console.log("Delete response:",c),c}catch(c){throw((s=c==null?void 0:c.response)==null?void 0:s.status)===404||(c==null?void 0:c.status)===404||((n=c==null?void 0:c.message)==null?void 0:n.includes("404"))||((i=c==null?void 0:c.message)==null?void 0:i.includes("Not Found"))||(c==null?void 0:c.message)==="Not Found"&&(c==null?void 0:c.name)!=="ValidationError"?(console.debug("Time block delete API endpoint not available, using teacher-based delete fallback"),new Error("deleteTimeBlockViaTeacher")):(console.error("Unexpected error in time block delete:",c),c)}}catch(l){throw l instanceof Error&&l.message==="deleteTimeBlockViaTeacher"||console.error("TimeBlockService delete error:",l),l}},async deleteTimeBlockViaTeacher(t,s){var n;try{const{teacherService:i}=await rl(async()=>{const{teacherService:v}=await Promise.resolve().then(()=>Ud);return{teacherService:v}},void 0),l=await i.getTeacherById(t);if(!l)throw new Error("Teacher not found");const c=((n=l==null?void 0:l.teaching)==null?void 0:n.timeBlocks)||[],u=c.findIndex(v=>v._id===s);if(u===-1)throw new Error("Time block not found in teacher data");const p=c[u].assignedLessons||[],m=c.filter(v=>v._id!==s),y={...l,teaching:{...l.teaching,timeBlocks:m}};return await i.updateTeacher(t,y),{success:!0,affectedAssignments:p,message:"יום הלימוד נמחק בהצלחה"}}catch(i){throw console.error("Failed to delete time block via teacher service:",i),new Error("שגיאה במחיקת יום הלימוד")}},async cancelLessonAssignment(t){try{return await ye.delete(`schedule/time-blocks/lesson-assignment/${t}`)}catch(s){throw console.error("Failed to cancel lesson assignment:",s),new Error("שגיאה בביטול השיעור")}},calculateDynamicAvailability(t,s){const n=[];for(const i of t){if(!i.isActive||i.availableMinutes<s)continue;const l=this.timeToMinutes(i.startTime),c=this.timeToMinutes(i.endTime),u=[...i.assignedLessons].sort((m,y)=>this.timeToMinutes(m.lessonStartTime)-this.timeToMinutes(y.lessonStartTime));let f=l;for(const m of u){const y=this.timeToMinutes(m.lessonStartTime),v=this.timeToMinutes(m.lessonEndTime);if(y-f>=s){const N=this.generateSlotsInRange(f,y,s,i);n.push(...N)}f=v}if(c-f>=s){const m=this.generateSlotsInRange(f,c,s,i);n.push(...m)}}return n.sort((i,l)=>l.optimalScore-i.optimalScore)},generateSlotsInRange(t,s,n,i){const l=[];for(let u=t;u+n<=s;u+=15){const f=this.minutesToTime(u),p=this.minutesToTime(u+n),m=u-t,y=s-(u+n);let v=50;m>=15&&m<=30&&(v+=15),y>=15&&y<=30&&(v+=15),m>0&&y>0&&(v+=10),n>=60&&(v+=5),Math.floor(u/60)<14&&(v+=5);const N={timeBlockId:i._id,teacherId:i.teacherId,possibleStartTime:f,possibleEndTime:p,duration:n,day:i.day,location:i.location,optimalScore:Math.min(100,Math.round(v)),gapMinutesBefore:m,gapMinutesAfter:y};l.push(N)}return l},timeToMinutes(t){const[s,n]=t.split(":").map(Number);return s*60+n},minutesToTime(t){const s=Math.floor(t/60),n=t%60;return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},isValidDuration(t){return Rb.includes(t)},isValidDay(t){return An.includes(t)},numericToHebrewDay(t){return t>=0&&t<An.length?An[t]:null},hebrewToNumericDay(t){return An.indexOf(t)},validateTimeBlockConflicts(t,s){const n=[];let i="";const l=this.timeToMinutes(t.startTime),c=this.timeToMinutes(t.endTime),u=s.filter(f=>f.day===t.day&&f.isActive);for(const f of u){const p=this.timeToMinutes(f.startTime),m=this.timeToMinutes(f.endTime);l<m&&c>p&&(n.push(f),l===p&&c===m?i="exact_duplicate":l>=p&&c<=m?i="contained_within":l<=p&&c>=m?i="contains_existing":i="partial_overlap")}return{hasConflict:n.length>0,conflictingBlocks:n,conflictType:i}},getConflictDescription(t,s,n){const i=s[0];switch(t){case"exact_duplicate":return`קיים כבר יום לימוד זהה ביום ${n.day} בשעות ${n.startTime}-${n.endTime}`;case"contained_within":return`הזמן המבוקש ${n.startTime}-${n.endTime} נמצא בתוך יום לימוד קיים: ${i.startTime}-${i.endTime}`;case"contains_existing":return`הזמן המבוקש ${n.startTime}-${n.endTime} מכיל יום לימוד קיים: ${i.startTime}-${i.endTime}`;case"partial_overlap":return`הזמן המבוקש ${n.startTime}-${n.endTime} חופף עם יום לימוד קיים: ${i.startTime}-${i.endTime}`;default:return`קיימת התנגשות עם יום לימוד קיים ביום ${n.day}`}}},kl=Ba((t,s)=>({currentTeacherSchedule:null,teacherTimeBlocks:{},availableSlots:[],recommendedSlots:[],selectedTimeBlock:null,isLoading:!1,isCalculatingSlots:!1,error:null,lastSearchResults:null,get totalAvailableSlots(){return s().availableSlots.length},get currentUtilization(){var i;const n=s().currentTeacherSchedule;return((i=n==null?void 0:n.weeklyStats)==null?void 0:i.utilizationPercentage)||0},createTimeBlock:async(n,i)=>{t({isLoading:!0,error:null});try{const l=await $s.createTimeBlock(n,i);return await s().loadTeacherSchedule(n),t({isLoading:!1}),l}catch(l){const c=l instanceof Error?l.message:"שגיאה ביצירת יום לימוד";return t({error:c,isLoading:!1}),null}},updateTimeBlock:async(n,i)=>{t({isLoading:!0,error:null});try{let l;try{l=await $s.updateTimeBlock(n,i)}catch(c){if((c==null?void 0:c.message)==="updateTimeBlockViaTeacher"){console.debug("Using teacher-based workaround for time block update");const u=s().currentTeacherSchedule;if(!u)throw new Error("Cannot update time block: teacher information not available");l=await $s.updateTimeBlockViaTeacher(u.teacherId,n,i)}else throw c}if(l.success){const c=s().currentTeacherSchedule;if(c){const u=c.timeBlocks.map(f=>f._id===n?l.updatedTimeBlock:f);t({currentTeacherSchedule:{...c,timeBlocks:u},isLoading:!1})}return l.updatedTimeBlock}else throw new Error(l.message||"שגיאה בעדכון יום הלימוד")}catch(l){const c=l instanceof Error?l.message:"שגיאה בעדכון יום לימוד";return t({error:c,isLoading:!1}),null}},deleteTimeBlock:async n=>{var i;t({isLoading:!0,error:null});try{let l;try{l=await $s.deleteTimeBlock(n)}catch(c){if((c==null?void 0:c.message)==="deleteTimeBlockViaTeacher"){console.debug("Using teacher-based workaround for time block delete");const u=s().currentTeacherSchedule;if(!u)throw new Error("Cannot delete time block: teacher information not available");l=await $s.deleteTimeBlockViaTeacher(u.teacherId,n)}else throw c}if(l.success){const c=s().currentTeacherSchedule;if(c){const u=c.timeBlocks.filter(f=>f._id!==n);t({currentTeacherSchedule:{...c,timeBlocks:u},selectedTimeBlock:((i=s().selectedTimeBlock)==null?void 0:i._id)===n?null:s().selectedTimeBlock,isLoading:!1})}return!0}else throw new Error(l.message||"שגיאה במחיקת יום הלימוד")}catch(l){console.error("TimeBlockStore delete error:",l);let c="שגיאה במחיקת יום לימוד";return l instanceof Error&&(l.message.includes("404")||l.message.includes("Not Found")?c="יום הלימוד לא נמצא במערכת. ייתכן שכבר נמחק.":c=l.message),t({error:c,isLoading:!1}),!1}},loadTeacherSchedule:async n=>{t({isLoading:!0,error:null});try{const i=await $s.getTeacherScheduleWithBlocks(n);t({currentTeacherSchedule:i,isLoading:!1})}catch(i){console.warn("Failed to load teacher schedule, continuing without conflict detection:",i),t({currentTeacherSchedule:null,isLoading:!1})}},loadTeacherTimeBlocks:async n=>{t({isLoading:!0,error:null});try{const i=await $s.getTeacherTimeBlocks(n);t(l=>({teacherTimeBlocks:{...l.teacherTimeBlocks,[n]:i},isLoading:!1}))}catch(i){const l=i instanceof Error?i.message:"שגיאה בטעינת ימי לימוד";t({error:l,isLoading:!1})}},findAvailableSlots:async(n,i)=>{t({isLoading:!0,error:null});try{console.log("timeBlockStore - findAvailableSlots called with criteria:",i),console.log("timeBlockStore - criteria keys:",Object.keys(i)),"schoolYearId"in i&&(console.error("CONTAMINATION DETECTED in timeBlockStore - criteria contains schoolYearId:",i),console.trace());const l=await $s.getAvailableSlots(n,i);t({availableSlots:l.availableSlots||[],recommendedSlots:l.recommendedSlots||[],isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"שגיאה בחיפוש שעות זמינות";t({error:c,isLoading:!1})}},refreshAvailableSlots:async(n,i)=>{const l={duration:i};await s().findAvailableSlots(n,l)},assignLesson:async n=>{t({isLoading:!0,error:null});try{const i=await $s.assignLesson(n);if(i.success){const l=s().currentTeacherSchedule;if(l){const c=l.timeBlocks.map(u=>u._id===i.updatedTimeBlock._id?i.updatedTimeBlock:u);t({currentTeacherSchedule:{...l,timeBlocks:c},availableSlots:i.newAvailableSlots,isLoading:!1})}return i.assignment}else throw new Error(i.message||"שגיאה בהקצאת השיעור")}catch(i){const l=i instanceof Error?i.message:"שגיאה בהקצאת השיעור";return t({error:l,isLoading:!1}),null}},cancelLessonAssignment:async n=>{t({isLoading:!0,error:null});try{const i=await $s.cancelLessonAssignment(n);if(i.success){const l=s().currentTeacherSchedule;if(l){const c=l.timeBlocks.map(u=>u._id===i.updatedTimeBlock._id?i.updatedTimeBlock:u);t({currentTeacherSchedule:{...l,timeBlocks:c},availableSlots:i.newAvailableSlots,isLoading:!1})}return!0}else throw new Error(i.message||"שגיאה בביטול השיעור")}catch(i){const l=i instanceof Error?i.message:"שגיאה בביטול השיעור";return t({error:l,isLoading:!1}),!1}},clearError:()=>t({error:null}),setSelectedTimeBlock:n=>t({selectedTimeBlock:n}),assignRecurringLesson:async n=>{console.log("assignRecurringLesson called with:",n)},updateLessonAttendance:async(n,i)=>{console.log("updateLessonAttendance called with:",n,i)},calculateDynamicAvailability:n=>{const i=s().currentTeacherSchedule;return!i||!i.timeBlocks?[]:$s.calculateDynamicAvailability(i.timeBlocks,n)}}));function ps({isOpen:t,onClose:s,onConfirm:n,title:i,message:l,confirmText:c="אישור",cancelText:u="ביטול",type:f="danger"}){if(!t)return null;const p=()=>{n(),s()};return e.jsxs("div",{className:"confirm-dialog",children:[e.jsx("div",{className:"overlay",onClick:s}),e.jsxs("div",{className:"dialog-content",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(Nt,{size:20})}),e.jsx("h3",{className:`dialog-title ${f}`,children:i}),e.jsx("div",{className:"dialog-message",children:l}),e.jsxs("div",{className:"dialog-actions",children:[e.jsx("button",{type:"button",className:`btn ${f}`,onClick:p,children:c}),e.jsx("button",{type:"button",className:"btn secondary",onClick:s,children:u})]})]})]})}const vj={duration:60},pI=({teacherId:t,studentId:s,onSlotSelect:n,onSlotsFound:i,initialDuration:l=60,showAdvancedFilters:c=!0,maxResults:u=20,compact:f=!1,selectedSlot:p=null,refreshTrigger:m=0,currentStudentAssignments:y=[],onSlotListCollapse:v})=>{const[j,N]=x.useState({...vj,duration:l}),[b,w]=x.useState(!1),[A,S]=x.useState(!1),[C,D]=x.useState([]),[I,T]=x.useState([]),[R,E]=x.useState(!1),{availableSlots:_,recommendedSlots:k,findAvailableSlots:z,isLoading:M,error:G}=kl();x.useEffect(()=>{N(B=>({...B,duration:l}))},[l]);const X=x.useCallback(async()=>{if(!(!t||!j.duration))try{w(!0),"schoolYearId"in j&&(console.error("CONTAMINATION DETECTED in AvailableSlotsFinder - criteria contains schoolYearId:",j),console.trace()),await z(t,j)}catch(B){console.error("❌ SEARCH FAILED:",B)}finally{w(!1)}},[t,j,z]);x.useEffect(()=>{if(j.duration&&t){const B=setTimeout(()=>{X()},300);return()=>clearTimeout(B)}},[j.duration,j.preferredDays,j.preferredTimeRange,t,X]),x.useEffect(()=>{_&&i&&i(_)},[_,i]),x.useEffect(()=>{D(k)},[k]),x.useEffect(()=>{if(t&&m>0){const B=setTimeout(()=>{W()},100);return()=>clearTimeout(B)}},[t,m]),x.useEffect(()=>{t&&W()},[t]);const W=async()=>{try{const B=await ot.getStudents({});if(B.length===0){console.warn("⚠️ No students returned from API - trying alternative approach");try{const{useStudentStore:ae}=await rl(async()=>{const{useStudentStore:ce}=await Promise.resolve().then(()=>YC);return{useStudentStore:ce}},void 0),oe=ae.getState();if(oe.students.length>0)return oe.students}catch(ae){console.error("❌ Student store fallback failed:",ae)}}const se=[];(B||[]).forEach(ae=>{ae.teacherAssignments&&Array.isArray(ae.teacherAssignments)&&ae.teacherAssignments.forEach(oe=>{var ce;oe.teacherId===t&&oe.isActive!==!1&&oe.day&&oe.time&&oe.duration&&se.push({day:oe.day,time:oe.time,duration:oe.duration,studentId:ae._id,studentName:((ce=ae.personalInfo)==null?void 0:ce.fullName)||"תלמיד לא ידוע"})})}),T(se)}catch(B){console.error("❌ ASSIGNMENT LOAD FAILED:",B),T([])}},te=B=>{const[se,ae]=B.split(":").map(Number);return se*60+ae},L=(B,se)=>{if(B.day!==se.day)return!1;const ae=B.possibleStartTime||B.startTime||B.lessonStartTime||"";if(!ae)return!1;const oe=te(ae),ce=oe+B.duration,Q=te(se.time),ne=Q+se.duration;return oe<ne&&ce>Q},J=x.useCallback(B=>{"schoolYearId"in B&&(console.error("CONTAMINATION DETECTED: schoolYearId in updates",B),console.trace()),N(se=>({...se,...B}))},[]),K=()=>{N({...vj,duration:l}),D([])},le=B=>{B.possibleStartTime||B.startTime||B.lessonStartTime,n==null||n(B),E(!1),v==null||v()},O=x.useMemo(()=>{var ae;if(!_||!Array.isArray(_))return console.warn("Available slots is not an array:",typeof _),[];let B=[..._];const se=[...I.map(oe=>({...oe,source:"database"})),...y.filter(oe=>oe.teacherId===t).map(oe=>({day:oe.day,time:oe.time,duration:oe.duration,studentName:"Current Student",source:"current-form"}))];if(se.length>0&&(B=B.filter(oe=>(oe.possibleStartTime||oe.startTime||oe.lessonStartTime,!se.some(Q=>L(oe,Q))))),(ae=j.preferredDays)!=null&&ae.length&&(B=B.filter(oe=>j.preferredDays.includes(oe.day))),j.preferredTimeRange){const{startTime:oe,endTime:ce}=j.preferredTimeRange;B=B.filter(Q=>{const ne=Q.possibleStartTime||Q.startTime||Q.lessonStartTime||"",pe=Q.possibleEndTime||Q.endTime||Q.lessonEndTime||"";return ne>=oe&&pe<=ce})}return B.sort((oe,ce)=>ce.optimalScore-oe.optimalScore),B},[_,j,I,y,t]),U=x.useMemo(()=>{const B={};return O.forEach(se=>{B[se.day]||(B[se.day]=[]),B[se.day].push(se)}),B},[O]),Y=()=>e.jsxs("div",{className:"search-controls",children:[!f&&e.jsx("div",{className:"control-group",children:e.jsxs("button",{type:"button",className:`filter-toggle ${A?"active":""}`,onClick:()=>S(!A),children:[e.jsx(hi,{size:14}),"מסננים מתקדמים"]})}),e.jsx("div",{className:"control-group",children:e.jsx("button",{type:"button",className:"reset-btn",onClick:K,title:"איפוס חיפוש",children:e.jsx(Uo,{size:14})})})]}),Z=()=>{var B,se;return e.jsxs("div",{className:"advanced-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{className:"filter-label",children:[e.jsx($e,{size:14}),"ימים מועדפים"]}),e.jsx("div",{className:"day-selector",children:An.map(ae=>{var oe;return e.jsx("button",{type:"button",className:`day-btn ${(oe=j.preferredDays)!=null&&oe.includes(ae)?"selected":""}`,onClick:()=>{const ce=j.preferredDays||[],Q=ce.includes(ae)?ce.filter(ne=>ne!==ae):[...ce,ae];J({preferredDays:Q.length>0?Q:void 0})},children:ae},ae)})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{className:"filter-label",children:[e.jsx(Ve,{size:14}),"טווח שעות מועדף"]}),e.jsxs("div",{className:"time-range",children:[e.jsx("input",{type:"time",className:"time-input",value:((B=j.preferredTimeRange)==null?void 0:B.startTime)||"09:00",onChange:ae=>{const oe=j.preferredTimeRange||{startTime:"09:00",endTime:"17:00"};J({preferredTimeRange:{...oe,startTime:ae.target.value}})}}),e.jsx("span",{className:"time-separator",children:"—"}),e.jsx("input",{type:"time",className:"time-input",value:((se=j.preferredTimeRange)==null?void 0:se.endTime)||"17:00",onChange:ae=>{const oe=j.preferredTimeRange||{startTime:"09:00",endTime:"17:00"};J({preferredTimeRange:{...oe,endTime:ae.target.value}})}})]})]})]})},H=()=>!C||!Array.isArray(C)||C.length===0?null:e.jsx("div",{className:"optimal-suggestions",children:e.jsxs("div",{className:"suggestion-section",children:[e.jsxs("h4",{className:"suggestion-title",children:[e.jsx(li,{size:16}),"המלצות מתקדמות"]}),e.jsx("div",{className:"suggestion-slots",children:C.slice(0,3).map((B,se)=>{const ae=B.possibleStartTime||B.startTime||B.lessonStartTime||"unknown",oe=`recommended-${B.timeBlockId||"noId"}-${B.day}-${ae}-${B.duration}-${se}`;return e.jsxs("div",{className:`suggestion-slot optimal ${(p==null?void 0:p.timeBlockId)===B.timeBlockId&&((p==null?void 0:p.possibleStartTime)||(p==null?void 0:p.startTime))===ae?"selected":""}`,onClick:ce=>{ce.preventDefault(),ce.stopPropagation(),le(B)},children:[e.jsxs("div",{className:"slot-rank",children:["#",se+1]}),e.jsxs("div",{className:"slot-info",children:[e.jsxs("div",{className:"slot-day-time",children:[B.day," • ",B.possibleStartTime||B.startTime||B.lessonStartTime||"N/A"]}),e.jsxs("div",{className:"slot-score",children:["ציון: ",B.optimalScore,"/100"]})]}),e.jsx("div",{className:"slot-action",children:e.jsx(dx,{size:14})})]},oe)})})]})}),P=B=>{const se=B.possibleStartTime||B.startTime||B.lessonStartTime;let ae=B.possibleEndTime||B.endTime||B.lessonEndTime;if(!ae&&se&&B.duration){const Q=se.split(":"),pe=parseInt(Q[0])*60+parseInt(Q[1])+B.duration,me=Math.floor(pe/60),je=pe%60;ae=`${me.toString().padStart(2,"0")}:${je.toString().padStart(2,"0")}`}const oe=(p==null?void 0:p.possibleStartTime)||(p==null?void 0:p.startTime),ce=(p==null?void 0:p.timeBlockId)===B.timeBlockId&&oe===se;return e.jsxs("div",{className:`slot-card ${ce?"selected":""} ${B.optimalScore>=80?"high-score":B.optimalScore>=60?"medium-score":"low-score"}`,children:[e.jsxs("div",{className:"slot-main-info",children:[e.jsxs("div",{className:"slot-day-time",children:[e.jsx("div",{className:"day-name",children:B.day}),e.jsxs("div",{className:"time-range",children:[se||"N/A"," - ",ae||"N/A"]})]}),e.jsxs("div",{className:"slot-duration-badge",children:[B.duration," דקות"]})]}),B.location&&e.jsxs("div",{className:"slot-location-info",children:[e.jsx(gt,{size:14}),e.jsx("span",{children:B.location})]}),e.jsx("div",{className:"slot-actions",children:e.jsx("button",{type:"button",className:"select-btn",onClick:Q=>{Q.preventDefault(),Q.stopPropagation(),le(B)},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(Et,{size:14}),"נבחר"]}):e.jsxs(e.Fragment,{children:["בחר",e.jsx(dx,{size:14})]})})})]})},q=()=>b||M?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"מחפש שעות זמינות..."})]}):O.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Bs,{size:48,color:"#f59e0b"}),e.jsx("h3",{children:"לא נמצאו שעות זמינות"}),e.jsx("p",{children:"נסה לשנות את קריטריוני החיפוש או בחר משכי שיעור שונים"}),e.jsxs("button",{type:"button",className:"retry-btn",onClick:K,children:[e.jsx(Uo,{size:16}),"איפוס חיפוש"]})]}):f?e.jsx("div",{className:"slots-list compact",children:O.map((B,se)=>{const ae=B.possibleStartTime||B.startTime||B.lessonStartTime||"unknown",oe=`compact-slot-${B.timeBlockId||"noId"}-${B.day}-${ae}-${B.duration}-${se}`;return e.jsx("div",{children:P(B)},oe)})}):e.jsx("div",{className:"slots-grouped",children:Object.entries(U).map(([B,se])=>e.jsxs("div",{className:"day-group",children:[e.jsxs("h4",{className:"day-header",children:[e.jsx($e,{size:16}),B,e.jsxs("span",{className:"day-count",children:["(",se.length," זמינות)"]})]}),e.jsx("div",{className:"day-slots",children:se.map((ae,oe)=>{const ce=ae.possibleStartTime||ae.startTime||ae.lessonStartTime||"unknown",Q=`grouped-slot-${ae.timeBlockId||"noId"}-${ae.day}-${ce}-${ae.duration}-${oe}`;return e.jsx("div",{children:P(ae)},Q)})})]},B))});return e.jsxs("div",{className:`available-slots-finder ${f?"compact":""}`,children:[!f&&Y(),c&&Z(),H(),e.jsxs("div",{className:"slots-container",children:[e.jsxs("div",{className:"slots-header collapsible-header",onClick:()=>E(!R),children:[e.jsx("div",{className:"header-content",children:e.jsx("p",{children:"לחץ על שעה כדי לבחור אותה"})}),e.jsx("button",{type:"button",className:"chevron-button","aria-label":R?"כווץ רשימה":"הרחב רשימה",children:R?e.jsx(Bt,{size:20}):e.jsx(bt,{size:20})})]}),R&&q()]})]})};function gI({newTeacherInfo:t}){const{values:s,setFieldValue:n,errors:i,touched:l,isSubmitting:c}=Sr(),{teachers:u,loadTeachers:f,isLoading:p}=Ds(),{findAvailableSlots:m,isLoading:y}=kl(),[v,j]=x.useState(!1),[N,b]=x.useState(""),[w,A]=x.useState(null),[S,C]=x.useState([]),[D,I]=x.useState(!1),[T,R]=x.useState(""),[E,_]=x.useState(!1),[k,z]=x.useState(60),[M,G]=x.useState(0),[X,W]=x.useState(!1);x.useEffect(()=>{u.length===0&&f()},[u.length,f]);const te=(P,q)=>{if(!P)return"";const[B,se]=P.split(":").map(Number),oe=B*60+se+q,ce=Math.floor(oe/60),Q=oe%60;return`${String(ce).padStart(2,"0")}:${String(Q).padStart(2,"0")}`};x.useEffect(()=>{if(s.teacherAssignments&&s.teacherAssignments.length>0){const P=s.teacherAssignments.map((q,B)=>{const se=q.time||"",ae=q.duration||60,oe=te(se,ae);return{id:`${q.teacherId}-${q.day}-${q.time}-${B}`,teacherId:q.teacherId,teacherName:L(q.teacherId),instrument:J(q.teacherId),day:q.day||"",startTime:se,endTime:oe,duration:ae,location:q.location,timeBlockId:q.scheduleSlotId||"",status:"confirmed",notes:q.notes}});JSON.stringify(P)!==JSON.stringify(S)&&C(P)}else S.length>0&&setTimeout(()=>{s.teacherAssignments.length===0&&C([])},50)},[s.teacherAssignments]),x.useEffect(()=>{var P,q;console.log("🔍 Form data synchronization check:"),console.log("📝 Form teacherAssignments:",((P=s.teacherAssignments)==null?void 0:P.length)||0),console.log("🎯 Local assignments:",S.length),console.log("👨‍🏫 Teacher IDs in form:",((q=s.teacherIds)==null?void 0:q.length)||0)},[s.teacherAssignments,S,s.teacherIds]);const L=P=>{var B;if(P==="new-teacher"&&t)return t.fullName;const q=u.find(se=>se._id===P);return((B=q==null?void 0:q.personalInfo)==null?void 0:B.fullName)||"מורה לא ידוע"},J=P=>{var B;if(P==="new-teacher"&&t)return t.instrument;const q=u.find(se=>se._id===P);return(B=q==null?void 0:q.professionalInfo)==null?void 0:B.instrument},K=P=>{b(P),A(null),_(P!==""&&P!=="new-teacher")},le=P=>{A(P),(!P.timeBlockId||!P.possibleStartTime)&&console.warn("⚠️ Selected slot is missing required properties:",{timeBlockId:P.timeBlockId,possibleStartTime:P.possibleStartTime})},O=()=>{if(!w||!N){console.log("❌ Missing selectedSlot or selectedTeacherId");return}const P=w.possibleStartTime||w.startTime||w.lessonStartTime,q=w.possibleEndTime||w.endTime||w.lessonEndTime;if(!P){console.error("❌ No start time available in slot:",w),alert("שגיאה: לא נמצאה שעת התחלה בזמן הנבחר");return}const B={id:`${N}-${w.day}-${P}-${Date.now()}`,teacherId:N,teacherName:L(N),instrument:J(N),day:w.day,startTime:P,endTime:q||te(P,w.duration),duration:w.duration,location:w.location,timeBlockId:w.timeBlockId,optimalScore:w.optimalScore,status:"pending",notes:""},se=[...S,B];C(se);const ae=se.filter(Q=>Q.startTime).map(Q=>({teacherId:Q.teacherId,scheduleSlotId:Q.timeBlockId,day:Q.day,time:Q.startTime,duration:Q.duration||60,notes:Q.notes||""}));try{n("teacherAssignments",ae),console.log("✅ Added lesson assignment successfully")}catch(Q){console.error("❌ setFieldValue(teacherAssignments) failed:",Q)}const oe=[...new Set(se.map(Q=>Q.teacherId))];try{n("teacherIds",oe)}catch(Q){console.error("❌ setFieldValue(teacherIds) failed:",Q)}const ce=()=>{s.teacherAssignments.length===0&&ae.length>0&&(console.log("🚨 FORM DATA LOST! Restoring assignments immediately..."),n("teacherAssignments",ae),n("teacherIds",oe))};ce(),setTimeout(ce,50),A(null),b(""),_(!1),j(!1),setTimeout(()=>{G(Q=>Q+1)},200)},U=P=>{R(P),I(!0)},Y=()=>{try{console.log("🗑️ Starting lesson removal process for ID:",T),console.log("📋 Current assignments before removal:",S.map(ce=>({id:ce.id,teacher:ce.teacherName,time:ce.startTime})));const P=S.find(ce=>ce.id===T);if(!P){console.error("❌ Assignment to remove not found:",T),I(!1),R("");return}console.log("🎯 Found assignment to remove:",{id:P.id,teacher:P.teacherName,teacherId:P.teacherId,day:P.day,time:P.startTime,duration:P.duration});const q=S.filter(ce=>ce.id!==T);C(q);const B=s.teacherAssignments||[],se=B.filter(ce=>{const Q=ce.teacherId===P.teacherId&&ce.day===P.day&&ce.time===P.startTime;return Q&&console.log("🎯 Removing form assignment:",{teacher:ce.teacherId,day:ce.day,time:ce.time,duration:ce.duration}),!Q});B.length===se.length&&(console.warn("⚠️ Warning: No matching form assignment found to remove"),console.log("Current form assignments:",B.map(ce=>({teacherId:ce.teacherId,day:ce.day,time:ce.time})))),console.log("📝 Updated form assignments:",se.length,"remaining (was",B.length,")");const ae=se.filter(ce=>{const Q=ce.teacherId&&ce.day&&ce.time&&ce.duration&&typeof ce.duration=="number";return Q||console.warn("⚠️ Filtering out invalid assignment:",ce),Q});console.log("✅ Validated assignments:",ae.length,"valid assignments"),n("teacherAssignments",ae);const oe=[...new Set(ae.map(ce=>ce.teacherId).filter(Boolean))];console.log("👨‍🏫 Updated teacher IDs:",oe),n("teacherIds",oe),I(!1),R(""),console.log("✅ Lesson removal completed successfully"),console.log("📊 Final state - Assignments:",ae.length,"Teachers:",oe.length),setTimeout(()=>{G(ce=>ce+1),console.log("🔄 Triggered delayed slot refresh after lesson removal")},500)}catch(P){console.error("💥 Error during lesson removal:",P),I(!1),R(""),alert("שגיאה בהסרת השיעור. אנא נסה שוב.")}},Z=S.reduce((P,q)=>(P[q.teacherId]||(P[q.teacherId]=[]),P[q.teacherId].push(q),P),{}),H=l.teacherAssignments&&i.teacherAssignments;return e.jsxs("div",{className:"student-lesson-scheduler",children:[e.jsxs("div",{className:"scheduler-header",children:[e.jsxs("h3",{children:[e.jsx($e,{size:20}),"מערכת שיעורים"]}),e.jsx("p",{className:"scheduler-description",children:"בחר מורים ושעות שיעור עבור התלמיד"})]}),H&&typeof i.teacherAssignments=="string"&&e.jsxs("div",{className:"error-banner",children:[e.jsx(Bs,{size:16}),e.jsx("span",{children:i.teacherAssignments})]}),Object.keys(Z).length>0&&e.jsxs("div",{className:"current-lessons",children:[e.jsxs("h4",{children:["שיעורים מתוכננים (",S.length,")"]}),e.jsx("div",{className:"lessons-grid",children:Object.entries(Z).map(([P,q])=>e.jsxs("div",{className:"teacher-lessons-card",children:[e.jsxs("div",{className:"teacher-card-header",children:[e.jsxs("div",{className:"teacher-info",children:[e.jsx(Je,{size:16}),e.jsxs("div",{className:"teacher-details",children:[e.jsx("span",{className:"teacher-name",children:q[0].teacherName}),q[0].instrument&&e.jsx("span",{className:"teacher-instrument",children:q[0].instrument})]})]}),e.jsxs("div",{className:"lessons-count",children:[q.length," שיעורים"]})]}),e.jsx("div",{className:"lessons-list",children:q.map((B,se)=>e.jsxs("div",{className:`lesson-card ${B.status}`,children:[e.jsxs("div",{className:"lesson-main-info",children:[e.jsxs("div",{className:"lesson-time",children:[e.jsxs("span",{className:"lesson-day",children:[e.jsx(Ve,{size:14}),B.day]}),e.jsxs("span",{children:[B.startTime," - ",B.endTime]})]}),e.jsxs("div",{className:"lesson-duration",children:[B.duration," דקות"]})]}),B.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:B.location})]}),B.optimalScore&&e.jsxs("div",{className:"lesson-score",children:[e.jsx(li,{size:12}),e.jsxs("span",{children:["ציון: ",B.optimalScore,"/100"]})]}),e.jsxs("div",{className:"lesson-actions",children:[e.jsxs("div",{className:`lesson-status ${B.status}`,children:[B.status==="pending"&&"ממתין לאישור",B.status==="confirmed"&&"מאושר",B.status==="cancelled"&&"מבוטל"]}),e.jsx("button",{type:"button",className:"remove-lesson-btn",onClick:()=>U(B.id),disabled:c,"aria-label":"הסר שיעור",children:e.jsx(Ft,{size:14})})]})]},B.id))})]},P))})]}),!v&&e.jsx("div",{className:"add-lesson-section",children:e.jsxs("button",{type:"button",className:"add-lesson-btn primary",onClick:()=>j(!0),disabled:c,children:[e.jsx(fs,{size:16}),S.length>0?"הוסף שיעור נוסף":"הוסף שיעור ראשון"]})}),v&&e.jsxs("div",{className:"teacher-selection-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h4",{children:"בחירת מורה"}),e.jsx("p",{children:"בחר מורה כדי לראות את השעות הזמינות שלו"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"teacherSelect",className:"form-label",children:[e.jsx(Je,{size:16}),"מורה"]}),e.jsx(hI,{teachers:u,selectedTeacherId:N,onSelect:K,newTeacherInfo:t,isLoading:p,disabled:p||c,placeholder:"בחר מורה",className:"teacher-select-input"})]}),e.jsxs("div",{className:"duration-selection",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(Ve,{size:16}),"משך השיעור"]}),e.jsx("div",{className:"duration-buttons",children:Rb.map(P=>e.jsxs("button",{type:"button",className:`duration-btn ${k===P?"active":""}`,onClick:()=>{z(P),G(q=>q+1)},children:[P," דקות"]},P))}),e.jsxs("div",{className:"duration-controls",children:[e.jsxs("button",{type:"button",className:`filter-toggle ${X?"active":""}`,onClick:()=>W(P=>!P),title:"מסננים מתקדמים",children:[e.jsx(hi,{size:14}),"מסננים מתקדמים"]}),e.jsx("button",{type:"button",className:"reset-btn",onClick:()=>{z(60),W(!1),G(P=>P+1)},title:"איפוס חיפוש",children:e.jsx(Uo,{size:14})})]})]})]}),E&&N&&N!=="new-teacher"&&e.jsxs("div",{className:"slots-finder-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("h4",{children:["שעות זמינות עבור ",L(N)]}),e.jsxs("p",{children:["שיעורי ",k," דקות - בחר שעה מהרשימה למטה"]})]}),e.jsx(pI,{teacherId:N,onSlotSelect:le,initialDuration:k,compact:!0,maxResults:20,selectedSlot:w,refreshTrigger:M,showAdvancedFilters:X,currentStudentAssignments:S.map(P=>({teacherId:P.teacherId,day:P.day,time:P.startTime,duration:P.duration})),onSlotListCollapse:()=>{}},`${N}-${k}-${M}`),w&&e.jsxs("div",{className:"selected-slot-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Et,{size:16,color:"#28a745"}),e.jsx("span",{children:"שיעור נבחר"})]}),e.jsxs("div",{className:"preview-details",children:[e.jsxs("div",{className:"preview-item",children:[e.jsx($e,{size:14}),e.jsx("span",{children:w.day})]}),e.jsxs("div",{className:"preview-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:(()=>{const P=w.possibleStartTime||w.startTime||w.lessonStartTime,q=w.possibleEndTime||w.endTime||w.lessonEndTime||(P?te(P,w.duration):"");return P&&q?`${P} - ${q}`:"זמן לא זמין"})()})]}),e.jsx("div",{className:"preview-item",children:e.jsxs("span",{children:[w.duration," דקות"]})}),w.location&&e.jsxs("div",{className:"preview-item",children:[e.jsx(gt,{size:14}),e.jsx("span",{children:w.location})]}),w.optimalScore&&e.jsxs("div",{className:"preview-item",children:[e.jsx(li,{size:14}),e.jsxs("span",{children:["ציון אופטימלי: ",w.optimalScore,"/100"]})]})]})]})]}),v&&e.jsxs("div",{className:"panel-actions",children:[w?e.jsxs("button",{type:"button",className:"confirm-lesson-btn",onClick:P=>{P.preventDefault(),P.stopPropagation(),console.log("🚨 BUTTON CLICKED! About to call handleAddLesson"),console.log("selectedSlot exists:",!!w),console.log("selectedTeacherId exists:",!!N),O()},disabled:c,children:[e.jsx(Et,{size:16}),"אשר שיעור"]}):N==="new-teacher"?e.jsxs("div",{className:"new-teacher-notice",children:[e.jsx(Bs,{size:16,color:"#ffc107"}),e.jsx("span",{children:"עבור מורה חדש, יש לתאם שעות בנפרד"})]}):null,e.jsx("button",{type:"button",className:"cancel-selection-btn secondary",onClick:P=>{P.preventDefault(),P.stopPropagation(),j(!1),b(""),A(null),_(!1)},disabled:c,children:"ביטול"})]}),e.jsx(ps,{isOpen:D,onClose:()=>I(!1),onConfirm:Y,title:"הסרת שיעור",message:"האם אתה בטוח שברצונך להסיר את השיעור הזה?",confirmText:"הסר",cancelText:"ביטול",type:"warning"})]})}const vr=Ba((t,s)=>({orchestras:[],selectedOrchestra:null,filterBy:{},isLoading:!1,error:null,loadOrchestras:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await Ia.getOrchestras(i);t({orchestras:l,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestras";t({error:l,isLoading:!1}),console.error("Error loading orchestras:",i)}},loadOrchestraById:async n=>{t({isLoading:!0,error:null});try{const i=await Ia.getOrchestraById(n);t({selectedOrchestra:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestra";t({error:l,isLoading:!1}),console.error("Error loading orchestra:",i)}},saveOrchestra:async n=>{t({isLoading:!0,error:null});try{let i;if(n._id){i=await Ia.updateOrchestra(n._id,n);const l=s().orchestras.map(c=>c._id===i._id?i:c);t({orchestras:l,selectedOrchestra:i,isLoading:!1})}else i=await Ia.addOrchestra(n),t({orchestras:[...s().orchestras,i],selectedOrchestra:i,isLoading:!1});return i}catch(i){const l=i instanceof Error?i.message:"Failed to save orchestra";throw t({error:l,isLoading:!1}),console.error("Error saving orchestra:",i),i}},removeOrchestra:async n=>{var i;t({isLoading:!0,error:null});try{await Ia.removeOrchestra(n),t({orchestras:s().orchestras.filter(l=>l._id!==n),selectedOrchestra:((i=s().selectedOrchestra)==null?void 0:i._id)===n?null:s().selectedOrchestra,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove orchestra";throw t({error:c,isLoading:!1}),console.error("Error removing orchestra:",l),l}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedOrchestra:()=>{t({selectedOrchestra:null})},clearError:()=>{t({error:null})}})),za=Ba((t,s)=>({schoolYears:[],currentSchoolYear:null,isLoading:!1,error:null,loadSchoolYears:async()=>{t({isLoading:!0,error:null});try{const n=await ye.get("school-year");return t({schoolYears:n,isLoading:!1}),n}catch(n){const i=n instanceof Error?n.message:"Failed to load school years";return t({error:i,isLoading:!1}),console.error("Error loading school years:",n),[]}},loadCurrentSchoolYear:async()=>{var n;return(n=s().currentSchoolYear)!=null&&n._id?(console.log("Using cached school year:",s().currentSchoolYear),s().currentSchoolYear):s().fetchCurrentSchoolYear()},fetchCurrentSchoolYear:async()=>{t({isLoading:!0,error:null});try{console.log("Fetching current school year from API...");const n=await ye.get("school-year/current");if(console.log("API returned school year:",n),!n||!n._id)throw new Error("Failed to load current school year - API returned empty data");return t({currentSchoolYear:n,isLoading:!1}),n}catch(n){const i=n instanceof Error?n.message:"Failed to load current school year";return t({error:i,isLoading:!1}),console.error("Error loading current school year:",n),null}}})),_l=Ba((t,s)=>({rehearsals:[],selectedRehearsal:null,filterBy:{},isLoading:!1,error:null,loadRehearsals:async(n={})=>{t({isLoading:!0,error:null});try{const i=await Zs.getRehearsals(n);t({rehearsals:i,filterBy:n,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load rehearsals";t({error:l,isLoading:!1}),console.error("Error loading rehearsals:",i)}},loadRehearsalById:async n=>{t({isLoading:!0,error:null});try{const i=await Zs.getRehearsalById(n);t({selectedRehearsal:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load rehearsal";t({error:l,isLoading:!1}),console.error("Error loading rehearsal:",i)}},loadRehearsalsByOrchestraId:async n=>{t({isLoading:!0,error:null});try{const i=await Zs.getRehearsalsByOrchestraId(n);t({rehearsals:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load orchestra rehearsals";t({error:l,isLoading:!1}),console.error("Error loading orchestra rehearsals:",i)}},saveRehearsal:async n=>{var i;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const u=(i=za.getState().currentSchoolYear)==null?void 0:i._id;if(!u)throw new Error("School year ID is required but not available");n.schoolYearId=u}let l;if(n._id){l=await Zs.updateRehearsal(n._id,n);const c=s().rehearsals.map(u=>u._id===l._id?l:u);t({rehearsals:c,selectedRehearsal:l,isLoading:!1})}else console.log("Adding new rehearsal with data:",n),l=await Zs.addRehearsal(n),t({rehearsals:[...s().rehearsals,l],selectedRehearsal:l,isLoading:!1});return l}catch(l){const c=l instanceof Error?l.message:"Failed to save rehearsal";throw t({error:c,isLoading:!1}),console.error("Error saving rehearsal:",l),l}},removeRehearsal:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid rehearsal ID");await Zs.removeRehearsal(n),t({rehearsals:s().rehearsals.filter(l=>l._id!==n),selectedRehearsal:((i=s().selectedRehearsal)==null?void 0:i._id)===n?null:s().selectedRehearsal,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to remove rehearsal";throw t({error:c,isLoading:!1}),console.error("Error removing rehearsal:",l),l}},removeRehearsalsByOrchestra:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid orchestra ID");const l=await Zs.removeRehearsalsByOrchestra(n);return t({rehearsals:s().rehearsals.filter(c=>c.groupId!==n),selectedRehearsal:((i=s().selectedRehearsal)==null?void 0:i.groupId)===n?null:s().selectedRehearsal,isLoading:!1}),l}catch(l){const c=l instanceof Error?l.message:"Failed to remove orchestra rehearsals";throw t({error:c,isLoading:!1}),console.error("Error removing orchestra rehearsals:",l),l}},updateRehearsalsByOrchestra:async(n,i)=>{t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid orchestra ID");const{_id:l,createdAt:c,updatedAt:u,groupId:f,date:p,schoolYearId:m,...y}=i,v=await Zs.updateRehearsalsByOrchestra(n,y);return await s().loadRehearsals(s().filterBy),t({isLoading:!1}),v}catch(l){const c=l instanceof Error?l.message:"Failed to update orchestra rehearsals";throw t({error:c,isLoading:!1}),console.error("Error updating orchestra rehearsals:",l),l}},bulkCreateRehearsals:async n=>{var i,l;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const p=za.getState();let m=(i=p.currentSchoolYear)==null?void 0:i._id;if(!m){console.log("Current school year not found, attempting to load...");try{await p.loadCurrentSchoolYear(),m=(l=p.currentSchoolYear)==null?void 0:l._id}catch(y){console.error("Failed to load current school year:",y)}}if(!m)throw new Error("School year ID is required for bulk rehearsal creation but not available");n.schoolYearId=m}if(console.log("Using school year ID for bulk create:",n.schoolYearId),!n.orchestraId)throw new Error("Orchestra ID is required for bulk rehearsal creation");if(!n.startDate||!n.endDate)throw new Error("Start date and end date are required");if(n.dayOfWeek===void 0||n.dayOfWeek===null)throw new Error("Day of week is required");if(!n.startTime||!n.endTime)throw new Error("Start time and end time are required");if(!n.location)throw new Error("Location is required");const c=typeof n.dayOfWeek=="string"?parseInt(n.dayOfWeek,10):n.dayOfWeek;if(isNaN(c)||c<0||c>6)throw new Error("Day of week must be a number between 0 and 6");const u={orchestraId:n.orchestraId,startDate:n.startDate,endDate:n.endDate,dayOfWeek:c,startTime:n.startTime,endTime:n.endTime,location:n.location,notes:n.notes||"",excludeDates:n.excludeDates||[],schoolYearId:n.schoolYearId};console.log("Formatted data for bulk create:",u);const f=await Zs.bulkCreateRehearsals(u);return console.log("Bulk create result:",f),u.orchestraId?await s().loadRehearsalsByOrchestraId(u.orchestraId):await s().loadRehearsals(),t({isLoading:!1}),f}catch(c){const u=c instanceof Error?c.message:"Failed to create bulk rehearsals";throw t({error:u,isLoading:!1}),console.error("Error creating bulk rehearsals:",c),c}},updateAttendance:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Zs.updateAttendance(n,i),u=s().rehearsals.map(f=>f._id===n?c:f);t({rehearsals:u,selectedRehearsal:((l=s().selectedRehearsal)==null?void 0:l._id)===n?c:s().selectedRehearsal,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to update attendance";throw t({error:u,isLoading:!1}),console.error("Error updating attendance:",c),c}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedRehearsal:()=>{t({selectedRehearsal:null})},clearError:()=>{t({error:null})}}));function yI(){const{values:t,setFieldValue:s,isSubmitting:n}=Sr(),{orchestras:i,loadOrchestras:l,isLoading:c}=vr(),{teachers:u,loadTeachers:f}=Ds(),{rehearsals:p,loadRehearsals:m}=_l(),y=_t(),[v,j]=x.useState("");x.useEffect(()=>{l(),f(),m()},[l,f,m]);const N=I=>{var R;const T=u.find(E=>E._id===I);return((R=T==null?void 0:T.personalInfo)==null?void 0:R.fullName)||"מנצח לא ידוע"},b=I=>{const T=p.filter(E=>E.groupId===I);if(T.length>0){const E=T[0],k=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][E.dayOfWeek]||"לא ידוע";return{dayOfWeek:E.dayOfWeek,dayName:`יום ${k}`,startTime:E.startTime,endTime:E.endTime,timeRange:`${E.startTime}-${E.endTime}`,fullSchedule:`יום ${k} ${E.startTime}-${E.endTime}`}}const R=i.find(E=>E._id===I);if(R){let E=null;return R.name.includes("מתחילים")?E={dayOfWeek:0,dayName:"יום ראשון",startTime:"14:00",endTime:"15:00",timeRange:"14:00-15:00",fullSchedule:"יום ראשון 14:00-15:00"}:R.name.includes("מתקדמים")?E={dayOfWeek:0,dayName:"יום ראשון",startTime:"16:00",endTime:"18:00",timeRange:"16:00-18:00",fullSchedule:"יום ראשון 16:00-18:00"}:R.type==="הרכב"?E={dayOfWeek:2,dayName:"יום שלישי",startTime:"17:00",endTime:"18:30",timeRange:"17:00-18:30",fullSchedule:"יום שלישי 17:00-18:30"}:E={dayOfWeek:0,dayName:"יום ראשון",startTime:"15:00",endTime:"17:00",timeRange:"15:00-17:00",fullSchedule:"יום ראשון 15:00-17:00"},E}return null},w=I=>{y(`/orchestras/${I}`)},A=i.reduce((I,T)=>{const R=T.type||"אחר";return I[R]||(I[R]=[]),I[R].push(T),I},{}),S=t.orchestraAssignments.map(I=>{var E;const T=i.find(_=>_._id===I.orchestraId),R=b(I.orchestraId);return{id:I.orchestraId,name:(T==null?void 0:T.name)||"תזמורת לא ידועה",type:(T==null?void 0:T.type)||"",conductorId:(T==null?void 0:T.conductorId)||"",conductorName:T!=null&&T.conductorId?N(T.conductorId):"",location:(T==null?void 0:T.location)||"",memberCount:((E=T==null?void 0:T.memberIds)==null?void 0:E.length)||0,isActive:(T==null?void 0:T.isActive)??!0,rehearsalTimes:R}}),C=I=>{const T=I.target.value;if(j(T),T&&!t.orchestraAssignments.some(E=>E.orchestraId===T)){const E=[...t.orchestraAssignments,{orchestraId:T}];s("orchestraAssignments",E),s("enrollments.orchestraIds",[...t.enrollments.orchestraIds,T]),j("")}},D=I=>{const T=t.orchestraAssignments.filter(E=>E.orchestraId!==I);s("orchestraAssignments",T);const R=t.enrollments.orchestraIds.filter(E=>E!==I);s("enrollments.orchestraIds",R)};return e.jsxs("div",{className:"form-section orchestra-assignment-section",children:[e.jsx("h3",{children:"שיוך לתזמורת"}),S.length>0&&e.jsxs("div",{className:"assigned-orchestras",children:[e.jsx("h4",{children:"תזמורות משוייכות"}),e.jsx("div",{className:"assignments-list",children:S.map(I=>e.jsxs("div",{className:"assignment-card clickable",onClick:()=>w(I.id),children:[e.jsxs("div",{className:"assignment-header",children:[e.jsxs("div",{className:"orchestra-name",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:I.name}),I.type&&e.jsxs("span",{className:"orchestra-type",children:["(",I.type,")"]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:T=>{T.stopPropagation(),D(I.id)},"aria-label":"הסר תזמורת",disabled:n,children:e.jsx(Ft,{size:12})})]}),e.jsxs("div",{className:"assignment-details",children:[I.conductorName&&e.jsxs("div",{className:"conductor-name",children:[e.jsx(Je,{size:12}),e.jsxs("span",{children:["מנצח: ",I.conductorName]})]}),I.rehearsalTimes&&e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:I.rehearsalTimes.fullSchedule})]}),I.location&&e.jsxs("div",{className:"location",children:[e.jsx(gt,{size:12}),e.jsxs("span",{children:["מיקום: ",I.location]})]}),I.memberCount>0&&e.jsxs("div",{className:"member-count",children:[e.jsx(ms,{size:12}),e.jsxs("span",{children:[I.memberCount," חברים"]})]}),!I.isActive&&e.jsx("div",{className:"status-inactive",children:"תזמורת לא פעילה"})]})]},I.id))})]}),e.jsxs("div",{className:"add-orchestra-section",children:[e.jsx("h4",{children:"הוספת תזמורת"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orchestra",children:"בחר תזמורת"}),e.jsxs("select",{id:"orchestra",name:"orchestra",value:v,onChange:C,disabled:c||n,children:[e.jsx("option",{value:"",children:"בחר תזמורת"}),Object.entries(A).map(([I,T])=>e.jsx("optgroup",{label:I,children:T.map(R=>{var k;const E=R.conductorId?N(R.conductorId):"",_=b(R._id);return e.jsxs("option",{value:R._id,children:[R.name," - ",R.location||"ללא מיקום",_&&` | ${_.fullSchedule}`,E&&` | מנצח: ${E}`,((k=R.memberIds)==null?void 0:k.length)>0&&` | ${R.memberIds.length} חברים`]},R._id)})},I))]}),c&&e.jsx("div",{className:"loading-indicator",children:"טוען תזמורות..."})]})})]})]})}const Xo=["תלמידים חדשים צעירים","תלמידים חדשים בוגרים (ה - ט)","מתחילים","מתחילים ב","תלמידים חדשים ב-ד","מתקדמים א","מתקדמים ב","מתקדמים ג","מתחילים ד","הכנה לרסיטל קלאסי יא","הכנה לרסיטל רוק\\פופ\\ג'אז יא","הכנה לרסיטל רוק\\פופ\\ג'אז יב","מגמה"],Zo=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר תאוריה א","חדר תאוריה ב","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26"],Xs={async getTheoryLessons(t={}){return ye.get("theory",t)},async getTheoryLessonById(t){return ye.get(`theory/${t}`)},async getTheoryLessonsByCategory(t,s={}){return ye.get(`theory/category/${t}`,s)},async getTheoryLessonsByTeacher(t,s={}){return ye.get(`theory/teacher/${t}`,s)},async getTheoryLessonsByIds(t){if(!t||t.length===0)return[];try{const s=t.map(l=>this.getTheoryLessonById(l).catch(c=>(console.error(`Failed to fetch theory lesson ${l}:`,c),null)));return(await Promise.allSettled(s)).filter(l=>l.status==="fulfilled"&&l.value!==null).map(l=>l.value)}catch(s){return console.error("Error fetching theory lessons by IDs:",s),[]}},async addTheoryLesson(t){if(t.date&&!t.dayOfWeek){const n=new Date(t.date);t.dayOfWeek=n.getDay()}if(!t.schoolYearId)throw new Error("School year ID is required for theory lesson creation");console.log("Adding theory lesson with data:",t);const s=await ye.post("theory",t);return s&&typeof s=="object"&&"data"in s?(console.log("Backend returned wrapped response:",s),s.data):s},async updateTheoryLesson(t,s){const{_id:n,...i}=s;if(s.date&&!s.dayOfWeek){const c=new Date(s.date);i.dayOfWeek=c.getDay()}const l=await ye.put(`theory/${t}`,i);return l&&typeof l=="object"&&"data"in l?(console.log("Backend returned wrapped update response:",l),l.data):l},async removeTheoryLesson(t){if(!t)throw new Error("Invalid theory lesson ID");return ye.delete(`theory/${t}`)},async bulkCreateTheoryLessons(t){try{if(!t.category)throw new Error("Category is required for bulk theory lesson creation");if(!t.teacherId)throw new Error("Teacher ID is required for bulk theory lesson creation");if(!t.schoolYearId)throw new Error("School year ID is required for bulk theory lesson creation");if(!t.startDate||!t.endDate)throw new Error("Start date and end date are required for bulk theory lesson creation");const s=Number(t.dayOfWeek);if(isNaN(s)||s<0||s>6)throw new Error("Day of week must be a number between 0 and 6");const n={category:t.category,teacherId:t.teacherId,startDate:t.startDate,endDate:t.endDate,dayOfWeek:s,startTime:t.startTime,endTime:t.endTime,location:t.location,studentIds:t.studentIds||[],notes:t.notes||"",syllabus:t.syllabus||"",excludeDates:t.excludeDates||[],schoolYearId:t.schoolYearId};console.log("Sending bulk create data:",n);const i=localStorage.getItem("accessToken");if(!i)throw new Error("Authentication required for bulk theory lesson creation");const l=await ye.post("theory/bulk-create",n,{headers:{Authorization:`Bearer ${i}`}});return l&&typeof l=="object"&&"data"in l?(console.log("Backend returned wrapped bulk response:",l),l.data):l}catch(s){const n=Ca(s,"bulkCreateTheoryLessons"),i=new Error(n.userMessage);throw i.errorId=n.errorId,i.developerMessage=n.developerMessage,i}},async updateAttendance(t,s){const n=await ye.put(`theory/${t}/attendance`,s);return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped attendance response:",n),n.data):n},async getAttendance(t){return ye.get(`theory/${t}/attendance`)},async addStudentToTheory(t,s){const n=await ye.post(`theory/${t}/student`,{studentId:s});return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped add student response:",n),n.data):n},async removeStudentFromTheory(t,s){const n=await ye.delete(`theory/${t}/student/${s}`);return n&&typeof n=="object"&&"data"in n?(console.log("Backend returned wrapped remove student response:",n),n.data):n},async getStudentTheoryAttendanceStats(t,s){const n=s?{category:s}:{};return ye.get(`theory/student/${t}/stats`,n)},formatDate(t){return t.toISOString().split("T")[0]},formatTime(t){return t.toTimeString().slice(0,5)},formatDateForDisplay(t){return new Date(t).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"})},formatTimeForDisplay(t){return t},calculateDuration(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u},formatDuration(t){const s=Math.floor(t/60),n=t%60;return s===0?`${n} דקות`:s===1&&n===0?"שעה אחת":s===1?`שעה ו-${n} דקות`:n===0?`${s} שעות`:`${s} שעות ו-${n} דקות`}},Dd=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},Mb=(t,s,n,i)=>{const l=Dd(t),c=Dd(s),u=Dd(n),f=Dd(i);return l<f&&c>u},vI=(t,s,n,i=[])=>{const l=[],c=new Date(t),u=new Date(s),f=new Date(c);for(;f.getDay()!==n&&f<=u;)f.setDate(f.getDate()+1);for(;f<=u;){const p=f.toISOString().split("T")[0];i.includes(p)||l.push(p),f.setDate(f.getDate()+7)}return l},xI=(t,s)=>{const n=[];return vI(s.startDate,s.endDate,s.dayOfWeek,s.excludeDates).forEach(l=>{t.forEach(c=>{c.date.split("T")[0]!==l||!Mb(s.startTime,s.endTime,c.startTime,c.endTime)||(c.location===s.location&&n.push({type:"room",existingLesson:c,newLesson:{date:l,startTime:s.startTime,endTime:s.endTime,location:s.location,teacherId:s.teacherId},conflictDate:l,description:`Room conflict: ${s.location} is already booked on ${l} from ${c.startTime}-${c.endTime} (existing lesson) vs ${s.startTime}-${s.endTime} (new lesson)`}),c.teacherId===s.teacherId&&c.location!==s.location&&n.push({type:"teacher",existingLesson:c,newLesson:{date:l,startTime:s.startTime,endTime:s.endTime,location:s.location,teacherId:s.teacherId},conflictDate:l,description:`Teacher conflict: Teacher is already scheduled on ${l} from ${c.startTime}-${c.endTime} in ${c.location} vs ${s.startTime}-${s.endTime} in ${s.location}`}))})}),n},jI=(t,s)=>{const n=[];if(!s.date||!s.startTime||!s.endTime||!s.location)return n;const i=s.date.split("T")[0];return t.forEach(l=>{l.date.split("T")[0]!==i||!Mb(s.startTime,s.endTime,l.startTime,l.endTime)||(l.location===s.location&&n.push({type:"room",existingLesson:l,newLesson:s,conflictDate:i,description:`Room conflict: ${s.location} is already booked on ${i} from ${l.startTime}-${l.endTime}`}),l.teacherId===s.teacherId&&l.location!==s.location&&n.push({type:"teacher",existingLesson:l,newLesson:s,conflictDate:i,description:`Teacher conflict: Teacher is already scheduled on ${i} from ${l.startTime}-${l.endTime} in ${l.location}`}))}),n},xj=t=>{if(t.length===0)return"";const s=t.filter(l=>l.type==="room"),n=t.filter(l=>l.type==="teacher");let i=`נמצאו התנגשויות בלוח הזמנים:

`;return s.length>0&&(i+=`התנגשויות חדרים (${s.length}):
`,s.forEach((l,c)=>{i+=`${c+1}. ${l.conflictDate} - ${l.existingLesson.location}
`}),i+=`
`),n.length>0&&(i+=`התנגשויות מורים (${n.length}):
`,n.forEach((l,c)=>{i+=`${c+1}. ${l.conflictDate}
`})),i+=`
האם ברצונך להמשיך למרות ההתנגשויות?`,i},mp=Ba((t,s)=>({theoryLessons:[],selectedTheoryLesson:null,filterBy:{},isLoading:!1,error:null,loadTheoryLessons:async(n={})=>{t({isLoading:!0,error:null});try{const i=await Xs.getTheoryLessons(n);t({theoryLessons:i,filterBy:n,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load theory lessons";t({error:l,isLoading:!1}),console.error("Error loading theory lessons:",i)}},loadTheoryLessonById:async n=>{t({isLoading:!0,error:null});try{const i=await Xs.getTheoryLessonById(n);t({selectedTheoryLesson:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load theory lesson";t({error:l,isLoading:!1}),console.error("Error loading theory lesson:",i)}},loadTheoryLessonsByCategory:async(n,i={})=>{t({isLoading:!0,error:null});try{const l=await Xs.getTheoryLessonsByCategory(n,i);t({theoryLessons:l,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to load category theory lessons";t({error:c,isLoading:!1}),console.error("Error loading category theory lessons:",l)}},loadTheoryLessonsByTeacher:async(n,i={})=>{t({isLoading:!0,error:null});try{const l=await Xs.getTheoryLessonsByTeacher(n,i);t({theoryLessons:l,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to load teacher theory lessons";t({error:c,isLoading:!1}),console.error("Error loading teacher theory lessons:",l)}},saveTheoryLesson:async n=>{var i;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const u=(i=za.getState().currentSchoolYear)==null?void 0:i._id;if(!u)throw new Error("School year ID is required but not available");n.schoolYearId=u}let l;if(n._id){l=await Xs.updateTheoryLesson(n._id,n);const c=s().theoryLessons.map(u=>u._id===l._id?l:u);t({theoryLessons:c,selectedTheoryLesson:l,isLoading:!1})}else{console.log("Adding new theory lesson with data:",n);const c=s().theoryLessons,u=jI(c,n);if(u.length>0){const f=xj(u);throw console.warn("Single theory lesson conflicts detected:",u),console.warn("Conflict message for user:",f),new Error(f)}if(l=await Xs.addTheoryLesson(n),console.log("Theory lesson saved, returned data:",l),!l||!l._id)throw console.error("Backend returned invalid theory lesson data:",l),new Error("שגיאה: השרת לא החזיר מזהה תקין לשיעור התאוריה החדש");t({theoryLessons:[...s().theoryLessons,l],selectedTheoryLesson:l,isLoading:!1})}return l}catch(l){const c=l instanceof Error?l.message:"Failed to save theory lesson";throw t({error:c,isLoading:!1}),console.error("Error saving theory lesson:",l),l}},removeTheoryLesson:async n=>{var i;t({isLoading:!0,error:null});try{if(!n)throw new Error("Invalid theory lesson ID");await Xs.removeTheoryLesson(n),t({theoryLessons:s().theoryLessons.filter(l=>l._id!==n),selectedTheoryLesson:((i=s().selectedTheoryLesson)==null?void 0:i._id)===n?null:s().selectedTheoryLesson,isLoading:!1})}catch(l){const c=l instanceof Error?l.message:"Failed to permanently delete theory lesson";throw t({error:c,isLoading:!1}),console.error("Error deleting theory lesson:",l),l}},bulkCreateTheoryLessons:async n=>{var i,l;t({isLoading:!0,error:null});try{if(!n.schoolYearId){const v=za.getState();let j=(i=v.currentSchoolYear)==null?void 0:i._id;if(!j){console.log("Current school year not found, attempting to load...");try{await v.loadCurrentSchoolYear(),j=(l=v.currentSchoolYear)==null?void 0:l._id}catch(N){console.error("Failed to load current school year:",N)}}if(!j)throw new Error("School year ID is required for bulk theory lesson creation but not available");n.schoolYearId=j}if(console.log("Using school year ID for bulk create:",n.schoolYearId),!n.category)throw new Error("Category is required for bulk theory lesson creation");if(!n.teacherId)throw new Error("Teacher ID is required for bulk theory lesson creation");if(!n.startDate||!n.endDate)throw new Error("Start date and end date are required");if(n.dayOfWeek===void 0||n.dayOfWeek===null)throw new Error("Day of week is required");if(!n.startTime||!n.endTime)throw new Error("Start time and end time are required");if(!n.location)throw new Error("Location is required");const c=typeof n.dayOfWeek=="string"?parseInt(n.dayOfWeek,10):n.dayOfWeek;if(isNaN(c)||c<0||c>6)throw new Error("Day of week must be a number between 0 and 6");const u={category:n.category,teacherId:n.teacherId,startDate:n.startDate,endDate:n.endDate,dayOfWeek:c,startTime:n.startTime,endTime:n.endTime,location:n.location,studentIds:n.studentIds||[],notes:n.notes||"",syllabus:n.syllabus||"",excludeDates:n.excludeDates||[],schoolYearId:n.schoolYearId};console.log("Formatted data for bulk create:",u);const f=s().theoryLessons,p=xI(f,u);if(p.length>0){const v=xj(p);throw console.warn("Theory lesson conflicts detected:",p),console.warn("Conflict message for user:",v),new Error(v)}const m=await Xs.bulkCreateTheoryLessons(u);if(console.log("Bulk create result:",m),!m||typeof m.insertedCount!="number"||!Array.isArray(m.theoryLessonIds))throw console.error("Backend returned invalid bulk creation result:",m),new Error("שגיאה: השרת לא החזיר תוצאה תקינה ליצירת שיעורי התאוריה");const y=s().filterBy;return await s().loadTheoryLessons(y),t({isLoading:!1}),m}catch(c){const u=c instanceof Error?c.message:"Failed to create bulk theory lessons";throw t({error:u,isLoading:!1}),console.error("Error creating bulk theory lessons:",c),c}},updateAttendance:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Xs.updateAttendance(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to update attendance";throw t({error:u,isLoading:!1}),console.error("Error updating attendance:",c),c}},addStudentToTheory:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Xs.addStudentToTheory(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to add student to theory lesson";throw t({error:u,isLoading:!1}),console.error("Error adding student to theory lesson:",c),c}},removeStudentFromTheory:async(n,i)=>{var l;t({isLoading:!0,error:null});try{const c=await Xs.removeStudentFromTheory(n,i),u=s().theoryLessons.map(f=>f._id===n?c:f);t({theoryLessons:u,selectedTheoryLesson:((l=s().selectedTheoryLesson)==null?void 0:l._id)===n?c:s().selectedTheoryLesson,isLoading:!1})}catch(c){const u=c instanceof Error?c.message:"Failed to remove student from theory lesson";throw t({error:u,isLoading:!1}),console.error("Error removing student from theory lesson:",c),c}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedTheoryLesson:()=>{t({selectedTheoryLesson:null})},clearError:()=>{t({error:null})}}));function bI(){const{values:t,setFieldValue:s,isSubmitting:n}=Sr(),{theoryLessons:i,loadTheoryLessons:l,isLoading:c}=mp(),{teachers:u,loadTeachers:f}=Ds(),p=_t(),[m,y]=x.useState("");x.useEffect(()=>{l(),f()},[l,f]);const v=I=>{var R;const T=u.find(E=>E._id===I);return((R=T==null?void 0:T.personalInfo)==null?void 0:R.fullName)||"מורה לא ידוע"},j=I=>{p(`/theory/${I}`)},N=i.reduce((I,T)=>{const R=`${T.category||"אחר"}-${T.dayOfWeek}-${T.startTime}-${T.endTime}-${T.location}`;return I[R]?I[R].allInstanceIds.push(T._id):I[R]={...T,allInstanceIds:[T._id],representativeId:T._id},I},{}),b=Object.values(N).reduce((I,T)=>{const R=T.category||"אחר";return I[R]||(I[R]=[]),I[R].push(T),I},{}),w=t.theoryLessonAssignments.reduce((I,T)=>{const R=i.find(E=>E._id===T.theoryLessonId);if(R){const E=Object.values(N).find(_=>_.allInstanceIds.includes(T.theoryLessonId));if(E){const _=E.representativeId;I[_]||(I[_]={representativeId:_,category:R.category||"שיעור העשרה לא ידוע",dayTime:S(R.dayOfWeek,R.startTime,R.endTime),location:R.location||"",teacherId:R.teacherId,teacherName:v(R.teacherId),assignedInstances:[],totalInstances:E.allInstanceIds.length}),I[_].assignedInstances.push(T.theoryLessonId)}}return I},{}),A=Object.values(w);function S(I,T,R){return I===void 0||!T||!R?"":`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][I]||"לא ידוע"} ${T}-${R}`}const C=I=>{const T=I.target.value;if(y(T),T){const R=Object.values(N).find(E=>E.representativeId===T);if(R){const E=R.allInstanceIds,_=t.theoryLessonAssignments.map(z=>z.theoryLessonId).filter(z=>E.includes(z)),k=E.filter(z=>!_.includes(z));if(k.length>0){const z=k.map(G=>({theoryLessonId:G})),M=[...t.theoryLessonAssignments,...z];s("theoryLessonAssignments",M),s("enrollments.theoryLessonIds",[...t.enrollments.theoryLessonIds,...k]),console.log(`📚 Added ${k.length} theory lesson instances for recurring pattern:`,{category:R.category,dayTime:S(R.dayOfWeek,R.startTime,R.endTime),location:R.location,totalInstances:E.length,newInstances:k.length,alreadyAssigned:_.length})}else console.log("⚠️ All instances of this theory lesson pattern are already assigned");y("")}}},D=I=>{const T=Object.values(N).find(R=>R.allInstanceIds.includes(I));if(T){const R=T.allInstanceIds,E=t.theoryLessonAssignments.filter(k=>!R.includes(k.theoryLessonId));s("theoryLessonAssignments",E);const _=t.enrollments.theoryLessonIds.filter(k=>!R.includes(k));s("enrollments.theoryLessonIds",_),console.log(`🗑️ Removed ${R.length} theory lesson instances for recurring pattern:`,{category:T.category,dayTime:S(T.dayOfWeek,T.startTime,T.endTime),location:T.location,removedInstances:R.length})}else{const R=t.theoryLessonAssignments.filter(_=>_.theoryLessonId!==I);s("theoryLessonAssignments",R);const E=t.enrollments.theoryLessonIds.filter(_=>_!==I);s("enrollments.theoryLessonIds",E),console.log("🗑️ Removed single theory lesson instance (fallback):",I)}};return e.jsxs("div",{className:"form-section theory-lessons-assignment-section",children:[e.jsx("h3",{children:"שיוך לשיעורי העשרה"}),A.length>0&&e.jsxs("div",{className:"assigned-theory-lessons",children:[e.jsx("h4",{children:"שיעורי העשרה משויכים"}),e.jsx("div",{className:"assignments-list",children:A.map(I=>e.jsxs("div",{className:"assignment-card clickable",onClick:()=>j(I.assignedInstances[0]),children:[e.jsxs("div",{className:"assignment-header",children:[e.jsxs("div",{className:"theory-lesson-name",children:[e.jsx(Zt,{size:12}),e.jsx("span",{children:I.category}),I.totalInstances>1&&e.jsxs("span",{className:"instance-count",children:["(",I.assignedInstances.length,"/",I.totalInstances," שיעורים)"]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:T=>{T.stopPropagation(),D(I.assignedInstances[0])},"aria-label":"הסר שיעור העשרה",disabled:n,children:e.jsx(Ft,{size:12})})]}),e.jsxs("div",{className:"assignment-details",children:[I.teacherName&&e.jsxs("div",{className:"teacher-name",children:[e.jsx(Je,{size:12}),e.jsxs("span",{children:["מורה: ",I.teacherName]})]}),I.dayTime&&e.jsx("div",{className:"day-time",children:I.dayTime}),I.location&&e.jsxs("div",{className:"location",children:["מיקום: ",I.location]}),I.totalInstances>1&&e.jsx("div",{className:"enrollment-info",children:"רישום לכל השיעורים השבועיים"})]})]},I.representativeId))})]}),e.jsxs("div",{className:"add-theory-lesson-section",children:[e.jsx("h4",{children:"הוספת שיעור העשרה"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"theoryLesson",children:"בחר שיעור העשרה"}),e.jsxs("select",{id:"theoryLesson",name:"theoryLesson",value:m,onChange:C,disabled:c||n,children:[e.jsx("option",{value:"",children:"בחר שיעור העשרה"}),Object.entries(b).map(([I,T])=>e.jsx("optgroup",{label:I,children:T.map(R=>e.jsxs("option",{value:R.representativeId,children:[R.category," - ",R.location," | ",S(R.dayOfWeek,R.startTime,R.endTime),v(R.teacherId)!=="מורה לא ידוע"&&` | מורה: ${v(R.teacherId)}`,R.allInstanceIds.length>1&&` | ${R.allInstanceIds.length} שיעורים`]},R.representativeId))},I))]}),c&&e.jsx("div",{className:"loading-indicator",children:"טוען שיעורי העשרה..."})]})})]})]})}var lm,jj;function NI(){if(jj)return lm;jj=1;function t(S){this._maxSize=S,this.clear()}t.prototype.clear=function(){this._size=0,this._values=Object.create(null)},t.prototype.get=function(S){return this._values[S]},t.prototype.set=function(S,C){return this._size>=this._maxSize&&this.clear(),S in this._values||this._size++,this._values[S]=C};var s=/[^.^\]^[]+|(?=\[\]|\.\.)/g,n=/^\d+$/,i=/^\d/,l=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,c=/^\s*(['"]?)(.*?)(\1)\s*$/,u=512,f=new t(u),p=new t(u),m=new t(u);lm={Cache:t,split:v,normalizePath:y,setter:function(S){var C=y(S);return p.get(S)||p.set(S,function(I,T){for(var R=0,E=C.length,_=I;R<E-1;){var k=C[R];if(k==="__proto__"||k==="constructor"||k==="prototype")return I;_=_[C[R++]]}_[C[R]]=T})},getter:function(S,C){var D=y(S);return m.get(S)||m.set(S,function(T){for(var R=0,E=D.length;R<E;)if(T!=null||!C)T=T[D[R++]];else return;return T})},join:function(S){return S.reduce(function(C,D){return C+(N(D)||n.test(D)?"["+D+"]":(C?".":"")+D)},"")},forEach:function(S,C,D){j(Array.isArray(S)?S:v(S),C,D)}};function y(S){return f.get(S)||f.set(S,v(S).map(function(C){return C.replace(c,"$2")}))}function v(S){return S.match(s)||[""]}function j(S,C,D){var I=S.length,T,R,E,_;for(R=0;R<I;R++)T=S[R],T&&(A(T)&&(T='"'+T+'"'),_=N(T),E=!_&&/^\d+$/.test(T),C.call(D,T,_,E,R,S))}function N(S){return typeof S=="string"&&S&&["'",'"'].indexOf(S.charAt(0))!==-1}function b(S){return S.match(i)&&!S.match(n)}function w(S){return l.test(S)}function A(S){return!N(S)&&(b(S)||w(S))}return lm}var ri=NI(),om,bj;function SI(){if(bj)return om;bj=1;const t=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,s=y=>y.match(t)||[],n=y=>y[0].toUpperCase()+y.slice(1),i=(y,v)=>s(y).join(v).toLowerCase(),l=y=>s(y).reduce((v,j)=>`${v}${v?j[0].toUpperCase()+j.slice(1).toLowerCase():j.toLowerCase()}`,"");return om={words:s,upperFirst:n,camelCase:l,pascalCase:y=>n(l(y)),snakeCase:y=>i(y,"_"),kebabCase:y=>i(y,"-"),sentenceCase:y=>n(i(y," ")),titleCase:y=>s(y).map(n).join(" ")},om}var cm=SI(),kd={exports:{}},Nj;function wI(){if(Nj)return kd.exports;Nj=1,kd.exports=function(l){return t(s(l),l)},kd.exports.array=t;function t(l,c){var u=l.length,f=new Array(u),p={},m=u,y=n(c),v=i(l);for(c.forEach(function(N){if(!v.has(N[0])||!v.has(N[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});m--;)p[m]||j(l[m],m,new Set);return f;function j(N,b,w){if(w.has(N)){var A;try{A=", node was:"+JSON.stringify(N)}catch{A=""}throw new Error("Cyclic dependency"+A)}if(!v.has(N))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(N));if(!p[b]){p[b]=!0;var S=y.get(N)||new Set;if(S=Array.from(S),b=S.length){w.add(N);do{var C=S[--b];j(C,v.get(C),w)}while(b);w.delete(N)}f[--u]=N}}}function s(l){for(var c=new Set,u=0,f=l.length;u<f;u++){var p=l[u];c.add(p[0]),c.add(p[1])}return Array.from(c)}function n(l){for(var c=new Map,u=0,f=l.length;u<f;u++){var p=l[u];c.has(p[0])||c.set(p[0],new Set),c.has(p[1])||c.set(p[1],new Set),c.get(p[0]).add(p[1])}return c}function i(l){for(var c=new Map,u=0,f=l.length;u<f;u++)c.set(l[u],u);return c}return kd.exports}var TI=wI();const EI=Ja(TI),AI=Object.prototype.toString,CI=Error.prototype.toString,DI=RegExp.prototype.toString,kI=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",_I=/^Symbol\((.*)\)(.*)$/;function OI(t){return t!=+t?"NaN":t===0&&1/t<0?"-0":""+t}function Sj(t,s=!1){if(t==null||t===!0||t===!1)return""+t;const n=typeof t;if(n==="number")return OI(t);if(n==="string")return s?`"${t}"`:t;if(n==="function")return"[Function "+(t.name||"anonymous")+"]";if(n==="symbol")return kI.call(t).replace(_I,"Symbol($1)");const i=AI.call(t).slice(8,-1);return i==="Date"?isNaN(t.getTime())?""+t:t.toISOString(t):i==="Error"||t instanceof Error?"["+CI.call(t)+"]":i==="RegExp"?DI.call(t):null}function Dn(t,s){let n=Sj(t,s);return n!==null?n:JSON.stringify(t,function(i,l){let c=Sj(this[i],s);return c!==null?c:l},2)}function zb(t){return t==null?[]:[].concat(t)}let Lb,Bb,Fb,II=/\$\{\s*(\w+)\s*\}/g;Lb=Symbol.toStringTag;class wj{constructor(s,n,i,l){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[Lb]="Error",this.name="ValidationError",this.value=n,this.path=i,this.type=l,this.errors=[],this.inner=[],zb(s).forEach(c=>{if(Ms.isError(c)){this.errors.push(...c.errors);const u=c.inner.length?c.inner:[c];this.inner.push(...u)}else this.errors.push(c)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}Bb=Symbol.hasInstance;Fb=Symbol.toStringTag;class Ms extends Error{static formatError(s,n){const i=n.label||n.path||"this";return n=Object.assign({},n,{path:i,originalPath:n.path}),typeof s=="string"?s.replace(II,(l,c)=>Dn(n[c])):typeof s=="function"?s(n):s}static isError(s){return s&&s.name==="ValidationError"}constructor(s,n,i,l,c){const u=new wj(s,n,i,l);if(c)return u;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[Fb]="Error",this.name=u.name,this.message=u.message,this.type=u.type,this.value=u.value,this.path=u.path,this.errors=u.errors,this.inner=u.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Ms)}static[Bb](s){return wj[Symbol.hasInstance](s)||super[Symbol.hasInstance](s)}}let Xa={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:t,type:s,value:n,originalValue:i})=>{const l=i!=null&&i!==n?` (cast from the value \`${Dn(i,!0)}\`).`:".";return s!=="mixed"?`${t} must be a \`${s}\` type, but the final value was: \`${Dn(n,!0)}\``+l:`${t} must match the configured type. The validated value was: \`${Dn(n,!0)}\``+l}},Is={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},rr={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},Mm={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},zm={isValue:"${path} field must be ${value}"},Pd={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},qd={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},$I={notType:t=>{const{path:s,value:n,spec:i}=t,l=i.types.length;if(Array.isArray(n)){if(n.length<l)return`${s} tuple value has too few items, expected a length of ${l} but got ${n.length} for value: \`${Dn(n,!0)}\``;if(n.length>l)return`${s} tuple value has too many items, expected a length of ${l} but got ${n.length} for value: \`${Dn(n,!0)}\``}return Ms.formatError(Xa.notType,t)}};Object.assign(Object.create(null),{mixed:Xa,string:Is,number:rr,date:Mm,object:Pd,array:qd,boolean:zm,tuple:$I});const Cu=t=>t&&t.__isYupSchema__;class nu{static fromOptions(s,n){if(!n.then&&!n.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:i,then:l,otherwise:c}=n,u=typeof i=="function"?i:(...f)=>f.every(p=>p===i);return new nu(s,(f,p)=>{var m;let y=u(...f)?l:c;return(m=y==null?void 0:y(p))!=null?m:p})}constructor(s,n){this.fn=void 0,this.refs=s,this.refs=s,this.fn=n}resolve(s,n){let i=this.refs.map(c=>c.getValue(n==null?void 0:n.value,n==null?void 0:n.parent,n==null?void 0:n.context)),l=this.fn(i,s,n);if(l===void 0||l===s)return s;if(!Cu(l))throw new TypeError("conditions must return a schema object");return l.resolve(n)}}const _d={context:"$",value:"."};function RI(t,s){return new wr(t,s)}class wr{constructor(s,n={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof s!="string")throw new TypeError("ref must be a string, got: "+s);if(this.key=s.trim(),s==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===_d.context,this.isValue=this.key[0]===_d.value,this.isSibling=!this.isContext&&!this.isValue;let i=this.isContext?_d.context:this.isValue?_d.value:"";this.path=this.key.slice(i.length),this.getter=this.path&&ri.getter(this.path,!0),this.map=n.map}getValue(s,n,i){let l=this.isContext?i:this.isValue?s:n;return this.getter&&(l=this.getter(l||{})),this.map&&(l=this.map(l)),l}cast(s,n){return this.getValue(s,n==null?void 0:n.parent,n==null?void 0:n.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(s){return s&&s.__isYupRef}}wr.prototype.__isYupRef=!0;const $a=t=>t==null;function tl(t){function s({value:n,path:i="",options:l,originalValue:c,schema:u},f,p){const{name:m,test:y,params:v,message:j,skipAbsent:N}=t;let{parent:b,context:w,abortEarly:A=u.spec.abortEarly,disableStackTrace:S=u.spec.disableStackTrace}=l;function C(M){return wr.isRef(M)?M.getValue(n,b,w):M}function D(M={}){const G=Object.assign({value:n,originalValue:c,label:u.spec.label,path:M.path||i,spec:u.spec,disableStackTrace:M.disableStackTrace||S},v,M.params);for(const W of Object.keys(G))G[W]=C(G[W]);const X=new Ms(Ms.formatError(M.message||j,G),n,G.path,M.type||m,G.disableStackTrace);return X.params=G,X}const I=A?f:p;let T={path:i,parent:b,type:m,from:l.from,createError:D,resolve:C,options:l,originalValue:c,schema:u};const R=M=>{Ms.isError(M)?I(M):M?p(null):I(D())},E=M=>{Ms.isError(M)?I(M):f(M)};if(N&&$a(n))return R(!0);let k;try{var z;if(k=y.call(T,n,T),typeof((z=k)==null?void 0:z.then)=="function"){if(l.sync)throw new Error(`Validation test of type: "${T.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(k).then(R,E)}}catch(M){E(M);return}R(k)}return s.OPTIONS=t,s}function MI(t,s,n,i=n){let l,c,u;return s?(ri.forEach(s,(f,p,m)=>{let y=p?f.slice(1,f.length-1):f;t=t.resolve({context:i,parent:l,value:n});let v=t.type==="tuple",j=m?parseInt(y,10):0;if(t.innerType||v){if(v&&!m)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${u}" must contain an index to the tuple element, e.g. "${u}[0]"`);if(n&&j>=n.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${f}, in the path: ${s}. because there is no value at that index. `);l=n,n=n&&n[j],t=v?t.spec.types[j]:t.innerType}if(!m){if(!t.fields||!t.fields[y])throw new Error(`The schema does not contain the path: ${s}. (failed at: ${u} which is a type: "${t.type}")`);l=n,n=n&&n[y],t=t.fields[y]}c=y,u=p?"["+f+"]":"."+f}),{schema:t,parent:l,parentPath:c}):{parent:l,parentPath:s,schema:t}}class ru extends Set{describe(){const s=[];for(const n of this.values())s.push(wr.isRef(n)?n.describe():n);return s}resolveAll(s){let n=[];for(const i of this.values())n.push(s(i));return n}clone(){return new ru(this.values())}merge(s,n){const i=this.clone();return s.forEach(l=>i.add(l)),n.forEach(l=>i.delete(l)),i}}function il(t,s=new Map){if(Cu(t)||!t||typeof t!="object")return t;if(s.has(t))return s.get(t);let n;if(t instanceof Date)n=new Date(t.getTime()),s.set(t,n);else if(t instanceof RegExp)n=new RegExp(t),s.set(t,n);else if(Array.isArray(t)){n=new Array(t.length),s.set(t,n);for(let i=0;i<t.length;i++)n[i]=il(t[i],s)}else if(t instanceof Map){n=new Map,s.set(t,n);for(const[i,l]of t.entries())n.set(i,il(l,s))}else if(t instanceof Set){n=new Set,s.set(t,n);for(const i of t)n.add(il(i,s))}else if(t instanceof Object){n={},s.set(t,n);for(const[i,l]of Object.entries(t))n[i]=il(l,s)}else throw Error(`Unable to clone ${t}`);return n}class Us{constructor(s){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new ru,this._blacklist=new ru,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Xa.notType)}),this.type=s.type,this._typeCheck=s.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},s==null?void 0:s.spec),this.withMutation(n=>{n.nonNullable()})}get _type(){return this.type}clone(s){if(this._mutate)return s&&Object.assign(this.spec,s),this;const n=Object.create(Object.getPrototypeOf(this));return n.type=this.type,n._typeCheck=this._typeCheck,n._whitelist=this._whitelist.clone(),n._blacklist=this._blacklist.clone(),n.internalTests=Object.assign({},this.internalTests),n.exclusiveTests=Object.assign({},this.exclusiveTests),n.deps=[...this.deps],n.conditions=[...this.conditions],n.tests=[...this.tests],n.transforms=[...this.transforms],n.spec=il(Object.assign({},this.spec,s)),n}label(s){let n=this.clone();return n.spec.label=s,n}meta(...s){if(s.length===0)return this.spec.meta;let n=this.clone();return n.spec.meta=Object.assign(n.spec.meta||{},s[0]),n}withMutation(s){let n=this._mutate;this._mutate=!0;let i=s(this);return this._mutate=n,i}concat(s){if(!s||s===this)return this;if(s.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${s.type}`);let n=this,i=s.clone();const l=Object.assign({},n.spec,i.spec);return i.spec=l,i.internalTests=Object.assign({},n.internalTests,i.internalTests),i._whitelist=n._whitelist.merge(s._whitelist,s._blacklist),i._blacklist=n._blacklist.merge(s._blacklist,s._whitelist),i.tests=n.tests,i.exclusiveTests=n.exclusiveTests,i.withMutation(c=>{s.tests.forEach(u=>{c.test(u.OPTIONS)})}),i.transforms=[...n.transforms,...i.transforms],i}isType(s){return s==null?!!(this.spec.nullable&&s===null||this.spec.optional&&s===void 0):this._typeCheck(s)}resolve(s){let n=this;if(n.conditions.length){let i=n.conditions;n=n.clone(),n.conditions=[],n=i.reduce((l,c)=>c.resolve(l,s),n),n=n.resolve(s)}return n}resolveOptions(s){var n,i,l,c;return Object.assign({},s,{from:s.from||[],strict:(n=s.strict)!=null?n:this.spec.strict,abortEarly:(i=s.abortEarly)!=null?i:this.spec.abortEarly,recursive:(l=s.recursive)!=null?l:this.spec.recursive,disableStackTrace:(c=s.disableStackTrace)!=null?c:this.spec.disableStackTrace})}cast(s,n={}){let i=this.resolve(Object.assign({value:s},n)),l=n.assert==="ignore-optionality",c=i._cast(s,n);if(n.assert!==!1&&!i.isType(c)){if(l&&$a(c))return c;let u=Dn(s),f=Dn(c);throw new TypeError(`The value of ${n.path||"field"} could not be cast to a value that satisfies the schema type: "${i.type}". 

attempted value: ${u} 
`+(f!==u?`result of cast: ${f}`:""))}return c}_cast(s,n){let i=s===void 0?s:this.transforms.reduce((l,c)=>c.call(this,l,s,this),s);return i===void 0&&(i=this.getDefault(n)),i}_validate(s,n={},i,l){let{path:c,originalValue:u=s,strict:f=this.spec.strict}=n,p=s;f||(p=this._cast(p,Object.assign({assert:!1},n)));let m=[];for(let y of Object.values(this.internalTests))y&&m.push(y);this.runTests({path:c,value:p,originalValue:u,options:n,tests:m},i,y=>{if(y.length)return l(y,p);this.runTests({path:c,value:p,originalValue:u,options:n,tests:this.tests},i,l)})}runTests(s,n,i){let l=!1,{tests:c,value:u,originalValue:f,path:p,options:m}=s,y=w=>{l||(l=!0,n(w,u))},v=w=>{l||(l=!0,i(w,u))},j=c.length,N=[];if(!j)return v([]);let b={value:u,originalValue:f,path:p,options:m,schema:this};for(let w=0;w<c.length;w++){const A=c[w];A(b,y,function(C){C&&(Array.isArray(C)?N.push(...C):N.push(C)),--j<=0&&v(N)})}}asNestedTest({key:s,index:n,parent:i,parentPath:l,originalParent:c,options:u}){const f=s??n;if(f==null)throw TypeError("Must include `key` or `index` for nested validations");const p=typeof f=="number";let m=i[f];const y=Object.assign({},u,{strict:!0,parent:i,value:m,originalValue:c[f],key:void 0,[p?"index":"key"]:f,path:p||f.includes(".")?`${l||""}[${p?f:`"${f}"`}]`:(l?`${l}.`:"")+s});return(v,j,N)=>this.resolve(y)._validate(m,y,j,N)}validate(s,n){var i;let l=this.resolve(Object.assign({},n,{value:s})),c=(i=n==null?void 0:n.disableStackTrace)!=null?i:l.spec.disableStackTrace;return new Promise((u,f)=>l._validate(s,n,(p,m)=>{Ms.isError(p)&&(p.value=m),f(p)},(p,m)=>{p.length?f(new Ms(p,m,void 0,void 0,c)):u(m)}))}validateSync(s,n){var i;let l=this.resolve(Object.assign({},n,{value:s})),c,u=(i=n==null?void 0:n.disableStackTrace)!=null?i:l.spec.disableStackTrace;return l._validate(s,Object.assign({},n,{sync:!0}),(f,p)=>{throw Ms.isError(f)&&(f.value=p),f},(f,p)=>{if(f.length)throw new Ms(f,s,void 0,void 0,u);c=p}),c}isValid(s,n){return this.validate(s,n).then(()=>!0,i=>{if(Ms.isError(i))return!1;throw i})}isValidSync(s,n){try{return this.validateSync(s,n),!0}catch(i){if(Ms.isError(i))return!1;throw i}}_getDefault(s){let n=this.spec.default;return n==null?n:typeof n=="function"?n.call(this,s):il(n)}getDefault(s){return this.resolve(s||{})._getDefault(s)}default(s){return arguments.length===0?this._getDefault():this.clone({default:s})}strict(s=!0){return this.clone({strict:s})}nullability(s,n){const i=this.clone({nullable:s});return i.internalTests.nullable=tl({message:n,name:"nullable",test(l){return l===null?this.schema.spec.nullable:!0}}),i}optionality(s,n){const i=this.clone({optional:s});return i.internalTests.optionality=tl({message:n,name:"optionality",test(l){return l===void 0?this.schema.spec.optional:!0}}),i}optional(){return this.optionality(!0)}defined(s=Xa.defined){return this.optionality(!1,s)}nullable(){return this.nullability(!0)}nonNullable(s=Xa.notNull){return this.nullability(!1,s)}required(s=Xa.required){return this.clone().withMutation(n=>n.nonNullable(s).defined(s))}notRequired(){return this.clone().withMutation(s=>s.nullable().optional())}transform(s){let n=this.clone();return n.transforms.push(s),n}test(...s){let n;if(s.length===1?typeof s[0]=="function"?n={test:s[0]}:n=s[0]:s.length===2?n={name:s[0],test:s[1]}:n={name:s[0],message:s[1],test:s[2]},n.message===void 0&&(n.message=Xa.default),typeof n.test!="function")throw new TypeError("`test` is a required parameters");let i=this.clone(),l=tl(n),c=n.exclusive||n.name&&i.exclusiveTests[n.name]===!0;if(n.exclusive&&!n.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return n.name&&(i.exclusiveTests[n.name]=!!n.exclusive),i.tests=i.tests.filter(u=>!(u.OPTIONS.name===n.name&&(c||u.OPTIONS.test===l.OPTIONS.test))),i.tests.push(l),i}when(s,n){!Array.isArray(s)&&typeof s!="string"&&(n=s,s=".");let i=this.clone(),l=zb(s).map(c=>new wr(c));return l.forEach(c=>{c.isSibling&&i.deps.push(c.key)}),i.conditions.push(typeof n=="function"?new nu(l,n):nu.fromOptions(l,n)),i}typeError(s){let n=this.clone();return n.internalTests.typeError=tl({message:s,name:"typeError",skipAbsent:!0,test(i){return this.schema._typeCheck(i)?!0:this.createError({params:{type:this.schema.type}})}}),n}oneOf(s,n=Xa.oneOf){let i=this.clone();return s.forEach(l=>{i._whitelist.add(l),i._blacklist.delete(l)}),i.internalTests.whiteList=tl({message:n,name:"oneOf",skipAbsent:!0,test(l){let c=this.schema._whitelist,u=c.resolveAll(this.resolve);return u.includes(l)?!0:this.createError({params:{values:Array.from(c).join(", "),resolved:u}})}}),i}notOneOf(s,n=Xa.notOneOf){let i=this.clone();return s.forEach(l=>{i._blacklist.add(l),i._whitelist.delete(l)}),i.internalTests.blacklist=tl({message:n,name:"notOneOf",test(l){let c=this.schema._blacklist,u=c.resolveAll(this.resolve);return u.includes(l)?this.createError({params:{values:Array.from(c).join(", "),resolved:u}}):!0}}),i}strip(s=!0){let n=this.clone();return n.spec.strip=s,n}describe(s){const n=(s?this.resolve(s):this).clone(),{label:i,meta:l,optional:c,nullable:u}=n.spec;return{meta:l,label:i,optional:c,nullable:u,default:n.getDefault(s),type:n.type,oneOf:n._whitelist.describe(),notOneOf:n._blacklist.describe(),tests:n.tests.map(p=>({name:p.OPTIONS.name,params:p.OPTIONS.params})).filter((p,m,y)=>y.findIndex(v=>v.name===p.name)===m)}}}Us.prototype.__isYupSchema__=!0;for(const t of["validate","validateSync"])Us.prototype[`${t}At`]=function(s,n,i={}){const{parent:l,parentPath:c,schema:u}=MI(this,s,n,i.context);return u[t](l&&l[c],Object.assign({},i,{parent:l,path:s}))};for(const t of["equals","is"])Us.prototype[t]=Us.prototype.oneOf;for(const t of["not","nope"])Us.prototype[t]=Us.prototype.notOneOf;const zI=()=>!0;function Lm(t){return new Ub(t)}class Ub extends Us{constructor(s){super(typeof s=="function"?{type:"mixed",check:s}:Object.assign({type:"mixed",check:zI},s))}}Lm.prototype=Ub.prototype;function Ra(){return new Pb}class Pb extends Us{constructor(){super({type:"boolean",check(s){return s instanceof Boolean&&(s=s.valueOf()),typeof s=="boolean"}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(i.spec.coerce&&!i.isType(s)){if(/^(true|1)$/i.test(String(s)))return!0;if(/^(false|0)$/i.test(String(s)))return!1}return s})})}isTrue(s=zm.isValue){return this.test({message:s,name:"is-value",exclusive:!0,params:{value:"true"},test(n){return $a(n)||n===!0}})}isFalse(s=zm.isValue){return this.test({message:s,name:"is-value",exclusive:!0,params:{value:"false"},test(n){return $a(n)||n===!1}})}default(s){return super.default(s)}defined(s){return super.defined(s)}optional(){return super.optional()}required(s){return super.required(s)}notRequired(){return super.notRequired()}nullable(){return super.nullable()}nonNullable(s){return super.nonNullable(s)}strip(s){return super.strip(s)}}Ra.prototype=Pb.prototype;const LI=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function BI(t){const s=Bm(t);if(!s)return Date.parse?Date.parse(t):Number.NaN;if(s.z===void 0&&s.plusMinus===void 0)return new Date(s.year,s.month,s.day,s.hour,s.minute,s.second,s.millisecond).valueOf();let n=0;return s.z!=="Z"&&s.plusMinus!==void 0&&(n=s.hourOffset*60+s.minuteOffset,s.plusMinus==="+"&&(n=0-n)),Date.UTC(s.year,s.month,s.day,s.hour,s.minute+n,s.second,s.millisecond)}function Bm(t){var s,n;const i=LI.exec(t);return i?{year:jn(i[1]),month:jn(i[2],1)-1,day:jn(i[3],1),hour:jn(i[4]),minute:jn(i[5]),second:jn(i[6]),millisecond:i[7]?jn(i[7].substring(0,3)):0,precision:(s=(n=i[7])==null?void 0:n.length)!=null?s:void 0,z:i[8]||void 0,plusMinus:i[9]||void 0,hourOffset:jn(i[10]),minuteOffset:jn(i[11])}:null}function jn(t,s=0){return Number(t)||s}let FI=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,UI=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,PI=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,qI="^\\d{4}-\\d{2}-\\d{2}",HI="\\d{2}:\\d{2}:\\d{2}",YI="(([+-]\\d{2}(:?\\d{2})?)|Z)",VI=new RegExp(`${qI}T${HI}(\\.\\d+)?${YI}$`),GI=t=>$a(t)||t===t.trim(),QI={}.toString();function Ce(){return new qb}class qb extends Us{constructor(){super({type:"string",check(s){return s instanceof String&&(s=s.valueOf()),typeof s=="string"}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(!i.spec.coerce||i.isType(s)||Array.isArray(s))return s;const l=s!=null&&s.toString?s.toString():s;return l===QI?s:l})})}required(s){return super.required(s).withMutation(n=>n.test({message:s||Xa.required,name:"required",skipAbsent:!0,test:i=>!!i.length}))}notRequired(){return super.notRequired().withMutation(s=>(s.tests=s.tests.filter(n=>n.OPTIONS.name!=="required"),s))}length(s,n=Is.length){return this.test({message:n,name:"length",exclusive:!0,params:{length:s},skipAbsent:!0,test(i){return i.length===this.resolve(s)}})}min(s,n=Is.min){return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i.length>=this.resolve(s)}})}max(s,n=Is.max){return this.test({name:"max",exclusive:!0,message:n,params:{max:s},skipAbsent:!0,test(i){return i.length<=this.resolve(s)}})}matches(s,n){let i=!1,l,c;return n&&(typeof n=="object"?{excludeEmptyString:i=!1,message:l,name:c}=n:l=n),this.test({name:c||"matches",message:l||Is.matches,params:{regex:s},skipAbsent:!0,test:u=>u===""&&i||u.search(s)!==-1})}email(s=Is.email){return this.matches(FI,{name:"email",message:s,excludeEmptyString:!0})}url(s=Is.url){return this.matches(UI,{name:"url",message:s,excludeEmptyString:!0})}uuid(s=Is.uuid){return this.matches(PI,{name:"uuid",message:s,excludeEmptyString:!1})}datetime(s){let n="",i,l;return s&&(typeof s=="object"?{message:n="",allowOffset:i=!1,precision:l=void 0}=s:n=s),this.matches(VI,{name:"datetime",message:n||Is.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:n||Is.datetime_offset,params:{allowOffset:i},skipAbsent:!0,test:c=>{if(!c||i)return!0;const u=Bm(c);return u?!!u.z:!1}}).test({name:"datetime_precision",message:n||Is.datetime_precision,params:{precision:l},skipAbsent:!0,test:c=>{if(!c||l==null)return!0;const u=Bm(c);return u?u.precision===l:!1}})}ensure(){return this.default("").transform(s=>s===null?"":s)}trim(s=Is.trim){return this.transform(n=>n!=null?n.trim():n).test({message:s,name:"trim",test:GI})}lowercase(s=Is.lowercase){return this.transform(n=>$a(n)?n:n.toLowerCase()).test({message:s,name:"string_case",exclusive:!0,skipAbsent:!0,test:n=>$a(n)||n===n.toLowerCase()})}uppercase(s=Is.uppercase){return this.transform(n=>$a(n)?n:n.toUpperCase()).test({message:s,name:"string_case",exclusive:!0,skipAbsent:!0,test:n=>$a(n)||n===n.toUpperCase()})}}Ce.prototype=qb.prototype;let XI=t=>t!=+t;function Pa(){return new Hb}class Hb extends Us{constructor(){super({type:"number",check(s){return s instanceof Number&&(s=s.valueOf()),typeof s=="number"&&!XI(s)}}),this.withMutation(()=>{this.transform((s,n,i)=>{if(!i.spec.coerce)return s;let l=s;if(typeof l=="string"){if(l=l.replace(/\s/g,""),l==="")return NaN;l=+l}return i.isType(l)||l===null?l:parseFloat(l)})})}min(s,n=rr.min){return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i>=this.resolve(s)}})}max(s,n=rr.max){return this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(i){return i<=this.resolve(s)}})}lessThan(s,n=rr.lessThan){return this.test({message:n,name:"max",exclusive:!0,params:{less:s},skipAbsent:!0,test(i){return i<this.resolve(s)}})}moreThan(s,n=rr.moreThan){return this.test({message:n,name:"min",exclusive:!0,params:{more:s},skipAbsent:!0,test(i){return i>this.resolve(s)}})}positive(s=rr.positive){return this.moreThan(0,s)}negative(s=rr.negative){return this.lessThan(0,s)}integer(s=rr.integer){return this.test({name:"integer",message:s,skipAbsent:!0,test:n=>Number.isInteger(n)})}truncate(){return this.transform(s=>$a(s)?s:s|0)}round(s){var n;let i=["ceil","floor","round","trunc"];if(s=((n=s)==null?void 0:n.toLowerCase())||"round",s==="trunc")return this.truncate();if(i.indexOf(s.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+i.join(", "));return this.transform(l=>$a(l)?l:Math[s](l))}}Pa.prototype=Hb.prototype;let Yb=new Date(""),ZI=t=>Object.prototype.toString.call(t)==="[object Date]";function As(){return new cc}class cc extends Us{constructor(){super({type:"date",check(s){return ZI(s)&&!isNaN(s.getTime())}}),this.withMutation(()=>{this.transform((s,n,i)=>!i.spec.coerce||i.isType(s)||s===null?s:(s=BI(s),isNaN(s)?cc.INVALID_DATE:new Date(s)))})}prepareParam(s,n){let i;if(wr.isRef(s))i=s;else{let l=this.cast(s);if(!this._typeCheck(l))throw new TypeError(`\`${n}\` must be a Date or a value that can be \`cast()\` to a Date`);i=l}return i}min(s,n=Mm.min){let i=this.prepareParam(s,"min");return this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(l){return l>=this.resolve(i)}})}max(s,n=Mm.max){let i=this.prepareParam(s,"max");return this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(l){return l<=this.resolve(i)}})}}cc.INVALID_DATE=Yb;As.prototype=cc.prototype;As.INVALID_DATE=Yb;function WI(t,s=[]){let n=[],i=new Set,l=new Set(s.map(([u,f])=>`${u}-${f}`));function c(u,f){let p=ri.split(u)[0];i.add(p),l.has(`${f}-${p}`)||n.push([f,p])}for(const u of Object.keys(t)){let f=t[u];i.add(u),wr.isRef(f)&&f.isSibling?c(f.path,u):Cu(f)&&"deps"in f&&f.deps.forEach(p=>c(p,u))}return EI.array(Array.from(i),n).reverse()}function Tj(t,s){let n=1/0;return t.some((i,l)=>{var c;if((c=s.path)!=null&&c.includes(i))return n=l,!0}),n}function Vb(t){return(s,n)=>Tj(t,s)-Tj(t,n)}const Gb=(t,s,n)=>{if(typeof t!="string")return t;let i=t;try{i=JSON.parse(t)}catch{}return n.isType(i)?i:t};function Hd(t){if("fields"in t){const s={};for(const[n,i]of Object.entries(t.fields))s[n]=Hd(i);return t.setFields(s)}if(t.type==="array"){const s=t.optional();return s.innerType&&(s.innerType=Hd(s.innerType)),s}return t.type==="tuple"?t.optional().clone({types:t.spec.types.map(Hd)}):"optional"in t?t.optional():t}const KI=(t,s)=>{const n=[...ri.normalizePath(s)];if(n.length===1)return n[0]in t;let i=n.pop(),l=ri.getter(ri.join(n),!0)(t);return!!(l&&i in l)};let Ej=t=>Object.prototype.toString.call(t)==="[object Object]";function Aj(t,s){let n=Object.keys(t.fields);return Object.keys(s).filter(i=>n.indexOf(i)===-1)}const JI=Vb([]);function at(t){return new Qb(t)}class Qb extends Us{constructor(s){super({type:"object",check(n){return Ej(n)||typeof n=="function"}}),this.fields=Object.create(null),this._sortErrors=JI,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{s&&this.shape(s)})}_cast(s,n={}){var i;let l=super._cast(s,n);if(l===void 0)return this.getDefault(n);if(!this._typeCheck(l))return l;let c=this.fields,u=(i=n.stripUnknown)!=null?i:this.spec.noUnknown,f=[].concat(this._nodes,Object.keys(l).filter(v=>!this._nodes.includes(v))),p={},m=Object.assign({},n,{parent:p,__validating:n.__validating||!1}),y=!1;for(const v of f){let j=c[v],N=v in l;if(j){let b,w=l[v];m.path=(n.path?`${n.path}.`:"")+v,j=j.resolve({value:w,context:n.context,parent:p});let A=j instanceof Us?j.spec:void 0,S=A==null?void 0:A.strict;if(A!=null&&A.strip){y=y||v in l;continue}b=!n.__validating||!S?j.cast(l[v],m):l[v],b!==void 0&&(p[v]=b)}else N&&!u&&(p[v]=l[v]);(N!==v in p||p[v]!==l[v])&&(y=!0)}return y?p:l}_validate(s,n={},i,l){let{from:c=[],originalValue:u=s,recursive:f=this.spec.recursive}=n;n.from=[{schema:this,value:u},...c],n.__validating=!0,n.originalValue=u,super._validate(s,n,i,(p,m)=>{if(!f||!Ej(m)){l(p,m);return}u=u||m;let y=[];for(let v of this._nodes){let j=this.fields[v];!j||wr.isRef(j)||y.push(j.asNestedTest({options:n,key:v,parent:m,parentPath:n.path,originalParent:u}))}this.runTests({tests:y,value:m,originalValue:u,options:n},i,v=>{l(v.sort(this._sortErrors).concat(p),m)})})}clone(s){const n=super.clone(s);return n.fields=Object.assign({},this.fields),n._nodes=this._nodes,n._excludedEdges=this._excludedEdges,n._sortErrors=this._sortErrors,n}concat(s){let n=super.concat(s),i=n.fields;for(let[l,c]of Object.entries(this.fields)){const u=i[l];i[l]=u===void 0?c:u}return n.withMutation(l=>l.setFields(i,[...this._excludedEdges,...s._excludedEdges]))}_getDefault(s){if("default"in this.spec)return super._getDefault(s);if(!this._nodes.length)return;let n={};return this._nodes.forEach(i=>{var l;const c=this.fields[i];let u=s;(l=u)!=null&&l.value&&(u=Object.assign({},u,{parent:u.value,value:u.value[i]})),n[i]=c&&"getDefault"in c?c.getDefault(u):void 0}),n}setFields(s,n){let i=this.clone();return i.fields=s,i._nodes=WI(s,n),i._sortErrors=Vb(Object.keys(s)),n&&(i._excludedEdges=n),i}shape(s,n=[]){return this.clone().withMutation(i=>{let l=i._excludedEdges;return n.length&&(Array.isArray(n[0])||(n=[n]),l=[...i._excludedEdges,...n]),i.setFields(Object.assign(i.fields,s),l)})}partial(){const s={};for(const[n,i]of Object.entries(this.fields))s[n]="optional"in i&&i.optional instanceof Function?i.optional():i;return this.setFields(s)}deepPartial(){return Hd(this)}pick(s){const n={};for(const i of s)this.fields[i]&&(n[i]=this.fields[i]);return this.setFields(n,this._excludedEdges.filter(([i,l])=>s.includes(i)&&s.includes(l)))}omit(s){const n=[];for(const i of Object.keys(this.fields))s.includes(i)||n.push(i);return this.pick(n)}from(s,n,i){let l=ri.getter(s,!0);return this.transform(c=>{if(!c)return c;let u=c;return KI(c,s)&&(u=Object.assign({},c),i||delete u[s],u[n]=l(c)),u})}json(){return this.transform(Gb)}exact(s){return this.test({name:"exact",exclusive:!0,message:s||Pd.exact,test(n){if(n==null)return!0;const i=Aj(this.schema,n);return i.length===0||this.createError({params:{properties:i.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(s=!0,n=Pd.noUnknown){typeof s!="boolean"&&(n=s,s=!0);let i=this.test({name:"noUnknown",exclusive:!0,message:n,test(l){if(l==null)return!0;const c=Aj(this.schema,l);return!s||c.length===0||this.createError({params:{unknown:c.join(", ")}})}});return i.spec.noUnknown=s,i}unknown(s=!0,n=Pd.noUnknown){return this.noUnknown(!s,n)}transformKeys(s){return this.transform(n=>{if(!n)return n;const i={};for(const l of Object.keys(n))i[s(l)]=n[l];return i})}camelCase(){return this.transformKeys(cm.camelCase)}snakeCase(){return this.transformKeys(cm.snakeCase)}constantCase(){return this.transformKeys(s=>cm.snakeCase(s).toUpperCase())}describe(s){const n=(s?this.resolve(s):this).clone(),i=super.describe(s);i.fields={};for(const[c,u]of Object.entries(n.fields)){var l;let f=s;(l=f)!=null&&l.value&&(f=Object.assign({},f,{parent:f.value,value:f.value[c]})),i.fields[c]=u.describe(f)}return i}}at.prototype=Qb.prototype;function es(t){return new Xb(t)}class Xb extends Us{constructor(s){super({type:"array",spec:{types:s},check(n){return Array.isArray(n)}}),this.innerType=void 0,this.innerType=s}_cast(s,n){const i=super._cast(s,n);if(!this._typeCheck(i)||!this.innerType)return i;let l=!1;const c=i.map((u,f)=>{const p=this.innerType.cast(u,Object.assign({},n,{path:`${n.path||""}[${f}]`}));return p!==u&&(l=!0),p});return l?c:i}_validate(s,n={},i,l){var c;let u=this.innerType,f=(c=n.recursive)!=null?c:this.spec.recursive;n.originalValue!=null&&n.originalValue,super._validate(s,n,i,(p,m)=>{var y;if(!f||!u||!this._typeCheck(m)){l(p,m);return}let v=new Array(m.length);for(let N=0;N<m.length;N++){var j;v[N]=u.asNestedTest({options:n,index:N,parent:m,parentPath:n.path,originalParent:(j=n.originalValue)!=null?j:s})}this.runTests({value:m,tests:v,originalValue:(y=n.originalValue)!=null?y:s,options:n},i,N=>l(N.concat(p),m))})}clone(s){const n=super.clone(s);return n.innerType=this.innerType,n}json(){return this.transform(Gb)}concat(s){let n=super.concat(s);return n.innerType=this.innerType,s.innerType&&(n.innerType=n.innerType?n.innerType.concat(s.innerType):s.innerType),n}of(s){let n=this.clone();if(!Cu(s))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+Dn(s));return n.innerType=s,n.spec=Object.assign({},n.spec,{types:s}),n}length(s,n=qd.length){return this.test({message:n,name:"length",exclusive:!0,params:{length:s},skipAbsent:!0,test(i){return i.length===this.resolve(s)}})}min(s,n){return n=n||qd.min,this.test({message:n,name:"min",exclusive:!0,params:{min:s},skipAbsent:!0,test(i){return i.length>=this.resolve(s)}})}max(s,n){return n=n||qd.max,this.test({message:n,name:"max",exclusive:!0,params:{max:s},skipAbsent:!0,test(i){return i.length<=this.resolve(s)}})}ensure(){return this.default(()=>[]).transform((s,n)=>this._typeCheck(s)?s:n==null?[]:[].concat(n))}compact(s){let n=s?(i,l,c)=>!s(i,l,c):i=>!!i;return this.transform(i=>i!=null?i.filter(n):i)}describe(s){const n=(s?this.resolve(s):this).clone(),i=super.describe(s);if(n.innerType){var l;let c=s;(l=c)!=null&&l.value&&(c=Object.assign({},c,{parent:c.value,value:c.value[0]})),i.innerType=n.innerType.describe(c)}return i}}es.prototype=Xb.prototype;const iu=/^05\d{8}$/,lu=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Zb=at({instrumentName:Ce().oneOf(Au,"כלי נגינה לא תקין"),isPrimary:Ra(),currentStage:Pa().min(1,"שלב חייב להיות מספר בין 1 ל-8").max(8,"שלב חייב להיות מספר בין 1 ל-8"),tests:at({stageTest:at({status:Ce().oneOf(Rm,"סטטוס מבחן לא תקין"),notes:Ce(),lastTestDate:As().nullable(),nextTestDate:As().nullable()}),technicalTest:at({status:Ce().oneOf(Rm,"סטטוס מבחן לא תקין"),notes:Ce(),lastTestDate:As().nullable(),nextTestDate:As().nullable()})})}),Wb=at({teacherId:Ce(),day:Ce().oneOf(oI,"יום לא תקין"),time:Ce().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין"),duration:Pa().oneOf(cI,"משך שיעור לא תקין")}),e$=(t=!1,s=!1)=>at({personalInfo:at({fullName:Ce().required("שם מלא הוא שדה חובה"),phone:Ce().required("טלפון הוא שדה חובה").matches(iu,{message:"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),age:Pa().nullable().transform((n,i)=>i===""||i===null||i===void 0?null:n).min(5,"גיל מינימלי הוא 5").max(99,"גיל מקסימלי הוא 99"),address:Ce().required("כתובת היא שדה חובה"),parentName:Ce(),parentPhone:Ce().nullable().transform(n=>n||null).matches(iu,{message:"מספר טלפון הורה לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),parentEmail:Ce().nullable().transform(n=>n||null).matches(lu,{message:"כתובת אימייל הורה לא תקינה",excludeEmptyString:!0}),studentEmail:Ce().nullable().transform(n=>n||null).matches(lu,{message:"כתובת אימייל תלמיד לא תקינה",excludeEmptyString:!0})}),academicInfo:at({instrumentProgress:es().of(Zb),class:t||s?Ce().nullable().transform(n=>n||null).oneOf([...Qo,null],"כיתה לא תקינה"):Ce().required("כיתה היא שדה חובה").oneOf(Qo,"כיתה לא תקינה")}),teacherAssignments:es().of(Wb),orchestraAssignments:es().of(at({orchestraId:Ce()})),isActive:Ra()});at({personalInfo:at({fullName:Ce().required("שם מלא הוא שדה חובה"),phone:Ce().required("טלפון הוא שדה חובה").matches(iu,{message:"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),age:Pa().nullable().transform((t,s)=>s===""||s===null||s===void 0?null:t).min(5,"גיל מינימלי הוא 5").max(99,"גיל מקסימלי הוא 99"),address:Ce().required("כתובת היא שדה חובה"),parentName:Ce(),parentPhone:Ce().nullable().transform(t=>t||null).matches(iu,{message:"מספר טלפון הורה לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)",excludeEmptyString:!0}),parentEmail:Ce().nullable().transform(t=>t||null).matches(lu,{message:"כתובת אימייל הורה לא תקינה",excludeEmptyString:!0}),studentEmail:Ce().nullable().transform(t=>t||null).matches(lu,{message:"כתובת אימייל תלמיד לא תקינה",excludeEmptyString:!0})}),academicInfo:at({instrumentProgress:es().of(Zb),class:Ce().required("כיתה היא שדה חובה").oneOf(Qo,"כיתה לא תקינה")}),teacherAssignments:es().of(Wb),orchestraAssignments:es().of(at({orchestraId:Ce()})),isActive:Ra()});const t$=({onClose:t,onStudentCreated:s,onError:n}={})=>{const[i,l]=x.useState(!1),[c,u]=x.useState(null),{addToast:f}=Ot(),[p,m]=x.useState(null),y=async(j,N)=>{var b,w,A,S,C,D,I,T,R,E,_;l(!0),u(null);try{console.log("Starting saveStudentData with:",{studentId:j._id,teacherAssignments:N.teacherAssignments.length,teacherIds:N.teacherIds});const k=Array.isArray(N.teacherIds)?[...new Set(N.teacherIds.filter(Boolean))]:[];console.log("TeacherIds after processing:",k);const z={...j,teacherIds:k,teacherAssignments:N.teacherAssignments||[],enrollments:{...N.enrollments,orchestraIds:N.orchestraAssignments.map(X=>X.orchestraId)}};console.log("API data being sent:",{teacherIds:z.teacherIds,teacherAssignments:z.teacherAssignments,teacherAssignmentsLength:N.teacherAssignments.length,note:"teacherAssignments included in API - backend now supports this field"});let M;j._id?(console.log(`UPDATING existing student with ID: ${j._id}`),M=await ot.updateStudent(j._id,z)):(console.log("Creating NEW student"),M=await ot.addStudent(z)),console.log(`${j._id?"Updated":"New"} student ${M._id} created successfully:`,M),m(M),s&&s(M),t&&t();const G=j._id?`התלמיד ${(b=M.personalInfo)==null?void 0:b.fullName} עודכן בהצלחה`:`התלמיד ${(w=M.personalInfo)==null?void 0:w.fullName} נוסף בהצלחה`;return f({type:"success",message:G,onUndo:j._id?void 0:()=>v(M._id)}),l(!1),M}catch(k){console.error("💥 Error saving student data:",k),console.error("📊 Student data that failed to save:",{studentId:j._id,teacherAssignments:((A=N.teacherAssignments)==null?void 0:A.length)||0,teacherIds:((S=N.teacherIds)==null?void 0:S.length)||0,orchestraAssignments:((C=N.orchestraAssignments)==null?void 0:C.length)||0,isUpdate:!!j._id}),(((D=k==null?void 0:k.response)==null?void 0:D.status)===500||(k==null?void 0:k.status)===500)&&console.error("🚨 500 Internal Server Error Details:",{url:((I=k==null?void 0:k.config)==null?void 0:I.url)||"unknown",method:((T=k==null?void 0:k.config)==null?void 0:T.method)||"unknown",data:(R=k==null?void 0:k.config)!=null&&R.data?JSON.parse(k.config.data):"no data",response:((E=k==null?void 0:k.response)==null?void 0:E.data)||"no response data"});const z=ts(k),M=new Error(z.userMessage);u(M),l(!1);const G=((_=k==null?void 0:k.response)==null?void 0:_.status)===500?"שגיאת שרת (500). נמצאת בעיה בעיבוד הנתונים. אנא בדוק את הקונסול ונסה שוב.":z.userMessage;throw f({type:"danger",message:G,autoCloseTime:8e3}),n&&n(M),M}},v=async j=>{if(j)try{await ot.removeStudent(j),f({type:"info",message:"הוספת התלמיד בוטלה בהצלחה"}),m(null)}catch(N){console.error("Error undoing student creation:",N);const b=ts(N);f({type:"danger",message:b.userMessage,autoCloseTime:5e3})}};return{isSubmitting:i,error:c,saveStudentData:y,lastSavedStudent:p}};function Kb({isOpen:t,onClose:s,student:n,onStudentCreated:i,newTeacherInfo:l}){const{currentSchoolYear:c}=za(),[u,f]=x.useState(null),{user:p,isAuthenticated:m}=ys(),{saveStudentData:y,isSubmitting:v,error:j}=t$({onClose:s,onStudentCreated:i}),N=Al(p,m),b=br(N),w=b.isAdmin(),A=!!(n!=null&&n._id),{modalProps:S,titleProps:C,descriptionProps:D}=Cl({isOpen:t,onClose:s,modalId:"student-form",restoreFocusOnClose:!0}),I=()=>{var E,_,k,z,M,G,X,W,te,L,J,K,le,O,U,Y,Z,H;if(n!=null&&n._id)return{_id:n._id,personalInfo:{fullName:((E=n.personalInfo)==null?void 0:E.fullName)||"",phone:((_=n.personalInfo)==null?void 0:_.phone)||"",age:(k=n.personalInfo)!=null&&k.age?n.personalInfo.age.toString():void 0,address:((z=n.personalInfo)==null?void 0:z.address)||"",parentName:((M=n.personalInfo)==null?void 0:M.parentName)||"",parentPhone:((G=n.personalInfo)==null?void 0:G.parentPhone)||"",parentEmail:((X=n.personalInfo)==null?void 0:X.parentEmail)||"",studentEmail:((W=n.personalInfo)==null?void 0:W.studentEmail)||""},academicInfo:{instrumentProgress:((te=n.academicInfo)==null?void 0:te.instrumentProgress)||[],class:((L=n.academicInfo)==null?void 0:L.class)||Qo[0]},enrollments:{orchestraIds:((J=n.enrollments)==null?void 0:J.orchestraIds)||[],ensembleIds:((K=n.enrollments)==null?void 0:K.ensembleIds)||[],schoolYears:((le=n.enrollments)==null?void 0:le.schoolYears)||[],theoryLessonIds:((O=n.enrollments)==null?void 0:O.theoryLessonIds)||[]},teacherIds:n.teacherIds||[],teacherAssignments:(n.teacherAssignments||[]).map(P=>({...P,day:P.day,duration:P.duration})),orchestraAssignments:((Y=(U=n.enrollments)==null?void 0:U.orchestraIds)==null?void 0:Y.map(P=>({orchestraId:P})))||[],theoryLessonAssignments:((H=(Z=n.enrollments)==null?void 0:Z.theoryLessonIds)==null?void 0:H.map(P=>({theoryLessonId:P})))||[],isActive:n.isActive!==!1};{const P={personalInfo:{fullName:"",phone:"",age:"",address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[],class:"א"},enrollments:{orchestraIds:[],ensembleIds:[],schoolYears:[],theoryLessonIds:[]},teacherIds:[],teacherAssignments:[],orchestraAssignments:[],theoryLessonAssignments:[],isActive:!0};return c&&(P.enrollments.schoolYears=[{schoolYearId:c._id,isActive:!0}]),P}},T=async(E,_)=>{var k,z;console.log("🚀 StudentForm.handleSubmit called");try{f(null),n!=null&&n._id?b.validateAction("update",n,"student"):b.validateAction("add",void 0,"student");const M=(E.teacherAssignments||[]).filter(te=>{const L=te.teacherId&&te.day&&te.time&&te.duration&&typeof te.duration=="number"&&[30,45,60].includes(te.duration);return L||console.warn("🚨 Filtering out invalid teacher assignment:",te),L}),G=(E.teacherIds||[]).filter(Boolean);console.log("✅ Validation results:",{originalAssignments:((k=E.teacherAssignments)==null?void 0:k.length)||0,validAssignments:M.length,originalTeacherIds:((z=E.teacherIds)==null?void 0:z.length)||0,validTeacherIds:G.length});const X={_id:E._id,personalInfo:{...E.personalInfo,age:E.personalInfo.age&&E.personalInfo.age!==""&&parseInt(E.personalInfo.age.toString())||void 0,parentName:E.personalInfo.parentName||"לא צוין",parentPhone:E.personalInfo.parentPhone||"0500000000",parentEmail:E.personalInfo.parentEmail||"parent@example.com",studentEmail:E.personalInfo.studentEmail||"student@example.com"},academicInfo:{instrumentProgress:E.academicInfo.instrumentProgress||[],class:E.academicInfo.class},isActive:E.isActive};console.log("📝 Submitting student with",M.length,"validated teacher assignments");const W={...E,teacherAssignments:M,teacherIds:G};await y(X,W),_.resetForm()}catch(M){console.error("Error during form submission:",M);const G=ts(M);f(G.userMessage),_.setSubmitting(!1)}},R=()=>{s()};return t?e.jsx(Ua,{isOpen:t,onClose:R,className:"student-form responsive-form",children:e.jsxs("div",{className:"form-modal",...S,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:R,"aria-label":"סגור",type:"button",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...C,children:n!=null&&n._id?"עריכת תלמיד":"הוספת תלמיד חדש"})]}),e.jsx("div",{...D,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי תלמיד קיים במערכת":"טופס הוספת תלמיד חדש למערכת"}),j&&e.jsx("div",{className:"error-message",children:j.message||String(j)}),u&&e.jsx("div",{className:"error-message",children:u}),e.jsx(yr,{initialValues:I(),validationSchema:e$(w,A),onSubmit:T,enableReinitialize:!0,validateOnMount:!0,validateOnChange:!0,children:({isSubmitting:E,errors:_,touched:k,isValid:z,values:M})=>e.jsxs(In,{children:[e.jsx("div",{className:"form-section-full-width",children:e.jsx(dI,{})}),e.jsx("div",{className:"form-section-full-width",children:e.jsx(gI,{newTeacherInfo:l})}),e.jsxs("div",{className:"form-sections-two-columns",children:[e.jsx("div",{className:"form-section-column",children:e.jsx(uI,{isEditMode:A})}),e.jsx("div",{className:"form-section-column",children:e.jsx(yI,{})})]}),e.jsx("div",{className:"form-section-full-width",children:e.jsx(bI,{})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",disabled:v||E,onClick:G=>{z||(_.academicInfo&&console.log("📚 Academic info validation errors:",_.academicInfo),_.personalInfo&&console.log("👤 Personal info validation errors:",_.personalInfo),_.teacherAssignments&&console.log("👨‍🏫 Teacher assignment validation errors:",_.teacherAssignments),alert("יש שגיאות בטופס. אנא בדוק את השדות המסומנים באדום ותקן אותם לפני השליחה."))},children:v||E?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:R,disabled:v||E,children:"ביטול"})]})]})})]})}):null}const Js=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},dm=t=>{const s=Math.floor(t/60),n=t%60;return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},s$=(t,s)=>{if(t.dayOfWeek!==s.dayOfWeek)return!1;const n=Js(t.startTime),i=Js(t.endTime),l=Js(s.startTime),c=Js(s.endTime);return n<c&&i>l},Od=t=>{const s=[];for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++)s$(t[n],t[i])&&s.push({slotA:t[n].id,slotB:t[i].id});return s},Jb=t=>$b[t],a$=(t,s)=>{const[n,i]=t.split(":").map(Number),c=n*60+i+s,u=Math.floor(c/60),f=c%60;return`${u.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},Nn=t=>{const s=Jb(t.day),n=a$(t.time,t.duration);return{id:t._id,teacherId:t.teacherId,teacherName:t.teacherName,studentId:t.studentId,studentName:t.studentName,dayOfWeek:s,startTime:t.time,endTime:n,duration:t.duration,location:t.location,notes:t.notes,isRecurring:!0,isActive:t.isActive,createdAt:t.createdAt,updatedAt:t.updatedAt}},Cj=(t,s,n)=>{const i={};for(let u=0;u<7;u++)i[u]=[];Object.entries(t.schedule).forEach(([u,f])=>{if(f&&f.length>0){const p=Jb(u);i[p]=f.map(Nn)}});const l=Object.values(i).flat(),c=l.filter(u=>u.studentId).length;return{teacherId:t.teacherId,teacherName:s||"מורה לא ידוע",instrument:n,weeklySchedule:i,totalSlots:l.length,occupiedSlots:c,availableSlots:l.length-c}},Id=t=>{const s=[];return Object.values(t).forEach(n=>{s.push(...n)}),s},Gs={async getTeacherWeeklySchedule(t,s=!0){try{const n=await ye.get(`schedule/teacher/${t}/weekly`,{includeStudentInfo:s});return Cj(n).weeklySchedule}catch(n){throw console.error("Failed to get teacher weekly schedule:",n),new Error("שגיאה בטעינת מערכת השעות של המורה")}},async getTeacherSchedule(t,s=!0){try{const n=await ye.get(`schedule/teacher/${t}`,{includeStudentInfo:s});return Cj(n)}catch(n){throw console.error("Failed to get teacher schedule:",n),new Error("שגיאה בטעינת מערכת השעות של המורה")}},async getAvailableSlots(t,s){var n;try{const i={teacherId:t,...s};let l=[];try{l=await ye.get(`schedule/teacher/${t}/available`,i)}catch{}if(l.length===0)try{const{teacherService:c}=await rl(async()=>{const{teacherService:p}=await Promise.resolve().then(()=>Ud);return{teacherService:p}},void 0),u=await c.getTeacherById(t),f=(u==null?void 0:u.timeBlocks)||((n=u==null?void 0:u.teaching)==null?void 0:n.timeBlocks);if(u&&f&&f.length>0)return f.flatMap(m=>{var A,S;const y=(s==null?void 0:s.duration)||60,v=m.totalDuration||0,j=Math.floor(v/y),N=[],w={ראשון:0,שני:1,שלישי:2,רביעי:3,חמישי:4,שישי:5,שבת:6}[m.day]??0;for(let C=0;C<j;C++){const[D,I]=m.startTime.split(":").map(Number),T=D*60+I+C*y,R=T+y,[E,_]=m.endTime.split(":").map(Number),k=E*60+_;if(R<=k){const z=Math.floor(T/60),M=T%60,G=Math.floor(R/60),X=R%60,W=`${z.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`,te=`${G.toString().padStart(2,"0")}:${X.toString().padStart(2,"0")}`;N.push({id:`${m._id}-slot-${C}`,teacherId:t,teacherName:((A=u.personalInfo)==null?void 0:A.fullName)||"",dayOfWeek:w,startTime:W,endTime:te,duration:y,location:m.location||"",isRecurring:((S=m.recurring)==null?void 0:S.isRecurring)||!1,isActive:m.isActive,studentId:void 0,studentName:void 0,notes:m.notes||""})}}return N})}catch(c){console.warn("Failed to load time blocks, using empty slots array:",c)}return l.map(Nn)}catch(i){throw console.error("Failed to get available slots:",i),new Error("שגיאה בטעינת השעות הזמינות")}},async createScheduleSlot(t,s){try{const n=await ye.post(`schedule/teacher/${t}/slot`,s);return Nn(n)}catch(n){throw console.error("Failed to create schedule slot:",n),new Error("שגיאה ביצירת משבצת זמן חדשה")}},async updateScheduleSlot(t,s){try{const n=await ye.put(`schedule/slot/${t}`,s);return Nn(n)}catch(n){throw console.error("Failed to update schedule slot:",n),new Error("שגיאה בעדכון משבצת הזמן")}},async deleteScheduleSlot(t){try{return await ye.delete(`schedule/slot/${t}`),!0}catch(s){throw console.error("Failed to delete schedule slot:",s),new Error("שגיאה במחיקת משבצת הזמן")}},async assignStudentToSlot(t){try{const s=await ye.post("schedule/assign",t);return Nn(s)}catch(s){throw console.error("Failed to assign student to slot:",s),new Error("שגיאה בשיוך התלמיד למשבצת הזמן")}},async removeStudentFromSlot(t){try{const s=await ye.delete(`schedule/assign/${t}`);return Nn(s)}catch(s){throw console.error("Failed to remove student from slot:",s),new Error("שגיאה בהסרת התלמיד ממשבצת הזמן")}},async getStudentSchedule(t){try{return await ye.get(`schedule/student/${t}`)}catch(s){throw console.error("Failed to get student schedule:",s),new Error("שגיאה בטעינת מערכת השעות של התלמיד")}},async searchScheduleSlots(t){try{return(await ye.get("schedule/search",t)).map(Nn)}catch(s){throw console.error("Failed to search schedule slots:",s),new Error("שגיאה בחיפוש משבצות זמן")}},async getScheduleConflicts(t){try{return(await ye.get(`schedule/teacher/${t}/conflicts`)).map(Nn)}catch(s){throw console.error("Failed to get schedule conflicts:",s),new Error("שגיאה בטעינת התנגשויות במערכת השעות")}},async bulkAssignStudents(t){try{return(await ye.post("schedule/bulk-assign",{assignments:t})).slots.map(Nn)}catch(s){throw console.error("Failed to bulk assign students:",s),new Error("שגיאה בשיוך מרובה של תלמידים")}},async getTeacherScheduleStats(t){try{return await ye.get(`schedule/teacher/${t}/stats`)}catch(s){throw console.error("Failed to get teacher schedule stats:",s),new Error("שגיאה בטעינת סטטיסטיקות מערכת השעות")}}},sl={async createTimeBlock(t,s){try{const[n,i]=s.startTime.split(":").map(Number),[l,c]=s.endTime.split(":").map(Number),u=l*60+c-(n*60+i),f={יום:s.day,שעה:s.startTime,"משך השיעור":u,מיקום:s.location||"",הערות:s.notes||""},p=await ye.post(`schedule/teacher/${t}/slot`,f);return{_id:p._id||p.id||`temp-${Date.now()}`,teacherId:t,day:s.day,startTime:s.startTime,endTime:s.endTime,location:s.location,notes:s.notes,isActive:!0,assignedLessons:[],availableMinutes:u,utilizationPercentage:0,createdAt:new Date,updatedAt:new Date}}catch(n){throw console.error("Failed to create time block:",n),new Error("שגיאה ביצירת יום לימוד חדש")}},calculateAvailableMinutes(t,s){const[n,i]=t.split(":").map(Number),[l,c]=s.split(":").map(Number),u=n*60+i;return l*60+c-u},async updateTimeBlock(t,s){try{return await ye.put(`schedule/time-block/${t}`,s)}catch(n){throw console.error("Failed to update time block:",n),new Error("שגיאה בעדכון יום הלימוד")}},async deleteTimeBlock(t){try{return await ye.delete(`schedule/time-block/${t}`)}catch(s){throw console.error("Failed to delete time block:",s),new Error("שגיאה במחיקת יום הלימוד")}},async getTeacherTimeBlocks(t,s=!0){try{return await ye.get(`schedule/teacher/${t}/time-blocks`,{includeStats:s})}catch(n){throw console.error("Failed to get teacher time blocks:",n),new Error("שגיאה בטעינת ימי הלימוד של המורה")}},async getAvailableSlotsEnhanced(t){try{return await ye.get(`schedule/teacher/${t.teacherId}/available-slots-enhanced`,t)}catch(s){throw console.error("Failed to get enhanced available slots:",s),new Error("שגיאה בטעינת השעות הזמינות המשופרות")}},async calculateDynamicSlots(t,s,n){try{const l=(await this.getTeacherTimeBlocks(t)).timeBlocks,c=[];for(const u of l){const f=this.calculateSlotsFromTimeBlock(u,s);c.push(...f)}return c.sort((u,f)=>f.optimalScore-u.optimalScore)}catch(i){return console.error("Failed to calculate dynamic slots:",i),[]}},calculateSlotsFromTimeBlock(t,s){const n=[],i=Js(t.startTime),l=Js(t.endTime);if(l-i<s)return n;const u=[...t.assignedLessons||[]].sort((m,y)=>Js(m.lessonStartTime)-Js(y.lessonStartTime));let f=i;for(const m of u){const y=Js(m.lessonStartTime),v=Js(m.lessonEndTime);if(y-f>=s){const N=this.generateSlotsInRange(f,y,s,t);n.push(...N)}f=v}if(l-f>=s){const m=this.generateSlotsInRange(f,l,s,t);n.push(...m)}return n},generateSlotsInRange(t,s,n,i){const l=[];for(let u=t;u+n<=s;u+=15){const f=dm(u),p=dm(u+n),m=u-t,y=s-(u+n);let v=50;m>=15&&m<=30&&(v+=20),y>=15&&y<=30&&(v+=20),m>0&&y>0&&(v+=10),n>=60&&(v+=10),v+=Math.random()*5;const j={timeBlockId:i._id,possibleStartTime:f,possibleEndTime:p,duration:n,teacherId:i.teacherId,day:i.day,location:i.location,optimalScore:Math.min(100,Math.round(v)),gapMinutesBefore:m,gapMinutesAfter:y};l.push(j)}return l},async assignLessonAndRefreshSlots(t){try{const s=dm(Js(t.lessonStartTime)+t.duration),n={timeBlockId:t.timeBlockId,studentId:t.studentId,lessonStartTime:t.lessonStartTime,duration:t.duration,notes:t.notes},i=await this.assignLessonToSlot(n);if(!i.success)throw new Error("Failed to assign lesson");const l=i.updatedTimeBlock,c=this.calculateSlotsFromTimeBlock(l,t.duration);return{success:!0,assignment:i.assignment,updatedSlots:c,message:"השיעור נוסף בהצלחה והשעות הזמינות עודכנו"}}catch(s){throw console.error("Failed to assign lesson and refresh slots:",s),new Error("שגיאה בהקצאת השיעור")}},async assignLessonToSlot(t){try{return await ye.post("schedule/assign-lesson",t)}catch(s){throw console.error("Failed to assign lesson to slot:",s),new Error("שגיאה בשיוך השיעור ליום הלימוד")}},async rescheduleLesson(t){try{return await ye.put("schedule/reschedule-lesson",t)}catch(s){throw console.error("Failed to reschedule lesson:",s),new Error("שגיאה בשינוי מועד השיעור")}},async cancelLessonAssignment(t){try{return await ye.delete(`schedule/lesson-assignment/${t}`)}catch(s){throw console.error("Failed to cancel lesson assignment:",s),new Error("שגיאה בביטול שיוך השיעור")}},async findOptimalSlots(t,s){try{return await ye.post(`schedule/teacher/${t}/find-optimal-slots`,s)}catch(n){throw console.error("Failed to find optimal slots:",n),new Error("שגיאה במציאת השעות האופטימליות")}},async getTeacherScheduleStats(t,s){try{const n=s?{...s}:{};return await ye.get(`schedule/teacher/${t}/stats-enhanced`,n)}catch(n){throw console.error("Failed to get teacher schedule stats:",n),new Error("שגיאה בטעינת סטטיסטיקות מערכת השעות")}},async batchCreateTimeBlocks(t,s){try{return await ye.post(`schedule/teacher/${t}/time-blocks/batch`,{timeBlocks:s})}catch(n){throw console.error("Failed to batch create time blocks:",n),new Error("שגיאה ביצירה מרובה של ימי לימוד")}},async getOptimizationSuggestions(t){try{return await ye.get(`schedule/teacher/${t}/optimization-suggestions`)}catch(s){throw console.error("Failed to get optimization suggestions:",s),new Error("שגיאה בטעינת הצעות אופטימיזציה")}},async validateTimeBlock(t,s){try{return await ye.post("schedule/validate-time-block",{timeBlockData:t,existingBlocks:s})}catch(n){throw console.error("Failed to validate time block:",n),new Error("שגיאה בבדיקת תקינות יום הלימוד")}}},n$=5*60*1e3,r$=t=>Date.now()-t<n$;Ba((t,s)=>({currentTeacherSchedule:null,currentTeacherScheduleMetadata:null,availableSlots:[],selectedSlot:null,currentStudentSchedule:null,conflicts:[],lastConflictCheck:null,isLoadingTeacherSchedule:!1,isLoadingStudentSchedule:!1,isLoadingAvailableSlots:!1,isCreatingSlot:!1,isUpdatingSlot:!1,isAssigningStudent:!1,isCheckingConflicts:!1,error:null,errorDetails:null,cacheTimestamp:0,teacherTimeBlocks:{},selectedTimeBlock:null,timeBlockStats:{},availableTimeSlots:[],slotSearchCriteria:null,lastSearchResults:null,activeAssignments:[],assignmentConflicts:[],recentAssignmentHistory:[],selectedDuration:60,selectedDay:null,isCreatingTimeBlock:!1,isCalculatingSlots:!1,isAssigningLesson:!1,viewMode:"blocks",lastUpdated:{},pendingOperations:[],loadTeacherSchedule:async(n,i=!0)=>{const l=s();if(!(l.currentTeacherSchedule&&r$(l.cacheTimestamp)))try{t({isLoadingTeacherSchedule:!0,error:null});const c=await Gs.getTeacherWeeklySchedule(n,i),u=Id(c),f=Od(u);t({currentTeacherSchedule:c,isLoadingTeacherSchedule:!1,conflicts:f.map(p=>({type:"overlap",slotA:u.find(m=>m.id===p.slotA),slotB:u.find(m=>m.id===p.slotB),message:"משבצות זמן חופפות",severity:"error"})),cacheTimestamp:Date.now(),lastConflictCheck:new Date().toISOString()})}catch(c){console.error("Failed to load teacher schedule:",c),t({error:c instanceof Error?c.message:"שגיאה בטעינת מערכת השעות של המורה",errorDetails:c,isLoadingTeacherSchedule:!1})}},loadTeacherScheduleMetadata:async(n,i=!0)=>{try{t({isLoadingTeacherSchedule:!0,error:null});const l=await Gs.getTeacherSchedule(n,i);t({currentTeacherScheduleMetadata:l,currentTeacherSchedule:l.weeklySchedule,isLoadingTeacherSchedule:!1,cacheTimestamp:Date.now()})}catch(l){console.error("Failed to load teacher schedule metadata:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת נתוני מערכת השעות",errorDetails:l,isLoadingTeacherSchedule:!1})}},loadAvailableSlots:async(n,i)=>{try{t({isLoadingAvailableSlots:!0,error:null});const l=await Gs.getAvailableSlots(n,i);return t({availableSlots:l,isLoadingAvailableSlots:!1}),l}catch(l){return console.error("Failed to load available slots:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת השעות הזמינות",errorDetails:l,isLoadingAvailableSlots:!1}),[]}},createTimeSlot:async(n,i)=>{try{t({isCreatingSlot:!0,error:null});const l=await Gs.createScheduleSlot(n,i),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[];u[l.dayOfWeek]=[...f,l].sort((y,v)=>y.startTime.localeCompare(v.startTime));const p=Id(u),m=Od(p);t({currentTeacherSchedule:u,conflicts:m.map(y=>({type:"overlap",slotA:p.find(v=>v.id===y.slotA),slotB:p.find(v=>v.id===y.slotB),message:"משבצות זמן חופפות",severity:"error"})),isCreatingSlot:!1,cacheTimestamp:Date.now()})}else t({isCreatingSlot:!1});return l}catch(l){return console.error("Failed to create time slot:",l),t({error:l instanceof Error?l.message:"שגיאה ביצירת משבצת זמן חדשה",errorDetails:l,isCreatingSlot:!1}),null}},updateTimeSlot:async(n,i)=>{var l;try{t({isUpdatingSlot:!0,error:null});const c=await Gs.updateScheduleSlot(n,i),u=s().currentTeacherSchedule;if(u){const f={...u};Object.keys(f).forEach(v=>{const j=Number(v);f[j]=f[j].filter(N=>N.id!==n)});const p=f[c.dayOfWeek]||[];f[c.dayOfWeek]=[...p,c].sort((v,j)=>v.startTime.localeCompare(j.startTime));const m=Id(f),y=Od(m);t({currentTeacherSchedule:f,conflicts:y.map(v=>({type:"overlap",slotA:m.find(j=>j.id===v.slotA),slotB:m.find(j=>j.id===v.slotB),message:"משבצות זמן חופפות",severity:"error"})),isUpdatingSlot:!1,selectedSlot:((l=s().selectedSlot)==null?void 0:l.id)===n?c:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isUpdatingSlot:!1});return c}catch(c){return console.error("Failed to update time slot:",c),t({error:c instanceof Error?c.message:"שגיאה בעדכון משבצת הזמן",errorDetails:c,isUpdatingSlot:!1}),null}},deleteTimeSlot:async n=>{var i;try{t({isUpdatingSlot:!0,error:null}),await Gs.deleteScheduleSlot(n);const l=s().currentTeacherSchedule;if(l){const c={...l};Object.keys(c).forEach(p=>{const m=Number(p);c[m]=c[m].filter(y=>y.id!==n)});const u=Id(c),f=Od(u);t({currentTeacherSchedule:c,conflicts:f.map(p=>({type:"overlap",slotA:u.find(m=>m.id===p.slotA),slotB:u.find(m=>m.id===p.slotB),message:"משבצות זמן חופפות",severity:"error"})),isUpdatingSlot:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===n?null:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isUpdatingSlot:!1});return!0}catch(l){return console.error("Failed to delete time slot:",l),t({error:l instanceof Error?l.message:"שגיאה במחיקת משבצת הזמן",errorDetails:l,isUpdatingSlot:!1}),!1}},assignStudent:async n=>{var i;try{t({isAssigningStudent:!0,error:null});const l=await Gs.assignStudentToSlot(n),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[],p=f.findIndex(m=>m.id===l.id);if(p!==-1){const m=[...f];m[p]=l,u[l.dayOfWeek]=m}else u[l.dayOfWeek]=[...f,l].sort((m,y)=>m.startTime.localeCompare(y.startTime));t({currentTeacherSchedule:u,isAssigningStudent:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===l.id?l:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return l}catch(l){return console.error("Failed to assign student:",l),t({error:l instanceof Error?l.message:"שגיאה בשיוך התלמיד למשבצת הזמן",errorDetails:l,isAssigningStudent:!1}),null}},removeStudent:async n=>{var i;try{t({isAssigningStudent:!0,error:null});const l=await Gs.removeStudentFromSlot(n),c=s().currentTeacherSchedule;if(c){const u={...c},f=u[l.dayOfWeek]||[],p=f.findIndex(m=>m.id===l.id);if(p!==-1){const m=[...f];m[p]=l,u[l.dayOfWeek]=m}t({currentTeacherSchedule:u,isAssigningStudent:!1,selectedSlot:((i=s().selectedSlot)==null?void 0:i.id)===l.id?l:s().selectedSlot,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return l}catch(l){return console.error("Failed to remove student:",l),t({error:l instanceof Error?l.message:"שגיאה בהסרת התלמיד ממשבצת הזמן",errorDetails:l,isAssigningStudent:!1}),null}},bulkAssignStudents:async n=>{try{t({isAssigningStudent:!0,error:null});const i=await Gs.bulkAssignStudents(n),l=s().currentTeacherSchedule;if(l){const c={...l};i.forEach(u=>{const f=c[u.dayOfWeek]||[],p=f.findIndex(m=>m.id===u.id);if(p!==-1){const m=[...f];m[p]=u,c[u.dayOfWeek]=m}else c[u.dayOfWeek]=[...f,u].sort((m,y)=>m.startTime.localeCompare(y.startTime))}),t({currentTeacherSchedule:c,isAssigningStudent:!1,cacheTimestamp:Date.now()})}else t({isAssigningStudent:!1});return i}catch(i){return console.error("Failed to bulk assign students:",i),t({error:i instanceof Error?i.message:"שגיאה בשיוך מרובה של תלמידים",errorDetails:i,isAssigningStudent:!1}),[]}},loadStudentSchedule:async n=>{try{t({isLoadingStudentSchedule:!0,error:null});const i=await Gs.getStudentSchedule(n);t({currentStudentSchedule:i,isLoadingStudentSchedule:!1})}catch(i){console.error("Failed to load student schedule:",i),t({error:i instanceof Error?i.message:"שגיאה בטעינת מערכת השעות של התלמיד",errorDetails:i,isLoadingStudentSchedule:!1})}},checkScheduleConflicts:async n=>{if(n)try{t({isCheckingConflicts:!0,error:null});const l=(await Gs.getScheduleConflicts(n)).map(c=>({type:"overlap",slotA:c,message:"משבצת זמן עם התנגשות",severity:"error"}));t({conflicts:l,isCheckingConflicts:!1,lastConflictCheck:new Date().toISOString()})}catch(i){console.error("Failed to check schedule conflicts:",i),t({error:i instanceof Error?i.message:"שגיאה בבדיקת התנגשויות",errorDetails:i,isCheckingConflicts:!1})}},resolveConflict:async n=>{console.log("Resolving conflict:",n)},searchScheduleSlots:async n=>{try{return await Gs.searchScheduleSlots(n)}catch(i){return console.error("Failed to search schedule slots:",i),t({error:i instanceof Error?i.message:"שגיאה בחיפוש משבצות זמן",errorDetails:i}),[]}},setSelectedSlot:n=>{t({selectedSlot:n})},clearErrors:()=>{t({error:null,errorDetails:null})},clearCache:()=>{t({cacheTimestamp:0})},resetState:()=>{t({currentTeacherSchedule:null,currentTeacherScheduleMetadata:null,availableSlots:[],selectedSlot:null,currentStudentSchedule:null,conflicts:[],lastConflictCheck:null,isLoadingTeacherSchedule:!1,isLoadingStudentSchedule:!1,isLoadingAvailableSlots:!1,isCreatingSlot:!1,isUpdatingSlot:!1,isAssigningStudent:!1,isCheckingConflicts:!1,error:null,errorDetails:null,cacheTimestamp:0,teacherTimeBlocks:{},selectedTimeBlock:null,timeBlockStats:{},availableTimeSlots:[],slotSearchCriteria:null,lastSearchResults:null,activeAssignments:[],assignmentConflicts:[],recentAssignmentHistory:[],selectedDuration:60,selectedDay:null,isCreatingTimeBlock:!1,isCalculatingSlots:!1,isAssigningLesson:!1,viewMode:"blocks",lastUpdated:{},pendingOperations:[]})},getAvailableSlots:async(n,i)=>s().loadAvailableSlots(n,i),isSlotConflicting:n=>s().conflicts.some(l=>(typeof l.slotA=="string"?l.slotA===n.id:l.slotA.id===n.id)||l.slotB&&(typeof l.slotB=="string"?l.slotB===n.id:l.slotB.id===n.id)),getTeacherScheduleStats:async n=>{try{return await Gs.getTeacherScheduleStats(n)}catch(i){return console.error("Failed to get teacher schedule stats:",i),t({error:i instanceof Error?i.message:"שגיאה בטעינת סטטיסטיקות",errorDetails:i}),null}},createTimeBlock:async(n,i)=>{try{t({isCreatingTimeBlock:!0,error:null});const l=await sl.createTimeBlock(n,i),u=[...s().teacherTimeBlocks[n]||[],l].sort((f,p)=>{const m=Object.keys($b),y=m.indexOf(f.day),v=m.indexOf(p.day);return y!==v?y-v:f.startTime.localeCompare(p.startTime)});return t({teacherTimeBlocks:{...s().teacherTimeBlocks,[n]:u},isCreatingTimeBlock:!1,lastUpdated:{...s().lastUpdated,[n]:new Date}}),l}catch(l){return console.error("Failed to create time block:",l),t({error:l instanceof Error?l.message:"שגיאה ביצירת יום לימוד חדש",errorDetails:l,isCreatingTimeBlock:!1}),null}},updateTimeBlock:async(n,i)=>{var l;try{t({isCreatingTimeBlock:!0,error:null});const c=await sl.updateTimeBlock(n,i),u=s().teacherTimeBlocks,f=c.teacherId,m=(u[f]||[]).map(y=>y._id===n?c:y);return t({teacherTimeBlocks:{...u,[f]:m},selectedTimeBlock:((l=s().selectedTimeBlock)==null?void 0:l._id)===n?c:s().selectedTimeBlock,isCreatingTimeBlock:!1,lastUpdated:{...s().lastUpdated,[f]:new Date}}),c}catch(c){return console.error("Failed to update time block:",c),t({error:c instanceof Error?c.message:"שגיאה בעדכון יום הלימוד",errorDetails:c,isCreatingTimeBlock:!1}),null}},deleteTimeBlock:async n=>{var i;try{t({isCreatingTimeBlock:!0,error:null});const l=await sl.deleteTimeBlock(n);if(l.success){const c=s().teacherTimeBlocks,u={};Object.keys(c).forEach(f=>{u[f]=c[f].filter(p=>p._id!==n)}),t({teacherTimeBlocks:u,selectedTimeBlock:((i=s().selectedTimeBlock)==null?void 0:i._id)===n?null:s().selectedTimeBlock,isCreatingTimeBlock:!1})}return l.success}catch(l){return console.error("Failed to delete time block:",l),t({error:l instanceof Error?l.message:"שגיאה במחיקת יום הלימוד",errorDetails:l,isCreatingTimeBlock:!1}),!1}},loadTeacherTimeBlocks:async(n,i=!0)=>{try{t({isLoadingTeacherSchedule:!0,error:null});const l=await sl.getTeacherTimeBlocks(n,i);t({teacherTimeBlocks:{...s().teacherTimeBlocks,[n]:l.timeBlocks},timeBlockStats:i&&l.stats?{...s().timeBlockStats,[n]:l.stats}:s().timeBlockStats,isLoadingTeacherSchedule:!1,lastUpdated:{...s().lastUpdated,[n]:new Date}})}catch(l){console.error("Failed to load teacher time blocks:",l),t({error:l instanceof Error?l.message:"שגיאה בטעינת ימי הלימוד של המורה",errorDetails:l,isLoadingTeacherSchedule:!1})}},searchAvailableSlots:async n=>{try{t({isCalculatingSlots:!0,error:null});const i={...n,sortBy:"optimal"},l=await sl.getAvailableSlotsEnhanced(i);return t({availableTimeSlots:l.slots,slotSearchCriteria:n,lastSearchResults:l,isCalculatingSlots:!1}),l.slots}catch(i){return console.error("Failed to search available slots:",i),t({error:i instanceof Error?i.message:"שגיאה בחיפוש השעות הזמינות",errorDetails:i,isCalculatingSlots:!1}),[]}},assignLessonToTimeBlock:async n=>{try{t({isAssigningLesson:!0,error:null});const i={timeBlockId:n.timeBlockId,studentId:n.studentId,lessonStartTime:n.lessonStartTime,duration:n.duration},l=await sl.assignLessonToSlot(i);if(l.success){const c=s().teacherTimeBlocks,u=l.updatedTimeBlock.teacherId,p=(c[u]||[]).map(v=>v._id===n.timeBlockId?l.updatedTimeBlock:v),m=s().recentAssignmentHistory,y=[l.assignment,...m.slice(0,9)];return t({teacherTimeBlocks:{...c,[u]:p},activeAssignments:[...s().activeAssignments,l.assignment],recentAssignmentHistory:y,isAssigningLesson:!1,lastUpdated:{...s().lastUpdated,[u]:new Date}}),l.assignment}return null}catch(i){return console.error("Failed to assign lesson to time block:",i),t({error:i instanceof Error?i.message:"שגיאה בשיוך השיעור ליום הלימוד",errorDetails:i,isAssigningLesson:!1}),null}},setSelectedTimeBlock:n=>{t({selectedTimeBlock:n})},setSelectedDuration:n=>{t({selectedDuration:n})},setSelectedDay:n=>{t({selectedDay:n})},setViewMode:n=>{t({viewMode:n})}}));at().shape({dayOfWeek:Pa().required("Day of week is required").min(0,"Invalid day").max(6,"Invalid day"),startTime:Ce().required("Start time is required").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),endTime:Ce().required("End time is required").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)").test("is-after-start","End time must be after start time",function(t){const{startTime:s}=this.parent;if(!s||!t)return!0;const n=Js(s);return Js(t)>n}),location:Ce().nullable(),notes:Ce().nullable(),isRecurring:Ra().required("Please specify if this is a recurring slot")});at().shape({scheduleSlotId:Ce().required("Schedule slot is required"),studentId:Ce().required("Student is required")});function i$(){const{students:t,isLoading:s,error:n,loadStudents:i,removeStudent:l}=Ma(),{loadCurrentSchoolYear:c}=za(),[u,f]=x.useState(!1),[p,m]=x.useState(null),[y,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[A,S]=x.useState(!1),C=B=>[B.personalInfo.fullName,B.academicInfo.instrument,B.academicInfo.class,B.personalInfo.parentName||"",B.personalInfo.studentEmail||""].filter(ae=>typeof ae=="string"),{filteredEntities:D,handleSearch:I,filters:T,handleApplyFilters:R,hasActiveFilters:E,availableInstruments:_,classRange:k}=bu(t,C,B=>{const se=[];if(B.academicInfo.instrument&&se.push(B.academicInfo.instrument),B.academicInfo.instrumentProgress){const oe=B.academicInfo.instrumentProgress.map(ce=>ce.instrumentName).filter(Boolean);se.push(...oe)}const ae=[...new Set(se)];return ae.length>1?ae:ae[0]||""},B=>{var oe,ce;if(B.academicInfo.currentStage)return typeof B.academicInfo.currentStage=="number"?B.academicInfo.currentStage:parseInt(B.academicInfo.currentStage)||0;const se=(oe=B.academicInfo.instrumentProgress)==null?void 0:oe.find(Q=>Q.isPrimary);if(se!=null&&se.currentStage)return se.currentStage;const ae=(ce=B.academicInfo.instrumentProgress)==null?void 0:ce[0];return(ae==null?void 0:ae.currentStage)||0},B=>parseInt(B.academicInfo.class||"0")||0,B=>B.personalInfo.fullName),z=_t(),M=gs(),{user:G,isAuthenticated:X}=ys(),{addToast:W}=Ot(),te=Al(G,X),L=br(te);L.isAdmin();const J=M.pathname.includes("/students/")&&!M.pathname.endsWith("/students/");x.useEffect(()=>{i(),c()},[i,c]),x.useEffect(()=>{y&&i().then(()=>{console.log("Student list refreshed successfully"),v(!1)}).catch(B=>{console.error("Failed to refresh student list:",B),v(!1)})},[y,i]),x.useEffect(()=>{!J&&M.pathname==="/students"&&v(!0)},[M.pathname,J]),x.useEffect(()=>{const B=M.state;if(B!=null&&B.editStudentId){const se=t.find(ae=>ae._id===B.editStudentId)||null;m(se),f(!0),z("/students",{replace:!0,state:{}})}},[M.state,z,t]);const K=()=>{try{L.validateAction("add",void 0,"student"),m(null),f(!0)}catch(B){const se=ts(B);W({type:"warning",message:se.userMessage,autoCloseTime:4e3})}},le=x.useCallback(()=>{f(!1),m(null),v(!0)},[]),O=x.useCallback(()=>{console.log("Student created/updated, refreshing list"),v(!0)},[]),U=B=>{const se=t.find(ae=>ae._id===B)||null;if(se)try{L.validateAction("edit",se,"student"),m(se),f(!0)}catch(ae){const oe=ts(ae);W({type:"warning",message:oe.userMessage,autoCloseTime:4e3})}},Y=B=>{z(`/students/${B}`)},Z=B=>{const se=t.find(ae=>ae._id===B);if(se)try{L.validateAction("delete",se,"student"),w(B),N(!0)}catch(ae){const oe=ts(ae);W({type:"warning",message:oe.userMessage,autoCloseTime:4e3})}},H=async()=>{if(b)try{await l(b),w(null),v(!0),W({type:"success",message:"התלמיד נמחק בהצלחה",autoCloseTime:3e3})}catch(B){console.error("Failed to remove student:",B);const se=ts(B);W({type:"danger",message:se.userMessage,autoCloseTime:5e3})}},P=()=>{S(!A)},q=L.canAddStudent();return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!J&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(rc,{onSearch:I,placeholder:"חיפוש תלמידים..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${E?"active":""}`,onClick:P,"aria-label":"סנן תלמידים",children:[e.jsx(hi,{className:"icon"}),E&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:A,onToggle:()=>S(!A),onApplyFilters:R,availableInstruments:_,classRange:k||void 0,currentFilters:T,hasActiveFilters:E,entityType:"students"})]}),q&&e.jsx("button",{className:"btn-icon add-btn",onClick:K,"aria-label":"הוספת תלמיד חדש",children:e.jsx(fs,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!J&&e.jsx(GC,{students:D,isLoading:s,onEdit:U,onView:Y,onRemove:Z,authContext:te}),e.jsx(wl,{context:{loadStudents:i,refreshList:()=>v(!0)}}),e.jsx(Kb,{isOpen:u,onClose:le,onStudentCreated:O,student:p||void 0}),e.jsx(ps,{isOpen:j,onClose:()=>N(!1),onConfirm:H,title:"מחיקת תלמיד",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התלמיד?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}),!J&&!u&&e.jsx(mi,{})]})}function l$(){var me,je,Oe,De;const{studentId:t}=jr(),[s,n]=x.useState(null),{updateStudentStage:i}=Ma(),[l,c]=x.useState(!0),[u,f]=x.useState(null),[p,m]=x.useState(!1),[y,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState({}),A=be=>Object.keys(b).length===0?be:{...be,academicInfo:{...be.academicInfo,instrumentProgress:be.academicInfo.instrumentProgress.map(Te=>{const Be=b[Te.instrumentName];return Be!==void 0?{...Te,currentStage:Be}:Te})}},[S,C]=x.useState({teachers:[],assignments:[]}),[D,I]=x.useState(!1),[T,R]=x.useState(null),[E,_]=x.useState([]),[k,z]=x.useState(!1),[M,G]=x.useState([]),[X,W]=x.useState(!1),[te,L]=x.useState({instruments:!1,teachers:!1,orchestras:!1,tests:!1,bagrut:!1,attendance:!1,personalInfo:!0,parentInfo:!0,theoryLessons:!1,schedule:!0}),J=_t();x.useEffect(()=>{let be=!0;const Te=async()=>{var Be,V;c(!0),f(null);try{console.log(`Fetching student data for ID: ${t}`);const{students:ue,selectedStudent:ve}=Ma.getState(),Ne=ue.find(Ie=>Ie._id===t)||((ve==null?void 0:ve._id)===t?ve:null);let _e;if(Ne)console.log("Using student data from store (with local changes):",Ne),_e=Ne;else{console.log("Student not found in store, fetching from API");const Ie=await ot.getStudentById(t||"");_e=A(Ie)}if(!be)return;if(_e){console.log("Student data loaded successfully:",_e),n(_e),_e.teacherIds&&_e.teacherIds.length>0&&K(_e.teacherIds);const Ie=[..._e.academicInfo.orchestraIds||[],...((Be=_e.enrollments)==null?void 0:Be.orchestraIds)||[]].filter(Ue=>Ue);Ie.length>0&&U(Ie),(V=_e.enrollments)!=null&&V.theoryLessonIds&&_e.enrollments.theoryLessonIds.length>0&&O(_e.enrollments.theoryLessonIds)}else f("לא נמצא תלמיד")}catch(ue){if(console.error("Error fetching student:",ue),!be)return;f(ue instanceof Error?ue.message:"שגיאה בטעינת נתוני תלמיד")}finally{be&&c(!1)}};return t?(console.log("Student fetch effect running, studentId:",t),Te()):(f("חסר מספר מזהה של תלמיד"),c(!1)),()=>{be=!1}},[t]);const K=async be=>{if(!(!be||be.length===0)){I(!0),R(null);try{const Te=await Jt.getTeachersByIds(be);C({teachers:Te,assignments:[]})}catch(Te){console.error("Error loading teachers:",Te),R("שגיאה בטעינת נתוני מורים")}finally{I(!1)}}},le=()=>{s&&s.teacherIds&&K(s.teacherIds)},O=async be=>{if(!(!be||be.length===0)){W(!0);try{const Te=await Xs.getTheoryLessonsByIds(be);G(Te)}catch(Te){console.error("Error loading theory lessons:",Te)}finally{W(!1)}}},U=async be=>{if(!(!be||be.length===0)){z(!0);try{const Te=await Ia.getOrchestrasByIds(be);_(Te)}catch(Te){console.error("Error loading orchestras:",Te)}finally{z(!1)}}},Y=()=>{m(!p)},Z=()=>{J("/students")},H=be=>{L(Te=>({...Te,[be]:!Te[be]}))},P=be=>{J(`/teachers/${be}`)},q=be=>{J(`/orchestras/${be}`)},B=be=>{J(`/theory/${be}`)},se=()=>{s!=null&&s._id&&J("/students",{state:{editStudentId:s._id}})},ae=be=>be?be.split(" ").map(Te=>Te[0]).join("").substring(0,2):"",oe=be=>be?new Date(be).toLocaleDateString("he-IL"):"",ce=be=>{const Te=["#4D55CC","#6C63FF","#8A84FF","#A79DFF","#C2BAFF","#7952B3","#5E3B9A","#472980"];return Te[be-1]||Te[0]},Q=((je=(me=s==null?void 0:s.academicInfo)==null?void 0:me.instrumentProgress)==null?void 0:je.find(be=>be.isPrimary))||((De=(Oe=s==null?void 0:s.academicInfo)==null?void 0:Oe.instrumentProgress)==null?void 0:De[0])||null;return{student:s,isLoading:l,error:u,flipped:p,toggleFlip:Y,goBack:Z,getInitials:ae,getStageColor:ce,primaryInstrument:Q,openSections:te,toggleSection:H,formatDate:oe,navigateToTeacher:P,navigateToOrchestra:q,navigateToTheoryLesson:B,navigateToStudentEdit:se,teachersData:S,teachersLoading:D,teachersError:T,orchestras:E,orchestrasLoading:k,theoryLessons:M,theoryLessonsLoading:X,retryLoadTeachers:le,updateStudentTest:async(be,Te,Be)=>{var V,ue;if(!s||!t){console.error("Cannot update test: No student or studentId available");return}v(!0);try{console.log(`Updating ${Te} for ${be} to status: ${Be}`);const ve=Be,Ne=s.academicInfo.instrumentProgress.findIndex(Pt=>Pt.instrumentName===be);if(Ne===-1){console.error(`Instrument ${be} not found in student data`);return}const Ie=((ue=(V=s.academicInfo.instrumentProgress[Ne].tests)==null?void 0:V[Te])==null?void 0:ue.status)||"לא נבחן";console.log(`Previous status: ${Ie}, New status: ${Be}`);const Ue=JSON.parse(JSON.stringify(s));Ue.academicInfo.instrumentProgress[Ne].tests||(Ue.academicInfo.instrumentProgress[Ne].tests={}),Ue.academicInfo.instrumentProgress[Ne].tests[Te]||(Ue.academicInfo.instrumentProgress[Ne].tests[Te]={status:"לא נבחן",notes:""}),Ue.academicInfo.instrumentProgress[Ne].tests[Te].status=Be,Ue.academicInfo.instrumentProgress[Ne].tests[Te].lastTestDate=new Date().toISOString();const It=["עבר/ה","עבר/ה בהצטיינות","עבר/ה בהצטיינות יתרה"],qe=["לא נבחן","לא עבר/ה"],mt=Ue.academicInfo.instrumentProgress[Ne].currentStage;Te==="stageTest"&&It.includes(Be)&&qe.includes(Ie)&&mt<8&&(console.log(`Incrementing stage for ${be} from ${Ue.academicInfo.instrumentProgress[Ne].currentStage} to ${Ue.academicInfo.instrumentProgress[Ne].currentStage+1}`),Ue.academicInfo.instrumentProgress[Ne].currentStage+=1),n(Ue);const $t=await ot.updateStudentTest(t,be,Te,ve);return $t?(console.log("Server update successful, updating component state",$t),n($t),$t):(console.warn("Server returned empty result for test update"),Ue)}catch(ve){console.error("Error updating test status:",ve);return}finally{v(!1)}},isUpdatingTest:y,updateStudentStage:async(be,Te)=>{if(!s||!t){console.error("Cannot update stage: No student or studentId available");return}N(!0);try{console.log(`Updating stage for ${be} to ${Te}`);const Be=s.academicInfo.instrumentProgress.findIndex(Ie=>Ie.instrumentName===be);if(Be===-1){console.error(`Instrument ${be} not found in student data`);return}const ue=s.academicInfo.instrumentProgress[Be].currentStage;console.log(`Previous stage: ${ue}, New stage: ${Te}`),w(Ie=>({...Ie,[be]:Te})),t&&i(t,be,Te);const ve=A({...s,academicInfo:{...s.academicInfo,instrumentProgress:s.academicInfo.instrumentProgress.map(Ie=>Ie.instrumentName===be?{...Ie,currentStage:Te}:Ie)}});n(ve);const Ne=await ot.updateStudentStage(t,be,Te);console.log("Stage update successful:",Ne),w(Ie=>{const Ue={...Ie};return delete Ue[be],Ue});const _e=A(Ne);return n(_e),_e}catch(Be){if(console.error("Failed to update instrument stage:",Be),w(ue=>{const ve={...ue};return delete ve[be],ve}),t){const ue=s.academicInfo.instrumentProgress.find(ve=>ve.instrumentName===be);ue&&i(t,be,ue.currentStage)}const V=A(s);n(V),console.log("Reverted stage change due to error");return}finally{N(!1)}},isUpdatingStage:j}}function o$({student:t,isOpen:s,onToggle:n,getStageColor:i,updateStudentStage:l,isUpdatingStage:c=!1,canEditStage:u=!1}){const[f,p]=x.useState(null),m=[1,2,3,4,5,6,7,8],y=b=>{c||!u||p(f===b?null:b)},v=async(b,w)=>{if(c||!l)return;const A=t.academicInfo.instrumentProgress.find(S=>S.instrumentName===b);if(!A||A.currentStage===w){p(null);return}p(null);try{await l(b,w),console.log(`Updated stage for ${b} to ${w}`)}catch(S){console.error(`Failed to update stage for ${b}:`,S)}};if(!t||!t.academicInfo||!t.academicInfo.instrumentProgress)return null;const j=b=>b==="עבר/ה בהצטיינות יתרה"?"var(--success-emphasis)":b==="עבר/ה בהצטיינות"||b==="עבר/ה"?"var(--success)":b==="לא עבר/ה"?"var(--danger)":"var(--text-muted)",N=b=>b==="לא נבחן"?"not-tested":b==="לא עבר/ה"?"failed":b==="עבר/ה בהצטיינות יתרה"?"excellent-plus":b==="עבר/ה בהצטיינות"?"excellent":"passed";return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:"כלי נגינה"}),s?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsx("div",{className:"sd-section-content",children:t.academicInfo.instrumentProgress.length>0?e.jsx("div",{className:"sd-compact-instruments-list",children:t.academicInfo.instrumentProgress.map(b=>{var w,A,S,C,D,I,T,R,E,_,k,z,M,G,X,W,te,L,J,K;return e.jsxs("div",{className:"sd-compact-instrument-card",children:[e.jsxs("div",{className:"sd-instrument-header",children:[e.jsxs("div",{className:"sd-instrument-name-container",children:[e.jsx(Ke,{size:14,className:"sd-instrument-icon"}),e.jsx("span",{className:"sd-instrument-name",children:b.instrumentName}),b.isPrimary&&e.jsxs("span",{className:"sd-primary-badge",children:[e.jsx(li,{size:10})," ראשי"]})]}),e.jsxs("div",{className:"sd-stage-badge-container",children:[e.jsxs("div",{className:`sd-stage-badge ${u?"sd-clickable":""} ${c?"disabled":""}`,style:{backgroundColor:i(b.currentStage)},onClick:()=>y(b.instrumentName),children:["שלב ",b.currentStage]}),!c&&u&&f===b.instrumentName&&e.jsx("div",{className:"sd-stage-dropdown",children:m.map(le=>e.jsxs("div",{className:`sd-dropdown-item ${b.currentStage===le?"selected":""}`,onClick:()=>v(b.instrumentName,le),children:[b.currentStage===le&&e.jsx(li,{size:12}),"שלב ",le]},le))})]})]}),e.jsxs("div",{className:"sd-test-status-row",children:[e.jsxs("div",{className:"sd-test-item",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן טכני:"}),e.jsx("span",{className:`sd-test-value ${N(((A=(w=b.tests)==null?void 0:w.technicalTest)==null?void 0:A.status)||"לא נבחן")}`,style:{color:j(((C=(S=b.tests)==null?void 0:S.technicalTest)==null?void 0:C.status)||"לא נבחן")},children:((I=(D=b.tests)==null?void 0:D.technicalTest)==null?void 0:I.status)||"לא נבחן"})]}),e.jsxs("div",{className:"sd-test-item",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן שלב:"}),e.jsx("span",{className:`sd-test-value ${N(((R=(T=b.tests)==null?void 0:T.stageTest)==null?void 0:R.status)||"לא נבחן")}`,style:{color:j(((_=(E=b.tests)==null?void 0:E.stageTest)==null?void 0:_.status)||"לא נבחן")},children:((z=(k=b.tests)==null?void 0:k.stageTest)==null?void 0:z.status)||"לא נבחן"})]})]}),(((G=(M=b.tests)==null?void 0:M.stageTest)==null?void 0:G.notes)||((W=(X=b.tests)==null?void 0:X.technicalTest)==null?void 0:W.notes))&&e.jsx("div",{className:"sd-notes-row",children:e.jsx("span",{className:"sd-notes-text",children:((L=(te=b.tests)==null?void 0:te.stageTest)==null?void 0:L.notes)||((K=(J=b.tests)==null?void 0:J.technicalTest)==null?void 0:K.notes)})})]},b.instrumentName)})}):e.jsx("div",{className:"sd-no-data",children:"אין כלי נגינה"})})]})}function c$({student:t,isOpen:s,onToggle:n,formatDate:i}){var l,c;return!t||!t.personalInfo?null:e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"פרטים אישיים"})]}),s&&e.jsx("div",{className:"section-content",children:t.personalInfo.phone||t.personalInfo.address||t.personalInfo.studentEmail||t.createdAt||(l=t.academicInfo)!=null&&l.class?e.jsxs("div",{className:"info-grid",children:[t.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון"}),e.jsx("span",{className:"info-value",children:t.personalInfo.phone})]})]}),t.personalInfo.address&&e.jsxs("div",{className:"info-item",children:[e.jsx(gt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כתובת"}),e.jsx("span",{className:"info-value",children:t.personalInfo.address})]})]}),t.personalInfo.studentEmail&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל"}),e.jsx("span",{className:"info-value",children:t.personalInfo.studentEmail})]})]}),t.createdAt&&e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:i(t.createdAt)})]})]}),((c=t.academicInfo)==null?void 0:c.class)&&e.jsxs("div",{className:"info-item",children:[e.jsx(Zt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כיתה"}),e.jsx("span",{className:"info-value",children:t.academicInfo.class})]})]}),t.personalInfo.age!==void 0&&e.jsxs("div",{className:"info-item",children:[e.jsx(Je,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"גיל"}),e.jsx("span",{className:"info-value",children:t.personalInfo.age})]})]})]}):e.jsx("div",{className:"no-data-message",children:"אין פרטים אישיים"})})]})}function d$({student:t,isOpen:s,onToggle:n}){if(!t||!t.personalInfo)return null;const i=p=>p?!["לא צוין","0500000000","parent@example.com"].includes(p):!1,l=i(t.personalInfo.parentName),c=i(t.personalInfo.parentPhone),u=i(t.personalInfo.parentEmail),f=l||c||u;return e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"פרטי הורה"})]}),s&&e.jsx("div",{className:"section-content",children:f?e.jsxs("div",{className:"info-grid",children:[l&&e.jsxs("div",{className:"info-item",children:[e.jsx(Je,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"שם הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentName})]})]}),c&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentPhone})]})]}),u&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל הורה"}),e.jsx("span",{className:"info-value",children:t.personalInfo.parentEmail})]})]})]}):e.jsx("div",{className:"no-data-message",children:"אין פרטי הורה"})})]})}function u$({teachersData:t,teachersLoading:s,teachersError:n,isOpen:i,onToggle:l,onTeacherClick:c,onRetryLoadTeachers:u,studentTeacherIds:f=[],teacherAssignments:p=[]}){const m=x.useRef(!1),[y,v]=x.useState([]),j=(t==null?void 0:t.teachers)&&t.teachers.length>0||f&&f.length>0;x.useEffect(()=>{if(f&&f.length>0&&(!t.teachers||t.teachers.length===0)&&!s&&!m.current){const C=f.map(D=>({_id:D,teacherId:D,personalInfo:{fullName:`מורה ${D.slice(-4)}`},professionalInfo:{instrument:""},isPlaceholder:!0}));v(C),m.current=!0}},[f,t.teachers,s]),x.useEffect(()=>()=>{m.current=!1},[f.join(",")]);const N=C=>C?C.split(" ").map(D=>D[0]||"").join("").substring(0,2):"מ",b=C=>p.filter(D=>D.teacherId===C),w=(C,D)=>{const[I,T]=C.split(":").map(Number),R=I*60+T+D,E=Math.floor(R/60),_=R%60;return`${E.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`},A=(C,D)=>{const I=w(C,D);return`${C} - ${I}`},S=f&&f.length>0&&(!t.teachers||t.teachers.length===0)&&y.length>0;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Je,{size:16}),e.jsxs("span",{children:["מורים"," ",S?`(${f.length})`:t.teachers?`(${t.teachers.length})`:""]}),i?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:s?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען מורים..."})]}):n?e.jsxs("div",{className:"sd-error-state small",children:[e.jsx("p",{children:n}),e.jsx("button",{onClick:u,className:"sd-retry-btn",children:"נסה שוב"})]}):j?S?e.jsx("div",{className:"sd-teachers-grid",children:y.map((C,D)=>{var T,R;const I=b(C._id);return e.jsxs("div",{className:"sd-teacher-card sd-teacher-modern-card clickable",onClick:()=>c(C._id),children:[e.jsxs("div",{className:"sd-teacher-main",children:[e.jsxs("div",{className:"sd-teacher-identity",children:[e.jsx("div",{className:"sd-teacher-avatar",style:{backgroundColor:"#6c757d"},children:N(((T=C.personalInfo)==null?void 0:T.fullName)||"")}),e.jsxs("div",{className:"sd-teacher-info",children:[e.jsx("div",{className:"sd-teacher-name",children:((R=C.personalInfo)==null?void 0:R.fullName)||`מורה ${C._id.slice(-4)}`}),e.jsxs("div",{className:"sd-teacher-instrument",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:"כלי נגינה לא ידוע"})]})]})]}),e.jsx("button",{onClick:E=>{E.stopPropagation(),u()},className:"sd-load-details-btn",title:"טען פרטי מורה",children:e.jsx(Yt,{size:14})})]}),I.length>0&&e.jsxs("div",{className:"sd-teacher-lessons",children:[e.jsxs("div",{className:"sd-lessons-header",children:[e.jsx($e,{size:12}),e.jsxs("span",{children:["שיעורים (",I.length,")"]})]}),e.jsx("div",{className:"sd-lessons-list",children:I.map((E,_)=>e.jsxs("div",{className:"sd-lesson-item",children:[e.jsx("div",{className:"sd-lesson-day",children:E.day}),e.jsxs("div",{className:"sd-lesson-time",children:[e.jsx(Ve,{size:10}),e.jsx("span",{children:A(E.time,E.duration)})]}),e.jsxs("div",{className:"sd-lesson-duration",children:[E.duration,"ד'"]})]},`assignment-${_}`))})]})]},`teacher-id-${D}-${C._id}`)})}):e.jsx("div",{className:"sd-teachers-grid",children:t.teachers.map((C,D)=>{var T,R,E;const I=b(C._id);return e.jsxs("div",{className:"sd-teacher-card sd-teacher-modern-card clickable",onClick:()=>c(C._id),children:[e.jsxs("div",{className:"sd-teacher-main",children:[e.jsxs("div",{className:"sd-teacher-identity",children:[e.jsx("div",{className:"sd-teacher-avatar",style:{backgroundColor:"#4D55CC"},children:N(((T=C.personalInfo)==null?void 0:T.fullName)||"")}),e.jsxs("div",{className:"sd-teacher-info",children:[e.jsx("div",{className:"sd-teacher-name",children:((R=C.personalInfo)==null?void 0:R.fullName)||"מורה לא ידוע"}),e.jsxs("div",{className:"sd-teacher-instrument",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:((E=C.professionalInfo)==null?void 0:E.instrument)||"כלי נגינה לא ידוע"})]})]})]}),I.length>0&&e.jsx("div",{className:"sd-teacher-badge",children:e.jsxs("span",{children:[I.length," שיעורים"]})})]}),I.length>0&&e.jsxs("div",{className:"sd-teacher-lessons",children:[e.jsxs("div",{className:"sd-lessons-header",children:[e.jsx($e,{size:12}),e.jsx("span",{children:"מערכת שיעורים"})]}),e.jsx("div",{className:"sd-lessons-list",children:I.map((_,k)=>e.jsxs("div",{className:"sd-lesson-item",children:[e.jsx("div",{className:"sd-lesson-day",children:_.day}),e.jsxs("div",{className:"sd-lesson-time",children:[e.jsx(Ve,{size:10}),e.jsx("span",{children:A(_.time,_.duration)})]}),e.jsxs("div",{className:"sd-lesson-duration",children:[_.duration,"ד'"]})]},`assignment-${k}`))})]})]},`teacher-${D}-${C._id}`)})}):e.jsx("div",{className:"sd-empty-state",children:e.jsx("p",{children:"לא נמצאו מורים לתלמיד זה"})})})]})}function h$({student:t,orchestras:s,orchestrasLoading:n,isOpen:i,onToggle:l,onOrchestraClick:c}){const u=x.useRef(!1),[f,p]=x.useState([]),[m,y]=x.useState({}),v=x.useMemo(()=>{var b;return t?[...((b=t.enrollments)==null?void 0:b.orchestraIds)||[]].filter(w=>w):[]},[t]),j=v.length>0;x.useEffect(()=>{if(v.length>0&&s.length===0&&!n&&!u.current){const b=v.map(w=>({_id:w,name:`תזמורת ${w.slice(-4)}`,type:"",conductorId:"",memberIds:[],rehearsalIds:[],schoolYearId:"",location:"",isActive:!0}));p(b),u.current=!0}},[v,s.length,n]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{(async()=>{if(s.length===0)return;const w={};for(const A of s)if(A.conductorId&&!m[A.conductorId])try{const S=await Jt.getTeacherById(A.conductorId);S&&(w[A.conductorId]=S.personalInfo.fullName)}catch(S){console.error(`Error loading conductor ${A.conductorId}:`,S),w[A.conductorId]="מנצח לא ידוע"}Object.keys(w).length>0&&y(A=>({...A,...w}))})()},[s,m]);const N=v.length>0&&s.length===0&&!n&&f.length>0;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Ke,{size:16}),e.jsxs("span",{children:["תזמורות/הרכב ",j?`(${v.length})`:""]}),i?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:n?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען נתוני תזמורת..."})]}):j?N?e.jsx("div",{className:"sd-orchestras-swiper",children:f.map(b=>e.jsxs("div",{className:"sd-orchestra-compact-card clickable sd-orchestra-placeholder",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"sd-orchestra-card-header",children:[e.jsx("div",{className:"sd-orchestra-card-icon",children:e.jsx(Cs,{size:16})}),e.jsxs("div",{className:"sd-orchestra-card-info",children:[e.jsx("div",{className:"sd-orchestra-card-title",children:b.name}),e.jsx("div",{className:"sd-orchestra-card-type",children:"טוען..."})]})]}),e.jsx("div",{className:"sd-orchestra-card-details",children:e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(Yt,{size:12,className:"spin"}),e.jsx("span",{children:"טוען פרטים..."})]})})]},b._id))}):e.jsx("div",{className:"sd-orchestras-swiper",children:s.map(b=>e.jsxs("div",{className:"sd-orchestra-compact-card clickable",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"sd-orchestra-card-header",children:[e.jsx("div",{className:"sd-orchestra-card-icon",children:e.jsx(Cs,{size:16})}),e.jsxs("div",{className:"sd-orchestra-card-info",children:[e.jsx("div",{className:"sd-orchestra-card-title",children:b.name}),b.type&&e.jsx("div",{className:"sd-orchestra-card-type",children:b.type})]})]}),e.jsxs("div",{className:"sd-orchestra-card-details",children:[b.memberIds&&b.memberIds.length>0&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(ms,{size:12}),e.jsxs("span",{children:[b.memberIds.length," משתתפים"]})]}),b.rehearsalIds&&b.rehearsalIds.length>0&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx($e,{size:12}),e.jsxs("span",{children:[b.rehearsalIds.length," חזרות"]})]}),b.location&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:b.location})]}),b.conductorId&&e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(Je,{size:12}),e.jsxs("span",{children:["מנצח: ",m[b.conductorId]||"טוען..."]})]}),e.jsxs("div",{className:"sd-orchestra-card-detail",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:b.isActive?"פעיל":"לא פעיל"})]})]})]},b._id))}):e.jsx("div",{className:"sd-empty-state",children:"התלמיד אינו משתתף בתזמורות"})})]})}function f$({student:t,isOpen:s,onToggle:n,formatDate:i,updateStudentTest:l,isUpdatingTest:c=!1,getStageColor:u}){const[f,p]=x.useState(null),[m,y]=x.useState(null),[v,j]=x.useState(!1),N=[{value:"לא נבחן",label:"לא נבחן"},{value:"עבר/ה",label:"עבר/ה"},{value:"לא עבר/ה",label:"לא עבר/ה"},{value:"עבר/ה בהצטיינות",label:"עבר/ה בהצטיינות"},{value:"עבר/ה בהצטיינות יתרה",label:"עבר/ה בהצטיינות יתרה"}];if(x.useEffect(()=>{let D;return v&&(D=window.setTimeout(()=>{j(!1)},5e3)),()=>{D&&clearTimeout(D)}},[v]),!t||!t.academicInfo)return null;const b=(D,I)=>{c||(f&&f.instrumentName===D&&f.testType===I?p(null):p({instrumentName:D,testType:I}))},w=async(D,I,T)=>{var _,k;if(c)return;const R=t.academicInfo.instrumentProgress.find(z=>z.instrumentName===D);if(!R)return;const E=((k=(_=R.tests)==null?void 0:_[I])==null?void 0:k.status)||"לא נבחן";if(E===T){p(null);return}p(null);try{y({instrumentName:D,testType:I,oldStatus:E,newStatus:T,timestamp:Date.now()}),j(!0),await l(D,I,T),console.log(`Updated ${I} for ${D} to ${T}`)}catch(z){console.error(`Failed to update ${I} for ${D}:`,z)}},A=async()=>{if(!(!m||c))try{await l(m.instrumentName,m.testType,m.oldStatus),console.log(`Undid update for ${m.testType} for ${m.instrumentName}, restored to ${m.oldStatus}`),y(null),j(!1)}catch(D){console.error("Failed to undo test update:",D)}},S=D=>D==="עבר/ה בהצטיינות יתרה"?"var(--success-emphasis)":D==="עבר/ה בהצטיינות"||D==="עבר/ה"?"var(--success)":D==="לא עבר/ה"?"var(--danger)":"var(--text-muted)",C=D=>D==="לא נבחן"?"not-tested":D==="לא עבר/ה"?"failed":D==="עבר/ה בהצטיינות יתרה"?"excellent-plus":D==="עבר/ה בהצטיינות"?"excellent":"passed";return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx(Cs,{size:16}),e.jsx("span",{children:"מבחנים"}),s?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsxs("div",{className:"sd-section-content",children:[c&&e.jsxs("div",{className:"sd-updating-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"מעדכן נתונים..."})]}),e.jsx("div",{className:"sd-tests-grid",children:t.academicInfo.instrumentProgress.map(D=>{var I,T,R,E,_,k,z,M,G,X,W,te,L,J,K,le,O,U,Y,Z,H,P,q,B;return e.jsxs("div",{className:"sd-instrument-test-card",children:[e.jsxs("div",{className:"sd-instrument-test-header",children:[e.jsx("h3",{children:D.instrumentName}),e.jsxs("div",{className:"sd-stage-badge",style:{backgroundColor:u(D.currentStage)},children:["שלב ",D.currentStage]})]}),e.jsxs("div",{className:"sd-test-items",children:[e.jsxs("div",{className:"sd-test-item",children:[e.jsxs("div",{className:"sd-test-item-content",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן טכני:"}),e.jsxs("div",{className:"sd-test-value-container",children:[e.jsx("span",{className:`sd-test-value sd-clickable ${c?"disabled":""} ${C(((T=(I=D.tests)==null?void 0:I.technicalTest)==null?void 0:T.status)||"לא נבחן")}`,style:{color:S(((E=(R=D.tests)==null?void 0:R.technicalTest)==null?void 0:E.status)||"לא נבחן")},onClick:()=>b(D.instrumentName,"technicalTest"),children:((k=(_=D.tests)==null?void 0:_.technicalTest)==null?void 0:k.status)||"לא נבחן"}),!c&&f&&f.instrumentName===D.instrumentName&&f.testType==="technicalTest"&&e.jsx("div",{className:"sd-test-dropdown",children:N.map(se=>{var ae,oe,ce,Q;return e.jsxs("div",{className:`sd-dropdown-item ${(((oe=(ae=D.tests)==null?void 0:ae.technicalTest)==null?void 0:oe.status)||"לא נבחן")===se.value?"selected":""}`,onClick:()=>w(D.instrumentName,"technicalTest",se.value),children:[(((Q=(ce=D.tests)==null?void 0:ce.technicalTest)==null?void 0:Q.status)||"לא נבחן")===se.value&&e.jsx(Cs,{size:12}),se.label]},se.value)})})]})]}),((M=(z=D.tests)==null?void 0:z.technicalTest)==null?void 0:M.lastTestDate)&&e.jsxs("div",{className:"sd-test-date",children:[e.jsx($e,{size:12}),e.jsx("span",{children:i(D.tests.technicalTest.lastTestDate)})]})]}),e.jsxs("div",{className:"sd-test-item",children:[e.jsxs("div",{className:"sd-test-item-content",children:[e.jsx("span",{className:"sd-test-label",children:"מבחן שלב:"}),e.jsxs("div",{className:"sd-test-value-container",children:[e.jsx("span",{className:`sd-test-value sd-clickable ${c?"disabled":""} ${C(((X=(G=D.tests)==null?void 0:G.stageTest)==null?void 0:X.status)||"לא נבחן")}`,style:{color:S(((te=(W=D.tests)==null?void 0:W.stageTest)==null?void 0:te.status)||"לא נבחן")},onClick:()=>b(D.instrumentName,"stageTest"),children:((J=(L=D.tests)==null?void 0:L.stageTest)==null?void 0:J.status)||"לא נבחן"}),!c&&f&&f.instrumentName===D.instrumentName&&f.testType==="stageTest"&&e.jsx("div",{className:"sd-test-dropdown",children:N.map(se=>{var ae,oe,ce,Q;return e.jsxs("div",{className:`sd-dropdown-item ${(((oe=(ae=D.tests)==null?void 0:ae.stageTest)==null?void 0:oe.status)||"לא נבחן")===se.value?"selected":""}`,onClick:()=>w(D.instrumentName,"stageTest",se.value),children:[(((Q=(ce=D.tests)==null?void 0:ce.stageTest)==null?void 0:Q.status)||"לא נבחן")===se.value&&e.jsx(Cs,{size:12}),se.label]},se.value)})})]})]}),((le=(K=D.tests)==null?void 0:K.stageTest)==null?void 0:le.lastTestDate)&&e.jsxs("div",{className:"sd-test-date",children:[e.jsx($e,{size:12}),e.jsx("span",{children:i(D.tests.stageTest.lastTestDate)})]})]})]}),(((U=(O=D.tests)==null?void 0:O.stageTest)==null?void 0:U.notes)||((Z=(Y=D.tests)==null?void 0:Y.technicalTest)==null?void 0:Z.notes))&&e.jsx("div",{className:"sd-notes-row",children:e.jsx("span",{className:"sd-notes-text",children:((P=(H=D.tests)==null?void 0:H.stageTest)==null?void 0:P.notes)||((B=(q=D.tests)==null?void 0:q.technicalTest)==null?void 0:B.notes)})})]},D.instrumentName)})})]}),v&&m&&e.jsxs("div",{className:"sd-undo-toast",children:[e.jsx("span",{children:m.newStatus}),e.jsxs("button",{className:"sd-undo-btn",onClick:A,children:[e.jsx(Uo,{size:14}),e.jsx("span",{children:"ביטול"})]})]})]})}const eN={מעולה:{min:95,max:100},"טוב מאוד":{min:90,max:94},טוב:{min:75,max:89},מספיק:{min:55,max:74},"מספיק בקושי":{min:45,max:54},"לא עבר/ה":{min:0,max:44}},Dj=t=>{for(const[s,n]of Object.entries(eN))if(t>=n.min&&t<=n.max)return s;return"לא עבר/ה"},St={async getBagruts(t={}){return ye.get("bagrut",t)},async getBagrutById(t){return ye.get(`bagrut/${t}`)},async getBagrutByStudentId(t){var s;try{return await ye.get(`bagrut/student/${t}`)}catch(n){if(((s=n.response)==null?void 0:s.status)===404)return null;throw n}},async createBagrut(t){return ye.post("bagrut",t)},async updatePresentation(t,s,n){return ye.put(`bagrut/${t}/presentation/${s}`,n)},async updateMagenBagrut(t,s){return ye.put(`bagrut/${t}/magenBagrut`,s)},async updateGradingDetails(t,s){return ye.put(`bagrut/${t}/gradingDetails`,s)},async calculateFinalGrade(t){return ye.put(`bagrut/${t}/calculateFinalGrade`,{})},async completeBagrut(t,s){const n=s?{teacherSignature:s}:{};return ye.put(`bagrut/${t}/complete`,n)},async addProgramPiece(t,s){return ye.post(`bagrut/${t}/program`,s)},async updateProgramPiece(t,s,n){return ye.put(`bagrut/${t}/program/${s}`,n)},async updateProgram(t,s){return ye.put(`bagrut/${t}/program`,{program:s})},async removeProgramPiece(t,s){return ye.delete(`bagrut/${t}/program/${s}`)},async addAccompanist(t,s){return ye.post(`bagrut/${t}/accompanist`,s)},async removeAccompanist(t,s){return ye.delete(`bagrut/${t}/accompanist/${s}`)},async uploadDocument(t,s,n){const i=new FormData;return i.append("document",s),n&&i.append("title",n),ye.post(`bagrut/${t}/document`,i)},async removeDocument(t,s){return ye.delete(`bagrut/${t}/document/${s}`)},async updateBagrut(t,s){return ye.put(`bagrut/${t}`,s)},async deleteBagrut(t){return ye.delete(`bagrut/${t}`)}};function m$({student:t,isOpen:s,onToggle:n,formatDate:i}){var R,E,_,k,z,M,G;const[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState(null),y=_t(),{addToast:v}=Ot(),j=((E=(R=t.academicInfo)==null?void 0:R.tests)==null?void 0:E.bagrutId)!==null&&((k=(_=t.academicInfo)==null?void 0:_.tests)==null?void 0:k.bagrutId)!==void 0;x.useEffect(()=>{var X,W;s&&j&&((W=(X=t.academicInfo)==null?void 0:X.tests)!=null&&W.bagrutId)&&N()},[s,j,(M=(z=t.academicInfo)==null?void 0:z.tests)==null?void 0:M.bagrutId]);const N=async()=>{var X,W;if((W=(X=t.academicInfo)==null?void 0:X.tests)!=null&&W.bagrutId){f(!0),m(null);try{const te=await St.getBagrutById(t.academicInfo.tests.bagrutId);c(te)}catch(te){console.error("Failed to load bagrut:",te),m("שגיאה בטעינת נתוני הבגרות");try{const L=await St.getBagrutByStudentId(t._id);c(L),m(null)}catch(L){console.error("Fallback bagrut lookup failed:",L)}}finally{f(!1)}}},b=()=>{if(A()<5){v({type:"warning",message:"רק תלמידים בשלב 5 ומעלה יכולים ליצור בגרות",autoCloseTime:4e3});return}y(`/bagrut/new?studentId=${t._id}`)},w=()=>{var X,W;j&&((W=(X=t.academicInfo)==null?void 0:X.tests)!=null&&W.bagrutId)?y(`/bagrut/${t.academicInfo.tests.bagrutId}`):l&&y(`/bagrut/${l._id}`)},A=()=>{var te,L;if(t.academicInfo.currentStage)return typeof t.academicInfo.currentStage=="number"?t.academicInfo.currentStage:parseInt(t.academicInfo.currentStage)||0;const X=(te=t.academicInfo.instrumentProgress)==null?void 0:te.find(J=>J.isPrimary);if(X!=null&&X.currentStage)return X.currentStage;const W=(L=t.academicInfo.instrumentProgress)==null?void 0:L[0];return(W==null?void 0:W.currentStage)||0},S=()=>{var te;if(!l)return null;if(l.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const X=(l.presentations||[]).filter(L=>L.completed).length,W=((te=l.magenBagrut)==null?void 0:te.completed)||!1;return X>0||W?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},C=A(),D=C>=5,I=S(),T=I==null?void 0:I.icon;return e.jsxs("section",{className:"info-section",children:[e.jsxs("div",{className:"section-header",onClick:n,children:[e.jsxs("div",{className:"header-content",children:[e.jsx(Cs,{size:20}),e.jsx("h3",{children:"בגרות במוזיקה"}),j&&e.jsx("div",{className:"status-indicator",children:I&&T&&e.jsxs(e.Fragment,{children:[e.jsx(T,{size:16,style:{color:I.color}}),e.jsx("span",{style:{color:I.color},children:I.text})]})})]}),e.jsx("div",{className:"section-controls",children:s?e.jsx(Bt,{size:20}):e.jsx(bt,{size:20})})]}),s&&e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"eligibility-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"שלב נוכחי:"}),e.jsxs("span",{className:`value ${D?"eligible":"not-eligible"}`,children:[C," ",D?"(זכאי לבגרות)":"(לא זכאי לבגרות)"]})]}),!D&&e.jsxs("div",{className:"warning-message",children:[e.jsx(Bs,{size:16}),e.jsx("span",{children:"רק תלמידים בשלב 5 ומעלה יכולים ליצור בגרות"})]})]}),e.jsx("div",{className:"bagrut-connection",children:j?e.jsxs("div",{className:"has-bagrut",children:[e.jsxs("div",{className:"connection-info",children:[e.jsx(Et,{size:16,style:{color:"var(--success)"}}),e.jsx("span",{children:"לתלמיד יש בגרות במערכת"})]}),u?e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{size:16,className:"spinning"}),e.jsx("span",{children:"טוען נתוני בגרות..."})]}):p?e.jsxs("div",{className:"error-state",children:[e.jsx(Bs,{size:16,style:{color:"var(--danger)"}}),e.jsx("span",{children:p}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:N,children:"נסה שוב"})]}):l?e.jsxs("div",{className:"bagrut-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"label",children:"קונסרבטוריון:"}),e.jsx("span",{className:"value",children:l.conservatoryName||"לא צוין"})]}),l.testDate&&e.jsxs("div",{className:"summary-row",children:[e.jsx($e,{size:14}),e.jsx("span",{className:"label",children:"מועד מבחן:"}),e.jsx("span",{className:"value",children:new Date(l.testDate).toLocaleDateString("he-IL")})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"label",children:"התקדמות:"}),e.jsxs("span",{className:"value",children:[(l.presentations||[]).filter(X=>X.completed).length+((G=l.magenBagrut)!=null&&G.completed?1:0),"/5 השמעות"]})]}),l.finalGrade&&e.jsxs("div",{className:"summary-row",children:[e.jsx(Cs,{size:14}),e.jsx("span",{className:"label",children:"ציון סופי:"}),e.jsxs("span",{className:"value",children:[l.finalGrade," (",l.finalGradeLevel,")"]})]})]}):null,e.jsx("div",{className:"action-buttons",children:e.jsxs("button",{className:"btn btn-primary",onClick:w,disabled:u,children:[e.jsx(xa,{size:16}),"צפה בבגרות"]})})]}):e.jsxs("div",{className:"no-bagrut",children:[e.jsxs("div",{className:"connection-info",children:[e.jsx(Bs,{size:16,style:{color:"var(--text-muted)"}}),e.jsx("span",{children:"לתלמיד אין בגרות במערכת"})]}),D&&e.jsx("div",{className:"action-buttons",children:e.jsxs("button",{className:"btn btn-primary",onClick:b,children:[e.jsx(fs,{size:16}),"צור בגרות חדשה"]})})]})})]})]})}function p$({student:t,attendanceStats:s,loadingAttendance:n,isOpen:i,onToggle:l,formatDate:c}){var u,f,p;return t?e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx($e,{size:16}),e.jsx("span",{children:"נוכחות"}),i?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:(((f=(u=t.academicInfo)==null?void 0:u.orchestraIds)==null?void 0:f.length)||0)>0?e.jsx("div",{className:"sd-attendance-container",children:n?e.jsxs("div",{className:"sd-loading-attendance",children:[e.jsx(Yt,{size:16,className:"sd-loading-icon"}),e.jsx("span",{children:"טוען נתוני נוכחות..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sd-attendance-summary",children:[e.jsxs("div",{className:"sd-attendance-stat",children:[e.jsx("span",{className:"sd-stat-label",children:"שיעור נוכחות"}),e.jsxs("div",{className:"sd-attendance-rate",children:[Math.round(s.attendanceRate),"%"]})]}),e.jsxs("div",{className:"sd-attendance-stat",children:[e.jsx("span",{className:"sd-stat-label",children:"נוכח"}),e.jsxs("div",{className:"sd-attendance-count",children:[s.attended," /"," ",s.totalRehearsals]})]})]}),((p=s.recentHistory)==null?void 0:p.length)>0?e.jsxs("div",{className:"sd-attendance-history",children:[e.jsx("h3",{className:"sd-history-title",children:"היסטוריית נוכחות אחרונה"}),e.jsx("div",{className:"sd-history-entries",children:s.recentHistory.map((m,y)=>e.jsxs("div",{className:"sd-history-entry",children:[e.jsx("div",{className:`sd-status-indicator ${m.status==="הגיע/ה"?"present":"absent"}`}),e.jsx("span",{className:"sd-history-date",children:c(m.date)}),e.jsx("span",{className:`sd-history-status ${m.status==="הגיע/ה"?"present":"absent"}`,children:m.status})]},y))})]}):e.jsx("div",{className:"sd-no-attendance-history",children:"אין היסטוריית נוכחות זמינה"}),s.message&&e.jsx("div",{className:"sd-attendance-message sd-warning",children:s.message})]}):e.jsx("div",{className:"sd-no-attendance-data",children:"אין נתוני נוכחות זמינים"})}):e.jsx("div",{className:"sd-no-orchestra-warning",children:"אין נתוני נוכחות עבור תלמיד שאינו משתתף בתזמורות"})})]}):null}function g$({student:t,theoryLessons:s,theoryLessonsLoading:n,isOpen:i,onToggle:l,onTheoryLessonClick:c}){var w;const u=x.useRef(!1),[f,p]=x.useState([]),[m,y]=x.useState({}),v=t&&((w=t.enrollments)!=null&&w.theoryLessonIds)?t.enrollments.theoryLessonIds.filter(A=>A):[],j=v.length>0;x.useEffect(()=>{if(v.length>0&&s.length===0&&!n&&!u.current){const A=v.map(S=>({_id:S,category:"שיעור העשרה",isPlaceholder:!0}));p(A),u.current=!0}},[v,s.length,n]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{async function A(){if(!s||s.length===0)return;const S=[...new Set(s.map(C=>C.teacherId))];if(S.length!==0)try{const C=await Jt.getTeachersByIds(S),D={};C.forEach(I=>{var T;I&&I._id&&((T=I.personalInfo)!=null&&T.fullName)&&(D[I._id]=I.personalInfo.fullName)}),y(D)}catch(C){console.error("Failed to load teacher names for theory lessons:",C)}}A()},[s]);const N=v.length>0&&s.length===0&&!n&&f.length>0,b=(A,S,C)=>`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][A]||"לא ידוע"} ${S}-${C}`;return e.jsxs("div",{className:"sd-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Zt,{size:16}),e.jsxs("span",{children:["שיעורי העשרה ",j?`(${s.reduce((S,C)=>{const D=`${C.category}-${C.teacherId}-${C.dayOfWeek}-${C.startTime}-${C.endTime}-${C.location}`;return S.add(D),S},new Set).size})`:""]}),i?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),i&&e.jsx("div",{className:"sd-section-content",children:n?e.jsxs("div",{className:"sd-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען שיעורי העשרה..."})]}):j?N?e.jsx("div",{className:"sd-theory-lessons-grid",children:f.map(A=>e.jsxs("div",{className:"sd-theory-lesson-card clickable sd-theory-lesson-placeholder",onClick:()=>c(A._id),children:[e.jsx(Zt,{size:20}),e.jsx("span",{children:A.category})]},A._id))}):e.jsx("div",{className:"sd-theory-lessons-swiper",children:(()=>{const A=s.reduce((S,C)=>{const D=`${C.category}-${C.teacherId}-${C.dayOfWeek}-${C.startTime}-${C.endTime}-${C.location}`;return S[D]||(S[D]={category:C.category,teacherId:C.teacherId,teacherName:m[C.teacherId]||"לא ידוע",dayOfWeek:C.dayOfWeek,startTime:C.startTime,endTime:C.endTime,location:C.location,lessonCount:0,lessons:[]}),S[D].lessonCount++,S[D].lessons.push(C),S},{});return Object.values(A).map((S,C)=>e.jsxs("div",{className:"sd-theory-lesson-compact-card clickable",onClick:()=>c(S.lessons[0]._id),children:[e.jsxs("div",{className:"sd-theory-card-header",children:[e.jsx("div",{className:"sd-theory-card-icon",children:e.jsx(Zt,{size:16})}),e.jsxs("div",{className:"sd-theory-card-info",children:[e.jsx("div",{className:"sd-theory-card-title",children:S.category}),e.jsxs("div",{className:"sd-theory-card-count",children:[S.lessonCount," מפגשים"]})]})]}),e.jsxs("div",{className:"sd-theory-card-details",children:[e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:S.teacherName})]}),S.dayOfWeek!==void 0&&S.startTime&&S.endTime&&e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:b(S.dayOfWeek,S.startTime,S.endTime)})]}),S.location&&e.jsxs("div",{className:"sd-theory-card-detail",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:S.location})]})]})]},`theory-group-${C}`))})()}):e.jsx("div",{className:"sd-empty-state",children:"התלמיד אינו משתתף בשיעורי העשרה"})})]})}const um=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];function y$({student:t,isOpen:s,onToggle:n,onEditSchedule:i}){const{teachers:l,loadTeachers:c}=Ds(),[u,f]=x.useState([]),[p,m]=x.useState(new Date);x.useEffect(()=>{if(t!=null&&t.teacherIds&&l.length>0){const b=[];t.teacherAssignments&&t.teacherAssignments.forEach((w,A)=>{var T,R;const S=l.find(E=>E._id===w.teacherId),C=((T=S==null?void 0:S.personalInfo)==null?void 0:T.fullName)||"מורה לא ידוע",D=(R=S==null?void 0:S.professionalInfo)==null?void 0:R.instrument,I=w.isActive===!1?"cancelled":"active";b.push({id:w.scheduleSlotId||`lesson-${A}`,teacherId:w.teacherId,teacherName:C,instrument:D,day:w.day,startTime:w.time,endTime:y(w.time,w.duration),duration:w.duration,location:w.location,timeBlockId:w.scheduleSlotId,status:I,notes:w.notes})}),b.sort((w,A)=>{const S=um.indexOf(w.day),C=um.indexOf(A.day);return S!==C?S-C:w.startTime.localeCompare(A.startTime)}),f(b)}},[t,l]),x.useEffect(()=>{var b;((b=t==null?void 0:t.teacherIds)==null?void 0:b.length)>0&&l.length===0&&c()},[t==null?void 0:t.teacherIds,l.length,c]);const y=(b,w)=>{const[A,S]=b.split(":").map(Number),C=A*60+S+w,D=Math.floor(C/60),I=C%60;return`${D.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`},v=u.reduce((b,w)=>(b[w.day]||(b[w.day]=[]),b[w.day].push(w),b),{}),j=u.filter(b=>b.status==="active"),N={totalLessons:j.length,totalWeeklyMinutes:j.reduce((b,w)=>b+w.duration,0),uniqueTeachers:new Set(j.map(b=>b.teacherId)).size,daysWithLessons:Object.keys(v).length};return e.jsxs("div",{className:"sd-section lesson-schedule-section",children:[e.jsxs("div",{className:`sd-section-title clickable ${s?"active":""}`,onClick:n,children:[e.jsx($e,{size:16}),e.jsxs("span",{children:["מערכת שיעורים"," ",N.totalLessons>0&&`(${N.totalLessons})`]}),s?e.jsx(Bt,{size:18,className:"sd-toggle-icon"}):e.jsx(bt,{size:18,className:"sd-toggle-icon"})]}),s&&e.jsx("div",{className:"sd-section-content",children:u.length===0?e.jsxs("div",{className:"empty-schedule-state",children:[e.jsx($e,{size:48,color:"#ffc107"}),e.jsxs("div",{className:"empty-content",children:[e.jsx("h4",{children:"אין שיעורים מתוכננים"}),e.jsx("p",{children:"התלמיד עדיין לא שויך לשיעורים במערכת"}),i&&e.jsxs("button",{className:"add-lessons-btn",onClick:i,children:[e.jsx(fs,{size:16}),"הוסף שיעורים"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx($e,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.totalLessons}),e.jsx("span",{className:"stat-label",children:"שיעורים בשבוע"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.totalWeeklyMinutes}),e.jsx("span",{className:"stat-label",children:"דקות בשבוע"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Je,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.uniqueTeachers}),e.jsx("span",{className:"stat-label",children:"מורים"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Et,{size:16})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("span",{className:"stat-value",children:N.daysWithLessons}),e.jsx("span",{className:"stat-label",children:"ימים עם שיעורים"})]})]})]}),e.jsxs("div",{className:"weekly-schedule",children:[e.jsx("h4",{children:"מערכת שבועית"}),Object.keys(v).length===0?e.jsx("div",{className:"no-schedule-days",children:e.jsx("p",{children:"אין שיעורים מתוכננים השבוע"})}):e.jsx("div",{className:"schedule-grid",children:um.filter(b=>(v[b]||[]).length>0).map(b=>{const w=v[b]||[];return e.jsxs("div",{className:"day-column has-lessons",children:[e.jsxs("div",{className:"day-header",children:[e.jsx("span",{className:"day-name",children:b}),e.jsx("span",{className:"lessons-count",children:w.length})]}),e.jsx("div",{className:"day-lessons",children:w.map(A=>e.jsxs("div",{className:`lesson-slot ${A.status}`,children:[e.jsxs("div",{className:"lesson-time",children:[e.jsx(Ve,{size:12}),e.jsxs("span",{children:[A.startTime," - ",A.endTime]})]}),e.jsxs("div",{className:"lesson-teacher",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:A.teacherName})]}),A.instrument&&e.jsx("div",{className:"lesson-instrument",children:e.jsx("span",{children:A.instrument})}),A.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:A.location})]}),e.jsxs("div",{className:"lesson-duration",children:[A.duration," דקות"]}),e.jsxs("div",{className:`lesson-status ${A.status}`,children:[A.status==="active"&&e.jsx(Et,{size:12}),A.status==="cancelled"&&e.jsx(Bs,{size:12}),e.jsxs("span",{children:[A.status==="active"&&"פעיל",A.status==="cancelled"&&"מבוטל",A.status==="completed"&&"הושלם"]})]})]},A.id))})]},b)})})]}),e.jsxs("div",{className:"section-footer",children:[e.jsx("div",{className:"last-updated",children:e.jsxs("span",{children:["עודכן לאחרונה: ",p.toLocaleString("he-IL")]})}),i&&e.jsxs("button",{className:"edit-schedule-btn",onClick:i,children:[e.jsx(ba,{size:14}),"ערוך מערכת שיעורים"]})]})]})})]})}function kj(){var te,L;const{student:t,isLoading:s,error:n,flipped:i,toggleFlip:l,goBack:c,getInitials:u,getStageColor:f,primaryInstrument:p,openSections:m,toggleSection:y,formatDate:v,navigateToTeacher:j,navigateToOrchestra:N,navigateToTheoryLesson:b,navigateToStudentEdit:w,teachersData:A,teachersLoading:S,teachersError:C,orchestras:D,orchestrasLoading:I,theoryLessons:T,theoryLessonsLoading:R,retryLoadTeachers:E,updateStudentTest:_,isUpdatingTest:k,updateStudentStage:z,isUpdatingStage:M}=l$(),{user:G}=ys(),X=!!(G&&(G.roles.includes("מנהל")||G.roles.includes("מורה")&&((te=t==null?void 0:t.teacherIds)!=null&&te.includes(G._id))));if(s)return e.jsxs("div",{className:"sd-loading-state",children:[e.jsx(Yt,{className:"sd-loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי תלמיד..."})]});if(n||!t)return e.jsxs("div",{className:"sd-error-state",children:[e.jsx("p",{children:n||"לא ניתן לטעון את פרטי התלמיד"}),e.jsx("button",{onClick:c,className:"btn primary",children:"חזרה לרשימת התלמידים"})]});const W=t.teacherIds||[];return e.jsx("div",{className:"student-details-content",children:e.jsx("div",{className:"student-details-page",children:e.jsx("div",{className:"student-card-container",children:e.jsxs("div",{className:`sd-card-content ${i?"flipped":""}`,children:[e.jsxs("div",{className:"sd-card-side sd-card-front",children:[e.jsxs("div",{className:"sd-card-header",children:[e.jsxs("div",{className:"sd-student-identity",children:[e.jsx("div",{className:"sd-avatar sd-avatar-clickable",style:{backgroundColor:p?f(p.currentStage):"#4158d0"},children:u(t.personalInfo.fullName)}),e.jsxs("div",{className:"sd-header-text",children:[e.jsx("h1",{className:"sd-student-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"sd-instrument",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:p.instrumentName})]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"תלמיד"})]})})]})]}),e.jsxs("div",{className:"sd-header-badges",children:[e.jsxs("div",{className:"sd-class-badge",children:["כיתה ",t.academicInfo.class]}),e.jsx("button",{className:"sd-back-button",onClick:c,"aria-label":"חזרה",children:e.jsx(zs,{size:20})})]})]}),e.jsxs("div",{className:"sd-card-scroll-area",children:[((L=t.academicInfo.instrumentProgress)==null?void 0:L.length)>0&&e.jsx(o$,{student:t,isOpen:m.instruments,onToggle:()=>y("instruments"),getStageColor:f,updateStudentStage:z,isUpdatingStage:M,canEditStage:X}),e.jsx(u$,{teachersData:A,teachersLoading:S,teachersError:C,isOpen:m.teachers,onToggle:()=>y("teachers"),onTeacherClick:j,onRetryLoadTeachers:E,studentTeacherIds:W,teacherAssignments:t.teacherAssignments||[]}),e.jsx(y$,{student:t,isOpen:m.schedule,onToggle:()=>y("schedule"),onEditSchedule:w}),e.jsx(h$,{student:t,orchestras:D,orchestrasLoading:I,isOpen:m.orchestras,onToggle:()=>y("orchestras"),onOrchestraClick:N}),e.jsx(f$,{student:t,isOpen:m.tests,onToggle:()=>y("tests"),formatDate:v,updateStudentTest:_,isUpdatingTest:k,getStageColor:f}),e.jsx(m$,{student:t,isOpen:m.bagrut,onToggle:()=>y("bagrut"),formatDate:v}),e.jsx(p$,{student:t,attendanceStats:null,loadingAttendance:!1,isOpen:m.attendance,onToggle:()=>y("attendance"),formatDate:v}),e.jsx(g$,{student:t,theoryLessons:T,theoryLessonsLoading:R,isOpen:m.theoryLessons,onToggle:()=>y("theoryLessons"),onTheoryLessonClick:b})]}),e.jsxs("button",{className:"sd-flip-button",onClick:l,children:[e.jsx("span",{children:"הצג פרטים אישיים"}),e.jsx(zs,{size:14})]})]}),e.jsxs("div",{className:"sd-card-side sd-card-back",children:[e.jsxs("div",{className:"sd-card-header",children:[e.jsxs("div",{className:"sd-student-identity",children:[e.jsx("div",{className:"sd-avatar sd-avatar-clickable",style:{backgroundColor:p?f(p.currentStage):"#4158d0"},children:u(t.personalInfo.fullName)}),e.jsxs("div",{className:"sd-header-text",children:[e.jsx("h1",{className:"sd-student-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"sd-instrument",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:p.instrumentName})]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"תלמיד"})]})})]})]}),e.jsxs("div",{className:"sd-header-badges",children:[e.jsxs("div",{className:"sd-class-badge",children:["כיתה ",t.academicInfo.class]}),e.jsx("button",{className:"sd-back-button",onClick:c,"aria-label":"חזרה",children:e.jsx(zs,{size:20})})]})]}),e.jsxs("div",{className:"sd-card-scroll-area",children:[e.jsx(c$,{student:t,isOpen:m.personalInfo,onToggle:()=>y("personalInfo"),formatDate:v}),e.jsx(d$,{student:t,isOpen:m.parentInfo,onToggle:()=>y("parentInfo")})]}),e.jsxs("button",{className:"sd-flip-button",onClick:l,children:[e.jsx("span",{children:"הצג מידע לימודי"}),e.jsx(zs,{size:14})]})]})]})})})})}const v$=t=>{let s=t.replace(/\D/g,"");return s.startsWith("0")&&(s=`972${s.substring(1)}`),s},x$=(t,s="")=>{const n=v$(t),i=encodeURIComponent(s),l=`https://wa.me/${n}?text=${i}`;window.open(l,"_blank")};function j$({teacher:t,onView:s,onEdit:n,onRemove:i,studentCount:l,authContext:c}){var N,b,w,A;if(!t||!t.personalInfo)return console.error("TeacherPreview: Invalid teacher data",t),null;const u=c?br(c):null,f=S=>S?S.split(" ").map(C=>C[0]).join("").toUpperCase().substring(0,2):"NA",p=S=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545",מגמה:"#FF6B35"})[S]||"#6c757d",m=S=>S===0?"אין תלמידים":S===1?"תלמיד אחד":`${S} תלמידים`,y=(S,C)=>{S.stopPropagation(),x$(C)},v=l!==void 0?l:((b=(N=t.teaching)==null?void 0:N.studentIds)==null?void 0:b.length)||0,j=t.roles&&t.roles.length>0?t.roles[0]:"מורה";return e.jsxs("div",{className:"teacher-preview",onClick:()=>s(t._id),style:{cursor:"pointer"},children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsx("div",{className:"badges-container",children:t.roles&&t.roles.map(S=>e.jsx("div",{className:"role-badge",style:{backgroundColor:p(S)},children:e.jsx("span",{children:S})},S))}),e.jsxs("div",{className:"teacher-header-container",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:p(j)},children:f(t.personalInfo.fullName)})}),e.jsxs("div",{className:"teacher-info",children:[e.jsx("h3",{className:"teacher-name",children:t.personalInfo.fullName}),e.jsx("div",{className:"teacher-subject",children:(w=t.professionalInfo)!=null&&w.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:t.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(mr,{size:14}),e.jsx("span",{children:j})]})})]})]})]})}),e.jsx("div",{className:"preview-content",children:e.jsxs("div",{className:"info-row",children:[t.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:16}),e.jsx("span",{className:"clickable-phone",onClick:S=>t.personalInfo.phone&&y(S,t.personalInfo.phone),title:"לחץ לפתיחת שיחה בוואטסאפ",children:t.personalInfo.phone})]}),t.personalInfo.email&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:16}),e.jsx("span",{children:t.personalInfo.email})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(ms,{size:16}),e.jsx("span",{children:m(v)})]}),((A=t.conducting)==null?void 0:A.orchestraIds)&&t.conducting.orchestraIds.length>0&&e.jsxs("div",{className:"info-item",children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:t.conducting.orchestraIds.length===1?"מנצח על תזמורת אחת":`מנצח על ${t.conducting.orchestraIds.length} תזמורות`})]})]})}),e.jsxs("div",{className:"preview-footer",children:[e.jsx("div",{className:"action-buttons",children:(()=>{const S=(u==null?void 0:u.getTeacherActionPermissions(t))||{showEditButton:!0,showDeleteButton:!0};return e.jsxs(e.Fragment,{children:[S.showEditButton&&e.jsx("button",{className:"action-btn edit",onClick:C=>{C.stopPropagation(),n(t._id)},"aria-label":"ערוך מורה",children:e.jsx(ba,{size:20})}),S.showDeleteButton&&i&&e.jsx("button",{className:"action-btn delete",onClick:C=>{C.stopPropagation(),i(t._id)},"aria-label":"מחק מורה",children:e.jsx(Ft,{size:20})})]})})()}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(t.createdAt||Date.now()).toLocaleDateString("he-IL")})]})]})]})}function b$({teachers:t,isLoading:s,onEdit:n,onView:i,onRemove:l,authContext:c}){const[u,f]=x.useState({}),[p,m]=x.useState(!1);x.useEffect(()=>{t.length>0&&!p&&y()},[t,p]);const y=async()=>{try{console.log("Loading student counts for teachers...");const v=await ot.getStudents();console.log("Total students loaded for count calculation:",v.length);const j={};t.forEach(N=>{const b=v.filter(w=>{const A=w.teacherIds&&w.teacherIds.includes(N._id),S=w.teacherAssignments&&w.teacherAssignments.some(C=>C.teacherId===N._id);return A||S}).length;j[N._id]=b,b>0&&console.log(`Teacher ${N.personalInfo.fullName}: ${b} students`)}),f(j),m(!0)}catch(v){console.error("Failed to load student counts:",v)}};return Array.isArray(t)?s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען מורים..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו מורים להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף מורים חדשים"})]}):e.jsx("div",{className:"teacher-grid",children:t.filter(v=>v&&v._id&&v.personalInfo).map(v=>e.jsx(j$,{teacher:v,onEdit:n,onView:i||n,onRemove:l,studentCount:u[v._id]||0,authContext:c},v._id))}):(console.error("Expected teachers to be an array but got:",typeof t,t),e.jsx("div",{className:"error-state",children:"שגיאה בטעינת נתונים"}))}const N$=({initialStudentIds:t=[],onStudentIdsChange:s,onAddScheduleItem:n,onRemoveScheduleItem:i})=>{const[l,c]=x.useState([]),[u,f]=x.useState([]),[p,m]=x.useState(!1),[y,v]=x.useState(!1),[j,N]=x.useState("");x.useEffect(()=>{(async()=>{m(!0);try{const D=await ot.getStudents({isActive:!0});console.log(`Loaded ${D.length} students for selection`),c(D)}catch(D){console.error("Failed to load students:",D)}finally{m(!1)}})()},[]),x.useEffect(()=>{(async()=>{if(t.length>0){console.log("Loading selected students for IDs:",t),m(!0);try{const D=await ot.getStudentsByIds(t);console.log("Loaded selected students:",D),f(D)}catch(D){console.error("Failed to load selected students:",D)}finally{m(!1)}}else f([])})()},[t]);const b=x.useCallback(C=>{N(C)},[]),w=x.useCallback(()=>j.trim()?l.filter(C=>u.some(I=>I._id===C._id)?!1:[C.personalInfo.fullName,C.academicInfo.instrument,C.academicInfo.class].some(I=>(I==null?void 0:I.toLowerCase().includes(j.toLowerCase()))||!1)).slice(0,10):[],[j,l,u]),A=x.useCallback(C=>{if(u.some(I=>I._id===C._id)){console.log(`Student ${C._id} already selected, skipping`);return}console.log(`🎯 Adding student ${C._id} (${C.personalInfo.fullName}) to teacher selection`),f(I=>[...I,C]);const D=[...u.map(I=>I._id),C._id];s(D),console.log(`📅 Creating schedule item for student ${C._id}`),n(C._id),console.log("✅ Student assignment complete - IDs now:",D),N(""),v(!1)},[u,s,n]),S=x.useCallback(C=>{console.log(`🔄 Removing student ${C} from selection`);const D=u.filter(T=>T._id!==C);f(D);const I=D.map(T=>T._id);console.log("📋 Updated student IDs after removal:",I),s(I),console.log(`🗑️ Removing schedule for student ${C}`),i(C),console.log(`✅ Student ${C} removal completed`)},[u,s,i]);return{students:l,selectedStudents:u,loadingStudents:p,showStudentSearch:y,searchQuery:j,setShowStudentSearch:v,handleStudentSearch:b,getFilteredStudents:w,handleAddStudent:A,handleRemoveStudent:S}};function S$({isOpen:t,onClose:s,duplicateInfo:n,onConfirm:i,onCancel:l,isAdmin:c=!1,isSubmitting:u=!1}){const[f,p]=x.useState(!1),[m,y]=x.useState("");if(!t)return null;const v=C=>{switch(C){case"CRITICAL":return e.jsx(Bs,{className:"text-red-600",size:20});case"HIGH":return e.jsx(oi,{className:"text-orange-600",size:20});case"MEDIUM":return e.jsx($o,{className:"text-yellow-600",size:20});case"LOW":return e.jsx(Et,{className:"text-blue-600",size:20});default:return e.jsx($o,{className:"text-gray-600",size:20})}},j=C=>{switch(C){case"CRITICAL":return"border-red-500 bg-red-50";case"HIGH":return"border-orange-500 bg-orange-50";case"MEDIUM":return"border-yellow-500 bg-yellow-50";case"LOW":return"border-blue-500 bg-blue-50";default:return"border-gray-500 bg-gray-50"}},N=C=>{switch(C){case"fullName":return e.jsx(Je,{size:16});case"phone":return e.jsx(fi,{size:16});case"email":return e.jsx(On,{size:16});case"address":return e.jsx(gt,{size:16});default:return e.jsx($o,{size:16})}},b=C=>{switch(C){case"fullName":return"שם מלא";case"phone":return"טלפון";case"email":return'דוא"ל';case"address":return"כתובת";default:return C}},w=(C,D)=>e.jsxs("div",{className:`duplicate-match ${j(C.severity)}`,children:[e.jsxs("div",{className:"match-header",children:[e.jsxs("div",{className:"severity-info",children:[v(C.severity),e.jsx("span",{className:"severity-label",children:C.severity})]}),e.jsx("div",{className:"match-message",children:C.message})]}),e.jsxs("div",{className:"conflicting-fields",children:[e.jsx("span",{className:"fields-label",children:"שדות מתנגשים:"}),e.jsx("div",{className:"fields-list",children:C.conflictingFields.map((I,T)=>e.jsxs("div",{className:"field-item",children:[N(I),e.jsx("span",{children:b(I)})]},T))})]}),C.note&&e.jsxs("div",{className:"match-note",children:[e.jsx($o,{size:14}),e.jsx("span",{children:C.note})]}),C.matches&&C.matches.length>0&&e.jsxs("div",{className:"existing-matches",children:[e.jsx("span",{className:"matches-label",children:"מורים קיימים:"}),C.matches.map((I,T)=>{var R,E,_;return e.jsxs("div",{className:"existing-teacher",children:[e.jsx(Je,{size:14}),e.jsx("span",{children:((R=I.personalInfo)==null?void 0:R.fullName)||"לא מצוין"}),e.jsxs("span",{className:"teacher-details",children:[(E=I.personalInfo)==null?void 0:E.phone," | ",(_=I.personalInfo)==null?void 0:_.email]})]},T)})]})]},D),A=()=>{c&&f?i(!0):n.blocked||i(!1)},S=()=>{m.trim()&&i(!0)};return e.jsxs("div",{className:"duplicate-confirmation-modal",children:[e.jsx("div",{className:"modal-overlay",onClick:s}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"זיהוי כפילויות"}),e.jsx("button",{className:"close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(Nt,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"duplicate-summary",children:[e.jsx("div",{className:"summary-icon",children:n.blocked?e.jsx(Bs,{className:"text-red-600",size:24}):e.jsx(oi,{className:"text-orange-600",size:24})}),e.jsxs("div",{className:"summary-text",children:[e.jsx("h3",{children:n.blocked?"יצירה חסומה":"אזהרת כפילות"}),e.jsx("p",{children:n.reason})]})]}),n.duplicates&&n.duplicates.length>0&&e.jsxs("div",{className:"duplicates-section",children:[e.jsx("h4",{children:"כפילויות זוהו:"}),n.duplicates.map((C,D)=>w(C,D))]}),n.warnings&&n.warnings.length>0&&e.jsxs("div",{className:"warnings-section",children:[e.jsx("h4",{children:"אזהרות:"}),n.warnings.map((C,D)=>w(C,D))]}),c&&n.blocked&&e.jsxs("div",{className:"admin-override-section",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx(v0,{className:"text-blue-600",size:20}),e.jsx("span",{children:"עקיפת מנהל"})]}),f?e.jsxs("div",{className:"override-form",children:[e.jsx("label",{htmlFor:"override-reason",children:"סיבה לעקיפה:"}),e.jsx("textarea",{id:"override-reason",value:m,onChange:C=>y(C.target.value),placeholder:"הסבר מדוע יש צורך ליצור מורה זה למרות הכפילות...",rows:3,disabled:u}),e.jsxs("div",{className:"override-actions",children:[e.jsx("button",{className:"btn danger",onClick:S,disabled:!m.trim()||u,children:u?"יוצר...":"עקוף ויצור"}),e.jsx("button",{className:"btn secondary",onClick:()=>p(!1),disabled:u,children:"ביטול"})]})]}):e.jsx("button",{className:"btn secondary",onClick:()=>p(!0),disabled:u,children:"הצג אפשרויות מנהל"})]})]}),e.jsx("div",{className:"modal-footer",children:n.blocked&&!f?e.jsxs("div",{className:"blocked-actions",children:[e.jsx("button",{className:"btn secondary",onClick:l,disabled:u,children:"חזור לעריכה"}),e.jsx("button",{className:"btn secondary",onClick:s,disabled:u,children:"ביטול"})]}):e.jsxs("div",{className:"warning-actions",children:[e.jsx("button",{className:"btn primary",onClick:A,disabled:u,children:u?"יוצר...":"המשך בכל זאת"}),e.jsx("button",{className:"btn secondary",onClick:l,disabled:u,children:"חזור לעריכה"})]})})]})]})}const tN=["הרכב","תזמורת"],xr=["אולם ערן","סטודיו קאמרי 1","סטודיו קאמרי 2","אולפן הקלטות","חדר חזרות 1","חדר חזרות 2","חדר מחשבים","חדר 1","חדר 2","חדר חזרות","חדר 5","חדר 6","חדר 7","חדר 8","חדר 9","חדר 10","חדר 11","חדר 12","חדר 13","חדר 14","חדר 15","חדר 16","חדר 17","חדר 18","חדר 19","חדר 20","חדר 21","חדר 22","חדר 23","חדר 24","חדר 25","חדר 26"],sN=t=>["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][t],Fm=[{value:0,label:"יום ראשון"},{value:1,label:"יום שני"},{value:2,label:"יום שלישי"},{value:3,label:"יום רביעי"},{value:4,label:"יום חמישי"},{value:5,label:"יום שישי"},{value:6,label:"יום שבת"}],w$=[{id:"day-selection",title:"בחירת יום",description:"בחר את הימים ליום הלימוד",component:"DaySelectionStep",isComplete:!1,isActive:!0},{id:"time-range",title:"טווח זמן",description:"הגדר את שעות תחילת וסיום יום הלימוד",component:"TimeRangeStep",isComplete:!1,isActive:!1},{id:"details",title:"פרטים נוספים",description:"מיקום, הערות והגדרות חזרה",component:"DetailsStep",isComplete:!1,isActive:!1},{id:"review",title:"סקירה",description:"בדוק את פרטי יום הלימוד לפני יצירה",component:"ReviewStep",isComplete:!1,isActive:!1}],aN=({teacherId:t,onBlockCreated:s,onCancel:n,initialData:i,isOpen:l=!0})=>{const c=!!i,{createTimeBlock:u,updateTimeBlock:f,isLoading:p,error:m,clearError:y,currentTeacherSchedule:v,loadTeacherSchedule:j}=kl(),[N,b]=x.useState({currentStep:0,steps:w$,formData:{day:(i==null?void 0:i.day)||An[0],startTime:(i==null?void 0:i.startTime)||"14:00",endTime:(i==null?void 0:i.endTime)||"18:00",location:(i==null?void 0:i.location)||"",notes:(i==null?void 0:i.notes)||"",isRecurring:(i==null?void 0:i.isRecurring)||!1,recurringDays:(i==null?void 0:i.recurringDays)||[]},validationErrors:{},isSubmitting:!1});if(!l)return null;const w=(E,_)=>{const[k,z]=E.split(":").map(Number),[M,G]=_.split(":").map(Number),X=k*60+z;return M*60+G-X},A=E=>{const _=Math.floor(E/60),k=E%60;return _===0?`${k} דקות`:_===1&&k===0?"שעה אחת":_===1?`שעה ו-${k} דקות`:k===0?`${_} שעות`:`${_} שעות ו-${k} דקות`},S=E=>{b(_=>({..._,formData:{..._.formData,...E},validationErrors:{}}))},C=E=>{const _={},{formData:k}=N;switch(E){case 0:k.day||(_.day="יש לבחור יום");break;case 1:if(k.startTime||(_.startTime="יש להזין שעת התחלה"),k.endTime||(_.endTime="יש להזין שעת סיום"),k.startTime&&k.endTime){const z=w(k.startTime,k.endTime);if(z<=0&&(_.timeRange="שעת הסיום חייבת להיות אחרי שעת ההתחלה"),z<30&&(_.timeRange="יום לימוד חייב להיות לפחות 30 דקות"),(!c||i&&(k.day!==i.day||k.startTime!==i.startTime||k.endTime!==i.endTime))&&(v!=null&&v.timeBlocks)&&v.timeBlocks.length>0){const G={day:k.day,startTime:k.startTime,endTime:k.endTime,location:k.location,notes:k.notes},X=c?v.timeBlocks.filter(te=>!(te.day===(i==null?void 0:i.day)&&te.startTime===(i==null?void 0:i.startTime)&&te.endTime===(i==null?void 0:i.endTime))):v.timeBlocks,W=$s.validateTimeBlockConflicts(G,X);if(W.hasConflict){const te=$s.getConflictDescription(W.conflictType,W.conflictingBlocks,G);_.timeRange=te}}}break;case 3:if(!c&&k.isRecurring&&k.recurringDays.length>0&&(v!=null&&v.timeBlocks)&&v.timeBlocks.length>0){const z=[];for(const M of k.recurringDays){const G={day:M,startTime:k.startTime,endTime:k.endTime,location:k.location,notes:k.notes};$s.validateTimeBlockConflicts(G,v.timeBlocks).hasConflict&&z.push(M)}z.length>0&&(_.submit=`קיימות התנגשות בימים הבאים: ${z.join(", ")}. אנא בחר ימים אחרים או שנה את שעות יום הלימוד.`)}break}return b(z=>({...z,validationErrors:_})),Object.keys(_).length===0},D=()=>{if(C(N.currentStep)){const E=[...N.steps];E[N.currentStep].isComplete=!0,E[N.currentStep].isActive=!1,N.currentStep<E.length-1&&(E[N.currentStep+1].isActive=!0,b(_=>({..._,currentStep:_.currentStep+1,steps:E})))}},I=()=>{if(N.currentStep>0){const E=[...N.steps];E[N.currentStep].isActive=!1,E[N.currentStep-1].isActive=!0,E[N.currentStep-1].isComplete=!1,b(_=>({..._,currentStep:_.currentStep-1,steps:E}))}},T=async()=>{if(C(N.currentStep)){b(E=>({...E,isSubmitting:!0})),y();try{if(c&&(i!=null&&i._id)){const E={day:N.formData.day,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes},_=await f(i._id,E);_&&(s==null||s(_))}else if(N.formData.isRecurring&&N.formData.recurringDays.length>0){const E=[],_=[N.formData.day,...N.formData.recurringDays];console.log("🔄 Creating time blocks for all days:",{originalDay:N.formData.day,recurringDays:N.formData.recurringDays,allDaysToCreate:_});for(const k of _){const z={day:k,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes};console.log(`📅 Creating time block for day: ${k}`);const M=await u(t,z);M?(E.push(M),console.log(`✅ Time block created successfully for ${k}`)):console.error(`❌ Failed to create time block for ${k}`)}console.log(`🎉 Created ${E.length} time blocks total:`,E.map(k=>k.day)),E.length>0&&(s==null||s(E))}else{const E={day:N.formData.day,startTime:N.formData.startTime,endTime:N.formData.endTime,location:N.formData.location,notes:N.formData.notes},_=await u(t,E);_&&(s==null||s(_))}}catch(E){console.error(`Failed to ${c?"update":"create"} time block:`,E),b(_=>({..._,validationErrors:{submit:String((E instanceof Error?E.message:E)||`שגיאה ב${c?"עדכון":"יצירת"} יום הלימוד`)}}))}finally{b(E=>({...E,isSubmitting:!1}))}}},R=()=>{const{currentStep:E,formData:_,validationErrors:k}=N;switch(E){case 0:return e.jsxs("div",{className:"day-selection-step",children:[e.jsx("h3",{children:"בחר יום ליום הלימוד"}),e.jsx("div",{className:"day-selector",children:An.map(z=>e.jsxs("button",{type:"button",className:`day-button ${_.day===z?"selected":""}`,onClick:()=>S({day:z}),children:[e.jsx($e,{className:"day-icon",size:20}),e.jsx("span",{children:z})]},z))}),k.day&&e.jsx("div",{className:"error-message",children:k.day})]});case 1:return e.jsxs("div",{className:"time-range-step",children:[e.jsx("h3",{children:"הגדר טווח זמן ליום הלימוד"}),(v==null?void 0:v.timeBlocks)&&(()=>{const z=v.timeBlocks.filter(M=>M.day===_.day&&M.isActive);return z.length>0?e.jsxs("div",{className:"existing-blocks-info",children:[e.jsxs("h4",{children:["ימי לימוד קיימים ביום ",_.day,":"]}),e.jsx("div",{className:"existing-blocks-list",children:z.map(M=>e.jsxs("div",{className:"existing-block-item",children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[M.startTime," - ",M.endTime]}),M.location&&e.jsxs("span",{children:["(",M.location,")"]})]},M._id))})]}):null})(),e.jsxs("div",{className:"time-inputs",children:[e.jsxs("div",{className:"time-input-group",children:[e.jsxs("label",{children:[e.jsx(Ve,{size:16}),"שעת התחלה"]}),e.jsx("input",{type:"time",value:_.startTime,onChange:z=>S({startTime:z.target.value}),className:`time-input ${k.startTime?"error":""}`}),k.startTime&&e.jsx("div",{className:"field-error",children:k.startTime})]}),e.jsx("div",{className:"time-separator",children:"-"}),e.jsxs("div",{className:"time-input-group",children:[e.jsxs("label",{children:[e.jsx(Ve,{size:16}),"שעת סיום"]}),e.jsx("input",{type:"time",value:_.endTime,onChange:z=>S({endTime:z.target.value}),className:`time-input ${k.endTime?"error":""}`}),k.endTime&&e.jsx("div",{className:"field-error",children:k.endTime})]})]}),_.startTime&&_.endTime&&e.jsx("div",{className:"duration-info",children:e.jsxs("div",{className:"duration-display",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:A(w(_.startTime,_.endTime))})]})}),k.timeRange&&e.jsx("div",{className:"error-message",children:k.timeRange})]});case 2:return e.jsxs("div",{className:"details-step",children:[e.jsx("h3",{children:"פרטים נוספים"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(gt,{size:16}),"מיקום (אופציונלי)"]}),e.jsxs("select",{value:_.location||"",onChange:z=>S({location:z.target.value}),className:"select-input",children:[e.jsx("option",{value:"",children:"בחר מיקום"}),xr.map(z=>e.jsx("option",{value:z,children:z},z))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"הערות (אופציונלי)"}),e.jsx("textarea",{value:_.notes||"",onChange:z=>S({notes:z.target.value}),placeholder:"הערות נוספות על יום הלימוד...",className:"textarea-input",rows:3})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"recurring-toggle",children:e.jsxs("label",{className:"recurring-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:_.isRecurring,onChange:z=>S({isRecurring:z.target.checked}),className:"recurring-checkbox"}),e.jsx("div",{className:"recurring-checkbox-custom",children:e.jsx(AT,{size:16})}),e.jsxs("div",{className:"recurring-text",children:[e.jsx("span",{className:"recurring-title",children:"שכפול לימים נוספים"}),e.jsx("span",{className:"recurring-description",children:"צור יום לימוד זהה בימים אחרים בשבוع"})]})]})}),_.isRecurring&&e.jsxs("div",{className:"recurring-days",children:[e.jsx("h4",{children:"בחר ימים נוספים:"}),e.jsx("div",{className:"recurring-day-selector",children:An.filter(z=>z!==_.day).map(z=>e.jsxs("label",{className:"day-checkbox",children:[e.jsx("input",{type:"checkbox",checked:_.recurringDays.includes(z),onChange:M=>{const G=M.target.checked?[..._.recurringDays,z]:_.recurringDays.filter(X=>X!==z);S({recurringDays:G})}}),e.jsx("span",{className:"checkbox-label",children:z})]},z))})]})]})]});case 3:return e.jsxs("div",{className:"review-step",children:[e.jsx("h3",{children:"סקירה לפני יצירה"}),e.jsxs("div",{className:"review-summary",children:[e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"זמן ומיקום"}),e.jsxs("div",{className:"summary-item",children:[e.jsx($e,{size:16}),e.jsx("span",{children:_.day})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Ve,{size:16}),e.jsxs("span",{children:[_.startTime," - ",_.endTime]}),e.jsxs("span",{children:["(",A(w(_.startTime,_.endTime)),")"]})]}),_.location&&e.jsxs("div",{className:"summary-item",children:[e.jsx(gt,{size:16}),e.jsx("span",{children:_.location})]})]}),_.isRecurring&&_.recurringDays.length>0&&e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"כל הימים שייווצרו"}),e.jsxs("div",{className:"recurring-days-list",children:[e.jsxs("span",{className:"recurring-day-tag original-day",children:[_.day," (מקורי)"]},_.day),_.recurringDays.map(z=>e.jsx("span",{className:"recurring-day-tag",children:z},z))]}),e.jsxs("div",{className:"total-days-info",children:['📅 סה"כ ייווצרו ',_.recurringDays.length+1," ימי לימוד"]})]}),_.notes&&e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"הערות"}),e.jsx("div",{className:"summary-item",children:e.jsx("span",{children:_.notes})})]})]}),k.submit&&e.jsx("div",{className:"error-message",children:k.submit})]});default:return null}};return e.jsx("div",{className:"time-block-creator-overlay",children:e.jsxs("div",{className:"time-block-creator",children:[e.jsxs("div",{className:"creator-header",children:[e.jsx("h2",{children:c?"עריכת יום לימוד":"יצירת יום לימוד חדש"}),e.jsx("button",{type:"button",className:"btn-icon close-btn",onClick:n,disabled:N.isSubmitting,"aria-label":"סגור",children:e.jsx(Nt,{size:20})})]}),m&&e.jsxs("div",{className:"error-banner",children:[e.jsx("span",{children:m}),e.jsx("button",{type:"button",onClick:y,children:"×"})]}),e.jsx("div",{className:"wizard-progress",children:N.steps.map((E,_)=>e.jsxs("div",{className:`progress-step ${E.isActive?"active":""} ${E.isComplete?"completed":""}`,children:[e.jsx("div",{className:"step-indicator",children:E.isComplete?e.jsx(Bo,{size:16}):_+1}),e.jsxs("div",{className:"step-info",children:[e.jsx("div",{className:"step-title",children:E.title}),e.jsx("div",{className:"step-description",children:E.description})]})]},E.id))}),e.jsx("div",{className:"wizard-content",children:e.jsx("div",{className:"wizard-step",children:R()})}),e.jsxs("div",{className:"wizard-navigation",children:[e.jsx("button",{type:"button",className:"nav-btn prev-btn",onClick:I,disabled:N.currentStep===0||N.isSubmitting,children:"הקודם"}),N.currentStep<N.steps.length-1?e.jsx("button",{type:"button",className:"nav-btn next-btn",onClick:D,disabled:N.isSubmitting,children:"הבא"}):e.jsx("button",{type:"button",className:"nav-btn create-btn",onClick:T,disabled:N.isSubmitting||p,children:N.isSubmitting||p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner"}),c?"מעדכן...":"יוצר..."]}):c?"עדכן יום לימוד":N.formData.isRecurring&&N.formData.recurringDays.length>0?`צור ${N.formData.recurringDays.length+1} ימי לימוד`:"צור יום לימוד"})]})]})})};function nN({teacherId:t,teacherName:s,onTimeBlockChange:n}){var O;const{currentTeacherSchedule:i,selectedTimeBlock:l,isLoading:c,error:u,loadTeacherSchedule:f,createTimeBlock:p,updateTimeBlock:m,deleteTimeBlock:y,setSelectedTimeBlock:v,clearError:j}=kl(),{teachers:N}=Ds(),[b,w]=x.useState(!1),[A,S]=x.useState(null),[C,D]=x.useState(!1),[I,T]=x.useState(null),[R,E]=x.useState(new Set),[_,k]=x.useState(!1);x.useEffect(()=>{t&&f(t)},[t,f]),x.useEffect(()=>{var Y,Z,H,P,q,B,se,ae,oe;const U=N.find(ce=>ce._id===t);if(U&&t){console.log("🔄 Teacher data changed, refreshing time block schedule...");const ce=((Z=(Y=U.teaching)==null?void 0:Y.studentIds)==null?void 0:Z.length)||0,Q=((P=(H=U.teaching)==null?void 0:H.schedule)==null?void 0:P.length)||0,ne=((B=(q=U.teaching)==null?void 0:q.timeBlocks)==null?void 0:B.length)||0,pe=((ae=(se=U.teaching)==null?void 0:se.timeBlocks)==null?void 0:ae.reduce((me,je)=>{var Oe;return me+(((Oe=je.assignedLessons)==null?void 0:Oe.length)||0)},0))||0;console.log("📊 Teacher-Student Sync Status:",{teacherId:t,teacherName:(oe=U.personalInfo)==null?void 0:oe.fullName,studentIds:ce,scheduleItems:Q,timeBlocks:ne,assignedLessons:pe,syncWorking:pe>0&&ce>0}),f(t)}},[N,t,s,f]),x.useEffect(()=>{i!=null&&i.timeBlocks&&n&&n(i.timeBlocks)},[i==null?void 0:i.timeBlocks,n]);const z=U=>{const Y=Math.floor(U/60),Z=U%60;return Y===0?`${Z} דקות`:Y===1&&Z===0?"שעה אחת":Y===1?`שעה ו-${Z} דקות`:Z===0?`${Y} שעות`:`${Y} שעות ו-${Z} דקות`};x.useEffect(()=>{j()},[j]),x.useEffect(()=>{const U=()=>{k(window.innerWidth<768)};return U(),window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U)}},[]);const M=()=>{S(null),w(!0)},G=U=>{S(U),w(!0)},X=U=>{T(U),D(!0)},W=async()=>{if(I)try{await y(I._id),D(!1),T(null)}catch(U){console.error("Failed to delete time block:",U)}},te=U=>{console.log("Time block created successfully:",U),w(!1),S(null),f(t)},L=()=>{if(!(i!=null&&i.timeBlocks))return{};const U={};return i.timeBlocks.forEach(Y=>{U[Y.day]||(U[Y.day]=[]),U[Y.day].push(Y)}),Object.keys(U).forEach(Y=>{U[Y].sort((Z,H)=>Z.startTime.localeCompare(H.startTime))}),U},J=U=>e.jsxs("div",{className:"lesson-assignment",children:[e.jsxs("div",{className:"assignment-info",children:[e.jsx("div",{className:"student-info",children:e.jsx("span",{children:U.studentName})}),e.jsx("div",{className:"assignment-time",children:e.jsxs("span",{children:[U.lessonStartTime," - ",U.lessonEndTime," (",z(U.duration),")"]})})]}),U.notes&&e.jsx("div",{className:"assignment-notes",title:U.notes,children:U.notes.length>30?`${U.notes.substring(0,30)}...`:U.notes})]},U._id),K=U=>{const Y=R.has(U._id),Z=U.assignedLessons.length>0;return e.jsxs("div",{className:`time-block-card ${U.isActive?"":"inactive"}`,children:[e.jsx("div",{className:"card-day-header",children:e.jsx("h4",{children:U.day})}),e.jsxs("div",{className:"time-block-header",children:[e.jsx("div",{className:"block-time-info",children:e.jsxs("span",{children:[U.startTime," - ",U.endTime]})}),e.jsxs("div",{className:"block-actions",children:[e.jsx("button",{type:"button",className:"action-btn edit-btn",onClick:()=>G(U),title:"ערוך יום לימוד",children:e.jsx(Fo,{size:14})}),e.jsx("button",{type:"button",className:"action-btn delete-btn",onClick:()=>X(U),title:"מחק יום לימוד",children:e.jsx(Ft,{size:14})})]})]}),U.location&&e.jsx("div",{className:"block-location",children:e.jsx("span",{children:U.location})}),Y&&e.jsxs("div",{className:"block-details",children:[Z?e.jsxs("div",{className:"assigned-lessons",children:[e.jsx("h5",{children:"שיעורים מוקצים:"}),U.assignedLessons.map(J)]}):e.jsx("div",{className:"no-assignments",children:e.jsx("span",{children:"אין שיעורים מוקצים"})}),U.notes&&e.jsxs("div",{className:"block-notes",children:[e.jsx("strong",{children:"הערות:"}),e.jsx("span",{children:U.notes})]})]})]},U._id)};L();const le=((O=i==null?void 0:i.timeBlocks)==null?void 0:O.length)||0;return c&&!i?e.jsx("div",{className:"time-block-manager loading",children:e.jsx("span",{children:"טוען ימי לימוד..."})}):e.jsxs("div",{className:"teacher-time-block-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("div",{className:"header-info",children:e.jsxs("h3",{children:["ימי לימוד - ",s]})}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{type:"button",className:"btn primary",onClick:M,disabled:c,children:"הוסף יום לימוד"})})]}),u&&e.jsx("div",{className:"error-banner",children:e.jsx("span",{children:u})}),le===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h4",{children:"אין ימי לימוד"}),e.jsx("p",{children:"לא הוגדרו עדיין ימי לימוד עבור המורה הזה"}),e.jsx("button",{type:"button",className:"btn primary",onClick:M,children:"צור יום לימוד ראשון"})]}):e.jsx("div",{className:"time-blocks-container",children:i==null?void 0:i.timeBlocks.map(K)}),b&&e.jsx(aN,{teacherId:t,onBlockCreated:te,onCancel:()=>w(!1),initialData:A?{_id:A._id,day:A.day,startTime:A.startTime,endTime:A.endTime,location:A.location,notes:A.notes}:void 0,isOpen:b}),e.jsx(ps,{isOpen:C,onClose:()=>D(!1),onConfirm:W,title:"מחיקת יום לימוד",message:`האם אתה בטוח שברצונך למחוק את יום הלימוד ביום ${I==null?void 0:I.day} בשעה ${I==null?void 0:I.startTime}?`,confirmText:"מחק",cancelText:"ביטול",type:"danger"})]})}const rN=["מורה","מנצח","מדריך הרכב","מנהל","מורה תאוריה","מגמה"],T$=Au,iN=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],E$=[30,45,60],_j=(t,s)=>Lm().when("roles",{is:n=>n&&Array.isArray(n)&&t.some(i=>n.includes(i)),then:()=>s,otherwise:()=>Lm().notRequired()}),A$=at().shape({studentId:Ce().required("קוד תלמיד הוא שדה חובה"),day:Ce().required("יום הוא שדה חובה").oneOf(iN,"יום לא תקין"),time:Ce().required("שעה היא שדה חובה").matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט זמן לא תקין (HH:MM)"),duration:Pa().required("משך הוא שדה חובה").oneOf(E$,"משך שיעור לא תקין"),isActive:Ra().default(!0)}),C$=at().shape({personalInfo:at().shape({fullName:Ce().required("שם מלא הוא שדה חובה"),phone:Ce().required("טלפון הוא שדה חובה").matches(/^05\d{8}$/,"מספר טלפון לא תקין (צריך להתחיל ב-05 ולכלול 10 ספרות)"),email:Ce().required('דוא"ל הוא שדה חובה').email('כתובת דוא"ל לא תקינה'),address:Ce().required("כתובת היא שדה חובה")}),roles:es().of(Ce().oneOf(rN)).min(1,"יש לבחור לפחות תפקיד אחד").required("תפקידים הם שדה חובה"),professionalInfo:at().shape({instrument:_j(["מורה","מורה תאוריה"],Ce().required("כלי נגינה הוא שדה חובה למורה").oneOf(Au,"כלי נגינה לא תקין")),isActive:Ra().default(!0)}),teaching:at().shape({studentIds:es().of(Ce()),schedule:es().of(A$)}),conducting:at().shape({orchestraIds:_j(["מנצח"],es().of(Ce()))}),ensemblesIds:es().of(Ce()),schoolYears:es().of(at().shape({schoolYearId:Ce().required("קוד שנת לימוד הוא שדה חובה"),isActive:Ra().default(!0)})),credentials:at().when("_id",{is:t=>!t,then:()=>at().shape({email:Ce().required('דוא"ל הוא שדה חובה').email('כתובת דוא"ל לא תקינה')}),otherwise:()=>at()}),isActive:Ra().default(!0)}),Oj={personalInfo:{fullName:"",phone:"",email:"",address:""},roles:["מורה"],professionalInfo:{instrument:"",isActive:!0},teaching:{studentIds:[],schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[],schoolYears:[],credentials:{email:""},isActive:!0};function D$({isOpen:t,onClose:s,teacher:n,onSave:i,onAddNewStudent:l,newlyCreatedStudent:c}){console.log("TeacherForm received teacher:",n||"none (new teacher)");const{modalProps:u,titleProps:f,descriptionProps:p}=Cl({isOpen:t,onClose:s,modalId:"teacher-form",restoreFocusOnClose:!0}),[m,y]=x.useState("teacher_form"),[v,j]=x.useState(!1),[N,b]=x.useState([]),[w,A]=x.useState(!1),[S,C]=x.useState(!1),[D,I]=x.useState(null),[T,R]=x.useState(null),[E,_]=x.useState(!1),[k,z]=x.useState(null),[M,G]=x.useState(!1),{saveTeacher:X,isLoading:W}=Ds(),{currentSchoolYear:te}=za(),{addToast:L,showError:J}=Ot(),{user:K,isAuthenticated:le}=ys(),O=Al(K,le),U=br(O),Y=()=>U.isAdmin(),Z=()=>{R(null),_(!1),z(null),G(!1)},H=async Q=>{if(k){G(Q),_(!1);try{const ne={...k,forceCreate:Q,adminOverride:Q&&Y()};await ae(ne)}catch(ne){console.error("Error in duplicate confirmation:",ne),J(ne)}}},P=()=>{Z()},q=!(n!=null&&n._id),B=()=>{y("teacher_form"),s()};x.useEffect(()=>{t&&y("teacher_form")},[t]);const se=x.useCallback(()=>{var Q,ne,pe,me,je,Oe,De,be,Te,Be;return n!=null&&n._id?{_id:n._id,personalInfo:{fullName:((Q=n.personalInfo)==null?void 0:Q.fullName)||"",phone:((ne=n.personalInfo)==null?void 0:ne.phone)||"",email:((pe=n.personalInfo)==null?void 0:pe.email)||"",address:((me=n.personalInfo)==null?void 0:me.address)||""},roles:n.roles||["מורה"],professionalInfo:{instrument:((je=n.professionalInfo)==null?void 0:je.instrument)||"",isActive:((Oe=n.professionalInfo)==null?void 0:Oe.isActive)!==!1},teaching:{studentIds:((De=n.teaching)==null?void 0:De.studentIds)||[],schedule:((be=n.teaching)==null?void 0:be.schedule)||[]},conducting:{orchestraIds:((Te=n.conducting)==null?void 0:Te.orchestraIds)||[]},ensemblesIds:n.ensemblesIds||[],schoolYears:n.schoolYears||[],credentials:{email:((Be=n.personalInfo)==null?void 0:Be.email)||""},isActive:n.isActive!==!1}:{...Oj,credentials:{...Oj.credentials,email:""},schoolYears:te?[{schoolYearId:te._id,isActive:!0}]:[]}},[n,te]);x.useEffect(()=>{const Q=()=>{C(window.innerWidth<768)};return Q(),window.addEventListener("resize",Q),()=>{window.removeEventListener("resize",Q)}},[]),x.useEffect(()=>{(async()=>{A(!0);try{const ne=await Ia.getOrchestras({isActive:!0});b(ne)}catch(ne){console.error("Failed to load orchestras:",ne)}finally{A(!1)}})()},[]);const ae=async Q=>{var me,je,Oe,De,be,Te;const ne=Q._id;let pe;if(ne?pe=await X(Q,ne):pe=await X(Q),ne)L({type:"success",message:`המורה ${((me=Q.personalInfo)==null?void 0:me.fullName)||"המורה"} עודכן בהצלחה`});else if(((je=pe.invitationInfo)==null?void 0:je.mode)==="DEFAULT_PASSWORD"){const Be=((Oe=pe.credentials)==null?void 0:Oe.email)||pe.personalInfo.email,V=pe.invitationInfo.defaultPassword;L({type:"success",message:`מורה נוצר בהצלחה!
פרטי התחברות:
אימייל: ${Be}
סיסמה: ${V}
(המורה יידרש לשנות סיסמה בכניسה הראשונה)`,autoClose:!1})}else L({type:"success",message:`הזמנה נשלחה בהצלחה ל-${((De=Q.personalInfo)==null?void 0:De.email)||"המורה"}`});return Z(),ne&&((Te=(be=Q.teaching)==null?void 0:be.studentIds)==null?void 0:Te.length)>0&&console.log("🔄 Teacher updated with student assignments, will refresh time blocks in UI"),i&&i(),B(),pe},oe=async(Q,{setSubmitting:ne,setValues:pe})=>{var je,Oe,De;I(null),Z();try{Q._id?U.validateAction("update",n,"teacher"):U.validateAction("add",void 0,"teacher")}catch(be){const Te=ts(be);I(Te.userMessage),ne(!1);return}let me;try{q&&Q.credentials.email!==Q.personalInfo.email&&(Q={...Q,credentials:{...Q.credentials,email:Q.personalInfo.email}},pe(Q,!1));const be=Q._id;if(be)console.log("🔧 FIXED VERSION LOADED - Update path with _id:",be),console.log("👤 Current user ID:",K==null?void 0:K._id),console.log("👤 Current user roles:",K==null?void 0:K.roles),console.log("🎯 Target teacher ID:",be),console.log("🛡️ Is admin:",Y()),console.log("🛡️ Can edit teacher:",U.canEditTeacher({_id:be})),me={_id:be,personalInfo:Q.personalInfo,roles:Q.roles,professionalInfo:Q.professionalInfo,isActive:Q.isActive},Q.teaching&&Q.teaching.studentIds.length>0&&(me.teaching={studentIds:Q.teaching.studentIds},Q.teaching.schedule.length>0&&(me.teaching.schedule=Q.teaching.schedule)),Q.conducting&&Q.conducting.orchestraIds.length>0&&(me.conducting={orchestraIds:Q.conducting.orchestraIds}),Q.ensemblesIds&&Q.ensemblesIds.length>0&&(me.ensemblesIds=Q.ensemblesIds);else{const{_id:Te,...Be}=Q;me=Be}te&&!((je=me.schoolYears)!=null&&je.some(Te=>Te.schoolYearId===te._id))&&(me.schoolYears=[...me.schoolYears||[],{schoolYearId:te._id,isActive:!0}]),M&&(me.forceCreate=!0,me.adminOverride=Y()),await ae(me)}catch(be){if(console.error("Error saving teacher:",be),((Oe=be==null?void 0:be.response)==null?void 0:Oe.status)===403||(be==null?void 0:be.status)===403){console.error("🚨 Permission denied error:",be),L({type:"danger",message:"אין לך הרשאה לערוך מורה זה. רק מנהלים יכולים לערוך מורים אחרים, או שהמורה יכול לערוך את עצמו."});return}const Te=((De=be==null?void 0:be.response)==null?void 0:De.data)||be;if((Te==null?void 0:Te.code)==="DUPLICATE_TEACHER_DETECTED"&&(Te!=null&&Te.details)){const Be=Te.details;R({blocked:Be.blocked||!1,reason:Be.reason||"נמצאו כפילויות במערכת",duplicates:Be.duplicates||[],warnings:Be.warnings||Be.potentialDuplicates||[],canOverride:Be.canOverride||Y(),adminOverride:Be.adminOverride||!1}),z(JSON.parse(JSON.stringify(me))),_(!0)}else J(be),I(null)}finally{ne(!1)}};if(!t)return null;const ce=()=>{switch(m){case"teacher_form":default:return e.jsxs("div",{className:"teacher-form-view",children:[e.jsxs("div",{className:"teacher-modal-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:B,"aria-label":"סגור",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...f,children:n!=null&&n._id?"עריכת מורה":"הוספת מורה חדש"})]}),D&&e.jsxs("div",{className:"api-error-banner",children:[e.jsxs("div",{className:"error-content",children:[e.jsx(Bs,{size:16}),e.jsx("span",{children:D})]}),e.jsx("button",{type:"button",onClick:()=>I(null),className:"error-close-btn","aria-label":"סגור הודעת שגיאה",children:e.jsx(Nt,{size:14})})]}),e.jsx(yr,{initialValues:se(),validationSchema:C$,onSubmit:oe,enableReinitialize:!0,validateOnMount:!1,children:({isSubmitting:Q,values:ne,setFieldValue:pe,errors:me,touched:je})=>{var Ne,_e,Ie,Ue,It;const Oe=ne.roles.includes("מנצח"),De=ne.roles.includes("מורה")||ne.roles.includes("מורה תאוריה"),{selectedStudents:be,getFilteredStudents:Te,handleAddStudent:Be,handleRemoveStudent:V}=N$({initialStudentIds:ne.teaching.studentIds,onStudentIdsChange:qe=>{console.log("📝 Updating form studentIds:",qe),pe("teaching.studentIds",qe)},onAddScheduleItem:qe=>{const mt={studentId:qe,day:iN[0],time:"08:00",duration:45,isActive:!0};console.log("➕ Adding schedule item for student:",qe),pe("teaching.schedule",[...ne.teaching.schedule,mt])},onRemoveScheduleItem:qe=>{const mt=ne.teaching.schedule.filter($t=>$t.studentId!==qe);console.log("🗑️ Removing schedule item for student:",qe),console.log("📋 Updated schedule items:",mt.length),pe("teaching.schedule",mt)}});x.useEffect(()=>{c&&(console.log("Adding newly created student:",c),Be(c))},[c]),Te();const ue=qe=>{console.log("🔄 Starting student removal process for:",qe),V(qe),setTimeout(()=>{ve(),console.log("✅ Student removal completed for:",qe)},100)};x.useEffect(()=>{q&&pe("credentials.email",ne.personalInfo.email,!1)},[ne.personalInfo.email,q,pe]);const ve=()=>q&&ne.credentials.email!==ne.personalInfo.email?(pe("credentials.email",ne.personalInfo.email,!0),!1):!0;return e.jsxs(In,{children:[e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"פרטים אישיים"}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"שם מלא",name:"personalInfo.fullName",type:"text",required:!0,disabled:Q})}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsx(Me,{label:"טלפון",name:"personalInfo.phone",type:"tel",placeholder:"05XXXXXXXX",required:!0,disabled:Q}),e.jsx(Me,{label:'דוא"ל',name:"personalInfo.email",type:"email",required:!0,disabled:Q})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"כתובת",name:"personalInfo.address",type:"text",required:!0,disabled:Q})})]}),e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"תפקידים"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:me.roles&&je.roles?"required-field is-invalid":"required-field",children:["תפקידים ",!Y()&&(n==null?void 0:n._id)&&e.jsx("span",{className:"readonly-indicator",children:"(צפייה בלבד)"})]}),e.jsx("div",{className:"checkbox-group",children:rN.map(qe=>e.jsxs("div",{className:"checkbox-item",children:[e.jsx("input",{type:"checkbox",id:`role-${qe}`,name:"roles",value:qe,checked:ne.roles.includes(qe),onChange:mt=>{const{value:$t,checked:Pt}=mt.target;let yt=[...ne.roles];Pt?yt.includes($t)||yt.push($t):(yt=yt.filter(xi=>xi!==$t),yt.length===0&&(yt=["מורה"])),pe("roles",yt)},disabled:Q||!Y()&&!!(n!=null&&n._id)}),e.jsx("label",{htmlFor:`role-${qe}`,children:qe})]},qe))}),me.roles&&je.roles&&e.jsx("div",{className:"form-error",children:me.roles})]})}),e.jsxs("div",{className:"form-row narrow-fields",children:[De&&e.jsxs(Me,{label:"כלי נגינה (למורה)",name:"professionalInfo.instrument",as:"select",required:De,disabled:Q,children:[e.jsx("option",{value:"",disabled:!0,children:"בחר כלי נגינה"}),T$.map(qe=>e.jsx("option",{value:qe,children:qe},qe))]}),Oe&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"orchestras",children:"תזמורות (למנצח)"}),e.jsx("select",{id:"orchestras",name:"conducting.orchestraIds",multiple:!0,value:ne.conducting.orchestraIds,onChange:qe=>{const mt=Array.from(qe.target.selectedOptions).map($t=>$t.value);pe("conducting.orchestraIds",mt)},className:(Ne=me.conducting)!=null&&Ne.orchestraIds&&((_e=je.conducting)!=null&&_e.orchestraIds)?"is-invalid":"",disabled:Q||w,children:w?e.jsx("option",{disabled:!0,children:"טוען תזמורות..."}):N.length>0?N.map(qe=>e.jsx("option",{value:qe._id,children:qe.name},qe._id)):e.jsx("option",{disabled:!0,children:"אין תזמורות זמינות"})}),e.jsx("small",{className:"select-hint",children:S?"לחץ והחזק על מספר אפשרויות לבחירה מרובה":"ניתן לבחור מספר תזמורות (לחיצה על CTRL + לחיצה על תזמורת)"}),((Ie=me.conducting)==null?void 0:Ie.orchestraIds)&&((Ue=je.conducting)==null?void 0:Ue.orchestraIds)&&e.jsx("div",{className:"form-error",children:me.conducting.orchestraIds})]})]})]}),De&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"תלמידים"}),be.length>0?e.jsx("div",{className:"teacher-students-responsive-grid",children:be.map(qe=>{var $t;const mt=($t=qe.teacherAssignments)==null?void 0:$t.find(Pt=>Pt.teacherId===(n==null?void 0:n._id));return e.jsx("div",{className:"student-card-preview",children:e.jsxs("div",{className:"preview-header",children:[e.jsxs("div",{className:"student-info",children:[e.jsx("h4",{className:"student-name",children:qe.personalInfo.fullName}),e.jsx("div",{className:"student-lesson-details",children:mt?e.jsxs("span",{children:[mt.day," ",mt.time," | ",mt.duration," דקות"]}):e.jsx("span",{children:"לא מוקצה זמן שיעור"})})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{type:"button",className:"action-btn edit",onClick:Pt=>{Pt.stopPropagation(),window.location.href=`/students/${qe._id}`},"aria-label":"עדכן שיעור",disabled:Q,children:e.jsx("span",{style:{display:"flex",width:"14px",height:"14px"},children:e.jsx(ba,{size:14,style:{width:"14px",height:"14px",minWidth:"14px",minHeight:"14px"}})})}),e.jsx("button",{type:"button",className:"action-btn delete",onClick:Pt=>{Pt.stopPropagation(),ue(qe._id)},"aria-label":"מחק שיעור",disabled:Q,children:e.jsx("span",{style:{display:"flex",width:"14px",height:"14px"},children:e.jsx(Ft,{size:14,style:{width:"14px",height:"14px",minWidth:"14px",minHeight:"14px"}})})})]})]})},qe._id)})}):e.jsx("div",{className:"no-students-message",children:e.jsx("p",{children:"אין תלמידים מוקצים למורה זה"})})]}),(n==null?void 0:n._id)&&De&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"ימי לימוד"}),e.jsx("div",{className:"teacher-timeblocks-responsive-grid",children:e.jsx(nN,{teacherId:n._id,teacherName:((It=n.personalInfo)==null?void 0:It.fullName)||"מורה לא ידוע",onTimeBlockChange:qe=>{console.log("Time blocks updated:",qe)}})})]}),q&&e.jsxs("div",{className:"form-section-full-width",children:[e.jsx("h3",{children:"הזמנה למערכת"}),e.jsxs("div",{className:"invitation-info-card",children:[e.jsx("div",{className:"invitation-icon",children:e.jsx(On,{size:24})}),e.jsxs("div",{className:"invitation-content",children:[e.jsx("h4",{children:"הזמנה תישלח אוטומטית"}),e.jsxs("p",{children:['לאחר שמירת המורה, תישלח הזמנה אוטומטית לכתובת הדוא"ל ',e.jsx("strong",{children:ne.personalInfo.email})]}),e.jsx("p",{children:"המורה יקבל קישור להגדרת סיסמה ויוכל להתחבר למערכת"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",onClick:()=>ve(),disabled:W||Q,children:W||Q?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:B,disabled:Q,children:"ביטול"})]})]})}})]})}};return e.jsxs(Ua,{isOpen:t,onClose:B,className:"teacher-form responsive-form",children:[e.jsxs("div",{className:"form-modal",...u,children:[e.jsx("div",{...p,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי מורה קיים במערכת":"טופס הוספת מורה חדש למערכת"}),ce()]}),T&&e.jsx(S$,{isOpen:E,onClose:()=>_(!1),duplicateInfo:T,onConfirm:H,onCancel:P,isAdmin:Y(),isSubmitting:W})]})}function k$(){const{teachers:t,isLoading:s,error:n,loadTeachers:i,removeTeacher:l,clearSelectedTeacher:c,setSelectedTeacher:u,selectedTeacher:f}=Ds(),p=_t(),m=gs(),{user:y,isAuthenticated:v}=ys(),{addToast:j}=Ot(),[N,b]=x.useState(!1),[w,A]=x.useState(!1),[S,C]=x.useState(null),[D,I]=x.useState(!1),[T,R]=x.useState(null),[E,_]=x.useState(null),[k,z]=x.useState(null),[M,G]=x.useState(!1),X=x.useMemo(()=>je=>{var Oe;return[je.personalInfo.fullName,((Oe=je.professionalInfo)==null?void 0:Oe.instrument)||"",je.personalInfo.email||"",je.personalInfo.phone||""]},[]),W=x.useMemo(()=>t.filter(je=>je._id!==(y==null?void 0:y._id)),[t,y==null?void 0:y._id]),{filteredEntities:te,handleSearch:L,filters:J,handleApplyFilters:K,hasActiveFilters:le,availableInstruments:O}=bu(W,X,je=>{var Oe;return((Oe=je.professionalInfo)==null?void 0:Oe.instrument)||""},void 0,void 0,je=>je.personalInfo.fullName),U=Al(y,v),Y=br(U);Y.isAdmin();const Z=m.pathname.includes("/teachers/")&&!m.pathname.endsWith("/teachers/");x.useEffect(()=>{i()},[i]),x.useEffect(()=>{var je;console.log("Current selectedTeacher state in store:",f?(je=f.personalInfo)==null?void 0:je.fullName:"null")},[f]),x.useEffect(()=>{N||(console.log("Form closed, clearing teacher state"),C(null),c(),_(null))},[N,c]);const H=()=>{try{Y.validateAction("add",void 0,"teacher"),console.log("Adding new teacher, clearing previous teacher data"),c(),C(null),_(null),b(!1),setTimeout(()=>{console.log("Opening empty teacher form"),b(!0)},10)}catch(je){const Oe=ts(je);j({type:"warning",message:Oe.userMessage,autoCloseTime:4e3})}},P=()=>{console.log("Closing teacher form"),b(!1)},q=je=>{je&&z({fullName:je.fullName,instrument:je.instrument}),A(!0)},B=()=>{A(!1),z(null)},se=je=>{_(je),A(!1),b(!0)},ae=je=>{var De;const Oe=t.find(be=>be._id===je)||null;if(Oe)try{Y.validateAction("edit",Oe,"teacher"),console.log("Editing teacher:",(De=Oe==null?void 0:Oe.personalInfo)==null?void 0:De.fullName),C(Oe),u(Oe),b(!0)}catch(be){const Te=ts(be);j({type:"warning",message:Te.userMessage,autoCloseTime:4e3})}},oe=je=>{p(`/teachers/${je}`)},ce=je=>{const Oe=t.find(De=>De._id===je);if(Oe)try{Y.validateAction("delete",Oe,"teacher"),R(je),I(!0)}catch(De){const be=ts(De);j({type:"warning",message:be.userMessage,autoCloseTime:4e3})}},Q=async()=>{if(T)try{await l(T),R(null),I(!1),j({type:"success",message:"המורה נמחק בהצלחה",autoCloseTime:3e3})}catch(je){console.error("Failed to remove teacher:",je);const Oe=ts(je);j({type:"danger",message:Oe.userMessage,autoCloseTime:5e3})}},ne=()=>{G(!M)},pe=Y.canAddTeacher(),me=()=>{console.log("Teacher saved successfully, cleaning up form state"),b(!1),C(null),_(null),i()};return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!Z&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(rc,{onSearch:L,placeholder:"חיפוש מורים..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${le?"active":""}`,onClick:ne,"aria-label":"סנן מורים",children:[e.jsx(hi,{className:"icon"}),le&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:M,onToggle:()=>G(!M),onApplyFilters:K,availableInstruments:O,classRange:void 0,currentFilters:J,hasActiveFilters:le,entityType:"teachers"})]}),pe&&e.jsx("button",{className:"btn-icon add-btn",onClick:H,"aria-label":"הוספת מורה חדש",children:e.jsx(fs,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!Z&&e.jsx(b$,{teachers:te,isLoading:s,onEdit:ae,onView:oe,onRemove:ce,authContext:U}),e.jsx(wl,{context:{loadTeachers:i}}),e.jsx(ps,{isOpen:D,onClose:()=>I(!1),onConfirm:Q,title:"מחיקת מורה",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המורה?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),N&&e.jsx(D$,{isOpen:N,onClose:P,teacher:S||void 0,onSave:me,onAddNewStudent:q,newlyCreatedStudent:E}),e.jsx(Kb,{isOpen:w,onClose:B,onStudentCreated:se,newTeacherInfo:k})]}),!Z&&!N&&e.jsx(mi,{})]})}function _$({teacher:t,theoryLessons:s,theoryLessonsLoading:n,isOpen:i,onToggle:l,onTheoryLessonClick:c}){const u=x.useRef(!1),[f,p]=x.useState([]),[m,y]=x.useState({}),v=s&&s.length>0;x.useEffect(()=>{if(!n&&!u.current&&!v){const b=Array(3).fill(null).map((w,A)=>({_id:`placeholder-${A}`,category:"שיעור העשרה",isPlaceholder:!0}));p(b),u.current=!0}},[s,n,v]),x.useEffect(()=>()=>{u.current=!1},[t._id]),x.useEffect(()=>{async function b(){if(!s||s.length===0)return;const w={};s.forEach(A=>{var S;w[A._id]=((S=A.studentIds)==null?void 0:S.length)||0}),y(w)}b()},[s]);const j=!v&&!n&&f.length>0,N=(b,w,A)=>`יום ${["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][b]||"לא ידוע"} ${w}-${A}`;return e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${i?"active":""}`,onClick:l,children:[e.jsx(Zt,{size:16}),e.jsxs("span",{children:["שיעורי העשרה ",v?`(${s.length})`:""]}),i?e.jsx(Bt,{size:18,className:"td-toggle-icon"}):e.jsx(bt,{size:18,className:"td-toggle-icon"})]}),i&&e.jsx("div",{className:"td-section-content",children:n?e.jsxs("div",{className:"td-loading-indicator",children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"טוען שיעורי העשרה..."})]}):!v&&j?e.jsx("div",{className:"td-theory-lessons-grid",children:f.map(b=>e.jsxs("div",{className:"td-theory-lesson-card td-theory-lesson-placeholder",children:[e.jsx(Zt,{size:20}),e.jsx("span",{children:b.category})]},b._id))}):v?e.jsx("div",{className:"td-theory-lessons-grid",children:s.map(b=>e.jsxs("div",{className:"td-theory-lesson-card clickable",onClick:()=>c(b._id),children:[e.jsxs("div",{className:"td-theory-lesson-header",children:[e.jsx(Zt,{size:20}),e.jsx("span",{className:"td-theory-lesson-category",children:b.category})]}),e.jsxs("div",{className:"td-theory-lesson-details",children:[b.dayOfWeek!==void 0&&b.startTime&&b.endTime&&e.jsx("div",{className:"td-theory-lesson-schedule",children:e.jsx("span",{children:N(b.dayOfWeek,b.startTime,b.endTime)})}),b.location&&e.jsx("div",{className:"td-theory-lesson-location",children:e.jsxs("span",{children:["מיקום: ",b.location]})}),e.jsx("div",{className:"td-theory-lesson-students",children:e.jsxs("span",{children:["תלמידים: ",m[b._id]||0]})})]})]},b._id))}):e.jsx("div",{className:"td-empty-state",children:"המורה אינו מלמד שיעורי העשרה"})})]})}const O$=({teacherId:t,teacherName:s,onTimeBlockChange:n,readOnly:i=!1,className:l="",isAdmin:c=!1})=>{const{currentTeacherSchedule:u,selectedTimeBlock:f,isLoading:p,error:m,loadTeacherSchedule:y,createTimeBlock:v,updateTimeBlock:j,deleteTimeBlock:N,setSelectedTimeBlock:b,clearError:w}=kl(),[A,S]=x.useState(!1),[C,D]=x.useState(null),[I,T]=x.useState(!1),[R,E]=x.useState(null),[_,k]=x.useState("blocks"),[z,M]=x.useState(null);x.useEffect(()=>{!c&&_==="stats"&&k("blocks")},[c,_]),x.useEffect(()=>{t&&y(t)},[t,y]),x.useEffect(()=>{u!=null&&u.timeBlocks&&n&&n(u.timeBlocks)},[u==null?void 0:u.timeBlocks,n]);const G=H=>{const P=Math.floor(H/60),q=H%60;return P===0?`${q} דקות`:P===1&&q===0?"שעה אחת":P===1?`שעה ו-${q} דקות`:q===0?`${P} שעות`:`${P} שעות ו-${q} דקות`};x.useEffect(()=>{w()},[w]);const X=()=>{D(null),S(!0)},W=H=>{D(H),S(!0)},te=H=>{E(H),T(!0)},L=async()=>{if(R)try{console.log("Attempting to delete time block:",R._id);const H=await N(R._id);console.log("Delete result:",H),T(!1),E(null),y(t)}catch(H){console.error("Failed to delete time block:",H),console.error("Delete error details:",{timeBlockId:R._id,error:H}),T(!1),E(null)}},J=()=>{S(!1),D(null),y(t)},K=()=>{if(!(u!=null&&u.timeBlocks))return{};const H={};return u.timeBlocks.forEach(P=>{H[P.day]||(H[P.day]=[]),H[P.day].push(P)}),Object.keys(H).forEach(P=>{H[P].sort((q,B)=>q.startTime.localeCompare(B.startTime))}),H},le=H=>{if(H.totalDuration===0)return 0;const P=H.totalDuration-H.availableMinutes;return Math.round(P/H.totalDuration*100)},O=H=>e.jsxs("div",{className:"lesson-assignment",children:[e.jsxs("div",{className:"assignment-info",children:[e.jsxs("div",{className:"student-info",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:H.studentName})]}),e.jsxs("div",{className:"assignment-time",children:[e.jsx(Ve,{size:12}),e.jsxs("span",{children:[H.lessonStartTime," - ",H.lessonEndTime]}),e.jsxs("span",{className:"duration",children:["(",G(H.duration),")"]})]})]}),H.notes&&e.jsx("div",{className:"assignment-notes",title:H.notes,children:H.notes.length>30?`${H.notes.substring(0,30)}...`:H.notes})]},H._id),U=H=>{const P=(f==null?void 0:f._id)===H._id,q=le(H),B=H.assignedLessons.length>0;return e.jsxs("div",{className:`time-block-card ${P?"selected":""} ${H.isActive?"":"inactive"}`,onClick:()=>b(H),children:[e.jsxs("div",{className:"time-block-header",children:[e.jsxs("div",{className:"block-time",children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[H.startTime," - ",H.endTime]}),e.jsxs("span",{className:"duration",children:["(",G(H.totalDuration),")"]})]}),e.jsx("div",{className:"block-actions",children:!i&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"edit-btn",onClick:se=>{se.stopPropagation(),W(H)},title:"ערוך יום לימוד",children:e.jsx(Fo,{size:14})}),e.jsx("button",{type:"button",className:"delete-btn",onClick:se=>{se.stopPropagation(),te(H)},title:"מחק יום לימוד",children:e.jsx(Ft,{size:14})})]})})]}),e.jsxs("div",{className:"utilization-bar",children:[e.jsx("div",{className:"utilization-fill",style:{width:`${q}%`}}),e.jsxs("span",{className:"utilization-text",children:[q,"% תפוסה"]})]}),H.location&&e.jsxs("div",{className:"block-location",children:[e.jsx(gt,{size:12}),e.jsx("span",{children:H.location})]}),e.jsx("div",{className:"availability-info",children:e.jsxs("span",{className:"available-time",children:["זמין: ",G(H.availableMinutes)]})}),B?e.jsxs("div",{className:"assigned-lessons",children:[e.jsx("h5",{children:"שיעורים מוקצים:"}),H.assignedLessons.map(O)]}):e.jsxs("div",{className:"no-assignments",children:[e.jsx(Et,{size:14,color:"green"}),e.jsx("span",{children:"אין שיעורים מוקצים"})]}),H.notes&&e.jsx("div",{className:"block-notes",title:H.notes,children:e.jsx("span",{children:H.notes.length>50?`${H.notes.substring(0,50)}...`:H.notes})})]},H._id)},Y=()=>{const H=K(),P=An.filter(q=>(H[q]||[]).length>0);return e.jsx("div",{className:"time-blocks-view",children:P.length===0?e.jsx("div",{className:"no-working-days",children:e.jsxs("div",{className:"no-blocks-message",children:[e.jsx($e,{size:32}),e.jsx("h4",{children:"אין ימי לימוד"}),e.jsx("p",{children:"למורה זה אין ימי לימוד מוגדרים"})]})}):P.map(q=>{const B=H[q]||[];return e.jsxs("div",{className:"day-column",children:[e.jsxs("div",{className:"day-header",children:[e.jsx("h4",{children:q}),e.jsxs("span",{className:"block-count",children:["(",B.length,")"]}),!i&&e.jsx("button",{type:"button",className:"add-block-btn",onClick:()=>{M(q),X()},title:"הוסף יום לימוד",children:e.jsx(fs,{size:14})})]}),e.jsx("div",{className:"day-blocks",children:B.map(U)})]},q)})})},Z=()=>{if(!u)return null;const{weeklyStats:H}=u;return e.jsx("div",{className:"stats-view",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ym,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:'סה"כ ימי לימוד'}),e.jsx("span",{className:"stat-value",children:H.totalTimeBlocks})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"זמן זמין (דקות)"}),e.jsx("span",{className:"stat-value",children:H.totalAvailableMinutes})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Je,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"זמן מוקצה (דקות)"}),e.jsx("span",{className:"stat-value",children:H.totalAssignedMinutes})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ll,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"אחוז ניצול"}),e.jsxs("span",{className:"stat-value",children:[H.utilizationPercentage,"%"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(uE,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h4",{children:"גודל יום לימוד ממוצע"}),e.jsx("span",{className:"stat-value",children:G(Math.round(H.averageBlockSize))})]})]})]})})};return p?e.jsxs("div",{className:"time-block-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"טוען ימי לימוד..."})]}):e.jsxs("div",{className:`teacher-time-block-view ${l}`,children:[e.jsxs("div",{className:"time-block-header",children:[e.jsxs("div",{className:"header-info",children:[e.jsxs("h3",{children:["ימי לימוד - ",s]}),(u==null?void 0:u.weeklyStats)&&e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("span",{children:["ימי לימוד: ",u.weeklyStats.totalTimeBlocks]}),e.jsxs("span",{children:["ניצול: ",u.weeklyStats.utilizationPercentage,"%"]})]})]}),e.jsxs("div",{className:"header-actions",children:[c&&e.jsxs("div",{className:"view-controls",children:[e.jsxs("button",{type:"button",className:`view-btn ${_==="blocks"?"active":""}`,onClick:()=>k("blocks"),children:[e.jsx($e,{size:16}),"ימי לימוד"]}),e.jsxs("button",{type:"button",className:`view-btn ${_==="stats"?"active":""}`,onClick:()=>k("stats"),children:[e.jsx(ym,{size:16}),"סטטיסטיקות"]})]}),!i&&e.jsxs("button",{type:"button",className:"add-block-btn primary",onClick:X,children:[e.jsx(fs,{size:16}),"הוסף יום לימוד"]})]})]}),m&&e.jsxs("div",{className:"time-block-error",children:[e.jsx(Bs,{size:16,color:"red"}),e.jsx("span",{children:m})]}),e.jsx("div",{className:"time-block-content",children:_==="blocks"?Y():Z()}),A&&e.jsx(aN,{teacherId:t,onBlockCreated:J,onCancel:()=>S(!1),initialData:C?{day:C.day,startTime:C.startTime,endTime:C.endTime,location:C.location,notes:C.notes}:void 0,isOpen:A}),e.jsx(ps,{isOpen:I,onClose:()=>T(!1),onConfirm:L,title:"מחיקת יום לימוד",message:`האם אתה בטוח שברצונך למחוק את יום הלימוד ביום ${R==null?void 0:R.day} בשעה ${R==null?void 0:R.startTime}?`,confirmText:"מחק",cancelText:"ביטול",type:"danger"})]})},Ij=t=>{var s,n,i,l;if((i=(n=(s=t.academicInfo)==null?void 0:s.instrumentProgress)==null?void 0:n[0])!=null&&i.instrumentName){const c=t.academicInfo.instrumentProgress[0].instrumentName;return typeof c=="string"?c:""}if((l=t.academicInfo)!=null&&l.instrument){const c=t.academicInfo.instrument;if(typeof c=="string")return c;if(typeof c=="object"&&(c!=null&&c.instrumentName))return typeof c.instrumentName=="string"?c.instrumentName:""}return""};function $j(){var pe,me,je,Oe,De,be,Te,Be;const{teacherId:t}=jr(),[s,n]=x.useState(null),[i,l]=x.useState(!1),[c,u]=x.useState(null),[f,p]=x.useState(!1),[m,y]=x.useState([]),[v,j]=x.useState([]),[N,b]=x.useState(!1),[w,A]=x.useState(0),[S,C]=x.useState([]),[D,I]=x.useState(!1),{rehearsals:T,loadRehearsals:R}=_l(),{user:E,isAuthenticated:_}=ys(),k=new nb({user:E,isAuthenticated:_}),[z,M]=x.useState({students:!1,orchestras:!1,theoryLessons:!1,personalInfo:!1,professionalInfo:!1,schedule:!0}),G=_t(),X=x.useCallback(()=>{A(V=>V+1)},[]);x.useEffect(()=>{t&&!i&&(console.log("TeacherDetails useEffect triggered for teacherId:",t,"refreshTrigger:",w),W(t))},[t,w]);const W=async V=>{var ue,ve;l(!0),u(null);try{const Ne=await Jt.getTeacherById(V);if(console.log("Teacher data loaded:",Ne),n(Ne),Ne){await R(),await B(V);let _e=!1;try{await L(V),_e=!0}catch{console.log("New API failed, trying fallback methods")}!_e&&((ue=Ne.teaching)!=null&&ue.studentIds)&&Ne.teaching.studentIds.length>0&&(await te(Ne.teaching.studentIds),_e=!0),_e||await J(V),(ve=Ne.conducting)!=null&&ve.orchestraIds&&Ne.conducting.orchestraIds.length>0?(b(!0),await O(Ne.conducting.orchestraIds)):j([])}}catch(Ne){console.error("Failed to load teacher:",Ne),u(Ne instanceof Error?Ne.message:"שגיאה בטעינת פרטי המורה")}finally{l(!1)}},te=async V=>{try{if(!V||!Array.isArray(V)||V.length===0){console.log("No student IDs provided"),y([]);return}console.log("Loading students for IDs:",V);let ue=[];try{ue=await ot.getStudentsByIds(V),console.log(`Successfully loaded ${ue.length}/${V.length} students`)}catch(ve){console.error("Failed to load students by IDs:",ve),console.log("Falling back to individual student loading");const Ne=V.map(Ie=>ot.getStudentById(Ie).then(Ue=>(console.log(`Successfully loaded student ${Ie}`),Ue)).catch(Ue=>(console.error(`Failed to load student ${Ie}:`,Ue),null)));ue=(await Promise.allSettled(Ne)).filter(Ie=>Ie.status==="fulfilled"&&Ie.value!==null).map(Ie=>Ie.value),console.log(`Loaded ${ue.length}/${V.length} students individually`)}y(ue.map(ve=>{var Ne;return{_id:ve._id,fullName:((Ne=ve.personalInfo)==null?void 0:Ne.fullName)||"תלמיד ללא שם",instrument:Ij(ve)}}))}catch(ue){console.error("Failed to load students:",ue)}},L=async V=>{try{console.log("Loading students from teacher lessons API for teacher:",V);const ue=await Jt.getTeacherLessons(V);if(console.log("Teacher lessons data received:",ue),!ue||!ue.lessons||ue.lessons.length===0){console.log("No lessons found for teacher"),y([]);return}const ve=new Map;ue.lessons.forEach(_e=>{var Ue;const Ie=_e.studentId;ve.has(Ie)||ve.set(Ie,{_id:Ie,fullName:_e.studentName||"תלמיד לא ידוע",instrument:_e.instrument||"",assignments:[]}),ve.get(Ie).assignments.push({teacherId:V,day:_e.day,time:_e.time,duration:_e.duration,scheduleSlotId:((Ue=_e.scheduleInfo)==null?void 0:Ue.scheduleSlotId)||null})});const Ne=Array.from(ve.values());console.log(`Found ${Ne.length} students with lessons for teacher ${V}`),y(Ne)}catch(ue){console.error("Failed to load students from teacher lessons:",ue),console.log("Falling back to old student loading method"),await J(V)}},J=async V=>{try{console.log("Searching for students with teacher assignment for teacher:",V);const ue=await ot.getStudents();console.log("Total students found:",ue.length);const ve=ue.filter(Ne=>{const _e=Ne.teacherIds&&Ne.teacherIds.includes(V),Ie=Ne.teacherAssignments&&Ne.teacherAssignments.some(Ue=>Ue.teacherId===V);return _e||Ie});console.log("Students with this teacher:",ve.length),y(ve.map(Ne=>{var Ie,Ue,It,qe;const _e=((Ie=Ne.teacherAssignments)==null?void 0:Ie.filter(mt=>mt.teacherId===V&&mt.isActive!==!1))||[];return console.log(`Student: ${(Ue=Ne.personalInfo)==null?void 0:Ue.fullName} has ${_e.length} assignments for teacher ${V}`,{totalAssignments:((It=Ne.teacherAssignments)==null?void 0:It.length)||0,allAssignments:Ne.teacherAssignments,filteredAssignments:_e}),{_id:Ne._id,fullName:((qe=Ne.personalInfo)==null?void 0:qe.fullName)||"תלמיד לא ידוע",instrument:Ij(Ne),assignments:_e}}))}catch(ue){console.error("Failed to load students by teacher assignment:",ue),y([])}},K=V=>{const ue=T.filter(ve=>ve.groupId===V);if(ue.length>0){const ve=ue[0],_e=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"][ve.dayOfWeek]||"לא ידוע";return{dayOfWeek:ve.dayOfWeek,dayName:`יום ${_e}`,startTime:ve.startTime,endTime:ve.endTime,timeRange:`${ve.startTime}-${ve.endTime}`,fullSchedule:`יום ${_e} ${ve.startTime}-${ve.endTime}`}}return null},le=V=>({Sunday:"ראשון",Monday:"שני",Tuesday:"שלישי",Wednesday:"רביעי",Thursday:"חמישי",Friday:"שישי",Saturday:"שבת",ראשון:"ראשון",שני:"שני",שלישי:"שלישי",רביעי:"רביעי",חמישי:"חמישי",שישי:"שישי",שבת:"שבת",0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"})[V]||V,O=async V=>{try{const ue=await Ia.getOrchestrasByIds(V);j(ue)}catch(ue){console.error("Failed to load orchestras:",ue)}finally{b(!1)}},U=V=>{M(ue=>({...ue,[V]:!ue[V]}))},Y=()=>{p(!f)},Z=()=>{G("/teachers")},H=V=>{G(`/students/${V}`)},P=V=>{G(`/orchestras/${V}`)},q=V=>{G(`/theory/${V}`)},B=async V=>{if(V){I(!0);try{const ue=await Xs.getTheoryLessonsByTeacher(V);console.log("Loaded theory lessons for teacher:",ue),C(ue)}catch(ue){console.error("Failed to load theory lessons for teacher:",ue)}finally{I(!1)}}},se=V=>V?new Date(V).toLocaleDateString("he-IL"):"לא זמין";if(i)return e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{className:"loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי מורה..."})]});if(c||!s)return e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:c||"לא ניתן לטעון את פרטי המורה"}),e.jsx("button",{onClick:Z,className:"btn primary",children:"חזרה לרשימת המורים"})]});const ae=V=>V.split(" ").map(ue=>ue[0]).join("").toUpperCase().substring(0,2),oe=(V,ue)=>{const[ve,Ne]=V.split(":").map(Number),_e=ve*60+Ne+ue,Ie=Math.floor(_e/60),Ue=_e%60;return`${Ie.toString().padStart(2,"0")}:${Ue.toString().padStart(2,"0")}`},ce=(V,ue)=>{const ve=oe(V,ue);return`${V} - ${ve}`},Q=V=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545",מגמה:"#FF6B35"})[V]||"#6c757d",ne=s.roles&&s.roles.length>0?s.roles[0]:"מורה";return e.jsx("div",{className:"teacher-details-content",children:e.jsx("div",{className:"teacher-details-page",children:e.jsx("div",{className:"teacher-card-container",children:e.jsxs("div",{className:`card-content ${f?"flipped":""}`,children:[e.jsxs("div",{className:"card-side card-front",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"teacher-identity",children:[e.jsx("div",{className:"avatar avatar-clickable",style:{backgroundColor:Q(ne)},children:ae(s.personalInfo.fullName)}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{className:"teacher-name",children:s.personalInfo.fullName}),e.jsx("div",{className:"instrument",children:(pe=s.professionalInfo)!=null&&pe.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:s.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:ne})]})})]})]}),e.jsxs("div",{className:"header-badges",children:[s.roles&&s.roles.map(V=>e.jsx("div",{className:"role-badge",style:{backgroundColor:Q(V)},children:V},V)),e.jsx("button",{className:"back-button",onClick:Z,"aria-label":"חזרה",children:e.jsx(zs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${z.students?"active":""}`,onClick:()=>U("students"),children:[e.jsx(ms,{size:16}),e.jsxs("span",{children:["תלמידים (",m.length,")"]}),z.students?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),z.students&&e.jsx("div",{className:"section-content",children:m.length>0?e.jsx("div",{className:"compact-students-overview",children:m.map(V=>{const ue=V.assignments||[];return e.jsxs("div",{className:"compact-student-row clickable",onClick:()=>H(V._id),children:[e.jsxs("div",{className:"student-info-compact",children:[e.jsx("div",{className:"student-avatar-compact",children:typeof V.fullName=="string"&&V.fullName.length>0?V.fullName.charAt(0):"ת"}),e.jsxs("div",{className:"student-details-compact",children:[e.jsx("div",{className:"student-name-compact",children:typeof V.fullName=="string"?V.fullName:"תלמיד לא ידוע"}),V.instrument&&typeof V.instrument=="string"&&V.instrument.length>0&&e.jsx("div",{className:"student-instrument-compact",children:V.instrument})]})]}),e.jsx("div",{className:"lessons-compact",children:ue.length>0?e.jsxs("div",{className:"lessons-list-compact",children:[ue.slice(0,3).map((ve,Ne)=>e.jsxs("div",{className:"lesson-item-compact",children:[e.jsx("span",{className:"lesson-day-compact",children:le(ve.day)}),e.jsx("span",{className:"lesson-time-compact",children:ce(ve.time,ve.duration)}),e.jsxs("span",{className:"lesson-duration-compact",children:["(",ve.duration," דק')"]})]},Ne)),ue.length>3&&e.jsxs("div",{className:"more-lessons-compact",children:["+",ue.length-3]})]}):e.jsx("div",{className:"no-lessons-compact",children:"אין שיעורים מתוכננים"})})]},V._id)})}):(je=(me=s.teaching)==null?void 0:me.studentIds)!=null&&je.length?e.jsxs("div",{className:"loading-section",children:[e.jsx(Yt,{size:16,className:"loading-icon"}),e.jsx("span",{children:"טוען פרטי תלמידים..."}),e.jsx("button",{className:"refresh-btn",onClick:X,"aria-label":"רענן נתונים",children:"לחץ לרענון"})]}):e.jsx("div",{className:"no-students-message",children:"למורה זה אין תלמידים מתוכננים כרגע"})})]}),((Oe=s.conducting)==null?void 0:Oe.orchestraIds)&&s.conducting.orchestraIds.length>0&&e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${z.orchestras?"active":""}`,onClick:()=>U("orchestras"),children:[e.jsx(Ke,{size:16}),e.jsxs("span",{children:["מנצח על תזמורות (",s.conducting.orchestraIds.length,")"]}),z.orchestras?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),z.orchestras&&e.jsx("div",{className:"section-content",children:N?e.jsxs("div",{className:"loading-section",children:[e.jsx(Yt,{size:16,className:"loading-icon"}),e.jsx("span",{children:"טוען נתוני תזמורת..."})]}):v.length>0?e.jsx("div",{className:"orchestras-grid",children:v.map(V=>{const ue=K(V._id);return e.jsxs("div",{className:"orchestra-card clickable",onClick:()=>P(V._id),children:[e.jsx("div",{className:"orchestra-header",children:e.jsxs("div",{className:"orchestra-name",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:V.name})]})}),e.jsxs("div",{className:"orchestra-details",children:[ue&&e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:12}),e.jsx("span",{children:ue.fullSchedule})]}),V.location&&e.jsxs("div",{className:"location",children:[e.jsx(gt,{size:12}),e.jsxs("span",{children:["מיקום: ",V.location]})]}),V.memberIds&&V.memberIds.length>0&&e.jsxs("div",{className:"member-count",children:[e.jsx(ms,{size:12}),e.jsxs("span",{children:[V.memberIds.length," חברים"]})]}),!V.isActive&&e.jsx("div",{className:"status-inactive",children:"תזמורת לא פעילה"})]})]},V._id)})}):e.jsx("div",{className:"no-orchestra-message",children:"לא נמצאו פרטי תזמורות"})})]}),S.length>0&&e.jsx(_$,{teacher:s,theoryLessons:S,theoryLessonsLoading:D,isOpen:z.theoryLessons,onToggle:()=>U("theoryLessons"),onTheoryLessonClick:q}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${z.schedule?"active":""}`,onClick:()=>U("schedule"),children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת שעות"}),z.schedule?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),z.schedule&&e.jsx("div",{className:"section-content",children:k.canManageTeacherSchedule(s)?e.jsx(nN,{teacherId:s._id,teacherName:((De=s.personalInfo)==null?void 0:De.fullName)||"מורה לא ידוע",onTimeBlockChange:()=>{}}):e.jsx("div",{className:"read-only-schedule",children:e.jsx(O$,{teacherId:s._id,teacherName:((be=s.personalInfo)==null?void 0:be.fullName)||"מורה לא ידוע",readOnly:!0,isAdmin:k.isAdmin(),onTimeBlockChange:()=>{}})})})]})]}),e.jsxs("button",{className:"flip-button",onClick:Y,children:[e.jsx("span",{children:"הצג פרטים אישיים"}),e.jsx(zs,{size:14})]})]}),e.jsxs("div",{className:"card-side card-back",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"teacher-identity",children:[e.jsx("div",{className:"avatar avatar-clickable",style:{backgroundColor:Q(ne)},children:ae(s.personalInfo.fullName)}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{className:"teacher-name",children:s.personalInfo.fullName}),e.jsx("div",{className:"instrument",children:(Te=s.professionalInfo)!=null&&Te.instrument?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:s.professionalInfo.instrument})]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{size:14}),e.jsx("span",{children:ne})]})})]})]}),e.jsxs("div",{className:"header-badges",children:[s.roles&&s.roles.map(V=>e.jsx("div",{className:"role-badge",style:{backgroundColor:Q(V)},children:V},V)),e.jsx("button",{className:"back-button",onClick:Z,"aria-label":"חזרה",children:e.jsx(zs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${z.personalInfo?"active":""}`,onClick:()=>U("personalInfo"),children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"פרטים אישיים"}),z.personalInfo?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),z.personalInfo&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"info-grid",children:[s.personalInfo.phone&&e.jsxs("div",{className:"info-item",children:[e.jsx(fi,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"טלפון"}),e.jsx("span",{className:"info-value",children:s.personalInfo.phone})]})]}),s.personalInfo.address&&e.jsxs("div",{className:"info-item",children:[e.jsx(gt,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כתובת"}),e.jsx("span",{className:"info-value",children:s.personalInfo.address})]})]}),s.personalInfo.email&&e.jsxs("div",{className:"info-item",children:[e.jsx(On,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"אימייל"}),e.jsx("span",{className:"info-value",children:s.personalInfo.email})]})]}),s.createdAt&&e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:se(s.createdAt)})]})]})]})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${z.professionalInfo?"active":""}`,onClick:()=>U("professionalInfo"),children:[e.jsx(Zt,{size:16}),e.jsx("span",{children:"מידע מקצועי"}),z.professionalInfo?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),z.professionalInfo&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"info-grid",children:[((Be=s.professionalInfo)==null?void 0:Be.instrument)&&e.jsxs("div",{className:"info-item",children:[e.jsx(Ke,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"כלי נגינה"}),e.jsx("span",{className:"info-value",children:s.professionalInfo.instrument})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:14}),e.jsxs("div",{children:[e.jsx("span",{className:"info-label",children:"תאריך הצטרפות"}),e.jsx("span",{className:"info-value",children:se(s.createdAt||"")})]})]})]})})]})]}),e.jsxs("button",{className:"flip-button",onClick:Y,children:[e.jsx("span",{children:"הצג מידע מקצועי"}),e.jsx(zs,{size:14})]})]})]})})})})}function I$({orchestra:t,onView:s,onEdit:n,onRemove:i}){const[l,c]=x.useState("");x.useEffect(()=>{(async()=>{if(t.conductorId)try{const b=await Jt.getTeacherById(t.conductorId);c(b?b.personalInfo.fullName:"מנצח לא זמין")}catch(b){console.error("Error fetching conductor:",b),c("מנצח לא זמין")}})()},[t.conductorId]);const u=N=>({הרכב:"#4D55CC",תזמורת:"#28A745"})[N]||"#6c757d",f=N=>N===0?"0 תלמידים":N===1?"תלמיד אחד":`${N} תלמידים`,p=N=>N?N===1?"חזרה אחת":`${N} חזרות`:"אין חזרות",m=t.memberIds&&t.memberIds.length>0,y=t.rehearsalIds&&t.rehearsalIds.length>0,v=m?t.memberIds.length:0,j=y?t.rehearsalIds.length:0;return e.jsxs("div",{className:"orchestra-preview",onClick:()=>s(t._id),style:{cursor:"pointer"},children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"orchestra-header-container",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:u(t.type)},children:e.jsx(Ke,{size:20})})}),e.jsxs("div",{className:"orchestra-info",children:[e.jsxs("div",{className:"orchestra-main-info",children:[e.jsx("h3",{className:"orchestra-name",children:t.name}),e.jsxs("div",{className:"orchestra-type",children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:t.type})]})]}),l&&e.jsxs("div",{className:"conductor-badge",children:[e.jsx(Je,{size:12}),e.jsx("span",{children:l})]})]})]})}),e.jsx("div",{className:"preview-content",children:e.jsxs("div",{className:"info-row",children:[e.jsxs("div",{className:"info-item",children:[e.jsx(ms,{size:16}),e.jsx("span",{children:f(v)})]}),e.jsxs("div",{className:"info-item",children:[e.jsx($e,{size:16}),e.jsx("span",{children:p(j)})]})]})}),e.jsxs("div",{className:"preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[n&&e.jsx("button",{className:"action-btn edit",onClick:N=>{N.stopPropagation(),n(t._id)},"aria-label":"ערוך תזמורת",children:e.jsx(ba,{size:16})}),i&&e.jsx("button",{className:"action-btn delete",onClick:N=>{N.stopPropagation(),i(t._id)},"aria-label":"מחק תזמורת",children:e.jsx(Ft,{size:16})})]}),e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsx("span",{children:new Date(t.createdAt||Date.now()).toLocaleDateString("he-IL")})]})]})]})}function $$({orchestras:t,isLoading:s,onEdit:n,onView:i,onRemove:l}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען תזמורות..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו תזמורות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף תזמורות חדשות"})]}):e.jsx("div",{className:"orchestra-grid",children:t.map(c=>e.jsx(I$,{orchestra:c,onEdit:n,onView:i,onRemove:l},c._id))})}const R$=(t=[],s)=>Ce().required("שם הוא שדה חובה").min(2,"שם חייב להכיל לפחות 2 תווים").test("unique-name","שם זהה כבר קיים",function(n){if(!n||s&&s===n)return!0;const i=n.trim().toLowerCase(),l=s?t.filter(p=>p.toLowerCase()!==s.toLowerCase()):t,c=l.find(p=>p.toLowerCase()===i);if(c)return this.createError({message:`שם זהה כבר קיים: "${c}"`});const u=i.replace(/\s+/g,""),f=l.find(p=>p.toLowerCase().replace(/\s+/g,"")===u);return f?this.createError({message:`שם דומה כבר קיים (הבדלי רווחים): "${f}"`}):!0}),M$={name:"",type:"תזמורת",conductorId:"",memberIds:[],rehearsalIds:[],schoolYearId:"",location:"חדר 1",isActive:!0},z$=(t=[],s)=>at().shape({_id:Ce(),name:R$(t,s),type:Ce().required("סוג הוא שדה חובה").oneOf(tN,"סוג לא תקין"),conductorId:Ce().required("מנצח/מדריך הוא שדה חובה"),memberIds:es().of(Ce()),rehearsalIds:es().of(Ce()),schoolYearId:Ce().required("שנת לימודים היא שדה חובה"),location:Ce().required("מקום הוא שדה חובה").oneOf(xr,"מקום לא תקין"),isActive:Ra().default(!0)});function lN({isOpen:t,onClose:s,orchestra:n,onSave:i}){const{modalProps:l,titleProps:c,descriptionProps:u}=Cl({isOpen:t,onClose:s,modalId:"orchestra-form",restoreFocusOnClose:!0}),[f,p]=x.useState([]),[m,y]=x.useState(!1),[v,j]=x.useState([]),[N,b]=x.useState(""),[w,A]=x.useState(!1),[S,C]=x.useState(!1),[D,I]=x.useState(null),T=x.useRef(null),{orchestras:R,saveOrchestra:E,isLoading:_}=vr(),{currentSchoolYear:k}=za(),{students:z,saveStudent:M,loadStudents:G}=Ma(),{loadTeacherByRole:X,loadTeachers:W}=Ds(),{showSuccess:te,showError:L}=Ot(),J=R.map(q=>q.name),K=x.useCallback(()=>n!=null&&n._id?{_id:n._id,name:n.name||"",type:n.type||"תזמורת",conductorId:n.conductorId||"",memberIds:n.memberIds||[],rehearsalIds:n.rehearsalIds||[],schoolYearId:n.schoolYearId||(k==null?void 0:k._id)||"",location:n.location||"חדר 1",isActive:n.isActive!==!1}:{...M$,schoolYearId:(k==null?void 0:k._id)||""},[n,k]);x.useEffect(()=>{z.length===0&&G({isActive:!0})},[z.length,G]),x.useEffect(()=>{if(z.length>0&&(n!=null&&n.memberIds)&&n.memberIds.length>0){C(!0);const q=z.filter(B=>{var se;return(se=n==null?void 0:n.memberIds)==null?void 0:se.includes(B._id)});j(q),C(!1)}else j([])},[n==null?void 0:n.memberIds,z]),x.useEffect(()=>{function q(B){T.current&&!T.current.contains(B.target)&&A(!1)}return document.addEventListener("mousedown",q),()=>{document.removeEventListener("mousedown",q)}},[]);const le=x.useCallback(async q=>{y(!0),p([]);try{const B=q==="תזמורת"?"מנצח":"מדריך הרכב";if(console.log(`Fetching teachers with role: ${B}`),typeof X=="function"){const se=await X(B);Array.isArray(se)?(console.log(`Found ${se.length} teachers with role ${B}`),p(se)):(console.error("Expected array of teachers, but got:",se),p([]))}else{const se=await W({role:B,isActive:!0});if(Array.isArray(se)){const ae=se.filter(oe=>oe.roles&&oe.roles.includes(B));console.log(`Filtered ${ae.length} teachers with role ${B}`),p(ae)}else console.error("Expected array of teachers, but got:",se),p([])}}catch(B){console.error("Failed to load teachers for role:",B),p([])}finally{y(!1)}},[X,W]),O=x.useCallback(q=>{b(q.target.value),A(q.target.value.length>0)},[]),U=x.useCallback(()=>N?z.filter(q=>q.personalInfo.fullName.includes(N)&&!v.some(B=>B._id===q._id)).slice(0,10):[],[N,z,v]),Y=x.useCallback((q,B)=>{const se=[...v,q];j(se),B("memberIds",se.map(ae=>ae._id)),b(""),A(!1)},[v]),Z=x.useCallback((q,B)=>{j(se=>{const ae=se.filter(oe=>oe._id!==q);return B("memberIds",ae.map(oe=>oe._id)),ae})},[]),H=async(q,B,se)=>{try{const ae=se.filter(ce=>!B.includes(ce)),oe=B.filter(ce=>!se.includes(ce));console.log("Updating student references:",{adding:ae.length,removing:oe.length});for(const ce of ae){const Q=z.find(ne=>ne._id===ce);Q&&!Q.enrollments.orchestraIds.includes(q)&&await M({_id:Q._id,enrollments:{...Q.enrollments,orchestraIds:[...Q.enrollments.orchestraIds,q]}})}for(const ce of oe){const Q=z.find(ne=>ne._id===ce);Q&&await M({_id:Q._id,enrollments:{...Q.enrollments,orchestraIds:Q.enrollments.orchestraIds.filter(ne=>ne!==q)}})}}catch(ae){console.error("Error updating student references:",ae)}},P=async(q,{setSubmitting:B})=>{I(null);try{console.log("Submitting orchestra form with data:",q);const se=await E(q);console.log("Orchestra saved successfully:",se),await H(se._id,(n==null?void 0:n.memberIds)||[],q.memberIds);const ae=q.type==="תזמורת",oe=n!=null&&n._id?`${ae?"התזמורת עודכנה בהצלחה":"ההרכב עודכן בהצלחה"}`:`${ae?"התזמורת נוצרה בהצלחה":"ההרכב נוצר בהצלחה"}`;te(oe),i&&i(),s()}catch(se){console.error("Error saving orchestra:",se);const ae=se instanceof Error?se.message:"שגיאה לא ידועה בשמירת התזמורת/הרכב";I(ae),L(ae)}finally{B(!1)}};return t?e.jsx(Ua,{isOpen:t,onClose:s,className:"orchestra-form responsive-form",children:e.jsxs("div",{className:"form-modal",...l,children:[e.jsx("div",{...u,className:"sr-only",children:n!=null&&n._id?"טופס עריכת פרטי הרכב קיים במערכת":"טופס הוספת הרכב חדש למערכת"}),e.jsx(yr,{initialValues:K(),validationSchema:z$(J,n==null?void 0:n.name),onSubmit:P,enableReinitialize:!0,children:({values:q,errors:B,touched:se,isSubmitting:ae,setFieldValue:oe})=>{const ce=q.type==="תזמורת";x.useEffect(()=>{le(q.type)},[q.type]);const Q=U();return e.jsxs(In,{children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...c,children:n!=null&&n._id?ce?"עריכת תזמורת":"עריכת הרכב":ce?"הוספת תזמורת חדשה":"הוספת הרכב חדש"})]}),D&&e.jsx("div",{className:"error-message",children:D}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:ce?"פרטי תזמורת":"פרטי הרכב"}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsxs(Me,{label:"סוג",name:"type",as:"select",required:!0,disabled:ae,children:[e.jsx("option",{value:"",children:"בחר סוג"}),tN.map(ne=>e.jsx("option",{value:ne,children:ne},ne))]}),e.jsx(Me,{label:ce?"שם התזמורת":"שם ההרכב",name:"name",type:"text",required:!0,placeholder:ce?"הכנס שם תזמורת...":"הכנס שם הרכב...",disabled:ae})]}),e.jsxs("div",{className:"form-row narrow-fields",children:[e.jsxs(Me,{label:"מקום",name:"location",as:"select",required:!0,disabled:ae,children:[e.jsx("option",{value:"",children:"בחר מקום"}),xr.map(ne=>e.jsx("option",{value:ne,children:ne},ne))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conductorId",className:B.conductorId&&se.conductorId?"required-field is-invalid":"required-field",children:ce?"מנצח":"מדריך הרכב"}),e.jsxs("select",{id:"conductorId",name:"conductorId",value:q.conductorId,onChange:ne=>{oe("conductorId",ne.target.value)},className:B.conductorId&&se.conductorId?"is-invalid":"",required:!0,disabled:m||ae,children:[e.jsx("option",{value:"",children:ce?"בחר מנצח":"בחר מדריך הרכב"}),f.map(ne=>e.jsx("option",{value:ne._id,children:ne.personalInfo.fullName},ne._id))]}),m&&e.jsx("div",{className:"loading-text",children:ce?"טוען מנצחים...":"טוען מדריכים..."}),B.conductorId&&se.conductorId&&e.jsx("div",{className:"form-error",children:B.conductorId})]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:ce?"תלמידים (חברי התזמורת)":"תלמידים (חברי ההרכב)"}),e.jsxs("div",{ref:T,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(pr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:N,onChange:O,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>N.length>0,disabled:ae})]}),w&&Q.length>0&&!ae&&e.jsx("div",{className:"search-results-dropdown",children:Q.map(ne=>e.jsxs("div",{className:"search-result-item",onClick:()=>Y(ne,oe),children:[e.jsx(Je,{size:16,className:"student-icon"}),e.jsx("span",{children:ne.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:ne.academicInfo.instrument})]},ne._id))})]}),e.jsx("div",{className:"selected-members-list",children:S?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):v.length>0?v.map(ne=>{var pe,me,je;return e.jsxs("div",{className:"member-badge",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:ne.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:ne.personalInfo.fullName}),((je=(me=(pe=ne.academicInfo)==null?void 0:pe.instrumentProgress)==null?void 0:me[0])==null?void 0:je.instrumentName)&&e.jsx("div",{className:"member-instrument",children:ne.academicInfo.instrumentProgress[0].instrumentName})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>Z(ne._id,oe),"aria-label":`הסר את ${ne.personalInfo.fullName}`,disabled:ae,children:e.jsx(Nt,{size:14})})]},ne._id)}):e.jsxs("div",{className:"no-members-message",children:["לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים"," ",ce?"לתזמורת":"להרכב","."]})})]})}),e.jsx("input",{type:"hidden",name:"schoolYearId",value:q.schoolYearId})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn primary",disabled:_||ae,children:ae?"שומר...":_?"טוען...":n!=null&&n._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:s,disabled:ae,children:"ביטול"})]})]})}})]})}):null}function L$(){const{orchestras:t,isLoading:s,error:n,loadOrchestras:i,removeOrchestra:l}=vr(),{loadCurrentSchoolYear:c}=za(),[u,f]=x.useState(!1),[p,m]=x.useState(null),[y,v]=x.useState(!1),[j,N]=x.useState(null),{showSuccess:b,showError:w}=Ot(),[A,S]=x.useState(!1),C=H=>[H.name,H.type],{filteredEntities:D,handleSearch:I,filters:T,handleApplyFilters:R,hasActiveFilters:E,availableInstruments:_}=bu(t,C,H=>H.type,void 0,void 0,H=>H.name),k=_t(),z=gs(),{user:M}=ys(),G=M==null?void 0:M.roles.includes("מנהל"),X=M==null?void 0:M.roles.includes("מנצח"),W=z.pathname.includes("/orchestras/")&&!z.pathname.endsWith("/orchestras/");x.useEffect(()=>{i(),c()},[i,c]);const te=()=>{m(null),f(!0)},L=()=>{f(!1),m(null)},J=H=>{const P=t.find(q=>q._id===H)||null;m(P),f(!0)},K=H=>{k(`/orchestras/${H}`)},le=H=>{t.find(q=>q._id===H)&&(N(H),v(!0))},O=async()=>{if(j)try{await l(j),b("התזמורת נמחקה בהצלחה"),N(null)}catch(H){console.error("Failed to remove orchestra:",H),w("שגיאה במחיקת התזמורת. אנא נסה שוב.")}},U=()=>{S(!A)},Y=G,Z=G||X;return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!W&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(rc,{onSearch:I,placeholder:"חיפוש תזמורות..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsx("button",{className:`btn-icon filter-btn ${E?"active":""}`,onClick:U,"aria-label":"סנן תזמורות",children:e.jsx(hi,{className:"icon"})}),e.jsx(Nu,{isOpen:A,onToggle:()=>S(!A),onApplyFilters:R,availableInstruments:_,currentFilters:T,hasActiveFilters:E,entityType:"orchestras"})]}),Y&&e.jsx("button",{className:"btn-icon add-btn",onClick:te,"aria-label":"הוספת תזמורת חדשה",children:e.jsx(fs,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!W&&e.jsx($$,{orchestras:D,isLoading:s,onEdit:Z?J:void 0,onView:K,onRemove:G?le:void 0}),e.jsx(wl,{context:{loadOrchestras:i}}),e.jsx(ps,{isOpen:y,onClose:()=>v(!1),onConfirm:O,title:"מחיקת תזמורת",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התזמורת?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),u&&e.jsx(lN,{isOpen:u,onClose:L,orchestra:p,onSave:i})]}),!W&&!u&&e.jsx(mi,{})]})}function B$({isOpen:t,onClose:s,orchestraName:n,rehearsalCount:i,changes:l,onConfirmUpdate:c}){const[u,f]=x.useState(!1),p=()=>{f(!0)},m=()=>{c(),f(!1),s()},y=()=>{f(!1),s()};return u?e.jsx(ps,{isOpen:!0,onClose:()=>f(!1),onConfirm:m,title:"אישור עדכון כל החזרות",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsxs("strong",{children:["פעולה זו תעדכן את כל ",i,' החזרות של "',n,'"']})}),e.jsx("p",{children:"השינויים יוחלו על כל החזרות הקיימות. פעולה זו לא ניתנת לביטול."}),e.jsx("p",{className:"text-sm text-muted",children:"האם אתה בטוח שברצונך להמשיך?"})]}),confirmText:`עדכן ${i} חזרות`,cancelText:"ביטול",type:"warning"}):e.jsx(Ua,{isOpen:t,onClose:y,children:e.jsxs("div",{className:"rehearsal-bulk-update-dialog",children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx(oi,{size:24,className:"warning-icon"}),e.jsx("h3",{children:"עדכון כל החזרות"})]}),e.jsxs("div",{className:"dialog-content",children:[e.jsxs("div",{className:"orchestra-info",children:[e.jsx(Ke,{size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"orchestra-name",children:n}),e.jsxs("div",{className:"rehearsal-count",children:[i," חזרות"]})]})]}),e.jsxs("div",{className:"changes-summary",children:[e.jsx("h4",{children:"השינויים שיוחלו:"}),e.jsx("ul",{className:"changes-list",children:l.map((v,j)=>e.jsx("li",{children:v},j))})]}),e.jsxs("div",{className:"warning-message",children:[e.jsx($e,{size:18}),e.jsxs("p",{children:["השינויים יוחלו על כל החזרות הקיימות של התזמורת. פעולה זו תשפיע על ",i," חזרות."]})]})]}),e.jsxs("div",{className:"dialog-actions",children:[e.jsx("button",{className:"btn primary",onClick:p,children:"בצע עבור כל החזרות"}),e.jsx("button",{className:"btn secondary",onClick:y,children:"ביטול"})]})]})})}const F$=at().shape({groupId:Ce().required("יש לבחור תזמורת"),date:Ce().required("תאריך חובה"),startTime:Ce().required("שעת התחלה חובה"),endTime:Ce().required("שעת סיום חובה").test("is-after-start","שעת סיום חייבת להיות אחרי שעת התחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ce().required("מיקום חובה"),notes:Ce(),isActive:Ra().default(!0),schoolYearId:Ce().required("שנת לימודים חובה"),type:Ce().default("תזמורת"),dayOfWeek:Pa().min(0).max(6)}),U$=at().shape({orchestraId:Ce().required("יש לבחור תזמורת"),startDate:Ce().required("תאריך התחלה חובה"),endDate:Ce().required("תאריך סיום חובה").test("is-after-start","תאריך סיום חייב להיות אחרי תאריך התחלה",function(t){const{startDate:s}=this.parent;return!s||!t?!0:new Date(t)>=new Date(s)}),dayOfWeek:Pa().min(0).max(6).required("יום בשבוע חובה"),startTime:Ce().required("שעת התחלה חובה"),endTime:Ce().required("שעת סיום חובה").test("is-after-start","שעת סיום חייבת להיות אחרי שעת התחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ce().required("מיקום חובה"),notes:Ce(),excludeDates:es().of(Ce()),schoolYearId:Ce().required("שנת לימודים חובה")}),ou=t=>t.toISOString().split("T")[0],P$=(t,s="",n="")=>{const i=new Date;return t!=null&&t._id?{_id:t._id,groupId:t.groupId||s,date:t.date||ou(i),startTime:t.startTime||"16:00",endTime:t.endTime||"18:00",location:t.location||xr[0],notes:t.notes||"",schoolYearId:t.schoolYearId||n,type:t.type||"תזמורת",dayOfWeek:t.dayOfWeek||i.getDay()}:{_id:void 0,groupId:s,date:ou(i),startTime:"16:00",endTime:"18:00",location:xr[0],notes:"",schoolYearId:n,type:"תזמורת",dayOfWeek:i.getDay()}},q$=(t="",s="")=>{const n=new Date,i=new Date(n);return i.setDate(n.getDate()+30),{orchestraId:t,startDate:ou(n),endDate:ou(i),dayOfWeek:n.getDay(),startTime:"16:00",endTime:"18:00",location:xr[0],notes:"",excludeDates:[],schoolYearId:s,excludedDate:""}};function pp({isOpen:t,onClose:s,rehearsal:n,orchestraId:i,onSave:l}){var H;const{modalProps:c,titleProps:u,descriptionProps:f}=Cl({isOpen:t,onClose:s,modalId:"rehearsal-form",restoreFocusOnClose:!0}),p=_l(),m=vr(),y=za(),{addToast:v}=Ot(),{saveRehearsal:j,bulkCreateRehearsals:N,updateRehearsalsByOrchestra:b,rehearsals:w,isLoading:A,error:S,clearError:C}=p,{orchestras:D,loadOrchestras:I}=m,{currentSchoolYear:T,loadCurrentSchoolYear:R}=y,[E,_]=x.useState("bulk"),[k,z]=x.useState(""),[M,G]=x.useState(""),[X,W]=x.useState(!1),[te,L]=x.useState(null);x.useEffect(()=>{(async()=>{if(!T)try{await R()}catch(q){console.error("Failed to load current school year:",q),G("Failed to load current school year. Please try again.")}if(D.length===0)try{await I()}catch(q){console.error("Failed to load orchestras:",q),G("Failed to load orchestras. Please try again.")}})(),C&&C(),n!=null&&n._id&&_("single")},[T,R,D.length,I,C,n]);const J=P=>{n!=null&&n._id||_(P)},K=async P=>{G("");try{const q=P.schoolYearId||(T==null?void 0:T._id);if(!q){G("שנת הלימודים לא נטענה. אנא רענן את הדף.");return}const B={...P,schoolYearId:q};console.log("Saving single rehearsal:",B),await j(B),v({type:"success",message:n!=null&&n._id?"החזרה עודכנה בהצלחה":"החזרה נוספה בהצלחה"}),l&&l(),s()}catch(q){console.error("Error saving rehearsal:",q);const B=q instanceof Error?q.message:"שגיאה בשמירת החזרה";G(B),v({type:"danger",message:B})}},le=async P=>{G("");try{const q=P.schoolYearId||(T==null?void 0:T._id);if(!q){G("שנת הלימודים לא נטענה. אנא רענן את הדף.");return}const B={...P,dayOfWeek:Number(P.dayOfWeek),schoolYearId:q};console.log("Creating bulk rehearsals:",B);const se=await N(B);v({type:"success",message:`נוצרו ${se.insertedCount} חזרות בהצלחה`}),l&&l(),s()}catch(q){console.error("Error creating bulk rehearsals:",q);const B=q instanceof Error?q.message:"שגיאה ביצירת חזרות מרובות";G(B),v({type:"danger",message:B})}},O=P=>{if(!(n!=null&&n.groupId)){G("לא ניתן לבצע עדכון קבוצתי - לא נמצא מזהה תזמורת");return}const{_id:q,createdAt:B,updatedAt:se,groupId:ae,date:oe,schoolYearId:ce,...Q}=P,ne=[],pe=n;if(Q.startTime!==pe.startTime&&ne.push(`שעת התחלה: ${Q.startTime}`),Q.endTime!==pe.endTime&&ne.push(`שעת סיום: ${Q.endTime}`),Q.location!==pe.location&&ne.push(`מיקום: ${Q.location}`),Q.notes!==pe.notes&&ne.push(`הערות: ${Q.notes||"ללא הערות"}`),ne.length===0){G("לא נמצאו שינויים לעדכון");return}L({orchestraId:n.groupId,updates:Q,changes:ne}),W(!0)},U=async()=>{if(te)try{const P=await b(te.orchestraId,te.updates);v({type:"success",message:`עודכנו ${P.updatedCount} חזרות בהצלחה`}),l&&l(),s()}catch(P){console.error("Error updating rehearsals:",P);const q=P instanceof Error?P.message:"שגיאה בעדכון החזרות";G(q),v({type:"danger",message:q})}finally{L(null),W(!1)}},Y=(P,q,B)=>{if(!P)return;const se=q.excludeDates||[];if(!se.includes(P)){const ae=[...se,P];B("excludeDates",ae),z("")}},Z=(P,q,B)=>{const ae=(q.excludeDates||[]).filter(oe=>oe!==P);B("excludeDates",ae)};return t?e.jsx(Ua,{isOpen:t,onClose:s,className:"rehearsal-form responsive-form",children:e.jsxs("div",{className:"form-modal",...c,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...u,children:n!=null&&n._id?"עריכת חזרה":"הוספת חזרה חדשה"})]}),e.jsx("div",{...f,className:"sr-only",children:n!=null&&n._id?"טופס עריכת חזרה קיימת במערכת":"טופס הוספת חזרה חדשה למערכת"}),S&&e.jsx("div",{className:"error-message",children:S}),M&&e.jsx("div",{className:"error-message",children:M}),!(n!=null&&n._id)&&e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{type:"button",className:E==="bulk"?"active primary":"secondary",onClick:()=>J("bulk"),children:"חזרות מרובות"}),e.jsx("button",{type:"button",className:E==="single"?"active primary":"secondary",onClick:()=>J("single"),children:"חזרה בודדת"})]}),E==="single"?e.jsx(yr,{initialValues:P$(n,i,(T==null?void 0:T._id)||""),validationSchema:F$,onSubmit:K,enableReinitialize:!0,children:({values:P})=>e.jsxs(In,{children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי תזמורת"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Me,{label:"תזמורת/הרכב",name:"groupId",as:"select",required:!0,labelIcon:e.jsx(Ke,{size:16}),children:[e.jsx("option",{value:"",children:"בחר תזמורת/הרכב"}),D.map(q=>e.jsx("option",{value:q._id,children:q.name},q._id))]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי חזרה"}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"תאריך",name:"date",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Me,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Me,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(gt,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מיקום"}),xr.map(q=>e.jsx("option",{value:q,children:q},q))]})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx(Oa,{type:"hidden",name:"schoolYearId",value:(T==null?void 0:T._id)||""}),e.jsx(Oa,{type:"hidden",name:"isActive"}),e.jsx(Oa,{type:"hidden",name:"type"}),e.jsx(Oa,{type:"hidden",name:"dayOfWeek"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:A,children:A?"שומר...":n!=null&&n._id?"עדכון":"הוספה"}),(n==null?void 0:n._id)&&e.jsx("button",{type:"button",className:"warning",disabled:A,onClick:()=>O(P),children:"בצע עבור כל החזרות"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}):e.jsx(yr,{initialValues:q$(i,(T==null?void 0:T._id)||""),validationSchema:U$,onSubmit:le,enableReinitialize:!0,children:({values:P,setFieldValue:q})=>e.jsxs(In,{children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי תזמורת"}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Me,{label:"תזמורת/הרכב",name:"orchestraId",as:"select",required:!0,labelIcon:e.jsx(Ke,{size:16}),children:[e.jsx("option",{value:"",children:"בחר תזמורת/הרכב"}),D.map(B=>e.jsx("option",{value:B._id,children:B.name},B._id))]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי חזרה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"תאריך התחלה",name:"startDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})}),e.jsx(Me,{label:"תאריך סיום",name:"endDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})]}),e.jsxs("div",{className:"form-row full-width",children:[e.jsx(Me,{label:"יום בשבוע",name:"dayOfWeek",as:"select",required:!0,labelIcon:e.jsx(xm,{size:16}),children:Fm.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsxs("div",{className:"help-text",style:{marginTop:"-15px",paddingRight:"16px"},children:["חזרות ייווצרו בכל יום ",sN(Number(P.dayOfWeek))," ","בטווח התאריכים שנבחר"]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group excluded-dates",children:[e.jsxs("label",{children:[e.jsx($e,{size:16,className:"icon"}),"תאריכים לדילוג"]}),e.jsxs("div",{className:"date-input-group",children:[e.jsx("input",{type:"date",value:k,onChange:B=>z(B.target.value),min:P.startDate,max:P.endDate}),e.jsx("button",{type:"button",onClick:()=>Y(k,P,q),className:"add-date-btn",disabled:!k,children:"הוסף"})]}),P.excludeDates&&P.excludeDates.length>0&&e.jsxs("div",{className:"excluded-dates-list",children:[e.jsx("div",{className:"list-title",children:"תאריכים שיידלגו:"}),e.jsx("ul",{children:P.excludeDates.map(B=>e.jsxs("li",{children:[new Date(B).toLocaleDateString("he-IL"),e.jsx("button",{type:"button",onClick:()=>Z(B,P,q),className:"remove-date-btn",children:e.jsx(Nt,{size:14})})]},B))})]})]})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Me,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs(Me,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(gt,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מיקום"}),xr.map(B=>e.jsx("option",{value:B,children:B},B))]})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx(Oa,{type:"hidden",name:"schoolYearId",value:(T==null?void 0:T._id)||""})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:A,children:A?"שומר...":"יצירת חזרות מרובות"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}),X&&te&&e.jsx(B$,{isOpen:X,onClose:()=>{W(!1),L(null)},orchestraName:((H=D.find(P=>P._id===te.orchestraId))==null?void 0:H.name)||"לא ידוע",rehearsalCount:w.filter(P=>P.groupId===te.orchestraId).length,changes:te.changes,onConfirmUpdate:U})]})}):null}function Rj(){var Be;const{orchestraId:t}=jr(),s=_t(),{user:n}=ys(),{selectedOrchestra:i,loadOrchestraById:l,removeOrchestra:c,isLoading:u,error:f}=vr(),{loadTeacherById:p}=Ds(),{getStudentsByIds:m}=Ma(),{rehearsals:y,loadRehearsalsByOrchestraId:v,removeRehearsal:j,isLoading:N}=_l(),[b,w]=x.useState([]),[A,S]=x.useState(!1),[C,D]=x.useState(!1),[I,T]=x.useState(!1),[R,E]=x.useState(null),[_,k]=x.useState(!1),[z,M]=x.useState(!1),[G,X]=x.useState(null),[W,te]=x.useState(!1),[L,J]=x.useState(null),[K,le]=x.useState(!1),[O,U]=x.useState(!1),[Y,Z]=x.useState(!1),H=Al(n,!!n),P=br(H),q=i?P.getOrchestraActionPermissions(i):{canEdit:!1,canDelete:!1,showEditButton:!1,showDeleteButton:!1};q.canEdit,q.canDelete,P.isAdmin(),x.useEffect(()=>{t&&l(t)},[t,l]),x.useEffect(()=>{t&&v(t)},[t,v]),x.useEffect(()=>{(async()=>{if(i!=null&&i.conductorId){k(!0);try{await p(i.conductorId);const ve=Ds.getState().selectedTeacher;E(ve)}catch(ue){console.error("Failed to load conductor:",ue)}finally{k(!1)}}})()},[i,p]),x.useEffect(()=>{(async()=>{if(i&&i.memberIds&&i.memberIds.length>0){S(!0);try{const ve=(await m(i.memberIds)).map(Ne=>({_id:Ne._id,personalInfo:{fullName:Ne.personalInfo.fullName},academicInfo:{instrument:Ne.academicInfo.instrument}}));w(ve.map(Ne=>({...Ne,academicInfo:{...Ne.academicInfo,instrument:Ne.academicInfo.instrument||""}})))}catch(ue){console.error("Failed to load members:",ue)}finally{S(!1)}}else w([])})()},[i,m]);const B=V=>new Date(V).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"}),se=()=>{s("/orchestras")},ae=()=>{D(!0)},oe=()=>{T(!0)},ce=async()=>{if(i!=null&&i._id)try{await c(i._id),s("/orchestras")}catch(V){console.error("Failed to delete orchestra:",V)}T(!1)},Q=()=>{X(null),M(!0)},ne=V=>{X(V),M(!0)},pe=V=>{J(V),te(!0)},me=async()=>{if(L)try{await j(L),v(t)}catch(V){console.error("Failed to delete rehearsal:",V)}te(!1),J(null)},je=V=>{s(`/rehearsals/${V}`)},Oe=V=>{s(`/students/${V}`)},De=()=>{le(!K)},be=()=>{U(!O)},Te=()=>{Z(!Y)};return u?e.jsx("div",{className:"loading-state",children:"טוען..."}):f?e.jsx("div",{className:"error-state",children:f}):i?e.jsxs("div",{className:"orchestra-details-content",children:[e.jsx("div",{className:"orchestra-details-page",children:e.jsx("div",{className:"orchestra-card-container",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"orchestra-header",children:[e.jsx("div",{className:"header-icon",children:e.jsx(Ke,{className:"icon",size:20})}),e.jsx("h2",{className:"header-title",children:i.name}),e.jsxs("div",{className:"header-actions",children:[(q.showEditButton||q.showDeleteButton)&&e.jsxs("div",{className:"actions-dropdown",children:[e.jsx("button",{className:"actions-trigger",children:e.jsx(IT,{size:18})}),e.jsxs("div",{className:"actions-menu",children:[q.showEditButton&&e.jsxs("button",{className:"action-item edit",onClick:ae,children:[e.jsx(ba,{size:14}),e.jsx("span",{children:"עריכה"})]}),q.showDeleteButton&&e.jsxs("button",{className:"action-item delete",onClick:oe,children:[e.jsx(Ft,{size:14}),e.jsx("span",{children:"מחיקה"})]})]})]}),e.jsx("button",{className:"back-button",onClick:se,"aria-label":"חזרה",children:e.jsx(zs,{size:20})})]})]}),e.jsxs("div",{className:"card-scroll-area",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${K?"active":""}`,onClick:De,children:[e.jsx(Ke,{size:16}),i.type==="הרכב"?"פרטי הרכב":"פרטי התזמורת",K?e.jsx(Bt,{className:"toggle-icon",size:20}):e.jsx(bt,{className:"toggle-icon",size:20})]}),K&&e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"orchestra-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(Je,{size:14}),"מנצח:"]}),e.jsx("span",{className:"info-value",children:_?"טוען...":R&&"personalInfo"in R?R.personalInfo.fullName:"לא הוגדר"})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(gt,{size:14}),"מיקום:"]}),e.jsx("span",{className:"info-value",children:i.location||"לא הוגדר"})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx(ms,{size:14}),"תלמידים:"]}),e.jsx("span",{className:"info-value",children:((Be=i.memberIds)==null?void 0:Be.length)||0})]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:[e.jsx($e,{size:14}),"חזרות:"]}),e.jsx("span",{className:"info-value",children:(y==null?void 0:y.length)||0})]})]})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${O?"active":""}`,onClick:be,children:[e.jsx(ms,{size:18}),"חברי תזמורת",O?e.jsx(Bt,{className:"toggle-icon",size:20}):e.jsx(bt,{className:"toggle-icon",size:20})]}),O&&e.jsx("div",{className:"section-content",children:i.memberIds&&i.memberIds.length>0?e.jsx("div",{className:"members-list",children:A?e.jsx("div",{className:"loading-message",children:"טוען תלמידים..."}):b.length>0?e.jsx("ul",{className:"members-items",children:b.map(V=>e.jsx("li",{className:"member-item clickable",onClick:()=>Oe(V._id),children:e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:V.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:V.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:V.academicInfo.instrument})]})]})},V._id))}):e.jsx("div",{className:"message-box",children:"לא ניתן לטעון את נתוני התלמידים"})}):e.jsx("div",{className:"warning-box",children:"אין תלמידים בתזמורת זו"})})]}),e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:`section-title clickable ${Y?"active":""}`,onClick:Te,children:[e.jsx($e,{size:18}),"חזרות",Y?e.jsx(Bt,{className:"toggle-icon",size:20}):e.jsx(bt,{className:"toggle-icon",size:20})]}),Y&&e.jsxs("div",{className:"section-content",children:[q.canEdit&&e.jsx("div",{className:"add-rehearsal-btn-container",children:e.jsxs("button",{className:"btn primary add-rehearsal-btn",onClick:Q,children:[e.jsx(fs,{size:16}),"הוסף חזרה"]})}),N?e.jsx("div",{className:"loading-message",children:"טוען חזרות..."}):y&&y.length>0?e.jsx("div",{className:"rehearsals-list",children:y.sort((V,ue)=>new Date(V.date).getTime()-new Date(ue.date).getTime()).map(V=>e.jsxs("div",{className:"rehearsal-item",onClick:()=>je(V._id),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"rehearsal-header",children:[e.jsxs("div",{className:"rehearsal-date",children:[e.jsx($e,{size:16}),e.jsx("span",{children:B(V.date)})]}),q.canEdit&&e.jsxs("div",{className:"rehearsal-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:ue=>{ue.stopPropagation(),ne(V)},children:e.jsx(ba,{size:14})}),e.jsx("button",{className:"action-btn delete",onClick:ue=>{ue.stopPropagation(),pe(V._id)},children:e.jsx(Nt,{size:14})})]})]}),e.jsxs("div",{className:"rehearsal-details",children:[e.jsxs("div",{className:"rehearsal-time",children:[e.jsx(Ve,{size:16}),e.jsxs("span",{children:[V.startTime," - ",V.endTime]})]}),e.jsxs("div",{className:"rehearsal-location",children:[e.jsx(gt,{size:16}),e.jsx("span",{children:V.location})]}),V.notes&&e.jsxs("div",{className:"rehearsal-notes",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:V.notes})]})]})]},V._id))}):e.jsx("div",{className:"warning-box",children:"אין חזרות רשומות לתזמורת זו"})]})]})]})]})})}),C&&e.jsx(lN,{isOpen:C,onClose:()=>D(!1),orchestra:i,onSave:()=>{D(!1),t&&l(t)}}),z&&e.jsx(pp,{isOpen:z,onClose:()=>M(!1),rehearsal:G,orchestraId:t,onSave:()=>{M(!1),t&&v(t)}}),e.jsx(ps,{isOpen:I,onClose:()=>T(!1),onConfirm:ce,title:"מחיקת תזמורת",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק את התזמורת "',i.name,'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"}),e.jsx(ps,{isOpen:W,onClose:()=>te(!1),onConfirm:me,title:"מחיקת חזרה",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק חזרה זו?"}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}):e.jsx("div",{className:"not-found-state",children:"תזמורת לא נמצאה"})}function H$({rehearsal:t,orchestraName:s,onView:n,onEdit:i,onRemove:l,onRemoveOrchestra:c,isToday:u=!1}){const f=(y,v)=>{const[j,N]=y.split(":").map(Number),[b,w]=v.split(":").map(Number),A=j*60+N;return b*60+w-A},p=y=>{const v=Math.floor(y/60),j=y%60;return v===0?`${j} דקות`:v===1&&j===0?"שעה אחת":v===1?`שעה ו-${j} דקות`:j===0?`${v} שעות`:`${v} שעות ו-${j} דקות`},m=f(t.startTime,t.endTime);return e.jsxs("div",{className:`rehearsal-preview ${u?"today-rehearsal":""}`,onClick:()=>n(t._id),children:[u&&e.jsx("div",{className:"today-badge",children:"היום"}),e.jsxs("div",{className:"preview-header",children:[e.jsx("h4",{children:s}),e.jsxs("div",{className:"time-info",children:[e.jsxs("span",{className:"time-range",children:[e.jsx(Ve,{size:18}),t.startTime," - ",t.endTime]}),e.jsxs("span",{className:"duration",children:["(",p(m),")"]})]})]}),e.jsxs("div",{className:"preview-content",children:[e.jsxs("div",{className:"location-info",children:[e.jsx(gt,{size:16}),e.jsx("span",{className:"location",children:t.location})]}),t.notes&&e.jsxs("div",{className:"notes-info",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:t.notes})]})]}),e.jsx("div",{className:"preview-footer",children:e.jsxs("div",{className:"action-buttons",children:[i&&e.jsx("button",{className:"action-btn edit",onClick:y=>{y.stopPropagation(),i(t._id)},"aria-label":"ערוך חזרה",children:e.jsx(ba,{size:20})}),c&&e.jsx("button",{className:"action-btn delete",onClick:y=>{y.stopPropagation(),c(t.groupId,t._id)},"aria-label":"מחק חזרה",title:"מחק חזרה (אפשרויות מחיקה)",children:e.jsx(Ft,{size:20})}),l&&!c&&e.jsx("button",{className:"action-btn delete",onClick:y=>{y.stopPropagation(),l(t._id)},"aria-label":"מחק חזרה",children:e.jsx(Ft,{size:20})})]})})]})}function Y$({rehearsals:t,isLoading:s,orchestras:n,onEdit:i,onView:l,onRemove:c,onRemoveOrchestra:u}){const f=x.useMemo(()=>{if(!t.length)return[];const y=new Date().toISOString().split("T")[0],v=t.reduce((j,N)=>{const b=N.date;return j[b]||(j[b]={date:b,rehearsals:[],isToday:b===y}),j[b].rehearsals.push(N),j},{});return Object.values(v).forEach(j=>{j.rehearsals.sort((N,b)=>N.startTime.localeCompare(b.startTime))}),Object.values(v).sort((j,N)=>j.isToday&&!N.isToday?-1:!j.isToday&&N.isToday?1:new Date(j.date).getTime()-new Date(N.date).getTime())},[t]);if(s&&t.length===0)return e.jsx("div",{className:"loading-state",children:"טוען חזרות..."});if(t.length===0)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו חזרות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף חזרות חדשות"})]});const p=(y,v)=>v?"חזרות היום":new Date(y).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=y=>{const v=n.find(j=>j._id===y);return v?v.name:"תזמורת לא מוגדרת"};return e.jsx("div",{className:"rehearsal-list-container",children:f.map(({date:y,rehearsals:v,isToday:j})=>e.jsxs("div",{className:`rehearsal-date-group ${j?"today-group":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx($e,{size:20}),e.jsx("h2",{children:p(y,j)})]}),e.jsx("div",{className:"rehearsal-grid",children:v.map(N=>e.jsx(H$,{rehearsal:N,orchestraName:m(N.groupId),onEdit:i,onView:l,onRemove:c,onRemoveOrchestra:u,isToday:j},N._id))})]},y))})}function V$({isOpen:t,onClose:s,orchestraName:n,orchestraRehearsalsCount:i,onDeleteSingle:l,onDeleteAll:c}){const[u,f]=x.useState(null),p=()=>{f("single")},m=()=>{f("all")},y=()=>{u==="single"?l():u==="all"&&c(),f(null),s()},v=()=>{f(null),s()};if(u){const j=u==="all";return e.jsx(ps,{isOpen:!0,onClose:()=>f(null),onConfirm:y,title:j?"מחיקת כל החזרות":"מחיקת חזרה",message:j?`האם אתה בטוח שברצונך למחוק את כל ${i} החזרות של "${n}"? פעולה זו לא ניתנת לביטול.`:"האם אתה בטוח שברצונך למחוק חזרה זו? פעולה זו לא ניתנת לביטול.",confirmText:j?`מחק ${i} חזרות`:"מחק חזרה",cancelText:"ביטול",type:"danger"})}return e.jsx(Ua,{isOpen:t,onClose:v,children:e.jsxs("div",{className:"rehearsal-delete-dialog",children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx(oi,{size:24,className:"warning-icon"}),e.jsx("h3",{children:"מחיקת חזרה"})]}),e.jsxs("div",{className:"dialog-content",children:[e.jsx("p",{children:"בחר את סוג המחיקה שברצונך לבצע:"}),e.jsxs("div",{className:"delete-options",children:[e.jsxs("button",{className:"delete-option-btn single",onClick:p,children:[e.jsx(Ft,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsx("div",{className:"option-title",children:"מחק חזרה זו בלבד"}),e.jsx("div",{className:"option-description",children:"מחיקה של חזרה יחידה זו"})]})]}),e.jsxs("button",{className:"delete-option-btn bulk",onClick:m,children:[e.jsx($e,{size:20}),e.jsxs("div",{className:"option-content",children:[e.jsxs("div",{className:"option-title",children:['מחק את כל החזרות של "',n,'"']}),e.jsxs("div",{className:"option-description",children:["מחיקה של כל ",i," החזרות של התזמורת"]})]})]})]})]}),e.jsx("div",{className:"dialog-actions",children:e.jsx("button",{className:"btn secondary",onClick:v,children:"ביטול"})})]})})}function G$(){var ne;const{rehearsals:t,isLoading:s,error:n,loadRehearsals:i,removeRehearsal:l,removeRehearsalsByOrchestra:c}=_l(),{orchestras:u,loadOrchestras:f}=vr(),{addToast:p}=Ot(),[m,y]=p0(),v=m.get("orchestraId"),j=m.get("fromDate"),[N,b]=x.useState(!1),[w,A]=x.useState(null),[S,C]=x.useState(!1),[D,I]=x.useState(null),[T,R]=x.useState(!1),[E,_]=x.useState(null),[k,z]=x.useState(v),[M,G]=x.useState(j),X=_t(),W=gs(),{user:te}=ys(),L=te==null?void 0:te.roles.includes("מנהל"),J=te==null?void 0:te.roles.includes("מנצח"),K=W.pathname.includes("/rehearsals/")&&!W.pathname.endsWith("/rehearsals/");x.useEffect(()=>{f();const pe={};if(v&&(pe.groupId=v,z(v)),j)pe.fromDate=j,G(j);else{const je=new Date().toISOString().split("T")[0];pe.fromDate=je,G(je)}i(pe)},[i,f,v,j]),x.useEffect(()=>{const pe=new URLSearchParams(m);k?pe.set("orchestraId",k):pe.delete("orchestraId"),y(pe)},[k,y]);const le=t,O=()=>{A(null),b(!0)},U=()=>{b(!1),A(null)},Y=pe=>{const me=t.find(je=>je._id===pe)||null;A(me),b(!0)},Z=pe=>{X(`/rehearsals/${pe}`)},H=async()=>{if(D)try{await l(D),p({type:"success",message:"החזרה נמחקה לצמיתות בהצלחה"}),I(null)}catch(pe){console.error("Failed to remove rehearsal:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}C(!1)},P=(pe,me)=>{const je=t.find(Oe=>Oe._id===me);je&&(_(je),R(!0))},q=async()=>{if(E)try{await l(E._id),p({type:"success",message:"החזרה נמחקה בהצלחה"})}catch(pe){console.error("Failed to remove rehearsal:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}},B=async()=>{if(E)try{const pe=await c(E.groupId);p({type:"success",message:`נמחקו ${pe.deletedCount} חזרות בהצלחה`})}catch(pe){console.error("Failed to remove orchestra rehearsals:",pe),p({type:"danger",message:"אירעה שגיאה במחיקת החזרות"})}},se=pe=>{const me=pe.target.value||null;z(me);const je=new URLSearchParams(m);me?je.set("orchestraId",me):je.delete("orchestraId"),y(je),i({groupId:me||void 0,fromDate:M||void 0})},ae=pe=>{const me=pe.target.value||null;G(me);const je=new URLSearchParams(m);me?je.set("fromDate",me):je.delete("fromDate"),y(je),i({groupId:k||void 0,fromDate:me||void 0})},oe=()=>{z(null),G(null),y(new URLSearchParams),i({})},ce=L||J,Q=L||J;return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!K&&e.jsxs("div",{className:"page-header",children:[e.jsx("div",{className:"page-title",children:e.jsxs("h1",{children:[e.jsx($e,{className:"title-icon"}),"לוח חזרות"]})}),e.jsx("div",{className:"search-action-container-rehearsal",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("div",{className:"filter-dropdown",children:e.jsxs("select",{value:k||"",onChange:se,className:"filter-select",children:[e.jsx("option",{value:"",children:"כל התזמורות"}),u.map(pe=>e.jsx("option",{value:pe._id,children:pe.name},pe._id))]})}),e.jsx("div",{className:"filter-date",children:e.jsx("input",{type:"date",value:M||"",onChange:ae,className:"date-picker"})}),(k||M)&&e.jsx("button",{className:"btn secondary",onClick:oe,children:"איפוס"}),ce&&e.jsx("button",{className:"btn-icon add-btn",onClick:O,"aria-label":"הוספת חזרה חדשה",children:e.jsx(fs,{className:"icon"})})]})})]}),n&&e.jsx("div",{className:"error-message",children:n}),!K&&e.jsx(Y$,{rehearsals:le,isLoading:s,onEdit:Q?Y:void 0,onView:Z,onRemoveOrchestra:L?P:void 0,orchestras:u}),e.jsx(wl,{}),e.jsx(ps,{isOpen:S,onClose:()=>C(!1),onConfirm:H,title:"⚠️ מחיקה לצמיתות",message:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"זהירות: פעולת מחיקה לצמיתות!"})}),e.jsx("p",{children:"החזרה תימחק לצמיתות מהמערכת."}),e.jsx("p",{children:"כל נתוני הנוכחות והמידע הקשור יימחקו גם כן."}),e.jsx("p",{className:"text-sm text-muted",children:e.jsx("strong",{children:"פעולה זו לא ניתנת לביטול!"})})]}),confirmText:"מחק לצמיתות",cancelText:"ביטול",type:"danger"}),T&&E&&e.jsx(V$,{isOpen:T,onClose:()=>{R(!1),_(null)},orchestraName:((ne=u.find(pe=>pe._id===E.groupId))==null?void 0:ne.name)||"לא ידוע",orchestraRehearsalsCount:t.filter(pe=>pe.groupId===E.groupId).length,onDeleteSingle:async()=>{await q(),R(!1),_(null)},onDeleteAll:async()=>{await B(),R(!1),_(null)}}),N&&e.jsx(pp,{isOpen:N,onClose:U,rehearsal:w,orchestraId:k||"",onSave:i})]}),!K&&!N&&e.jsx(mi,{})]})}function Mj(){var ae,oe;const{rehearsalId:t}=jr(),s=_t(),{user:n}=ys(),{addToast:i}=Ot(),{selectedRehearsal:l,loadRehearsalById:c,removeRehearsal:u,updateAttendance:f,isLoading:p,error:m}=_l(),{loadOrchestraById:y}=vr(),{getStudentsByIds:v}=Ma(),[j,N]=x.useState(null),[b,w]=x.useState([]),[A,S]=x.useState(!1),[C,D]=x.useState(!1),[I,T]=x.useState(!1),[R,E]=x.useState(!1),[_,k]=x.useState([]),[z,M]=x.useState([]),[G,X]=x.useState(!1),[W,te]=x.useState(!1),[L,J]=x.useState(!1),K=((ae=n==null?void 0:n.roles)==null?void 0:ae.includes("מנהל"))||!1,le=((oe=n==null?void 0:n.roles)==null?void 0:oe.includes("מנצח"))||!1,O=K||le,U=K||le;x.useEffect(()=>{t&&c(t)},[t,c]),x.useEffect(()=>{(async()=>{if(l!=null&&l.groupId){S(!0);try{await y(l.groupId);const Q=vr.getState();N(Q.selectedOrchestra)}catch(Q){console.error("Failed to load orchestra:",Q)}finally{S(!1)}}})()},[l,y]),x.useEffect(()=>{(async()=>{if(j!=null&&j.memberIds&&j.memberIds.length>0){D(!0);try{const Q=await v(j.memberIds);w(Q)}catch(Q){console.error("Failed to load students:",Q)}finally{D(!1)}}else w([])})()},[j,v]),x.useEffect(()=>{l!=null&&l.attendance?(k(l.attendance.present||[]),M(l.attendance.absent||[])):(k([]),M([])),X(!1)},[l]);const Y=ce=>new Date(ce).toLocaleDateString("he-IL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Z=ce=>{let Q=[..._],ne=[...z];_.includes(ce)?(Q=Q.filter(pe=>pe!==ce),ne.push(ce)):(z.includes(ce)&&(ne=ne.filter(pe=>pe!==ce)),Q.push(ce)),k(Q),M(ne),X(!0),J(!1)},H=ce=>_.includes(ce),P=async()=>{if(!(!t||!l)){te(!0);try{await f(t,{present:_,absent:z}),J(!0),X(!1),i({type:"success",message:"נוכחות עודכנה בהצלחה"}),await c(t)}catch(ce){console.error("Failed to update attendance:",ce),i({type:"danger",message:"אירעה שגיאה בעידכון הנוכחות"})}finally{te(!1)}}},q=()=>{T(!0)},B=()=>{j!=null&&j._id?s(`/rehearsals?orchestraId=${j._id}`):s("/rehearsals")},se=async()=>{if(l!=null&&l._id)try{await u(l._id),i({type:"success",message:"החזרה נמחקה לצמיתות בהצלחה"}),s("/rehearsals")}catch(ce){console.error("Failed to delete rehearsal:",ce),i({type:"danger",message:"אירעה שגיאה במחיקת החזרה"})}E(!1)};return p?e.jsx("div",{className:"loading-state",children:"טוען..."}):m?e.jsx("div",{className:"error-state",children:m}):l?e.jsxs("div",{className:"rehearsal-details",children:[e.jsx("div",{className:"rehearsal-details-page",children:e.jsx("div",{className:"rehearsal-card-container",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"rehearsal-header",children:[e.jsx("button",{className:"back-button",onClick:B,"aria-label":"חזור",children:e.jsx(zs,{className:"lucide lucide-arrow-right"})}),e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"דיווח נוכחות לחזרה"}),e.jsxs("div",{className:"date-display",children:[e.jsx($e,{size:18}),e.jsx("span",{children:Y(l.date)})]})]}),e.jsx("div",{className:"header-actions",children:O&&e.jsxs("button",{className:"action-btn edit",onClick:q,children:[e.jsx(ba,{size:16}),"עריכה"]})})]}),e.jsxs("div",{className:"orchestra-info-card",children:[e.jsx("h3",{children:A?"טוען...":(j==null?void 0:j.name)||"לא מוגדר"}),e.jsxs("div",{className:"rehearsal-details-row",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"מיקום:"}),e.jsx("span",{className:"detail-value",children:l.location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"זמן:"}),e.jsxs("span",{className:"detail-value",children:[l.startTime," - ",l.endTime]})]})]})]}),e.jsx("div",{className:"attendance-section",children:e.jsx("div",{className:"students-list-container",children:C?e.jsx("div",{className:"loading-students",children:"טוען רשימת תלמידים..."}):b.length>0?e.jsx("ul",{className:"students-list",children:b.map(ce=>e.jsxs("li",{className:`student-item ${H(ce._id)?"present":""}`,children:[e.jsxs("div",{className:"student-info",children:[e.jsx("div",{className:"student-name",children:ce.personalInfo.fullName}),e.jsx("div",{className:"student-instrument",children:ce.academicInfo.instrument})]}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:H(ce._id),onChange:()=>Z(ce._id)}),e.jsx("span",{className:"toggle-slider"})]})]},ce._id))}):e.jsx("div",{className:"empty-students",children:"אין תלמידים רשומים לתזמורת זו"})})}),U&&e.jsxs("div",{className:"attendance-footer",children:[L&&e.jsx("span",{className:"save-success",children:"הנוכחות עודכנה בהצלחה!"}),e.jsx("button",{className:"save-attendance-btn",onClick:P,disabled:!G||W,children:W?"שומר...":"עדכן נוכחות"})]})]})})}),I&&e.jsx(pp,{isOpen:I,onClose:()=>T(!1),rehearsal:l,orchestraId:l.groupId,onSave:()=>{T(!1),t&&c(t)}}),e.jsx(ps,{isOpen:R,onClose:()=>E(!1),onConfirm:se,title:"מחיקת חזרה",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק את החזרה בתאריך "',Y(l.date),'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}):e.jsx("div",{className:"not-found-state",children:"חזרה לא נמצאה"})}var Yd={exports:{}},Q$=Yd.exports,zj;function X$(){return zj||(zj=1,function(t,s){(function(n,i){t.exports=i()})(Q$,function(){var n=1e3,i=6e4,l=36e5,c="millisecond",u="second",f="minute",p="hour",m="day",y="week",v="month",j="quarter",N="year",b="date",w="Invalid Date",A=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,C={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(W){var te=["th","st","nd","rd"],L=W%100;return"["+W+(te[(L-20)%10]||te[L]||te[0])+"]"}},D=function(W,te,L){var J=String(W);return!J||J.length>=te?W:""+Array(te+1-J.length).join(L)+W},I={s:D,z:function(W){var te=-W.utcOffset(),L=Math.abs(te),J=Math.floor(L/60),K=L%60;return(te<=0?"+":"-")+D(J,2,"0")+":"+D(K,2,"0")},m:function W(te,L){if(te.date()<L.date())return-W(L,te);var J=12*(L.year()-te.year())+(L.month()-te.month()),K=te.clone().add(J,v),le=L-K<0,O=te.clone().add(J+(le?-1:1),v);return+(-(J+(L-K)/(le?K-O:O-K))||0)},a:function(W){return W<0?Math.ceil(W)||0:Math.floor(W)},p:function(W){return{M:v,y:N,w:y,d:m,D:b,h:p,m:f,s:u,ms:c,Q:j}[W]||String(W||"").toLowerCase().replace(/s$/,"")},u:function(W){return W===void 0}},T="en",R={};R[T]=C;var E="$isDayjsObject",_=function(W){return W instanceof G||!(!W||!W[E])},k=function W(te,L,J){var K;if(!te)return T;if(typeof te=="string"){var le=te.toLowerCase();R[le]&&(K=le),L&&(R[le]=L,K=le);var O=te.split("-");if(!K&&O.length>1)return W(O[0])}else{var U=te.name;R[U]=te,K=U}return!J&&K&&(T=K),K||!J&&T},z=function(W,te){if(_(W))return W.clone();var L=typeof te=="object"?te:{};return L.date=W,L.args=arguments,new G(L)},M=I;M.l=k,M.i=_,M.w=function(W,te){return z(W,{locale:te.$L,utc:te.$u,x:te.$x,$offset:te.$offset})};var G=function(){function W(L){this.$L=k(L.locale,null,!0),this.parse(L),this.$x=this.$x||L.x||{},this[E]=!0}var te=W.prototype;return te.parse=function(L){this.$d=function(J){var K=J.date,le=J.utc;if(K===null)return new Date(NaN);if(M.u(K))return new Date;if(K instanceof Date)return new Date(K);if(typeof K=="string"&&!/Z$/i.test(K)){var O=K.match(A);if(O){var U=O[2]-1||0,Y=(O[7]||"0").substring(0,3);return le?new Date(Date.UTC(O[1],U,O[3]||1,O[4]||0,O[5]||0,O[6]||0,Y)):new Date(O[1],U,O[3]||1,O[4]||0,O[5]||0,O[6]||0,Y)}}return new Date(K)}(L),this.init()},te.init=function(){var L=this.$d;this.$y=L.getFullYear(),this.$M=L.getMonth(),this.$D=L.getDate(),this.$W=L.getDay(),this.$H=L.getHours(),this.$m=L.getMinutes(),this.$s=L.getSeconds(),this.$ms=L.getMilliseconds()},te.$utils=function(){return M},te.isValid=function(){return this.$d.toString()!==w},te.isSame=function(L,J){var K=z(L);return this.startOf(J)<=K&&K<=this.endOf(J)},te.isAfter=function(L,J){return z(L)<this.startOf(J)},te.isBefore=function(L,J){return this.endOf(J)<z(L)},te.$g=function(L,J,K){return M.u(L)?this[J]:this.set(K,L)},te.unix=function(){return Math.floor(this.valueOf()/1e3)},te.valueOf=function(){return this.$d.getTime()},te.startOf=function(L,J){var K=this,le=!!M.u(J)||J,O=M.p(L),U=function(ae,oe){var ce=M.w(K.$u?Date.UTC(K.$y,oe,ae):new Date(K.$y,oe,ae),K);return le?ce:ce.endOf(m)},Y=function(ae,oe){return M.w(K.toDate()[ae].apply(K.toDate("s"),(le?[0,0,0,0]:[23,59,59,999]).slice(oe)),K)},Z=this.$W,H=this.$M,P=this.$D,q="set"+(this.$u?"UTC":"");switch(O){case N:return le?U(1,0):U(31,11);case v:return le?U(1,H):U(0,H+1);case y:var B=this.$locale().weekStart||0,se=(Z<B?Z+7:Z)-B;return U(le?P-se:P+(6-se),H);case m:case b:return Y(q+"Hours",0);case p:return Y(q+"Minutes",1);case f:return Y(q+"Seconds",2);case u:return Y(q+"Milliseconds",3);default:return this.clone()}},te.endOf=function(L){return this.startOf(L,!1)},te.$set=function(L,J){var K,le=M.p(L),O="set"+(this.$u?"UTC":""),U=(K={},K[m]=O+"Date",K[b]=O+"Date",K[v]=O+"Month",K[N]=O+"FullYear",K[p]=O+"Hours",K[f]=O+"Minutes",K[u]=O+"Seconds",K[c]=O+"Milliseconds",K)[le],Y=le===m?this.$D+(J-this.$W):J;if(le===v||le===N){var Z=this.clone().set(b,1);Z.$d[U](Y),Z.init(),this.$d=Z.set(b,Math.min(this.$D,Z.daysInMonth())).$d}else U&&this.$d[U](Y);return this.init(),this},te.set=function(L,J){return this.clone().$set(L,J)},te.get=function(L){return this[M.p(L)]()},te.add=function(L,J){var K,le=this;L=Number(L);var O=M.p(J),U=function(H){var P=z(le);return M.w(P.date(P.date()+Math.round(H*L)),le)};if(O===v)return this.set(v,this.$M+L);if(O===N)return this.set(N,this.$y+L);if(O===m)return U(1);if(O===y)return U(7);var Y=(K={},K[f]=i,K[p]=l,K[u]=n,K)[O]||1,Z=this.$d.getTime()+L*Y;return M.w(Z,this)},te.subtract=function(L,J){return this.add(-1*L,J)},te.format=function(L){var J=this,K=this.$locale();if(!this.isValid())return K.invalidDate||w;var le=L||"YYYY-MM-DDTHH:mm:ssZ",O=M.z(this),U=this.$H,Y=this.$m,Z=this.$M,H=K.weekdays,P=K.months,q=K.meridiem,B=function(oe,ce,Q,ne){return oe&&(oe[ce]||oe(J,le))||Q[ce].slice(0,ne)},se=function(oe){return M.s(U%12||12,oe,"0")},ae=q||function(oe,ce,Q){var ne=oe<12?"AM":"PM";return Q?ne.toLowerCase():ne};return le.replace(S,function(oe,ce){return ce||function(Q){switch(Q){case"YY":return String(J.$y).slice(-2);case"YYYY":return M.s(J.$y,4,"0");case"M":return Z+1;case"MM":return M.s(Z+1,2,"0");case"MMM":return B(K.monthsShort,Z,P,3);case"MMMM":return B(P,Z);case"D":return J.$D;case"DD":return M.s(J.$D,2,"0");case"d":return String(J.$W);case"dd":return B(K.weekdaysMin,J.$W,H,2);case"ddd":return B(K.weekdaysShort,J.$W,H,3);case"dddd":return H[J.$W];case"H":return String(U);case"HH":return M.s(U,2,"0");case"h":return se(1);case"hh":return se(2);case"a":return ae(U,Y,!0);case"A":return ae(U,Y,!1);case"m":return String(Y);case"mm":return M.s(Y,2,"0");case"s":return String(J.$s);case"ss":return M.s(J.$s,2,"0");case"SSS":return M.s(J.$ms,3,"0");case"Z":return O}return null}(oe)||O.replace(":","")})},te.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},te.diff=function(L,J,K){var le,O=this,U=M.p(J),Y=z(L),Z=(Y.utcOffset()-this.utcOffset())*i,H=this-Y,P=function(){return M.m(O,Y)};switch(U){case N:le=P()/12;break;case v:le=P();break;case j:le=P()/3;break;case y:le=(H-Z)/6048e5;break;case m:le=(H-Z)/864e5;break;case p:le=H/l;break;case f:le=H/i;break;case u:le=H/n;break;default:le=H}return K?le:M.a(le)},te.daysInMonth=function(){return this.endOf(v).$D},te.$locale=function(){return R[this.$L]},te.locale=function(L,J){if(!L)return this.$L;var K=this.clone(),le=k(L,J,!0);return le&&(K.$L=le),K},te.clone=function(){return M.w(this.$d,this)},te.toDate=function(){return new Date(this.valueOf())},te.toJSON=function(){return this.isValid()?this.toISOString():null},te.toISOString=function(){return this.$d.toISOString()},te.toString=function(){return this.$d.toUTCString()},W}(),X=G.prototype;return z.prototype=X,[["$ms",c],["$s",u],["$m",f],["$H",p],["$W",m],["$M",v],["$y",N],["$D",b]].forEach(function(W){X[W[1]]=function(te){return this.$g(te,W[0],W[1])}}),z.extend=function(W,te){return W.$i||(W(te,G,z),W.$i=!0),z},z.locale=k,z.isDayjs=_,z.unix=function(W){return z(1e3*W)},z.en=R[T],z.Ls=R,z.p={},z})}(Yd)),Yd.exports}var Z$=X$();const lt=Ja(Z$);var Vd={exports:{}},W$=Vd.exports,Lj;function K$(){return Lj||(Lj=1,function(t,s){(function(n,i){t.exports=i()})(W$,function(){var n="minute",i=/[+-]\d\d(?::?\d\d)?/g,l=/([+-]|\d\d)/g;return function(c,u,f){var p=u.prototype;f.utc=function(w){var A={date:w,utc:!0,args:arguments};return new u(A)},p.utc=function(w){var A=f(this.toDate(),{locale:this.$L,utc:!0});return w?A.add(this.utcOffset(),n):A},p.local=function(){return f(this.toDate(),{locale:this.$L,utc:!1})};var m=p.parse;p.parse=function(w){w.utc&&(this.$u=!0),this.$utils().u(w.$offset)||(this.$offset=w.$offset),m.call(this,w)};var y=p.init;p.init=function(){if(this.$u){var w=this.$d;this.$y=w.getUTCFullYear(),this.$M=w.getUTCMonth(),this.$D=w.getUTCDate(),this.$W=w.getUTCDay(),this.$H=w.getUTCHours(),this.$m=w.getUTCMinutes(),this.$s=w.getUTCSeconds(),this.$ms=w.getUTCMilliseconds()}else y.call(this)};var v=p.utcOffset;p.utcOffset=function(w,A){var S=this.$utils().u;if(S(w))return this.$u?0:S(this.$offset)?v.call(this):this.$offset;if(typeof w=="string"&&(w=function(T){T===void 0&&(T="");var R=T.match(i);if(!R)return null;var E=(""+R[0]).match(l)||["-",0,0],_=E[0],k=60*+E[1]+ +E[2];return k===0?0:_==="+"?k:-k}(w),w===null))return this;var C=Math.abs(w)<=16?60*w:w,D=this;if(A)return D.$offset=C,D.$u=w===0,D;if(w!==0){var I=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(D=this.local().add(C+I,n)).$offset=C,D.$x.$localOffset=I}else D=this.utc();return D};var j=p.format;p.format=function(w){var A=w||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return j.call(this,A)},p.valueOf=function(){var w=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*w},p.isUTC=function(){return!!this.$u},p.toISOString=function(){return this.toDate().toISOString()},p.toString=function(){return this.toDate().toUTCString()};var N=p.toDate;p.toDate=function(w){return w==="s"&&this.$offset?f(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():N.call(this)};var b=p.diff;p.diff=function(w,A,S){if(w&&this.$u===w.$u)return b.call(this,w,A,S);var C=this.local(),D=f(w).local();return b.call(C,D,A,S)}}})}(Vd)),Vd.exports}var J$=K$();const eR=Ja(J$);var Gd={exports:{}},tR=Gd.exports,Bj;function sR(){return Bj||(Bj=1,function(t,s){(function(n,i){t.exports=i()})(tR,function(){var n={year:0,month:1,day:2,hour:3,minute:4,second:5},i={};return function(l,c,u){var f,p=function(j,N,b){b===void 0&&(b={});var w=new Date(j),A=function(S,C){C===void 0&&(C={});var D=C.timeZoneName||"short",I=S+"|"+D,T=i[I];return T||(T=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:S,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:D}),i[I]=T),T}(N,b);return A.formatToParts(w)},m=function(j,N){for(var b=p(j,N),w=[],A=0;A<b.length;A+=1){var S=b[A],C=S.type,D=S.value,I=n[C];I>=0&&(w[I]=parseInt(D,10))}var T=w[3],R=T===24?0:T,E=w[0]+"-"+w[1]+"-"+w[2]+" "+R+":"+w[4]+":"+w[5]+":000",_=+j;return(u.utc(E).valueOf()-(_-=_%1e3))/6e4},y=c.prototype;y.tz=function(j,N){j===void 0&&(j=f);var b,w=this.utcOffset(),A=this.toDate(),S=A.toLocaleString("en-US",{timeZone:j}),C=Math.round((A-new Date(S))/1e3/60),D=15*-Math.round(A.getTimezoneOffset()/15)-C;if(!Number(D))b=this.utcOffset(0,N);else if(b=u(S,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(D,!0),N){var I=b.utcOffset();b=b.add(w-I,"minute")}return b.$x.$timezone=j,b},y.offsetName=function(j){var N=this.$x.$timezone||u.tz.guess(),b=p(this.valueOf(),N,{timeZoneName:j}).find(function(w){return w.type.toLowerCase()==="timezonename"});return b&&b.value};var v=y.startOf;y.startOf=function(j,N){if(!this.$x||!this.$x.$timezone)return v.call(this,j,N);var b=u(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return v.call(b,j,N).tz(this.$x.$timezone,!0)},u.tz=function(j,N,b){var w=b&&N,A=b||N||f,S=m(+u(),A);if(typeof j!="string")return u(j).tz(A);var C=function(R,E,_){var k=R-60*E*1e3,z=m(k,_);if(E===z)return[k,E];var M=m(k-=60*(z-E)*1e3,_);return z===M?[k,z]:[R-60*Math.min(z,M)*1e3,Math.max(z,M)]}(u.utc(j,w).valueOf(),S,A),D=C[0],I=C[1],T=u(D).utcOffset(I);return T.$x.$timezone=A,T},u.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},u.tz.setDefault=function(j){f=j}}})}(Gd)),Gd.exports}var aR=sR();const nR=Ja(aR);var Qd={exports:{}},rR=Qd.exports,Fj;function iR(){return Fj||(Fj=1,function(t,s){(function(n,i){t.exports=i()})(rR,function(){return function(n,i,l){n=n||{};var c=i.prototype,u={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function f(m,y,v,j){return c.fromToBase(m,y,v,j)}l.en.relativeTime=u,c.fromToBase=function(m,y,v,j,N){for(var b,w,A,S=v.$locale().relativeTime||u,C=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],D=C.length,I=0;I<D;I+=1){var T=C[I];T.d&&(b=j?l(m).diff(v,T.d,!0):v.diff(m,T.d,!0));var R=(n.rounding||Math.round)(Math.abs(b));if(A=b>0,R<=T.r||!T.r){R<=1&&I>0&&(T=C[I-1]);var E=S[T.l];N&&(R=N(""+R)),w=typeof E=="string"?E.replace("%d",R):E(R,y,T.l,A);break}}if(y)return w;var _=A?S.future:S.past;return typeof _=="function"?_(w):_.replace("%s",w)},c.to=function(m,y){return f(m,y,this,!0)},c.from=function(m,y){return f(m,y,this)};var p=function(m){return m.$u?l.utc():l()};c.toNow=function(m){return this.to(p(this),m)},c.fromNow=function(m){return this.from(p(this),m)}}})}(Qd)),Qd.exports}var lR=iR();const oR=Ja(lR);var Xd={exports:{}},cR=Xd.exports,Uj;function dR(){return Uj||(Uj=1,function(t,s){(function(n,i){t.exports=i()})(cR,function(){var n,i,l=1e3,c=6e4,u=36e5,f=864e5,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m=31536e6,y=2628e6,v=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,j={years:m,months:y,days:f,hours:u,minutes:c,seconds:l,milliseconds:1,weeks:6048e5},N=function(R){return R instanceof I},b=function(R,E,_){return new I(R,_,E.$l)},w=function(R){return i.p(R)+"s"},A=function(R){return R<0},S=function(R){return A(R)?Math.ceil(R):Math.floor(R)},C=function(R){return Math.abs(R)},D=function(R,E){return R?A(R)?{negative:!0,format:""+C(R)+E}:{negative:!1,format:""+R+E}:{negative:!1,format:""}},I=function(){function R(_,k,z){var M=this;if(this.$d={},this.$l=z,_===void 0&&(this.$ms=0,this.parseFromMilliseconds()),k)return b(_*j[w(k)],this);if(typeof _=="number")return this.$ms=_,this.parseFromMilliseconds(),this;if(typeof _=="object")return Object.keys(_).forEach(function(W){M.$d[w(W)]=_[W]}),this.calMilliseconds(),this;if(typeof _=="string"){var G=_.match(v);if(G){var X=G.slice(2).map(function(W){return W!=null?Number(W):0});return this.$d.years=X[0],this.$d.months=X[1],this.$d.weeks=X[2],this.$d.days=X[3],this.$d.hours=X[4],this.$d.minutes=X[5],this.$d.seconds=X[6],this.calMilliseconds(),this}}return this}var E=R.prototype;return E.calMilliseconds=function(){var _=this;this.$ms=Object.keys(this.$d).reduce(function(k,z){return k+(_.$d[z]||0)*j[z]},0)},E.parseFromMilliseconds=function(){var _=this.$ms;this.$d.years=S(_/m),_%=m,this.$d.months=S(_/y),_%=y,this.$d.days=S(_/f),_%=f,this.$d.hours=S(_/u),_%=u,this.$d.minutes=S(_/c),_%=c,this.$d.seconds=S(_/l),_%=l,this.$d.milliseconds=_},E.toISOString=function(){var _=D(this.$d.years,"Y"),k=D(this.$d.months,"M"),z=+this.$d.days||0;this.$d.weeks&&(z+=7*this.$d.weeks);var M=D(z,"D"),G=D(this.$d.hours,"H"),X=D(this.$d.minutes,"M"),W=this.$d.seconds||0;this.$d.milliseconds&&(W+=this.$d.milliseconds/1e3,W=Math.round(1e3*W)/1e3);var te=D(W,"S"),L=_.negative||k.negative||M.negative||G.negative||X.negative||te.negative,J=G.format||X.format||te.format?"T":"",K=(L?"-":"")+"P"+_.format+k.format+M.format+J+G.format+X.format+te.format;return K==="P"||K==="-P"?"P0D":K},E.toJSON=function(){return this.toISOString()},E.format=function(_){var k=_||"YYYY-MM-DDTHH:mm:ss",z={Y:this.$d.years,YY:i.s(this.$d.years,2,"0"),YYYY:i.s(this.$d.years,4,"0"),M:this.$d.months,MM:i.s(this.$d.months,2,"0"),D:this.$d.days,DD:i.s(this.$d.days,2,"0"),H:this.$d.hours,HH:i.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:i.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:i.s(this.$d.seconds,2,"0"),SSS:i.s(this.$d.milliseconds,3,"0")};return k.replace(p,function(M,G){return G||String(z[M])})},E.as=function(_){return this.$ms/j[w(_)]},E.get=function(_){var k=this.$ms,z=w(_);return z==="milliseconds"?k%=1e3:k=z==="weeks"?S(k/j[z]):this.$d[z],k||0},E.add=function(_,k,z){var M;return M=k?_*j[w(k)]:N(_)?_.$ms:b(_,this).$ms,b(this.$ms+M*(z?-1:1),this)},E.subtract=function(_,k){return this.add(_,k,!0)},E.locale=function(_){var k=this.clone();return k.$l=_,k},E.clone=function(){return b(this.$ms,this)},E.humanize=function(_){return n().add(this.$ms,"ms").locale(this.$l).fromNow(!_)},E.valueOf=function(){return this.asMilliseconds()},E.milliseconds=function(){return this.get("milliseconds")},E.asMilliseconds=function(){return this.as("milliseconds")},E.seconds=function(){return this.get("seconds")},E.asSeconds=function(){return this.as("seconds")},E.minutes=function(){return this.get("minutes")},E.asMinutes=function(){return this.as("minutes")},E.hours=function(){return this.get("hours")},E.asHours=function(){return this.as("hours")},E.days=function(){return this.get("days")},E.asDays=function(){return this.as("days")},E.weeks=function(){return this.get("weeks")},E.asWeeks=function(){return this.as("weeks")},E.months=function(){return this.get("months")},E.asMonths=function(){return this.as("months")},E.years=function(){return this.get("years")},E.asYears=function(){return this.as("years")},R}(),T=function(R,E,_){return R.add(E.years()*_,"y").add(E.months()*_,"M").add(E.days()*_,"d").add(E.hours()*_,"h").add(E.minutes()*_,"m").add(E.seconds()*_,"s").add(E.milliseconds()*_,"ms")};return function(R,E,_){n=_,i=_().$utils(),_.duration=function(M,G){var X=_.locale();return b(M,{$l:X},G)},_.isDuration=N;var k=E.prototype.add,z=E.prototype.subtract;E.prototype.add=function(M,G){return N(M)?T(this,M,1):k.bind(this)(M,G)},E.prototype.subtract=function(M,G){return N(M)?T(this,M,-1):z.bind(this)(M,G)}}})}(Xd)),Xd.exports}var uR=dR();const hR=Ja(uR);var Zd={exports:{}},fR=Zd.exports,Pj;function mR(){return Pj||(Pj=1,function(t,s){(function(n,i){t.exports=i()})(fR,function(){return function(n,i){i.prototype.isSameOrBefore=function(l,c){return this.isSame(l,c)||this.isBefore(l,c)}}})}(Zd)),Zd.exports}var pR=mR();const gR=Ja(pR);var Wd={exports:{}},yR=Wd.exports,qj;function vR(){return qj||(qj=1,function(t,s){(function(n,i){t.exports=i()})(yR,function(){return function(n,i){i.prototype.isSameOrAfter=function(l,c){return this.isSame(l,c)||this.isAfter(l,c)}}})}(Wd)),Wd.exports}var xR=vR();const jR=Ja(xR);lt.extend(eR);lt.extend(nR);lt.extend(oR);lt.extend(hR);lt.extend(gR);lt.extend(jR);const is="Asia/Jerusalem",bs="DD/MM/YYYY",hm="DD/MM/YYYY HH:MM",fm={0:"יום ראשון",1:"יום שני",2:"יום שלישי",3:"יום רביעי",4:"יום חמישי",5:"יום שישי",6:"יום שבת"};class wn{static formatLesson(s){var l;if(s.formatted){const c=lt.utc(s.date).tz(is),u=fm[c.day()];return{displayDate:((l=s.formatted.date)==null?void 0:l.replace(/Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday/g,"").trim())||c.format(bs),displayTime:s.formatted.timeRange,displayDateTime:s.formatted.dateTime,dayName:u,relative:s.formatted.relative,isToday:s.formatted.isToday,isPast:s.formatted.isPast,isFuture:s.formatted.isFuture,createdAt:s.formatted.createdAt,updatedAt:s.formatted.updatedAt,rawDate:s.date,rawStartTime:s.startTime,rawEndTime:s.endTime}}const n=lt.utc(s.date).tz(is),i=lt().tz(is);return{displayDate:n.format(bs),displayTime:s.startTime&&s.endTime?`${s.startTime}-${s.endTime}`:"",displayDateTime:s.startTime?`${n.format(bs)} ${s.startTime}`:n.format(bs),dayName:fm[n.day()],relative:n.fromNow(),isToday:n.isSame(i,"day"),isPast:n.isBefore(i,"day"),isFuture:n.isAfter(i,"day"),createdAt:s.createdAt?lt.utc(s.createdAt).tz(is).format(hm):void 0,updatedAt:s.updatedAt?lt.utc(s.updatedAt).tz(is).format(hm):void 0,rawDate:s.date,rawStartTime:s.startTime,rawEndTime:s.endTime}}static formatAttendance(s){var l,c;if(s.formatted)return{displayDate:s.formatted.date,markedAt:s.formatted.markedAt,markedAtRelative:s.formatted.markedAtRelative,attendanceRate:s.formatted.attendanceRate,presentCount:s.formatted.presentCount,absentCount:s.formatted.absentCount,totalStudents:s.formatted.totalStudents};const n=s.date?lt.utc(s.date).tz(is):null,i=s.markedAt?lt.utc(s.markedAt).tz(is):null;return{displayDate:n?n.format(bs):"",markedAt:i?i.format(hm):void 0,markedAtRelative:i?i.fromNow():void 0,attendanceRate:void 0,presentCount:s.present?s.present.length:0,absentCount:s.absent?s.absent.length:0,totalStudents:(((l=s.present)==null?void 0:l.length)||0)+(((c=s.absent)==null?void 0:c.length)||0)}}static formatForAPI(s){if(!s)return null;if(typeof s=="string"){if(s.match(/^\d{4}-\d{2}-\d{2}$/))return s;if(s.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[n,i,l]=s.split("/");return`${l}-${i.padStart(2,"0")}-${n.padStart(2,"0")}`}if(s.match(/^\d{2}-\d{2}-\d{4}$/)){const[n,i,l]=s.split("-");return`${l}-${i.padStart(2,"0")}-${n.padStart(2,"0")}`}}return lt(s).tz(is).format("YYYY-MM-DD")}static getHebrewDayName(s){let n=s;typeof s=="string"&&(n=s.replace(/Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday/g,"").trim());const i=lt(n).day();return fm[i]}static isUpcoming(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isSameOrAfter(i,"day")}static isPast(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isBefore(i,"day")}static isToday(s){const n=lt.utc(s).tz(is),i=lt().tz(is);return n.isSame(i,"day")}static parseUserDate(s){if(!s)return null;const n=["DD/MM/YYYY","DD-MM-YYYY","YYYY-MM-DD","DD/MM/YY","DD-MM-YY"];for(const l of n){const c=lt(s,l,!0);if(c.isValid())return c.tz(is)}const i=lt(s);return i.isValid()?i.tz(is):null}static validateDate(s){if(!s)return{valid:!1,error:"Date is required",errorCode:"REQUIRED"};const n=this.parseUserDate(String(s));if(!n)return{valid:!1,error:"Invalid date format. Please use DD/MM/YYYY or select from calendar",errorCode:"INVALID_FORMAT",expectedFormats:["DD/MM/YYYY","DD-MM-YYYY","YYYY-MM-DD"]};const i=lt().subtract(2,"years");if(n.isBefore(i))return{valid:!1,error:"Date cannot be more than 2 years in the past",errorCode:"TOO_OLD"};const l=lt().add(2,"years");return n.isAfter(l)?{valid:!1,error:"Date cannot be more than 2 years in the future",errorCode:"TOO_FUTURE"}:{valid:!0,parsed:n,formatted:n.format(bs),apiFormat:n.format("YYYY-MM-DD")}}static validateTime(s){return s?/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(s)?{valid:!0,formatted:s,display:s}:{valid:!1,error:"Time must be in HH:MM format (e.g., 14:30)",errorCode:"INVALID_FORMAT"}:{valid:!1,error:"Time is required",errorCode:"REQUIRED"}}static validateTimeRange(s,n){const i=this.validateTime(s);if(!i.valid)return{valid:!1,error:`Start time error: ${i.error}`,field:"startTime"};const l=this.validateTime(n);if(!l.valid)return{valid:!1,error:`End time error: ${l.error}`,field:"endTime"};const c=lt(`2000-01-01 ${s}`),u=lt(`2000-01-01 ${n}`);return c.isSameOrAfter(u)?{valid:!1,error:"End time must be after start time",field:"endTime",errorCode:"INVALID_RANGE"}:u.diff(c,"minutes")<15?{valid:!1,error:"Lesson must be at least 15 minutes long",field:"endTime",errorCode:"TOO_SHORT"}:{valid:!0,duration:u.diff(c,"minutes"),durationDisplay:`${Math.floor(u.diff(c,"minutes")/60)}h ${u.diff(c,"minutes")%60}m`}}static getDateRanges(){const s=lt().tz(is);return{today:{label:"Today",labelHe:"היום",fromDate:s.format("YYYY-MM-DD"),toDate:s.format("YYYY-MM-DD"),display:s.format(bs)},tomorrow:{label:"Tomorrow",labelHe:"מחר",fromDate:s.add(1,"day").format("YYYY-MM-DD"),toDate:s.add(1,"day").format("YYYY-MM-DD"),display:s.add(1,"day").format(bs)},thisWeek:{label:"This Week",labelHe:"השבוע",fromDate:s.startOf("week").format("YYYY-MM-DD"),toDate:s.endOf("week").format("YYYY-MM-DD"),display:`${s.startOf("week").format(bs)} - ${s.endOf("week").format(bs)}`},nextWeek:{label:"Next Week",labelHe:"השבוע הבא",fromDate:s.add(1,"week").startOf("week").format("YYYY-MM-DD"),toDate:s.add(1,"week").endOf("week").format("YYYY-MM-DD"),display:`${s.add(1,"week").startOf("week").format(bs)} - ${s.add(1,"week").endOf("week").format(bs)}`},thisMonth:{label:"This Month",labelHe:"החודש",fromDate:s.startOf("month").format("YYYY-MM-DD"),toDate:s.endOf("month").format("YYYY-MM-DD"),display:s.format("MMMM YYYY")},nextMonth:{label:"Next Month",labelHe:"החודש הבא",fromDate:s.add(1,"month").startOf("month").format("YYYY-MM-DD"),toDate:s.add(1,"month").endOf("month").format("YYYY-MM-DD"),display:s.add(1,"month").format("MMMM YYYY")},next7Days:{label:"Next 7 Days",labelHe:"7 הימים הבאים",fromDate:s.format("YYYY-MM-DD"),toDate:s.add(7,"days").format("YYYY-MM-DD"),display:`${s.format(bs)} - ${s.add(7,"days").format(bs)}`},next30Days:{label:"Next 30 Days",labelHe:"30 הימים הבאים",fromDate:s.format("YYYY-MM-DD"),toDate:s.add(30,"days").format("YYYY-MM-DD"),display:`${s.format(bs)} - ${s.add(30,"days").format(bs)}`}}}static isSchoolDay(s){const n=lt(s).day();return n>=0&&n<=4}static getNextSchoolDay(s=null){let n=s?lt(s):lt();for(;!this.isSchoolDay(n);)n=n.add(1,"day");return n.tz(is)}static formatConflicts(s){if(!s)return null;const n={hasConflicts:!1,room:[],teacher:[],total:0};return s.room&&s.room.length>0&&(n.hasConflicts=!0,n.room=s.room.map(i=>({type:"room",description:i.description,lesson:i.conflictingLesson,severity:"high"}))),s.teacher&&s.teacher.length>0&&(n.hasConflicts=!0,n.teacher=s.teacher.map(i=>({type:"teacher",description:i.description,lesson:i.conflictingLesson,severity:"medium"}))),n.total=n.room.length+n.teacher.length,n}}const bR=ii.memo(function({theoryLesson:s,teacherName:n,onView:i,onEdit:l,onRemove:c,showRelativeTime:u=!1,compact:f=!1,isToday:p=!1}){var E,_;const m="שעה",y="שעות",v="דקות",j="אחת",N="ו-";if(!s||!s._id)return console.error("TheoryPreview: Invalid theory lesson data",s),null;console.log("TheoryPreview category debug:",{category:s.category,categoryType:typeof s.category,categoryLength:(E=s.category)==null?void 0:E.length,lessonId:s._id});const b=x.useMemo(()=>wn.formatLesson(s),[s]),w=x.useMemo(()=>{var G,X;if(!s.attendance)return null;const k=((G=s.attendance.present)==null?void 0:G.length)||0,z=((X=s.attendance.absent)==null?void 0:X.length)||0,M=k+z;return{present:k,absent:z,total:M,rate:M>0?(k/M*100).toFixed(0):0}},[s.attendance]),A=(k,z)=>{try{const[M,G]=k.split(":").map(Number),[X,W]=z.split(":").map(Number),te=M*60+G;return X*60+W-te}catch(M){return console.error("Error calculating duration:",M,{startTime:k,endTime:z}),60}},S=k=>{const z=Math.floor(k/60),M=k%60;return z===0?`${M} ${v}`:z===1&&M===0?`${m} ${j}`:z===1?`${m} ${N}${M} ${v}`:M===0?`${z} ${y}`:`${z} ${y} ${N}${M} ${v}`},C=s.startTime||"09:00",D=s.endTime||"10:00",I=A(C,D),T=((_=s.studentIds)==null?void 0:_.length)||0,R=["theory-preview",b.isToday&&"today-theory",b.isPast&&"theory-preview--past",b.isFuture&&"theory-preview--future",f&&"theory-preview--compact"].filter(Boolean).join(" ");return e.jsxs("div",{className:R,onClick:()=>i(s._id),role:"button",tabIndex:0,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&i(s._id)},children:[e.jsxs("div",{className:"theory-preview__badges",children:[b.isToday&&e.jsx("div",{className:"today-badge",children:"היום"}),b.isPast&&e.jsx("div",{className:"past-badge",children:"עבר"}),b.isFuture&&e.jsx("div",{className:"future-badge",children:"עתיד"})]}),e.jsxs("div",{className:"preview-header",children:[e.jsx("div",{className:"category-section",children:e.jsx("h4",{className:"category-title",style:{color:"var(--text-primary) !important",webkitTextFillColor:"var(--text-primary) !important",backgroundClip:"initial !important",webkitBackgroundClip:"initial !important"},children:s.category&&s.category.trim()!==""?s.category:"שיעור תאוריה"})}),e.jsxs("div",{className:"time-section",children:[e.jsxs("div",{className:"main-time-badge",children:[e.jsx(Ve,{size:14}),e.jsxs("div",{className:"time-content",children:[e.jsx("span",{className:"time-range",children:b.displayTime}),e.jsx("span",{className:"duration",style:{fontFamily:"'Reisinger Amir', 'David', 'Noto Sans Hebrew', 'Arial Hebrew', sans-serif"},children:S(I)})]})]}),u&&b.relative&&e.jsx("div",{className:"relative-badge",children:e.jsx("span",{className:"relative-text",children:b.relative})})]})]}),e.jsxs("div",{className:"preview-content",children:[e.jsx("div",{className:"info-badge teacher-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"מורה"}),e.jsx("span",{className:"badge-value",children:n})]})}),e.jsx("div",{className:"info-badge location-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"מיקום"}),e.jsx("span",{className:"badge-value",children:s.location})]})}),e.jsx("div",{className:"info-badge students-badge",children:e.jsxs("div",{className:"badge-content",children:[e.jsx("span",{className:"badge-label",children:"תלמידים"}),e.jsxs("div",{className:"students-info",children:[e.jsx("span",{className:"student-count",children:T}),w&&w.total>0&&e.jsxs("span",{className:"attendance-rate",children:["(",w.present,"/",w.total,")"]})]})]})}),!f&&e.jsxs(e.Fragment,{children:[s.notes&&e.jsxs("div",{className:"notes-info",children:[e.jsx("span",{className:"notes-label",children:"הערות:"}),e.jsx("span",{className:"notes-text",children:s.notes})]}),s.syllabus&&e.jsxs("div",{className:"syllabus-info",children:[e.jsx("span",{className:"syllabus-label",children:"סילבוס:"}),e.jsx("span",{className:"syllabus-text",children:s.syllabus})]})]})]}),e.jsxs("div",{className:"preview-footer",children:[!f&&b.updatedAt&&e.jsx("div",{className:"metadata",children:e.jsxs("span",{className:"updated-at",children:["עודכן: ",b.updatedAt]})}),e.jsxs("div",{className:"action-buttons",children:[l&&e.jsx("button",{className:"action-btn edit",onClick:k=>{k.stopPropagation(),l(s._id)},"aria-label":"ערוך שיעור",children:e.jsx(ba,{size:14})}),c&&e.jsx("button",{className:"action-btn delete",onClick:k=>{k.stopPropagation(),c(s._id)},"aria-label":"מחק שיעור",children:e.jsx(Ft,{size:14})})]})]})]})});function NR({theoryLessons:t,isLoading:s,teachers:n,onEdit:i,onView:l,onRemove:c}){const u=x.useMemo(()=>{if(!t.length)return[];const y=wn.formatForAPI(new Date),j=t.filter(N=>{const b=N.date.split("T")[0];return!wn.isPast(b)}).reduce((N,b)=>{const w=b.date.split("T")[0];return N[w]||(N[w]={date:w,theoryLessons:[],isToday:w===y,isPast:wn.isPast(w),isUpcoming:wn.isUpcoming(w)}),N[w].theoryLessons.push(b),N},{});return Object.values(j).forEach(N=>{N.theoryLessons.sort((b,w)=>{const A=b.startTime||"00:00",S=w.startTime||"00:00";return A.localeCompare(S)})}),Object.values(j).sort((N,b)=>N.isToday&&!b.isToday?-1:!N.isToday&&b.isToday?1:new Date(N.date).getTime()-new Date(b.date).getTime())},[t]);if(s&&t.length===0)return e.jsx("div",{className:"loading-state",children:"טוען שיעורי תאוריה..."});const f=t.some(y=>{const v=y.date.split("T")[0];return!wn.isPast(v)});if(t.length===0)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו שיעורי תאוריה להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או להוסיף שיעורים חדשים"})]});if(!f)return e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"אין שיעורי תאוריה עתידיים או נוכחיים"}),e.jsx("p",{children:"כל השיעורים הקיימים הם מהעבר. הוסף שיעורים חדשים או בדוק את המסננים"})]});const p=(y,v,j,N)=>{if(v)return"שיעורי תאוריה היום";const b=wn.getHebrewDayName(y),A=new Date(y).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric"});return j?`${b}, ${A} (עבר)`:N?`${b}, ${A}`:`${b}, ${A}`},m=y=>{var j;if(!y||!n)return"מדריך לא מוגדר";const v=n.find(N=>N._id===y);return((j=v==null?void 0:v.personalInfo)==null?void 0:j.fullName)||"מדריך לא מוגדר"};return e.jsx("div",{className:"theory-list-container",children:u.map(({date:y,theoryLessons:v,isToday:j,isPast:N,isUpcoming:b})=>e.jsxs("div",{className:`theory-date-group ${j?"today-group":""} ${N?"past-group":""} ${b?"upcoming-group":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx(Zt,{size:18}),e.jsx("h2",{children:p(y,j,N,b)})]}),e.jsx("div",{className:"theory-grid",children:v.filter(w=>w&&w._id).map((w,A)=>e.jsx(bR,{theoryLesson:w,teacherName:m(w.teacherId),onEdit:i,onView:l,onRemove:c,isToday:j},w._id||`theory-${y}-${A}`))})]},y))})}const SR=at().shape({category:Ce().required("קטגוריה היא שדה חובה"),teacherId:Ce().required("יש לבחור מורה תאוריה"),date:As().required("תאריך הוא שדה חובה"),startTime:Ce().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת התחלה היא שדה חובה"),endTime:Ce().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת סיום היא שדה חובה").test("is-greater","שעת הסיום חייבת להיות אחרי שעת ההתחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ce().required("מיקום הוא שדה חובה"),notes:Ce(),syllabus:Ce(),homework:Ce(),schoolYearId:Ce().required("שנת לימודים חובה"),dayOfWeek:Pa().min(0).max(6)}),wR=at().shape({category:Ce().required("קטגוריה היא שדה חובה"),teacherId:Ce().required("יש לבחור מורה תאוריה"),startDate:As().required("תאריך התחלה הוא שדה חובה"),endDate:As().required("תאריך סיום הוא שדה חובה").min(RI("startDate"),"תאריך הסיום חייב להיות אחרי תאריך ההתחלה"),dayOfWeek:Pa().required("יום בשבוע הוא שדה חובה").min(0,"יום בשבוע חייב להיות בין 0 ל-6").max(6,"יום בשבוע חייב להיות בין 0 ל-6"),startTime:Ce().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת התחלה היא שדה חובה"),endTime:Ce().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"פורמט שעה לא תקין (HH:MM)").required("שעת סיום היא שדה חובה").test("is-greater","שעת הסיום חייבת להיות אחרי שעת ההתחלה",function(t){const{startTime:s}=this.parent;return!s||!t?!0:t>s}),location:Ce().required("מיקום הוא שדה חובה"),notes:Ce(),syllabus:Ce(),excludeDates:es().of(Ce()),schoolYearId:Ce().required("שנת לימודים חובה")}),cu=t=>t.toISOString().split("T")[0],TR=(t,s="")=>{const n=new Date;return t!=null&&t._id?{_id:t._id,category:t.category||Xo[0],teacherId:t.teacherId||"",date:t.date||cu(n),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||Zo[0],notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||s,dayOfWeek:t.dayOfWeek||n.getDay(),studentIds:t.studentIds||[]}:{_id:void 0,category:Xo[0],teacherId:"",date:cu(n),startTime:"14:00",endTime:"15:00",location:Zo[0],notes:"",syllabus:"",homework:"",schoolYearId:s,dayOfWeek:n.getDay(),studentIds:[]}},ER=(t="")=>{const s=new Date,n=new Date(s);return n.setMonth(s.getMonth()+3),{category:Xo[0],teacherId:"",startDate:cu(s),endDate:cu(n),dayOfWeek:s.getDay(),startTime:"14:00",endTime:"15:00",location:Zo[0],notes:"",syllabus:"",excludeDates:[],schoolYearId:t,studentIds:[]}};function oN({isOpen:t,onClose:s,onSubmit:n,onBulkSubmit:i,theoryLesson:l,theoryTeachers:c,isLoading:u=!1}){const{modalProps:f,titleProps:p,descriptionProps:m}=Cl({isOpen:t,onClose:s,modalId:"theory-form",restoreFocusOnClose:!0}),{currentSchoolYear:y,loadCurrentSchoolYear:v}=za(),{students:j,saveStudent:N,loadStudents:b}=Ma(),[w,A]=x.useState("bulk"),[S,C]=x.useState(""),[D,I]=x.useState([]),[T,R]=x.useState(""),[E,_]=x.useState(!1),[k,z]=x.useState(!1),M=x.useRef(null),G=x.useCallback(Y=>{R(Y.target.value),_(Y.target.value.length>0)},[]),X=x.useCallback(()=>T?j.filter(Y=>Y.personalInfo.fullName.includes(T)&&!D.some(Z=>Z._id===Y._id)).slice(0,10):[],[T,j,D]),W=x.useCallback((Y,Z)=>{const H=[...D,Y];I(H),Z("studentIds",H.map(P=>P._id)),R(""),_(!1)},[D]),te=x.useCallback((Y,Z)=>{I(H=>{const P=H.filter(q=>q._id!==Y);return Z("studentIds",P.map(q=>q._id)),P})},[]);if(x.useEffect(()=>{l!=null&&l._id&&A("single"),(async()=>{try{console.log("Loading current school year...");const Z=await v();console.log("Loaded school year:",Z)}catch(Z){console.error("Failed to load school year:",Z)}})()},[l,v]),x.useEffect(()=>{j.length===0&&b()},[j.length,b]),x.useEffect(()=>{if(j.length>0&&(l!=null&&l.studentIds)&&l.studentIds.length>0){z(!0);const Y=j.filter(Z=>{var H;return(H=l==null?void 0:l.studentIds)==null?void 0:H.includes(Z._id)});I(Y),z(!1)}else I([])},[l==null?void 0:l.studentIds,j]),x.useEffect(()=>{function Y(Z){M.current&&!M.current.contains(Z.target)&&_(!1)}return document.addEventListener("mousedown",Y),()=>{document.removeEventListener("mousedown",Y)}},[]),!t)return null;const L=Y=>{l!=null&&l._id||A(Y)},J=async(Y,Z,H)=>{try{const P=H.filter(B=>!Z.includes(B)),q=Z.filter(B=>!H.includes(B));console.log("Updating student references:",{adding:P.length,removing:q.length});for(const B of P){const se=j.find(ae=>ae._id===B);se&&(!se.enrollments.theoryLessonIds||!se.enrollments.theoryLessonIds.includes(Y))&&await N({_id:se._id,enrollments:{...se.enrollments,theoryLessonIds:[...se.enrollments.theoryLessonIds||[],Y]}})}for(const B of q){const se=j.find(ae=>ae._id===B);se&&se.enrollments.theoryLessonIds&&await N({_id:se._id,enrollments:{...se.enrollments,theoryLessonIds:se.enrollments.theoryLessonIds.filter(ae=>ae!==Y)}})}}catch(P){console.error("Error updating student references:",P)}},K=async Y=>{try{const Z=Y.schoolYearId||(y==null?void 0:y._id);if(!Z)throw new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const H={...Y,schoolYearId:Z},P=await n(H);P!=null&&P._id&&await J(P._id,(l==null?void 0:l.studentIds)||[],Y.studentIds)}catch(Z){throw Z}},le=async Y=>{try{console.log("Bulk submit handler called with values:",Y);const Z=Y.schoolYearId||(y==null?void 0:y._id);if(!Z)throw new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const H={...Y,dayOfWeek:Number(Y.dayOfWeek),schoolYearId:Z};console.log("Calling onBulkSubmit with data:",H),await i(H),console.log("Bulk creation completed successfully")}catch(Z){throw console.error("Error in handleBulkSubmit:",Z),Z}},O=(Y,Z,H)=>{if(Y&&Z.excludeDates&&!Z.excludeDates.includes(Y)){const P=[...Z.excludeDates||[],Y];H("excludeDates",P),C("")}},U=(Y,Z,H)=>{if(!Z.excludeDates)return;const P=Z.excludeDates.filter(q=>q!==Y);H("excludeDates",P)};return e.jsx(Ua,{isOpen:t,onClose:s,className:"theory-form-overlay responsive-form",children:e.jsxs("div",{className:"form-modal",...f,onClick:Y=>Y.stopPropagation(),children:[e.jsx("div",{...m,className:"sr-only",children:l!=null&&l._id?"טופס עריכת שיעור תאוריה קיים במערכת":"טופס הוספת שיעור תאוריה חדש למערכת"}),e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"close-button",onClick:s,type:"button","aria-label":"סגור",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...p,children:l!=null&&l._id?"עריכת שיעור תאוריה":"הוספת שיעור תאוריה חדש"})]}),!(l!=null&&l._id)&&e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{type:"button",className:w==="bulk"?"active primary":"secondary",onClick:()=>L("bulk"),children:"סדרת שיעורים"}),e.jsx("button",{type:"button",className:w==="single"?"active primary":"secondary",onClick:()=>L("single"),children:"שיעור בודד"})]}),w==="single"?e.jsx(yr,{initialValues:TR(l||null,(y==null?void 0:y._id)||""),validationSchema:SR,onSubmit:K,enableReinitialize:!0,children:({setFieldValue:Y,isSubmitting:Z})=>e.jsxs(In,{className:"theory-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי שיעור תאוריה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"קטגוריה",name:"category",as:"select",required:!0,labelIcon:e.jsx(Zt,{size:16}),children:Xo.map(H=>e.jsx("option",{value:H,children:H},H))}),e.jsxs(Me,{label:"מורה תאוריה",name:"teacherId",as:"select",required:!0,labelIcon:e.jsx(Je,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מדריך..."}),c.map(H=>e.jsx("option",{value:H._id,children:H.personalInfo.fullName},H._id))]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"date",children:[e.jsx($e,{size:16}),"תאריך *"]}),e.jsx(Oa,{name:"date",type:"date",required:!0,onChange:H=>{const P=H.target.value;if(P){const B=new Date(P).getDay();Y("dayOfWeek",B)}Y("date",P)}})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"dayOfWeek",children:[e.jsx(xm,{size:16,className:"icon"}),"יום בשבוע (מחושב אוטומטית)"]}),e.jsx(Oa,{as:"select",name:"dayOfWeek",id:"dayOfWeek",disabled:!0,children:Fm.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Me,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(gt,{size:16}),children:Zo.map(H=>e.jsx("option",{value:H,children:H},H))})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"סילבוס",name:"syllabus",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"שיעורי בית",name:"homework",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תלמידים (משתתפי השיעור)"}),e.jsxs("div",{ref:M,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(pr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:T,onChange:G,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>T.length>0,disabled:Z})]}),E&&X().length>0&&!Z&&e.jsx("div",{className:"search-results-dropdown",children:X().map(H=>e.jsxs("div",{className:"search-result-item",onClick:()=>W(H,Y),children:[e.jsx(Je,{size:16,className:"student-icon"}),e.jsx("span",{children:H.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:H.academicInfo.instrument})]},H._id))})]}),e.jsx("div",{className:"selected-members-list",children:k?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):D.length>0?e.jsx("ul",{className:"members-items",children:D.map(H=>e.jsxs("li",{className:"member-item",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:H.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:H.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:H.academicInfo.instrument})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>te(H._id,Y),"aria-label":`הסר את ${H.personalInfo.fullName}`,disabled:Z,children:e.jsx(Nt,{size:14})})]},H._id))}):e.jsx("div",{className:"no-members-message",children:"לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים לשיעור."})})]})}),e.jsx(Oa,{type:"hidden",name:"schoolYearId",value:(y==null?void 0:y._id)||""}),e.jsx(Oa,{type:"hidden",name:"studentIds"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"primary",disabled:u,children:u?"שומר...":l!=null&&l._id?"עדכון":"הוספה"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})}):e.jsx(yr,{initialValues:{...ER((y==null?void 0:y._id)||""),excludeDates:[]},validationSchema:wR,onSubmit:async(Y,Z)=>{console.log("Formik onSubmit called with values:",Y);try{if(!Y.category)throw new Error("Category is required");if(!Y.teacherId)throw new Error("Teacher is required");if(!Y.startDate||!Y.endDate)throw new Error("Start and end dates are required");if(Y.dayOfWeek===void 0||Y.dayOfWeek===null)throw new Error("Day of week is required");if(!Y.startTime||!Y.endTime)throw new Error("Start and end times are required");if(!Y.location)throw new Error("Location is required");await le(Y),console.log("Bulk submit succeeded"),Z.resetForm(),s()}catch(H){console.error("Bulk submit failed:",H)}finally{Z.setSubmitting(!1)}},enableReinitialize:!0,children:({values:Y,setFieldValue:Z,handleSubmit:H,isSubmitting:P})=>e.jsxs(In,{className:"theory-form",onSubmit:q=>{console.log("Bulk form submit event triggered"),q.preventDefault(),H(q)},children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"פרטי שיעור תאוריה"}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"קטגוריה",name:"category",as:"select",required:!0,labelIcon:e.jsx(Zt,{size:16}),children:Xo.map(q=>e.jsx("option",{value:q,children:q},q))}),e.jsxs(Me,{label:"מורה תאוריה",name:"teacherId",as:"select",required:!0,labelIcon:e.jsx(Je,{size:16}),children:[e.jsx("option",{value:"",children:"בחר מדריך..."}),c.map(q=>e.jsx("option",{value:q._id,children:q.personalInfo.fullName},q._id))]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"תאריך התחלה",name:"startDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})}),e.jsx(Me,{label:"תאריך סיום",name:"endDate",type:"date",required:!0,labelIcon:e.jsx($e,{size:16})})]}),e.jsxs("div",{className:"form-row full-width",children:[e.jsx(Me,{label:"יום בשבוע",name:"dayOfWeek",as:"select",required:!0,labelIcon:e.jsx(xm,{size:16}),children:Fm.map(q=>e.jsx("option",{value:q.value,children:q.label},q.value))}),e.jsxs("div",{className:"help-text",style:{marginTop:"-15px",paddingRight:"16px"},children:["שיעורים ייווצרו בכל יום ",sN(Number(Y.dayOfWeek))," ","בטווח התאריכים שנבחר"]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16,className:"icon"}),"תאריכים לדילוג"]}),e.jsxs("div",{className:"exclude-dates-input",children:[e.jsx("input",{type:"date",value:S,onChange:q=>C(q.target.value),min:Y.startDate,max:Y.endDate}),e.jsx("button",{type:"button",onClick:()=>O(S,Y,Z),className:"add-date",disabled:!S,children:"הוסף"})]}),e.jsx("div",{className:"exclude-dates-list",children:Y.excludeDates&&Y.excludeDates.length>0?Y.excludeDates.map(q=>e.jsxs("div",{className:"exclude-date-item",children:[e.jsx("span",{children:new Date(q).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",className:"remove-date",onClick:()=>U(q,Y,Z),children:e.jsx(Nt,{size:14})})]},q)):e.jsx("p",{className:"no-dates",children:"אין תאריכים להוציא"})})]})}),e.jsxs("div",{className:"form-row",children:[e.jsx(Me,{label:"שעת התחלה",name:"startTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})}),e.jsx(Me,{label:"שעת סיום",name:"endTime",type:"time",required:!0,labelIcon:e.jsx(Ve,{size:16})})]}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"מיקום",name:"location",as:"select",required:!0,labelIcon:e.jsx(gt,{size:16}),children:Zo.map(q=>e.jsx("option",{value:q,children:q},q))})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"הערות",name:"notes",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsx(Me,{label:"סילבוס",name:"syllabus",as:"textarea",rows:3})}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תלמידים (משתתפי השיעור)"}),e.jsxs("div",{ref:M,className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(pr,{className:"search-icon",size:16}),e.jsx("input",{type:"text",value:T,onChange:G,placeholder:"חפש תלמידים להוספה...",className:"search-input",onClick:()=>T.length>0,disabled:P})]}),E&&X().length>0&&!P&&e.jsx("div",{className:"search-results-dropdown",children:X().map(q=>e.jsxs("div",{className:"search-result-item",onClick:()=>W(q,Z),children:[e.jsx(Je,{size:16,className:"student-icon"}),e.jsx("span",{children:q.personalInfo.fullName}),e.jsx("span",{className:"student-instrument",children:q.academicInfo.instrument})]},q._id))})]}),e.jsx("div",{className:"selected-members-list",children:k?e.jsx("div",{className:"loading-text",children:"טוען תלמידים..."}):D.length>0?e.jsx("ul",{className:"members-items",children:D.map(q=>e.jsxs("li",{className:"member-item",children:[e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-avatar",children:q.personalInfo.fullName.charAt(0)}),e.jsxs("div",{className:"member-details",children:[e.jsx("div",{className:"member-name",children:q.personalInfo.fullName}),e.jsx("div",{className:"member-instrument",children:q.academicInfo.instrument})]})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>te(q._id,Z),"aria-label":`הסר את ${q.personalInfo.fullName}`,disabled:P,children:e.jsx(Nt,{size:14})})]},q._id))}):e.jsx("div",{className:"no-members-message",children:"לא נבחרו תלמידים. השתמש בחיפוש כדי להוסיף תלמידים לשיעור."})})]})}),e.jsx(Oa,{type:"hidden",name:"schoolYearId",value:(y==null?void 0:y._id)||""}),e.jsx(Oa,{type:"hidden",name:"studentIds"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"primary",disabled:u,onClick:async()=>{if(console.log("Submit button clicked for bulk form"),!(y!=null&&y._id))throw console.error("No school year ID available"),new Error("שנת הלימודים לא נטענה. אנא רענן את הדף.");const q={...Y,dayOfWeek:Number(Y.dayOfWeek),schoolYearId:y._id,studentIds:D.map(B=>B._id)};console.log("Direct submission with data:",q);try{const B=await i(q);if(B&&B.theoryLessonIds&&Array.isArray(B.theoryLessonIds)&&B.theoryLessonIds.length>0)for(const se of B.theoryLessonIds)se&&await J(se,[],q.studentIds)}catch(B){throw console.error("Direct submission error:",B),B}},children:u?"יוצר...":"יצירת סדרת שיעורים"}),e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"ביטול"})]})]})})]})})}function AR(){const t=_t(),s=gs(),{addToast:n,showError:i,showSuccess:l}=Ot(),{theoryLessons:c,isLoading:u,error:f,loadTheoryLessons:p,removeTheoryLesson:m,bulkCreateTheoryLessons:y,saveTheoryLesson:v}=mp(),{teachers:j,loadTeachers:N}=Ds(),[b,w]=x.useState(!1),[A,S]=x.useState(null),[C,D]=x.useState({}),[I,T]=x.useState({isOpen:!1,theoryLessonId:null}),R=j.filter(G=>{var X;return(X=G.roles)==null?void 0:X.includes("מורה תאוריה")});x.useEffect(()=>{p(),N()},[p,N]);const E=async G=>{try{const X=await v(G);return l(G._id?"שיעור התאוריה עודכן בהצלחה":"שיעור התאוריה נוסף בהצלחה"),w(!1),S(null),await p(),X&&X._id&&!G._id&&s.pathname!==`/theory/${X._id}`&&setTimeout(()=>{t(`/theory/${X._id}`)},100),X}catch(X){throw console.error("Error saving theory lesson:",X),i(X),X}},_=async G=>{console.log("TheoryIndex handleBulkSubmit called with data:",G);try{if(!G.category)throw new Error("Category is required");if(!G.teacherId)throw new Error("Teacher is required");if(!G.startDate||!G.endDate)throw new Error("Date range is required");if(G.dayOfWeek===void 0)throw new Error("Day of week is required");if(!G.startTime||!G.endTime)throw new Error("Time range is required");if(!G.location)throw new Error("Location is required");console.log("About to call bulkCreateTheoryLessons with data:",G);const X=await y(G);return console.log("Bulk creation result:",X),X&&X.insertedCount>0?l(`נוצרו ${X.insertedCount} שיעורי תאוריה בהצלחה`):l("שיעורי התאוריה נוצרו בהצלחה"),w(!1),X}catch(X){throw console.error("Error bulk creating theory lessons:",X),i(X),X}},k=async G=>{try{await m(G),l("שיעור התאוריה נמחק לצמיתות בהצלחה"),s.pathname.includes(G)&&t("/theory")}catch(X){console.error("Error deleting theory lesson:",X),i(X)}finally{T({isOpen:!1,theoryLessonId:null})}},z=G=>{const X={...C,query:G};D(X),p(X)},M=s.pathname.includes("/theory/")&&!s.pathname.endsWith("/theory/");return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!M&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(rc,{onSearch:z,placeholder:"חפש שיעורי תאוריה..."}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn-icon add-btn",onClick:()=>{S(null),w(!0)},"aria-label":"הוספת שיעור תאוריה חדש",children:e.jsx(fs,{className:"icon",size:20})})})]})}),f&&e.jsx("div",{className:"error-message",children:f}),!M&&e.jsx(NR,{theoryLessons:c,isLoading:u,teachers:j,onEdit:G=>{const X=c.find(W=>W._id===G);X&&(S(X),w(!0))},onView:G=>t(`/theory/${G}`),onRemove:G=>T({isOpen:!0,theoryLessonId:G})}),e.jsx(oN,{isOpen:b,onClose:()=>{w(!1),S(null)},onSubmit:E,onBulkSubmit:_,theoryLesson:A||void 0,theoryTeachers:R,isLoading:u}),e.jsx(ps,{isOpen:I.isOpen,title:"מחיקת שיעור תאוריה",message:"האם אתה בטוח שברצונך למחוק לצמיתות את שיעור התאוריה הזה? פעולה זו תמחק לצמיתות את השיעור ואת כל הנתונים הקשורים אליו ואינה ניתנת לביטול.",confirmText:"מחק",cancelText:"ביטול",onConfirm:()=>{I.theoryLessonId&&k(I.theoryLessonId)},onClose:()=>T({isOpen:!1,theoryLessonId:null}),type:"danger"})]}),!M&&!b&&e.jsx(mi,{})]})}function Hj(){const t=_t(),s=gs(),{theoryLessonId:n}=jr(),{addToast:i}=Ot();ys();const{selectedTheoryLesson:l,isLoading:c,error:u,loadTheoryLessonById:f,saveTheoryLesson:p,removeTheoryLesson:m,updateAttendance:y}=mp(),{teachers:v,loadTeachers:j}=Ds(),{getStudentsByIds:N}=Ma(),[b,w]=x.useState(!1),[A,S]=x.useState(!1),[C,D]=x.useState([]),[I,T]=x.useState(!1),[R,E]=x.useState({present:[],absent:[]}),[_,k]=x.useState(!1),[z,M]=x.useState(!1),[G,X]=x.useState(!1),W=v.filter(Y=>{var Z;return(Z=Y.roles)==null?void 0:Z.includes("מורה תאוריה")});x.useEffect(()=>{n&&(f(n),j())},[n,f,j]),x.useEffect(()=>{async function Y(){var Z;if((Z=l==null?void 0:l.studentIds)!=null&&Z.length){T(!0);try{const H=await N(l.studentIds);D(H)}catch(H){console.error("Error loading students:",H)}finally{T(!1)}}else D([])}Y()},[l,N]),x.useEffect(()=>{l!=null&&l.attendance?E({present:l.attendance.present||[],absent:l.attendance.absent||[]}):E({present:[],absent:[]}),k(!1),X(!1)},[l]);const te=()=>{if(!l)return"לא ידוע";const Y=v.find(Z=>Z._id===l.teacherId);return Y?Y.personalInfo.fullName:"לא ידוע"},L=async Y=>{try{const Z=await p(Y);return i({type:"success",message:"שיעור התאוריה עודכן בהצלחה"}),w(!1),Z}catch(Z){throw console.error("Error updating theory lesson:",Z),i({type:"danger",message:"אירעה שגיאה בעדכון שיעור התאוריה"}),Z}},J=async()=>{if(n)try{await m(n),i({type:"success",message:"שיעור התאוריה נמחק לצמיתות בהצלחה"}),t("/theory")}catch(Y){console.error("Error deleting theory lesson:",Y),i({type:"danger",message:"אירעה שגיאה במחיקת שיעור התאוריה"})}finally{S(!1)}},K=async()=>{if(!(!n||!l)){M(!0);try{await y(n,R),i({type:"success",message:"נוכחות עודכנה בהצלחה"}),X(!0),k(!1),await f(n)}catch(Y){console.error("Error updating attendance:",Y),i({type:"danger",message:"אירעה שגיאה בעדכון הנוכחות"})}finally{M(!1)}}},le=(Y,Z)=>{E(H=>{const P=[...H.present],q=[...H.absent],B=P.indexOf(Y);B!==-1&&P.splice(B,1);const se=q.indexOf(Y);return se!==-1&&q.splice(se,1),Z?P.push(Y):q.push(Y),{present:P,absent:q}}),k(!0),X(!1)},O=Y=>new Date(Y).toLocaleDateString("he-IL",{year:"numeric",month:"long",day:"numeric",weekday:"long"});if(c)return e.jsx("div",{className:"loading-state",children:"טוען שיעור תאוריה..."});if(u)return e.jsx("div",{className:"error-message",children:u});if(!l)return e.jsx("div",{className:"not-found",children:"שיעור התאוריה לא נמצא"});const U=()=>{s.key?t(-1):t("/theory")};return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"theory-details",children:e.jsx("div",{className:"theory-details-page",children:e.jsx("div",{className:"theory-card-container",children:e.jsxs("div",{className:"tdy-card-content",children:[e.jsxs("div",{className:"tdy-card-header",children:[e.jsx("button",{className:"tdy-back-button",onClick:U,"aria-label":"חזור",children:e.jsx(zs,{className:"lucide lucide-arrow-left"})}),e.jsxs("div",{className:"tdy-header-title",children:[e.jsx("h2",{children:"שיעור תאוריה"}),e.jsxs("div",{className:"tdy-date-display",children:[e.jsx($e,{size:18}),e.jsx("span",{children:O(l.date)})]})]}),e.jsxs("div",{className:"tdy-header-actions",children:[e.jsxs("button",{className:"tdy-action-btn edit",onClick:()=>w(!0),"aria-label":"ערוך",children:[e.jsx(ba,{size:16}),"עריכה"]}),e.jsxs("button",{className:"tdy-action-btn delete",onClick:()=>S(!0),"aria-label":"מחק",children:[e.jsx(Ft,{size:16}),"מחיקה"]})]})]}),e.jsxs("div",{className:"tdy-card-scroll-area",children:[e.jsxs("div",{className:"tdy-section",children:[e.jsxs("div",{className:"tdy-section-title",children:[e.jsx(Zt,{size:18}),e.jsx("span",{children:l.category||"שיעור תאוריה"})]}),e.jsxs("div",{className:"tdy-section-content",children:[e.jsxs("div",{className:"tdy-theory-details-row",children:[e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"מורה:"}),e.jsx("span",{className:"tdy-detail-value",children:te()})]}),e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"מיקום:"}),e.jsx("span",{className:"tdy-detail-value",children:l.location})]}),e.jsxs("div",{className:"tdy-detail-item",children:[e.jsx("span",{className:"tdy-detail-label",children:"זמן:"}),e.jsxs("span",{className:"tdy-detail-value",children:[l.startTime," - ",l.endTime]})]})]}),l.notes&&e.jsxs("div",{className:"tdy-theory-notes",children:[e.jsx("span",{className:"tdy-notes-label",children:"הערות:"}),e.jsx("p",{className:"tdy-notes-content",children:l.notes})]}),l.syllabus&&e.jsxs("div",{className:"tdy-theory-syllabus",children:[e.jsx("span",{className:"tdy-syllabus-label",children:"סילבוס:"}),e.jsx("p",{className:"tdy-syllabus-content",children:l.syllabus})]})]})]}),e.jsxs("div",{className:"tdy-section",children:[e.jsxs("div",{className:"tdy-section-title",children:[e.jsx(ms,{size:18}),e.jsx("span",{children:"נוכחות תלמידים"})]}),e.jsx("div",{className:"tdy-section-content",children:e.jsx("div",{className:"tdy-students-list-container",children:I?e.jsx("div",{className:"tdy-loading-students",children:"טוען רשימת תלמידים..."}):C.length>0?e.jsx("ul",{className:"tdy-students-list",children:C.map(Y=>{var H,P;const Z=R.present.includes(Y._id);return e.jsxs("li",{className:`tdy-student-item ${Z?"present":""}`,children:[e.jsxs("div",{className:"tdy-student-info",children:[e.jsx("div",{className:"tdy-student-name",children:Y.personalInfo.fullName}),e.jsx("div",{className:"tdy-student-instrument",children:((P=(H=Y.academicInfo.instrumentProgress)==null?void 0:H[0])==null?void 0:P.instrumentName)||Y.academicInfo.instrument||"לא מוגדר"})]}),e.jsxs("label",{className:"tdy-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:Z,onChange:()=>le(Y._id,!Z)}),e.jsx("span",{className:"tdy-toggle-slider"})]})]},Y._id)})}):e.jsx("div",{className:"tdy-empty-students",children:"אין תלמידים רשומים לשיעור זה"})})})]})]}),e.jsxs("div",{className:"tdy-attendance-footer",children:[G&&e.jsx("span",{className:"tdy-save-success",children:"הנוכחות עודכנה בהצלחה!"}),e.jsx("button",{className:"tdy-save-attendance-btn",onClick:K,disabled:!_||z,children:z?"שומר...":"עדכן נוכחות"})]})]})})})})}),e.jsx(oN,{isOpen:b,onClose:()=>w(!1),onSubmit:L,onBulkSubmit:async Y=>(console.log("Bulk submit not applicable in details view",Y),{insertedCount:0,theoryLessonIds:[]}),theoryLesson:l,theoryTeachers:W,isLoading:c}),e.jsx(ps,{isOpen:A,title:"מחיקת שיעור תאוריה",message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק לצמיתות את שיעור התאוריה "',l.category,'"?']}),e.jsx("p",{className:"text-sm text-muted",children:"פעולה זו תמחק לצמיתות את השיעור ואת כל הנתונים הקשורים אליו. פעולה זו היא בלתי הפיכה."})]}),confirmText:"מחק",cancelText:"ביטול",onConfirm:J,onClose:()=>S(!1),type:"danger"})]})}const va=Ba((t,s)=>({bagruts:[],selectedBagrut:null,filterBy:{},isLoading:!1,error:null,loadBagruts:async(n={})=>{t({isLoading:!0,error:null});try{const i={...s().filterBy,...n},l=await St.getBagruts(i);t({bagruts:l,filterBy:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load bagruts";t({error:l,isLoading:!1}),console.error("Error loading bagruts:",i)}},loadBagrutById:async n=>{t({isLoading:!0,error:null});try{const i=await St.getBagrutById(n);t({selectedBagrut:i,isLoading:!1})}catch(i){const l=i instanceof Error?i.message:"Failed to load bagrut";t({error:l,isLoading:!1}),console.error("Error loading bagrut:",i)}},loadBagrutByStudentId:async n=>{t({isLoading:!0,error:null});try{const i=await St.getBagrutByStudentId(n);return t({selectedBagrut:i,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to load bagrut";return t({error:l,isLoading:!1}),console.error("Error loading bagrut by student ID:",i),null}},createBagrut:async n=>{t({isLoading:!0,error:null});try{const i=await St.createBagrut(n);return t({bagruts:[...s().bagruts,i],selectedBagrut:i,isLoading:!1}),i}catch(i){const l=i instanceof Error?i.message:"Failed to create bagrut";throw t({error:l,isLoading:!1}),console.error("Error creating bagrut:",i),i}},updatePresentation:async(n,i,l)=>{var c;try{const u=await St.updatePresentation(n,i,l),f=s().bagruts.map(p=>p._id===n?u:p);return t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),u}catch(u){const f=u instanceof Error?u.message:"Failed to update presentation";throw t({error:f}),console.error("Error updating presentation:",u),u}},updateMagenBagrut:async(n,i)=>{var l;try{const c=await St.updateMagenBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update Magen Bagrut";throw t({error:u}),console.error("Error updating Magen Bagrut:",c),c}},updateGradingDetails:async(n,i)=>{var l;try{const c=await St.updateGradingDetails(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update grading details";throw t({error:u}),console.error("Error updating grading details:",c),c}},calculateFinalGrade:async n=>{var i;try{const l=await St.calculateFinalGrade(n),c=s().bagruts.map(u=>u._id===n?l:u);return t({bagruts:c,selectedBagrut:((i=s().selectedBagrut)==null?void 0:i._id)===n?l:s().selectedBagrut}),l}catch(l){const c=l instanceof Error?l.message:"Failed to calculate final grade";throw t({error:c}),console.error("Error calculating final grade:",l),l}},completeBagrut:async(n,i)=>{var l;try{const c=await St.completeBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to complete bagrut";throw t({error:u}),console.error("Error completing bagrut:",c),c}},addProgramPiece:async(n,i)=>{var l;try{const c=await St.addProgramPiece(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to add program piece";throw t({error:u}),console.error("Error adding program piece:",c),c}},updateProgramPiece:async(n,i,l)=>{var c;try{const u=await St.updateProgramPiece(n,i,l),f=s().bagruts.map(p=>p._id===n?u:p);return t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),u}catch(u){const f=u instanceof Error?u.message:"Failed to update program piece";throw t({error:f}),console.error("Error updating program piece:",u),u}},updateProgram:async(n,i)=>{var l;try{const c=await St.updateProgram(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update program";throw t({error:u}),console.error("Error updating program:",c),c}},removeProgramPiece:async(n,i)=>{var l;try{const c=await St.removeProgramPiece(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove program piece";throw t({error:u}),console.error("Error removing program piece:",c),c}},addAccompanist:async(n,i)=>{var l;try{const c=await St.addAccompanist(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to add accompanist";throw t({error:u}),console.error("Error adding accompanist:",c),c}},removeAccompanist:async(n,i)=>{var l;try{const c=await St.removeAccompanist(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove accompanist";throw t({error:u}),console.error("Error removing accompanist:",c),c}},uploadDocument:async(n,i,l)=>{var c;try{const u=await St.uploadDocument(n,i,l),f=s().bagruts.map(p=>p._id===n?u:p);return t({bagruts:f,selectedBagrut:((c=s().selectedBagrut)==null?void 0:c._id)===n?u:s().selectedBagrut}),u}catch(u){const f=u instanceof Error?u.message:"Failed to upload document";throw t({error:f}),console.error("Error uploading document:",u),u}},removeDocument:async(n,i)=>{var l;try{const c=await St.removeDocument(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to remove document";throw t({error:u}),console.error("Error removing document:",c),c}},updateBagrut:async(n,i)=>{var l;try{const c=await St.updateBagrut(n,i),u=s().bagruts.map(f=>f._id===n?c:f);return t({bagruts:u,selectedBagrut:((l=s().selectedBagrut)==null?void 0:l._id)===n?c:s().selectedBagrut}),c}catch(c){const u=c instanceof Error?c.message:"Failed to update bagrut";throw t({error:u}),console.error("Error updating bagrut:",c),c}},deleteBagrut:async n=>{var i;try{await St.deleteBagrut(n);const l=s().bagruts.filter(c=>c._id!==n);t({bagruts:l,selectedBagrut:((i=s().selectedBagrut)==null?void 0:i._id)===n?null:s().selectedBagrut})}catch(l){const c=l instanceof Error?l.message:"Failed to delete bagrut";throw t({error:c}),console.error("Error deleting bagrut:",l),l}},setFilter:n=>{t({filterBy:{...s().filterBy,...n}})},clearSelectedBagrut:()=>{t({selectedBagrut:null})},clearError:()=>{t({error:null})}}));function CR({bagrut:t,onView:s,onEdit:n,onDelete:i,student:l,teacher:c,authContext:u}){var C,D,I,T;const f=u?br(u):null,p=()=>{var _;if(t.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const R=(t.presentations||[]).filter(k=>k.completed).length,E=((_=t.magenBagrut)==null?void 0:_.completed)||!1;return R>0||E?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},m=()=>{var k;const R=(t.presentations||[]).filter(z=>z.completed).length,E=(k=t.magenBagrut)!=null&&k.completed?1:0;return(R+E)/5*100},y=R=>R?R.split(" ").map(E=>E[0]).join("").toUpperCase().substring(0,2):"?",v=R=>{if(!R)return"var(--text-muted)";switch(R){case"מעולה":return"var(--success)";case"טוב מאוד":return"var(--info)";case"טוב":return"var(--primary)";case"מספיק":return"var(--warning)";case"מספיק בקושי":return"var(--danger-light)";case"לא עבר/ה":return"var(--danger)";default:return"var(--text-muted)"}},j=p(),N=m(),b=j.icon,w=f?f.isAdmin()||f.isTeacher()||t.teacherId===((C=f==null?void 0:f.user)==null?void 0:C._id):!0,A=f?f.isAdmin()||t.teacherId===((D=f==null?void 0:f.user)==null?void 0:D._id):!0,S=f?f.isAdmin()||t.teacherId===((I=f==null?void 0:f.user)==null?void 0:I._id):!0;return w?e.jsxs("div",{className:"bagrut-preview",onClick:()=>s(t._id),children:[e.jsx("div",{className:"preview-header",children:e.jsxs("div",{className:"header-row",children:[e.jsxs("div",{className:"student-details",children:[e.jsx("div",{className:"avatar-section",children:e.jsx("div",{className:"avatar",style:{backgroundColor:j.color},children:y(l==null?void 0:l.personalInfo.fullName)})}),e.jsxs("div",{className:"bagrut-info",children:[e.jsx("h3",{className:"student-name",children:(l==null?void 0:l.personalInfo.fullName)||"תלמיד לא זמין"}),e.jsxs("div",{className:"teacher-info",children:[e.jsx(mr,{size:12}),e.jsx("span",{children:(c==null?void 0:c.personalInfo.fullName)||"מורה לא זמין"})]})]})]}),e.jsxs("div",{className:"badges-container",children:[e.jsxs("div",{className:"status-badge",style:{backgroundColor:j.color},children:[e.jsx(b,{size:12}),e.jsx("span",{children:j.text})]}),t.finalGradeLevel&&e.jsxs("div",{className:"grade-badge",style:{backgroundColor:v(t.finalGradeLevel)},children:[e.jsx(Cs,{size:12}),e.jsx("span",{children:t.finalGradeLevel})]})]})]})}),e.jsxs("div",{className:"preview-content",children:[e.jsxs("div",{className:"progress-section",children:[e.jsx("div",{className:"progress-label",children:"התקדמות:"}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`,backgroundColor:j.color}})}),e.jsxs("div",{className:"progress-text",children:[(t.presentations||[]).filter(R=>R.completed).length+((T=t.magenBagrut)!=null&&T.completed?1:0),"/5"]})]}),t.conservatoryName&&e.jsx("div",{className:"info-row",children:e.jsx("div",{className:"info-item",children:e.jsx("span",{children:t.conservatoryName})})}),t.finalGrade&&e.jsx("div",{className:"grade-section",children:e.jsxs("div",{className:"grade-item",children:[e.jsx("div",{className:"grade-label",children:"ציון סופי:"}),e.jsxs("div",{className:"grade-value",style:{color:v(t.finalGradeLevel)},children:[t.finalGrade," (",t.finalGradeLevel,")"]})]})}),(t.program||[]).length>0&&e.jsx("div",{className:"program-info",children:e.jsxs("span",{children:[(t.program||[]).length," יצירות בתוכנית"]})})]}),e.jsxs("div",{className:"bagrut-preview-footer",children:[e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn view",onClick:R=>{R.stopPropagation(),s(t._id)},"aria-label":"צפה בבגרות",children:e.jsx(xa,{size:18})}),A&&e.jsx("button",{className:"action-btn edit",onClick:R=>{R.stopPropagation(),n(t._id)},"aria-label":"ערוך בגרות",children:e.jsx(ba,{size:16})}),S&&e.jsx("button",{className:"action-btn delete",onClick:R=>{R.stopPropagation(),i(t._id)},"aria-label":"מחק בגרות",children:e.jsx(Ft,{size:16})})]}),e.jsxs("div",{className:"date-section",children:[e.jsxs("div",{className:"date-info",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:["נוצר: ",new Date(t.createdAt).toLocaleDateString("he-IL")]})]}),t.testDate&&e.jsxs("div",{className:"test-date-info",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:["מועד בחינה: ",new Date(t.testDate).toLocaleDateString("he-IL")]})]})]})]})]}):null}function DR({bagruts:t,isLoading:s,onView:n,onEdit:i,onDelete:l,students:c,teachers:u,authContext:f}){return s&&t.length===0?e.jsx("div",{className:"loading-state",children:"טוען בגרויות..."}):t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"לא נמצאו בגרויות להצגה"}),e.jsx("p",{children:"נסה לשנות את מסנני החיפוש או ליצור בגרות חדשה"})]}):e.jsx("div",{className:"bagrut-grid",children:t.map(p=>e.jsx(CR,{bagrut:p,onView:n,onEdit:i,onDelete:l,student:c.find(m=>m._id===p.studentId),teacher:u.find(m=>m._id===p.teacherId),authContext:f},p._id))})}const kR=at().shape({studentId:Ce().required("יש לבחור תלמיד"),teacherId:Ce().required("יש לבחור מורה"),conservatoryName:Ce().optional(),testDate:As().required("יש לבחור תאריך מבחן"),notes:Ce().optional(),programPieces:es().of(at().shape({pieceTitle:Ce().required("שם היצירה נדרש"),composer:Ce().required("שם המלחין נדרש"),duration:Ce().required("משך הביצוע נדרש"),movement:Ce().optional(),youtubeLink:Ce().url("קישור לא תקין").optional()})).min(1,"יש להוסיף לפחות יצירה אחת"),presentationDates:at().shape({presentation1Date:As().nullable().optional(),presentation2Date:As().nullable().optional(),presentation3Date:As().nullable().optional(),presentation4Date:As().nullable().optional(),magenBagrutDate:As().nullable().optional()}),accompanists:es().of(at().shape({name:Ce().required("שם המלווה נדרש")})).min(1,"יש להוסיף לפחות מלווה אחד")}),_R={studentId:"",teacherId:"",conservatoryName:"",testDate:null,notes:"",programPieces:[{pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}],presentationDates:{presentation1Date:null,presentation2Date:null,presentation3Date:null,presentation4Date:null,magenBagrutDate:null},accompanists:[{name:""}]};function OR({isOpen:t,onClose:s,students:n,teachers:i,editMode:l=!1,editingBagrutId:c=null}){console.log("🚀 BagrutForm rendered with props:",{isOpen:t,editMode:l,editingBagrutId:c,studentsCount:n.length,teachersCount:i.length});const[u,f]=x.useState(!1),[p,m]=x.useState(!1),[y,v]=x.useState(null),{createBagrut:j,updateBagrut:N,loadBagrutById:b}=va(),{addToast:w}=Ot(),A=x.useMemo(()=>n.filter(E=>{var k,z;if(!E.isActive)return!1;let _=0;if(E.academicInfo.currentStage)_=typeof E.academicInfo.currentStage=="number"?E.academicInfo.currentStage:parseInt(E.academicInfo.currentStage)||0;else{const M=(k=E.academicInfo.instrumentProgress)==null?void 0:k.find(G=>G.isPrimary);if(M!=null&&M.currentStage)_=M.currentStage;else{const G=(z=E.academicInfo.instrumentProgress)==null?void 0:z[0];_=(G==null?void 0:G.currentStage)||0}}return _>=5}),[n]),S=x.useMemo(()=>i.filter(E=>{var z,M;if(!E.isActive)return!1;const _=((z=E.professionalInfo)==null?void 0:z.instrument)==="פסנתר",k=(M=E.roles)==null?void 0:M.some(G=>G.includes("מלווה")||G.includes("מורה לפסנתר"));return _||k}),[i]);x.useEffect(()=>{console.log("🔄 BagrutForm useEffect triggered:",{editMode:l,editingBagrutId:c,isOpen:t}),l&&c&&t?C():l||(console.log("🔄 Resetting edit data for create mode"),v(null))},[l,c,t]);const C=async()=>{console.log("🔄 Loading bagrut data for edit mode:",c),m(!0);try{await b(c);const E=va.getState().selectedBagrut;console.log("✅ Loaded bagrut data:",E),v(E)}catch(E){console.error("❌ Failed to load bagrut data:",E),w({type:"danger",message:"שגיאה בטעינת נתוני הבגרות",autoCloseTime:4e3})}finally{m(!1)}},D=()=>{var E,_,k,z,M,G,X,W,te;return console.log("📝 getInitialValues called:",{editMode:l,editingBagrut:!!y}),l&&y?(console.log("📝 Converting bagrut data to form values:",y),{studentId:y.studentId||"",teacherId:y.teacherId||"",conservatoryName:y.conservatoryName||"",testDate:y.testDate?new Date(y.testDate):null,notes:y.notes||"",programPieces:y.program&&y.program.length>0?y.program.map(L=>({pieceTitle:L.pieceTitle||"",composer:L.composer||"",duration:L.duration||"",movement:L.movement||"",youtubeLink:L.youtubeLink||""})):[{pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}],presentationDates:{presentation1Date:(_=(E=y.presentations)==null?void 0:E[0])!=null&&_.date?new Date(y.presentations[0].date):null,presentation2Date:(z=(k=y.presentations)==null?void 0:k[1])!=null&&z.date?new Date(y.presentations[1].date):null,presentation3Date:(G=(M=y.presentations)==null?void 0:M[2])!=null&&G.date?new Date(y.presentations[2].date):null,presentation4Date:(W=(X=y.presentations)==null?void 0:X[3])!=null&&W.date?new Date(y.presentations[3].date):null,magenBagrutDate:(te=y.magenBagrut)!=null&&te.date?new Date(y.magenBagrut.date):null},accompanists:y.accompaniment&&y.accompaniment.length>0?y.accompaniment.map(L=>({name:L.name||""})):[{name:""}]}):_R},{modalProps:I,titleProps:T}=Cl({isOpen:t,onClose:s,modalId:"bagrut-form",restoreFocusOnClose:!0}),R=async E=>{var _,k,z;console.log("🚀 BagrutForm submission started with values:",E),f(!0);try{if(l)console.log("✏️ Edit mode - skipping duplicate check");else{console.log("🔍 Checking if student already has a bagrut...");try{const W=await va.getState().loadBagrutByStudentId(E.studentId);if(console.log("🔍 Existing bagrut check result:",W),W){console.log("⚠️ Student already has bagrut - backend now enforces this rule"),w({type:"warning",message:"לתלמיד זה כבר קיימת בגרות. כל תלמיד יכול להחזיק בגרות אחת בלבד.",autoCloseTime:5e3}),f(!1);return}}catch(W){console.warn("⚠️ Could not check for existing bagrut:",W)}}let M,G;if(console.log("🔍 Edit mode decision:",{editMode:l,editingBagrutId:c}),l&&c){console.log("📝 Step 1: Updating existing Bagrut...",c);const W={studentId:E.studentId,conservatoryName:E.conservatoryName||void 0,teacherId:E.teacherId,testDate:E.testDate||void 0,notes:E.notes||void 0};console.log("📝 Update data to send:",W),G=await N(c,W),M=c,console.log("✅ Basic Bagrut updated successfully:",M)}else{console.log("📝 Step 1: Creating new Bagrut...");const W={studentId:E.studentId,teacherId:E.teacherId,conservatoryName:E.conservatoryName||void 0};if(console.log("📝 Bagrut data to send:",W),G=await j(W),M=G._id,console.log("✅ Basic Bagrut created successfully:",M),E.testDate||E.notes){console.log("📝 Step 1.5: Updating bagrut with testDate and notes...");const te={studentId:E.studentId,teacherId:E.teacherId,conservatoryName:E.conservatoryName||void 0,testDate:E.testDate||void 0,notes:E.notes||void 0};console.log("📝 Additional data to update:",te),G=await N(M,te),console.log("✅ Bagrut updated with additional data successfully")}}if(l)console.log("✏️ Edit mode - skipping program pieces to avoid duplicates");else{console.log("🎵 Step 2: Adding program pieces...");const W=E.programPieces.filter(te=>te.pieceTitle.trim()&&te.composer.trim()&&te.duration.trim());console.log("🎵 Valid program pieces:",W.length,W);for(const te of W){const L={pieceTitle:te.pieceTitle,composer:te.composer,duration:te.duration,movement:te.movement||void 0,youtubeLink:te.youtubeLink||void 0};console.log("🎵 Adding piece data:",L),await St.addProgramPiece(M,L),console.log("✅ Added program piece successfully:",te.pieceTitle)}}if(l)console.log("✏️ Edit mode - skipping accompanists to avoid duplicates");else{const W=E.accompanists.filter(te=>te.name.trim());for(const te of W){const L=S.find(le=>le.personalInfo.fullName===te.name),J=((_=L==null?void 0:L.professionalInfo)==null?void 0:_.instrument)||"פסנתר",K={name:te.name,instrument:J,phone:void 0};await St.addAccompanist(M,K),console.log("✅ Added accompanist:",te.name)}}console.log("📅 Step 4: Processing presentation dates...");const X=[E.presentationDates.presentation1Date,E.presentationDates.presentation2Date,E.presentationDates.presentation3Date,E.presentationDates.presentation4Date];for(let W=0;W<X.length;W++)X[W]&&(console.log(`📅 Updating presentation ${W+1} date:`,X[W]),await St.updatePresentation(M,W,{date:X[W]}),console.log(`✅ Updated presentation ${W+1} date successfully`));E.presentationDates.magenBagrutDate&&(console.log("📅 Updating Magen Bagrut date:",E.presentationDates.magenBagrutDate),await St.updateMagenBagrut(M,{date:E.presentationDates.magenBagrutDate}),console.log("✅ Updated Magen Bagrut date successfully")),await va.getState().loadBagruts(),w({type:"success",message:l?"בגרות עודכנה בהצלחה":`בגרות נוצרה בהצלחה עם ${E.programPieces.filter(W=>W.pieceTitle.trim()&&W.composer.trim()).length} יצירות ו-${E.accompanists.filter(W=>W.name.trim()).length} מלווים`,autoCloseTime:4e3}),s()}catch(M){console.error(`❌ Error ${l?"updating":"creating"} comprehensive bagrut:`,M),console.error("❌ Error details:",{message:M instanceof Error?M.message:String(M),stack:M instanceof Error?M.stack:void 0,response:((k=M==null?void 0:M.response)==null?void 0:k.data)||(M==null?void 0:M.response)||void 0,status:((z=M==null?void 0:M.response)==null?void 0:z.status)||void 0}),w({type:"danger",message:M instanceof Error?M.message:l?"שגיאה בעדכון בגרות":"שגיאה ביצירת בגרות",autoCloseTime:5e3})}finally{console.log("🏁 BagrutForm submission finished, setting loading to false"),f(!1)}};return t?e.jsx(Ua,{isOpen:t,onClose:s,className:"bagrut-form responsive-form",children:e.jsxs("div",{className:"form-modal",...I,children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"btn-icon close-btn",onClick:s,"aria-label":"סגור",type:"button",children:e.jsx(Nt,{size:20})}),e.jsx("h2",{...T,children:l?"עריכת בגרות":"יצירת בגרות חדשה"})]}),e.jsx("div",{className:"form-content",children:p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"טוען נתוני בגרות..."})]}):e.jsx(yr,{enableReinitialize:!0,initialValues:D(),validationSchema:kR,onSubmit:R,children:({errors:E,touched:_,values:k,setFieldValue:z})=>e.jsxs(In,{children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(ux,{size:20}),"מידע בסיסי"]}),e.jsx(Me,{name:"conservatoryName",label:"שם הקונסרבטוריון",icon:ux,children:e.jsx("input",{type:"text",name:"conservatoryName",value:k.conservatoryName,onChange:M=>z("conservatoryName",M.target.value),className:"form-input",placeholder:"הזן שם קונסרבטוריון (אופציונלי)"})}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsxs(Me,{name:"studentId",label:"תלמיד (שלב 5+)",labelIcon:e.jsx(Je,{size:16}),as:"select",searchable:!0,required:!0,children:[e.jsx("option",{value:"",children:"בחר תלמיד..."}),A.map(M=>{var te,L,J,K,le,O;let G=0;if(M.academicInfo.currentStage)G=typeof M.academicInfo.currentStage=="number"?M.academicInfo.currentStage:parseInt(M.academicInfo.currentStage)||0;else{const U=(te=M.academicInfo.instrumentProgress)==null?void 0:te.find(Y=>Y.isPrimary);G=(U==null?void 0:U.currentStage)||((J=(L=M.academicInfo.instrumentProgress)==null?void 0:L[0])==null?void 0:J.currentStage)||0}const X=(K=M.academicInfo.instrumentProgress)==null?void 0:K.find(U=>U.isPrimary),W=(X==null?void 0:X.instrumentName)||((O=(le=M.academicInfo.instrumentProgress)==null?void 0:le[0])==null?void 0:O.instrumentName)||"";return e.jsxs("option",{value:M._id,children:[M.personalInfo.fullName," - ",W," - שלב ",G]},M._id)})]}),e.jsxs(Me,{name:"teacherId",label:"מורה מנחה",labelIcon:e.jsx(mr,{size:16}),as:"select",searchable:!0,required:!0,children:[e.jsx("option",{value:"",children:"בחר מורה..."}),i.filter(M=>M.isActive).map(M=>{var G,X;return e.jsxs("option",{value:M._id,children:[M.personalInfo.fullName," - ",((G=M.professionalInfo)==null?void 0:G.instrument)||""," - ",((X=M.roles)==null?void 0:X.join(", "))||""]},M._id)})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx($e,{size:20}),"תכנון מבחן"]}),e.jsx("div",{className:"form-grid-2-cols",children:e.jsx(Me,{name:"testDate",label:"תאריך מבחן",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.testDate?k.testDate.toISOString().split("T")[0]:"",onChange:M=>z("testDate",M.target.value?new Date(M.target.value):null),required:!0})}),e.jsx(Me,{name:"notes",label:"הערות והנחיות",labelIcon:e.jsx(hu,{size:16}),as:"textarea",placeholder:"הוסף הערות, הנחיות מיוחדות או מידע נוסף...",rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(Ke,{size:20}),"תכנית מוזיקלית"]}),e.jsx("p",{className:"section-description",children:"הוסף לפחות יצירה אחת לתכנית הבגרות"}),k.programPieces.map((M,G)=>e.jsxs("div",{className:"program-piece-item",children:[e.jsxs("div",{className:"piece-header",children:[e.jsxs("span",{className:"piece-number",children:["יצירה #",G+1]}),k.programPieces.length>1&&e.jsx("button",{type:"button",onClick:()=>{const X=k.programPieces.filter((W,te)=>te!==G);z("programPieces",X)},className:"btn-icon delete-btn","aria-label":"מחק יצירה",children:e.jsx(Ft,{size:16})})]}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsx(Me,{name:`programPieces.${G}.pieceTitle`,label:"שם היצירה",required:!0,children:e.jsx("input",{type:"text",value:M.pieceTitle,onChange:X=>{const W=[...k.programPieces];W[G].pieceTitle=X.target.value,z("programPieces",W)},className:"form-input",placeholder:"למשל: סונטה מס' 1"})}),e.jsx(Me,{name:`programPieces.${G}.composer`,label:"מלחין",required:!0,children:e.jsx("input",{type:"text",value:M.composer,onChange:X=>{const W=[...k.programPieces];W[G].composer=X.target.value,z("programPieces",W)},className:"form-input",placeholder:"למשל: מוצרט"})})]}),e.jsxs("div",{className:"form-grid-3-cols",children:[e.jsx(Me,{name:`programPieces.${G}.duration`,label:"משך זמן",required:!0,children:e.jsx("input",{type:"text",value:M.duration,onChange:X=>{const W=[...k.programPieces];W[G].duration=X.target.value,z("programPieces",W)},className:"form-input",placeholder:"למשל: 4:30"})}),e.jsx(Me,{name:`programPieces.${G}.movement`,label:"פרק (אופציונלי)",children:e.jsx("input",{type:"text",value:M.movement||"",onChange:X=>{const W=[...k.programPieces];W[G].movement=X.target.value,z("programPieces",W)},className:"form-input",placeholder:"למשל: Allegro"})}),e.jsx(Me,{name:`programPieces.${G}.youtubeLink`,label:"קישור YouTube",children:e.jsx("input",{type:"url",value:M.youtubeLink||"",onChange:X=>{const W=[...k.programPieces];W[G].youtubeLink=X.target.value,z("programPieces",W)},className:"form-input",placeholder:"https://youtube.com/..."})})]})]},G)),e.jsxs("button",{type:"button",onClick:()=>{const M={pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""};z("programPieces",[...k.programPieces,M])},className:"btn btn-secondary add-item-btn",children:[e.jsx(fs,{size:16}),"הוסף יצירה נוספת"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx($e,{size:20}),"תכנון השמעות"]}),e.jsx("p",{className:"section-description",children:"תאריכים מתוכננים ל-4 השמעות ומגן בגרות (אופציונלי)"}),e.jsxs("div",{className:"form-grid-2-cols",children:[e.jsx(Me,{name:"presentationDates.presentation1Date",label:"השמעה 1",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.presentationDates.presentation1Date?k.presentationDates.presentation1Date.toISOString().split("T")[0]:"",onChange:M=>z("presentationDates.presentation1Date",M.target.value?new Date(M.target.value):null)}),e.jsx(Me,{name:"presentationDates.presentation2Date",label:"השמעה 2",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.presentationDates.presentation2Date?k.presentationDates.presentation2Date.toISOString().split("T")[0]:"",onChange:M=>z("presentationDates.presentation2Date",M.target.value?new Date(M.target.value):null)}),e.jsx(Me,{name:"presentationDates.presentation3Date",label:"השמעה 3",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.presentationDates.presentation3Date?k.presentationDates.presentation3Date.toISOString().split("T")[0]:"",onChange:M=>z("presentationDates.presentation3Date",M.target.value?new Date(M.target.value):null)}),e.jsx(Me,{name:"presentationDates.presentation4Date",label:"השמעה 4",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.presentationDates.presentation4Date?k.presentationDates.presentation4Date.toISOString().split("T")[0]:"",onChange:M=>z("presentationDates.presentation4Date",M.target.value?new Date(M.target.value):null)}),e.jsx(Me,{name:"presentationDates.magenBagrutDate",label:"מגן בגרות",labelIcon:e.jsx($e,{size:16}),type:"date",value:k.presentationDates.magenBagrutDate?k.presentationDates.magenBagrutDate.toISOString().split("T")[0]:"",onChange:M=>z("presentationDates.magenBagrutDate",M.target.value?new Date(M.target.value):null)})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:[e.jsx(SE,{size:20}),"מלווים"]}),e.jsx("p",{className:"section-description",children:"הוסף לפחות מלווה אחד לביצועים"}),k.accompanists.map((M,G)=>e.jsxs("div",{className:"accompanist-item",children:[e.jsxs("div",{className:"accompanist-header",children:[e.jsxs("span",{className:"accompanist-number",children:["מלווה #",G+1]}),k.accompanists.length>1&&e.jsx("button",{type:"button",onClick:()=>{const X=k.accompanists.filter((W,te)=>te!==G);z("accompanists",X)},className:"btn-icon delete-btn","aria-label":"מחק מלווה",children:e.jsx(Ft,{size:16})})]}),e.jsx("div",{className:"form-grid-1-col accompanist-select-container",children:e.jsxs(Me,{name:`accompanists.${G}.name`,label:"שם המלווה",as:"select",searchable:!0,value:M.name,onChange:X=>{const W=[...k.accompanists];W[G].name=X.target.value,z("accompanists",W)},className:"accompanist-select",required:!0,children:[e.jsx("option",{value:"",children:"בחר שם מלווה"}),S.map(X=>{var W;return e.jsxs("option",{value:X.personalInfo.fullName,children:[X.personalInfo.fullName," - ",((W=X.professionalInfo)==null?void 0:W.instrument)||""]},X._id)}),e.jsx("option",{value:"מלווה חיצוני",children:"מלווה חיצוני"})]})})]},G)),e.jsxs("button",{type:"button",onClick:()=>{const M={name:""};z("accompanists",[...k.accompanists,M])},className:"btn btn-secondary add-item-btn",children:[e.jsx(fs,{size:16}),"הוסף מלווה נוסף"]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,disabled:u,children:"ביטול"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u,onClick:()=>console.log("🔘 Submit button clicked!"),children:u?l?"מעדכן בגרות...":"יוצר בגרות מקיפה...":l?"עדכן בגרות":"צור בגרות מלאה"})]})]})})})]})}):null}function IR(){const{bagruts:t,isLoading:s,error:n,loadBagruts:i,deleteBagrut:l,updateBagrut:c}=va(),{students:u,loadStudents:f}=Ma(),{teachers:p,loadTeachers:m}=Ds(),[y,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(!1),[A,S]=x.useState(null),[C,D]=x.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),I=x.useMemo(()=>P=>{const q=u.find(se=>se._id===P.studentId),B=p.find(se=>se._id===P.teacherId);return[(q==null?void 0:q.personalInfo.fullName)||"",(B==null?void 0:B.personalInfo.fullName)||"",P.conservatoryName||"",P.finalGradeLevel||"",P.isCompleted?"הושלם":"בתהליך"].filter(se=>typeof se=="string")},[u,p]),{filteredEntities:T,handleSearch:R,filters:E,handleApplyFilters:_,hasActiveFilters:k}=bu(t,I,()=>"",void 0,void 0,P=>{const q=u.find(B=>B._id===P.studentId);return(q==null?void 0:q.personalInfo.fullName)||""}),z=_t(),M=gs(),{user:G,isAuthenticated:X}=ys(),{addToast:W}=Ot(),te=Al(G,X),L=M.pathname.includes("/bagrut/")&&!M.pathname.endsWith("/bagrut/");x.useEffect(()=>{i(),f(),m()},[i,f,m]);const J=()=>{if(!G||!X){W({type:"warning",message:"נדרשת התחברות למערכת",autoCloseTime:4e3});return}v(!0)},K=()=>{v(!1),w(!1),S(null),i()},le=P=>{z(`/bagrut/${P}`)},O=P=>{w(!0),S(P),v(!0)},U=P=>{const q=t.find(ae=>ae._id===P),B=u.find(ae=>ae._id===(q==null?void 0:q.studentId)),se=(B==null?void 0:B.personalInfo.fullName)||"תלמיד לא זמין";D({isOpen:!0,title:"מחיקת בגרות",message:`האם אתה בטוח שברצונך למחוק את הבגרות של "${se}"?

פעולה זו אינה הפיכה ותמחק את כל הנתונים הקשורים לבגרות זו.`,onConfirm:()=>Y(P)})},Y=async P=>{try{await l(P),W({type:"success",message:"הבגרות נמחקה בהצלחה",autoCloseTime:3e3}),D({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch{W({type:"danger",message:"שגיאה במחיקת הבגרות",autoCloseTime:5e3})}},Z=()=>{N(!j)},H=!!(G&&X);return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content",children:[!L&&e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"search-action-container",children:[e.jsx(rc,{onSearch:R,placeholder:"חיפוש בגרויות..."}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"filter-container",children:[e.jsxs("button",{className:`btn-icon filter-btn ${k?"active":""}`,onClick:Z,"aria-label":"סנן בגרויות",children:[e.jsx(hi,{className:"icon"}),k&&e.jsx("span",{className:"filter-indicator"})]}),e.jsx(Nu,{isOpen:j,onToggle:()=>N(!j),onApplyFilters:_,availableInstruments:[],classRange:void 0,currentFilters:E,hasActiveFilters:k,entityType:"bagruts"})]}),H&&e.jsx("button",{className:"btn-icon add-btn",onClick:J,"aria-label":"הוספת בגרות חדשה",type:"button",children:e.jsx(fs,{className:"icon"})})]})]})}),n&&e.jsx("div",{className:"error-message",children:n}),!L&&e.jsx(DR,{bagruts:T,isLoading:s,onView:le,onEdit:O,onDelete:U,students:u,teachers:p,authContext:te}),e.jsx(wl,{context:{loadBagruts:i}}),e.jsx(OR,{isOpen:y,onClose:K,students:u,teachers:p,editMode:b,editingBagrutId:A}),e.jsx(ps,{isOpen:C.isOpen,title:C.title,message:C.message,onConfirm:C.onConfirm,onCancel:()=>D({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),confirmText:"מחק",cancelText:"ביטול",type:"danger"})]}),!L&&!y&&e.jsx(mi,{})]})}function $R({bagrut:t,canEdit:s,teachers:n=[]}){const[i,l]=x.useState(null),[c,u]=x.useState(!1),{updatePresentation:f,updateMagenBagrut:p}=va(),{addToast:m}=Ot(),y=S=>{if(!S)return"לא ידוע";const C=n.find(D=>D._id===S);return C?C.personalInfo.fullName:"לא ידוע"},v=(S,C)=>{l({index:S,data:{...C}})},j=async()=>{if(i){u(!0);try{i.data.grade&&!i.data.gradeLevel&&(i.data.gradeLevel=Dj(i.data.grade)),i.data.grade&&(i.data.status=i.data.grade>=55?"עבר/ה":"לא עבר/ה"),i.index==="magen"?await p(t._id,i.data):await f(t._id,i.index,i.data),m({type:"success",message:"השמעה עודכנה בהצלחה",autoCloseTime:3e3}),l(null)}catch{m({type:"danger",message:"שגיאה בעדכון השמעה",autoCloseTime:5e3})}finally{u(!1)}}},N=()=>{l(null)},b=S=>S.completed?S.status==="עבר/ה"?e.jsx(Et,{size:16,className:"status-icon success"}):e.jsx(Et,{size:16,className:"status-icon danger"}):e.jsx(Ve,{size:16,className:"status-icon muted"}),w=S=>S.completed?S.status==="עבר/ה"?"var(--success)":"var(--danger)":"var(--text-muted)",A=(S,C,D)=>{const I=(i==null?void 0:i.index)===C;return e.jsxs("div",{className:"presentation-card",children:[e.jsxs("div",{className:"presentation-header",children:[e.jsxs("div",{className:"presentation-title",children:[e.jsx("h3",{children:D}),b(S)]}),s&&!I&&e.jsx("button",{className:"edit-btn",onClick:()=>v(C,S),"aria-label":`ערוך ${D}`,children:e.jsx(fu,{size:16})})]}),I?e.jsxs("div",{className:"presentation-edit-form",children:[e.jsxs("div",{className:"form-row completion-toggle",children:[e.jsx("label",{className:"completion-label",children:"הושלם"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:i.data.completed||!1,onChange:T=>l({...i,data:{...i.data,completed:T.target.checked}})}),e.jsx("span",{className:"toggle-slider"})]})]}),i.data.completed&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"סטטוס:"}),e.jsxs("select",{value:i.data.status||"לא נבחן",onChange:T=>l({...i,data:{...i.data,status:T.target.value}}),children:[e.jsx("option",{value:"לא נבחן",children:"לא נבחן"}),e.jsx("option",{value:"עבר/ה",children:"עבר/ה"}),e.jsx("option",{value:"לא עבר/ה",children:"לא עבר/ה"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"ציון (0-100):"}),e.jsx("input",{type:"number",min:"0",max:"100",value:i.data.grade||"",onChange:T=>l({...i,data:{...i.data,grade:T.target.value?Number(T.target.value):null}})})]}),i.data.grade&&e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"רמת ציון:"}),e.jsx("select",{value:i.data.gradeLevel||Dj(i.data.grade),onChange:T=>l({...i,data:{...i.data,gradeLevel:T.target.value}}),children:Object.keys(eN).map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"הערות:"}),e.jsx("textarea",{value:i.data.review||"",onChange:T=>l({...i,data:{...i.data,review:T.target.value}}),rows:3})]})]}),e.jsxs("div",{className:"bagrut-form-actions",children:[e.jsxs("button",{className:"btn secondary",onClick:N,disabled:c,children:[e.jsx(Nt,{size:16}),"ביטול"]}),e.jsxs("button",{className:"btn primary",onClick:j,disabled:c,children:[e.jsx(tc,{size:16}),c?"שומר...":"שמור"]})]})]}):e.jsxs("div",{className:"presentation-info",children:[e.jsxs("div",{className:"bagrut-info-row",children:[e.jsx("span",{className:"label",children:"סטטוס:"}),e.jsx("span",{className:"value status",style:{color:w(S)},children:S.status})]}),S.completed&&S.date&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"תאריך:"}),e.jsxs("span",{className:"value",children:[e.jsx($e,{size:14}),new Date(S.date).toLocaleDateString("he-IL")]})]}),S.grade&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"ציון:"}),e.jsxs("span",{className:"value grade",children:[S.grade," (",S.gradeLevel,")"]})]}),S.review&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"הערות:"}),e.jsx("span",{className:"value",children:S.review})]}),S.reviewedBy&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"נבדק על ידי:"}),e.jsx("span",{className:"value",children:y(S.reviewedBy)})]})]})]},`presentation-${C}`)};return e.jsxs("div",{className:"presentation-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"השמעות ומגן בגרות"}),e.jsxs("div",{className:"completion-summary",children:[t.presentations.filter(S=>S.completed).length,"/4 השמעות הושלמו",t.magenBagrut.completed&&" + מגן בגרות"]})]}),e.jsxs("div",{className:"presentations-grid",children:[t.presentations.map((S,C)=>A(S,C,`השמעה ${C+1}`)),A(t.magenBagrut,"magen","מגן בגרות")]})]})}function RR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(-1),[p,m]=x.useState(null),[y,v]=x.useState(!1),[j,N]=x.useState(!1),[b,w]=x.useState(null),[A,S]=x.useState({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""}),{addProgramPiece:C,updateProgramPiece:D,updateProgram:I,removeProgramPiece:T}=va(),{addToast:R}=Ot(),E=()=>{i(!0),S({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""})},_=(L,J)=>{const K=L._id||`temp-${J}`;c(K),f(J),m(L),S({pieceTitle:L.pieceTitle,composer:L.composer,duration:L.duration,movement:L.movement||"",youtubeLink:L.youtubeLink||""})},k=async()=>{var L,J;if(!A.pieceTitle.trim()||!A.composer.trim()||!A.duration.trim()){R({type:"warning",message:"נא למלא את כל השדות הנדרשים",autoCloseTime:3e3});return}v(!0);try{const K={pieceTitle:A.pieceTitle.trim(),composer:A.composer.trim(),duration:A.duration.trim(),movement:((L=A.movement)==null?void 0:L.trim())||void 0,youtubeLink:((J=A.youtubeLink)==null?void 0:J.trim())||void 0};if(l&&!l.startsWith("temp-"))await D(t._id,l,K),R({type:"success",message:"יצירה עודכנה בהצלחה",autoCloseTime:3e3});else if(l&&l.startsWith("temp-")){const le=t.program.map((O,U)=>U===u?{pieceTitle:K.pieceTitle,composer:K.composer,duration:K.duration,movement:K.movement,youtubeLink:K.youtubeLink}:{pieceTitle:O.pieceTitle,composer:O.composer,duration:O.duration,movement:O.movement,youtubeLink:O.youtubeLink});await I(t._id,le),R({type:"success",message:"יצירה עודכנה בהצלחה",autoCloseTime:3e3})}else await C(t._id,K),R({type:"success",message:"יצירה נוספה לתוכנית",autoCloseTime:3e3});G()}catch{R({type:"danger",message:l?"שגיאה בעדכון יצירה":"שגיאה בהוספת יצירה",autoCloseTime:5e3})}finally{v(!1)}},z=(L,J,K)=>{w({id:L,title:J,index:K}),N(!0)},M=async()=>{if(b){v(!0);try{if(b.id&&b.id!=="undefined")await T(t._id,b.id);else{const L=t.program.filter((J,K)=>K!==b.index);await I(t._id,L)}R({type:"success",message:"יצירה הוסרה מהתוכנית",autoCloseTime:3e3})}catch{R({type:"danger",message:"שגיאה בהסרת יצירה",autoCloseTime:5e3})}finally{v(!1),N(!1),w(null)}}},G=()=>{i(!1),c(null),S({pieceTitle:"",composer:"",duration:"",movement:"",youtubeLink:""})},X=L=>{if(L.includes(":"))return L;const J=parseInt(L);return isNaN(J)?L:`${J} דקות`},W=()=>e.jsxs("div",{className:"piece-form-card",children:[e.jsx("div",{className:"form-header",children:e.jsx("h4",{children:l?"ערוך יצירה":"הוסף יצירה חדשה"})}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"שם היצירה *"}),e.jsx("input",{type:"text",value:A.pieceTitle,onChange:L=>S({...A,pieceTitle:L.target.value}),placeholder:"הזן שם יצירה",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"מלחין *"}),e.jsx("input",{type:"text",value:A.composer,onChange:L=>S({...A,composer:L.target.value}),placeholder:"הזן שם מלחין",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"משך זמן *"}),e.jsx("input",{type:"text",value:A.duration,onChange:L=>S({...A,duration:L.target.value}),placeholder:"לדוגמה: 5:30 או 8 דקות",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"פרק/חלק (אופציונלי)"}),e.jsx("input",{type:"text",value:A.movement,onChange:L=>S({...A,movement:L.target.value}),placeholder:"לדוגמה: פרק ראשון, אלגרו",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"קישור YouTube (אופציונלי)"}),e.jsx("input",{type:"url",value:A.youtubeLink,onChange:L=>S({...A,youtubeLink:L.target.value}),placeholder:"https://youtube.com/...",className:"form-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn secondary",onClick:G,disabled:y,children:[e.jsx(Nt,{size:16}),"ביטול"]}),e.jsxs("button",{className:"btn primary",onClick:k,disabled:y,children:[e.jsx(tc,{size:16}),y?"שומר...":"שמור"]})]})]}),te=(L,J)=>e.jsxs("div",{className:"piece-card",children:[e.jsxs("div",{className:"piece-header",children:[e.jsxs("div",{className:"piece-title-section",children:[e.jsx(Ke,{size:16,className:"piece-icon"}),e.jsxs("div",{className:"piece-title-info",children:[e.jsx("h4",{className:"piece-title",children:L.pieceTitle}),e.jsx("p",{className:"piece-composer",children:L.composer})]})]}),s&&e.jsxs("div",{className:"piece-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:K=>{console.log("Edit button click event triggered"),K.preventDefault(),K.stopPropagation(),_(L,J)},disabled:y,"aria-label":"ערוך יצירה",children:e.jsx(fu,{size:14})}),e.jsx("button",{className:"action-btn delete",onClick:()=>z(L._id,L.pieceTitle,J),disabled:y,"aria-label":"הסר יצירה",children:e.jsx(Ft,{size:14})})]})]}),e.jsxs("div",{className:"piece-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:X(L.duration)})]}),L.movement&&e.jsx("div",{className:"detail-item",children:e.jsx("span",{className:"movement-text",children:L.movement})}),L.youtubeLink&&e.jsx("div",{className:"detail-item",children:e.jsxs("a",{href:L.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"youtube-link",children:[e.jsx(vm,{size:14}),"צפה ב-YouTube"]})})]})]},L._id||`piece-${J}`);return e.jsxs("div",{className:"program-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"תוכנית מוזיקלית"}),e.jsxs("div",{className:"program-summary",children:[t.program.length," יצירות בתוכנית"]}),s&&!n&&!l&&e.jsxs("button",{className:"btn primary",onClick:E,children:[e.jsx(fs,{size:16}),"הוסף יצירה"]})]}),(n||l)&&W(),t.program.length===0&&!n?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ke,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין יצירות בתוכנית"}),e.jsx("p",{children:"התחל בהוספת יצירות לתוכנית הבגרות"})]}):e.jsx("div",{className:"pieces-grid",children:t.program.map((L,J)=>te(L,J))}),e.jsx(ps,{isOpen:j,onClose:()=>{N(!1),w(null)},onConfirm:M,title:"הסרת יצירה",message:b?e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך להסיר את היצירה ",e.jsxs("strong",{children:['"',b.title,'"']})," מהתוכנית?",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--danger-color)",fontSize:"0.9em"},children:"פעולה זו אינה ניתנת לביטול."})]}):null,confirmText:"הסר יצירה",cancelText:"ביטול",type:"danger"})]})}function MR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(!1),[u,f]=x.useState(0),[p,m]=x.useState(!1),[y,v]=x.useState(-1);x.useEffect(()=>{console.log("GradingManager received bagrut:",t),console.log("Presentations:",t.presentations),t.presentations.forEach((L,J)=>{console.log(`Presentation ${J+1}:`,{grade:L.grade,gradeLevel:L.gradeLevel,completed:L.completed,status:L.status})})},[t]);const j=()=>({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}}),[N,b]=x.useState(j()),{updateGradingDetails:w,calculateFinalGrade:A,updatePresentation:S,loadBagrutById:C}=va(),{addToast:D}=Ot();x.useEffect(()=>{n||b({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}})},[t.gradingDetails,n]);const I=()=>{i(!0),b({technique:{grade:t.gradingDetails.technique.grade,comments:t.gradingDetails.technique.comments},interpretation:{grade:t.gradingDetails.interpretation.grade,comments:t.gradingDetails.interpretation.comments},musicality:{grade:t.gradingDetails.musicality.grade,comments:t.gradingDetails.musicality.comments},overall:{grade:t.gradingDetails.overall.grade,comments:t.gradingDetails.overall.comments}})},T=async()=>{console.log("Starting save process...",N),c(!0);try{const L={technique:{grade:N.technique.grade,maxPoints:20,comments:N.technique.comments},interpretation:{grade:N.interpretation.grade,maxPoints:30,comments:N.interpretation.comments},musicality:{grade:N.musicality.grade,maxPoints:40,comments:N.musicality.comments},overall:{grade:N.overall.grade,maxPoints:10,comments:N.overall.comments}};console.log("Sending grading data:",L);const J=await w(t._id,L);console.log("Update result:",J),D({type:"success",message:"ציונים עודכנו בהצלחה",autoCloseTime:3e3}),i(!1)}catch(L){console.error("Error saving grading details:",L),D({type:"danger",message:"שגיאה בעדכון ציונים",autoCloseTime:5e3})}finally{c(!1)}},R=async()=>{c(!0);try{await A(t._id),D({type:"success",message:"ציון סופי חושב בהצלחה",autoCloseTime:3e3})}catch{D({type:"danger",message:"שגיאה בחישוב ציון סופי",autoCloseTime:5e3})}finally{c(!1)}},E=()=>{i(!1)},_=(L,J,K)=>{b(le=>({...le,[L]:{...le[L],[J]:K}}))},k=(L,J)=>{if(L===null)return"var(--text-muted)";const K=L/J*100;return K>=90?"var(--success)":K>=75?"var(--info)":K>=55?"var(--warning)":"var(--danger)"},z=()=>[N.technique.grade||0,N.interpretation.grade||0,N.musicality.grade||0,N.overall.grade||0].reduce((J,K)=>J+K,0),M=(L,J,K,le)=>{const O=t.gradingDetails[L],U=N[L];return e.jsxs("div",{className:"grading-category",children:[e.jsx("div",{className:"category-header",children:e.jsxs("div",{className:"category-info",children:[e.jsxs("div",{className:"header-with-grade",children:[e.jsx("h4",{children:J}),e.jsxs("div",{className:"grade-inline",children:[e.jsx("span",{children:"ציון:"}),n?e.jsx("input",{type:"number",min:"0",max:K,value:U.grade||"",onChange:Y=>_(L,"grade",Y.target.value?Number(Y.target.value):null),className:"grade-input",placeholder:"0"}):e.jsx("span",{className:"grade-display",style:{color:k(O.grade,K)},children:O.grade!==null?`${O.grade}/${K}`:"לא הוערך"})]})]}),le,e.jsxs("span",{className:"max-points",children:["מקסימום: ",K," נקודות"]})]})}),e.jsxs("div",{className:"category-comments",children:[e.jsx("label",{children:"הערות:"}),n?e.jsx("textarea",{value:U.comments,onChange:Y=>_(L,"comments",Y.target.value),placeholder:"הזן הערות...",rows:3,className:"comments-input"}):e.jsx("p",{className:"comments-display",children:O.comments||"אין הערות"})]})]})},G=()=>{const L=[];for(let J=0;J<t.presentations.length;J++){t.presentations[J];const K=J>0?t.presentations[J-1]:null;if(J===0||K&&K.completed)L.push(J);else break}return L},X=async(L,J)=>{c(!0);try{const K={completed:J,status:J?"עבר/ה":"לא נבחן",date:J?new Date:null};await S(t._id,L,K),D({type:"success",message:`השמעה ${L+1} ${J?"סומנה כהושלמה":"סומנה כלא הושלמה"}`,autoCloseTime:3e3})}catch(K){console.error("Error updating presentation status:",K),D({type:"danger",message:"שגיאה בעדכון סטטוס השמעה",autoCloseTime:5e3})}finally{c(!1)}},W=L=>{v(L),m(!0)},te=async()=>{c(!0);try{const L={completed:!1,status:"לא נבחן",date:null,review:null,reviewedBy:null,grade:null,gradeLevel:null};console.log("Resetting presentation with data:",L),console.log("Current presentation before reset:",t.presentations[y]);const J=await S(t._id,y,L);console.log("Updated bagrut after reset:",J),console.log("Updated presentation after reset:",J.presentations[y]),console.log("Current bagrut finalGrade after presentation reset:",J.finalGrade,J.finalGradeLevel),console.log("Recalculating final grade..."),await A(t._id),await C(t._id),D({type:"success",message:`השמעה ${y+1} אופסה בהצלחה`,autoCloseTime:3e3})}catch(L){console.error("Error resetting presentation:",L),D({type:"danger",message:"שגיאה באיפוס השמעה",autoCloseTime:5e3})}finally{c(!1),m(!1),v(-1)}};return e.jsxs("div",{className:"grading-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h2",{children:["ציונים מפורטים - השמעה ",u+1]}),s&&!n&&e.jsxs("div",{className:"header-buttons",children:[e.jsxs("button",{className:"btn primary",onClick:I,children:[e.jsx(fu,{size:16}),"ערוך ציונים"]}),e.jsxs("button",{className:"btn secondary reset-presentation-btn",onClick:()=>W(u),title:"איפוס השמעה נבחרת",children:[e.jsx(Uo,{size:16}),"איפוס השמעה"]})]})]}),e.jsxs("div",{className:"presentations-summary",children:[e.jsx("h3",{children:"השמעות וחגן בגרות:"}),e.jsx("div",{className:"presentations-grid",children:t.presentations.map((L,J)=>{var U,Y,Z,H;const le=G().includes(J),O=u===J;return e.jsxs("div",{className:`presentation-card ${L.completed?"completed":"pending"} ${O?"selected":""} ${le?"available":"locked"}`,children:[e.jsxs("div",{className:"presentation-header",children:[e.jsxs("span",{className:"presentation-number",children:["השמעה ",J+1]}),e.jsx("span",{className:`status-badge ${((H=(Z=(Y=(U=L.status)==null?void 0:U.replace)==null?void 0:Y.call(U,"/",""))==null?void 0:Z.replace)==null?void 0:H.call(Z," ","-"))||"לא-נבחן"}`,children:L.status||"לא נבחן"})]}),e.jsx("div",{className:"presentation-grade-section",children:e.jsxs("div",{className:"grade-display",children:[e.jsx("span",{className:"grade-label",children:"ציון סופי:"}),e.jsx("span",{className:"grade-value",children:L.grade?`${L.grade} (${L.gradeLevel})`:"לא הוערך"})]})}),le&&s&&e.jsx("div",{className:"completion-toggle",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("span",{children:"הושלם"}),e.jsxs("div",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:L.completed,onChange:P=>X(J,P.target.checked)}),e.jsx("span",{className:"toggle-slider"})]})]})}),L.completed&&L.date&&e.jsxs("div",{className:"presentation-date",children:["תאריך: ",new Date(L.date).toLocaleDateString("he-IL")]}),!le&&J>0&&e.jsxs("div",{className:"locked-message",children:["יש להשלים השמעה ",J," תחילה"]})]},J)})})]}),t.finalGrade&&e.jsx("div",{className:"final-grade-summary",children:e.jsxs("div",{className:"final-grade-card",children:[e.jsx(Cs,{size:24}),e.jsxs("div",{className:"final-grade-info",children:[e.jsxs("h3",{children:["ציון סופי: ",t.finalGrade]}),e.jsxs("p",{children:["רמת ציון: ",t.finalGradeLevel]})]})]})}),e.jsxs("div",{className:"grading-categories",children:[M("technique","מיומנות נגינה/שירה",20,""),M("musicality","הבנה מוסיקלית",40,""),M("interpretation","ידיעת הטקסט",30,""),M("overall",'נוגן בע"פ',10,"")]}),n&&e.jsx("div",{className:"current-total",children:e.jsxs("div",{className:"total-info",children:[e.jsx(hx,{size:16}),e.jsxs("span",{children:['סה"כ נוכחי: ',z(),"/100"]})]})}),n?e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn primary",onClick:T,disabled:l,children:[e.jsx(tc,{size:16}),l?"שומר...":"שמור ציונים"]}),e.jsxs("button",{className:"btn secondary",onClick:E,disabled:l,children:[e.jsx(Nt,{size:16}),"ביטול"]})]}):s&&e.jsx("div",{className:"calculate-actions",children:e.jsxs("button",{className:"btn primary",onClick:R,disabled:l,children:[e.jsx(hx,{size:16}),l?"מחשב...":"חשב ציון סופי"]})}),e.jsxs("div",{className:"grading-scale-reference",children:[e.jsx("h4",{children:"סולם ציונים:"}),e.jsxs("div",{className:"scale-items",children:[e.jsx("div",{className:"scale-item",children:"מעולה: 95-100"}),e.jsx("div",{className:"scale-item",children:"טוב מאוד: 90-94"}),e.jsx("div",{className:"scale-item",children:"טוב: 75-89"}),e.jsx("div",{className:"scale-item",children:"מספיק: 55-74"}),e.jsx("div",{className:"scale-item",children:"מספיק בקושי: 45-54"}),e.jsx("div",{className:"scale-item",children:"לא עבר/ה: 0-44"})]})]}),e.jsx(ps,{isOpen:p,onClose:()=>{m(!1),v(-1)},onConfirm:te,title:"איפוס השמעה",message:e.jsxs("div",{children:[e.jsxs("p",{children:["האם אתה בטוח שברצונך לאפס את ",e.jsxs("strong",{children:["השמעה ",y+1]}),"?"]}),e.jsx("p",{children:'פעולה זו תמחק את כל הנתונים הקשורים להשמעה ותחזיר אותה לסטטוס "לא נבחן".'})]}),confirmText:"איפוס השמעה",cancelText:"ביטול",type:"danger"})]})}function zR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(!1),u=x.useRef(null),{uploadDocument:f,removeDocument:p}=va(),{addToast:m}=Ot(),y=async S=>{if(!S||S.length===0)return;const C=S[0],D=10*1024*1024;if(C.size>D){m({type:"warning",message:"קובץ גדול מדי. גודל מקסימלי: 10MB",autoCloseTime:4e3});return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","audio/mpeg","audio/wav","video/mp4"].includes(C.type)){m({type:"warning",message:"סוג קובץ לא נתמך. נתמכים: PDF, Word, תמונות, אודיו, וידאו",autoCloseTime:4e3});return}i(!0);try{await f(t._id,C),m({type:"success",message:"מסמך הועלה בהצלחה",autoCloseTime:3e3})}catch{m({type:"danger",message:"שגיאה בהעלאת מסמך",autoCloseTime:5e3})}finally{i(!1),u.current&&(u.current.value="")}},v=async(S,C)=>{if(confirm(`האם אתה בטוח שברצונך למחוק את המסמך "${C}"?`))try{await p(t._id,S),m({type:"success",message:"מסמך נמחק בהצלחה",autoCloseTime:3e3})}catch{m({type:"danger",message:"שגיאה במחיקת מסמך",autoCloseTime:5e3})}},j=S=>{S.preventDefault(),c(!0)},N=S=>{S.preventDefault(),c(!1)},b=S=>{S.preventDefault(),c(!1),y(S.dataTransfer.files)},w=S=>{if(S===0)return"0 B";const C=1024,D=["B","KB","MB","GB"],I=Math.floor(Math.log(S)/Math.log(C));return parseFloat((S/Math.pow(C,I)).toFixed(2))+" "+D[I]},A=S=>S.startsWith("image/")?"🖼️":S.startsWith("audio/")?"🎵":S.startsWith("video/")?"🎬":S.includes("pdf")?"📄":S.includes("word")?"📝":"📋";return e.jsxs("div",{className:"document-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"מסמכים נלווים"}),e.jsxs("div",{className:"documents-count",children:[t.documents.length," מסמכים"]})]}),s&&e.jsxs("div",{className:`upload-area ${l?"dragging":""} ${n?"uploading":""}`,onDragOver:j,onDragLeave:N,onDrop:b,onClick:()=>{var S;return(S=u.current)==null?void 0:S.click()},children:[e.jsx("input",{ref:u,type:"file",onChange:S=>y(S.target.files),style:{display:"none"},disabled:n}),e.jsxs("div",{className:"upload-content",children:[e.jsx(xE,{size:32,className:"upload-icon"}),e.jsx("h4",{children:n?"מעלה קובץ...":"העלה מסמך"}),e.jsx("p",{children:"גרור קובץ לכאן או לחץ לבחירה"}),e.jsx("p",{className:"upload-hint",children:"PDF, Word, תמונות, אודיو, וידאו (עד 10MB)"})]})]}),t.documents.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(hu,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין מסמכים"}),e.jsx("p",{children:"העלה מסמכים נלווים לבגרות"})]}):e.jsx("div",{className:"documents-list",children:t.documents.map(S=>e.jsxs("div",{className:"document-card",children:[e.jsxs("div",{className:"document-info",children:[e.jsx("div",{className:"document-icon",children:e.jsx("span",{className:"file-type-icon",children:A(S.mimetype)})}),e.jsxs("div",{className:"document-details",children:[e.jsx("h4",{className:"document-name",children:S.title||S.filename}),e.jsxs("div",{className:"document-meta",children:[e.jsx("span",{className:"file-size",children:w(S.size)}),e.jsx("span",{className:"upload-date",children:new Date(S.uploadDate).toLocaleDateString("he-IL")})]})]})]}),e.jsxs("div",{className:"document-actions",children:[e.jsx("button",{className:"action-btn view",onClick:()=>{m({type:"info",message:"פתיחת מסמך (יש להטמיע)",autoCloseTime:3e3})},"aria-label":"צפה במסמך",children:e.jsx(xa,{size:16})}),e.jsx("button",{className:"action-btn download",onClick:()=>{m({type:"info",message:"הורדת מסמך (יש להטמיע)",autoCloseTime:3e3})},"aria-label":"הורד מסמך",children:e.jsx(_T,{size:16})}),s&&e.jsx("button",{className:"action-btn delete",onClick:()=>v(S._id,S.filename),"aria-label":"מחק מסמך",children:e.jsx(Ft,{size:16})})]})]},S._id))})]})}function LR({bagrut:t,canEdit:s}){const[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(!1),[p,m]=x.useState({name:"",instrument:"",phone:""}),{addAccompanist:y,removeAccompanist:v}=va(),{addToast:j}=Ot(),N=Array.isArray(t.accompaniment)?t.accompaniment:[],b=()=>{i(!0),m({name:"",instrument:"",phone:""})},w=T=>{c(T._id),m({name:T.name,instrument:T.instrument,phone:T.phone||""})},A=async()=>{if(!p.name.trim()||!p.instrument.trim()){j({type:"warning",message:"נא למלא שם וכלי נגינה",autoCloseTime:3e3});return}f(!0);try{const T={name:p.name.trim(),instrument:p.instrument.trim(),phone:p.phone.trim()||void 0};await y(t._id,T),j({type:"success",message:"מלווה נוסף בהצלחה",autoCloseTime:3e3}),C()}catch{j({type:"danger",message:"שגיאה בהוספת מלווה",autoCloseTime:5e3})}finally{f(!1)}},S=async(T,R)=>{if(confirm(`האם אתה בטוח שברצונך להסיר את המלווה "${R}"?`)){f(!0);try{await v(t._id,T),j({type:"success",message:"מלווה הוסר בהצלחה",autoCloseTime:3e3})}catch{j({type:"danger",message:"שגיאה בהסרת מלווה",autoCloseTime:5e3})}finally{f(!1)}}},C=()=>{i(!1),c(null),m({name:"",instrument:"",phone:""})},D=()=>e.jsxs("div",{className:"accompanist-form-card",children:[e.jsx("div",{className:"form-header",children:e.jsx("h4",{children:l?"ערוך מלווה":"הוסף מלווה"})}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"שם מלא *"}),e.jsx("input",{type:"text",value:p.name,onChange:T=>m({...p,name:T.target.value}),placeholder:"הזן שם מלא",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"כלי נגינה *"}),e.jsx("input",{type:"text",value:p.instrument,onChange:T=>m({...p,instrument:T.target.value}),placeholder:"לדוגמה: פסנתר, כינור",className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{children:"טלפון (אופציונלי)"}),e.jsx("input",{type:"tel",value:p.phone,onChange:T=>m({...p,phone:T.target.value}),placeholder:"מספר טלפון ליצירת קשר",className:"form-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{className:"btn secondary",onClick:C,disabled:u,children:[e.jsx(Nt,{size:16}),"ביטול"]}),e.jsxs("button",{className:"btn primary",onClick:A,disabled:u,children:[e.jsx(tc,{size:16}),u?"שומר...":"שמור"]})]})]}),I=T=>e.jsxs("div",{className:"accompanist-card",children:[e.jsxs("div",{className:"accompanist-header",children:[e.jsxs("div",{className:"accompanist-info",children:[e.jsx(fx,{size:16,className:"accompanist-icon"}),e.jsxs("div",{className:"accompanist-details",children:[e.jsx("h4",{className:"accompanist-name",children:T.name}),e.jsx("p",{className:"accompanist-instrument",children:T.instrument})]})]}),s&&e.jsxs("div",{className:"accompanist-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:()=>w(T),disabled:u,"aria-label":"ערוך מלווה",children:e.jsx(fu,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>S(T._id,T.name),disabled:u,"aria-label":"הסר מלווה",children:e.jsx(Ft,{size:16})})]})]}),T.phone&&e.jsxs("div",{className:"accompanist-contact",children:[e.jsx(fi,{size:14}),e.jsx("span",{children:T.phone})]})]},T._id);return e.jsxs("div",{className:"accompaniment-manager",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"מלווים"}),e.jsxs("div",{className:"accompanists-summary",children:[N.length," מלווים"]}),s&&!n&&!l&&e.jsxs("button",{className:"btn primary",onClick:b,children:[e.jsx(fs,{size:16}),"הוסף מלווה"]})]}),(n||l)&&D(),N.length===0&&!n?e.jsxs("div",{className:"empty-state",children:[e.jsx(fx,{size:48,className:"empty-icon"}),e.jsx("h3",{children:"אין מלווים"}),e.jsx("p",{children:"הוסף מלווים לביצוע הבגרות"})]}):e.jsx("div",{className:"accompanists-grid",children:N.map(I)})]})}function BR({bagrut:t}){var b;const[s,n]=x.useState(!1),[i,l]=x.useState(!1),[c,u]=x.useState(""),{completeBagrut:f}=va(),{addToast:p}=Ot(),{user:m}=ys(),y=async()=>{if(!c.trim()){p({type:"warning",message:"נא להזין חתימה דיגיטלית",autoCloseTime:3e3});return}n(!0);try{await f(t._id,c.trim()),p({type:"success",message:"בגרות הושלמה בהצלחה! מזל טוב!",autoCloseTime:5e3}),l(!1),u("")}catch{p({type:"danger",message:"שגיאה בהשלמת הבגרות",autoCloseTime:5e3})}finally{n(!1)}},j=[{id:"presentations",title:"4 השמעות",completed:t.presentations.every(A=>A.completed),description:"כל 4 ההשמעות יجב להיות מושלמות"},{id:"magen",title:"מגן בגרות",completed:t.magenBagrut.completed,description:"מגן בגרות (הגנה סופית) יגב להיות מושלם"},{id:"program",title:"תוכנית מוזיקלית",completed:t.program.length>0,description:"לפחות יצירה אחת בתוכנית"},{id:"grading",title:"ציונים מפורטים",completed:t.gradingDetails.technique.grade!==null&&t.gradingDetails.interpretation.grade!==null&&t.gradingDetails.musicality.grade!==null&&t.gradingDetails.overall.grade!==null,description:"כל הקטגוריות יגבו להיות מדורגות"},{id:"finalGrade",title:"ציון סופי",completed:t.finalGrade!==null,description:"ציון סופי יגב להיות מחושב"}],N=j.every(w=>w.completed);return t.isCompleted?e.jsxs("div",{className:"completion-status completed",children:[e.jsxs("div",{className:"completion-header",children:[e.jsx(Et,{size:32,className:"completion-icon success"}),e.jsxs("div",{className:"completion-info",children:[e.jsx("h3",{children:"בגרות הושלמה בהצלחה!"}),e.jsxs("p",{children:["ציון סופי: ",t.finalGrade," (",t.finalGradeLevel,")"]})]})]}),e.jsxs("div",{className:"completion-details",children:[t.completionDate&&e.jsxs("div",{className:"detail-item",children:[e.jsx($e,{size:16}),e.jsxs("span",{children:["תאריך השלמה: ",new Date(t.completionDate).toLocaleDateString("he-IL")]})]}),t.teacherSignature&&e.jsxs("div",{className:"detail-item",children:[e.jsx(LT,{size:16}),e.jsxs("span",{children:["חתימת מורה: ",t.teacherSignature]})]}),t.finalGrade&&e.jsxs("div",{className:"detail-item",children:[e.jsx(Cs,{size:16}),e.jsx("span",{children:"הישג מעולה! התלמיד עבר בהצלחה את הבגרות"})]})]})]}):e.jsxs("div",{className:"completion-manager",children:[e.jsxs("div",{className:"completion-header",children:[e.jsx("h3",{children:"השלמת בגרות"}),e.jsx("p",{children:"בדוק את הדרישות והשלם את תהליך הבגרות"})]}),e.jsxs("div",{className:"requirements-checklist",children:[e.jsx("h4",{children:"דרישות להשלמה:"}),e.jsx("div",{className:"requirements-list",children:j.map(w=>e.jsxs("div",{className:`requirement-item ${w.completed?"completed":"pending"}`,children:[e.jsx("div",{className:"requirement-status",children:e.jsx(Et,{size:20,className:w.completed?"completed-icon":"pending-icon"})}),e.jsxs("div",{className:"requirement-content",children:[e.jsx("h5",{children:w.title}),e.jsx("p",{children:w.description})]})]},w.id))})]}),e.jsx("div",{className:"completion-actions",children:N?i?e.jsxs("div",{className:"completion-form",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h4",{children:"השלמה סופית"}),e.jsx("p",{children:"אישור השלמת כל שלבי הבגרות"})]}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"signature-section",children:[e.jsx("label",{children:"חתימה דיגיטלית של המורה *"}),e.jsx("input",{type:"text",value:c,onChange:w=>u(w.target.value),placeholder:((b=m==null?void 0:m.personalInfo)==null?void 0:b.fullName)||"הזן שם מלא",className:"signature-input"}),e.jsx("p",{className:"signature-note",children:"חתימה זו מאשרת כי התלמיד השלים בהצלחה את כל שלבי הבגרות"})]}),e.jsxs("div",{className:"final-summary",children:[e.jsx("h5",{children:"סיכום סופי:"}),e.jsxs("div",{className:"summary-items",children:[e.jsx("div",{children:"השמעות הושלמו: ✓"}),e.jsx("div",{children:"מגן בגרות הושלם: ✓"}),e.jsxs("div",{children:["ציון סופי: ",t.finalGrade," (",t.finalGradeLevel,")"]}),e.jsx("div",{children:"מועמד/ת עומד/ת בכל הדרישות"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn secondary",onClick:()=>{l(!1),u("")},disabled:s,children:"ביטול"}),e.jsxs("button",{className:"btn primary",onClick:y,disabled:s||!c.trim(),children:[e.jsx(Et,{size:16}),s?"משלים...":"השלם בגרות סופית"]})]})]}):e.jsxs("button",{className:"btn primary large",onClick:()=>l(!0),children:[e.jsx(Et,{size:20}),"השלם בגרות"]}):e.jsx("div",{className:"incomplete-notice",children:e.jsx("p",{children:"יש להשלים את כל הדרישות לפני סיום הבגרות"})})}),N&&!i&&e.jsx("div",{className:"congratulations-preview",children:e.jsxs("div",{className:"celebration-content",children:[e.jsx(Cs,{size:48,className:"celebration-icon"}),e.jsx("h4",{children:"כל הכבוד!"}),e.jsx("p",{children:'התלמיד מוכן לסיום הבגרות. לחץ על "השלם בגרות" להשלמה סופית.'})]})})]})}function FR(){var R;const{bagrutId:t}=jr(),s=_t(),{user:n}=ys(),{addToast:i}=Ot(),[l,c]=x.useState("program"),{selectedBagrut:u,isLoading:f,error:p,loadBagrutById:m,clearError:y}=va(),{students:v,loadStudents:j}=Ma(),{teachers:N,loadTeachers:b}=Ds();x.useEffect(()=>{t&&m(t),j(),b()},[t,m,j,b]);const w=()=>{s("/bagrut")},A=()=>{var k;if(!u)return{text:"לא החל",color:"var(--text-muted)",icon:Ve};if(u.isCompleted)return{text:"הושלם",color:"var(--success)",icon:Et};const E=(u.presentations||[]).filter(z=>z.completed).length,_=((k=u.magenBagrut)==null?void 0:k.completed)||!1;return E>0||_?{text:"בתהליך",color:"var(--warning)",icon:Ve}:{text:"לא החל",color:"var(--text-muted)",icon:Ve}},S=u?v.find(E=>E._id===u.studentId):void 0,C=u?N.find(E=>E._id===u.teacherId):void 0,D=n&&(((R=n.roles)==null?void 0:R.includes("מנהל"))||(u==null?void 0:u.teacherId)===n._id),I=()=>{if(!u)return{completed:0,total:5,percentage:0};const E=u.presentations.filter(M=>M.completed).length,_=u.magenBagrut.completed?1:0,k=5,z=E+_;return{completed:z,total:k,percentage:z/k*100}};if(f)return e.jsxs("div",{className:"loading-state",children:[e.jsx(Yt,{className:"loading-icon",size:28}),e.jsx("p",{children:"טוען פרטי בגרות..."})]});if(p||!u)return e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:p||"לא ניתן לטעון את פרטי הבגרות"}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:w,className:"btn secondary",children:"חזרה לרשימת בגרויות"}),e.jsx("button",{onClick:()=>{y(),t&&m(t)},className:"btn primary",children:"נסה שוב"})]})]});const T=I();return e.jsxs("div",{className:"app-container",children:[e.jsx($n,{}),e.jsxs("main",{className:"main-content bagrut-details-page",children:[e.jsxs("div",{className:"bagrut-header",children:[e.jsxs("div",{className:"header-top",children:[e.jsx("button",{className:"back-btn",onClick:w,"aria-label":"חזרה",children:e.jsx(zs,{size:20})}),e.jsxs("div",{className:"bagrut-title-info",children:[e.jsxs("div",{className:"header-with-badge",children:[e.jsx("h1",{children:"בגרות בנגינה"}),(()=>{const E=A(),_=E.icon;return e.jsxs("div",{className:"status-badge",style:{backgroundColor:E.color},children:[e.jsx(_,{size:14}),e.jsx("span",{children:E.text})]})})()]}),e.jsx("div",{className:"bagrut-meta",children:u.conservatoryName&&e.jsx("span",{className:"conservatory-name",children:u.conservatoryName})})]})]}),e.jsxs("div",{className:"participants-info",children:[e.jsxs("div",{className:"participant-card",children:[e.jsx(Je,{size:16}),e.jsxs("div",{className:"participant-details",children:[e.jsx("div",{className:"participant-name",children:(S==null?void 0:S.personalInfo.fullName)||"תלמיד לא זמין"}),e.jsx("div",{className:"participant-role",children:"תלמיד"})]})]}),e.jsxs("div",{className:"participant-card",children:[e.jsx(mr,{size:16}),e.jsxs("div",{className:"participant-details",children:[e.jsx("div",{className:"participant-name",children:(C==null?void 0:C.personalInfo.fullName)||"מורה לא זמין"}),e.jsx("div",{className:"participant-role",children:"מורה מנחה"})]})]})]}),e.jsxs("div",{className:"progress-section",children:[e.jsx("div",{className:"progress-header",children:e.jsxs("span",{children:["התקדמות: ",T.completed,"/",T.total]})}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${T.percentage}%`}})})]}),u.finalGrade&&e.jsxs("div",{className:"final-grade-display",children:[e.jsx(Cs,{size:16}),e.jsxs("span",{children:["ציון סופי: ",u.finalGrade," (",u.finalGradeLevel,")"]})]})]}),e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${l==="program"?"active":""}`,onClick:()=>c("program"),children:[e.jsx(Ke,{size:16}),"תוכנית"]}),e.jsxs("button",{className:`tab-btn ${l==="grading"?"active":""}`,onClick:()=>c("grading"),children:[e.jsx(Cs,{size:16}),"ציונים"]}),e.jsxs("button",{className:`tab-btn ${l==="presentations"?"active":""}`,onClick:()=>c("presentations"),children:[e.jsx($e,{size:16}),"השמעות"]}),e.jsxs("button",{className:`tab-btn ${l==="documents"?"active":""}`,onClick:()=>c("documents"),children:[e.jsx(hu,{size:16}),"מסמכים"]})]}),e.jsxs("div",{className:"tab-content",children:[l==="presentations"&&e.jsx($R,{bagrut:u,canEdit:!!D,teachers:N}),l==="program"&&e.jsxs("div",{className:"program-tab-content",children:[e.jsx(RR,{bagrut:u,canEdit:!!D}),e.jsx(LR,{bagrut:u,canEdit:!!D})]}),l==="grading"&&e.jsx(MR,{bagrut:u,canEdit:!!D},`grading-${u._id}-${u.updatedAt}`),l==="documents"&&e.jsx(zR,{bagrut:u,canEdit:!!D})]}),!u.isCompleted&&D&&T.completed===T.total&&e.jsx(BR,{bagrut:u})]})]})}const cN=({teacherId:t,teacherName:s,onFullScreenView:n,compact:i=!1})=>{var oe,ce;const[l,c]=x.useState([]),[u,f]=x.useState(!0),[p,m]=x.useState(null),[y,v]=x.useState(0),[j,N]=x.useState(null),[b,w]=x.useState({}),[A,S]=x.useState(new Set),[C,D]=x.useState(null),[I,T]=x.useState(null),{currentTeacherSchedule:R,isLoading:E,loadTeacherSchedule:_}=kl(),k=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],z=x.useMemo(()=>{const pe=lt().tz("Asia/Jerusalem").startOf("week").add(y,"week");return k.map((me,je)=>({day:k[je],date:pe.add(je,"day"),dateString:pe.add(je,"day").format("YYYY-MM-DD"),displayDate:pe.add(je,"day").format("DD/MM")}))},[y]),M=x.useCallback(Q=>{const ne=z.find(pe=>pe.day===Q);return ne?ne.dateString:wn.formatForAPI(new Date)},[z]),G=x.useCallback(async Q=>{const ne=Q.filter(me=>me.scheduleSlotId);if(ne.length===0){console.log("No lessons with scheduleSlotId found for attendance loading");return}console.log(`Loading attendance for ${ne.length} lessons`);const pe=ne.map(me=>me.scheduleSlotId);S(me=>{const je=new Set(me);return pe.forEach(Oe=>je.add(Oe)),je});try{const me=pe.map(async Te=>{var Be,V;try{const ue=await dl.getLessonAttendance(Te);return{scheduleSlotId:Te,attendanceData:ue,success:!0}}catch(ue){return(Be=ue.message)!=null&&Be.includes("not found")||(V=ue.message)!=null&&V.includes("לא נמצא")?(console.log(`Schedule slot ${Te} not found in attendance system - this is expected for lessons not configured for attendance tracking`),{scheduleSlotId:Te,attendanceData:null,success:!1,notFound:!0}):(console.log(`Error loading attendance for lesson ${Te}:`,ue),{scheduleSlotId:Te,attendanceData:null,success:!1,notFound:!1})}}),je=await Promise.allSettled(me),Oe={};let De=0,be=0;je.forEach(Te=>{if(Te.status==="fulfilled"){const{scheduleSlotId:Be,attendanceData:V,success:ue,notFound:ve}=Te.value;ue&&V&&V.attendance?(Oe[Be]=V.attendance,De++):ve&&be++}}),w(Te=>({...Te,...Oe})),console.log(`Loaded attendance for ${De} lessons, ${be} lessons not found in attendance system`)}catch(me){console.error("Error loading attendance data:",me)}finally{S(me=>{const je=new Set(me);return pe.forEach(Oe=>je.delete(Oe)),je})}},[]),X=x.useCallback(async()=>{if(t)try{f(!0),m(null);const[Q,ne]=await Promise.allSettled([Jt.getTeacherLessons(t),_(t)]);let pe=null;Q.status==="fulfilled"&&(pe=Q.value);let me={};if(pe!=null&&pe.lessons&&Array.isArray(pe.lessons)&&(console.log("Processing lessons data:",pe.lessons),pe.lessons.forEach(De=>{var V;const be=De.day||De.dayOfWeek;if(!be)return;const Te=W(be);me[Te]||(me[Te]=[]);const Be={_id:De._id||`${De.studentId}-${De.time}`,time:De.time||De.startTime||De.lessonStartTime,studentName:De.studentName||"תלמיד לא ידוע",studentId:De.studentId,duration:De.duration||45,instrument:typeof De.instrument=="object"?((V=De.instrument)==null?void 0:V.instrumentName)||"":De.instrument||"",day:Te,endTime:De.endTime||De.lessonEndTime||te(De.time||De.startTime,De.duration||45),location:De.location,scheduleSlotId:De.scheduleSlotId};me[Te].push(Be)}),Object.keys(me).forEach(De=>{me[De].sort((be,Te)=>(be.time||"").localeCompare(Te.time||""))})),Object.keys(me).length===0)try{const De=await Jt.getTeacherWeeklySchedule(t);De!=null&&De.weeklySchedule&&(me=De.weeklySchedule)}catch(De){console.log("Weekly schedule API also failed:",De)}const je=k.map(De=>{const be=me[De]||[],Te=be.reduce((Be,V)=>Be+(V.duration||45),0);return{day:De,lessons:be,timeBlocks:[],totalDuration:Te,lessonCount:be.length}}).filter(De=>De.lessons.length>0);c(je),N(new Date),console.log(`Successfully loaded schedule for teacher ${t}: ${je.length} days with lessons`);const Oe=je.flatMap(De=>De.lessons);Oe.length>0&&(console.log("Loading attendance data for schedule lessons..."),await G(Oe))}catch(Q){console.error("Error fetching teacher schedule:",Q),m(Q.message||"שגיאה בטעינת לוח הזמנים")}finally{f(!1)}},[t,_,G]);x.useEffect(()=>{if(R!=null&&R.timeBlocks&&l.length>0){const Q=l.map(ne=>{const pe=R.timeBlocks.filter(me=>me.day===ne.day&&me.isActive);return{...ne,timeBlocks:pe}});c(Q)}},[R]),x.useEffect(()=>{X()},[X]);const W=Q=>({Sunday:"ראשון",Monday:"שני",Tuesday:"שלישי",Wednesday:"רביעי",Thursday:"חמישי",Friday:"שישי",Saturday:"שבת",sun:"ראשון",mon:"שני",tue:"שלישי",wed:"רביעי",thu:"חמישי",fri:"שישי",sat:"שבת",0:"ראשון",1:"שני",2:"שלישי",3:"רביעי",4:"חמישי",5:"שישי",6:"שבת"})[Q]||Q,te=(Q,ne)=>{if(!Q)return"";const[pe,me]=Q.split(":").map(Number),je=pe*60+me+ne,Oe=Math.floor(je/60),De=je%60;return`${Oe.toString().padStart(2,"0")}:${De.toString().padStart(2,"0")}`},L=Q=>{const ne=Math.floor(Q/60),pe=Q%60;return ne===0?`${pe}ד'`:pe===0?`${ne}ש'`:`${ne}ש' ${pe}ד'`},J=()=>{const Q=l.reduce((me,je)=>me+je.lessonCount,0),ne=l.reduce((me,je)=>me+je.totalDuration,0),pe=new Set;return l.forEach(me=>{me.lessons.forEach(je=>{je.studentId&&pe.add(je.studentId)})}),{totalLessons:Q,totalDuration:L(ne),totalStudents:pe.size,activeDays:l.length}},K=Q=>{v(ne=>Q==="next"?ne+1:ne-1)},le=Q=>{var ne;return Q&&((ne=b[Q])==null?void 0:ne.status)||null},O=Q=>{switch(Q){case"הגיע/ה":return e.jsx(Et,{size:16,className:"attendance-icon present"});case"לא הגיע/ה":return e.jsx(Ro,{size:16,className:"attendance-icon absent"});case"cancelled":return e.jsx(Nd,{size:16,className:"attendance-icon cancelled"});case"pending":return e.jsx(Nd,{size:16,className:"attendance-icon pending"});default:return e.jsx(Nd,{size:16,className:"attendance-icon not-marked"})}},U=Q=>{switch(Q){case"הגיע/ה":return"הגיע/ה";case"לא הגיע/ה":return"לא הגיע/ה";case"cancelled":return"בוטל";case"pending":return"ממתין";default:return""}},Y=Q=>{switch(Q){case"הגיע/ה":return"present";case"לא הגיע/ה":return"absent";case"cancelled":return"cancelled";case"pending":return"pending";default:return"not-marked"}},Z=x.useCallback(async(Q,ne,pe,me)=>{var je,Oe,De,be;if(!Q||!ne){console.error("Invalid parameters for marking attendance:",{scheduleSlotId:Q,status:ne}),D("פרמטרים לא תקינים לסימון נוכחות");return}S(Te=>new Set(Te).add(Q)),D(null),T(null);try{console.log(`Marking attendance for lesson ${Q} as ${ne} for week offset ${y}`);const Te=me?M(me):wn.formatForAPI(new Date);console.log(`Using lesson date: ${Te} for day: ${me}`);const Be={status:ne,notes:pe||"",lessonDate:Te},V=await dl.markAttendance(Q,{status:ne,notes:pe||""});w(ve=>({...ve,[Q]:{status:ne,notes:pe||""}})),console.log(`Successfully marked attendance for lesson ${Q}`);const ue=U(ne);T(`נוכחות סומנה כמו: ${ue}`),setTimeout(()=>{T(null)},3e3)}catch(Te){console.error(`Failed to mark attendance for lesson ${Q}:`,Te),(je=Te.message)!=null&&je.includes("not found")||(Oe=Te.message)!=null&&Oe.includes("לא נמצא")?D("שיעור זה עדיין לא קיים במערכת הנוכחות. יתכן שזה שיעור עתידי או שהוא טרם הוגדר למעקב נוכחות."):(De=Te.message)!=null&&De.includes("markedAt")||(be=Te.message)!=null&&be.includes("not allowed")?D("נתונים לא תקינים נשלחו לשרת"):D(`שגיאה בסימון נוכחות: ${Te.message||"שגיאה לא ידועה"}`)}finally{S(Te=>{const Be=new Set(Te);return Be.delete(Q),Be})}},[t,M]),H=x.useCallback((Q,ne)=>Z(Q,"הגיע/ה",void 0,ne),[Z]),P=x.useCallback((Q,ne)=>Z(Q,"לא הגיע/ה",void 0,ne),[Z]);x.useCallback((Q,ne,pe)=>Z(Q,"cancelled",ne,pe),[Z]);const q=x.useCallback(Q=>{w(ne=>{const pe={...ne};return delete pe[Q],pe})},[]),B=x.useCallback(async(Q,ne)=>{const pe=Q.lessons.filter(je=>je.scheduleSlotId);if(pe.length===0){console.log(`No lessons with valid schedule slot ID found for ${Q.day}`);return}console.log(`Bulk marking ${pe.length} lessons for ${Q.day} as ${ne}`);const me=pe.map(je=>Z(je.scheduleSlotId,ne,void 0,Q.day));try{await Promise.allSettled(me),console.log(`Completed bulk marking for ${Q.day}`)}catch(je){console.error(`Error in bulk marking for ${Q.day}:`,je)}},[Z]),se=x.useCallback(Q=>{const ne=Q.lessons.filter(Oe=>{const De=le(Oe.scheduleSlotId);return De&&De!=="pending"}),pe=Q.lessons.filter(Oe=>le(Oe.scheduleSlotId)==="הגיע/ה").length,me=Q.lessons.filter(Oe=>le(Oe.scheduleSlotId)==="לא הגיע/ה").length,je=Q.lessons.filter(Oe=>le(Oe.scheduleSlotId)==="cancelled").length;return{total:Q.lessons.length,marked:ne.length,present:pe,absent:me,cancelled:je,unmarked:Q.lessons.length-ne.length}},[le]);if(u||E)return e.jsxs("div",{className:"teacher-schedule-loading",children:[e.jsx(Yt,{className:"loading-icon",size:20}),e.jsx("span",{children:"טוען מערכת השעות השבועית..."})]});if(p)return e.jsxs("div",{className:"teacher-schedule-error",children:[e.jsx("div",{className:"error-message",children:p}),e.jsxs("button",{className:"retry-button",onClick:X,"aria-label":"נסה שוב",children:[e.jsx(Yt,{size:16}),"נסה שוב"]})]});if(l.length===0)return e.jsx("div",{className:"teacher-schedule-empty",children:e.jsxs("div",{className:"empty-message",children:[e.jsx($e,{size:32}),e.jsx("h4",{children:"אין שיעורים מתוכננים השבוע"}),e.jsxs("p",{children:["למורה ",s," אין שיעורים מוקצים כרגע"]}),e.jsxs("button",{className:"refresh-empty-btn",onClick:X,"aria-label":"רענן נתונים",children:[e.jsx(Yt,{size:16}),"רענן נתונים"]})]})});const ae=J();return i?e.jsxs("div",{className:"teacher-schedule-compact",children:[e.jsxs("div",{className:"schedule-header-compact",children:[e.jsxs("div",{className:"schedule-title",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת השעות השבועית"})]}),e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("span",{className:"stat",children:[ae.totalLessons," שיעורים"]}),e.jsxs("span",{className:"stat",children:[ae.totalStudents," תלמידים"]}),n&&e.jsx("button",{className:"full-screen-btn",onClick:n,title:"תצוגה מלאה",children:e.jsx(vm,{size:14})})]})]}),e.jsx("div",{className:"days-grid-compact",children:l.slice(0,4).map(Q=>e.jsxs("div",{className:"day-compact",children:[e.jsxs("div",{className:"day-header-compact",children:[e.jsx("span",{className:"day-name",children:Q.day}),e.jsxs("span",{className:"lesson-count",children:["(",Q.lessonCount,")"]})]}),e.jsxs("div",{className:"lessons-preview",children:[Q.lessons.slice(0,2).map((ne,pe)=>{const me=le(ne.scheduleSlotId);return ne.scheduleSlotId&&A.has(ne.scheduleSlotId),e.jsxs("div",{className:`lesson-compact ${me?`attendance-${Y(me)}`:""}`,children:[e.jsxs("div",{className:"lesson-time-compact",children:[ne.time," - ",ne.endTime,me&&e.jsx("span",{className:`attendance-indicator-compact ${Y(me)}`,children:O(me)})]}),e.jsx("div",{className:"lesson-student-compact",children:ne.studentName})]},ne._id||pe)}),Q.lessonCount>2&&e.jsxs("div",{className:"more-lessons-compact",children:["+",Q.lessonCount-2]})]})]},Q.day))}),l.length>4&&e.jsxs("div",{className:"more-days-indicator",children:["+",l.length-4," ימים נוספים"]})]}):e.jsxs("div",{className:"teacher-schedule-calendar",children:[e.jsxs("div",{className:"schedule-header",children:[e.jsxs("div",{className:"schedule-navigation",children:[e.jsx("button",{className:"nav-btn",onClick:()=>K("prev"),"aria-label":"שבוע קודם",children:e.jsx(Xm,{size:16})}),e.jsxs("div",{className:"current-week",children:[e.jsx($e,{size:16}),e.jsx("span",{children:"מערכת השעות השבועית"}),e.jsxs("div",{className:"week-date-range",children:[(oe=z[0])==null?void 0:oe.displayDate," - ",(ce=z[z.length-1])==null?void 0:ce.displayDate]}),y!==0&&e.jsxs("span",{className:"week-offset",children:["(",y>0?"+":"",y," שבועות)"]})]}),e.jsx("button",{className:"nav-btn",onClick:()=>K("next"),"aria-label":"שבוע הבא",children:e.jsx(y0,{size:16})})]}),e.jsxs("div",{className:"schedule-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:ae.totalDuration})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(Je,{size:14}),e.jsxs("span",{children:[ae.totalStudents," תלמידים"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx($e,{size:14}),e.jsxs("span",{children:[ae.activeDays," ימים"]})]}),n&&e.jsxs("button",{className:"full-screen-btn",onClick:n,title:"תצוגה במסך מלא",children:[e.jsx(xa,{size:16}),e.jsx(vm,{size:12})]})]})]}),C&&e.jsxs("div",{className:"attendance-notification error",children:[e.jsx(Ro,{size:16}),e.jsx("span",{children:C}),e.jsx("button",{className:"close-notification",onClick:()=>D(null),"aria-label":"סגור הודעה",children:"×"})]}),I&&e.jsxs("div",{className:"attendance-notification success",children:[e.jsx(Et,{size:16}),e.jsx("span",{children:I}),e.jsx("button",{className:"close-notification",onClick:()=>T(null),"aria-label":"סגור הודעה",children:"×"})]}),e.jsx("div",{className:"schedule-grid",children:l.map(Q=>{var pe;const ne=se(Q);return e.jsxs("div",{className:"day-schedule",children:[e.jsxs("div",{className:"day-header",children:[e.jsxs("div",{className:"day-info",children:[e.jsxs("div",{className:"day-title",children:[e.jsx("h4",{className:"day-name",children:Q.day}),e.jsx("span",{className:"day-date",children:(pe=z.find(me=>me.day===Q.day))==null?void 0:pe.displayDate})]}),e.jsxs("div",{className:"day-stats",children:[e.jsxs("span",{className:"lessons-count",children:[Q.lessonCount," שיעורים • ",L(Q.totalDuration)]}),ne.marked>0&&e.jsxs("span",{className:"attendance-stats",children:["נוכחות: ",ne.marked,"/",ne.total,ne.present>0&&e.jsxs("span",{className:"present-count",children:[" הגיעו: ",ne.present]}),ne.absent>0&&e.jsxs("span",{className:"absent-count",children:[" חסרו: ",ne.absent]})]})]})]}),e.jsxs("div",{className:"day-controls",children:[Q.timeBlocks.length>0&&e.jsxs("div",{className:"time-blocks-indicator",children:[e.jsx(gt,{size:12}),e.jsxs("span",{children:[Q.timeBlocks.length," בלוקים"]})]}),!i&&ne.unmarked>0&&e.jsxs("div",{className:"bulk-attendance-controls",children:[e.jsxs("button",{className:"bulk-btn bulk-present",onClick:()=>B(Q,"הגיע/ה"),title:"סמן הכל כהגיעו",children:[e.jsx(Et,{size:12}),"הכל"]}),e.jsxs("button",{className:"bulk-btn bulk-absent",onClick:()=>B(Q,"לא הגיע/ה"),title:"סמן הכל כחסרו",children:[e.jsx(Ro,{size:12}),"הכל"]})]})]})]}),e.jsxs("div",{className:"day-content",children:[Q.timeBlocks.length>0&&e.jsx("div",{className:"time-blocks-background",children:Q.timeBlocks.map(me=>e.jsxs("div",{className:"time-block-bg",title:`${me.startTime} - ${me.endTime}${me.location?` • ${me.location}`:""}`,children:[e.jsxs("div",{className:"block-time-range",children:[me.startTime," - ",me.endTime]}),me.location&&e.jsxs("div",{className:"block-location",children:[e.jsx(gt,{size:10}),me.location]}),e.jsx("div",{className:"utilization-bar",children:e.jsx("div",{className:"utilization-fill",style:{width:`${me.utilizationPercentage}%`}})})]},me._id))}),e.jsx("div",{className:"lessons-list",children:Q.lessons.map((me,je)=>{const Oe=le(me.scheduleSlotId),De=me.scheduleSlotId?A.has(me.scheduleSlotId):!1;return e.jsxs("div",{className:`lesson-item ${Oe?`attendance-${Y(Oe)}`:""}`,children:[e.jsxs("div",{className:"lesson-details",children:[e.jsx("div",{className:"lesson-student",children:e.jsx("span",{children:me.studentName})}),me.instrument&&e.jsx("div",{className:"lesson-instrument",children:e.jsx("span",{children:me.instrument||"כלי נגינה"})})]}),e.jsxs("div",{className:"lesson-header",children:[e.jsxs("div",{className:"lesson-time",children:[e.jsxs("span",{className:"main-time",children:[me.time," - ",me.endTime]}),e.jsxs("span",{className:"duration",children:["(",me.duration,"ד')"]})]}),me.location&&e.jsxs("div",{className:"lesson-location",children:[e.jsx(gt,{size:10}),e.jsx("span",{children:me.location})]})]}),me.scheduleSlotId&&e.jsx("div",{className:"lesson-attendance",children:!i&&e.jsxs("div",{className:"attendance-controls",children:[e.jsxs("div",{className:"attendance-toggle-wrapper",children:[e.jsxs("label",{className:"attendance-toggle-labels",children:[e.jsx("span",{className:"absent-label",children:"לא נוכח"}),e.jsx("span",{className:"present-label",children:"נוכח"})]}),e.jsxs("label",{className:`attendance-toggle-switch ${Oe&&Oe!=="not-marked"&&Oe!=="pending"?"has-attendance":""}`,children:[e.jsx("input",{type:"checkbox",checked:Oe==="הגיע/ה",onChange:be=>{De||(be.target.checked?H(me.scheduleSlotId,Q.day):P(me.scheduleSlotId,Q.day))},disabled:De}),e.jsx("span",{className:"attendance-toggle-slider",children:De&&e.jsx(Yt,{size:12,className:"toggle-loading"})})]})]}),Oe&&e.jsxs("button",{className:"attendance-clear-btn",onClick:()=>q(me.scheduleSlotId),disabled:De,title:"מחק סימון נוכחות",children:[e.jsx(Nd,{size:12}),e.jsx("span",{children:"מחק"})]})]})})]},me._id||je)})})]})]},Q.day)})}),j&&e.jsxs("div",{className:"schedule-footer",children:[e.jsxs("div",{className:"last-updated",children:["עודכן לאחרונה: ",j.toLocaleTimeString("he-IL")]}),e.jsxs("button",{className:"refresh-btn",onClick:X,"aria-label":"רענן נתונים",children:[e.jsx(Yt,{size:14}),"רענן"]})]})]})},UR=({isOpen:t,onClose:s,teacherId:n,teacherName:i})=>t?e.jsxs(Ua,{isOpen:t,onClose:s,className:"full-screen-schedule-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"header-info",children:[e.jsx($e,{size:24}),e.jsxs("h2",{children:["מערכת השעות המלאה - ",i]})]}),e.jsx("button",{className:"close-btn",onClick:s,"aria-label":"סגור",children:e.jsx(Nt,{size:24})})]}),e.jsx("div",{className:"modal-body",children:e.jsx(cN,{teacherId:n,teacherName:i,compact:!1})})]}):null;function PR(){var V,ue,ve,Ne,_e,Ie,Ue,It,qe,mt,$t,Pt,yt,xi,Sa;const{user:t}=ys(),[s,n]=p0(),i=_t(),l=cl(),[c,u]=x.useState(null),[f,p]=x.useState(!0),[m,y]=x.useState(null),[v,j]=x.useState(!1),[N,b]=x.useState(null),[w,A]=x.useState(!1),[S,C]=x.useState([]),[D,I]=x.useState([]),[T,R]=x.useState(!1),[E,_]=x.useState(!1),[k,z]=x.useState({students:!1,orchestras:!1,schedule:!1}),[M,G]=x.useState(!1),X=ke=>({מורה:"#4D55CC",מנצח:"#28A745","מדריך הרכב":"#FFC107",מנהל:"#DC3545","מורה תאוריה":"#6F42C1"})[ke]||"#6c757d",W=()=>{if(t){const ke={_id:t._id,personalInfo:{fullName:t.fullName||"",email:t.email||"",phone:t.phone||"",address:t.address||""},roles:t.roles||[],professionalInfo:t.professionalInfo?{instrument:t.professionalInfo.instrument||"",isActive:!0}:void 0,credentials:{email:t.email||""}};u(ke),b(ke)}},te=ke=>{var Le,Vt,Ct,dt;if(t){const ls={...t,fullName:((Le=ke.personalInfo)==null?void 0:Le.fullName)||t.fullName,email:((Vt=ke.personalInfo)==null?void 0:Vt.email)||t.email,phone:((Ct=ke.personalInfo)==null?void 0:Ct.phone)||t.phone,address:((dt=ke.personalInfo)==null?void 0:dt.address)||t.address,professionalInfo:ke.professionalInfo||t.professionalInfo};localStorage.setItem("user",JSON.stringify(ls)),l.user=ls}},[L,J]=x.useState(!1),[K,le]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[O,U]=x.useState({current:!1,new:!1,confirm:!1}),[Y,Z]=x.useState(!1),[H,P]=x.useState(null),[q,B]=x.useState(null),se=s.get("forcePasswordChange")==="true"||localStorage.getItem("requiresPasswordChange")==="true";x.useEffect(()=>{t&&(W(),Q())},[t]),x.useEffect(()=>{t&&(async()=>{const Le=s.get("forcePasswordChange")==="true",Vt=localStorage.getItem("requiresPasswordChange")==="true";if(Le||Vt)try{await Ls.validateSession()}catch(Ct){console.error("Auth validation failed:",Ct),i("/login")}})()},[t,s,i]),x.useEffect(()=>{c&&ae()&&ne()},[c]),x.useEffect(()=>{s.get("openSchedule")==="true"&&c&&(ae()||oe())&&(G(!0),s.delete("openSchedule"),n(s,{replace:!0}))},[c,s,n]);const ae=()=>{var ke;return((ke=c==null?void 0:c.roles)==null?void 0:ke.some(Le=>Le==="מורה"||Le==="מורה תאוריה"||Le==="מנצח"))||!1},oe=()=>{var ke;return((ke=c==null?void 0:c.roles)==null?void 0:ke.includes("מנצח"))||!1},ce=ke=>{z(Le=>({...Le,[ke]:!Le[ke]}))},Q=async()=>{var ke,Le,Vt,Ct;if(t)try{p(!0);const dt=await ye.get(`teachers/${t._id}`),ls={_id:dt._id||t._id,personalInfo:{fullName:((ke=dt.personalInfo)==null?void 0:ke.fullName)||t.fullName||"",email:((Le=dt.personalInfo)==null?void 0:Le.email)||t.email||"",phone:((Vt=dt.personalInfo)==null?void 0:Vt.phone)||t.phone||"",address:((Ct=dt.personalInfo)==null?void 0:Ct.address)||t.address||""},roles:dt.roles||t.roles||[],professionalInfo:dt.professionalInfo||(t.professionalInfo?{instrument:t.professionalInfo.instrument||"",isActive:!0}:void 0),credentials:dt.credentials||{email:t.email||""},createdAt:dt.createdAt,updatedAt:dt.updatedAt};u(ls),b(ls)}catch(dt){const ls=ts(dt);y(ls.userMessage),console.log("API failed, using user store data")}finally{p(!1)}},ne=async()=>{var ke;if(t!=null&&t._id)try{if(ae()){R(!0);try{const Vt=(await ot.getStudents()).filter(Ct=>{const dt=Ct.teacherIds&&Ct.teacherIds.includes(t._id),ls=Ct.teacherAssignments&&Ct.teacherAssignments.some(aa=>aa.teacherId===t._id);return dt||ls});C(Vt)}catch(Le){console.error("Failed to load students:",Le)}finally{R(!1)}}if(oe()&&((ke=c==null?void 0:c.conducting)!=null&&ke.orchestraIds)){_(!0);try{const Le=await Ia.getOrchestrasByIds(c.conducting.orchestraIds);I(Le)}catch(Le){console.error("Failed to load orchestras:",Le)}finally{_(!1)}}}catch(Le){console.error("Failed to load teacher data:",Le)}},pe=()=>{j(!0),b(c),y(null)},me=()=>{j(!1),b(c),y(null)},je=async()=>{if(!(!N||!c))try{A(!0);const ke={personalInfo:N.personalInfo,roles:N.roles,professionalInfo:N.professionalInfo,teaching:c.teaching||{studentIds:[],schedule:[]},credentials:{email:N.personalInfo.email}};console.log("Sending update data:",ke);const Le=await ye.put("teachers/profile/me",ke);u(Le.data),te(Le.data),j(!1),y(null)}catch(ke){const Le=ts(ke);y(Le.userMessage)}finally{A(!1)}},Oe=async ke=>{if(confirm("האם אתה בטוח שברצונך להסיר את התלמיד מהרשימה שלך?"))try{await ye.put("teachers/profile/me/remove-student",{studentId:ke}),await ne()}catch(Le){const Vt=ts(Le);y(Vt.userMessage)}},De=(ke,Le,Vt)=>{N&&b(Ct=>{if(!Ct)return Ct;const dt=Ct[ke];return typeof dt=="object"&&dt!==null?{...Ct,[ke]:{...dt,[Le]:Vt}}:Ct})},be=async ke=>{if(ke.preventDefault(),P(null),B(null),!K.currentPassword||!K.newPassword||!K.confirmPassword){P("יש למלא את כל השדות");return}if(K.newPassword!==K.confirmPassword){P("הסיסמאות החדשות אינן תואמות");return}if(K.newPassword.length<6){P("הסיסמה החדשה חייבת להכיל לפחות 6 תווים");return}if(K.currentPassword===K.newPassword){P("הסיסמה החדשה חייבת להיות שונה מהסיסמה הנוכחית");return}try{Z(!0);const Le=await np.changePassword({currentPassword:K.currentPassword,newPassword:K.newPassword});Le.accessToken&&(Ls.setToken(Le.accessToken),console.log("Updated access token after password change")),Le.refreshToken&&(localStorage.setItem("refreshToken",Le.refreshToken),console.log("Updated refresh token after password change")),B("הסיסמה שונתה בהצלחה!"),le({currentPassword:"",newPassword:"",confirmPassword:""}),J(!1),localStorage.removeItem("requiresPasswordChange"),s.get("forcePasswordChange")&&(s.delete("forcePasswordChange"),n(s)),setTimeout(()=>{B(null)},3e3)}catch(Le){const Vt=ts(Le);P(Vt.userMessage)}finally{Z(!1)}},Te=ke=>{U(Le=>({...Le,[ke]:!Le[ke]}))},Be=async()=>{try{const ke=localStorage.getItem("requiresPasswordChange"),Le=s.get("forcePasswordChange")==="true";(ke==="true"||Le)&&(localStorage.removeItem("requiresPasswordChange"),Le&&(s.delete("forcePasswordChange"),n(s)),await Ls.validateSession()),i("/")}catch(ke){console.error("Navigation error:",ke),i("/login")}};return f?e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"טוען פרופיל..."})]})}):!c&&!f?e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"error-container",children:[e.jsx("p",{children:"שגיאה בטעינת הפרופיל"}),e.jsx("button",{onClick:Q,className:"retry-btn",children:"נסה שוב"})]})}):c?e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("button",{onClick:Be,className:"close-btn","aria-label":"חזרה לעמוד הקודם",children:e.jsx(zs,{size:18})}),e.jsx("div",{className:"header-content",children:((V=c==null?void 0:c.personalInfo)==null?void 0:V.fullName)&&e.jsx("h1",{className:"user-name",children:c.personalInfo.fullName})}),e.jsx("div",{className:"header-actions",children:v?e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{onClick:je,disabled:w,className:"btn btn-primary",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tc,{size:20}),"שמירה"]})}),e.jsxs("button",{onClick:me,disabled:w,className:"btn btn-secondary",children:[e.jsx(Nt,{size:20}),"ביטול"]})]}):e.jsxs("button",{onClick:pe,className:"btn btn-primary",children:[e.jsx(Fo,{size:20}),"עריכה"]})})]}),m&&e.jsx("div",{className:"error-message",children:m}),q&&e.jsx("div",{className:"success-message",children:q}),e.jsxs("div",{className:"profile-content",children:[e.jsxs("div",{className:"main-section",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(Je,{size:20}),e.jsx("h2",{children:"פרטים אישיים"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"fullName",children:[e.jsx(Je,{size:16}),"שם מלא"]}),e.jsx("input",{type:"text",id:"fullName",value:v?((ue=N==null?void 0:N.personalInfo)==null?void 0:ue.fullName)||"":((ve=c==null?void 0:c.personalInfo)==null?void 0:ve.fullName)||"",onChange:ke=>De("personalInfo","fullName",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן שם מלא"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:[e.jsx(On,{size:16}),"כתובת אימייל"]}),e.jsx("input",{type:"email",id:"email",value:v?((Ne=N==null?void 0:N.personalInfo)==null?void 0:Ne.email)||"":((_e=c==null?void 0:c.personalInfo)==null?void 0:_e.email)||"",onChange:ke=>De("personalInfo","email",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כתובת אימייל"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"phone",children:[e.jsx(fi,{size:16}),"טלפון"]}),e.jsx("input",{type:"tel",id:"phone",value:v?((Ie=N==null?void 0:N.personalInfo)==null?void 0:Ie.phone)||"":((Ue=c==null?void 0:c.personalInfo)==null?void 0:Ue.phone)||"",onChange:ke=>De("personalInfo","phone",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן מספר טלפון"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"address",children:[e.jsx(gt,{size:16}),"כתובת"]}),e.jsx("input",{type:"text",id:"address",value:v?((It=N==null?void 0:N.personalInfo)==null?void 0:It.address)||"":((qe=c==null?void 0:c.personalInfo)==null?void 0:qe.address)||"",onChange:ke=>De("personalInfo","address",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כתובת"})]})]})})]}),c.professionalInfo&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(Ke,{size:20}),e.jsx("h2",{children:"מידע מקצועי"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"instrument",children:[e.jsx(Ke,{size:16}),"כלי נגינה"]}),e.jsx("input",{type:"text",id:"instrument",value:v?((mt=N==null?void 0:N.professionalInfo)==null?void 0:mt.instrument)||"":(($t=c==null?void 0:c.professionalInfo)==null?void 0:$t.instrument)||"",onChange:ke=>De("professionalInfo","instrument",ke.target.value),disabled:!v,className:"form-input",placeholder:"הזן כלי נגינה"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"סטטוס פעילות"}),e.jsx("div",{className:"status-badge",children:c.professionalInfo.isActive?"פעיל":"לא פעיל"})]})]})})]}),ae()&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${k.students?"active":""}`,onClick:()=>ce("students"),children:[e.jsx(ms,{size:20}),e.jsxs("h2",{children:["התלמידים שלי (",S.length,")"]}),k.students?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),k.students&&e.jsx("div",{className:"card-body",children:T?e.jsxs("div",{className:"loading-section",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"טוען תלמידים..."})]}):S.length>0?e.jsx("div",{className:"students-grid-enhanced",children:S.map(ke=>{var Vt,Ct,dt,ls,aa;const Le=(Vt=ke.teacherAssignments)==null?void 0:Vt.find(tn=>tn.teacherId===(t==null?void 0:t._id)&&tn.isActive!==!1);return e.jsxs("div",{className:"student-card-enhanced",children:[e.jsxs("div",{className:"student-main-info",children:[e.jsx("div",{className:"student-avatar",children:((dt=(Ct=ke.personalInfo)==null?void 0:Ct.fullName)==null?void 0:dt.charAt(0))||"ת"}),e.jsxs("div",{className:"student-details",children:[e.jsx("h4",{className:"student-name",children:((ls=ke.personalInfo)==null?void 0:ls.fullName)||"תלמיד לא ידוע"}),e.jsxs("div",{className:"student-lesson-info",children:[Le&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"lesson-time",children:[Le.time," - ",(()=>{const[tn,Tr]=Le.time.split(":").map(Number),dc=tn*60+Tr+(Le.duration||45),uc=Math.floor(dc/60),hc=dc%60;return`${uc.toString().padStart(2,"0")}:${hc.toString().padStart(2,"0")}`})()]}),e.jsxs("span",{className:"lesson-duration",children:["(",Le.duration||45,"ד')"]}),e.jsx("span",{className:"day-info",children:Le.day})]}),((aa=ke.academicInfo)==null?void 0:aa.instrument)&&e.jsx("span",{className:"instrument-info",children:ke.academicInfo.instrument||"כלי נגינה"})]})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>window.open(`/students/${ke._id}`,"_blank"),title:"ערוך תלמיד",children:e.jsx(Fo,{size:12})}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>Oe(ke._id),title:"הסר מהרשימה",children:e.jsx(Nt,{size:12})})]})]},ke._id)})}):e.jsxs("div",{className:"no-data",children:[e.jsx(ms,{size:32}),e.jsx("p",{children:"אין תלמידים מוקצים"})]})})]}),oe()&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${k.orchestras?"active":""}`,onClick:()=>ce("orchestras"),children:[e.jsx(Ke,{size:20}),e.jsxs("h2",{children:["התזמורות שלי (",D.length,")"]}),k.orchestras?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),k.orchestras&&e.jsx("div",{className:"card-body",children:E?e.jsxs("div",{className:"loading-section",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"טוען תזמורות..."})]}):D.length>0?e.jsx("div",{className:"orchestras-grid",children:D.map(ke=>e.jsx("div",{className:"orchestra-card",children:e.jsxs("div",{className:"orchestra-info",children:[e.jsx("div",{className:"orchestra-name",children:ke.name}),ke.location&&e.jsxs("div",{className:"orchestra-location",children:[e.jsx(gt,{size:12}),ke.location]})]})},ke._id))}):e.jsxs("div",{className:"no-data",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"אין תזמורות מוקצות"})]})})]}),(ae()||oe())&&c&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`card-header clickable ${k.schedule?"active":""}`,onClick:()=>ce("schedule"),children:[e.jsx($e,{size:20}),e.jsx("h2",{children:"מערכת השעות השבועית"}),k.schedule?e.jsx(Bt,{size:18,className:"toggle-icon"}):e.jsx(bt,{size:18,className:"toggle-icon"})]}),k.schedule&&e.jsx("div",{className:"card-body",children:e.jsx(cN,{teacherId:(t==null?void 0:t._id)||"",teacherName:((Pt=c==null?void 0:c.personalInfo)==null?void 0:Pt.fullName)||"מורה",compact:!0,onFullScreenView:()=>G(!0)})})]})]})]}),e.jsxs("div",{className:"sidebar-section",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(v0,{size:20}),e.jsx("h2",{children:"מידע חשבון"})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-grid single-column",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"תפקידים"}),e.jsx("div",{className:"roles-container",children:((yt=c.roles)==null?void 0:yt.map((ke,Le)=>e.jsx("span",{className:"role-badge",style:{backgroundColor:X(ke)},children:ke},Le)))||e.jsx("span",{className:"role-badge",children:"לא זמין"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16}),"התחברות אחרונה"]}),e.jsx("input",{type:"text",value:(xi=c.credentials)!=null&&xi.lastLogin?new Date(c.credentials.lastLogin).toLocaleDateString("he-IL"):"לא זמין",disabled:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx($e,{size:16}),"תאריך יצירה"]}),e.jsx("input",{type:"text",value:c.createdAt?new Date(c.createdAt).toLocaleDateString("he-IL"):"לא זמין",disabled:!0,className:"form-input"})]})]})})]}),se&&e.jsx("div",{className:"card",style:{borderColor:"#ff6b6b",backgroundColor:"#fff5f5"},children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#d63031"},children:[e.jsx(fr,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:"#d63031"},children:"שינוי סיסמה נדרש"}),e.jsx("p",{style:{margin:"8px 0 0 0",color:"#636e72"},children:"עליך לשנות את הסיסמה שלך לפני שתוכל להמשיך להשתמש במערכת"})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(fr,{size:24}),e.jsx("h2",{children:"שינוי סיסמה"}),e.jsx("button",{onClick:()=>J(!L),className:"btn btn-outline",style:se?{display:"none"}:{},children:L?"ביטול":"שינוי סיסמה"})]}),(L||se)&&e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:be,children:[H&&e.jsx("div",{className:"error-message",children:H}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentPassword",children:"סיסמה נוכחית"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.current?"text":"password",id:"currentPassword",value:K.currentPassword,onChange:ke=>le(Le=>({...Le,currentPassword:ke.target.value})),className:"form-input",required:!0}),e.jsx("button",{type:"button",onClick:()=>Te("current"),className:"password-toggle",children:O.current?e.jsx(si,{size:20}):e.jsx(xa,{size:20})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"סיסמה חדשה"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.new?"text":"password",id:"newPassword",value:K.newPassword,onChange:ke=>le(Le=>({...Le,newPassword:ke.target.value})),className:"form-input",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>Te("new"),className:"password-toggle",children:O.new?e.jsx(si,{size:20}):e.jsx(xa,{size:20})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"אישור סיסמה חדשה"}),e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:O.confirm?"text":"password",id:"confirmPassword",value:K.confirmPassword,onChange:ke=>le(Le=>({...Le,confirmPassword:ke.target.value})),className:"form-input",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>Te("confirm"),className:"password-toggle",children:O.confirm?e.jsx(si,{size:20}):e.jsx(xa,{size:20})})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",disabled:Y,className:"btn btn-primary",children:Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"משנה סיסמה..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fr,{size:20}),"שינוי סיסמה"]})})})]})})]})]})]}),(ae()||oe())&&c&&e.jsx(UR,{isOpen:M,onClose:()=>G(!1),teacherId:(t==null?void 0:t._id)||"",teacherName:((Sa=c==null?void 0:c.personalInfo)==null?void 0:Sa.fullName)||"Teacher"})]}):e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"טוען פרופיל..."})]})})}function qR(){const{token:t}=jr(),s=_t(),[n,i]=x.useState(""),[l,c]=x.useState(""),[u,f]=x.useState(!1),[p,m]=x.useState(!1),[y,v]=x.useState(!1),[j,N]=x.useState(null),[b,w]=x.useState(!1);x.useEffect(()=>{t||s("/login")},[t,s]);const A=async D=>{if(D.preventDefault(),N(null),!n||!l){N("יש למלא את כל השדות");return}if(n!==l){N("הסיסמאות אינן תואמות");return}if(n.length<6){N("הסיסמה חייבת להכיל לפחות 6 תווים");return}if(!t){N("טוקן לא תקין");return}try{v(!0),await np.resetPassword({token:t,newPassword:n}),w(!0),setTimeout(()=>{s("/login")},3e3)}catch(I){const T=ts(I);N(T.userMessage)}finally{v(!1)}},S=()=>{f(!u)},C=()=>{m(!p)};return b?e.jsx("div",{className:"reset-password-page",children:e.jsx("div",{className:"reset-password-form",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:e.jsx(Bo,{size:48})}),e.jsx("h1",{children:"הסיסמה שונתה בהצלחה!"}),e.jsx("p",{children:"הסיסמה שלך עודכנה בהצלחה. אתה מועבר לדף ההתחברות..."}),e.jsx("div",{className:"spinner"})]})})}):e.jsx("div",{className:"reset-password-page",children:e.jsxs("div",{className:"reset-password-form",children:[e.jsx("h1",{children:"איפוס סיסמה"}),e.jsx("p",{className:"reset-description",children:"הזן את הסיסמה החדשה שלך"}),j&&e.jsx("div",{className:"error-message",children:j}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:u?"text":"password",id:"password",className:n?"has-value":"",placeholder:"",required:!0,value:n,onChange:D=>i(D.target.value),minLength:6}),e.jsx("label",{htmlFor:"password",children:"סיסמה חדשה"}),e.jsx(fr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:S,children:u?e.jsx(si,{size:20}):e.jsx(xa,{size:20})})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:p?"text":"password",id:"confirmPassword",className:l?"has-value":"",placeholder:"",required:!0,value:l,onChange:D=>c(D.target.value),minLength:6}),e.jsx("label",{htmlFor:"confirmPassword",children:"אישור סיסמה"}),e.jsx(fr,{className:"input-icon"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:C,children:p?e.jsx(si,{size:20}):e.jsx(xa,{size:20})})]}),e.jsx("button",{type:"submit",className:"btn",disabled:y,children:y?"מאפס סיסמה...":"איפוס סיסמה"})]}),e.jsx("div",{className:"back-to-login",children:e.jsx("button",{type:"button",onClick:()=>s("/login"),className:"back-link",children:"חזרה להתחברות"})})]})})}function HR(){var j;const[t,s]=x.useState(!1),[n,i]=x.useState(!1),[l,c]=x.useState(null),[u,f]=x.useState(null),p="688136c194c6cd56db965db9",m=async(N,b)=>{const w=await fetch(`/api/${N}`,{headers:{"Content-Type":"application/json",...b==null?void 0:b.headers},...b});if(!w.ok)throw new Error(`API call failed: ${w.status} ${w.statusText}`);return w.json()},y=async()=>{var N,b,w;s(!0),c(null),f(null);try{console.log("🔍 Starting investigation..."),console.log("📖 Loading teacher...");const A=await m(`teacher/${p}`);console.log("Teacher loaded:",(N=A.personalInfo)==null?void 0:N.fullName),console.log("👥 Loading all students...");const S=await m("student");console.log(`Total students in database: ${S.length}`);const C=S.filter(R=>{const E=R.teacherIds&&R.teacherIds.includes(p),_=R.teacherAssignments&&R.teacherAssignments.some(k=>k.teacherId===p);return E||_});console.log(`✅ Found ${C.length} students with this teacher`);const D=((b=A.teaching)==null?void 0:b.studentIds)||[],I=((w=A.teaching)==null?void 0:w.schedule)||[],T={teacher:A,allStudents:S.length,studentsWithTeacher:C,currentStudentIds:D,scheduleEntries:I,needsFix:JSON.stringify(D.sort())!==JSON.stringify(C.map(R=>R._id).sort())};c(T),console.log("Investigation complete:",T)}catch(A){console.error("❌ Investigation failed:",A),c({error:A instanceof Error?A.message:"Unknown error"})}finally{s(!1)}},v=async()=>{var N,b,w,A,S,C,D;if(!(!l||!l.needsFix)){i(!0);try{const{teacher:I,studentsWithTeacher:T}=l,R=T.map(z=>z._id);console.log("🔧 Executing fix..."),console.log("Current studentIds:",((N=I.teaching)==null?void 0:N.studentIds)||[]),console.log("New studentIds:",R);const E={...I.teaching,studentIds:R};(b=I.teaching)!=null&&b.schedule&&(E.schedule=I.teaching.schedule.filter(z=>R.includes(z.studentId)));const _={_id:p,teaching:E};console.log("Update payload:",_);const k=await m(`teacher/${p}`,{method:"PUT",body:JSON.stringify(_)});console.log("✅ Teacher updated successfully!"),f({success:!0,teacherName:((w=I.personalInfo)==null?void 0:w.fullName)||"Unknown",studentsFound:T.length,previousCount:((S=(A=I.teaching)==null?void 0:A.studentIds)==null?void 0:S.length)||0,newCount:R.length,studentDetails:T.map(z=>{var M,G;return{id:z._id,name:(M=z.personalInfo)==null?void 0:M.fullName,instrument:(G=z.academicInfo)==null?void 0:G.instrument}})}),c(null)}catch(I){console.error("❌ Fix failed:",I),f({success:!1,teacherName:((D=(C=l.teacher)==null?void 0:C.personalInfo)==null?void 0:D.fullName)||"Unknown",studentsFound:0,previousCount:0,newCount:0,error:I instanceof Error?I.message:"Unknown error"})}finally{i(!1)}}};return e.jsxs("div",{style:{padding:"2rem",maxWidth:"900px",margin:"0 auto",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#f8f9fa",minHeight:"100vh"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white",padding:"2rem",borderRadius:"12px",marginBottom:"2rem",boxShadow:"0 4px 20px rgba(220, 53, 69, 0.3)"},children:[e.jsxs("h1",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(DT,{size:32}),"Direct Teacher-Student Sync Fix"]}),e.jsxs("p",{style:{margin:0,opacity:.9,fontSize:"1.1rem"},children:[e.jsx("strong",{children:"Issue:"}),` Teacher "מאיה איצקוביץ'" shows 4 students in UI but has empty studentIds in database`]})]}),e.jsxs("div",{style:{background:"#fff3cd",border:"2px solid #ffeaa7",padding:"1.5rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1rem"},children:[e.jsx(oi,{size:24,color:"#856404"}),e.jsx("strong",{style:{color:"#856404",fontSize:"1.2rem"},children:"Data Inconsistency Detected"})]}),e.jsxs("div",{style:{color:"#856404",lineHeight:1.6},children:[e.jsxs("p",{style:{margin:"0 0 0.5rem 0"},children:[e.jsx("strong",{children:"Root Cause:"})," Students have teacher assignments but teacher's studentIds array is empty"]}),e.jsxs("p",{style:{margin:"0 0 0.5rem 0"},children:[e.jsx("strong",{children:"Symptom:"})," TeacherDetails.tsx uses fallback logic to show students from reverse lookup"]}),e.jsxs("p",{style:{margin:0},children:[e.jsx("strong",{children:"Solution:"})," Synchronize teacher's studentIds with actual student assignments"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",flexWrap:"wrap"},children:[e.jsxs("button",{onClick:y,disabled:t,style:{padding:"1rem 2rem",background:t?"#6c757d":"#007bff",color:"white",border:"none",borderRadius:"8px",cursor:t?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.1rem",fontWeight:"600",boxShadow:"0 2px 10px rgba(0, 123, 255, 0.3)",transition:"all 0.3s ease"},children:[t?e.jsx(Yt,{size:20,className:"spin"}):e.jsx(xa,{size:20}),t?"Investigating...":"Investigate Issue"]}),l&&l.needsFix&&e.jsxs("button",{onClick:v,disabled:n,style:{padding:"1rem 2rem",background:n?"#6c757d":"#28a745",color:"white",border:"none",borderRadius:"8px",cursor:n?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.1rem",fontWeight:"600",boxShadow:"0 2px 10px rgba(40, 167, 69, 0.3)",transition:"all 0.3s ease"},children:[n?e.jsx(Yt,{size:20,className:"spin"}):e.jsx(Et,{size:20}),n?"Executing Fix...":"Execute Fix"]})]}),l&&!l.error&&e.jsxs("div",{style:{background:"white",border:"2px solid #dee2e6",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:"0 2px 15px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",color:"#495057",fontSize:"1.5rem"},children:"🔍 Investigation Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Teacher:"}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"1.1rem",color:"#495057"},children:(j=l.teacher.personalInfo)==null?void 0:j.fullName})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Current studentIds:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.3rem",color:"#dc3545"},children:[l.currentStudentIds.length," students"]})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Students found with teacher:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.3rem",color:"#28a745"},children:[l.studentsWithTeacher.length," students"]})]}),e.jsxs("div",{style:{padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("strong",{style:{color:"#6c757d"},children:"Schedule entries:"}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.1rem",color:"#495057"},children:[l.scheduleEntries.length," entries"]})]})]}),l.needsFix?e.jsxs("div",{style:{background:"#f8d7da",border:"2px solid #f5c6cb",color:"#721c24",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx("strong",{style:{fontSize:"1.2rem"},children:"⚠️ Fix Required"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0"},children:["studentIds array needs ",l.studentsWithTeacher.length," student IDs but currently has ",l.currentStudentIds.length,"."]})]}):e.jsxs("div",{style:{background:"#d4edda",border:"2px solid #c3e6cb",color:"#155724",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx("strong",{style:{fontSize:"1.2rem"},children:"✅ No Fix Needed"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0"},children:"Data is already synchronized."})]}),l.studentsWithTeacher.length>0&&e.jsxs("div",{children:[e.jsxs("strong",{style:{fontSize:"1.2rem",color:"#495057"},children:["Students with this teacher (",l.studentsWithTeacher.length,"):"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem",marginTop:"1rem"},children:l.studentsWithTeacher.map(N=>{var b,w;return e.jsxs("div",{style:{padding:"1rem",background:"#e9ecef",borderRadius:"8px",border:"1px solid #ced4da"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:(b=N.personalInfo)==null?void 0:b.fullName}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6c757d"},children:["ID: ",N._id]}),((w=N.academicInfo)==null?void 0:w.instrument)&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6c757d"},children:["Instrument: ",N.academicInfo.instrument]})]},N._id)})})]})]}),u&&e.jsxs("div",{style:{background:u.success?"#d4edda":"#f8d7da",border:`2px solid ${u.success?"#c3e6cb":"#f5c6cb"}`,color:u.success?"#155724":"#721c24",borderRadius:"12px",padding:"2rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsx(Et,{size:32}),e.jsx("h3",{style:{margin:0,fontSize:"1.5rem"},children:u.success?"✅ Fix Completed Successfully!":"❌ Fix Failed"})]}),u.success?e.jsxs("div",{style:{lineHeight:1.6},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Teacher:"})," ",u.teacherName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Students synchronized:"})," ",u.newCount," (was ",u.previousCount,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Students found:"})," ",u.studentsFound]}),u.studentDetails&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("strong",{children:"Added to studentIds:"}),e.jsx("ul",{style:{marginTop:"0.5rem"},children:u.studentDetails.map(N=>e.jsxs("li",{children:[N.name," - ",N.instrument," (",N.id,")"]},N.id))})]}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(255, 255, 255, 0.3)",borderRadius:"8px"},children:[e.jsx("strong",{children:"🎉 Success!"})," The teacher's studentIds array has been synchronized with student assignments!",e.jsx("br",{}),"The teacher form and details page will now show consistent data."]})]}):e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",u.error]}),e.jsx("p",{children:"Please check the browser console for more details and try again."})]})]}),l&&l.error&&e.jsxs("div",{style:{background:"#f8d7da",border:"2px solid #f5c6cb",color:"#721c24",borderRadius:"12px",padding:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.5rem"},children:"❌ Investigation Failed"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",l.error]}),e.jsx("p",{children:"Please check the browser console for more details."})]}),e.jsx("style",{children:`
        .spin {
          animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}const YR=new ZE({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});function VR(){const t=cl(l=>l.isAuthenticated),s=cl(l=>l.isLoading),n=cl(l=>l.isInitialized),i=Ds(l=>l.loadBasicTeacherData);return x.useEffect(()=>{t&&i()},[t,i]),!n||s?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px"},children:"Validating session..."}):t?e.jsx(wl,{}):e.jsx(Jd,{to:"/login",replace:!0})}function GR(){const t=cl(s=>s.initialize);return x.useEffect(()=>{t()},[t]),e.jsx(KE,{client:YR,children:e.jsx(gC,{children:e.jsx(TC,{position:"bottom-left",children:e.jsx(Vw,{children:e.jsxs(Nw,{children:[e.jsx(ut,{path:"/login",element:e.jsx(pC,{})}),e.jsx(ut,{path:"/reset-password/:token",element:e.jsx(qR,{})}),e.jsx(ut,{path:"/accept-invitation/:token",element:e.jsx(EC,{})}),e.jsx(ut,{path:"/event-registration",element:e.jsx(kC,{})}),e.jsx(ut,{path:"/toast-test",element:e.jsx(_C,{})}),e.jsx(ut,{path:"/debug-sync",element:e.jsx(HR,{})}),e.jsxs(ut,{element:e.jsx(VR,{}),children:[e.jsx(ut,{path:"/dashboard",element:e.jsx(HC,{})}),e.jsx(ut,{path:"/profile",element:e.jsx(PR,{})}),e.jsxs(ut,{path:"/students",element:e.jsx(i$,{}),children:[e.jsx(ut,{path:":studentId",element:e.jsx(kj,{})}),e.jsx(ut,{path:"new",element:e.jsx(kj,{})})]}),e.jsxs(ut,{path:"/teachers",element:e.jsx(k$,{}),children:[e.jsx(ut,{path:":teacherId",element:e.jsx($j,{})}),e.jsx(ut,{path:"new",element:e.jsx($j,{})})]}),e.jsxs(ut,{path:"/orchestras",element:e.jsx(L$,{}),children:[e.jsx(ut,{path:":orchestraId",element:e.jsx(Rj,{})}),e.jsx(ut,{path:"new",element:e.jsx(Rj,{})})]}),e.jsxs(ut,{path:"/rehearsals",element:e.jsx(G$,{}),children:[e.jsx(ut,{path:":rehearsalId",element:e.jsx(Mj,{})}),e.jsx(ut,{path:"new",element:e.jsx(Mj,{})})]}),e.jsx(ut,{path:"/theory",element:e.jsx(AR,{})}),e.jsx(ut,{path:"/theory/:theoryLessonId",element:e.jsx(Hj,{})}),e.jsx(ut,{path:"/theory/new",element:e.jsx(Hj,{})}),e.jsx(ut,{path:"/bagrut",element:e.jsx(IR,{})}),e.jsx(ut,{path:"/bagrut/:bagrutId",element:e.jsx(FR,{})}),e.jsx(ut,{path:"/",element:e.jsx(Jd,{to:"/theory",replace:!0})}),e.jsx(ut,{path:"*",element:e.jsx(Jd,{to:"/theory",replace:!0})})]})]})})})})})}k1.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(GR,{})}))});export default QR();
