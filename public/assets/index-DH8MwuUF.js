const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/Dashboard-CWC_hNKO.js","chunks/vendor-C9PcmKF2.js","chunks/StatsCard-nOBJ5jx9.js","chunks/utils-x1PSU_OZ.js","chunks/Card-DzHgWdxq.js","chunks/cascade-deletion-BN1czp3B.js","chunks/query-BdHdBeoH.js","chunks/ui-DsxFGtGk.js","chunks/teacherDetailsApi-C45WQoYF.js","chunks/Students-BPYz6WTN.js","chunks/Table-CcRqXqcx.js","chunks/StudentDetailsPageSimple-BgBP7wnH.js","chunks/TeacherNameDisplay-C-geMtTn.js","chunks/apiCache-4dMSe0Xr.js","chunks/theoryEnrollmentService-DeK6xBY-.js","chunks/Teachers-CKkffC9S.js","chunks/TheoryLessons-6Lkt5j7v.js","chunks/TheoryLessonDetails-X0GiTMeF.js","chunks/Orchestras-pM5foHdg.js","chunks/Rehearsals-DCmrHRq4.js","chunks/RehearsalDetails-DvqE13j6.js","chunks/Bagruts-Bh5A7FOn.js","chunks/useBagrut-DbzChtzv.js","chunks/BagrutDetails-Dtve08lV.js","chunks/Profile-C1JCy16m.js","chunks/RehearsalAttendance-B-tpTbpZ.js","chunks/OrchestraEnrollmentManager-CWAcbxpp.js","chunks/TeacherDetailsPage-DUO63Bow.js","chunks/OrchestraDetailsPage-DVhqJJgY.js"])))=>i.map(i=>d[i]);
var Cs=Object.defineProperty;var Es=(t,s,r)=>s in t?Cs(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var ct=(t,s,r)=>Es(t,typeof s!="symbol"?s+"":s,r);import{r as d,a as Ds,u as _s,b as tt,L as Ee,c as As,d as Os,e as q,N as Qe,R as Ke,B as Rs}from"../chunks/vendor-C9PcmKF2.js";import{a as Z,t as $s,s as Ps,o as Ls,b as Wt,_ as re,e as Fs}from"../chunks/cascade-deletion-BN1czp3B.js";import{Q as qt,c as Xt}from"../chunks/query-BdHdBeoH.js";import{X as je,A as gt,a as de,U as ve,C as Oe,b as ge,B as Ye,M as st,T as xt,P as Re,c as le,d as Ve,S as Gt,F as At,e as xe,f as He,g as fe,h as Nt,i as ft,j as Bs,R as Ms,k as Ot,l as Us,m as dt,n as Vs,H as ze,G as Qt,o as wt,p as rt,q as Kt,r as Hs,s as Rt,t as $t,u as Ys,L as zs}from"../chunks/ui-DsxFGtGk.js";import"../chunks/utils-x1PSU_OZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();var Jt={exports:{}},at={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ws=d,qs=Symbol.for("react.element"),Xs=Symbol.for("react.fragment"),Gs=Object.prototype.hasOwnProperty,Qs=Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ks={key:!0,ref:!0,__self:!0,__source:!0};function Zt(t,s,r){var i,a={},n=null,l=null;r!==void 0&&(n=""+r),s.key!==void 0&&(n=""+s.key),s.ref!==void 0&&(l=s.ref);for(i in s)Gs.call(s,i)&&!Ks.hasOwnProperty(i)&&(a[i]=s[i]);if(t&&t.defaultProps)for(i in s=t.defaultProps,s)a[i]===void 0&&(a[i]=s[i]);return{$$typeof:qs,type:t,key:n,ref:l,props:a,_owner:Qs.current}}at.Fragment=Xs;at.jsx=Zt;at.jsxs=Zt;Jt.exports=at;var e=Jt.exports,pt={},Pt=Ds;pt.createRoot=Pt.createRoot,pt.hydrateRoot=Pt.hydrateRoot;const es=d.createContext(null),$e=()=>{const t=d.useContext(es);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},Js=({children:t})=>{const[s,r]=d.useState(!1),[i,a]=d.useState(!0),[n,l]=d.useState(null),[g,m]=d.useState(null),[u,h]=d.useState(null),b=d.useRef(!1),C=d.useRef(null),N=d.useRef(!0);d.useEffect(()=>{N.current=!0;const I=setTimeout(()=>{N.current&&P()},100);return()=>{N.current=!1,C.current&&clearTimeout(C.current),clearTimeout(I)}},[]);const P=d.useCallback(async(I=!1)=>{if(b.current&&!I){console.log("ğŸ” AUTH CONTEXT - Validation already in progress, skipping");return}const R=Date.now();if(!I&&u&&R-u<3e4){console.log("ğŸ” AUTH CONTEXT - Using cached authentication status");return}b.current=!0,m(null);try{if(Z.auth.isAuthenticated()){console.log("ğŸ” AUTH CONTEXT - Token found, validating with server");const A=await Z.auth.validateToken();if(!N.current)return;const H=A?.data?.user||A?.user||A?.data||A;console.log("ğŸ” AUTH CONTEXT - Token validation successful, fetching full teacher data");let w=null;if(H?._id)try{w=await Z.teachers.getTeacher(H._id),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched:",{hasPersonalInfo:!!w?.personalInfo,hasRoles:!!w?.roles,fullName:w?.personalInfo?.fullName})}catch(U){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data:",U),w=H}const F=w||H,O={...F,teacherId:F?.teacherId||F?._id,personalInfo:F?.personalInfo||{fullName:F?.fullName||H?.fullName||"",email:F?.email||H?.email||"",phone:F?.phone||"",address:F?.address||""},roles:F?.roles||H?.roles||[],role:F?.role||F?.roles?.[0]||H?.roles?.[0]||""};console.log("ğŸ” AUTH CONTEXT - User data normalized:",{hasUserData:!!O,userRole:O?.role||O?.roles,userId:O?.teacherId||O?._id,fullName:O?.personalInfo?.fullName}),r(!0),l(O),h(R)}else console.log("ğŸ” AUTH CONTEXT - No valid token found"),r(!1),l(null),h(R)}catch(A){if(console.error("ğŸ” AUTH CONTEXT - Auth validation failed:",A),!N.current)return;m(A.message),r(!1),l(null),h(R),A.message.includes("Authentication failed")&&Z.auth.isAuthenticated()&&console.log("ğŸ” AUTH CONTEXT - Attempting token refresh")}finally{N.current&&a(!1),b.current=!1}},[u]),M=async(I,R)=>{try{a(!0),m(null);const A=await Z.auth.login(I,R);if(!N.current)return;console.log("ğŸ” AUTH CONTEXT - Login successful:",{hasToken:!!A.token,hasUserData:!!(A.teacher||A.user)});const{token:H}=A,w=A.teacher||A.user||A.data?.teacher||A.data?.user||A.data;if(!H||!w)throw new Error("Invalid login response: missing token or user data");console.log("ğŸ” AUTH CONTEXT - Fetching full teacher data after login");let F=null;if(w?._id||w?.teacherId)try{const ae=w._id||w.teacherId;F=await Z.teachers.getTeacher(ae),console.log("ğŸ” AUTH CONTEXT - Full teacher data fetched after login:",{hasPersonalInfo:!!F?.personalInfo,hasRoles:!!F?.roles,fullName:F?.personalInfo?.fullName})}catch(ae){console.warn("ğŸ” AUTH CONTEXT - Could not fetch full teacher data after login:",ae),F=w}const O=F||w,U={...O,teacherId:O?.teacherId||O?._id,personalInfo:O?.personalInfo||{fullName:O?.fullName||w?.personalInfo?.fullName||w?.fullName||"",email:O?.email||w?.credentials?.email||w?.personalInfo?.email||w?.email||I,phone:O?.phone||w?.personalInfo?.phone||"",address:O?.address||w?.personalInfo?.address||""},roles:O?.roles||w?.roles||[],role:O?.role||O?.roles?.[0]||w?.roles?.[0]||""};return console.log("ğŸ” AUTH CONTEXT - User data normalized after login:",{hasUserData:!!U,userRole:U?.role||U?.roles,userId:U?.teacherId||U?._id,fullName:U?.personalInfo?.fullName}),r(!0),l(U),h(Date.now()),{success:!0,user:U}}catch(A){throw console.error("ğŸ” AUTH CONTEXT - Login failed:",A),N.current&&(m(A.message),r(!1),l(null)),A}finally{N.current&&a(!1)}},S=async()=>{try{a(!0),await Z.auth.logout(),console.log("ğŸ” AUTH CONTEXT - Logout successful")}catch(I){console.warn("ğŸ” AUTH CONTEXT - Logout API call failed:",I)}finally{N.current&&(r(!1),l(null),m(null),h(null),a(!1))}},Y=d.useCallback(async()=>{try{return console.log("ğŸ” AUTH CONTEXT - Attempting token refresh"),await P(!0),s}catch(I){return console.error("ğŸ” AUTH CONTEXT - Token refresh failed:",I),await S(),!1}},[s]),p=d.useCallback(()=>({isAuthenticated:s,isLoading:i,user:n?{id:n.teacherId||n.id,role:n.role}:null,authError:g,lastValidation:u?new Date(u).toISOString():null,isValidating:b.current,cacheAge:u?Date.now()-u:null}),[s,i,n,g,u]),j={isAuthenticated:s,isLoading:i,user:n,authError:g,login:M,logout:S,checkAuthStatus:P,refreshToken:Y,debugAuth:p};return e.jsx(es.Provider,{value:j,children:t})},ts=d.createContext(null),ss=()=>{const t=d.useContext(ts);if(!t)throw new Error("useSchoolYear must be used within a SchoolYearProvider");return t},Zs=({children:t})=>{const{isAuthenticated:s}=$e(),[r,i]=d.useState(null),[a,n]=d.useState([]),[l,g]=d.useState(!0),[m,u]=d.useState(null);d.useEffect(()=>{s?h():(i(null),n([]),g(!1),u(null))},[s]);const h=async()=>{try{g(!0),u(null);const p=await Z.schoolYears.getSchoolYears();n(p);const j=await Z.schoolYears.getCurrentSchoolYear();if(j)i(j);else if(p.length>0){const I=p.sort((R,A)=>new Date(A.startDate)-new Date(R.startDate))[0];i(I)}console.log(`ğŸ“ Loaded ${p.length} school years, current: ${j?.name||"None"}`)}catch(p){console.error("Failed to load school years:",p),u(p.message||"×©×’×™××” ×‘×˜×¢×™× ×ª ×©× ×•×ª ×”×œ×™××•×“")}finally{g(!1)}},b=async p=>{try{const j=a.find(I=>I._id===p);if(j)i(j),console.log(`ğŸ¯ Switched to school year: ${j.name}`);else{const I=await Z.schoolYears.getSchoolYear(p);i(I),console.log(`ğŸ¯ Switched to fetched school year: ${I.name}`)}}catch(j){console.error("Failed to set school year:",j),u(j.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“")}},C=async p=>{try{const j=await Z.schoolYears.createSchoolYear(p);return n(I=>[...I,j]),p.isCurrent&&i(j),console.log(`â• Created new school year: ${j.name}`),j}catch(j){throw console.error("Failed to create school year:",j),u(j.message||"×©×’×™××” ×‘×™×¦×™×¨×ª ×©× ×ª ×”×œ×™××•×“"),j}},N=async(p,j)=>{try{const I=await Z.schoolYears.updateSchoolYear(p,j);return n(R=>R.map(A=>A._id===p?I:A)),r&&r._id===p&&i(I),console.log(`âœï¸ Updated school year: ${I.name}`),I}catch(I){throw console.error("Failed to update school year:",I),u(I.message||"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©× ×ª ×”×œ×™××•×“"),I}},P=async p=>{try{if(await Z.schoolYears.deleteSchoolYear(p),n(j=>j.filter(I=>I._id!==p)),r&&r._id===p){const j=a.filter(I=>I._id!==p);j.length>0?i(j[0]):i(null)}console.log(`ğŸ—‘ï¸ Deleted school year: ${p}`)}catch(j){throw console.error("Failed to delete school year:",j),u(j.message||"×©×’×™××” ×‘××—×™×§×ª ×©× ×ª ×”×œ×™××•×“"),j}},M=p=>{if(!p)return!1;const j=new Date,I=new Date(p.startDate),R=new Date(p.endDate);return j>=I&&j<=R&&p.isActive},Y={currentSchoolYear:r,schoolYears:a,isLoading:l,error:m,loadSchoolYears:h,setCurrentSchoolYearById:b,createSchoolYear:C,updateSchoolYear:N,deleteSchoolYear:P,isSchoolYearActive:M,getSchoolYearDisplayName:p=>{if(!p)return"×œ× × ×‘×—×¨×” ×©× ×”";const j=p.isCurrent,I=M(p);let R=p.name;return j?R+=" (× ×•×›×—×™×ª)":I&&(R+=" (×¤×¢×™×œ×”)"),R}};return e.jsx(ts.Provider,{value:Y,children:t})},er={currentBagrut:null,bagruts:[],loading:!1,error:null,validation:{errors:{},warnings:{}}},tr=t=>{if(!t[3]?.detailedGrading)return 0;const s=t[3].detailedGrading;return(s.playingSkills?.points||0)+(s.musicalUnderstanding?.points||0)+(s.textKnowledge?.points||0)+(s.playingByHeart?.points||0)},sr=(t,s)=>{const r=t/100*100,i=s/100*100;return r*.9+i*.1},rr=t=>t>=95?"××¦×•×™×Ÿ (100-95)":t>=85?"×˜×•×‘ ×××“ (94-85)":t>=75?"×˜×•×‘ (84-75)":t>=65?"×›××¢×˜ ×˜×•×‘ (74-65)":t>=55?"××¡×¤×™×§ (64-55)":"×œ× ××¡×¤×™×§ (54-0)",ar=t=>({presentations:[t.presentations?.[0]?.completed||!1,t.presentations?.[1]?.completed||!1,t.presentations?.[2]?.completed||!1,t.presentations?.[3]?.completed||!1],directorEvaluation:!!t.directorEvaluation?.points,recitalConfig:!!(t.recitalConfiguration?.units&&t.recitalConfiguration?.field),program:t.program?.length>0}),Ue=(t,s,r)=>t<0?`${r} ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×œ×™×œ×™`:t>s?`${r} ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ ${s} × ×§×•×“×•×ª`:null,nr=t=>t!==3&&t!==5?"×™×—×™×“×•×ª ×¨×¡×™×˜×œ ×—×™×™×‘×•×ª ×œ×”×™×•×ª 3 ××• 5":null,lr=(t,s)=>{switch(s.type){case"SET_LOADING":return{...t,loading:s.payload};case"SET_ERROR":return{...t,error:s.payload};case"SET_CURRENT_BAGRUT":return console.log("âœ… BagrutContext: SET_CURRENT_BAGRUT reducer:",s.payload?._id),{...t,currentBagrut:s.payload};case"SET_BAGRUTS":return{...t,bagruts:s.payload};case"UPDATE_DIRECTOR_EVALUATION":{const{bagrutId:r,evaluation:i}=s.payload,a=t.currentBagrut?._id===r?{...t.currentBagrut,directorEvaluation:i}:t.currentBagrut,n=t.bagruts.map(l=>l._id===r?{...l,directorEvaluation:i}:l);return{...t,currentBagrut:a,bagruts:n}}case"UPDATE_RECITAL_CONFIG":{const{bagrutId:r,config:i}=s.payload,a={units:i.recitalUnits,field:i.recitalField},n=t.currentBagrut?._id===r?{...t.currentBagrut,recitalConfiguration:a,recitalUnits:i.recitalUnits,recitalField:i.recitalField}:t.currentBagrut,l=t.bagruts.map(g=>g._id===r?{...g,recitalConfiguration:a,recitalUnits:i.recitalUnits,recitalField:i.recitalField}:g);return{...t,currentBagrut:n,bagruts:l}}case"UPDATE_PRESENTATION":{const{bagrutId:r,index:i,data:a}=s.payload,n=(m=[])=>{const u=[...m];return u[i]={...u[i],...a},u},l=t.currentBagrut?._id===r?{...t.currentBagrut,presentations:n(t.currentBagrut.presentations)}:t.currentBagrut,g=t.bagruts.map(m=>m._id===r?{...m,presentations:n(m.presentations)}:m);return{...t,currentBagrut:l,bagruts:g}}case"CALCULATE_COMPUTED_VALUES":{const{bagrutId:r}=s.payload,i=a=>{if(a._id!==r)return a;const n=tr(a.presentations||[]),l=a.directorEvaluation?.points||0,g=sr(n,l),m=rr(g),u=ar(a);return{...a,computedValues:{totalPerformancePoints:n,weightedFinalGrade:g,gradeLevel:m,completionStatus:u},finalGrade:g,finalGradeLevel:m}};return{...t,currentBagrut:t.currentBagrut?i(t.currentBagrut):null,bagruts:t.bagruts.map(i)}}case"SET_VALIDATION_ERROR":return{...t,validation:{...t.validation,errors:{...t.validation.errors,[s.payload.field]:s.payload.message}}};case"CLEAR_VALIDATION_ERRORS":return{...t,validation:{...t.validation,errors:{}}};default:return t}},rs=d.createContext(null),or=({children:t})=>{const[s,r]=d.useReducer(lr,er),i=d.useMemo(()=>({setLoading:n=>r({type:"SET_LOADING",payload:n}),setError:n=>r({type:"SET_ERROR",payload:n}),setCurrentBagrut:n=>{console.log("ğŸ’¾ BagrutContext: setCurrentBagrut action called with:",n?._id),r({type:"SET_CURRENT_BAGRUT",payload:n})},setBagruts:n=>r({type:"SET_BAGRUTS",payload:n}),updateDirectorEvaluation:(n,l)=>{const g=Ue(l.points||0,100,"×”×¢×¨×›×ª ×× ×”×œ");if(g){r({type:"SET_VALIDATION_ERROR",payload:{field:"directorEvaluation",message:g}});return}r({type:"UPDATE_DIRECTOR_EVALUATION",payload:{bagrutId:n,evaluation:l}}),r({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updateRecitalConfig:(n,l)=>{const g=nr(l.recitalUnits);if(g){r({type:"SET_VALIDATION_ERROR",payload:{field:"recitalUnits",message:g}});return}r({type:"UPDATE_RECITAL_CONFIG",payload:{bagrutId:n,config:l}}),r({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},updatePresentation:(n,l,g)=>{if(g.detailedGrading){const m=g.detailedGrading,u=[];if(m.playingSkills?.points!==void 0){const h=Ue(m.playingSkills.points,40,"×›×™×©×•×¨×™ × ×’×™× ×”");h&&u.push(h)}if(m.musicalUnderstanding?.points!==void 0){const h=Ue(m.musicalUnderstanding.points,30,"×”×‘× ×” ××•×–×™×§×œ×™×ª");h&&u.push(h)}if(m.textKnowledge?.points!==void 0){const h=Ue(m.textKnowledge.points,20,"×™×“×¢ ×˜×§×¡×˜");h&&u.push(h)}if(m.playingByHeart?.points!==void 0){const h=Ue(m.playingByHeart.points,10,"× ×’×™× ×” ×‘×¢×œ ×¤×”");h&&u.push(h)}if(u.length>0){r({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${l}`,message:u[0]}});return}}r({type:"UPDATE_PRESENTATION",payload:{bagrutId:n,index:l,data:g}}),r({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},recalculateGrade:n=>{r({type:"CALCULATE_COMPUTED_VALUES",payload:{bagrutId:n}})},setValidationError:(n,l)=>{r({type:"SET_VALIDATION_ERROR",payload:{field:n,message:l}})},clearValidationErrors:()=>{r({type:"CLEAR_VALIDATION_ERRORS"})},validatePointTotal:n=>(n.playingSkills?.points||0)+(n.musicalUnderstanding?.points||0)+(n.textKnowledge?.points||0)+(n.playingByHeart?.points||0)>100?(r({type:"SET_VALIDATION_ERROR",payload:{field:"totalPoints",message:"×¡×š ×”× ×§×•×“×•×ª ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 100"}}),!1):!0,validateSequentialPresentation:(n,l)=>n>0&&!l[n-1]?.completed?(r({type:"SET_VALIDATION_ERROR",payload:{field:`presentation${n}`,message:`×™×© ×œ×”×©×œ×™× ×ª×—×™×œ×” ××¦×’×ª ${n}`}}),!1):!0}),[]),a=d.useMemo(()=>({state:s,actions:i}),[s,i]);return e.jsx(rs.Provider,{value:a,children:t})},an=()=>{const t=d.useContext(rs);if(!t)throw new Error("useBagrutContext must be used within a BagrutProvider");return t},nn={getCurrentBagrut:t=>t.currentBagrut,getAllBagruts:t=>t.bagruts,getLoadingState:t=>t.loading,getError:t=>t.error,getValidationErrors:t=>t.validation.errors,getBagrutById:(t,s)=>t.bagruts.find(r=>r._id===s),getCompletedPresentations:(t,s)=>t.bagruts.find(i=>i._id===s)?.presentations?.filter(i=>i.completed)||[],getTotalPerformancePoints:(t,s)=>t.bagruts.find(i=>i._id===s)?.computedValues?.totalPerformancePoints||0,getWeightedFinalGrade:(t,s)=>t.bagruts.find(i=>i._id===s)?.computedValues?.weightedFinalGrade||0,getCompletionStatus:(t,s)=>t.bagruts.find(i=>i._id===s)?.computedValues?.completionStatus||{presentations:[!1,!1,!1,!1],directorEvaluation:!1,recitalConfig:!1,program:!1}},Pe=new qt({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!0,retry:(t,s)=>{const r=s?.response?.status;return r>=400&&r<500?!1:t<2},retryDelay:t=>Math.min(1e3*2**t,3e4),networkMode:"online"},mutations:{retry:1,networkMode:"online",onError:t=>{console.error("Mutation error:",t)}}}});Pe.setQueryDefaults(["students"],{staleTime:2*60*1e3,gcTime:5*60*1e3});Pe.setQueryDefaults(["teachers"],{staleTime:10*60*1e3,gcTime:30*60*1e3});Pe.setQueryDefaults(["theory-lessons"],{staleTime:2*60*1e3,gcTime:5*60*1e3});Pe.setQueryDefaults(["orchestras"],{staleTime:5*60*1e3,gcTime:15*60*1e3});Pe.setQueryDefaults(["school-years"],{staleTime:30*60*1e3,gcTime:60*60*1e3});function ir({children:t}){return e.jsxs(Xt,{client:Pe,children:[t,!1]})}const as=d.createContext(void 0);function cr({children:t}){const[s,r]=d.useState(!0),[i,a]=d.useState(!1);return d.useEffect(()=>{const n=()=>{a(window.innerWidth<768)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),e.jsx(as.Provider,{value:{isDesktopOpen:s,setIsDesktopOpen:r,isMobile:i},children:t})}function Tt(){const t=d.useContext(as);if(t===void 0)throw new Error("useSidebar must be used within a SidebarProvider");return t}const dr=({isOpen:t,onClose:s,title:r,children:i,maxWidth:a="md",showCloseButton:n=!0,closeOnBackdrop:l=!0,darkBackdrop:g=!1,className:m=""})=>{if(!t)return null;const u={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","4xl":"max-w-4xl"},h=g?"bg-opacity-75":"bg-opacity-50",b=C=>{l&&C.target===C.currentTarget&&s()};return e.jsx("div",{className:`fixed inset-0 bg-black ${h} flex items-center justify-center z-50 p-4`,onClick:b,children:e.jsxs("div",{className:`bg-white rounded-xl shadow-2xl w-full ${u[a]} max-h-[90vh] overflow-hidden transform transition-all ${m}`,children:[(r||n)&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r&&e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r}),n&&e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",type:"button",children:e.jsx(je,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-140px)]",children:i})]})})},ur=({isOpen:t,title:s,message:r,confirmText:i="××™×©×•×¨",cancelText:a="×‘×™×˜×•×œ",onConfirm:n,onCancel:l,variant:g="danger"})=>{if(!t)return null;const u=(()=>{switch(g){case"danger":return{icon:"text-red-600",confirmButton:"bg-red-600 hover:bg-red-700 text-white",iconBg:"bg-red-100"};case"warning":return{icon:"text-yellow-600",confirmButton:"bg-yellow-600 hover:bg-yellow-700 text-white",iconBg:"bg-yellow-100"};case"info":return{icon:"text-blue-600",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",iconBg:"bg-blue-100"};default:return{icon:"text-red-600",confirmButton:"bg-red-600 hover:bg-red-700 text-white",iconBg:"bg-red-100"}}})();return e.jsxs(dr,{isOpen:t,onClose:l,maxWidth:"md",showCloseButton:!1,closeOnBackdrop:!0,children:[e.jsx("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${u.iconBg}`,children:e.jsx(gt,{className:`w-5 h-5 ${u.icon}`})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s})]})}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:r})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:a}),e.jsx("button",{onClick:n,className:`flex-1 px-4 py-2 rounded-lg transition-colors font-medium ${u.confirmButton}`,children:i})]})]})},Ce={required:"×©×“×” ×—×•×‘×”",invalidPhone:"××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×ª×—×™×œ ×‘-05 ×•×œ×”×›×™×œ 10 ×¡×¤×¨×•×ª",invalidEmail:"×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”",invalidTime:"×–××Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¤×•×¨××˜ HH:MM",invalidAge:"×’×™×œ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×™×Ÿ 0 ×œ-99",invalidBagrutId:"××¡×¤×¨ ×–×”×•×ª ×‘×’×¨×•×ª ×—×™×™×‘ ×œ×”×›×™×œ 9 ×¡×¤×¨×•×ª",minLength:t=>`×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª ${t} ×ª×•×•×™×`,maxLength:t=>`×œ× ×™×›×•×œ ×œ×”×›×™×œ ×™×•×ª×¨ ×-${t} ×ª×•×•×™×`,invalidSelection:"×‘×—×™×¨×” ×œ× ×ª×§×™× ×”",passwordMismatch:"×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª",weakPassword:"×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×",duplicateEntry:"×¢×¨×š ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª",futureDate:"×ª××¨×™×š ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¢×ª×™×“",pastDate:"×ª××¨×™×š ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¢×‘×¨",invalidRange:"×˜×•×•×— ×œ× ×ª×§×™×Ÿ"},mr=t=>{const s={required:Ce.required,"invalid email":Ce.invalidEmail,"must be a valid email":Ce.invalidEmail,"invalid phone":Ce.invalidPhone,"invalid format":"×¤×•×¨××˜ ×œ× ×ª×§×™×Ÿ","already exists":Ce.duplicateEntry,"not found":"×œ× × ××¦× ×‘××¢×¨×›×ª",unauthorized:"××™×Ÿ ×”×¨×©××”",forbidden:"×¤×¢×•×œ×” ××¡×•×¨×”","is not allowed to be empty":Ce.required,"is required":Ce.required,"must be a string":"×¢×¨×š ×œ× ×ª×§×™×Ÿ","length must be at least":"×”×¢×¨×š ×§×¦×¨ ××“×™","must be a number":"×—×™×™×‘ ×œ×”×™×•×ª ××¡×¤×¨","must be greater than":"×¢×¨×š × ××•×š ××“×™","must be less than":"×¢×¨×š ×’×‘×•×” ××“×™"},r=t.toLowerCase();for(const[i,a]of Object.entries(s))if(r.includes(i))return a;return t},hr={"credentials.email":"personalInfo.email","credentials.password":"password"};function nt(t,s="×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×",r={}){const i={...hr,...r};if(t?.code==="VALIDATION_ERROR"&&t?.validationErrors){const a={},n=t.validationErrors;return Object.entries(n).forEach(([l,g])=>{const m=i[l]||l,u=mr(g);a[m]=u}),{fieldErrors:a,generalMessage:"×™×© ×œ×ª×§×Ÿ ××ª ×”×©×“×•×ª ×”××¡×•×× ×™× ×‘××“×•×",isValidationError:!0}}return{fieldErrors:{},generalMessage:t?.message||s,isValidationError:!1}}const gr=["×","×‘","×’","×“","×”","×•","×–","×—","×˜","×™","×™×","×™×‘","××—×¨"],xr=[1,2,3,4,5,6,7,8],fr=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","×’×™×˜×¨×” ×‘×¡","×ª×•×¤×™×"],pr=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],yr=[30,45,60],Lt=["×œ× × ×‘×—×Ÿ","×¢×‘×¨/×”","×œ× ×¢×‘×¨/×”","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª","×¢×‘×¨/×” ×‘×”×¦×˜×™×™× ×•×ª ×™×ª×¨×”"],br=({initialData:t,onSubmit:s,onCancel:r,isEdit:i=!1})=>{const[a,n]=d.useState({personalInfo:{fullName:"",phone:"",age:null,address:"",parentName:"",parentPhone:"",parentEmail:"",studentEmail:""},academicInfo:{instrumentProgress:[{instrumentName:"",isPrimary:!0,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}],class:"×",tests:{bagrutId:null}},enrollments:{orchestraIds:[],ensembleIds:[],theoryLessonIds:[],schoolYears:[]},teacherIds:[],teacherAssignments:[],isActive:!0,...t}),[l,g]=d.useState({}),[m,u]=d.useState(!1),[h,b]=d.useState({personal:!0,academic:!0,instruments:!0,teachers:!0,enrollments:!1}),[C,N]=d.useState([]),[P,M]=d.useState([]),[S,Y]=d.useState([]),[p,j]=d.useState([]),[I,R]=d.useState(""),[A,H]=d.useState(!1);d.useState([]);const[w,F]=d.useState({duration:null,selectedDays:[],startTime:"",endTime:""}),[O,U]=d.useState(!0),[ae,c]=d.useState(""),[v,B]=d.useState(!1),[f,_]=d.useState({top:0,left:0,width:0}),D=d.useRef(null),$=d.useRef(null),[L,X]=d.useState({isOpen:!1,message:"",conflictingSlot:null});d.useEffect(()=>{const o=async()=>{try{const E=await Z.teachers.getTeachers();N(E)}catch(E){console.error("Error fetching teachers:",E)}},x=async()=>{try{const E=await Z.orchestras.getOrchestras();console.log("Fetched orchestras:",E);const k=await Promise.all((E||[]).map(async W=>{if(W.rehearsalIds&&W.rehearsalIds.length>0)try{const Q=await Z.rehearsals.getRehearsalById(W.rehearsalIds[0]);return{...W,rehearsalSchedule:Q?{day:Q.day||Q.dayOfWeek,startTime:Q.startTime,endTime:Q.endTime,location:Q.location||W.location}:null}}catch{return console.log("Could not fetch rehearsal for orchestra:",W.name),W}return W}));Y(k)}catch(E){console.error("Error fetching orchestras:",E),Y([])}},y=async()=>{try{const E=await Z.theory.getTheoryLessons();console.log("Fetched theory lessons:",E);const k=Array.isArray(E)?E:E?.data||[];j(k)}catch(E){console.error("Error fetching theory lessons:",E),j([])}};o(),x(),y()},[]),d.useEffect(()=>{const o=x=>{D.current&&!D.current.contains(x.target)&&B(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const De=C.filter(o=>{if(!ae)return!0;const x=ae.toLowerCase(),y=o.personalInfo?.fullName?.toLowerCase()||"",E=o.professionalInfo?.instrument?.toLowerCase()||"";return y.includes(x)||E.includes(x)}),Le=()=>{if(!I)return"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×";const o=C.find(x=>x._id===I);return o?`${o.personalInfo?.fullName||""} - ${o.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"}`:"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×"},_e=(o,x)=>{const[y,E]=o.split(":").map(Number),k=y*60+E+x,W=Math.floor(k/60),Q=k%60;return`${W.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`},Ae=(o,x,y,E)=>{const k=me=>{const[Se,Fe]=me.split(":").map(Number);return Se*60+Fe},W=k(o),Q=k(x),Ie=k(y),ee=k(E);return W<ee&&Q>Ie};d.useEffect(()=>{I&&(qe(I),U(!0))},[I]);const qe=async o=>{H(!0);try{const x=await Z.teachers.getTeacherById(o);console.log("Teacher data for slots:",x);const y=await Z.teachers.getTeacherStudents(o);console.log("Teacher students:",y);const E=[];y.forEach(ee=>{ee.teacherAssignments&&Array.isArray(ee.teacherAssignments)&&ee.teacherAssignments.forEach(me=>{me.teacherId===o&&E.push({day:me.day,time:me.time,duration:me.duration})})}),console.log("ğŸš« Occupied slots from other students:",E),console.log("ğŸ“‹ Teacher teaching data:",{hasTeaching:!!x.teaching,hasSchedule:!!x.teaching?.schedule,scheduleLength:x.teaching?.schedule?.length,hasTimeBlocks:!!x.teaching?.timeBlocks,timeBlocksLength:x.teaching?.timeBlocks?.length});const k=x.teaching?.schedule?.filter(ee=>ee.isAvailable!==!1&&ee.isActive!==!1)||[],W=x.teaching?.timeBlocks?.filter(ee=>ee.isAvailable!==!1&&ee.isActive!==!1)||[],Q=[...k];W.forEach(ee=>{Q.some(Se=>Se.day===ee.day&&Se.startTime===ee.startTime&&Se.endTime===ee.endTime)||Q.push(ee)}),console.log("ğŸ“… Time blocks found (schedule + timeBlocks):",Q.length);const Ie=[];Q.forEach(ee=>{const me=ee.startTime,Se=ee.endTime,Fe=ee.day,[ys,bs]=me.split(":").map(Number),[js,vs]=Se.split(":").map(Number),kt=ys*60+bs,Ct=js*60+vs,Qa=Ct-kt;yr.forEach(ke=>{for(let Be=kt;Be+ke<=Ct;Be+=15){const Et=Be+ke,Ns=Math.floor(Be/60),ws=Be%60,Ts=Math.floor(Et/60),Is=Et%60,Me=`${Ns.toString().padStart(2,"0")}:${ws.toString().padStart(2,"0")}`,it=`${Ts.toString().padStart(2,"0")}:${Is.toString().padStart(2,"0")}`,Ss=E.some(oe=>{if(oe.day!==Fe)return!1;const Dt=_e(oe.time,oe.duration),_t=Ae(Me,it,oe.time,Dt);return _t&&ke===60&&console.log(`ğŸ”´ Blocking slot ${Me}-${it} (${ke}min) - overlaps with ${oe.time}-${Dt}`),_t}),ks=a.teacherAssignments.some(oe=>oe.teacherId===x._id&&oe.day===Fe&&oe.time===Me&&oe.duration===ke);if(!Ss&&!ks){const oe=`${ee._id}-${ke}-${Me.replace(":","")}`;Ie.push({_id:oe,day:Fe,startTime:Me,endTime:it,duration:ke,isAvailable:!0,location:ee.location,teacherName:x.personalInfo?.fullName,teacherId:x._id,instrument:x.professionalInfo?.instrument})}}})}),console.log("Generated available slots (after filtering occupied):",Ie),M(Ie)}catch(x){console.error("Error fetching teacher slots:",x),M([])}finally{H(!1)}},we=o=>{b(x=>({...x,[o]:!x[o]}))},ce=(o,x,y)=>{n(E=>({...E,[o]:{...E[o],[x]:y}})),g(E=>({...E,[`${o}.${x}`]:""}))},Te=(o,x,y)=>{const E=[...a.academicInfo.instrumentProgress];x==="tests"?E[o]={...E[o],tests:y}:E[o]={...E[o],[x]:y},x==="isPrimary"&&y===!0&&E.forEach((k,W)=>{W!==o&&(k.isPrimary=!1)}),n(k=>({...k,academicInfo:{...k.academicInfo,instrumentProgress:E}}))},T=()=>{const o=a.academicInfo.instrumentProgress.some(x=>x.isPrimary);n(x=>({...x,academicInfo:{...x.academicInfo,instrumentProgress:[...x.academicInfo.instrumentProgress,{instrumentName:"",isPrimary:!o,currentStage:1,tests:{stageTest:{status:"×œ× × ×‘×—×Ÿ"},technicalTest:{status:"×œ× × ×‘×—×Ÿ"}}}]}}))},z=o=>{const x=a.academicInfo.instrumentProgress.filter((y,E)=>E!==o);x.length>0&&!x.some(y=>y.isPrimary)&&(x[0].isPrimary=!0),n(y=>({...y,academicInfo:{...y.academicInfo,instrumentProgress:x}}))},V=o=>{const x=_e(o.startTime,o.duration);for(const k of a.teacherAssignments)if(k.day===o.day){const W=_e(k.time,k.duration);if(Ae(o.startTime,x,k.time,W)){const Q=C.find(Ie=>Ie._id===k.teacherId)?.personalInfo?.fullName||"××•×¨×”";return`×”×ª×–××•×Ÿ ××ª× ×’×© ×¢× ×©×™×¢×•×¨ ×§×™×™×:
${k.day} ${k.time}-${W} ×¢× ${Q}`}}const y=S.find(k=>k._id===a.enrollments.orchestraIds[0]);if(y?.rehearsalSchedule){const k=y.rehearsalSchedule;if(k.day===o.day&&Ae(o.startTime,x,k.startTime,k.endTime))return`×”×ª×–××•×Ÿ ××ª× ×’×© ×¢× ×—×–×¨×ª ×ª×–××•×¨×ª:
${k.day} ${k.startTime}-${k.endTime} - ${y.name}`}const E=p.find(k=>k._id===a.enrollments.theoryLessonIds[0]);if(E?.schedule){for(const k of E.schedule)if(k.day===o.day&&Ae(o.startTime,x,k.startTime,k.endTime))return`×”×ª×–××•×Ÿ ××ª× ×’×© ×¢× ×©×™×¢×•×¨ ×ª×™××•×¨×™×”:
${k.day} ${k.startTime}-${k.endTime} - ${E.name}`}return null},G=o=>{const x=V(o);if(x){X({isOpen:!0,message:x,conflictingSlot:o});return}te(o)},te=o=>{const x={teacherId:o.teacherId,day:o.day,time:o.startTime,duration:o.duration,isActive:!0,isRecurring:!0,...o.location&&{location:o.location}};n(y=>({...y,teacherAssignments:[...y.teacherAssignments,x],teacherIds:y.teacherIds.includes(o.teacherId)?y.teacherIds:[...y.teacherIds,o.teacherId]})),M(y=>y.filter(E=>E._id!==o._id)),U(!1)},Xe=()=>{L.conflictingSlot&&te(L.conflictingSlot),X({isOpen:!1,message:"",conflictingSlot:null})},gs=()=>{X({isOpen:!1,message:"",conflictingSlot:null})},xs=o=>{const x=a.teacherAssignments[o];n(y=>{const E=y.teacherAssignments.filter((W,Q)=>Q!==o),k=E.some(W=>W.teacherId===x.teacherId);return{...y,teacherAssignments:E,teacherIds:k?y.teacherIds:y.teacherIds.filter(W=>W!==x.teacherId)}}),I===x.teacherId&&setTimeout(()=>{qe(x.teacherId)},100)},fs=()=>{const o={};a.personalInfo.fullName.trim()||(o["personalInfo.fullName"]="×©× ××œ× ×”×•× ×©×“×” ×—×•×‘×”"),a.personalInfo.phone&&!/^05\d{8}$/.test(a.personalInfo.phone)&&(o["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ (×“×•×’××”: 0501234567)"),a.personalInfo.parentPhone&&!/^05\d{8}$/.test(a.personalInfo.parentPhone)&&(o["personalInfo.parentPhone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),a.personalInfo.parentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.personalInfo.parentEmail)&&(o["personalInfo.parentEmail"]="××™××™×™×œ ×”×•×¨×” ×œ× ×ª×§×™×Ÿ"),a.personalInfo.studentEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.personalInfo.studentEmail)&&(o["personalInfo.studentEmail"]="××™××™×™×œ ×ª×œ××™×“ ×œ× ×ª×§×™×Ÿ"),a.academicInfo.class||(o["academicInfo.class"]="×›×™×ª×” ×”×™× ×©×“×” ×—×•×‘×”"),a.academicInfo.instrumentProgress.length===0?o["academicInfo.instruments"]="×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×›×œ×™ × ×’×™× ×” ××—×“":a.academicInfo.instrumentProgress.forEach((y,E)=>{y.instrumentName||(o[`instrument.${E}.name`]="×©× ×”×›×œ×™ ×”×•× ×©×“×” ×—×•×‘×”")});const x=a.academicInfo.instrumentProgress.some(y=>y.isPrimary);return a.academicInfo.instrumentProgress.length>0&&!x&&(o["academicInfo.primaryInstrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ ×¨××©×™"),g(o),Object.keys(o).length===0},ps=async o=>{if(o.preventDefault(),!!fs()){u(!0);try{console.log("ğŸ“‹ Form data being submitted:",JSON.stringify(a,null,2)),console.log("ğŸ‘¥ Teacher assignments:",JSON.stringify(a.teacherAssignments,null,2)),console.log("ğŸ‘¨â€ğŸ« Teacher IDs:",a.teacherIds),await s(a)}catch(x){console.error("Error submitting form:",x);const{fieldErrors:y,generalMessage:E,isValidationError:k}=nt(x,"×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×");g(k?{...y,submit:E}:{submit:E})}finally{u(!1)}}};return e.jsxs("form",{onSubmit:ps,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:i?"×¢×¨×™×›×ª ×ª×œ××™×“":"×”×•×¡×¤×ª ×ª×œ××™×“ ×—×“×©"}),e.jsx("button",{type:"button",onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"w-5 h-5"})})]}),l.submit&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:l.submit})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>we("personal"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××™×©×™×™×"})]}),h.personal?e.jsx(Oe,{}):e.jsx(ge,{})]}),h.personal&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©× ××œ× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.personalInfo.fullName,onChange:o=>ce("personalInfo","fullName",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.fullName"]?"border-red-500":"border-gray-300"}`,placeholder:"×”×›× ×¡ ×©× ××©×¤×—×” ×•××– ×©× ×¤×¨×˜×™ (×œ×“×•×’××”: ×›×”×Ÿ ×™×•×¡×™)"}),l["personalInfo.fullName"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.fullName"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×ª×œ××™×“"}),e.jsx("input",{type:"tel",value:a.personalInfo.phone,onChange:o=>ce("personalInfo","phone",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.phone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),l["personalInfo.phone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.phone"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×’×™×œ"}),e.jsx("input",{type:"number",value:a.personalInfo.age||"",onChange:o=>ce("personalInfo","age",o.target.value?parseInt(o.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×’×™×œ ×”×ª×œ××™×“",min:"0",max:"99"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×ª×œ××™×“"}),e.jsx("input",{type:"email",value:a.personalInfo.studentEmail,onChange:o=>ce("personalInfo","studentEmail",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.studentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"student@example.com"}),l["personalInfo.studentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.studentEmail"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª"}),e.jsx("input",{type:"text",value:a.personalInfo.address,onChange:o=>ce("personalInfo","address",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×”×›× ×¡ ×›×ª×•×‘×ª ××œ××”"})]}),e.jsx("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:e.jsx("h4",{className:"text-md font-medium text-gray-800 mb-4",children:"×¤×¨×˜×™ ×”×•×¨×”"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ×”×•×¨×”"}),e.jsx("input",{type:"text",value:a.personalInfo.parentName,onChange:o=>ce("personalInfo","parentName",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",placeholder:"×©× ×”×”×•×¨×”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ ×”×•×¨×”"}),e.jsx("input",{type:"tel",value:a.personalInfo.parentPhone,onChange:o=>ce("personalInfo","parentPhone",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.parentPhone"]?"border-red-500":"border-gray-300"}`,placeholder:"0501234567"}),l["personalInfo.parentPhone"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.parentPhone"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ ×”×•×¨×”"}),e.jsx("input",{type:"email",value:a.personalInfo.parentEmail,onChange:o=>ce("personalInfo","parentEmail",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["personalInfo.parentEmail"]?"border-red-500":"border-gray-300"}`,placeholder:"parent@example.com"}),l["personalInfo.parentEmail"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["personalInfo.parentEmail"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>we("academic"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×¤×¨×˜×™× ××§×“××™×™×"})]}),h.academic?e.jsx(Oe,{}):e.jsx(ge,{})]}),h.academic&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×™×ª×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:a.academicInfo.class,onChange:o=>ce("academicInfo","class",o.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l["academicInfo.class"]?"border-red-500":"border-gray-300"}`,children:gr.map(o=>e.jsx("option",{value:o,children:o},o))}),l["academicInfo.class"]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l["academicInfo.class"]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>we("instruments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×›×œ×™ × ×’×™× ×”"})]}),h.instruments?e.jsx(Oe,{}):e.jsx(ge,{})]}),h.instruments&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[l["academicInfo.instruments"]&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:l["academicInfo.instruments"]})}),l["academicInfo.primaryInstrument"]&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:l["academicInfo.primaryInstrument"]})}),e.jsxs("div",{className:"space-y-4",children:[a.academicInfo.instrumentProgress.map((o,x)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["×›×œ×™ × ×’×™× ×” ",x+1]}),a.academicInfo.instrumentProgress.length>1&&e.jsx("button",{type:"button",onClick:()=>z(x),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(xt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["×©× ×”×›×œ×™ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.instrumentName,onChange:y=>Te(x,"instrumentName",y.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 ${l[`instrument.${x}.name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™"}),fr.map(y=>e.jsx("option",{value:y,children:y},y))]}),l[`instrument.${x}.name`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l[`instrument.${x}.name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×œ×‘ × ×•×›×—×™"}),e.jsx("select",{value:o.currentStage,onChange:y=>Te(x,"currentStage",parseInt(y.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:xr.map(y=>e.jsxs("option",{value:y,children:["×©×œ×‘ ",y]},y))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.isPrimary,onChange:y=>Te(x,"isPrimary",y.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"×›×œ×™ ×¨××©×™"})]})}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×©×œ×‘"}),e.jsx("select",{value:o.tests.stageTest.status,onChange:y=>Te(x,"tests",{...o.tests,stageTest:{...o.tests.stageTest,status:y.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:Lt.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××‘×—×Ÿ ×˜×›× ×™"}),e.jsx("select",{value:o.tests.technicalTest.status,onChange:y=>Te(x,"tests",{...o.tests,technicalTest:{...o.tests.technicalTest,status:y.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:Lt.map(y=>e.jsx("option",{value:y,children:y},y))})]})]})]})]},x)),e.jsxs("button",{type:"button",onClick:T,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors flex items-center justify-center gap-2 text-gray-600 hover:text-primary-600",children:[e.jsx(Re,{className:"w-4 h-4"}),"×”×•×¡×£ ×›×œ×™ × ×’×™× ×”"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>we("teachers"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"××•×¨×™× ×•×©×™×¢×•×¨×™×"}),a.teacherAssignments.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-xs",children:[a.teacherAssignments.length," ×©×™×‘×•×¦×™×"]})]}),h.teachers?e.jsx(Oe,{}):e.jsx(ge,{})]}),h.teachers&&e.jsxs("div",{className:"p-6 border-t border-gray-200",children:[a.teacherAssignments.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"×©×™×¢×•×¨×™× ××ª×•×›× × ×™×"}),e.jsx("div",{className:"space-y-2",children:a.teacherAssignments.map((o,x)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ve,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["××•×¨×” - ",C.find(y=>y._id===o.teacherId)?.professionalInfo?.instrument||"×›×œ×™"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.day," | ",o.time,"-",_e(o.time,o.duration)," | ",o.duration," ×“×§×•×ª",o.location&&` | ${o.location}`]})]})]}),e.jsx("button",{type:"button",onClick:()=>xs(x),className:"p-1 hover:bg-red-50 rounded text-red-600",children:e.jsx(xt,{className:"w-4 h-4"})})]},x))})]}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×‘×—×¨ ××•×¨×”"}),e.jsxs("button",{type:"button",ref:$,onClick:()=>{if(!v&&$.current){const o=$.current.getBoundingClientRect();_({top:o.bottom+4,left:o.left,width:o.width})}B(!v)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white text-right flex items-center justify-between",children:[e.jsx("span",{className:I?"text-gray-900":"text-gray-500",children:Le()}),e.jsx(ge,{className:`w-4 h-4 text-gray-500 transition-transform ${v?"rotate-180":""}`})]}),v&&e.jsxs("div",{className:"fixed z-[9999] bg-white border border-gray-300 rounded-lg shadow-xl overflow-hidden",style:{top:f.top,left:f.left,width:f.width,maxHeight:`calc(100vh - ${f.top+20}px)`},children:[e.jsx("div",{className:"p-2 border-b border-gray-200 sticky top-0 bg-white",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:ae,onChange:o=>c(o.target.value),placeholder:"×—×™×¤×•×© ×œ×¤×™ ×©× ××• ×›×œ×™ × ×’×™× ×”...",className:"w-full pr-9 pl-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm text-gray-900",autoFocus:!0})]})}),e.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:`calc(100vh - ${f.top+80}px)`},children:[e.jsx("button",{type:"button",onClick:()=>{R(""),c(""),B(!1)},className:"w-full px-3 py-2 text-right text-gray-500 hover:bg-gray-50 border-b border-gray-100",children:"×‘×—×¨ ××•×¨×” ×œ×¨××•×ª ×–×× ×™× ×¤× ×•×™×™×"}),De.length>0?De.map(o=>e.jsxs("button",{type:"button",onClick:()=>{R(o._id),c(""),B(!1)},className:`w-full px-3 py-2 text-right hover:bg-primary-50 flex items-center justify-between ${I===o._id?"bg-primary-100 text-primary-700":"text-gray-900"}`,children:[e.jsxs("span",{children:[o.personalInfo?.fullName," - ",o.professionalInfo?.instrument||"×œ×œ× ×›×œ×™"]}),I===o._id&&e.jsx(Ve,{className:"w-4 h-4 text-primary-600"})]},o._id)):e.jsx("div",{className:"px-3 py-4 text-center text-gray-500 text-sm",children:"×œ× × ××¦××• ××•×¨×™× ×ª×•×××™×"})]})]})]}),I&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["×–×× ×™× ×¤× ×•×™×™× - ",C.find(o=>o._id===I)?.personalInfo?.fullName||"××•×¨×”"]}),!O&&P.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>U(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"×‘×—×¨ ×©×™×¢×•×¨ × ×•×¡×£"]})}),O&&!A&&P.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"×¡×™× ×•×Ÿ ×–×× ×™×"]}),(w.duration||w.selectedDays.length>0||w.startTime||w.endTime)&&e.jsxs("button",{type:"button",onClick:()=>F({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3"}),"× ×§×” ×¡×™× ×•×Ÿ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×š ×©×™×¢×•×¨"}),e.jsxs("select",{value:w.duration||"",onChange:o=>F(x=>({...x,duration:o.target.value?Number(o.target.value):null})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"×›×œ ×”××©×›×™×"}),e.jsx("option",{value:"30",children:"30 ×“×§×•×ª"}),e.jsx("option",{value:"45",children:"45 ×“×§×•×ª"}),e.jsx("option",{value:"60",children:"60 ×“×§×•×ª"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×™××™×"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md bg-white text-right flex items-center justify-between text-gray-900",onClick:o=>{const x=o.currentTarget.nextElementSibling;x&&x.classList.toggle("hidden")},children:[e.jsx("span",{className:"truncate",children:w.selectedDays.length>0?`${w.selectedDays.length} ×™××™× × ×‘×—×¨×•`:"×›×œ ×”×™××™×"}),e.jsx(ge,{className:"w-4 h-4 flex-shrink-0"})]}),e.jsx("div",{className:"hidden absolute top-full mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg z-10",children:pr.map(o=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w.selectedDays.includes(o),onChange:x=>{x.target.checked?F(y=>({...y,selectedDays:[...y.selectedDays,o]})):F(y=>({...y,selectedDays:y.selectedDays.filter(E=>E!==o)}))},className:"ml-2 text-primary-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:o})]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"××©×¢×”"}),e.jsx("input",{type:"time",value:w.startTime,onChange:o=>F(x=>({...x,startTime:o.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"×¢×“ ×©×¢×”"}),e.jsx("input",{type:"time",value:w.endTime,onChange:o=>F(x=>({...x,endTime:o.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-gray-900 bg-white"})]})]})]}),A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"×˜×•×¢×Ÿ ×–×× ×™× ×¤× ×•×™×™×..."})]}):O&&P.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"×‘×—×¨ ×–××Ÿ ×•××©×š ×©×™×¢×•×¨ ××”××¤×©×¨×•×™×•×ª ×”×–××™× ×•×ª:"}),(()=>{const o=P.filter(y=>!(w.duration&&y.duration!==w.duration||w.selectedDays.length>0&&!w.selectedDays.includes(y.day)||w.startTime&&y.startTime<w.startTime||w.endTime&&y.endTime>w.endTime));if(o.length===0)return e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(At,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×”×ª×•×××™× ×œ×¡×™× ×•×Ÿ ×©×‘×—×¨×ª"}),e.jsx("button",{type:"button",onClick:()=>F({duration:null,selectedDays:[],startTime:"",endTime:""}),className:"text-xs text-primary-600 hover:text-primary-700",children:"× ×§×” ×¡×™× ×•×Ÿ ×•×ª×¨××” ××ª ×›×œ ×”×–×× ×™×"})]});const x=o.reduce((y,E)=>(y[E.day]||(y[E.day]=[]),y[E.day].push(E),y),{});return Object.entries(x).map(([y,E])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),y]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:E.sort((k,W)=>k.startTime.localeCompare(W.startTime)).map(k=>e.jsx("button",{type:"button",onClick:()=>G(k),className:`p-3 border rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-right ${k.duration===30?"border-green-300 bg-green-50":k.duration===45?"border-blue-300 bg-blue-50":"border-purple-300 bg-purple-50"}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[k.startTime,"-",k.endTime]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k.duration===30?"bg-green-100 text-green-800":k.duration===45?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[k.duration," ×“×§×³"]})]}),k.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(He,{className:"w-3 h-3"}),k.location]}),e.jsx("div",{className:"text-xs text-gray-600",children:k.instrument})]})},k._id))})]},y))})()]}):I&&!A&&O&&P.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"××™×Ÿ ×–×× ×™× ×¤× ×•×™×™× ×œ××•×¨×” ×–×”"}),e.jsx("p",{className:"text-xs text-gray-400",children:"×™×™×ª×›×Ÿ ×©×›×œ ×”×–×× ×™× ×”×¤× ×•×™×™× ×›×‘×¨ ×ª×¤×•×¡×™× ××• ×©×”××•×¨×” ×œ× ×”×’×“×™×¨ ×–×× ×™ ×”×•×¨××”"})]}):null]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>we("enrollments"),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"×”×¨×©××•×ª"})]}),h.enrollments?e.jsx(Oe,{}):e.jsx(ge,{})]}),h.enrollments&&e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª×–××•×¨×ª"}),e.jsxs("select",{value:a.enrollments.orchestraIds[0]||"",onChange:o=>{n(x=>({...x,enrollments:{...x.enrollments,orchestraIds:o.target.value?[o.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),S.map(o=>{const x=o.rehearsalSchedule||o.schedule&&o.schedule[0]||o.rehearsals&&o.rehearsals[0]||null;let y=o.name;if(x){const E=x.day||x.dayOfWeek||"",k=x.startTime||"",W=x.endTime||"",Q=x.location||o.location||"";E&&k&&W&&(y+=` | ${E} ${k}-${W}`),Q&&(y+=` | ${Q}`)}else o.location&&(y+=` | ${o.location}`);return e.jsx("option",{value:o._id,children:y},o._id)})]}),a.enrollments.orchestraIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-purple-50 rounded-lg border border-purple-200",children:(()=>{const o=S.find(x=>x._id===a.enrollments.orchestraIds[0]);return o?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-purple-900",children:o.name}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[o.rehearsalSchedule&&e.jsxs("div",{className:"p-2 bg-purple-100 rounded",children:[e.jsx("strong",{children:"×–×× ×™ ×—×–×¨×•×ª:"})," ",o.rehearsalSchedule.day," ",o.rehearsalSchedule.startTime,"-",o.rehearsalSchedule.endTime,o.rehearsalSchedule.location&&e.jsxs("span",{children:[" | ",o.rehearsalSchedule.location]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×•×’:"})," ",o.type||"×ª×–××•×¨×ª"]}),!o.rehearsalSchedule&&o.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"××™×§×•×:"})," ",o.location]}),o.memberIds&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×‘×¨×™×:"})," ",o.memberIds.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"×¡×˜×˜×•×¡:"})," ",o.isActive?"×¤×¢×™×œ":"×œ× ×¤×¢×™×œ"]}),o.rehearsalIds&&o.rehearsalIds.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"××¡×¤×¨ ×—×–×¨×•×ª ×©××•×¨×•×ª:"})," ",o.rehearsalIds.length]})]})]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),e.jsxs("select",{value:a.enrollments.theoryLessonIds[0]||"",onChange:o=>{n(x=>({...x,enrollments:{...x.enrollments,theoryLessonIds:o.target.value?[o.target.value]:[]}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-gray-900",children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"}),p.map(o=>{const x=o.schedule&&o.schedule.length>0?o.schedule[0]:null,y=x?`${x.day} ${x.startTime}-${x.endTime}${x.location?` | ${x.location}`:""}`:"";return e.jsxs("option",{value:o._id,children:[o.name||o.title||o.category," ",y?`| ${y}`:"",o.teacher?.personalInfo?.fullName&&` | ××•×¨×”: ${o.teacher.personalInfo.fullName}`]},o._id)})]}),a.enrollments.theoryLessonIds[0]&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(()=>{const o=p.find(x=>x._id===a.enrollments.theoryLessonIds[0]);return o?e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:o.name}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"×¨××”:"})," ",o.level]}),o.teacher?.personalInfo?.fullName&&e.jsxs("div",{children:[e.jsx("strong",{children:"××•×¨×”:"})," ",o.teacher.personalInfo.fullName]}),o.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×™××•×¨:"})," ",o.description]}),o.maxStudents&&e.jsxs("div",{children:[e.jsx("strong",{children:"××§×¡×™××•× ×ª×œ××™×“×™×:"})," ",o.maxStudents]}),o.currentStudents!==void 0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×ª×œ××™×“×™× × ×•×›×—×™×™×:"})," ",o.currentStudents,"/",o.maxStudents||"âˆ"]}),o.schedule&&o.schedule.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"×–×× ×™ ×©×™×¢×•×¨:"}),e.jsx("div",{className:"mt-1 space-y-1",children:o.schedule.map((x,y)=>e.jsxs("div",{className:"text-xs bg-blue-100 px-2 py-1 rounded",children:[x.day," ",x.startTime,"-",x.endTime,x.location&&` | ${x.location}`]},y))})]}),o.prerequisites&&e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:[e.jsx("strong",{children:"×“×¨×™×©×•×ª ×§×“×:"})," ",o.prerequisites]})]})]}):null})()})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"×©×•××¨..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-4 h-4"}),i?"×¢×“×›×Ÿ ×ª×œ××™×“":"×”×•×¡×£ ×ª×œ××™×“"]})})]}),e.jsx(ur,{isOpen:L.isOpen,title:"×”×ª× ×’×©×•×ª ×‘×œ×•×— ×–×× ×™×",message:L.message,confirmText:"×”××©×š ×‘×›×œ ×–××ª",cancelText:"×‘×™×˜×•×œ",onConfirm:Xe,onCancel:gs,variant:"warning"})]})},yt=["××•×œ× ×¢×¨×Ÿ","×¡×˜×•×“×™×• ×§×××¨×™ 1","×¡×˜×•×“×™×• ×§×××¨×™ 2","××•×œ×¤×Ÿ ×”×§×œ×˜×•×ª","×—×“×¨ ×—×–×¨×•×ª 1","×—×“×¨ ×—×–×¨×•×ª 2","×—×“×¨ ××—×©×‘×™×","×—×“×¨ 1","×—×“×¨ 2","×—×“×¨ ×—×–×¨×•×ª","×—×“×¨ 5","×—×“×¨ 6","×—×“×¨ 7","×—×“×¨ 8","×—×“×¨ 9","×—×“×¨ 10","×—×“×¨ 11","×—×“×¨ 12","×—×“×¨ 13","×—×“×¨ 14","×—×“×¨ 15","×—×“×¨ 16","×—×“×¨ 17","×—×“×¨ 18","×—×“×¨ 19","×—×“×¨ 20","×—×“×¨ 21","×—×“×¨ 22","×—×“×¨ 23","×—×“×¨ 24","×—×“×¨ 25","×—×“×¨ 26","×—×“×¨ ×ª××•×¨×™×” ×","×—×“×¨ ×ª××•×¨×™×” ×‘"],jr=["××•×¨×”","×× ×¦×—","××“×¨×™×š ×”×¨×›×‘","×× ×”×œ","××•×¨×” ×ª××•×¨×™×”","××’××”"],vr=["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™"],Nr=["×—×œ×™×œ×™×ª","×—×œ×™×œ ×¦×“","××‘×•×‘","×‘×¡×•×Ÿ","×¡×§×¡×•×¤×•×Ÿ","×§×œ×¨×™× ×˜","×—×¦×•×¦×¨×”","×§×¨×Ÿ ×™×¢×¨","×˜×¨×•××‘×•×Ÿ","×˜×•×‘×”/×‘×¨×™×˜×•×Ÿ","×©×™×¨×”","×›×™× ×•×¨","×•×™×•×œ×”","×¦'×œ×•","×§×•× ×˜×¨×‘×¡","×¤×¡× ×ª×¨","×’×™×˜×¨×”","××•×¨×’×Ÿ","×—×¨××•× ×™×§×”","×× ×“×•×œ×™× ×”","×›×™× ×•×¨ ×‘××¨×•×§","×•×™×•×œ×” ×“×” ×’××‘×”","×¤×œ×•×˜×” ×¨×§×•×¨×“×¨","××•×§×¨×™× ×”","×—×œ×™×œ ×¤××Ÿ","×“×•×œ×¦×™××¨","××•×˜×•-×”×¨×¤","×¤×¡× ×ª×¨ ××œ×§×˜×¨×•× ×™","×’×™×˜×¨×” ×‘×¡","×’×™×˜×¨×” ××§×•×¡×˜×™×ª","×’×™×˜×¨×” ×§×œ××¡×™×ª","×‘× ×’×³×•","×—×œ×™×œ ××™×¨×™","×›×™× ×•×¨ ×§×œ×˜×™","×‘×•×“×”×¨××Ÿ"],bt=(t,s)=>{if(!t||!s)return 0;const[r,i]=t.split(":").map(Number),[a,n]=s.split(":").map(Number),l=r*60+i,g=a*60+n;return g<=l?0:g-l},Ft=(t,s)=>{if(!t||!s)return null;const r=bt(t,s);return r<=0?"×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":r<30?"×™×•× ×œ×™××•×“ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 30 ×“×§×•×ª":r>480?"×™×•× ×œ×™××•×“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-8 ×©×¢×•×ª":null},wr=({isOpen:t,onClose:s,onTeacherAdded:r,teacherToEdit:i,mode:a="add"})=>{const{currentSchoolYear:n}=ss(),[l,g]=d.useState("personal"),[m,u]=d.useState({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),[h,b]=d.useState([]),[C,N]=d.useState([]),[P,M]=d.useState(!1),[S,Y]=d.useState({}),[p,j]=d.useState("");d.useEffect(()=>{t&&a==="edit"&&i?R(i):t&&a==="add"&&c()},[t,a,i]),d.useEffect(()=>{t&&I()},[t]);const I=async()=>{try{const[f,_]=await Promise.all([Z.orchestras.getOrchestras(),Z.orchestras.getOrchestras({type:"ensemble"})]);b(f||[]),N(_||[])}catch(f){console.error("Failed to load orchestras/ensembles:",f)}},R=f=>{const _=(f.teaching?.schedule||[]).filter(D=>!D.studentId);u({personalInfo:{fullName:f.personalInfo?.fullName||"",phone:f.personalInfo?.phone||"",email:f.personalInfo?.email||"",address:f.personalInfo?.address||""},roles:f.roles||[],professionalInfo:{instrument:f.professionalInfo?.instrument||"",isActive:f.professionalInfo?.isActive??!0},teaching:{schedule:_},conducting:{orchestraIds:f.conducting?.orchestraIds||[]},ensemblesIds:f.ensemblesIds||[]})},A=()=>{const f={};return m.personalInfo.fullName.trim()||(f["personalInfo.fullName"]="×©× ××œ× × ×“×¨×©"),m.personalInfo.phone.match(/^05\d{8}$/)||(f["personalInfo.phone"]="××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×¤×•×¨××˜: 05XXXXXXXX"),m.personalInfo.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(f["personalInfo.email"]="×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”"),m.personalInfo.address.trim()||(f["personalInfo.address"]="×›×ª×•×‘×ª × ×“×¨×©×ª"),m.roles.length===0&&(f.roles="×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×ª×¤×§×™×“ ××—×“"),(m.roles.includes("××•×¨×”")||m.roles.includes("××’××”")||!m.roles.includes("××•×¨×” ×ª××•×¨×™×”"))&&!m.professionalInfo.instrument&&(f["professionalInfo.instrument"]="×™×© ×œ×‘×—×•×¨ ×›×œ×™ × ×’×™× ×”"),m.teaching.schedule.forEach((D,$)=>{if(D.startTime||(f[`schedule.${$}.startTime`]="×©×¢×ª ×”×ª×—×œ×” × ×“×¨×©×ª"),D.endTime||(f[`schedule.${$}.endTime`]="×©×¢×ª ×¡×™×•× × ×“×¨×©×ª"),D.location?yt.includes(D.location)||(f[`schedule.${$}.location`]="××™×§×•× ×œ× ×ª×§×™×Ÿ"):f[`schedule.${$}.location`]="×™×© ×œ×‘×—×•×¨ ××™×§×•×",D.startTime&&D.endTime){const L=Ft(D.startTime,D.endTime);L&&(f[`schedule.${$}.timeRange`]=L)}}),Y(f),Object.keys(f).length===0},H=(f,_,D)=>{u(L=>({...L,[f]:{...L[f],[_]:D}}));const $=`${f}.${_}`;S[$]&&Y(L=>{const X={...L};return delete X[$],X})},w=(f,_)=>{const D=_?[...m.roles,f]:m.roles.filter($=>$!==f);u($=>({...$,roles:D})),S.roles&&Y($=>{const L={...$};return delete L.roles,L})},F=()=>{const f={day:"×¨××©×•×Ÿ",startTime:"14:00",endTime:"15:30",location:"",notes:""};u(_=>({..._,teaching:{..._.teaching,schedule:[..._.teaching.schedule,f]}}))},O=f=>{u(_=>({..._,teaching:{..._.teaching,schedule:_.teaching.schedule.filter((D,$)=>$!==f)}}))},U=(f,_,D)=>{u($=>({...$,teaching:{...$.teaching,schedule:$.teaching.schedule.map((L,X)=>X===f?{...L,[_]:D}:L)}}))},ae=async f=>{if(f.preventDefault(),!!A()){M(!0),j("");try{const _=m.teaching.schedule.map(L=>({day:L.day,startTime:L.startTime,endTime:L.endTime,duration:bt(L.startTime,L.endTime),location:L.location||null,notes:L.notes||null,isAvailable:!0,studentId:null,recurring:{isRecurring:!0,excludeDates:[]}}));let D=_;if(a==="edit"&&i){const L=(i.teaching?.schedule||[]).filter(X=>X.studentId);console.log(`ğŸ“‹ Preserving ${L.length} existing lessons`),D=[..._,...L]}const $={personalInfo:m.personalInfo,roles:m.roles,professionalInfo:m.professionalInfo,teaching:{studentIds:i?.teaching?.studentIds||[],schedule:D},conducting:m.conducting,ensemblesIds:m.ensemblesIds,schoolYears:n?[{schoolYearId:n._id,isActive:!0}]:[],credentials:{email:m.personalInfo.email,password:null,isInvitationAccepted:!1},isActive:!0};if(a==="edit"&&i){console.log("ğŸ”„ Updating teacher with preserved lessons:",$);const L=await Z.teachers.updateTeacher(i._id,$);console.log("âœ… Teacher updated successfully:",L),r(L)}else{console.log("ğŸ”„ Creating teacher:",$);const L=await Z.teachers.addTeacher($);console.log("âœ… Teacher created successfully:",L),r(L)}c(),s()}catch(_){console.error(`âŒ Failed to ${a==="edit"?"update":"create"} teacher:`,_);const{fieldErrors:D,generalMessage:$,isValidationError:L}=nt(_,`×©×’×™××” ×‘${a==="edit"?"×¢×“×›×•×Ÿ":"×™×¦×™×¨×ª"} ×”××•×¨×”. × ×¡×” ×©×•×‘.`);L&&Y(D),j($)}finally{M(!1)}}},c=()=>{u({personalInfo:{fullName:"",phone:"",email:"",address:""},roles:[],professionalInfo:{instrument:"",isActive:!0},teaching:{schedule:[]},conducting:{orchestraIds:[]},ensemblesIds:[]}),g("personal"),Y({}),j("")},v=()=>{c(),s()};if(!t)return null;const B=[{id:"personal",label:"××™×“×¢ ××™×©×™",icon:ve},{id:"professional",label:"××™×“×¢ ××§×¦×•×¢×™",icon:Bs},{id:"schedule",label:"×œ×•×— ×–×× ×™×",icon:le},{id:"conducting",label:"× ×™×¦×•×—",icon:ft}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[85vh] overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:a==="edit"?"×¢×¨×™×›×ª ×¤×¨×˜×™ ××•×¨×”":"×”×•×¡×¤×ª ××•×¨×” ×—×“×©"}),e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:B.map(({id:f,label:_,icon:D})=>e.jsxs("button",{onClick:()=>g(f),className:`flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${l===f?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(D,{className:"w-4 h-4"}),_]},f))})}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[l==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©× ××œ× *"}),e.jsx("input",{type:"text",value:m.personalInfo.fullName,onChange:f=>H("personalInfo","fullName",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.fullName"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×”×›× ×¡ ×©× ××œ×"}),S["personalInfo.fullName"]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S["personalInfo.fullName"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×˜×œ×¤×•×Ÿ *"}),e.jsx("input",{type:"tel",value:m.personalInfo.phone,onChange:f=>H("personalInfo","phone",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.phone"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"05XXXXXXXX"}),S["personalInfo.phone"]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S["personalInfo.phone"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××™××™×™×œ *"}),e.jsx("input",{type:"email",value:m.personalInfo.email,onChange:f=>H("personalInfo","email",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.email"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"teacher@example.com"}),S["personalInfo.email"]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S["personalInfo.email"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×›×ª×•×‘×ª *"}),e.jsx("input",{type:"text",value:m.personalInfo.address,onChange:f=>H("personalInfo","address",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 placeholder-gray-500 bg-white ${S["personalInfo.address"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,placeholder:"×¨×—×•×‘ ××¡×¤×¨, ×¢×™×¨"}),S["personalInfo.address"]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S["personalInfo.address"]]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"×ª×¤×§×™×“×™× *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:jr.map(f=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:m.roles.includes(f),onChange:_=>w(f,_.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 w-4 h-4"}),e.jsx("span",{className:"mr-3 text-sm text-gray-700 font-medium",children:f})]},f))}),S.roles&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S.roles]})]})]}),l==="professional"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×›×œ×™ × ×’×™× ×” ",!m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&"*"]}),e.jsxs("select",{value:m.professionalInfo.instrument,onChange:f=>H("professionalInfo","instrument",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 text-gray-900 bg-white ${S["professionalInfo.instrument"]?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-primary-500"}`,disabled:m.roles.includes("××•×¨×” ×ª××•×¨×™×”")&&m.roles.length===1,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×›×œ×™ × ×’×™× ×”"}),Nr.map(f=>e.jsx("option",{value:f,children:f},f))]}),S["professionalInfo.instrument"]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S["professionalInfo.instrument"]]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.professionalInfo.isActive,onChange:f=>H("professionalInfo","isActive",f.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"××•×¨×” ×¤×¢×™×œ"})]})})]}),l==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"×‘×œ×•×§×™ ×–××Ÿ ×œ×”×•×¨××”"}),e.jsxs("button",{type:"button",onClick:F,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4 ml-2"}),"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ"]})]}),m.teaching.schedule.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"×œ× ×”×•×’×“×¨×• ×‘×œ×•×§×™ ×–××Ÿ"}),e.jsx("p",{className:"text-sm",children:"×”×•×¡×£ ×‘×œ×•×§ ×–××Ÿ ×›×“×™ ×œ×§×‘×•×¢ ××ª×™ ×”××•×¨×” ×–××™×Ÿ ×œ×”×•×¨××”"})]}):e.jsx("div",{className:"space-y-4",children:m.teaching.schedule.map((f,_)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×™×•×"}),e.jsx("select",{value:f.day,onChange:D=>U(_,"day",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white",children:vr.map(D=>e.jsx("option",{value:D,children:D},D))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×”×ª×—×œ×”"}),e.jsx("input",{type:"time",value:f.startTime,onChange:D=>U(_,"startTime",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:f.endTime,onChange:D=>U(_,"endTime",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white"}),f.startTime&&f.endTime&&e.jsx("div",{className:"mt-1 text-xs",children:(()=>{const D=bt(f.startTime,f.endTime),$=Ft(f.startTime,f.endTime);return $?e.jsx("span",{className:"text-red-600",children:$}):D>0?e.jsxs("span",{className:"text-gray-500",children:["××©×š: ",D," ×“×§×•×ª"]}):null})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"××™×§×•×"}),e.jsxs("select",{value:f.location,onChange:D=>U(_,"location",D.target.value),className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 bg-white ${S[`schedule.${_}.location`]?"border-red-300 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ××™×§×•×..."}),yt.map(D=>e.jsx("option",{value:D,children:D},D))]}),S[`schedule.${_}.location`]&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),S[`schedule.${_}.location`]]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"×”×¢×¨×•×ª"}),e.jsx("input",{type:"text",value:f.notes,onChange:D=>U(_,"notes",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-gray-900 placeholder-gray-500 bg-white",placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>O(_),className:"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(xt,{className:"w-4 h-4 ml-1"}),"×”×¡×¨"]})})]},_))})]}),l==="conducting"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(ft,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×ª×–××•×¨×•×ª ×œ× ×™×¦×•×—"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×ª×–××•×¨×•×ª ×©×”××•×¨×” ×™× ×¦×—"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:h.map(f=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-purple-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.conducting.orchestraIds.includes(f._id),onChange:_=>{const D=_.target.checked?[...m.conducting.orchestraIds,f._id]:m.conducting.orchestraIds.filter($=>$!==f._id);H("conducting","orchestraIds",D)},className:"rounded-lg border-gray-300 text-purple-600 focus:ring-purple-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-purple-700 transition-colors",children:f.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:f.description||"×ª×–××•×¨×ª ×œ×œ× ×ª×™××•×¨"}),f.memberCount&&e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["ğŸ‘¥ ",f.memberCount," ×—×‘×¨×™×"]})]})]},f._id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-900",children:"×× ×¡××‘×œ×™× ×œ×”×“×¨×›×”"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×‘×—×¨ ××ª ×”×× ×¡××‘×œ×™× ×©×”××•×¨×” ×™×“×¨×™×š"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:C.map(f=>e.jsxs("label",{className:"flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-green-300 hover:shadow-md transition-all duration-200 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:m.ensemblesIds.includes(f._id),onChange:_=>{const D=_.target.checked?[...m.ensemblesIds,f._id]:m.ensemblesIds.filter($=>$!==f._id);u($=>({...$,ensemblesIds:D}))},className:"rounded-lg border-gray-300 text-green-600 focus:ring-green-500 w-5 h-5"}),e.jsxs("div",{className:"mr-4 flex-1",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 group-hover:text-green-700 transition-colors",children:f.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:f.description||"×× ×¡××‘×œ ×œ×œ× ×ª×™××•×¨"}),f.memberCount&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ğŸµ ",f.memberCount," ×—×‘×¨×™×"]})]})]},f._id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200",children:[p&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:p})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:P,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:P,className:"flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[P?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"}):e.jsx(Nt,{className:"w-4 h-4 ml-2"}),P?"×©×•××¨...":a==="edit"?"×¢×“×›×Ÿ ××•×¨×”":"×©××•×¨ ××•×¨×”"]})]})]})]})]})})};function Tr({theoryLesson:t,theoryLessons:s,teachers:r,onSubmit:i,onCancel:a,mode:n="create"}){const[l,g]=d.useState("single"),[m,u]=d.useState({category:"××’××”",teacherId:"",date:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],attendance:{present:[],absent:[]},notes:"",syllabus:"",homework:"",schoolYearId:""}),[h,b]=d.useState({category:"××’××”",teacherId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"14:00",endTime:"15:00",location:"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:"",syllabus:"",excludeDates:[],schoolYearId:""}),[C,N]=d.useState(r||[]),[P,M]=d.useState(!1),[S,Y]=d.useState(!1),[p,j]=d.useState(""),[I,R]=d.useState(""),A=["×ª×œ××™×“×™× ×—×“×©×™× ×‘-×“","××ª×—×™×œ×™×","××ª×—×™×œ×™× ×‘","××ª×—×™×œ×™× ×“","××ª×§×“××™× ×‘","××ª×§×“××™× ×","××ª×§×“××™× ×’","×ª×œ××™×“×™× ×—×“×©×™× ×‘×•×’×¨×™× (×” - ×˜)","×ª×œ××™×“×™× ×—×“×©×™× ×¦×¢×™×¨×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×§×œ××¡×™ ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×","×”×›× ×” ×œ×¨×¡×™×˜×œ ×¨×•×§\\×¤×•×¤\\×’'××– ×™×‘","××’××”","×ª××•×¨×™×” ×›×œ×™"],H={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"};d.useEffect(()=>{r||w(),F()},[r]),d.useEffect(()=>{if(n==="edit"&&t){const c=new Date(t.date);u({category:t.category||"××’××”",teacherId:t.teacherId||"",date:t.date?new Date(t.date).toISOString().split("T")[0]:"",dayOfWeek:t.dayOfWeek!==void 0?t.dayOfWeek:c.getDay(),startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",location:t.location||"××•×œ× ×¢×¨×Ÿ",studentIds:t.studentIds||[],attendance:t.attendance||{present:[],absent:[]},notes:t.notes||"",syllabus:t.syllabus||"",homework:t.homework||"",schoolYearId:t.schoolYearId||""}),b(v=>({...v,category:t.category||"××’××”",teacherId:t.teacherId||"",location:t.location||"××•×œ× ×¢×¨×Ÿ",startTime:t.startTime||"14:00",endTime:t.endTime||"15:00",notes:t.notes||"",syllabus:t.syllabus||"",schoolYearId:t.schoolYearId||""}))}else if(n==="bulk-edit"&&s&&s.length>0){const c=s[0],v=s.every(X=>X.category===c.category)?c.category:"",B=s.every(X=>X.teacherId===c.teacherId)?c.teacherId:"",f=s.every(X=>X.location===c.location)?c.location:"",_=s.every(X=>X.startTime===c.startTime)?c.startTime:"",D=s.every(X=>X.endTime===c.endTime)?c.endTime:"",$=s.every(X=>X.notes===c.notes)?c.notes:"",L=s.every(X=>X.syllabus===c.syllabus)?c.syllabus:"";b({category:v||"××’××”",teacherId:B||"",startDate:"",endDate:"",dayOfWeek:0,startTime:_||"14:00",endTime:D||"15:00",location:f||"××•×œ× ×¢×¨×Ÿ",studentIds:[],notes:$||"",syllabus:L||"",excludeDates:[],schoolYearId:c.schoolYearId||""})}},[t,s,n]);const w=async()=>{try{const v=(await $s.getTeachers()).filter(B=>B.roles&&B.roles.includes("××•×¨×” ×ª××•×¨×™×”"));N(v)}catch(c){console.error("Error loading teachers:",c)}},F=async()=>{try{const c=await Ps.getCurrentSchoolYear();c&&(m.schoolYearId||u(v=>({...v,schoolYearId:c._id})),h.schoolYearId||b(v=>({...v,schoolYearId:c._id})))}catch(c){console.error("Error loading current school year:",c)}},O=(c,v)=>{if(n==="edit"||n==="create"&&l==="single"){if(u(B=>({...B,[c]:v})),c==="date"&&v){const f=new Date(v).getDay();u(_=>({..._,date:v,dayOfWeek:f}))}}else b(B=>({...B,[c]:v}))},U=()=>{if(l==="single"){if(!m.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨"),!1;if(!m.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨"),!1;if(!m.date)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ×©×™×¢×•×¨"),!1;if(!m.startTime||!m.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!m.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨"),!1;const c=m.startTime.split(":").map(Number),v=m.endTime.split(":").map(Number),B=c[0]*60+c[1];if(v[0]*60+v[1]<=B)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}else{if(!h.category.trim())return j("×™×© ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.teacherId)return j("×™×© ×œ×‘×—×•×¨ ××•×¨×” ×œ×©×™×¢×•×¨×™×"),!1;if(!h.startDate||!h.endDate)return j("×™×© ×œ×‘×—×•×¨ ×ª××¨×™×›×™ ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.startTime||!h.endTime)return j("×™×© ×œ×”×–×™×Ÿ ×©×¢×•×ª ×”×ª×—×œ×” ×•×¡×™×•×"),!1;if(!h.location.trim())return j("×™×© ×œ×”×–×™×Ÿ ××™×§×•× ×œ×©×™×¢×•×¨×™×"),!1;if(h.dayOfWeek<0||h.dayOfWeek>6)return j("×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),!1;if(!h.schoolYearId)return j("×™×© ×œ×‘×—×•×¨ ×©× ×ª ×œ×™××•×“×™×"),!1;if(new Date(h.endDate)<=new Date(h.startDate))return j("×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),!1;const c=h.startTime.split(":").map(Number),v=h.endTime.split(":").map(Number),B=c[0]*60+c[1];if(v[0]*60+v[1]<=B)return j("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),!1}return!0},ae=async c=>{if(c.preventDefault(),j(""),R(""),!!U()){M(!0);try{if(n==="edit"){const v={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"edit",lessonId:t?._id};await i(v),R("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”")}else if(n==="bulk-edit"){const v={};h.category&&h.category.trim()&&(v.category=h.category),h.teacherId&&h.teacherId.trim()&&(v.teacherId=h.teacherId),h.location&&h.location.trim()&&(v.location=h.location),h.startTime&&h.startTime.trim()&&(v.startTime=h.startTime),h.endTime&&h.endTime.trim()&&(v.endTime=h.endTime),h.notes&&h.notes.trim()&&(v.notes=h.notes),h.syllabus&&h.syllabus.trim()&&(v.syllabus=h.syllabus);const B={mode:"bulk-edit",lessonIds:s?.map(f=>f._id)||[],updateData:v};await i(B),R(`${s?.length||0} ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×” ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”`)}else if(l==="single"){const v={...m,date:new Date(m.date+"T"+m.startTime+":00.000Z").toISOString(),mode:"create"};await i(v),R("×©×™×¢×•×¨ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}else{const v={...h,isBulk:!0,mode:"bulk-create"};console.log("ğŸš€ Bulk theory lesson creation data:",JSON.stringify(v,null,2));const f=["category","teacherId","startDate","endDate","dayOfWeek","startTime","endTime","location","schoolYearId"].filter(_=>{const D=v[_];return D==null||typeof D=="string"&&D.trim()===""});if(f.length>0){console.error("âŒ Missing required fields:",f),j(`×—×¡×¨×™× ×©×“×•×ª ×—×•×‘×”: ${f.join(", ")}`);return}await i(v),R("×¨×¦×£ ×©×™×¢×•×¨×™ ×”×ª×™××•×¨×™×” × ×•×¦×¨ ×‘×”×¦×œ×—×”")}}catch(v){console.error("Error submitting theory lesson form:",v);const{generalMessage:B}=nt(v,"×©×’×™××” ×‘×©××™×¨×ª ×”×©×™×¢×•×¨");j(B)}finally{M(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n==="edit"?"×¢×¨×™×›×ª ×©×™×¢×•×¨ ×ª×™××•×¨×™×”":n==="bulk-edit"?"×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”":"×©×™×¢×•×¨ ×ª×™××•×¨×™×” ×—×“×©"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-gray-500"})})]}),n==="create"&&e.jsxs("div",{className:"flex space-x-4 rtl:space-x-reverse",children:[e.jsxs("button",{type:"button",onClick:()=>g("single"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${l==="single"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(le,{className:"w-4 h-4 ml-2"}),"×©×™×¢×•×¨ ×‘×•×“×“"]}),e.jsxs("button",{type:"button",onClick:()=>g("bulk"),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${l==="bulk"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ms,{className:"w-4 h-4 ml-2"}),"×¨×¦×£ ×©×™×¢×•×¨×™×"]})]}),n==="bulk-edit"&&s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600 ml-2"}),e.jsxs("p",{className:"text-blue-800",children:["×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª ×©×œ ",s.length," ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”"]})]}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"×©×“×•×ª ×¨×™×§×™× ×™×™×©××¨×• ×œ×œ× ×©×™× ×•×™, ×¨×§ ×©×“×•×ª ×©×™××•×œ××• ×™×¢×•×“×›× ×•"})]})]}),e.jsxs("form",{onSubmit:ae,className:"p-6 space-y-6",children:[S&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 ml-2"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×™×¢×•×¨..."})]})}),I&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800 text-sm",children:I})}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:p})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ye,{className:"w-4 h-4 inline ml-1"}),"×§×˜×’×•×¨×™×” *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?m.category:h.category,onChange:c=>O("category",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),A.map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"××•×¨×” *"}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?m.teacherId:h.teacherId,onChange:c=>O("teacherId",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[e.jsx("option",{value:"",children:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™":"×‘×—×¨ ××•×¨×”"}),C.map(c=>e.jsx("option",{value:c._id,children:c.personalInfo?.fullName},c._id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(He,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× *"]}),e.jsxs("select",{value:n==="edit"||n==="create"&&l==="single"?m.location:h.location,onChange:c=>O("location",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:n!=="bulk-edit",children:[n==="bulk-edit"&&e.jsx("option",{value:"",children:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"}),yt.map(c=>e.jsx("option",{value:c,children:c},c))]})]}),n==="edit"||n==="create"&&l==="single"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š *"}),e.jsx("input",{type:"date",value:m.date,onChange:c=>O("date",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢"}),e.jsx("input",{type:"text",value:H[m.dayOfWeek]||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:m.startTime,onChange:c=>O("startTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:m.endTime,onChange:c=>O("endTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]}):n==="bulk-edit"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×”"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:c=>O("startTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•×"}),e.jsx("input",{type:"time",value:h.endTime,onChange:c=>O("endTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"×”×©××¨ ×œ×œ× ×©×™× ×•×™"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×”×ª×—×œ×” *"}),e.jsx("input",{type:"date",value:h.startDate,onChange:c=>O("startDate",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×š ×¡×™×•× *"}),e.jsx("input",{type:"date",value:h.endDate,onChange:c=>O("endDate",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×™×•× ×‘×©×‘×•×¢ *"}),e.jsx("select",{value:h.dayOfWeek,onChange:c=>O("dayOfWeek",parseInt(c.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0,children:Object.entries(H).map(([c,v])=>e.jsx("option",{value:c,children:v},c))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” *"]}),e.jsx("input",{type:"time",value:h.startTime,onChange:c=>O("startTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×¢×ª ×¡×™×•× *"}),e.jsx("input",{type:"time",value:h.endTime,onChange:c=>O("endTime",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×¡×™×œ×‘×•×¡"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&l==="single"?m.syllabus:h.syllabus,onChange:c=>O("syllabus",c.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - × ×•×©××™ ×”×©×™×¢×•×¨...":n==="edit"||l==="single"?"× ×•×©××™ ×”×©×™×¢×•×¨...":"× ×•×©××™ ×”×©×™×¢×•×¨×™×..."})]}),n==="edit"||n==="create"&&l==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×©×™×¢×•×¨×™ ×‘×™×ª"}),e.jsx("textarea",{value:m.homework,onChange:c=>O("homework",c.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:"××©×™××•×ª ×œ×‘×™×ª..."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:n==="edit"||n==="create"&&l==="single"?m.notes:h.notes,onChange:c=>O("notes",c.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900",placeholder:n==="bulk-edit"?"×”×©××¨ ×œ×œ× ×©×™× ×•×™ - ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª...":"×”×¢×¨×•×ª ×›×œ×œ×™×•×ª..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:P,children:"×‘×™×˜×•×œ"}),e.jsxs("button",{type:"submit",disabled:P,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[P?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}):e.jsx(Nt,{className:"w-4 h-4 ml-2"}),n==="edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨":n==="bulk-edit"?"×¢×“×›×Ÿ ×©×™×¢×•×¨×™×":l==="single"?"×¦×•×¨ ×©×™×¢×•×¨":"×¦×•×¨ ×¨×¦×£ ×©×™×¢×•×¨×™×"]})]})]})]})})}const ns={0:"×¨××©×•×Ÿ",1:"×©× ×™",2:"×©×œ×™×©×™",3:"×¨×‘×™×¢×™",4:"×—××™×©×™",5:"×©×™×©×™",6:"×©×‘×ª"},Ir=Object.entries(ns).map(([t,s])=>({value:parseInt(t),label:s})),It=t=>ns[t]||"×œ× ×™×“×•×¢",Sr=t=>{const s=new Date(t.date).toLocaleDateString("he-IL"),r=`${t.startTime} - ${t.endTime}`,i=It(t.dayOfWeek),a=`${i}, ${s} ${r}`;return{date:s,time:r,dayName:i,fullDateTime:a}},Ze=(t,s)=>{const r=be(t);return be(s)-r},be=t=>{const[s,r]=t.split(":").map(Number);return s*60+r},Bt=t=>{const s=t.attendance?.present?.length||0,r=t.attendance?.absent?.length||0,i=t.orchestra?.memberIds?.length||s+r,a=i>0?Math.round(s/i*100):0;return{presentCount:s,absentCount:r,totalMembers:i,attendanceRate:a,hasAttendanceData:s>0||r>0}},kr=t=>{if(!t.isActive)return{status:"cancelled",text:"×‘×•×˜×œ×”",colorClass:"bg-gray-100 text-gray-800"};const s=new Date;new Date(t.date);const r=new Date(`${t.date}T${t.startTime}:00`),i=new Date(`${t.date}T${t.endTime}:00`);return s<r?{status:"upcoming",text:"×¢×ª×™×“×”",colorClass:"bg-blue-100 text-blue-800"}:s>=r&&s<=i?{status:"in_progress",text:"××ª×§×™×™××ª ×›×¢×ª",colorClass:"bg-green-100 text-green-800"}:{status:"completed",text:"×”×¡×ª×™×™××”",colorClass:"bg-orange-100 text-orange-800"}},Mt=(t,s)=>{if(t.date!==s.date)return{hasConflict:!1,conflictType:"none",severity:"none",message:""};if(t.groupId===s.groupId)return{hasConflict:!1,conflictType:"none",severity:"none",message:"××•×ª×” ×ª×–××•×¨×ª"};const r=be(t.startTime),i=be(t.endTime),a=be(s.startTime),n=be(s.endTime);if(r<n&&a<i){if(t.location===s.location)return{hasConflict:!0,conflictType:"location",severity:"critical",message:`×—×¤×™×¤×” ×‘××™×§×•×: ${t.location}`};const g=t.orchestra?.conductor?._id,m=s.orchestra?.conductor?._id;if(g&&m&&g===m)return{hasConflict:!0,conflictType:"conductor",severity:"critical",message:"××•×ª×• ×× ×¦×— ×‘×©× ×™ ××§×•××•×ª"};const u=new Set(t.orchestra?.memberIds||[]),h=new Set(s.orchestra?.memberIds||[]),b=[...u].filter(C=>h.has(C));return b.length>0?{hasConflict:!0,conflictType:"members",severity:"warning",message:`${b.length} ×—×‘×¨×™× ××©×•×ª×¤×™×`}:{hasConflict:!0,conflictType:"time",severity:"warning",message:"×—×¤×™×¤×ª ×–×× ×™×"}}return{hasConflict:!1,conflictType:"none",severity:"none",message:""}},ln=(t,s)=>t.filter(r=>{if(s.searchQuery){const i=s.searchQuery.toLowerCase();if(!(r.orchestra?.name?.toLowerCase().includes(i)||r.location?.toLowerCase().includes(i)||r.notes?.toLowerCase().includes(i)||It(r.dayOfWeek).toLowerCase().includes(i)))return!1}if(s.orchestraId&&r.groupId!==s.orchestraId||s.type&&r.type!==s.type||s.dayOfWeek!==""&&s.dayOfWeek!==void 0&&r.dayOfWeek!==s.dayOfWeek||s.location&&r.location!==s.location)return!1;if(s.startDate){const i=new Date(r.date),a=new Date(s.startDate);if(i<a)return!1}if(s.endDate){const i=new Date(r.date),a=new Date(s.endDate);if(i>a)return!1}return!(s.status&&s.status!=="all"&&kr(r).status!==s.status||s.isActive!==void 0&&r.isActive!==s.isActive)}),on=(t,s="date",r="asc")=>[...t].sort((a,n)=>{let l=0;switch(s){case"date":l=new Date(a.date).getTime()-new Date(n.date).getTime();break;case"time":l=be(a.startTime)-be(n.startTime);break;case"orchestra":const g=a.orchestra?.name||"",m=n.orchestra?.name||"";l=g.localeCompare(m,"he");break;case"location":l=a.location.localeCompare(n.location,"he");break;case"attendance":const u=Bt(a).attendanceRate,h=Bt(n).attendanceRate;l=u-h;break;case"duration":const b=Ze(a.startTime,a.endTime),C=Ze(n.startTime,n.endTime);l=b-C;break;default:l=0}return r==="desc"?-l:l}),Cr=t=>{const s=[],r=new Date(t.startDate),i=new Date(t.endDate),a=t.dayOfWeek,n=new Set(t.excludeDates||[]),l=new Date(r);for(;l.getDay()!==a&&l<=i;)l.setDate(l.getDate()+1);for(;l<=i;){const g=l.toISOString().split("T")[0];n.has(g)||s.push(g),l.setDate(l.getDate()+7)}return s},Er=t=>{const s={};if(t.groupId?.trim()||(s.groupId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.type||(s.type="×™×© ×œ×‘×—×•×¨ ×¡×•×’ ×”×¨×›×‘"),!t.date)s.date="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š";else{const r=new Date(t.date),i=new Date;i.setHours(0,0,0,0),r<i&&(s.date="×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ×—×–×¨×” ×‘×¢×‘×¨")}if(t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime){const r=Ze(t.startTime,t.endTime);r<=0?s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”":r>300&&(s.endTime="××©×š ×”×—×–×¨×” ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×™×•×ª×¨ ×-5 ×©×¢×•×ª")}return t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},Dr=t=>{const s={};if(t.orchestraId?.trim()||(s.orchestraId="×™×© ×œ×‘×—×•×¨ ×ª×–××•×¨×ª"),t.startDate||(s.startDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×”×ª×—×œ×”"),t.endDate||(s.endDate="×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×¡×™×•×"),t.startDate&&t.endDate){const r=new Date(t.startDate),i=new Date(t.endDate);r>=i&&(s.endDate="×ª××¨×™×š ×”×¡×™×•× ×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×™ ×ª××¨×™×š ×”×”×ª×—×œ×”"),(i.getTime()-r.getTime())/(1e3*60*60*24)>365&&(s.endDate="×ª×§×•×¤×” ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×™×•×ª×¨ ××©× ×”")}return(t.dayOfWeek===void 0||t.dayOfWeek<0||t.dayOfWeek>6)&&(s.dayOfWeek="×™×© ×œ×‘×—×•×¨ ×™×•× ×‘×©×‘×•×¢"),t.startTime||(s.startTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×”×ª×—×œ×”"),t.endTime||(s.endTime="×™×© ×œ×”×–×™×Ÿ ×©×¢×ª ×¡×™×•×"),t.startTime&&t.endTime&&Ze(t.startTime,t.endTime)<=0&&(s.endTime="×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”"),t.location?.trim()||(s.location="×™×© ×œ×‘×—×•×¨ ××™×§×•×"),{isValid:Object.keys(s).length===0,errors:s}},cn=t=>{switch(t.orchestra?.type||t.type){case"×ª×–××•×¨×ª":return"bg-blue-500";case"×”×¨×›×‘":return"bg-pink-500";default:return"bg-gray-500"}};function _r({newRehearsal:t,bulkData:s,existingRehearsals:r,orchestras:i,onConflictsChanged:a}){const[n,l]=d.useState([]),[g,m]=d.useState(!1);d.useEffect(()=>{t||s?u():l([])},[t,s,r]),d.useEffect(()=>{a?.(n)},[n,a]);const u=async()=>{m(!0);try{let p=[];t?p=await h(t):s&&(p=await b(s)),l(p)}catch(p){console.error("Error detecting conflicts:",p)}finally{m(!1)}},h=async p=>{const j=[],I={_id:"temp",groupId:p.groupId,type:p.type,date:p.date,dayOfWeek:new Date(p.date).getDay(),startTime:p.startTime,endTime:p.endTime,location:p.location,attendance:{present:[],absent:[]},notes:p.notes||"",schoolYearId:"current",isActive:p.isActive,orchestra:i.find(R=>R._id===p.groupId)};for(const R of r){if(R.groupId===p.groupId&&R.date===p.date)continue;const A=Mt(I,R);A.hasConflict&&j.push({...A,conflictingRehearsal:R,affectedDate:p.date})}return j},b=async p=>{const j=[],I=C(p),R=i.find(A=>A._id===p.orchestraId);for(const A of I){const H={_id:"temp",groupId:p.orchestraId,type:R?.type||"×ª×–××•×¨×ª",date:A,dayOfWeek:new Date(A).getDay(),startTime:p.startTime,endTime:p.endTime,location:p.location,attendance:{present:[],absent:[]},notes:p.notes||"",schoolYearId:p.schoolYearId,isActive:!0,orchestra:R};for(const w of r){if(w.groupId===p.orchestraId&&w.date===A)continue;const F=Mt(H,w);F.hasConflict&&j.push({...F,conflictingRehearsal:w,affectedDate:A})}}return j},C=p=>{const j=[],I=new Date(p.startDate),R=new Date(p.endDate),A=p.dayOfWeek,H=new Set(p.excludeDates||[]),w=new Date(I);for(;w.getDay()!==A&&w<=R;)w.setDate(w.getDate()+1);for(;w<=R;){const F=w.toISOString().split("T")[0];H.has(F)||j.push(F),w.setDate(w.getDate()+7)}return j},N=p=>{switch(p){case"critical":return e.jsx(Ot,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(gt,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(Ve,{className:"w-5 h-5 text-green-600"})}},P=p=>{switch(p){case"location":return e.jsx(He,{className:"w-4 h-4"});case"conductor":return e.jsx(ve,{className:"w-4 h-4"});case"members":return e.jsx(fe,{className:"w-4 h-4"});case"time":return e.jsx(xe,{className:"w-4 h-4"});default:return e.jsx(Ve,{className:"w-4 h-4"})}},M=p=>{switch(p){case"critical":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-green-50 border-green-200 text-green-800"}},S=n.filter(p=>p.severity==="critical"),Y=n.filter(p=>p.severity==="warning");return g?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"×‘×•×“×§ ×”×ª× ×’×©×•×™×•×ª..."})]})}):n.length===0&&(t||s)?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 text-green-600 ml-2"}),e.jsx("span",{className:"text-sm text-green-800",children:"×œ× × ××¦××• ×”×ª× ×’×©×•×™×•×ª - × ×™×ª×Ÿ ×œ×™×¦×•×¨ ××ª ×”×—×–×¨×”"})]})}):n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"×¡×™×›×•× ×”×ª× ×’×©×•×™×•×ª"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[S.length>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(Ot,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[S.length," ×§×¨×™×˜×™×•×ª"]})]}),Y.length>0&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(gt,{className:"w-4 h-4 ml-1"}),e.jsxs("span",{children:[Y.length," ××–×”×¨×•×ª"]})]})]})]}),S.length>0&&e.jsx("p",{className:"text-sm text-red-800",children:"× ××¦××• ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×©××•× ×¢×•×ª ×™×¦×™×¨×ª ×”×—×–×¨×”. ×™×© ×œ×¤×ª×•×¨ ××•×ª×Ÿ ×œ×¤× ×™ ×”××©×š."}),Y.length>0&&S.length===0&&e.jsx("p",{className:"text-sm text-yellow-800",children:"× ××¦××• ××–×”×¨×•×ª ×©×›×“××™ ×œ×‘×“×•×§. × ×™×ª×Ÿ ×œ×”××©×™×š ×‘×™×¦×™×¨×ª ×”×—×–×¨×” ××š ××•××œ×¥ ×œ×•×•×“×."})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n.map((p,j)=>e.jsx("div",{className:`border rounded-lg p-3 ${M(p.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-2",children:[N(p.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[P(p.conflictType),e.jsx("span",{className:"font-medium text-sm",children:p.message})]}),p.conflictingRehearsal&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:p.conflictingRehearsal.orchestra?.name}),e.jsx("span",{children:Sr(p.conflictingRehearsal).fullDateTime}),e.jsx("span",{children:p.conflictingRehearsal.location})]})}),p.affectedDate&&e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:["×ª××¨×™×š ××ª× ×’×©: ",new Date(p.affectedDate).toLocaleDateString("he-IL")]})]})]})})},j))}),S.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"×¤×¢×•×œ×•×ª ××•××œ×¦×•×ª ×œ×¤×ª×¨×•×Ÿ:"}),e.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[S.some(p=>p.conflictType==="location")&&e.jsx("li",{children:"×©× ×” ××ª ××™×§×•× ×”×—×–×¨×” ××• ×‘×—×¨ ×–××Ÿ ××—×¨"}),S.some(p=>p.conflictType==="conductor")&&e.jsx("li",{children:"×ª×× ×¢× ×”×× ×¦×— ××• ×©× ×” ××ª ×–××Ÿ ×”×—×–×¨×”"}),S.some(p=>p.conflictType==="time")&&e.jsx("li",{children:"×‘×—×¨ ×–××Ÿ ××—×¨ ××• ×ª××¨×™×š ××—×¨"})]})]})]})}function Ar({orchestras:t,existingRehearsals:s=[],onSubmit:r,onCancel:i,initialData:a}){const[n,l]=d.useState("single"),[g,m]=d.useState(!1),[u,h]=d.useState({}),[b,C]=d.useState({groupId:"",type:"×ª×–××•×¨×ª",date:"",startTime:"19:00",endTime:"21:00",location:"",notes:"",isActive:!0,...a}),[N,P]=d.useState({orchestraId:"",startDate:"",endDate:"",dayOfWeek:0,startTime:"19:00",endTime:"21:00",location:"",notes:"",excludeDates:[],schoolYearId:"current"}),[M,S]=d.useState(""),[Y,p]=d.useState([]),[j,I]=d.useState(!1),[R,A]=d.useState(!1);d.useEffect(()=>{if(n==="single"&&b.groupId){const c=t.find(v=>v._id===b.groupId);c&&!b.location&&C(v=>({...v,location:c.location,type:c.type}))}},[b.groupId,t,n]),d.useEffect(()=>{if(n==="bulk"&&N.orchestraId){const c=t.find(v=>v._id===N.orchestraId);c&&!N.location&&P(v=>({...v,location:c.location}))}},[N.orchestraId,t,n]),d.useEffect(()=>{if(n==="bulk"&&N.startDate&&N.endDate&&N.dayOfWeek!==void 0)try{const c=Cr(N);p(c)}catch{p([])}else p([])},[n,N.startDate,N.endDate,N.dayOfWeek,N.excludeDates]);const H=(c,v)=>{C(B=>({...B,[c]:v})),u[c]&&h(B=>({...B,[c]:""}))},w=(c,v)=>{P(B=>({...B,[c]:v})),u[c]&&h(B=>({...B,[c]:""}))},F=()=>{M&&(P(c=>({...c,excludeDates:[...c.excludeDates||[],M]})),S(""))},O=c=>{P(v=>({...v,excludeDates:(v.excludeDates||[]).filter(B=>B!==c)}))},U=c=>{I(c.length>0),A(c.some(v=>v.severity==="critical"))},ae=async c=>{c.preventDefault(),m(!0),h({});try{if(R){h({submit:"×™×© ×œ×¤×ª×•×¨ ×”×ª× ×’×©×•×™×•×ª ×§×¨×™×˜×™×•×ª ×œ×¤× ×™ ×™×¦×™×¨×ª ×”×—×–×¨×”"});return}if(n==="single"){const v=Er(b);if(!v.isValid){h(v.errors);return}const f=new Date(b.date).getDay(),_={...b,dayOfWeek:f};await r(_,!1)}else{const v=Dr(N);if(!v.isValid){h(v.errors);return}await r(N,!0)}}catch(v){const{fieldErrors:B,generalMessage:f,isValidationError:_}=nt(v,"×©×’×™××” ×‘×©××™×¨×ª ×”×—×–×¨×”");h(_?{...B,submit:f}:{submit:f})}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:i,children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all",onClick:c=>c.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"×¢×¨×•×š ×—×–×¨×”":"×—×–×¨×” ×—×“×©×”"}),!a&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>l("single"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="single"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×” ×™×—×™×“×”"}),e.jsx("button",{type:"button",onClick:()=>l("bulk"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="bulk"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"×—×–×¨×•×ª ×—×•×–×¨×•×ª"})]})})]}),e.jsx("div",{className:"w-8"})]}),e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[n==="single"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:b.groupId||"",onChange:c=>H("groupId",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.groupId?"border-red-300":"border-gray-300"}`,disabled:!!a,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(c=>e.jsxs("option",{value:c._id,children:[c.name," (",c.type,")"]},c._id))]}),u.groupId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.groupId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:b.date||"",onChange:c=>H("date",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.date?"border-red-300":"border-gray-300"}`}),u.date&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:b.startTime||"",onChange:c=>H("startTime",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startTime?"border-red-300":"border-gray-300"}`}),u.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startTime})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©×¢×ª ×¡×™×•× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:b.endTime||"",onChange:c=>H("endTime",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endTime?"border-red-300":"border-gray-300"}`}),u.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(He,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:b.location||"",onChange:c=>H("location",c.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.location?"border-red-300":"border-gray-300"}`}),u.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:b.notes||"",onChange:c=>H("notes",c.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×”×—×–×¨×”...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 inline ml-1"}),"×ª×–××•×¨×ª ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:N.orchestraId||"",onChange:c=>w("orchestraId",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.orchestraId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"×‘×—×¨ ×ª×–××•×¨×ª"}),t.map(c=>e.jsxs("option",{value:c._id,children:[c.name," (",c.type,")"]},c._id))]}),u.orchestraId&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.orchestraId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline ml-1"}),"×ª××¨×™×š ×”×ª×—×œ×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:N.startDate||"",onChange:c=>w("startDate",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startDate?"border-red-300":"border-gray-300"}`}),u.startDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startDate})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×ª××¨×™×š ×¡×™×•× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:N.endDate||"",onChange:c=>w("endDate",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endDate?"border-red-300":"border-gray-300"}`}),u.endDate&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endDate})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×™×•× ×‘×©×‘×•×¢ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:N.dayOfWeek||0,onChange:c=>w("dayOfWeek",parseInt(c.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.dayOfWeek?"border-red-300":"border-gray-300"}`,children:Ir.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))}),u.dayOfWeek&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.dayOfWeek})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline ml-1"}),"×©×¢×ª ×”×ª×—×œ×” ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:N.startTime||"",onChange:c=>w("startTime",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.startTime?"border-red-300":"border-gray-300"}`}),u.startTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.startTime})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["×©×¢×ª ×¡×™×•× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",value:N.endTime||"",onChange:c=>w("endTime",c.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.endTime?"border-red-300":"border-gray-300"}`}),u.endTime&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.endTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(He,{className:"w-4 h-4 inline ml-1"}),"××™×§×•× ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:N.location||"",onChange:c=>w("location",c.target.value),placeholder:"×›×’×•×Ÿ: ××•×œ× ×¢×¨×Ÿ, ×¡×˜×•×“×™×• ×§×××¨×™ 1",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 ${u.location?"border-red-300":"border-gray-300"}`}),u.location&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.location})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×ª××¨×™×›×™× ×œ×“×™×œ×•×’"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:M,onChange:c=>S(c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"×‘×—×¨ ×ª××¨×™×š ×œ×“×™×œ×•×’"}),e.jsx("button",{type:"button",onClick:F,disabled:!M,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Re,{className:"w-4 h-4"})})]}),N.excludeDates&&N.excludeDates.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:N.excludeDates.map(c=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg px-2 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:new Date(c).toLocaleDateString("he-IL")}),e.jsx("button",{type:"button",onClick:()=>O(c),className:"mr-1 text-gray-500 hover:text-red-600",children:e.jsx(Us,{className:"w-3 h-3"})})]},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"×”×¢×¨×•×ª"}),e.jsx("textarea",{value:N.notes||"",onChange:c=>w("notes",c.target.value),rows:3,placeholder:"×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ×”×—×–×¨×•×ª...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),Y.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600 ml-1"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["×ª×™×•×•×¦×¨×• ",Y.length," ×—×–×¨×•×ª"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 max-h-32 overflow-y-auto",children:[Y.slice(0,10).map(c=>e.jsxs("div",{children:[new Date(c).toLocaleDateString("he-IL")," - ",It(new Date(c).getDay())]},c)),Y.length>10&&e.jsxs("div",{className:"text-blue-600",children:["...×•×¢×•×“ ",Y.length-10]})]})]})]}),e.jsx(_r,{newRehearsal:n==="single"?b:null,bulkData:n==="bulk"?N:null,existingRehearsals:s,orchestras:t,onConflictsChanged:U}),u.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:u.submit})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"×‘×™×˜×•×œ"}),e.jsx("button",{type:"submit",disabled:g||R,className:`px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors ${g||R?"opacity-50 cursor-not-allowed":""}`,children:g?"×©×•××¨...":a?"×¢×“×›×Ÿ ×—×–×¨×”":n==="single"?"×¦×•×¨ ×—×–×¨×”":`×¦×•×¨ ${Y.length} ×—×–×¨×•×ª`})]})]})]})})})}const Or=[{name:"××™×“×¢ ×›×œ×œ×™",href:"/dashboard",icon:ze,category:"general"},{name:"×ª×œ××™×“×™×",href:"/students",icon:fe,category:"management",roles:["admin"]},{name:"××•×¨×™×",href:"/teachers",icon:Qt,category:"management",roles:["admin"]},{name:"×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:Ye,category:"management",roles:["admin"]},{name:"×ª×–××•×¨×•×ª",href:"/orchestras",icon:st,category:"management",roles:["admin"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:le,category:"management",roles:["admin"]},{name:"×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:wt,category:"management",roles:["admin"]},{name:"× ×•×›×—×•×ª",href:"/teachers",icon:rt,category:"operations",roles:["admin"]},{name:"×”×’×“×¨×•×ª",href:"/settings",icon:ft,category:"system",roles:["admin"]}],Rr=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:ze,category:"general"},{name:"×”×ª×œ××™×“×™× ×©×œ×™",href:"/students",icon:fe,category:"personal",roles:["teacher"]},{name:"×œ×•×— ×–×× ×™× ×©×œ×™",href:"/profile",icon:le,category:"personal",roles:["teacher"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=attendance",icon:rt,category:"operations",roles:["teacher"]},{name:"× ×™×”×•×œ ×‘×’×¨×•×™×•×ª",href:"/bagruts",icon:wt,category:"operations",roles:["teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ve,category:"personal"}],$r=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:ze,category:"general"},{name:"×”×ª×–××•×¨×•×ª ×©×œ×™",href:"/orchestras",icon:st,category:"personal",roles:["conductor"]},{name:"×—×–×¨×•×ª",href:"/rehearsals",icon:le,category:"personal",roles:["conductor"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=orchestras",icon:rt,category:"operations",roles:["conductor"]},{name:"× ×™×”×•×œ ×¨×™×©×•××™×",href:"/conductor/enrollment",icon:Kt,category:"operations",roles:["conductor"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ve,category:"personal"}],Pr=[{name:"×œ×•×— ×‘×§×¨×”",href:"/dashboard",icon:ze,category:"general"},{name:"×”×©×™×¢×•×¨×™× ×©×œ×™",href:"/theory-lessons",icon:Ye,category:"personal",roles:["theory-teacher"]},{name:"×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”",href:"/theory-lessons",icon:fe,category:"personal",roles:["theory-teacher"]},{name:"× ×•×›×—×•×ª",href:"/profile?tab=lessons",icon:rt,category:"operations",roles:["theory-teacher"]},{name:"×ª×›× ×™×ª ×œ×™××•×“×™×",href:"/theory-lessons",icon:Hs,category:"personal",roles:["theory-teacher"]},{name:"×¤×¨×•×¤×™×œ",href:"/profile",icon:ve,category:"personal"}],Lr={admin:[{name:"×”×•×¡×£ ×ª×œ××™×“ ×—×“×©",href:"/students/new",icon:fe,role:"admin"},{name:"×”×•×¡×£ ××•×¨×” ×—×“×©",href:"/teachers/new",icon:Qt,role:"admin"},{name:"×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:Ye,role:"admin"},{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:le,role:"admin"}],teacher:[{name:"×”×•×¡×£ ×©×™×¢×•×¨",href:"/profile?tab=students&action=addStudent",icon:Re,role:"teacher"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/profile?tab=attendance",icon:Rt,role:"teacher"},{name:"×¦×¤×” ×‘×œ×•×— ×–×× ×™×",href:"/profile?tab=schedule",icon:xe,role:"teacher"}],conductor:[{name:"×ª×–××Ÿ ×—×–×¨×”",href:"/rehearsals/new",icon:$t,role:"conductor"},{name:"× ×”×œ ×ª×–××•×¨×ª",href:"/orchestras",icon:st,role:"conductor"},{name:"×¡××Ÿ × ×•×›×—×•×ª",href:"/profile?tab=orchestras",icon:Rt,role:"conductor"}],"theory-teacher":[{name:"×ª×–××Ÿ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”",href:"/theory-lessons/new",icon:$t,role:"theory-teacher"},{name:"× ×”×œ ×§×‘×•×¦×•×ª",href:"/theory-lessons",icon:Kt,role:"theory-teacher"},{name:"×“×¨×’ ×ª×œ××™×“×™×",href:"/theory-lessons",icon:wt,role:"theory-teacher"}]};function Fr(){const t=_s(),s=tt(),{user:r,isLoading:i}=$e(),{isDesktopOpen:a,setIsDesktopOpen:n,isMobile:l}=Tt(),[g,m]=d.useState(""),[u,h]=d.useState(!1),[b,C]=d.useState(new Set),[N,P]=d.useState(!1),[M,S]=d.useState(!1),[Y,p]=d.useState(!1),[j,I]=d.useState(!1),[R,A]=d.useState([]),[H,w]=d.useState(!1),F=d.useCallback(T=>t.pathname===T,[t.pathname]),O=()=>{if(!r)return[];const T=[];return r.role&&T.push(r.role),r.roles&&Array.isArray(r.roles)&&T.push(...r.roles),r.teaching?.studentIds?.length>0&&!T.includes("teacher")&&!T.includes("××•×¨×”")&&T.push("teacher"),r.conducting?.orchestraIds?.length>0&&!T.includes("conductor")&&!T.includes("×× ×¦×—")&&T.push("conductor"),[...new Set(T.map(z=>z==="theory_teacher"?"theory-teacher":z==="×× ×”×œ"?"admin":z==="××•×¨×”"?"teacher":z==="×× ×¦×—"?"conductor":z==="××•×¨×” ×ª×™××•×¨×™×”"?"theory-teacher":z))]},U=d.useMemo(()=>O(),[r]),ae=d.useMemo(()=>U.includes("admin"),[U]),c=d.useMemo(()=>U.length>1,[U]),v=()=>{if(ae){const V=[...Or],G=V.findIndex(te=>te.name==="× ×•×›×—×•×ª");if(G!==-1){let te="/teachers";U.includes("teacher")?te="/profile?tab=attendance":U.includes("conductor")?te="/profile?tab=orchestras":U.includes("theory-teacher")&&(te="/profile?tab=lessons"),V[G]={...V[G],href:te}}return V}const T=new Map,z=[];return U.includes("teacher")&&z.push(...Rr),U.includes("conductor")&&z.push(...$r),U.includes("theory-teacher")&&z.push(...Pr),z.forEach(V=>{const G=V.href;if(!T.has(G))T.set(G,V);else{const te=T.get(G);V.roles&&te.roles&&(te.roles=[...new Set([...te.roles,...V.roles])])}}),Array.from(T.values())},B=()=>{const T=[],z=new Map;return U.forEach(V=>{const G=Lr[V];G&&G.forEach(te=>{const Xe=`${te.href}-${te.name}`;z.has(Xe)||(z.set(Xe,!0),T.push(te))})}),T},f=T=>{const z={general:{label:"×›×œ×œ×™",items:[]},personal:{label:"××–×•×¨ ××™×©×™",items:[]},management:{label:"× ×™×”×•×œ ××¢×¨×›×ª",items:[]},operations:{label:"×¤×¢×•×œ×•×ª",items:[]},system:{label:"××¢×¨×›×ª",items:[]}};return T.forEach(V=>{const G=V.category||"general";z[G]&&z[G].items.push(V)}),Object.entries(z).filter(([V,G])=>G.items.length>0).map(([V,G])=>({key:V,...G}))},_=d.useMemo(()=>v(),[U,ae]),D=d.useMemo(()=>f(_),[_]),$=d.useMemo(()=>B(),[U]);d.useEffect(()=>{l||h(!1)},[l]),d.useEffect(()=>{const T=z=>{if(l&&u){const V=document.getElementById("mobile-sidebar"),G=document.getElementById("hamburger-button");V&&!V.contains(z.target)&&G&&!G.contains(z.target)&&h(!1)}};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[l,u]),d.useEffect(()=>(l&&u?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[l,u]);const L=d.useCallback(()=>{l&&h(!1)},[l]),X=d.useCallback(T=>{C(z=>{const V=new Set(z);return V.has(T)?V.delete(T):V.add(T),V})},[]),De=T=>{switch(T){case"admin":return"×× ×”×œ";case"teacher":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"theory-teacher":return"××•×¨×” ×ª×™××•×¨×™×”";default:return T}},Le=T=>{switch(T){case"admin":return"bg-red-100 text-red-700";case"teacher":return"bg-blue-100 text-blue-700";case"conductor":return"bg-green-100 text-green-700";case"theory-teacher":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},_e=async(T,z)=>{L(),T==="×”×•×¡×£ ×ª×œ××™×“ ×—×“×©"?P(!0):T==="×”×•×¡×£ ××•×¨×” ×—×“×©"?S(!0):T==="×¦×•×¨ ×©×™×¢×•×¨ ×ª×™××•×¨×™×”"?p(!0):T==="×ª×–××Ÿ ×—×–×¨×”"?(await Ae(),I(!0)):s(z)},Ae=async()=>{try{w(!0);const T=await Ls.getOrchestras();A(T||[])}catch(T){console.error("Failed to load orchestras:",T),A([])}finally{w(!1)}},qe=async T=>{P(!1)},we=async()=>{S(!1)},ce=async T=>{p(!1)},Te=async T=>{I(!1)};return e.jsxs(e.Fragment,{children:[l&&e.jsx("button",{id:"hamburger-button",onClick:()=>h(!u),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-gray-50 transition-colors duration-200","aria-label":"Toggle menu",children:u?e.jsx(je,{className:"w-6 h-6 text-gray-600"}):e.jsx(dt,{className:"w-6 h-6 text-gray-600"})}),!l&&!a&&e.jsx("button",{onClick:()=>n(!0),className:"fixed top-[20px] right-4 z-[60] p-2 bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200","aria-label":"Open sidebar",children:e.jsx(dt,{className:"w-5 h-5 text-indigo-600"})}),l&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[50] transition-opacity duration-300",onClick:()=>h(!1)}),e.jsxs("div",{id:"sidebar",className:`fixed top-0 right-0 w-[280px] h-screen bg-white border-l border-gray-200 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.1)] rtl z-[55] transition-transform duration-300 ease-in-out flex flex-col ${l?u?"translate-x-0":"translate-x-full":a?"translate-x-0":"translate-x-full"}`,children:[!l&&e.jsx("button",{onClick:()=>n(!a),className:"absolute top-4 left-4 p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 transition-all duration-200 z-10","aria-label":"Toggle sidebar",children:a?e.jsx(je,{className:"w-5 h-5 text-gray-600"}):e.jsx(dt,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("div",{className:"p-4 border-b border-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"×—×™×¤×•×©...",value:g,onChange:T=>m(T.target.value),className:"w-full pr-10 pl-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm font-reisinger-yonatan text-right rtl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),c&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(T=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${Le(T)}`,children:[e.jsx(Vs,{className:"w-3 h-3"}),De(T)]},T))})}),e.jsx("nav",{className:"flex-1 px-3 py-4 overflow-y-auto overflow-x-hidden min-h-0 custom-scrollbar",children:i?e.jsx("div",{className:"space-y-2 px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})}):e.jsxs(e.Fragment,{children:[D.map((T,z)=>e.jsxs("div",{className:z>0?"mt-6":"",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("button",{onClick:()=>X(T.key),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-500 uppercase tracking-wider hover:text-gray-700 transition-colors",children:[e.jsx("span",{children:T.label}),e.jsx(ge,{className:`w-3 h-3 transition-transform ${b.has(T.key)?"rotate-180":""}`})]})}),!b.has(T.key)&&e.jsx("div",{className:"space-y-1",children:T.items.map(V=>{const G=V.icon,te=F(V.href);return e.jsxs(Ee,{to:V.href,onClick:L,className:`flex items-center justify-between px-4 py-3 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan ${te?"bg-primary-50 text-primary-700 border border-primary-200":"text-gray-600 hover:bg-gray-50 hover:text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:V.name}),c&&V.roles&&V.roles.length===1&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${Le(V.roles[0])}`,children:De(V.roles[0])})]}),e.jsx(G,{className:"w-4 h-4 flex-shrink-0"})]},`${T.key}-${V.href}-${V.name}`)})})]},T.key)),$.length>0&&e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-6 mt-6",children:[e.jsx("h3",{className:"px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"×¤×¢×•×œ×•×ª ××”×™×¨×•×ª"}),$.map(T=>{const z=T.icon;return e.jsxs("button",{onClick:()=>_e(T.name,T.href),className:"w-full flex items-center justify-between px-4 py-2 mx-3 rounded-lg text-sm font-medium transition-all duration-150 rtl font-reisinger-yonatan text-gray-600 hover:bg-green-50 hover:text-green-700 group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-right",children:T.name}),c&&T.role&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${Le(T.role)}`,children:De(T.role)})]}),e.jsxs("div",{className:"flex items-center space-x-1 space-x-reverse",children:[e.jsx(Re,{className:"w-3 h-3 group-hover:text-green-500"}),e.jsx(z,{className:"w-3.5 h-3.5"})]})]},`${T.href}-${T.name}-${T.role}`)})]})]})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(br,{onSubmit:qe,onCancel:()=>P(!1),isEdit:!1,initialData:null})})}),M&&e.jsx(wr,{isOpen:M,onClose:()=>S(!1),onSuccess:we}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Tr,{onSubmit:ce,onCancel:()=>p(!1)})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:H?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×ª×–××•×¨×•×ª..."})]}):e.jsx(Ar,{orchestras:R,onSubmit:Te,onCancel:()=>I(!1)})})})]})}function Br(){const[t,s]=d.useState(!1),r=d.useRef(null),{currentSchoolYear:i,schoolYears:a,isLoading:n,setCurrentSchoolYearById:l,getSchoolYearDisplayName:g}=ss();d.useEffect(()=>{const u=h=>{r.current&&!r.current.contains(h.target)&&s(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const m=async u=>{await l(u),s(!1)};return n?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]}):e.jsxs("div",{className:"relative",ref:r,children:[e.jsxs("button",{onClick:()=>s(!t),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-all duration-150 ease-in-out min-w-[200px]",style:{direction:"rtl"},children:[e.jsx(le,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan flex-grow text-right truncate",children:i?g(i):"×‘×—×¨ ×©× ×ª ×œ×™××•×“"}),t?e.jsx(Oe,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}):e.jsx(ge,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-full min-w-[250px] bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[1000]",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide font-reisinger-yonatan text-right",children:"×©× ×•×ª ×œ×™××•×“"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:a.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 font-reisinger-yonatan text-center",children:"×œ× × ××¦××• ×©× ×•×ª ×œ×™××•×“"}):a.sort((u,h)=>new Date(h.startDate).getTime()-new Date(u.startDate).getTime()).map(u=>{const h=i?._id===u._id,b=u.isCurrent,C=u.isActive;return e.jsxs("button",{onClick:()=>m(u._id),className:`w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 ${h?"bg-indigo-50 border-l-4 border-indigo-500":""}`,style:{direction:"rtl"},children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium font-reisinger-yonatan ${h?"text-indigo-700":"text-gray-700"}`,children:u.name}),b&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"× ×•×›×—×™×ª"}),!C&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"×œ× ×¤×¢×™×œ×”"})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-reisinger-yonatan",children:[new Date(u.startDate).toLocaleDateString("he-IL")," - ",new Date(u.endDate).toLocaleDateString("he-IL")]})]}),h&&e.jsx(Ys,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"})]},u._id)})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:e.jsx("button",{className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium font-reisinger-yonatan",children:"+ ×”×•×¡×£ ×©× ×ª ×œ×™××•×“ ×—×“×©×”"})})]})]})}function Mr(){const[t,s]=d.useState(!1),r=d.useRef(null),i=tt(),{user:a,logout:n}=$e(),{isDesktopOpen:l,isMobile:g}=Tt(),m=a&&(a.role==="admin"||a.roles?.includes("admin")||a.role==="×× ×”×œ"||a.roles?.includes("×× ×”×œ")),u=a&&(a.role==="admin"||a.roles?.includes("admin")||a.role==="×× ×”×œ"||a.roles?.includes("×× ×”×œ")||a.role==="teacher"||a.roles?.includes("teacher")||a.role==="××•×¨×”"||a.roles?.includes("××•×¨×”")||a.role==="conductor"||a.roles?.includes("conductor")||a.role==="×× ×¦×—"||a.roles?.includes("×× ×¦×—")||a.role==="theory-teacher"||a.roles?.includes("theory-teacher")||a.role==="theory_teacher"||a.roles?.includes("theory_teacher")||a.role==="××•×¨×” ×ª×™××•×¨×™×”"||a.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||a.teaching?.studentIds?.length>0||a.conducting?.orchestraIds?.length>0);d.useEffect(()=>{const S=Y=>{r.current&&!r.current.contains(Y.target)&&s(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]);const h=()=>{i("/profile"),s(!1)},b=async()=>{try{await n(),i("/login")}catch(S){console.error("Logout error:",S)}s(!1)},C=()=>{i("/dashboard")},N=()=>{const S=a?.personalInfo?.fullName||a?.fullName||a?.name||"";if(!S)return"×";const Y=S.trim().split(" ");return Y.length>=2?Y[0][0]+Y[1][0]:Y[0][0]||"×"},P=()=>a?.personalInfo?.fullName||a?.fullName||a?.name||"××©×ª××©",M=()=>{const S=a?.role||a?.roles?.[0]||"";switch(S){case"teacher":return"××•×¨×”";case"××•×¨×”":return"××•×¨×”";case"conductor":return"×× ×¦×—";case"×× ×¦×—":return"×× ×¦×—";case"theory_teacher":return"××•×¨×” ×ª×™××•×¨×™×”";case"××•×¨×” ×ª×™××•×¨×™×”":return"××•×¨×” ×ª×™××•×¨×™×”";case"admin":return"×× ×”×œ";case"×× ×”×œ":return"×× ×”×œ";default:return S||"××©×ª××©"}};return e.jsxs("header",{className:"fixed top-0 left-0 h-16 bg-white border-b border-gray-200 flex items-center justify-between z-[45] transition-all duration-300",style:{direction:"rtl",width:u&&!g&&l?"calc(100% - 280px)":"100%",paddingLeft:"1.5rem",paddingRight:u&&!g&&!l?"4rem":"1.5rem"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-10 w-auto object-contain"}),e.jsx(Br,{})]}),e.jsxs("div",{className:"flex items-center gap-4",style:{direction:"ltr"},children:[!g&&e.jsx(e.Fragment,{children:!m&&e.jsx("button",{onClick:C,className:"w-10 h-10 rounded-lg bg-indigo-50 border border-indigo-200 flex items-center justify-center hover:bg-indigo-100 hover:border-indigo-300 transition-all duration-150 ease-in-out cursor-pointer",title:"×œ×•×— ×‘×§×¨×”",children:e.jsx(ze,{className:"w-5 h-5 text-indigo-600"})})}),e.jsxs("div",{className:"relative",ref:r,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center cursor-pointer hover:bg-indigo-700 transition-colors",onClick:()=>s(!t),children:e.jsx("span",{className:"text-sm font-semibold text-white font-reisinger-yonatan",children:N()})}),t&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-[70]",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:P()}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:M()})]}),e.jsxs("button",{onClick:h,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 font-reisinger-yonatan",children:"×¢××•×“ ××™×©×™"}),e.jsx(ve,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs("button",{onClick:b,className:"w-full px-4 py-3 text-right hover:bg-gray-50 flex items-center justify-between transition-colors duration-150 text-red-600 hover:bg-red-50",style:{direction:"rtl"},children:[e.jsx("span",{className:"text-sm font-medium font-reisinger-yonatan",children:"×™×¦×™××”"}),e.jsx(zs,{className:"w-4 h-4"})]})]})]})]})]})}function K({children:t}){const{user:s}=$e(),{isDesktopOpen:r,isMobile:i}=Tt(),a=s&&(s.role==="admin"||s.roles?.includes("admin")||s.role==="×× ×”×œ"||s.roles?.includes("×× ×”×œ")||s.role==="teacher"||s.roles?.includes("teacher")||s.role==="××•×¨×”"||s.roles?.includes("××•×¨×”")||s.role==="conductor"||s.roles?.includes("conductor")||s.role==="×× ×¦×—"||s.roles?.includes("×× ×¦×—")||s.role==="theory-teacher"||s.roles?.includes("theory-teacher")||s.role==="theory_teacher"||s.roles?.includes("theory_teacher")||s.role==="××•×¨×” ×ª×™××•×¨×™×”"||s.roles?.includes("××•×¨×” ×ª×™××•×¨×™×”")||s.teaching?.studentIds?.length>0||s.conducting?.orchestraIds?.length>0);return e.jsxs("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[a&&e.jsx(Fr,{}),e.jsx(Mr,{}),e.jsx("main",{className:"mt-16 ml-0 p-0 bg-gray-50 min-h-[calc(100vh-64px)] rtl transition-all duration-300",style:{marginRight:a&&!i&&r?"280px":"0"},children:e.jsx("div",{className:"p-6 bg-gray-50",children:t})})]})}function Ur(){const[t,s]=d.useState(""),[r,i]=d.useState(""),[a,n]=d.useState(""),[l,g]=d.useState(!1),m=tt(),{login:u}=$e(),h=async b=>{b.preventDefault(),n(""),g(!0),console.log("ğŸ” Login attempt started:",{email:t,password:"***"}),console.log("ğŸŒ API Base URL:","/api"),console.log("ğŸ”§ Environment check:",{VITE_API_URL:"/api",fallback:"http://localhost:3001/api",actual:"/api"});try{console.log("ğŸ“¤ Sending login request to API service...");const C=await u(t,r);console.log("âœ… Login successful:",{user:C.user?.personalInfo?.fullName||"Unknown"}),console.log("ğŸ”‘ Authentication token stored successfully"),console.log("ğŸ§­ Navigating to dashboard..."),m("/dashboard")}catch(C){console.error("âŒ Login failed:",C),console.error("ğŸ“ Error details:",{message:C.message,stack:C.stack}),n(C.message||"×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª. ×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×•× ×¡×” ×©×•×‘.")}finally{g(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×›× ×™×¡×” ×œ××¢×¨×›×ª"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:h,children:[a&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:a})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:l,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:b=>s(b.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:l,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××”",value:r,onChange:b=>i(b.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"××ª×—×‘×¨..."]}):"×›× ×™×¡×”"})}),e.jsx("div",{className:"text-center",children:e.jsx(Ee,{to:"/forgot-password",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×©×›×—×ª×™ ×¡×™×¡××"})})]})]})})]})}function Vr(){const[t,s]=d.useState(""),[r,i]=d.useState(!1),[a,n]=d.useState(!1),[l,g]=d.useState(""),m=async u=>{u.preventDefault(),g(""),i(!0);try{await Wt.forgotPassword(t),n(!0)}catch(h){g(h.message||"×©×’×™××” ×‘×©×œ×™×—×ª ×‘×§×©×ª ××™×¤×•×¡ ×¡×™×¡××”")}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"×©×›×—×ª×™ ×¡×™×¡××"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:'×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”×“×•×"×œ ×©×œ×š ×•× ×©×œ×— ×œ×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”'})]}),a?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan",children:'×× ×§×™×™× ×—×©×‘×•×Ÿ ×¢× ×›×ª×•×‘×ª ×“×•×"×œ ×–×•, × ×©×œ×— ××œ×™×š ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”. ×× × ×‘×“×•×§ ××ª ×ª×™×‘×ª ×”×“×•××¨ ×©×œ×š.'})}),e.jsx("div",{className:"text-center",children:e.jsx(Ee,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[l&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:l})}),e.jsx("div",{className:"rounded-md shadow-sm",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only font-reisinger-yonatan",children:'×›×ª×•×‘×ª ×“×•×"×œ'}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,disabled:r,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×›×ª×•×‘×ª ×“×•××´×œ",value:t,onChange:u=>s(u.target.value),dir:"ltr",style:{textAlign:"left"}})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×©×•×œ×—..."]}):"×©×œ×— ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsx("div",{className:"text-center",children:e.jsx(Ee,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})})]})]})})]})}function Hr(){const{token:t}=As(),[s,r]=d.useState(""),[i,a]=d.useState(""),[n,l]=d.useState(!1),[g,m]=d.useState(""),[u,h]=d.useState(!1),b=tt();d.useEffect(()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),t||m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”.")},[t]);const C=async N=>{if(N.preventDefault(),m(""),s.length<6){m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×");return}if(s!==i){m("×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª");return}if(!t){m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ");return}l(!0);try{await Wt.resetPassword(t,s),h(!0),setTimeout(()=>{b("/login")},3e3)}catch(P){const M=P.message||P.error||"×©×’×™××” ×‘××™×¤×•×¡ ×”×¡×™×¡××”";M.includes("expired")||M.includes("RESET_TOKEN_EXPIRED")?m("×ª×•×§×£ ×”×§×™×©×•×¨ ×¤×’. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):M.includes("invalid")||M.includes("INVALID_RESET_TOKEN")?m("×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ. ×× × ×‘×§×© ×§×™×©×•×¨ ×—×“×© ×œ××™×¤×•×¡ ×¡×™×¡××”."):M.includes("password")||M.includes("WEAK_PASSWORD")?m("×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×"):m(M)}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",style:{backgroundImage:'url("/login-background.jpg")',backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"max-w-md w-full space-y-8 relative z-10",children:e.jsxs("div",{className:"backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white drop-shadow-lg",style:{fontFamily:"'Reisinger Yonatan', 'Arial Hebrew', 'Noto Sans Hebrew', Arial, sans-serif"},children:"××™×¤×•×¡ ×¡×™×¡××”"}),e.jsx("p",{className:"mt-2 text-center text-sm text-white/80 font-reisinger-yonatan",children:"×”×–×Ÿ ×¡×™×¡××” ×—×“×©×” ×œ×—×©×‘×•×Ÿ ×©×œ×š"})]}),u?e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-500/20 border border-green-500/50 rounded-lg backdrop-blur-sm",children:[e.jsx("p",{className:"text-green-100 text-center font-reisinger-yonatan",children:"×”×¡×™×¡××” ××•×¤×¡×” ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×ª×•×›×œ ×œ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡××” ×”×—×“×©×”."}),e.jsx("p",{className:"text-green-100 text-sm text-center font-reisinger-yonatan mt-2",children:"××¢×‘×™×¨ ××•×ª×š ×œ×“×£ ×”×›× ×™×¡×”..."})]}),e.jsx("div",{className:"text-center",children:e.jsx(Ee,{to:"/login",className:"font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×” ×¢×›×©×™×•"})})]}):e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:C,children:[g&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-red-100 text-sm text-center font-reisinger-yonatan",children:g})}),e.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only font-reisinger-yonatan",children:"×¡×™×¡××” ×—×“×©×”"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"×¡×™×¡××” ×—×“×©×” (×œ×¤×—×•×ª 6 ×ª×•×•×™×)",value:s,onChange:N=>r(N.target.value),dir:"ltr",style:{textAlign:"left"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"sr-only font-reisinger-yonatan",children:"××™××•×ª ×¡×™×¡××”"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,disabled:n||!t,className:"relative block w-full px-3 py-3 border border-white/30 placeholder-gray-400 text-gray-900 rounded-lg bg-white/80 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm placeholder:text-right font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"××™××•×ª ×¡×™×¡××”",value:i,onChange:N=>a(N.target.value),dir:"ltr",style:{textAlign:"left"}})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:n||!t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600/90 hover:bg-blue-700/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg font-reisinger-yonatan disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"×××¤×¡ ×¡×™×¡××”..."]}):"××™×¤×•×¡ ×¡×™×¡××”"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(Ee,{to:"/forgot-password",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×‘×§×© ×§×™×©×•×¨ ×—×“×©"}),e.jsx(Ee,{to:"/login",className:"block font-medium text-white/90 hover:text-white drop-shadow transition-colors duration-200 font-reisinger-yonatan underline",children:"×—×–×•×¨ ×œ×“×£ ×”×›× ×™×¡×”"})]})]})]})})]})}function ne(t,s,r=3){return d.lazy(()=>{let i=0;const a=async()=>{try{const n=await t();return console.log(`âœ… Successfully loaded ${s}`),n}catch(n){if(console.error(`âŒ Failed to load ${s}, attempt ${i+1}/${r}:`,n),i<r-1){i++;const l=Math.min(1e3*Math.pow(2,i),5e3);return await new Promise(g=>setTimeout(g,l)),a()}else throw console.error(`âŒ All retry attempts failed for ${s}`),n}};return a()})}class Yr{constructor(){ct(this,"preloadedComponents",new Set);ct(this,"preloadPromises",new Map)}preload(s,r){if(this.preloadedComponents.has(s))return Promise.resolve();if(this.preloadPromises.has(s))return this.preloadPromises.get(s);const i=r().then(a=>(this.preloadedComponents.add(s),console.log(`âœ… Preloaded ${s}`),a)).catch(a=>{throw console.error(`âŒ Failed to preload ${s}:`,a),a}).finally(()=>{this.preloadPromises.delete(s)});return this.preloadPromises.set(s,i),i}preloadOnHover(s,r){return()=>{this.preloadedComponents.has(s)||this.preload(s,r)}}getPreloadStats(){return{preloadedComponents:Array.from(this.preloadedComponents),pendingPreloads:Array.from(this.preloadPromises.keys())}}}const ut=new Yr,mt={STUDENT_DETAILS:"StudentDetailsPage",THEORY_TAB:"TheoryTab",ORCHESTRA_TAB:"OrchestraTab",DASHBOARD:"Dashboard",STUDENTS_LIST:"Students"};function zr(){setTimeout(()=>{ut.preload(mt.DASHBOARD,()=>re(()=>import("../chunks/Dashboard-CWC_hNKO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ut.preload(mt.STUDENTS_LIST,()=>re(()=>import("../chunks/Students-BPYz6WTN.js"),__vite__mapDeps([9,1,3,4,10,7,5,6])))},1e3),setTimeout(()=>{ut.preload(mt.STUDENT_DETAILS,()=>re(()=>import("../chunks/StudentDetailsPageSimple-BgBP7wnH.js"),__vite__mapDeps([11,1,7,5,6,3,12,13,14,4])))},3e3)}function Wr(){const t=document.head,s=document.createElement("link");s.rel="dns-prefetch",s.href="//localhost",t.appendChild(s);const r=document.createElement("link");r.rel="preconnect",r.href="http://localhost:3001",r.crossOrigin="anonymous",t.appendChild(r);const i=document.createElement("link");i.rel="prefetch",i.as="style",i.href="/src/index.css",t.appendChild(i)}function qr(){typeof window>"u"||(Wr(),zr(),console.log("ğŸš€ Bundle optimizations initialized"))}let Xr={data:""},Gr=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||Xr,Qr=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Kr=/\/\*[^]*?\*\/|  +/g,Ut=/\n+/g,ye=(t,s)=>{let r="",i="",a="";for(let n in t){let l=t[n];n[0]=="@"?n[1]=="i"?r=n+" "+l+";":i+=n[1]=="f"?ye(l,n):n+"{"+ye(l,n[1]=="k"?"":s)+"}":typeof l=="object"?i+=ye(l,s?s.replace(/([^,])+/g,g=>n.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,m=>/&/.test(m)?m.replace(/&/g,g):g?g+" "+m:m)):n):l!=null&&(n=/^--/.test(n)?n:n.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=ye.p?ye.p(n,l):n+":"+l+";")}return r+(s&&a?s+"{"+a+"}":a)+i},he={},ls=t=>{if(typeof t=="object"){let s="";for(let r in t)s+=r+ls(t[r]);return s}return t},Jr=(t,s,r,i,a)=>{let n=ls(t),l=he[n]||(he[n]=(m=>{let u=0,h=11;for(;u<m.length;)h=101*h+m.charCodeAt(u++)>>>0;return"go"+h})(n));if(!he[l]){let m=n!==t?t:(u=>{let h,b,C=[{}];for(;h=Qr.exec(u.replace(Kr,""));)h[4]?C.shift():h[3]?(b=h[3].replace(Ut," ").trim(),C.unshift(C[0][b]=C[0][b]||{})):C[0][h[1]]=h[2].replace(Ut," ").trim();return C[0]})(t);he[l]=ye(a?{["@keyframes "+l]:m}:m,r?"":"."+l)}let g=r&&he.g?he.g:null;return r&&(he.g=he[l]),((m,u,h,b)=>{b?u.data=u.data.replace(b,m):u.data.indexOf(m)===-1&&(u.data=h?m+u.data:u.data+m)})(he[l],s,i,g),l},Zr=(t,s,r)=>t.reduce((i,a,n)=>{let l=s[n];if(l&&l.call){let g=l(r),m=g&&g.props&&g.props.className||/^go/.test(g)&&g;l=m?"."+m:g&&typeof g=="object"?g.props?"":ye(g,""):g===!1?"":g}return i+a+(l??"")},"");function lt(t){let s=this||{},r=t.call?t(s.p):t;return Jr(r.unshift?r.raw?Zr(r,[].slice.call(arguments,1),s.p):r.reduce((i,a)=>Object.assign(i,a&&a.call?a(s.p):a),{}):r,Gr(s.target),s.g,s.o,s.k)}let os,jt,vt;lt.bind({g:1});let pe=lt.bind({k:1});function ea(t,s,r,i){ye.p=s,os=t,jt=r,vt=i}function Ne(t,s){let r=this||{};return function(){let i=arguments;function a(n,l){let g=Object.assign({},n),m=g.className||a.className;r.p=Object.assign({theme:jt&&jt()},g),r.o=/ *go\d+/.test(m),g.className=lt.apply(r,i)+(m?" "+m:"");let u=t;return t[0]&&(u=g.as||t,delete g.as),vt&&u[0]&&vt(g),os(u,g)}return a}}var ta=t=>typeof t=="function",et=(t,s)=>ta(t)?t(s):t,sa=(()=>{let t=0;return()=>(++t).toString()})(),is=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let s=matchMedia("(prefers-reduced-motion: reduce)");t=!s||s.matches}return t}})(),ra=20,St="default",cs=(t,s)=>{let{toastLimit:r}=t.settings;switch(s.type){case 0:return{...t,toasts:[s.toast,...t.toasts].slice(0,r)};case 1:return{...t,toasts:t.toasts.map(l=>l.id===s.toast.id?{...l,...s.toast}:l)};case 2:let{toast:i}=s;return cs(t,{type:t.toasts.find(l=>l.id===i.id)?1:0,toast:i});case 3:let{toastId:a}=s;return{...t,toasts:t.toasts.map(l=>l.id===a||a===void 0?{...l,dismissed:!0,visible:!1}:l)};case 4:return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(l=>l.id!==s.toastId)};case 5:return{...t,pausedAt:s.time};case 6:let n=s.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(l=>({...l,pauseDuration:l.pauseDuration+n}))}}},Je=[],ds={toasts:[],pausedAt:void 0,settings:{toastLimit:ra}},ue={},us=(t,s=St)=>{ue[s]=cs(ue[s]||ds,t),Je.forEach(([r,i])=>{r===s&&i(ue[s])})},ms=t=>Object.keys(ue).forEach(s=>us(t,s)),aa=t=>Object.keys(ue).find(s=>ue[s].toasts.some(r=>r.id===t)),ot=(t=St)=>s=>{us(s,t)},na={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},la=(t={},s=St)=>{let[r,i]=d.useState(ue[s]||ds),a=d.useRef(ue[s]);d.useEffect(()=>(a.current!==ue[s]&&i(ue[s]),Je.push([s,i]),()=>{let l=Je.findIndex(([g])=>g===s);l>-1&&Je.splice(l,1)}),[s]);let n=r.toasts.map(l=>{var g,m,u;return{...t,...t[l.type],...l,removeDelay:l.removeDelay||((g=t[l.type])==null?void 0:g.removeDelay)||t?.removeDelay,duration:l.duration||((m=t[l.type])==null?void 0:m.duration)||t?.duration||na[l.type],style:{...t.style,...(u=t[l.type])==null?void 0:u.style,...l.style}}});return{...r,toasts:n}},oa=(t,s="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:s,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...r,id:r?.id||sa()}),We=t=>(s,r)=>{let i=oa(s,t,r);return ot(i.toasterId||aa(i.id))({type:2,toast:i}),i.id},se=(t,s)=>We("blank")(t,s);se.error=We("error");se.success=We("success");se.loading=We("loading");se.custom=We("custom");se.dismiss=(t,s)=>{let r={type:3,toastId:t};s?ot(s)(r):ms(r)};se.dismissAll=t=>se.dismiss(void 0,t);se.remove=(t,s)=>{let r={type:4,toastId:t};s?ot(s)(r):ms(r)};se.removeAll=t=>se.remove(void 0,t);se.promise=(t,s,r)=>{let i=se.loading(s.loading,{...r,...r?.loading});return typeof t=="function"&&(t=t()),t.then(a=>{let n=s.success?et(s.success,a):void 0;return n?se.success(n,{id:i,...r,...r?.success}):se.dismiss(i),a}).catch(a=>{let n=s.error?et(s.error,a):void 0;n?se.error(n,{id:i,...r,...r?.error}):se.dismiss(i)}),t};var ia=1e3,ca=(t,s="default")=>{let{toasts:r,pausedAt:i}=la(t,s),a=d.useRef(new Map).current,n=d.useCallback((b,C=ia)=>{if(a.has(b))return;let N=setTimeout(()=>{a.delete(b),l({type:4,toastId:b})},C);a.set(b,N)},[]);d.useEffect(()=>{if(i)return;let b=Date.now(),C=r.map(N=>{if(N.duration===1/0)return;let P=(N.duration||0)+N.pauseDuration-(b-N.createdAt);if(P<0){N.visible&&se.dismiss(N.id);return}return setTimeout(()=>se.dismiss(N.id,s),P)});return()=>{C.forEach(N=>N&&clearTimeout(N))}},[r,i,s]);let l=d.useCallback(ot(s),[s]),g=d.useCallback(()=>{l({type:5,time:Date.now()})},[l]),m=d.useCallback((b,C)=>{l({type:1,toast:{id:b,height:C}})},[l]),u=d.useCallback(()=>{i&&l({type:6,time:Date.now()})},[i,l]),h=d.useCallback((b,C)=>{let{reverseOrder:N=!1,gutter:P=8,defaultPosition:M}=C||{},S=r.filter(j=>(j.position||M)===(b.position||M)&&j.height),Y=S.findIndex(j=>j.id===b.id),p=S.filter((j,I)=>I<Y&&j.visible).length;return S.filter(j=>j.visible).slice(...N?[p+1]:[0,p]).reduce((j,I)=>j+(I.height||0)+P,0)},[r]);return d.useEffect(()=>{r.forEach(b=>{if(b.dismissed)n(b.id,b.removeDelay);else{let C=a.get(b.id);C&&(clearTimeout(C),a.delete(b.id))}})},[r,n]),{toasts:r,handlers:{updateHeight:m,startPause:g,endPause:u,calculateOffset:h}}},da=pe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ua=pe`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ma=pe`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ha=Ne("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${da} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ua} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ma} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ga=pe`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,xa=Ne("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${ga} 1s linear infinite;
`,fa=pe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,pa=pe`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,ya=Ne("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${fa} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${pa} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,ba=Ne("div")`
  position: absolute;
`,ja=Ne("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,va=pe`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Na=Ne("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${va} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,wa=({toast:t})=>{let{icon:s,type:r,iconTheme:i}=t;return s!==void 0?typeof s=="string"?d.createElement(Na,null,s):s:r==="blank"?null:d.createElement(ja,null,d.createElement(xa,{...i}),r!=="loading"&&d.createElement(ba,null,r==="error"?d.createElement(ha,{...i}):d.createElement(ya,{...i})))},Ta=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Ia=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,Sa="0%{opacity:0;} 100%{opacity:1;}",ka="0%{opacity:1;} 100%{opacity:0;}",Ca=Ne("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Ea=Ne("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Da=(t,s)=>{let r=t.includes("top")?1:-1,[i,a]=is()?[Sa,ka]:[Ta(r),Ia(r)];return{animation:s?`${pe(i)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${pe(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},_a=d.memo(({toast:t,position:s,style:r,children:i})=>{let a=t.height?Da(t.position||s||"top-center",t.visible):{opacity:0},n=d.createElement(wa,{toast:t}),l=d.createElement(Ea,{...t.ariaProps},et(t.message,t));return d.createElement(Ca,{className:t.className,style:{...a,...r,...t.style}},typeof i=="function"?i({icon:n,message:l}):d.createElement(d.Fragment,null,n,l))});ea(d.createElement);var Aa=({id:t,className:s,style:r,onHeightUpdate:i,children:a})=>{let n=d.useCallback(l=>{if(l){let g=()=>{let m=l.getBoundingClientRect().height;i(t,m)};g(),new MutationObserver(g).observe(l,{subtree:!0,childList:!0,characterData:!0})}},[t,i]);return d.createElement("div",{ref:n,className:s,style:r},a)},Oa=(t,s)=>{let r=t.includes("top"),i=r?{top:0}:{bottom:0},a=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:is()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${s*(r?1:-1)}px)`,...i,...a}},Ra=lt`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ge=16,$a=({reverseOrder:t,position:s="top-center",toastOptions:r,gutter:i,children:a,toasterId:n,containerStyle:l,containerClassName:g})=>{let{toasts:m,handlers:u}=ca(r,n);return d.createElement("div",{"data-rht-toaster":n||"",style:{position:"fixed",zIndex:9999,top:Ge,left:Ge,right:Ge,bottom:Ge,pointerEvents:"none",...l},className:g,onMouseEnter:u.startPause,onMouseLeave:u.endPause},m.map(h=>{let b=h.position||s,C=u.calculateOffset(h,{reverseOrder:t,gutter:i,defaultPosition:s}),N=Oa(b,C);return d.createElement(Aa,{id:h.id,key:h.id,onHeightUpdate:u.updateHeight,className:h.visible?Ra:"",style:N},h.type==="custom"?et(h.message,h):a?a(h):d.createElement(_a,{toast:h,position:b}))}))},dn=se;const Pa=ne(()=>re(()=>import("../chunks/Dashboard-CWC_hNKO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),"Dashboard"),Vt=ne(()=>re(()=>import("../chunks/Students-BPYz6WTN.js"),__vite__mapDeps([9,1,3,4,10,7,5,6])),"Students"),La=ne(()=>re(()=>import("../chunks/Teachers-CKkffC9S.js"),__vite__mapDeps([15,1,4,3,10,7,5,6])),"Teachers"),ht=ne(()=>re(()=>import("../chunks/TheoryLessons-6Lkt5j7v.js"),__vite__mapDeps([16,1,4,3,2,12,5,6,7])),"TheoryLessons"),Fa=ne(()=>re(()=>import("../chunks/TheoryLessonDetails-X0GiTMeF.js"),__vite__mapDeps([17,1,4,3,10,7,2,5,6])),"TheoryLessonDetails"),Ht=ne(()=>re(()=>import("../chunks/Orchestras-pM5foHdg.js"),__vite__mapDeps([18,1,4,3,10,7,2,5,6])),"Orchestras"),Yt=ne(()=>re(()=>import("../chunks/Rehearsals-DCmrHRq4.js"),__vite__mapDeps([19,1,4,3,10,7,5,6])),"Rehearsals"),Ba=ne(()=>re(()=>import("../chunks/RehearsalDetails-DvqE13j6.js"),__vite__mapDeps([20,1,5,6,3,4,7])),"RehearsalDetails"),Ma=ne(()=>re(()=>import("../chunks/Bagruts-Bh5A7FOn.js"),__vite__mapDeps([21,1,4,3,10,7,2,22,5,6])),"Bagruts"),Ua=ne(()=>re(()=>import("../chunks/BagrutDetails-Dtve08lV.js"),__vite__mapDeps([23,1,4,3,10,7,2,22,5,6])),"BagrutDetails"),Va=ne(()=>re(()=>import("../chunks/Profile-C1JCy16m.js"),__vite__mapDeps([24,1,5,6,3,7,14])),"Profile"),zt=ne(()=>re(()=>import("../chunks/RehearsalAttendance-B-tpTbpZ.js"),__vite__mapDeps([25,1,5,6,3,7])),"ConductorAttendance"),Ha=ne(()=>re(()=>import("../chunks/OrchestraEnrollmentManager-CWAcbxpp.js"),__vite__mapDeps([26,1,5,6,3,7])),"OrchestraEnrollmentManager"),Ya=ne(()=>re(()=>import("../chunks/StudentDetailsPageSimple-BgBP7wnH.js"),__vite__mapDeps([11,1,7,5,6,3,12,13,14,4])),"StudentDetailsPage"),za=ne(()=>re(()=>import("../chunks/TeacherDetailsPage-DUO63Bow.js"),__vite__mapDeps([27,1,7,8,3,5,6])),"TeacherDetailsPage"),Wa=ne(()=>re(()=>import("../chunks/OrchestraDetailsPage-DVhqJJgY.js"),__vite__mapDeps([28,1,5,6,3,7])),"OrchestraDetailsPage"),ie=({message:t="×˜×•×¢×Ÿ ×¢××•×“..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:t})]})});function J({children:t,allowedRoles:s}){const{isAuthenticated:r,isLoading:i,authError:a,checkAuthStatus:n,user:l}=$e(),[g,m]=Ke.useState(0),u=2,h=()=>{if(!s||s.length===0)return!0;if(!l)return!1;const b=l.role||l.roles?.[0]||"",C=l.roles||[b],N={×× ×”×œ:"admin",××•×¨×”:"teacher",×× ×¦×—:"conductor","××“×¨×™×š ×ª×“×¨":"theory-teacher","××•×¨×” ×ª×™××•×¨×™×”":"theory-teacher"},P=C.map(S=>N[S]||S),M=N[b]||b;return s.some(S=>P.includes(S)||M===S||S==="admin"&&!b)};return Ke.useEffect(()=>{if(a&&g<u){const b=setTimeout(()=>{console.log(`ğŸ”„ ProtectedRoute - Retrying authentication (${g+1}/${u})`),n(!0),m(C=>C+1)},1e3*(g+1));return()=>clearTimeout(b)}},[a,g,n]),Ke.useEffect(()=>{r&&g>0&&m(0)},[r]),i?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"××××ª ×”×¨×©××•×ª..."}),a&&g>0&&e.jsxs("div",{className:"mt-2 text-sm text-amber-600",children:["×× ×¡×” ×©×•×‘ (",g,"/",u,")..."]})]})}):r?h()?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"××™×Ÿ ×”×¨×©××”"}),e.jsx("p",{className:"text-gray-600",children:"××™×Ÿ ×œ×š ×”×¨×©××” ×œ×’×©×ª ×œ×¢××•×“ ×–×”"})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"×—×–×•×¨"})]})}):e.jsx(Qe,{to:"/login",replace:!0})}function qa(){return e.jsx("div",{dir:"rtl",children:e.jsxs(Os,{children:[e.jsx(q,{path:"/login",element:e.jsx(Ur,{})}),e.jsx(q,{path:"/forgot-password",element:e.jsx(Vr,{})}),e.jsx(q,{path:"/reset-password/:token",element:e.jsx(Hr,{})}),e.jsx(q,{path:"/dashboard",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×“×©×‘×•×¨×“..."}),children:e.jsx(Pa,{})})})})}),e.jsx(q,{path:"/students",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×¨×©×™××ª ×ª×œ××™×“×™×..."}),children:e.jsx(Vt,{})})})})}),e.jsx(q,{path:"/students/:studentId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×œ××™×“..."}),children:e.jsx(Ya,{})})})})}),e.jsx(q,{path:"/teachers",element:e.jsx(J,{allowedRoles:["admin","teacher","conductor","theory-teacher"],children:e.jsx(K,{children:e.jsx(La,{})})})}),e.jsx(q,{path:"/teachers/:teacherId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ××•×¨×”..."})]})}),children:e.jsx(za,{})})})})}),e.jsx(q,{path:"/theory-lessons",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(ht,{})})})}),e.jsx(q,{path:"/theory-lessons/:theoryId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Fa,{})})})}),e.jsx(q,{path:"/orchestras",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Ht,{})})})}),e.jsx(q,{path:"/orchestras/:orchestraId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×¤×¨×˜×™ ×ª×–××•×¨×ª..."})]})}),children:e.jsx(Wa,{})})})})}),e.jsx(q,{path:"/rehearsals",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Yt,{})})})}),e.jsx(q,{path:"/rehearsals/:rehearsalId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Ba,{})})})}),e.jsx(q,{path:"/bagruts",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Ma,{})})})}),e.jsx(q,{path:"/bagruts/:bagrutId",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(Ua,{})})})}),e.jsx(q,{path:"/bagruts/:bagrutId/edit",element:e.jsx(J,{children:e.jsx(K,{children:e.jsxs("div",{className:"p-6",dir:"rtl",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"×¢×¨×™×›×ª ×‘×’×¨×•×ª"}),e.jsx("p",{className:"text-gray-600",children:"×¢×¨×™×›×ª ×¤×¨×˜×™ ×”×‘×’×¨×•×ª ×•×”×ª×§×“××•×ª"}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-blue-700",children:"ğŸ”§ ×¢××•×“ ×¢×¨×™×›×ª ×‘×’×¨×•×ª ×‘×¤×™×ª×•×— - ×‘×™× ×ª×™×™× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×“×¨×š ×¢××•×“ ×”×¤×¨×˜×™×"})})]})})})}),e.jsx(q,{path:"/bagrut",element:e.jsx(Qe,{to:"/bagruts",replace:!0})}),e.jsx(q,{path:"/profile",element:e.jsx(J,{children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×¢××•×“ ××™×©×™..."}),children:e.jsx(Va,{})})})})}),e.jsx(q,{path:"/conductor/attendance",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×•×ª..."}),children:e.jsx(zt,{})})})})}),e.jsx(q,{path:"/conductor/attendance/:rehearsalId",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ × ×•×›×—×•×ª ×—×–×¨×”..."}),children:e.jsx(zt,{})})})})}),e.jsx(q,{path:"/conductor/enrollment",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×¨×™×©×•××™×..."}),children:e.jsx(Ha,{})})})})}),e.jsx(q,{path:"/conductor/orchestras",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ × ×™×”×•×œ ×ª×–××•×¨×•×ª..."}),children:e.jsx(Ht,{})})})})}),e.jsx(q,{path:"/conductor/rehearsals",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×—×–×¨×•×ª..."}),children:e.jsx(Yt,{})})})})}),e.jsx(q,{path:"/conductor/musicians",element:e.jsx(J,{allowedRoles:["conductor","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ××•×–×™×§××™×..."}),children:e.jsx(Vt,{})})})})}),e.jsx(q,{path:"/theory-teacher/lessons",element:e.jsx(J,{allowedRoles:["theory-teacher","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×©×™×¢×•×¨×™ ×ª×™××•×¨×™×”..."}),children:e.jsx(ht,{})})})})}),e.jsx(q,{path:"/theory-teacher/groups",element:e.jsx(J,{allowedRoles:["theory-teacher","admin"],children:e.jsx(K,{children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{message:"×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª ×ª×™××•×¨×™×”..."}),children:e.jsx(ht,{})})})})}),e.jsx(q,{path:"/",element:e.jsx(Qe,{to:"/dashboard",replace:!0})}),e.jsx(q,{path:"*",element:e.jsx(Qe,{to:"/dashboard",replace:!0})})]})})}function Xa(){return d.useEffect(()=>{qr()},[]),e.jsx(ir,{children:e.jsx(Js,{children:e.jsx(Zs,{children:e.jsx(or,{children:e.jsxs(cr,{children:[e.jsx($a,{position:"top-center",reverseOrder:!1,gutter:8,containerClassName:"",containerStyle:{},toastOptions:{duration:4e3,style:{background:"#fff",color:"#363636",padding:"16px",borderRadius:"8px",fontSize:"14px",fontFamily:"Reisinger-Yonatan, sans-serif",direction:"rtl"},success:{style:{background:"#F0FDF4",color:"#166534",border:"1px solid #86EFAC"},iconTheme:{primary:"#22C55E",secondary:"#F0FDF4"}},error:{style:{background:"#FEE2E2",color:"#991B1B",border:"1px solid #FCA5A5"},iconTheme:{primary:"#EF4444",secondary:"#FEE2E2"}}}}),e.jsx(qa,{})]})})})})})}Fs();const Ga=new qt({defaultOptions:{queries:{staleTime:1e3*60*5,retry:(t,s)=>s?.status===404||s?.status===403?!1:t<3}}}),hs=document.getElementById("root");if(!hs)throw new Error("Root element not found");pt.createRoot(hs).render(e.jsx(Ke.StrictMode,{children:e.jsx(Xt,{client:Ga,children:e.jsx(Rs,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(Xa,{})})})}));export{wr as A,ur as C,Ir as D,dr as M,Ar as R,br as S,Tr as T,yt as V,ss as a,It as b,Bt as c,ns as d,kr as e,Sr as f,cn as g,nt as h,ln as i,e as j,an as k,nn as l,se as n,on as s,$e as u,dn as z};
